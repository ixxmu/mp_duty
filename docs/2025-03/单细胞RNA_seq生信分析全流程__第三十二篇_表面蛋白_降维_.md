---
title: "单细胞RNA-seq生信分析全流程——第三十二篇：表面蛋白（降维）"
date: 2025-03-09T23:36:10Z
draft: ["false"]
tags: [
  "fetched",
  "小鱼生物信息"
]
categories: ["Acdemic"]
---
单细胞RNA-seq生信分析全流程——第三十二篇：表面蛋白（降维） by 小鱼生物信息
------
<div><section><span><span leaf="">32.1 前言</span></span></section><p><span leaf="">作为原始表格，表面蛋白标记的特征矩阵很难被人类掌握。因此，我们求助于低维嵌入，使我们能够在通常的二维中可视化Antibody-Derived Tags（ADT）。我们对ADT数据使用和推荐的方法与转录组学数据的方法没有区别。通过t-SNE和UMAP等方法获得的可视化的所有上述限制也适用于ADT数据。</span></p><p><span leaf="">ADT数据通常不需要任何复杂的特征选择，因为在实验设计期间已经预先选择了特征。所有选定的ADT都应与生物学相关特征相对应。尽管如此，大型数据集可能受益于PCA，将数据集从几百个特征减少到几个主成分。如果计算资源有限，这尤其推荐的方法。</span></p><section><span><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"p","attributes":{"style":"-webkit-tap-highlight-color: transparent; margin: 0px 0px 24px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; clear: both; min-height: 1em; color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 17px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; visibility: visible;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;  background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>32.2 环境配置</span></span></section><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang=""><code><span leaf="">import muon as mu</span></code><code><span leaf="">import pooch</span></code><code><span leaf="">import scanpy as sc</span></code><code><span leaf=""># setting visualization parameters</span></code><code><span leaf="">sc.settings.verbosity = 0</span></code><code><span leaf="">sc.settings.set_figure_params(</span></code><code><span leaf="">    dpi=80,</span></code><code><span leaf="">    facecolor="white",</span></code><code><span leaf="">    frameon=False,</span></code><code><span leaf="">)</span></code></pre></section><section><span><span leaf="" data-pm-slice='1 1 ["para",null,"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;  background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>32.3 加载数据</span></span></section><section><ul><li><li><li><li><li><li><li></ul><pre data-lang=""><code><span leaf="">cite_xdbt = pooch.retrieve(</span></code><code><span leaf="">    url="https://figshare.com/ndownloader/files/41452434",</span></code><code><span leaf="">    fname="cite_doublet_removal_xdbt.h5mu",</span></code><code><span leaf="">    path=".",</span></code><code><span leaf="">    known_hash=None,</span></code><code><span leaf="">    progressbar=True,</span></code><code><span leaf="">)</span></code></pre></section><p><span leaf="">我们只是从标准化章节中重新加载已保存的MuData对象。</span></p><section><ul><li></ul><pre data-lang=""><code><span leaf="">mdata = mu.read("cite_doublet_removal_xdbt.h5mu")</span></code></pre></section><p><span leaf="">由于同种型不包含任何生物学信息，我们可以将其从数据中删除。</span></p><section><ul><li></ul><pre data-lang=""><code><span leaf="">mdata["prot"].var.index[:50]</span></code></pre></section><section><ul><li><li><li></ul><pre data-lang=""><code><span leaf="">isotype_controls = ["Mouse-IgG1", "Mouse-IgG2a", "Mouse-IgG2b", "Rat-IgG2b"]</span></code><code><span leaf="">temp = mdata["prot"].var.loc[~mdata["prot"].var.index.isin(isotype_controls), :].index</span></code><code><span leaf="">temp</span></code></pre></section><section><ul><li><li><li><li><li><li></ul><pre data-lang=""><code><span leaf="">Index(['CD86-1', 'CD274-1', 'CD270', 'CD155', 'CD112', 'CD47-1', 'CD48-1',</span></code><code><span leaf="">       'CD40-1', 'CD154', 'CD52-1',</span></code><code><span leaf="">       ...</span></code><code><span leaf="">       'CD94', 'CD162', 'CD85j', 'CD23', 'CD328', 'HLA-E-1', 'CD82-1',</span></code><code><span leaf="">       'CD101-1', 'CD88', 'CD224'],</span></code><code><span leaf="">      dtype='object', length=136)</span></code></pre></section><p><span leaf="">我们将同种型数据存储为多维注释。</span></p><section><ul><li><li><li><li><li></ul><pre data-lang=""><code><span leaf="">mdata["prot"].obsm["X_isotypes"] = mdata["prot"].X[</span></code><code><span leaf="">    :, ~mdata["prot"].var.index.isin(temp.tolist())</span></code><code><span leaf="">]</span></code><code><span leaf="">mu.pp.filter_var(data=mdata["prot"], var=temp.tolist())</span></code><code><span leaf="">mdata["prot"].var.index[:50]</span></code></pre></section><section><span><span leaf="" data-pm-slice='1 1 ["para",null,"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;  background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>32.4 PCA和UMAP</span></span></section><p><span leaf="">由于我们的数据集非常大，我们现在可以使用PCA来降低数据的维数，计算邻域图和UMAP嵌入来可视化研究的变量。</span></p><section><ul><li><li></ul><pre data-lang=""><code><span leaf="">sc.pp.pca(mdata["prot"], svd_solver="arpack")</span></code><code><span leaf="">sc.pl.pca_variance_ratio(mdata["prot"], n_pcs=50)</span></code></pre></section><p><span leaf=""><img alt="../_images/a04cdabac60b6439e9951b02d3000cd947f5ff417429863769e7feeed0d18f1e.png" data-imgfileid="100000501" data-src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjqf5HZaMSmrIibQks8eMSB8oQeXFYREDjD4zIYz6HVPWmvtWGpOHrKVv8ibBKTtwqWXUsKDvYCIJiaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjqf5HZaMSmrIibQks8eMSB8oQeXFYREDjD4zIYz6HVPWmvtWGpOHrKVv8ibBKTtwqWXUsKDvYCIJiaQ/640?wx_fmt=png&amp;from=appmsg"></span></p><section><ul><li><li><li><li></ul><pre data-lang=""><code><span leaf="">sc.pp.neighbors(mdata["prot"], n_pcs=20)</span></code><code><span leaf="">sc.tl.umap(mdata["prot"])</span></code><code><span leaf="">sc.pl.umap(mdata["prot"], color=["CD4-1", "CD8", "CD3"])</span></code><code><span leaf="">sc.pl.umap(mdata["prot"], color=["CD14-1", "CD16"])</span></code></pre></section><p><span leaf=""><img alt="../_images/3f71063d0460679c94ad61fcf4a74b5f91c99442c7bdf96793ed1bc0d07fd7f9.png" data-imgfileid="100000502" data-src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjqf5HZaMSmrIibQks8eMSB8u6t5G7CXa486XLMU6RKjZv4MM1KpAKjMAZ1gcico8qaciarf2XUrgdKA/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjqf5HZaMSmrIibQks8eMSB8u6t5G7CXa486XLMU6RKjZv4MM1KpAKjMAZ1gcico8qaciarf2XUrgdKA/640?wx_fmt=png&amp;from=appmsg"><img alt="../_images/a9e63f03d49f181e77dbe194d9b05349f82945f8f357ab12a5140fcb5df24371.png" data-imgfileid="100000503" data-src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjqf5HZaMSmrIibQks8eMSB8kJeo5kzDeG9PHBSeXIJuRfjk7vtBVVtb3XdaqEFiaicXqBibJNmrIEMKw/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjqf5HZaMSmrIibQks8eMSB8kJeo5kzDeG9PHBSeXIJuRfjk7vtBVVtb3XdaqEFiaicXqBibJNmrIEMKw/640?wx_fmt=png&amp;from=appmsg"></span></p><section><ul><li></ul><pre data-lang=""><code><span leaf="">sc.pl.umap(mdata["prot"], color=["donor", "batch"])</span></code></pre></section><p><span leaf=""><img alt="../_images/38c245a20579c71b631a8b797d8e0abd2cfaf740ff9421853ed8ad48bea54293.png" data-imgfileid="100000504" data-src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjqf5HZaMSmrIibQks8eMSB8Y7QyHibdMxtXasc7Nt2QjOniahZQDSoiawQ88icf9mSDSzYsmLciaDaic4tQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjqf5HZaMSmrIibQks8eMSB8Y7QyHibdMxtXasc7Nt2QjOniahZQDSoiawQ88icf9mSDSzYsmLciaDaic4tQ/640?wx_fmt=png&amp;from=appmsg"></span></p><p><span leaf="">从上面的UMAP可以看出，不同样本在相似的群体中彼此聚类（参见上图中的CD4和CD8表达）。因此，需要对数据进行批量校正。</span></p><section><ul><li></ul><pre data-lang=""><code><span leaf="">mdata</span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang=""><code><span leaf="">MuData object with n_obs × n_vars = 119837 × 36741</span></code><code><span leaf="">  var:	'gene_ids', 'feature_types'</span></code><code><span leaf="">  2 modalities</span></code><code><span leaf="">    rna:	119837 x 36601</span></code><code><span leaf="">      obs:	'donor', 'batch'</span></code><code><span leaf="">      var:	'gene_ids', 'feature_types'</span></code><code><span leaf="">    prot:	119837 x 136</span></code><code><span leaf="">      obs:	'donor', 'batch', 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', 'n_counts', 'outliers', 'doublets_markers'</span></code><code><span leaf="">      var:	'gene_ids', 'feature_types', 'n_cells_by_counts', 'mean_counts', 'log1p_mean_counts', 'pct_dropout_by_counts', 'total_counts', 'log1p_total_counts'</span></code><code><span leaf="">      uns:	'doublets_markers_colors', 'pca', 'neighbors', 'umap', 'donor_colors', 'batch_colors'</span></code><code><span leaf="">      obsm:	'X_isotypes', 'X_pca', 'X_umap'</span></code><code><span leaf="">      varm:	'PCs'</span></code><code><span leaf="">      layers:	'counts'</span></code><code><span leaf="">      obsp:	'distances', 'connectivities'</span></code></pre></section><section><ul><li></ul><pre data-lang="javascript"><code><span leaf="">mdata.<span>write</span>(<span>"cite_dimensionality_reduction.h5mu"</span>)</span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3WJ3rDj9po7er4nFXVIlzQ",target="_blank" rel="noopener noreferrer">原文链接</a>
