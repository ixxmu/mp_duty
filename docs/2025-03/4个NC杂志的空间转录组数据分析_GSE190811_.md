---
title: "4个NC杂志的空间转录组数据分析(GSE190811)"
date: 2025-03-20T00:16:23Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
4个NC杂志的空间转录组数据分析(GSE190811) by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote><span></span><p><span leaf="">我们生信马拉松授课群里有个学员问空间转录组数据如何读取，给出的数据编号为 GSE190811，由于不是10x spaceranger 的标准格式，对于初学者来说有一些难度，下面一起来看看这个数据集！</span></p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">数据背景</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">GSE190811 这个数据来自2022年11月10号发表在NC杂志上，标题为《Single cell profiling of primary and paired metastatic lymph node tumors in breast cancer patients》，文章仅用这个数据绘制了一幅图：上皮细胞的特征基因在空间切片上的打分分布。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJgS0RgRg8DnCStwbIvnPKRGTpFGGNMoqspLBlGAOrMom6hFnbj3RUBg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.3023529411764706" data-type="png" data-w="850" data-imgfileid="100056163" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJgS0RgRg8DnCStwbIvnPKRGTpFGGNMoqspLBlGAOrMom6hFnbj3RUBg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">这个数据的GEO链接为：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE190811，总共是4个空间转录组的样本：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">GSM5732357 PT_3 LNM ST</span><span leaf=""><br></span><span leaf="">GSM5732358 PT_6 LNM ST</span><span leaf=""><br></span><span leaf="">GSM5732359 PT_7 LNM ST</span><span leaf=""><br></span><span leaf="">GSM5732360 PT_8 LNM ST</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">提供的附件 GSE190811_RAW.tar 包含的文件如下：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">GSM5732357_A_1938345_11.jpg.gz 52.6 Mb</span><span leaf=""><br></span><span leaf="">GSM5732357_A_raw_feature_bc_matrix.h5 29.6 Mb</span><span leaf=""><br></span><span leaf="">GSM5732357_A_scalefactors_json.json.gz 161 b</span><span leaf=""><br></span><span leaf="">GSM5732357_A_tissue_hires_image.png.gz 14.5 Mb</span><span leaf=""><br></span><span leaf="">GSM5732357_A_tissue_positions_list.csv.gz 66.5 Kb</span><span leaf=""><br></span><span leaf="">GSM5732358_B_1938529_9.jpg.gz 68.6 Mb</span><span leaf=""><br></span><span leaf="">GSM5732358_B_raw_feature_bc_matrix.h5 34.7 Mb</span><span leaf=""><br></span><span leaf="">GSM5732358_B_scalefactors_json.json.gz 164 b</span><span leaf=""><br></span><span leaf="">GSM5732358_B_tissue_hires_image.png.gz 16.9 Mb</span><span leaf=""><br></span><span leaf="">GSM5732358_B_tissue_positions_list.csv.gz 64.4 Kb</span><span leaf=""><br></span><span leaf="">GSM5732359_C_2000752_23.jpg.gz 75.1 Mb</span><span leaf=""><br></span><span leaf="">GSM5732359_C_raw_feature_bc_matrix.h5 40.5 Mb</span><span leaf=""><br></span><span leaf="">GSM5732359_C_scalefactors_json.json.gz 164 b</span><span leaf=""><br></span><span leaf="">GSM5732359_C_tissue_hires_image.png.gz 17.3 Mb</span><span leaf=""><br></span><span leaf="">GSM5732359_C_tissue_positions_list.csv.gz 62.6 Kb</span><span leaf=""><br></span><span leaf="">GSM5732360_D_2000910_33.jpg.gz 65.7 Mb</span><span leaf=""><br></span><span leaf="">GSM5732360_D_raw_feature_bc_matrix.h5 38.5 Mb</span><span leaf=""><br></span><span leaf="">GSM5732360_D_scalefactors_json.json.gz 160 b</span><span leaf=""><br></span><span leaf="">GSM5732360_D_tissue_hires_image.png.gz 16.1 Mb</span><span leaf=""><br></span><span leaf="">GSM5732360_D_tissue_positions_list.csv.gz 59.7 Kb</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">目录中的文件说明</span></span><span></span></h3><ul><li><section><strong><span leaf="">raw_feature_bc_matrix.h5</span></strong><span leaf="">：基因表达矩阵的h5格式</span></section></li><li><section><strong><span leaf="">tissue_positions.csv</span></strong><span leaf="">：记录了对应的空间切片里面的每个barcode所在的切片的空间坐标，理论上有了这个csv文件其实就可以相当于有了空间切片的图片的细胞定位作用</span></section></li><li><section><strong><span leaf="">tissue_hires_image.png</span></strong><span leaf="">：分辨率很高，所以图片文件就很大</span></section></li><li><section><strong><span leaf="">tissue_lowres_image.png</span></strong><span leaf="">：文件很小，因为图片分辨率低，官网说它 is always 600 pixels. 【这个数据没有提供这个文件】</span></section></li><li><section><strong><span leaf="">scalefactors_json.json</span></strong><span leaf="">：它关联了tissue_hires_image.png and tissue_lowres_image.png，文件内容如下：</span></section></li></ul><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">{</span><span><span leaf="">"tissue_hires_scalef"</span></span><span leaf="">: 0.06628223, </span><span><span leaf="">"tissue_lowres_scalef"</span></span><span leaf="">: 0.019884668, </span><span><span leaf="">"fiducial_diameter_fullres"</span></span><span leaf="">: 383.95734, </span><span><span leaf="">"spot_diameter_fullres"</span></span><span leaf="">: 237.68787000000003}</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">下载下来后整理成如下格式：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">├── GSM5732357_A</span><span leaf=""><br></span><span leaf="">│   ├── 1938345_11.jpg</span><span leaf=""><br></span><span leaf="">│   ├── raw_feature_bc_matrix.h5</span><span leaf=""><br></span><span leaf="">│   ├── scalefactors_json.json</span><span leaf=""><br></span><span leaf="">│   ├── tissue_hires_image.png</span><span leaf=""><br></span><span leaf="">│   └── tissue_positions_list.csv</span><span leaf=""><br></span><span leaf="">├── GSM5732358_B</span><span leaf=""><br></span><span leaf="">│   ├── 1938529_9.jpg</span><span leaf=""><br></span><span leaf="">│   ├── raw_feature_bc_matrix.h5</span><span leaf=""><br></span><span leaf="">│   ├── scalefactors_json.json</span><span leaf=""><br></span><span leaf="">│   ├── tissue_hires_image.png</span><span leaf=""><br></span><span leaf="">│   └── tissue_positions_list.csv</span><span leaf=""><br></span><span leaf="">├── GSM5732359_C</span><span leaf=""><br></span><span leaf="">│   ├── 2000752_23.jpg</span><span leaf=""><br></span><span leaf="">│   ├── raw_feature_bc_matrix.h5</span><span leaf=""><br></span><span leaf="">│   ├── scalefactors_json.json</span><span leaf=""><br></span><span leaf="">│   ├── tissue_hires_image.png</span><span leaf=""><br></span><span leaf="">│   └── tissue_positions_list.csv</span><span leaf=""><br></span><span leaf="">├── GSM5732360_D</span><span leaf=""><br></span><span leaf="">│   ├── 2000910_33.jpg</span><span leaf=""><br></span><span leaf="">│   ├── raw_feature_bc_matrix.h5</span><span leaf=""><br></span><span leaf="">│   ├── scalefactors_json.json</span><span leaf=""><br></span><span leaf="">│   ├── tissue_hires_image.png</span><span leaf=""><br></span><span leaf="">│   └── tissue_positions_list.csv</span><span leaf=""><br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">使用Seurat读取</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">这里用到的文件为 raw_feature_bc_matrix.h5，以及 图片tissue_hires_image.png：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">###</span></span><span leaf=""><br></span><span><span leaf="">### Create: Jianming Zeng</span></span><span leaf=""><br></span><span><span leaf="">### Date:  2023-12-31  </span></span><span leaf=""><br></span><span><span leaf="">### Email: jmzeng1314@163.com</span></span><span leaf=""><br></span><span><span leaf="">### Blog: http://www.bio-info-trainee.com/</span></span><span leaf=""><br></span><span><span leaf="">### Forum:  http://www.biotrainee.com/thread-1376-1-1.html</span></span><span leaf=""><br></span><span><span leaf="">### CAFS/SUSTC/Eli Lilly/University of Macau</span></span><span leaf=""><br></span><span><span leaf="">### Update Log: 2023-12-31   First version </span></span><span leaf=""><br></span><span><span leaf="">### Update Log: 2024-12-09   by juan zhang (492482942@qq.com)</span></span><span leaf=""><br></span><span><span leaf="">### </span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span leaf="">options(stringsAsFactors = F)</span><span leaf=""><br></span><span leaf="">library(ggsci)</span><span leaf=""><br></span><span leaf="">library(dplyr) </span><span leaf=""><br></span><span leaf="">library(future)</span><span leaf=""><br></span><span leaf="">library(Seurat)</span><span leaf=""><br></span><span leaf="">library(clustree)</span><span leaf=""><br></span><span leaf="">library(cowplot)</span><span leaf=""><br></span><span leaf="">library(data.table)</span><span leaf=""><br></span><span leaf="">library(ggplot2)</span><span leaf=""><br></span><span leaf="">library(patchwork)</span><span leaf=""><br></span><span leaf="">library(stringr)</span><span leaf=""><br></span><span leaf="">library(qs)</span><span leaf=""><br></span><span leaf="">library(Matrix)</span><span leaf=""><br></span><span leaf="">getwd()</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 创建目录</span></span><span leaf=""><br></span><span leaf="">getwd()</span><span leaf=""><br></span><span leaf="">gse &lt;- </span><span><span leaf="">"GSE190811"</span></span><span leaf=""><br></span><span leaf="">dir.create(gse)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">################## 读取数据，有h5与tissue_hires_image.png</span></span><span leaf=""><br></span><span leaf="">samples &lt;- list.dirs(</span><span><span leaf="">"GSE190811/"</span></span><span leaf="">, recursive = F, full.names = F)</span><span leaf=""><br></span><span leaf="">samples</span><span leaf=""><br></span><span leaf="">scRNAlist &lt;- lapply(samples, </span><span><span leaf="">function</span></span><span leaf="">(pro){</span><span leaf=""><br></span><span><span leaf=""># pro &lt;- samples[1]</span></span><span leaf=""><br></span><span><span leaf="">print</span></span><span leaf="">(pro)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 先读取 h5</span></span><span leaf=""><br></span><span leaf="">  data &lt;- Read10X_h5(filename = paste0(</span><span><span leaf="">"GSE190811/"</span></span><span leaf="">,pro,</span><span><span leaf="">"/raw_feature_bc_matrix.h5"</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf="">  dim(data)</span><span leaf=""><br></span><span leaf="">  data[1:5,1:5]</span><span leaf=""><br></span><span leaf="">  object &lt;- CreateSeuratObject(counts = data, assay = </span><span><span leaf="">"Spatial"</span></span><span leaf="">, min.cells = 3, project = pro)</span><span leaf=""><br></span><span leaf="">  object</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 再读取</span></span><span leaf=""><br></span><span leaf="">  image &lt;- Read10X_Image(image.dir = paste0(</span><span><span leaf="">"GSE190811/"</span></span><span leaf="">,pro), </span><span leaf=""><br></span><span leaf="">                         image.name = </span><span><span leaf="">"tissue_hires_image.png"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                         filter.matrix = TRUE)</span><span leaf=""><br></span><span leaf="">  image</span><span leaf=""><br></span><span leaf="">  dim(image)</span><span leaf=""><br></span><span leaf="">  image &lt;- image[Cells(x = object)]</span><span leaf=""><br></span><span leaf="">  DefaultAssay(object = image) &lt;- </span><span><span leaf="">"Spatial"</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 添加图片到object中</span></span><span leaf=""><br></span><span leaf="">  object[[pro]] &lt;- image</span><span leaf=""><br></span><span leaf="">  object@images[[1]]@scale.factors</span><span><span leaf="">$lowres</span></span><span leaf=""> &lt;- object@images[[1]]@scale.factors</span><span><span leaf="">$hires</span></span><span leaf=""><br></span><span><span leaf="">return</span></span><span leaf="">(object)</span><span leaf=""><br></span><span leaf="">})</span><span leaf=""><br></span><span leaf="">names(scRNAlist) &lt;-  samples</span><span leaf=""><br></span><span leaf="">scRNAlist</span><span leaf=""><br></span><span><span leaf=""># merge</span></span><span leaf=""><br></span><span leaf="">sce.all &lt;- merge(scRNAlist[[1]], y=scRNAlist[-1], add.cell.ids=samples)</span><span leaf=""><br></span><span leaf="">sce.all &lt;- JoinLayers(sce.all) </span><span><span leaf=""># seurat v5</span></span><span leaf=""><br></span><span leaf="">sce.all</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## 简单探索一下数据结构</span></span><span leaf=""><br></span><span leaf="">as.data.frame(sce.all[[</span><span><span leaf="">"Spatial"</span></span><span leaf="">]]</span><span><span leaf="">$counts</span></span><span leaf="">[1:4,1:4])</span><span leaf=""><br></span><span leaf="">as.data.frame(LayerData(sce.all, assay = </span><span><span leaf="">"Spatial"</span></span><span leaf="">, layer = </span><span><span leaf="">"counts"</span></span><span leaf="">)[1:5,1:5])</span><span leaf=""><br></span><span leaf="">head(sce.all@meta.data)</span><span leaf=""><br></span><span leaf="">table(sce.all</span><span><span leaf="">$orig</span></span><span leaf="">.ident)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Layers(sce.all)</span><span leaf=""><br></span><span leaf="">Assays(sce.all)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">library(qs)</span><span leaf=""><br></span><span leaf="">qsave(sce.all, file=</span><span><span leaf="">"GSE190811/sce.all.qs"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">简单查看一下数据的分布</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">每个样本中 </span><code><span leaf="">nCount_Spatial</span></code><span leaf=""> 和</span><code><span leaf="">nFeature_Spatial</span></code><span leaf="">的小提琴分布：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># Data preprocessing</span></span><span leaf=""><br></span><span leaf="">plot1 &lt;- VlnPlot(sce.all, features = c(</span><span><span leaf="">"nCount_Spatial"</span></span><span leaf="">,</span><span><span leaf="">"nFeature_Spatial"</span></span><span leaf="">), pt.size = 0.1) + NoLegend()</span><span leaf=""><br></span><span leaf="">plot1</span><span leaf=""><br></span><span leaf="">ggsave(filename = </span><span><span leaf="">"1-QC/VlnPlot.pdf"</span></span><span leaf="">, width = 12,height = 6, plot = plot1)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJibZkggJpNJ3Xj2UtclGiasRlVUhfnhUO51suL9boVqwH8dSMsvyNexmg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.4619140625" data-type="png" data-w="1024" data-imgfileid="100056162" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJibZkggJpNJ3Xj2UtclGiasRlVUhfnhUO51suL9boVqwH8dSMsvyNexmg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">空间分布特征模式：nCount_Spatial</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">plot2 &lt;- SpatialFeaturePlot(sce.all, features = </span><span><span leaf="">"nCount_Spatial"</span></span><span leaf="">,pt.size.factor = 2) </span><span leaf=""><br></span><span leaf="">ggsave(filename = </span><span><span leaf="">"1-QC/FeaturePlot_nCount.pdf"</span></span><span leaf="">, width = 12,height = 6, plot = plot2)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJNWBicITHQ7ejIPNBziaiatwiaDBduT2fibo64iaDbgVFZS5FH8WT8174wAiaA/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="0.42314814814814816" data-type="jpeg" data-w="1080" data-imgfileid="100056160" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJNWBicITHQ7ejIPNBziaiatwiaDBduT2fibo64iaDbgVFZS5FH8WT8174wAiaA/640?wx_fmt=jpeg&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><code><span leaf="">nFeature_Spatial</span></code><span leaf=""> 分布：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">plot3 &lt;- SpatialFeaturePlot(sce.all, features = </span><span><span leaf="">"nFeature_Spatial"</span></span><span leaf="">,pt.size.factor = 2) </span><span leaf=""><br></span><span leaf="">ggsave(filename = </span><span><span leaf="">"1-QC/FeaturePlot_nFeature.pdf"</span></span><span leaf="">, width = 12,height = 6, plot = plot3)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJUVbcPbJdSawmR0QYWNNZCv0DFJ3lzP5uyPGm5bgAx8mb0jHIhS4jow/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="0.37037037037037035" data-type="jpeg" data-w="1080" data-imgfileid="100056161" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJUVbcPbJdSawmR0QYWNNZCv0DFJ3lzP5uyPGm5bgAx8mb0jHIhS4jow/640?wx_fmt=jpeg&amp;from=appmsg"></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">然后就是后面的空转标准分析</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">降维聚类分群：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">## 计算线粒体/核糖体/特定基因集的比例</span></span><span leaf=""><br></span><span leaf="">mito_genes &lt;- grep(</span><span><span leaf="">"^MT-"</span></span><span leaf="">, rownames(sce.all),ignore.case = T, value = T) </span><span leaf=""><br></span><span><span leaf=""># 可能是13个线粒体基因</span></span><span leaf=""><br></span><span><span leaf="">print</span></span><span leaf="">(mito_genes)</span><span leaf=""><br></span><span leaf="">sce.all &lt;- PercentageFeatureSet(sce.all, features = mito_genes, col.name = </span><span><span leaf="">"percent_mito"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">fivenum(sce.all@meta.data</span><span><span leaf="">$percent_mito</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 另外一种方法</span></span><span leaf=""><br></span><span><span leaf=""># sce.all$percent_mito &lt;- (Matrix::colSums(sce.all[["Spatial"]]$counts[mt.genes, ])/Matrix::colSums(sce.all[["Spatial"]]$counts))*100</span></span><span leaf=""><br></span><span><span leaf=""># fivenum(sce.all$percent_mito)</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## 过滤spot</span></span><span leaf=""><br></span><span leaf="">sce.all &lt;- subset(sce.all, subset = nFeature_Spatial &gt; 200 )</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## 标准化</span></span><span leaf=""><br></span><span leaf="">options(future.globals.maxSize= 5*1024*1024^2)</span><span leaf=""><br></span><span leaf="">sce.all &lt;- SCTransform(sce.all, assay = </span><span><span leaf="">"Spatial"</span></span><span leaf="">, verbose = T)</span><span leaf=""><br></span><span leaf="">sce.all &lt;- RunPCA(sce.all, assay = </span><span><span leaf="">"SCT"</span></span><span leaf="">, verbose = FALSE)</span><span leaf=""><br></span><span leaf="">sce.all &lt;- FindNeighbors(sce.all, reduction = </span><span><span leaf="">"pca"</span></span><span leaf="">, dims = 1:30)</span><span leaf=""><br></span><span leaf="">sce.all &lt;- FindClusters(sce.all, verbose = FALSE,resolution = 0.8)</span><span leaf=""><br></span><span leaf="">sce.all &lt;- RunUMAP(sce.all, reduction = </span><span><span leaf="">"pca"</span></span><span leaf="">, dims = 1:30)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">p1 &lt;- DimPlot(sce.all, reduction = </span><span><span leaf="">"umap"</span></span><span leaf="">, label = TRUE,label.size = 7)</span><span leaf=""><br></span><span leaf="">p2 &lt;- SpatialDimPlot(sce.all, label = TRUE, label.size = 3,pt.size.factor = 2,image.alpha = 0.6)</span><span leaf=""><br></span><span leaf="">p &lt;- p1 + p2</span><span leaf=""><br></span><span leaf="">p</span><span leaf=""><br></span><span leaf="">ggsave(filename = </span><span><span leaf="">"1-QC/DimPlot.pdf"</span></span><span leaf="">, width = 12,height = 6, plot = p)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">降维聚类结果如下：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJSKXYArxzN1tfoxYibW7ROeHAwbYSxzxznq6MwDiceMQ6JMTzH3o0Sy3A/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.9773371104815864" data-type="png" data-w="706" data-imgfileid="100056159" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJSKXYArxzN1tfoxYibW7ROeHAwbYSxzxznq6MwDiceMQ6JMTzH3o0Sy3A/640?wx_fmt=png&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100056168" data-ratio="0.24537037037037038" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJEdE6ITQt4spd8a4n8GAcicNwNkrynR4UiboPgYk4yGbXXrSBrtYKgriaw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJEdE6ITQt4spd8a4n8GAcicNwNkrynR4UiboPgYk4yGbXXrSBrtYKgriaw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">上面的代码运行过程中踩了两个坑，对应的报错以及github上面给出的解决方案如下：</span></p><blockquote><span></span><p><span leaf="">踩坑1：矩阵在log后含NA值，https://github.com/satijalab/sctransform/issues/86，我这里 设置了 CreateSeuratObject(counts = data, assay = "Spatial", min.cells = 3, project = pro)的时候min.cells过滤掉在所有细胞中表达都为0的基因。</span></p></blockquote><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Running SCTransform on assay: Spatial</span><span leaf=""><br></span><span leaf="">Running SCTransform on layer: counts</span><span leaf=""><br></span><span leaf="">vst.flavor=</span><span><span leaf="">'v2'</span></span><span leaf=""> </span><span><span leaf="">set</span></span><span leaf="">. Using model with fixed slope and excluding poisson genes.</span><span leaf=""><br></span><span leaf="">Error </span><span><span leaf="">in</span></span><span leaf=""> make_cell_attr(umi, cell_attr, latent_var, batch_var, latent_var_nonreg,  : </span><span leaf=""><br></span><span leaf="">  cell attribute </span><span><span leaf="">"log_umi"</span></span><span leaf=""> contains NA, NaN, or infinite value</span><span leaf=""><br></span></code></pre><blockquote><span></span><p><span leaf="">踩坑2：运行内存不足 https://github.com/satijalab/seurat/discussions/9191</span></p></blockquote><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Error </span><span><span leaf="">in</span></span><span leaf=""> getGlobalsAndPackages(expr, envir = envir, globals = globals) : </span><span leaf=""><br></span><span leaf="">  The total size of the 19 globals exported </span><span><span leaf="">for</span></span><span leaf=""> future expression (‘FUN()’) is 555.16 MiB.. This exceeds the maximum allowed size of 500.00 MiB (option </span><span><span leaf="">'future.globals.maxSize'</span></span><span leaf="">). The three largest globals are ‘FUN’ (538.70 MiB of class ‘</span><span><span leaf="">function</span></span><span leaf="">’), ‘umi_bin’ (16.12 MiB of class ‘numeric’) and ‘data_step1’ (270.82 KiB of class ‘list’)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">到这里简单的基础分析就做完了~</span></p><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">如果你也有类似的生信分析疑难迟迟得不到解决，又不知道问谁，可以考虑看看下面的培训班呢？我们最新一期4月份招生如下：</span></span><span></span></h4><h4 data-tool="mdnice编辑器"><span></span><span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247539788&amp;idx=1&amp;sn=62a09c7af6373658bf81c149eb0b4026&amp;scene=21#wechat_redirect"><span leaf="">生信入门&amp;数据挖掘线上直播课4月班</span></a></span><span></span></h4><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">选择你的生信入门，为你的生信学习保驾护航：</span></span><span></span></h4><ul><li><section><p><span leaf="">我们有非常成熟的培训体系，我们的培训讲师深知每一位初学者的痛点；</span></p></section></li><li><section><p><span leaf="">多位老师以及助教群里24小时答疑；</span></p></section></li><li><section><p><span leaf="">还可以获取你的专属答疑，见我们的答疑专辑：</span><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=3690970204957147140&amp;scene=173&amp;subscene=&amp;sessionid=1742299252&amp;enterid=0&amp;from_msgid=2247539626&amp;from_itemidx=3&amp;count=3&amp;nolastread=1#wechat_redirect"><span leaf="">生信马拉松答疑</span></a></p></section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">快来添加下面的小助手了解更多细节吧~</span></span><span></span></h4><figure data-tool="mdnice编辑器"><span leaf=""><img data-croporisrc="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJgpdic6vIx0rOSDho4DvnVPqGicP68l01ziaUrgrVU3wXYONv1FTDiaJ2tQ/640?wx_fmt=png&amp;from=appmsg" data-cropx2="634" data-cropy2="353.3584229390681" data-imgfileid="100056167" data-ratio="0.555205047318612" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJjCUFpmPFfK8hicxw6gpEPReNiaPBscOfVe4Y59sVnefmibjpMia8HHia9AQ/640?wx_fmt=jpeg" data-type="png" data-w="634" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyq0icW0ygUcqewQKgibR6bmJjCUFpmPFfK8hicxw6gpEPReNiaPBscOfVe4Y59sVnefmibjpMia8HHia9AQ/640?wx_fmt=jpeg"></span></figure></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/b8Lq8vsesBX_Fs_SYMZgdg",target="_blank" rel="noopener noreferrer">原文链接</a>
