---
title: "创建Seurat对象时忽略的两个参数竟然有这样的功能？"
date: 2025-03-19T10:30:17Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
创建Seurat对象时忽略的两个参数竟然有这样的功能？ by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote><span></span><p><span leaf="">这两天分析一个单细胞数据发现一个奇怪的问题，就是创建 seurat 对象的时候，<span textstyle="">我明明设置了参数 CreateSeuratObject 函数的project 参数，但是最后merge 不同的样本后发现 orig.ident 这一列居然不是我设置的样本名！</span>来看看细节~</span></p></blockquote></section><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">分析的数据</span></span><span></span><span><span leaf=""> </span></span></h3><p data-tool="mdnice编辑器"><span leaf="">我分析的单细胞数据为急性肾功能损伤的组织样本，共13个样本。数据下载链接：https://ngdc.cncb.ac.cn/omix/release/OMIX004421</span></p><p data-tool="mdnice编辑器"><span leaf="">我这里有下载好的放在百度盘： https://pan.baidu.com/s/1DyWqfA5G3Q7cPDLNICXRxA?pwd=5s2q 提取码: 5s2q</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKre9NpJJHCicz15MpicEH8B3Ff1ALtA4aDdYoP1Vf32FMbmNIj9duHpjbNmaxMkFfHicBOEx89ibuWQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.4106699751861042" data-type="png" data-w="806" data-imgfileid="100055891" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKre9NpJJHCicz15MpicEH8B3Ff1ALtA4aDdYoP1Vf32FMbmNIj9duHpjbNmaxMkFfHicBOEx89ibuWQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">读取数据并创建Seurat对象</span></span><span></span><span><span leaf=""> </span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">###</span></span><span leaf=""><br></span><span><span leaf="">### Create: Jianming Zeng</span></span><span leaf=""><br></span><span><span leaf="">### Date:  2023-12-31  </span></span><span leaf=""><br></span><span><span leaf="">### Email: jmzeng1314@163.com</span></span><span leaf=""><br></span><span><span leaf="">### Blog: http://www.bio-info-trainee.com/</span></span><span leaf=""><br></span><span><span leaf="">### Forum:  http://www.biotrainee.com/thread-1376-1-1.html</span></span><span leaf=""><br></span><span><span leaf="">### CAFS/SUSTC/Eli Lilly/University of Macau</span></span><span leaf=""><br></span><span><span leaf="">### Update Log: 2023-12-31   First version </span></span><span leaf=""><br></span><span><span leaf="">### Update Log: 2024-12-09   by juan zhang (492482942@qq.com)</span></span><span leaf=""><br></span><span><span leaf="">### </span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span leaf="">library(dplyr) </span><span leaf=""><br></span><span leaf="">library(future)</span><span leaf=""><br></span><span leaf="">library(Seurat)</span><span leaf=""><br></span><span leaf="">library(clustree)</span><span leaf=""><br></span><span leaf="">library(cowplot)</span><span leaf=""><br></span><span leaf="">library(data.table)</span><span leaf=""><br></span><span leaf="">library(qs)</span><span leaf=""><br></span><span leaf="">library(Matrix)</span><span leaf=""><br></span><span leaf="">getwd()</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## read data</span></span><span leaf=""><br></span><span leaf="">samples &lt;- list.files(</span><span><span leaf="">"data/"</span></span><span leaf="">, recursive = F, full.names = F, pattern = </span><span><span leaf="">"txt"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">samples</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">scRNA_list &lt;- lapply(samples, </span><span><span leaf="">function</span></span><span leaf="">(pro){</span><span leaf=""><br></span><span><span leaf="">#pro &lt;- samples[1]</span></span><span leaf=""><br></span><span><span leaf="">print</span></span><span leaf="">(pro)</span><span leaf=""><br></span><span leaf="">  counts &lt;- fread(file = file.path(</span><span><span leaf="">"data/"</span></span><span leaf="">, pro), data.table = F)</span><span leaf=""><br></span><span leaf="">  counts[1:4,1:4]</span><span leaf=""><br></span><span leaf="">  rownames(counts) &lt;- counts[, 1]</span><span leaf=""><br></span><span leaf="">  counts &lt;- counts[, -1]</span><span leaf=""><br></span><span leaf="">  dim(counts)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 创建Seurat对象</span></span><span leaf=""><br></span><span leaf="">  sce &lt;- CreateSeuratObject(counts = counts, min.cells=3, project = gsub(</span><span><span leaf="">".txt"</span></span><span leaf="">,</span><span><span leaf="">""</span></span><span leaf="">, pro) )</span><span leaf=""><br></span><span><span leaf="">return</span></span><span leaf="">(sce)</span><span leaf=""><br></span><span leaf="">})</span><span leaf=""><br></span><span leaf="">names(scRNA_list) &lt;- gsub(</span><span><span leaf="">".txt"</span></span><span leaf="">,</span><span><span leaf="">""</span></span><span leaf="">, samples)</span><span leaf=""><br></span><span leaf="">scRNA_list</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## merge</span></span><span leaf=""><br></span><span leaf="">sce.all &lt;- merge(scRNA_list[[1]], y=scRNA_list[-1], add.cell.ids=gsub(</span><span><span leaf="">".txt"</span></span><span leaf="">,</span><span><span leaf="">""</span></span><span leaf="">, samples))</span><span leaf=""><br></span><span leaf="">sce.all &lt;- JoinLayers(sce.all) </span><span><span leaf=""># seurat v5</span></span><span leaf=""><br></span><span leaf="">sce.all</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 查看特征</span></span><span leaf=""><br></span><span leaf="">as.data.frame(sce.all@assays</span><span><span leaf="">$RNA</span></span><span><span leaf="">$counts</span></span><span leaf="">[1:10, 1:2])</span><span leaf=""><br></span><span leaf="">head(sce.all@meta.data, 10)</span><span leaf=""><br></span><span leaf="">table(sce.all</span><span><span leaf="">$orig</span></span><span leaf="">.ident) </span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">到这里</span><code><span leaf="">table(sce.all$orig.ident) </span></code><span leaf="">的时候，发现样本名字长这样：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">table(sce.all</span><span><span leaf="">$orig</span></span><span leaf="">.ident) </span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">   A1    A2    A3    A4    C1    C2    C3    C4    M1    M2    M3    S1    S4 </span><span leaf=""><br></span><span leaf=""> 6394  7621  8561  4780  6464  6432  7627 10443  7599  5756  8556 12940 10058</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">而我前面的 </span><code><span leaf="">samples</span></code><span leaf="">是这样的，创建对象的时候</span><code><span leaf="">sce &lt;- CreateSeuratObject(counts = counts, min.cells=3, project = gsub(".txt","", pro) )</span></code><span leaf=""> 设置了 project 参数，<span textstyle="">理论上 应为去掉了 txt 后缀后的文件名字，好诡异！</span></span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">&gt; samples</span><span leaf=""><br></span><span leaf=""> [1] </span><span><span leaf="">"IRI1d_1.txt"</span></span><span leaf=""> </span><span><span leaf="">"IRI1d_2.txt"</span></span><span leaf=""> </span><span><span leaf="">"IRI1d_3.txt"</span></span><span leaf=""> </span><span><span leaf="">"IRI1d_4.txt"</span></span><span leaf=""> </span><span><span leaf="">"IRI3d_1.txt"</span></span><span leaf=""> </span><span><span leaf="">"IRI3d_2.txt"</span></span><span leaf=""> </span><span><span leaf="">"IRI3d_3.txt"</span></span><span leaf=""> </span><span><span leaf="">"IRI3d_4.txt"</span></span><span leaf=""> </span><span><span leaf="">"MSC1.txt"</span></span><span leaf="">    </span><span><span leaf="">"MSC2.txt"</span></span><span leaf="">    </span><span><span leaf="">"MSC3.txt"</span></span><span leaf="">   </span><span leaf=""><br></span><span leaf="">[12] </span><span><span leaf="">"sham1.txt"</span></span><span leaf="">   </span><span><span leaf="">"sham2.txt"</span></span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">检查数据</span></span><span></span><span><span leaf=""> </span></span></h3><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">我反复检查我的数据，到底哪里出了问题，这几个样本名字难道是灵异事件，突然就出现了吗？</span></span></p><p data-tool="mdnice编辑器"><span leaf="">读一个数据看看：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pro &lt;- samples[1]</span><span leaf=""><br></span><span><span leaf="">print</span></span><span leaf="">(pro)</span><span leaf=""><br></span><span leaf="">counts &lt;- fread(file = file.path(</span><span><span leaf="">"data/"</span></span><span leaf="">, pro), data.table = F)</span><span leaf=""><br></span><span leaf="">counts[1:4,1:4]</span><span leaf=""><br></span><span leaf="">rownames(counts) &lt;- counts[, 1]</span><span leaf=""><br></span><span leaf="">counts &lt;- counts[, -1]</span><span leaf=""><br></span><span leaf="">dim(counts)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 创建Seurat对象</span></span><span leaf=""><br></span><span leaf="">sce &lt;- CreateSeuratObject(counts = counts, min.cells=3, project = gsub(</span><span><span leaf="">".txt"</span></span><span leaf="">,</span><span><span leaf="">""</span></span><span leaf="">, pro) )</span><span leaf=""><br></span><span leaf="">head(sce@meta.data)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">在 </span><code><span leaf="">counts[1:4,1:4]</span></code><span leaf=""> 这里看到了可疑的前缀：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKre9NpJJHCicz15MpicEH8BTXZZCuJpEHTeEF0HoL51Pht1D9wJhx8bf3ia7yeFSV5DnibsRFbTLdaQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.17703349282296652" data-type="png" data-w="627" data-imgfileid="100055888" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKre9NpJJHCicz15MpicEH8BTXZZCuJpEHTeEF0HoL51Pht1D9wJhx8bf3ia7yeFSV5DnibsRFbTLdaQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">这个地方还能跑到 project参数的值里面去！？？？就真的跑过去了！！！</span></span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKre9NpJJHCicz15MpicEH8BuWMwfU98OTZAMSPnbcrvzqYaCLwZUIGvBb4ic6ibpUPHBGxD4fFibd66Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.24152542372881355" data-type="png" data-w="708" data-imgfileid="100055889" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKre9NpJJHCicz15MpicEH8BuWMwfU98OTZAMSPnbcrvzqYaCLwZUIGvBb4ic6ibpUPHBGxD4fFibd66Q/640?wx_fmt=png&amp;from=appmsg"></span></figure><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">&gt; gsub(</span><span><span leaf="">".txt"</span></span><span leaf="">,</span><span><span leaf="">""</span></span><span leaf="">, pro)</span><span leaf=""><br></span><span leaf="">[1] </span><span><span leaf="">"IRI1d_1"</span></span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">CreateSeuratObject 这个函数做了什么？</span></span><span></span><span><span leaf=""> </span></span></h3><p data-tool="mdnice编辑器"><span leaf="">赶紧查看 </span><code><span leaf="">CreateSeuratObject </span></code><span leaf=""> 的帮助文档：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Create a Seurat object</span><span leaf=""><br></span><span leaf="">Description</span><span leaf=""><br></span><span leaf="">Create a Seurat object from raw data</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Usage</span><span leaf=""><br></span><span leaf="">CreateSeuratObject(</span><span leaf=""><br></span><span leaf="">  counts,</span><span leaf=""><br></span><span leaf="">  assay = </span><span><span leaf="">"RNA"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  names.field = 1,</span><span leaf=""><br></span><span leaf="">  names.delim = </span><span><span leaf="">"_"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  meta.data = NULL,</span><span leaf=""><br></span><span leaf="">  project = </span><span><span leaf="">"CreateSeuratObject"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  ...</span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Arguments</span><span leaf=""><br></span><span leaf="">counts </span><span leaf=""><br></span><span leaf="">Either a matrix-like object with unnormalized data with cells as columns and features as rows or an Assay-derived object</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">assay </span><span leaf=""><br></span><span leaf="">Name of the initial assay</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">names.field </span><span leaf=""><br></span><span leaf="">For the initial identity class </span><span><span leaf="">for</span></span><span leaf=""> each cell, choose this field from the cell</span><span><span leaf="">'s name. E.g. If your cells are named as BARCODE_CLUSTER_CELLTYPE in the input matrix, set names.field to 3 to set the initial identities to CELLTYPE.</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">names.delim </span><span leaf=""><br></span><span leaf="">For the initial identity class for each cell, choose this delimiter from the cell'</span></span><span leaf="">s column name. E.g. If your cells are named as BARCODE-CLUSTER-CELLTYPE, </span><span><span leaf="">set</span></span><span leaf=""> this to “-” to separate the cell name into its component parts </span><span><span leaf="">for</span></span><span leaf=""> picking the relevant field.</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">meta.data </span><span leaf=""><br></span><span leaf="">Additional cell-level metadata to add to the Seurat object. Should be a data.frame </span><span><span leaf="">where</span></span><span leaf=""> the rows are cell names and the columns are additional metadata fields. Row names </span><span><span leaf="">in</span></span><span leaf=""> the metadata need to match the column names of the counts matrix.</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">project </span><span leaf=""><br></span><span leaf="">Project name </span><span><span leaf="">for</span></span><span leaf=""> the Seurat object</span><span leaf=""><br></span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">这两个参数   </span><code><span leaf="">names.field = 1, names.delim = "_",</span></code><span leaf="">以往都被我忽略了，</span></p><p data-tool="mdnice编辑器"><span leaf="">如果我的细胞名字的命名方式是这样：BARCODE_CLUSTER_CELLTYPE，那可以设置 names.field 为这个字符 按照 这个 参数</span><code><span leaf="">names.delim</span></code><span leaf=""> 的模式进行分割，取第几列作为 project 的初始值</span></p><p data-tool="mdnice编辑器"><span leaf="">他们的默认是 恰好：</span><code><span leaf="">A1_AAACCCAAGAGTTGTA-1</span></code><span leaf="">，按照_分割，取第一列 A1出来 放到了 metadata中！</span></p><p data-tool="mdnice编辑器"><span leaf="">是不是很意外！</span></p><p data-tool="mdnice编辑器"><span leaf="">那我如果想要自己设置的那个project值呢？我设置 </span><code><span leaf="">names.field=0</span></code><span leaf="">，就可以了！</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 创建Seurat对象</span></span><span leaf=""><br></span><span leaf="">sce &lt;- CreateSeuratObject(counts = counts, min.cells=3, project = gsub(</span><span><span leaf="">".txt"</span></span><span leaf="">,</span><span><span leaf="">""</span></span><span leaf="">, pro), names.field=0 )</span><span leaf=""><br></span><span leaf="">head(sce@meta.data)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKre9NpJJHCicz15MpicEH8B6tTjqt7s1Wcj6zQmd0oibJVeqicK2k6icxTwtl7C06dyQdD6AeSEvh7ibg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.21454993834771888" data-type="png" data-w="811" data-imgfileid="100055890" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKre9NpJJHCicz15MpicEH8B6tTjqt7s1Wcj6zQmd0oibJVeqicK2k6icxTwtl7C06dyQdD6AeSEvh7ibg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">又是get到意外知识的一天！</span></span><span></span></h4><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">文末友情宣传</span></span><span></span><span><span leaf=""> </span></span></h3><ul><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247538467&amp;idx=1&amp;sn=aa5500b24a92b86355c242d02e742f1b&amp;scene=21#wechat_redirect"><span leaf="">生信入门&amp;数据挖掘线上直播课3月班</span></a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect"><span leaf="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247535760&amp;idx=2&amp;sn=1e02a2e982a046ecf6389231e6768d5b&amp;scene=21#wechat_redirect"><span leaf="">满足你生信分析计算需求的低价解决方案</span></a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247537192&amp;idx=1&amp;sn=f146eabfbd1faefe9d4c85fc68a7dca3&amp;scene=21#wechat_redirect"><span leaf="">掌握Python，解锁单细胞数据的无限可能</span></a></section></li></ul></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/gaKYlqSZKRvNUKeW_2xPzA",target="_blank" rel="noopener noreferrer">原文链接</a>
