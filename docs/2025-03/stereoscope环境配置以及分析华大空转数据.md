---
title: "stereoscope环境配置以及分析华大空转数据"
date: 2025-03-09T23:35:42Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
stereoscope环境配置以及分析华大空转数据 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span leaf="">stereoscope是一个python包，今天简单学习一下其基本使用。其软件网址：</span></p><blockquote><span></span><p><span leaf="">github： https://github.com/almaan/stereoscope</span></p><p><span leaf="">python：https://stereopy.readthedocs.io/en/latest/Tutorials/SquareBin_Clustering.html</span></p><p><span leaf="">发表的文章：Single-cell and spatial transcriptomics enables probabilistic inference of cell type topography</span></p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">1.示例数据：</span></span><span></span><span><span leaf=""> </span></span></h2><p data-tool="mdnice编辑器"><span leaf="">http://116.6.21.110:8090/share/3ca60300-e8bd-4d67-8b68-14267e428523</span></p><p data-tool="mdnice编辑器"><span leaf="">下载的时候可以安装一下华大的工具进行高通量下载，下载其中的：</span></p><p data-tool="mdnice编辑器"><span leaf="">速度飞一般的下载：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQwTibraKZKiaAMOfkQjUk1Nf01AY9bdpjOtgM2u7ichVrZQWqwG1SnBO6w/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.1597222222222222" data-type="png" data-w="576" data-imgfileid="100044790" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQwTibraKZKiaAMOfkQjUk1Nf01AY9bdpjOtgM2u7ichVrZQWqwG1SnBO6w/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">然后是解压：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">unzip SS200000135TL_D1.cellbin.gef.zip</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">报错：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Archive:  SS200000135TL_D1.cellbin.gef.zip</span><span leaf=""><br></span><span leaf="">replace SS200000135TL_D1.cellbin.gef? [y]es, [n]o, [A]ll, [N]one, [r]ename: y</span><span leaf=""><br></span><span leaf="">  inflating: SS200000135TL_D1.cellbin.gef</span><span leaf=""><br></span><span leaf="">error: invalid zip file with overlapped components (possible zip bomb)</span><span leaf=""><br></span><span leaf=""> To unzip the file anyway, rerun the </span><span><span leaf="">command</span></span><span leaf=""> with UNZIP_DISABLE_ZIPBOMB_DETECTION=TRUE environmnent variable</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">应该是系统提示风险文件，无论如何也要解压如下：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">UNZIP_DISABLE_ZIPBOMB_DETECTION=TRUE unzip SS200000135TL_D1.cellbin.gef.zip</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">成功！</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">2.环境配置：</span></span><span></span><span><span leaf=""> </span></span></h2><p data-tool="mdnice编辑器"><span leaf="">ref：https://stereopy.readthedocs.io/en/latest/content/00_Installation.html</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 创建一个小环境</span></span><span leaf=""><br></span><span leaf="">conda create --name st python=3.8 -y</span><span leaf=""><br></span><span leaf="">conda activate st</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 使用pip安装</span></span><span leaf=""><br></span><span leaf="">pip install stereopy -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</span><span leaf=""><br></span><span><span leaf=""># 使用 vscode的jupter插件</span></span><span leaf=""><br></span><span leaf="">pip install jupyterlab -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 查看一下安装的版本</span></span><span leaf=""><br></span><span leaf="">conda list stereopy</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">返回的是最新的：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># Name                    Version                   Build  Channel</span></span><span leaf=""><br></span><span leaf="">stereopy                  1.6.0                    pypi_0    pypi</span><span leaf=""><br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.运行</span></span><span></span><span><span leaf=""> </span></span></h2><p data-tool="mdnice编辑器"><span leaf="">参考：https://stereopy.readthedocs.io/en/latest/Tutorials/SquareBin_Clustering.html</span></p><p data-tool="mdnice编辑器"><span leaf="">https://github.com/STOmics/Stereopy/blob/main/docs/source/Tutorials/CellBin_Clustering.ipynb</span></p><p data-tool="mdnice编辑器"><span leaf="">数据和环境都准备好后，先来跟着示例数据跑一跑基础分析。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.1 先导入包：</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">import</span></span><span leaf=""> stereo </span><span><span leaf="">as</span></span><span leaf=""> st</span><span leaf=""><br></span><span><span leaf="">import</span></span><span leaf=""> warnings</span><span leaf=""><br></span><span leaf="">warnings.filterwarnings(</span><span><span leaf="">'ignore'</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 查看软件版本</span></span><span leaf=""><br></span><span leaf="">st.__version__</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.2 读取数据：</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data_path = </span><span><span leaf="">'SS200000135TL_D1.cellbin.gef'</span></span><span leaf=""><br></span><span leaf="">st.io.read_gef_info(data_path)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">日志如下：文件总共有57133个细胞，24670个基因</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1554][INFO]: This is GEF file </span><span><span leaf="">which</span></span><span leaf=""> contains cell bin infomation.</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1555][INFO]: bin_type: cell_bins</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1561][INFO]: Number of cells: 57133</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1564][INFO]: Number of gene: 24670</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1567][INFO]: Resolution: 500</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1570][INFO]: offsetX: 0</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1573][INFO]: offsetY: 0</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1576][INFO]: Average number of genes: 223.460693359375</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1579][INFO]: Maximum number of genes: 1046</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1582][INFO]: Average expression: 399.17034912109375</span><span leaf=""><br></span><span leaf="">[2025-03-07 17:04:01][Stereo][1600373][MainThread][139680589878272][reader][1585][INFO]: Maximum expression: 2337</span><span leaf=""><br></span><span leaf="">2025-03-07 17:04:01 [INFO   ] version is 0.7.14</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">创建 SterpExpData 对象：注意设置 bin_type 参数</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data = st.io.read_gef(file_path=data_path, bin_type=</span><span><span leaf="">'cell_bins'</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># simply type the varibale to get related information</span></span><span leaf=""><br></span><span leaf="">data</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">这个对象的结构如下：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">StereoExpData object with n_cells X n_genes = 57133 X 24670</span><span leaf=""><br></span><span leaf="">bin_type: cell_bins</span><span leaf=""><br></span><span leaf="">offset_x = None</span><span leaf=""><br></span><span leaf="">offset_y = None</span><span leaf=""><br></span><span leaf="">cells: [</span><span><span leaf="">'cell_name'</span></span><span leaf="">, </span><span><span leaf="">'dnbCount'</span></span><span leaf="">, </span><span><span leaf="">'area'</span></span><span leaf="">]</span><span leaf=""><br></span><span leaf="">genes: [</span><span><span leaf="">'gene_name'</span></span><span leaf="">]</span><span leaf=""><br></span><span leaf="">cells_matrix = [</span><span><span leaf="">'cell_border'</span></span><span leaf="">, </span><span><span leaf="">'spatial'</span></span><span leaf="">]</span><span leaf=""><br></span><span leaf="">Layers with keys: </span><span leaf=""><br></span><span leaf="">tl.result: []</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.3 数据预处理</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">预处理包括三部分：质控，过滤以及标准化。</span></p><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.3.1 质控</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">这里计算原始数据的三个指标：</span></p><ul><li><section><p><span leaf="">total_counts -每个细胞的总count数;</span></p></section></li><li><section><p><span leaf="">n_genes_by_counts - 每个细胞中表达的基因数;</span></p></section></li><li><section><p><span leaf="">pct_countss_mt -每个细胞中表达的线粒体基因比例.</span></p></section></li></ul><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data.tl.cal_qc()</span><span leaf=""><br></span><span leaf="">data.cells</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">得到的指标：</span></p><table><thead><tr><th><section><span leaf=""><br></span></section></th><th><section><span leaf="">dnbCount</span></section></th><th><section><span leaf="">area</span></section></th><th><section><span leaf="">total_counts</span></section></th><th><section><span leaf="">n_genes_by_counts</span></section></th><th><section><span leaf="">pct_counts_mt</span></section></th></tr></thead><tbody><tr><th><section><span leaf="">31679678781665</span></section></th><td><section><span leaf="">30</span></section></td><td><section><span leaf="">248</span></section></td><td><section><span leaf="">48</span></section></td><td><section><span leaf="">26</span></section></td><td><section><span leaf="">0.000000</span></section></td></tr><tr><th><section><span leaf="">31696858650867</span></section></th><td><section><span leaf="">66</span></section></td><td><section><span leaf="">237</span></section></td><td><section><span leaf="">86</span></section></td><td><section><span leaf="">55</span></section></td><td><section><span leaf="">1.162791</span></section></td></tr><tr><th><section><span leaf="">31546534795506</span></section></th><td><section><span leaf="">156</span></section></td><td><section><span leaf="">336</span></section></td><td><section><span leaf="">209</span></section></td><td><section><span leaf="">127</span></section></td><td><section><span leaf="">1.435407</span></section></td></tr><tr><th><section><span leaf="">31804232833272</span></section></th><td><section><span leaf="">120</span></section></td><td><section><span leaf="">334</span></section></td><td><section><span leaf="">175</span></section></td><td><section><span leaf="">108</span></section></td><td><section><span leaf="">1.142857</span></section></td></tr><tr><th><section><span leaf="">32779190409382</span></section></th><td><section><span leaf="">64</span></section></td><td><section><span leaf="">529</span></section></td><td><section><span leaf="">85</span></section></td><td><section><span leaf="">53</span></section></td><td><section><span leaf="">0.000000</span></section></td></tr><tr><th><section><span leaf="">...</span></section></th><td><section><span leaf="">...</span></section></td><td><section><span leaf="">...</span></section></td><td><section><span leaf="">...</span></section></td><td><section><span leaf="">...</span></section></td><td><section><span leaf="">...</span></section></td></tr><tr><th><section><span leaf="">33105607937026</span></section></th><td><section><span leaf="">154</span></section></td><td><section><span leaf="">526</span></section></td><td><section><span leaf="">211</span></section></td><td><section><span leaf="">119</span></section></td><td><section><span leaf="">2.369668</span></section></td></tr><tr><th><section><span leaf="">33208687152235</span></section></th><td><section><span leaf="">5</span></section></td><td><section><span leaf="">37</span></section></td><td><section><span leaf="">10</span></section></td><td><section><span leaf="">5</span></section></td><td><section><span leaf="">20.000000</span></section></td></tr><tr><th><section><span leaf="">32993938787532</span></section></th><td><section><span leaf="">141</span></section></td><td><section><span leaf="">651</span></section></td><td><section><span leaf="">195</span></section></td><td><section><span leaf="">100</span></section></td><td><section><span leaf="">1.025641</span></section></td></tr><tr><th><section><span leaf="">32534377286979</span></section></th><td><section><span leaf="">72</span></section></td><td><section><span leaf="">547</span></section></td><td><section><span leaf="">91</span></section></td><td><section><span leaf="">52</span></section></td><td><section><span leaf="">0.000000</span></section></td></tr><tr><th><section><span leaf="">32074815786262</span></section></th><td><section><span leaf="">178</span></section></td><td><section><span leaf="">524</span></section></td><td><section><span leaf="">240</span></section></td><td><section><span leaf="">130</span></section></td><td><section><span leaf="">6.250000</span></section></td></tr></tbody></table><p data-tool="mdnice编辑器"><span leaf="">57133 rows × 5 columns</span></p><p data-tool="mdnice编辑器"><span leaf="">使用小提琴可视化这三个指标：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data.plt.violin()</span><span leaf=""><br></span></code></pre><blockquote><span></span><p><span leaf="">报第一个错：缺一个模块 jupyter_bokeh</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">安装它：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">conda install bokeh::jupyter_bokeh -y</span><span leaf=""><br></span></code></pre><blockquote><span></span><p><span leaf="">又报了一个错：ImportError: cannot import name 'warn' from 'bokeh.util.warnings'</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">原因是：stereopy 1.6.0 requires bokeh==2.4.3, but you have bokeh 3.1.1 which is incompatible.</span></p><p data-tool="mdnice编辑器"><span leaf="">安装吧：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pip install bokeh==2.4.3 -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">连环报错：</span></p><blockquote><span></span><p><span leaf="">ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts. jupyter-bokeh 4.0.5 requires bokeh==3.*, but you have bokeh 2.4.3 which is incompatible.</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">这不是陷入死循环了吗！额。上面的那个安装一个低版本看看：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">conda install  bokeh::jupyter_bokeh=3.0.5 -y</span><span leaf=""><br></span><span leaf="">pip install bokeh==2.4.3 -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">成功，绘图结果如下：<span textstyle="">有点不是很能理解为什么画一个坐标上....你看线粒体那个比例你能看得到信息吗？？？</span></span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQJ2FO4CicjlRZF3DuC0WWSlflo3MTgWZEmgfxXiaDMh6PgqnINuuibS8iaQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6742209631728046" data-type="png" data-w="706" data-imgfileid="100044787" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQJ2FO4CicjlRZF3DuC0WWSlflo3MTgWZEmgfxXiaDMh6PgqnINuuibS8iaQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">在空间切片上的分布：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data.plt.spatial_scatter()</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQ0vrlhpIUd2K266zmicYSiaLFVqLxtzsv2uN5ETwTfPOOiblDaadGDQBibg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5759007678676905" data-type="png" data-w="1693" data-imgfileid="100044791" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQ0vrlhpIUd2K266zmicYSiaLFVqLxtzsv2uN5ETwTfPOOiblDaadGDQBibg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.3.2 过滤</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">过滤对应指标的三个函数为：</span><code><span leaf="">data.tl.filter_cells</span></code><span leaf="">, </span><code><span leaf="">data.tl.filter_genes</span></code><span leaf="">, </span><code><span leaf="">data.tl.filter_coordinates</span></code><span leaf="">.</span></p><p data-tool="mdnice编辑器"><span leaf="">移除表达线粒体基因过多、表达基因不足以及超出范围的细胞：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data.tl.filter_cells(</span><span leaf=""><br></span><span leaf="">        min_counts=</span><span><span leaf="">200</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">        min_genes=</span><span><span leaf="">3</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">        max_genes=</span><span><span leaf="">2500</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">        pct_counts_mt=</span><span><span leaf="">5</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">        inplace=</span><span><span leaf="">True</span></span><span leaf=""><br></span><span leaf="">        )</span><span leaf=""><br></span><span leaf="">data</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">过滤后的：StereoExpData object with n_cells X n_genes = 41948 X 24670</span></p><p data-tool="mdnice编辑器"><span leaf="">过滤完后可以保存一下原始表达矩阵，用于后续的其他分析如差异表达分析等</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data.tl.raw_checkpoint()</span><span leaf=""><br></span><span leaf="">data.tl.raw</span><span leaf=""><br></span><span><span leaf=""># 可使用 data.tl.reset_raw_data() 取回原始数据</span></span><span leaf=""><br></span></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.3.3 标准化</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">在这个分析步骤，标准化方法如下：经常做分析的应该对这几个方法已经非常熟悉了</span></p><ul><li><section><span leaf="">normalize_total (https://www.nature.com/articles/nbt.3192)</span></section></li><li><section><span leaf="">log1p (https://academic.oup.com/bioinformatics/article/37/15/2223/6155989)</span></section></li><li><section><span leaf="">scale</span></section></li><li><section><span leaf="">scTransform (https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1874-1)</span></section></li><li><section><span leaf="">quantile (https://github.com/panjie-payne/test-sphinx/blob/master/docs/source/_static/quantile.pdf)</span></section></li></ul><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># inplace is set to True by default</span></span><span leaf=""><br></span><span leaf="">data.tl.normalize_total()</span><span leaf=""><br></span><span leaf="">data.tl.log1p()</span><span leaf=""><br></span><span leaf="">data.tl.highly_variable_genes(</span><span leaf=""><br></span><span leaf="">            min_mean=</span><span><span leaf="">0.0125</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">            max_mean=</span><span><span leaf="">3</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">            min_disp=</span><span><span leaf="">0.5</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">            n_top_genes=</span><span><span leaf="">2000</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">            res_key=</span><span><span leaf="">'highly_variable_genes'</span></span><span leaf=""><br></span><span leaf="">            )</span><span leaf=""><br></span><span leaf="">data.tl.scale()</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">高变基因鉴定结果可视化：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 可视化：</span></span><span leaf=""><br></span><span leaf="">data.plt.highly_variable_genes(res_key=</span><span><span leaf="">'highly_variable_genes'</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQV9cn5s4Llhv7q0rKvJyh5ibSfJAv6hRf8mibLjBw8IGmetYCRpwMlaKA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5631336405529954" data-type="png" data-w="1085" data-imgfileid="100044789" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQV9cn5s4Llhv7q0rKvJyh5ibSfJAv6hRf8mibLjBw8IGmetYCRpwMlaKA/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.4 PCA降维，聚类分群以及UMAP</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data.tl.pca(</span><span leaf=""><br></span><span leaf="">        use_highly_genes=</span><span><span leaf="">True</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">        n_pcs=</span><span><span leaf="">30</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">        res_key=</span><span><span leaf="">'pca'</span></span><span leaf=""><br></span><span leaf="">        )</span><span leaf=""><br></span><span leaf="">data.plt.elbow(pca_res_key=</span><span><span leaf="">'pca'</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">data.tl.neighbors(pca_res_key=</span><span><span leaf="">'pca'</span></span><span leaf="">, res_key=</span><span><span leaf="">'neighbors'</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">data.tl.umap(</span><span leaf=""><br></span><span leaf="">        pca_res_key=</span><span><span leaf="">'pca'</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">        neighbors_res_key=</span><span><span leaf="">'neighbors'</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">        res_key=</span><span><span leaf="">'umap'</span></span><span leaf=""><br></span><span leaf="">        )</span><span leaf=""><br></span><span leaf="">data.tl.leiden(neighbors_res_key=</span><span><span leaf="">'neighbors'</span></span><span leaf="">,res_key=</span><span><span leaf="">'leiden'</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">看一下两个基因的umap分布：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># plot the umap result of two genes: 'Atpif1' and 'Tmsb4x' </span></span><span leaf=""><br></span><span leaf="">data.plt.umap(gene_names=[</span><span><span leaf="">'Atpif1'</span></span><span leaf="">, </span><span><span leaf="">'Tmsb4x'</span></span><span leaf="">], res_key=</span><span><span leaf="">'umap'</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQznHZoHEZRaz1Nfbpno6qojOy4icwq0aLjqRibTUQ652TIK9jyLIk6d8w/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.42073897497020263" data-type="png" data-w="1678" data-imgfileid="100044788" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQznHZoHEZRaz1Nfbpno6qojOy4icwq0aLjqRibTUQ652TIK9jyLIk6d8w/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">空间聚类结果分布：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data.plt.cluster_scatter(res_key=</span><span><span leaf="">'leiden'</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQibBic3bMkgjz9kr9DfSDj5x2mNbKCnKkWtoagicp2Z5GQkiacGkgicHCKGQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.0759330759330759" data-type="png" data-w="777" data-imgfileid="100044796" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTlaGVibfgPqGqic6S1z9bicwQibBic3bMkgjz9kr9DfSDj5x2mNbKCnKkWtoagicp2Z5GQkiacGkgicHCKGQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">一份华大的空转数据基础分析到这里就完成了~</span></p><h3 data-tool="mdnice编辑器"><span></span><span><strong><span leaf="">文末友情宣传</span></strong></span><span></span></h3><ul><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247538467&amp;idx=1&amp;sn=aa5500b24a92b86355c242d02e742f1b&amp;scene=21#wechat_redirect"><span leaf="">生信入门&amp;数据挖掘线上直播课3月班</span></a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect"><span leaf="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247535760&amp;idx=2&amp;sn=1e02a2e982a046ecf6389231e6768d5b&amp;scene=21#wechat_redirect"><span leaf="">满足你生信分析计算需求的低价解决方案</span></a></section></li></ul></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/xOuDCD6YgXa9ph7VqJ2-Aw",target="_blank" rel="noopener noreferrer">原文链接</a>
