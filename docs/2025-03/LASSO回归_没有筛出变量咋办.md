---
title: "LASSO回归 没有筛出变量咋办"
date: 2025-03-09T07:39:47Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
LASSO回归 没有筛出变量咋办 by 生信菜鸟团
------
<div><ol><li><h3 data-start="641" data-end="676"><span><strong data-start="645" data-end="676"><strong data-start="645" data-end="676"><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247488779&amp;idx=1&amp;sn=c094048908f247f3f62d18cfd8a50461&amp;scene=21#wechat_redirect" textvalue="转录组二分类结局——lasso回归实战" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">转录组二分类结局——lasso回归实战</a></span><span leaf=""><br></span></strong></strong></span></h3></li><li><h3><span><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247488686&amp;idx=1&amp;sn=f354f3e629bc516e60c5386b7f3f1c79&amp;scene=21#wechat_redirect" textvalue="LASSO筛选变量、构建Logistic回归模型绘制列线图" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">LASSO筛选变量、构建Logistic回归模型绘制列线图</a></span><span leaf=""><br></span></span></h3></li><li><section><span><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247483655&amp;idx=1&amp;sn=17ecdd07b9ce16aab08c90de825e904c&amp;scene=21#wechat_redirect" textvalue="lasso回归筛选变量_如何进行高维变量筛选和特征选择(一)？Lasso回归" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">lasso回归筛选变量_如何进行高维变量筛选和特征选择(一)？Lasso回归</a></span></span><span leaf=""><br></span></section></li><li><section><span><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247488630&amp;idx=1&amp;sn=81f064a4824355835f916d4e16ff2f21&amp;scene=21#wechat_redirect" textvalue="LASSO-Cox 回归分析（Cox proportional hazards model）" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">LASSO-Cox 回归分析（Cox proportional hazards model）</a></span><hr><p><span leaf=""><br></span></p></span></section></li></ol><h3 data-start="641" data-end="676"><span><strong data-start="645" data-end="676"><strong data-start="645" data-end="676"><span leaf="">📌 1. LASSO 回归筛不出 非零系数</span></strong></strong></span></h3><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>getwd</span>()</span></code><code><span leaf=""><span>mypath</span>=<span>"~/MAFLD-AD/MAFLD/GSE183229/lasso"</span></span></code><code><span leaf=""><span>dir</span>.create(mypath)</span></code><code><span leaf=""><span>setwd</span>(mypath)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>#1假设你的RNA-seq数据存储在矩阵dat中，使得行为样本，列为基因------</span></span></code><code><span leaf=""><span>#同时你有一个向量outcome包含每个样本的二分类结局变量（通常是0和1）。</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>load</span>(<span>"~/MAFLD-AD/MAFLD/GSE183229/gse183229.rdata"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>dat</span>=    log1p(raw_data)</span></code><code><span leaf=""><span>group_list</span>=sample_info</span></code><code><span leaf=""><span>group_list</span>$mygroup= ifelse(grepl(pattern = <span>"FLD"</span>,x = group_list$Group),yes = <span>1</span>,no = <span>0</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>dat</span>[<span>1</span>:<span>9</span>,<span>1</span>:<span>9</span>]</span></code><code><span leaf=""><span>group_list</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>outcome</span>=group_list$mygroup</span></code><code><span leaf=""><br></span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sku2licOKKdicKoOrbVODCcRLxKrDqibLFiaJZClvxTfZo2xDeibRyAR4EmYOFJ7lAKWnFN39dIHDdRSzxQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5136417556346382" data-s="300,640" data-type="png" data-w="843" data-imgfileid="100005122" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sku2licOKKdicKoOrbVODCcRLxKrDqibLFiaJZClvxTfZo2xDeibRyAR4EmYOFJ7lAKWnFN39dIHDdRSzxQ/640?wx_fmt=png&amp;from=appmsg"></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>#2使用glmnet函数拟合Lasso模型，并通过交叉验证找到最优的lambda值。对于二分类结局变量，需要指定family="binomial"------</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 将数据转换为矩阵格式</span></span></code><code><span leaf=""><span>x</span> &lt;- as.matrix(t(dat)) ;dim(x)</span></code><code><span leaf=""><span>y</span> &lt;- outcome ;length(y)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 3使用交叉验证拟合Lasso模型----</span></span></code><code><span leaf=""><span>library</span>(glmnet)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>alpha1_fit</span> &lt;- glmnet(x,y,alpha=<span>1</span>,family=<span>"binomial"</span>)</span></code><code><span leaf=""><span>plot</span>(alpha1_fit,xvar=<span>"lambda"</span>,label=F)</span></code><code><span leaf=""><br></span></code></pre></section><pre tabindex="0" aria-label="Console Output" role="document"><span tabindex="-1" role="document"><span><span leaf="">&gt; </span></span><span><span leaf="">alpha1_fit &lt;- glmnet(x,y,alpha=1,family="binomial")</span><span leaf=""><br></span></span><span><span leaf="">Warning message:</span><span leaf=""><br></span><span leaf="">In lognet(xd, is.sparse, ix, jx, y, weights, offset, alpha, nobs,  :</span><span leaf=""><br></span><span leaf="">  one multinomial or binomial class has fewer than 8  observations; dangerous ground</span></span></span></pre><p><strong><span><span leaf="">这样最后往往都筛选不到变量，这个时候怎么办呢？</span></span></strong></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sku2licOKKdicKoOrbVODCcRLxlPK8hYpoBxiaK4bv8KCVPsfaWc9QYTBdwiccp3H9g4Y9O6s8iaxtSIwlA/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.054726368159204" data-s="300,640" data-type="png" data-w="402" data-imgfileid="100005133" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sku2licOKKdicKoOrbVODCcRLxlPK8hYpoBxiaK4bv8KCVPsfaWc9QYTBdwiccp3H9g4Y9O6s8iaxtSIwlA/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf="">这样的图就很诡异！</span><strong><span></span></strong></p><hr><h3 data-start="641" data-end="676"><strong data-start="645" data-end="676"><span leaf="">📌 2. LASSO 回归筛不出非 0 系数怎么办？</span></strong></h3><p data-start="677" data-end="703"><span leaf="">你的 LASSO 没有选出变量，主要有几个可能原因：</span></p><ol><li><p data-start="708" data-end="734"><strong data-start="708" data-end="732"><span leaf="">样本量太小，相比变量数（基因数）严重不足</span></strong></p></li></ol><ul><li><p><strong data-start="866" data-end="876"><span leaf="">减少基因数量</span></strong><span leaf="">（如先进行方差过滤或基因选择）</span></p></li><li><p><strong data-start="899" data-end="908"><span leaf="">增加样本量</span></strong></p></li></ul><ul><li><p><span leaf="">你的数据 </span><code data-start="745" data-end="766"><span leaf="">dim(x) = 16 × 16293</span></code><span leaf="">，也就是说 </span><strong data-start="772" data-end="795"><span leaf="">样本只有 16，变量却有 16,293</span></strong><span leaf="">，维度严重失衡。</span></p></li><li><p><span leaf="">LASSO 适用于高维数据，但仍然需要</span><strong data-start="828" data-end="838"><span leaf="">一定的样本量</span></strong><span leaf="">来训练稳定的模型。</span></p></li></ul><li><p><span><span leaf="">解决方案：</span></span></p></li><li><p data-start="913" data-end="936"><strong data-start="913" data-end="934"><span leaf="">LASSO 的正则化强度 λ 过大</span></strong></p></li><ul><li><p><span leaf="">你使用的是 </span><code data-start="948" data-end="960"><span leaf="">lambda.min</span></code><span leaf="">，可能会导致所有系数趋近于 0。可以尝试 </span><code data-start="981" data-end="993"><span leaf="">lambda.1se</span></code><span leaf="">，或者人为选择较小的 λ。</span></p></li><li><p><span leaf="">解决方案：</span></p></li></ul><li><section><ul><li></ul><pre data-lang="nginx"><code><span leaf=""><span>best_lambda</span> &lt;- cvfit<span>$lambda</span>.1se  <span># 试试这个</span></span></code></pre></section><p><span leaf=""><br></span></p><p data-start="1086" data-end="1103"><strong data-start="1086" data-end="1103"><span leaf="">类别不均衡（不平衡数据集）</span></strong></p><p><span leaf=""><br></span></p><ul><li><p><span leaf="">你的 </span><code data-start="1112" data-end="1115"><span leaf="">y</span></code><span leaf=""> 值是 </span><code data-start="1119" data-end="1154"><span leaf="">[1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0]</span></code><span leaf="">，两个类别的样本数接近但仍然偏少。</span></p></li><li><p><span leaf="">LASSO 可能无法有效捕捉区分两类的变量。</span></p></li></ul></li><li><p data-start="1204" data-end="1234"><strong data-start="1204" data-end="1232"><span leaf="">RNA-seq 数据未进行标准化或 log 转换</span></strong></p></li><ul><li><p><strong data-start="1240" data-end="1279"><span leaf="">未 log 转换的原始 RNA-seq 计数数据可能影响模型选择变量！</span></strong></p></li><li><p><span leaf="">解决方案：</span></p></li></ul><li><section><ul><li><li></ul><pre data-lang="cs"><code><span leaf="">log_dat &lt;- log2(dat + <span>1</span>)  <span># 进行 log2 变换</span></span></code><code><span leaf="">x &lt;- <span>as</span>.matrix(t(log_dat))  <span># 重新转换成样本 x 基因</span></span></code></pre></section><p><code><span leaf=""><br></span></code></p></li><hr><h3 data-start="1408" data-end="1442"><strong data-start="1412" data-end="1442"><span leaf="">📌 3. LASSO 没筛出变量，改用其他等效方法</span></strong></h3><p data-start="1443" data-end="1472"><span><span leaf="">如果 LASSO 无法选出变量，可以尝试其他特征选择方法。</span></span></p><h4 data-start="1474" data-end="1502"><span><strong data-start="1479" data-end="1502"><span leaf="">✅ 方法 1：先用方差过滤，减少变量数</span></strong></span></h4><p data-start="1503" data-end="1542"><span leaf="">LASSO 可能无法有效处理 16,293 个变量，因此先过滤掉低变异的基因</span></p><section><ul><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 计算每个基因的标准差gene_variance &lt;- apply(x, 2, sd)</span></span></code><code><span leaf=""><span>filtered_genes</span> &lt;- names(gene_variance[gene_variance &gt; quantile(gene_variance, <span>0</span>.<span>75</span>)])  # 选取变异度最高的 <span>25</span>%</span></code><code><span leaf=""><span>x_filtered</span> &lt;- x[, filtered_genes]  # 只保留变异大的基因然后再进行 LASSO 选择。</span></code></pre></section><hr><h4 data-start="1769" data-end="1809"><strong data-start="1774" data-end="1809"><span leaf="">✅ 方法 2：使用 </span><code data-start="1786" data-end="1800"><span leaf="">randomForest</span></code><span leaf=""> 进行特征选择</span></strong></h4><p data-start="1810" data-end="1825"><span leaf="">随机森林可以帮助识别重要变量：</span></p><pre data-start="1826" data-end="2080"><p><span leaf=""><br></span></p></pre><section><ul><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>library</span>(randomForest)rf_model &lt;- randomForest(x, as.factor(y), importance = TRUE)</span></code><code><span leaf=""><span>importance_scores</span> &lt;- importance(rf_model)</span></code><code><span leaf=""><span>selected_genes_rf</span> &lt;- rownames(importance_scores)[order(importance_scores[, <span>1</span>], decreasing = TRUE)][<span>1</span>:<span>30</span>]  # 选取前 <span>30</span> 个重要基因然后可以用这些基因重新进行 LASSO。</span></code></pre></section><hr><h4 data-start="2108" data-end="2142"><span><strong data-start="2113" data-end="2142"><span leaf="">✅ 方法 3：使用 </span></strong><strong data-start="2113" data-end="2142"><code data-start="2125" data-end="2133"><span leaf="">boruta</span></code><span leaf=""> 进行特征选择</span></strong></span></h4><p data-start="2143" data-end="2167"><code data-start="2143" data-end="2151"><span leaf="">Boruta</span></code><span leaf=""> 是基于随机森林的特征选择方法</span></p><section><ul><li><li></ul><pre data-lang="php"><code><span leaf=""><span>library</span>(Boruta)boruta_result &lt;- <span>Boruta</span>(x, <span>as</span>.<span>factor</span>(y), doTrace = <span>2</span>)</span></code><code><span leaf="">final_features &lt;- <span>getSelectedAttributes</span>(boruta_result, withTentative = <span>TRUE</span>)  <span># 选取稳定的重要变量然后再用这些基因进行 LASSO。</span></span></code></pre></section><hr><h3 data-start="2361" data-end="2386"><strong data-start="2365" data-end="2386"><span leaf="">📌 4. 代码优化版（完整流程）</span></strong></h3><p data-start="2387" data-end="2400"><strong data-start="2387" data-end="2400"><span leaf="">1️⃣ 预处理数据</span></strong></p><pre data-start="2401" data-end="2688"><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 进行 log2 变换</span></span></code><code><span leaf=""><span>log_dat</span> &lt;- log2(dat + <span>1</span>)</span></code><code><span leaf=""><span>x</span> &lt;- as.matrix(t(log_dat))</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 计算基因方差，并过滤低变异基因</span></span></code><code><span leaf=""><span>gene_variance</span> &lt;- apply(x, <span>2</span>, sd)</span></code><code><span leaf=""><span>filtered_genes</span> &lt;- names(gene_variance[gene_variance &gt; quantile(gene_variance, <span>0</span>.<span>75</span>)])</span></code><code><span leaf=""><span>x_filtered</span> &lt;- x[, filtered_genes]  # 仅保留变异高的基因</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 确保数据维度合理</span></span></code><code><span leaf=""><span>dim</span>(x_filtered)</span></code></pre></section><p><code><span leaf=""><br></span></code></p></pre><p data-start="2690" data-end="2706"><strong data-start="2690" data-end="2706"><span leaf="">2️⃣ 进行 LASSO</span></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>library</span>(glmnet)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 进行 LASSO 交叉验证</span></span></code><code><span leaf=""><span>set</span>.seed(<span>123</span>)</span></code><code><span leaf=""><span>cvfit</span> &lt;- cv.glmnet(x_filtered, y, alpha = <span>1</span>, family = <span>"binomial"</span>, nfolds = <span>5</span>)</span></code><code><span leaf=""><span>best_lambda</span> &lt;- cvfit$lambda.<span>1</span>se  # 选择更稳健的 λ</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 重新拟合 LASSO</span></span></code><code><span leaf=""><span>lasso_model</span> &lt;- glmnet(x_filtered, y, alpha = <span>1</span>, family = <span>"binomial"</span>, lambda = best_lambda)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 提取非零系数</span></span></code><code><span leaf=""><span>selected_genes</span> &lt;- rownames(coef(lasso_model))[-<span>1</span>][coef(lasso_model)[-<span>1</span>] != <span>0</span>]</span></code><code><span leaf=""><span>coef_values</span> &lt;- coef(lasso_model)[-<span>1</span>][coef(lasso_model)[-<span>1</span>] != <span>0</span>]</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 画图</span></span></code><code><span leaf=""><span>library</span>(ggplot2)</span></code><code><span leaf=""><span>coef_df</span> &lt;- data.frame(Gene = selected_genes, Coefficient = coef_values, row.names = NULL)</span></code><code><span leaf=""><span>ggplot</span>(coef_df, aes(x = reorder(Gene, Coefficient), y = Coefficient)) +</span></code><code><span leaf="">  <span>geom_bar</span>(stat = <span>"identity"</span>, fill = <span>"blue"</span>) +</span></code><code><span leaf="">  <span>coord_flip</span>() +</span></code><code><span leaf="">  <span>theme_minimal</span>() +</span></code><code><span leaf="">  <span>labs</span>(title = <span>"LASSO Selected Features (Binary Outcome)"</span>, x = <span>"Genes"</span>, y = <span>"Coefficient"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code></pre></section><p><span leaf=""><br></span></p><p><strong data-start="3513" data-end="3525"><span leaf="">📌 5. 总结</span></strong></p><p data-start="3526" data-end="3596"><span leaf="">✅ </span><strong data-start="3528" data-end="3550"><span leaf="">RNA-seq 需要 log2 转换</span></strong><span leaf="">，否则 LASSO 会受到极端值影响。</span><span leaf=""><br></span><span leaf="">✅ </span><strong data-start="3574" data-end="3592"><span leaf="">如果 LASSO 没选出变量</span></strong><span leaf="">，可以：</span></p><ul><li><p><span leaf="">过滤低变异基因，减少维度</span></p></li><li><p><span leaf="">选择更合适的 λ（</span><code data-start="3629" data-end="3641"><span leaf="">lambda.1se</span></code><span leaf=""> 而非 </span><code data-start="3645" data-end="3657"><span leaf="">lambda.min</span></code><span leaf="">）</span></p></li><li><p><span leaf="">使用 </span><code data-start="3667" data-end="3681"><span leaf="">randomForest</span></code><span leaf=""> 或 </span><code data-start="3684" data-end="3692"><span leaf="">Boruta</span></code><span leaf=""> 进行特征选择</span><span leaf=""><br></span><span leaf="">✅ </span><strong data-start="3704" data-end="3726"><span leaf="">样本数太少时，LASSO 可能不稳定</span></strong><span leaf="">，建议：</span></p></li><li><p><span leaf="">增加样本</span></p></li><li><p><span leaf="">使用交叉验证调优参数</span></p></li><li><p><span leaf="">结合其他方法（如 </span><code data-start="3771" data-end="3785"><span leaf="">randomForest</span></code><span leaf="">）选出重要变量后再用 LASSO 进一步筛选</span></p></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/WeJvhgxkO4ffeijBh8L5Hg",target="_blank" rel="noopener noreferrer">原文链接</a>
