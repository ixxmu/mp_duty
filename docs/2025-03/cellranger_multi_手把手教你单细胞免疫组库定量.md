---
title: "cellranger multi—手把手教你单细胞免疫组库定量"
date: 2025-03-20T00:20:59Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
cellranger multi—手把手教你单细胞免疫组库定量 by 生信菜鸟团
------
<div><section data-md5="d93a6" act="xmy"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><p data-md5="d93a6"><strong data-md5="d93a6"><span leaf="">工欲善其事 必先利其器</span></strong></p></section></section></section></section></section></section></section><p><span leaf=""><br></span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">单细胞免疫组库</span></span><span></span></h2><p data-tool="mdnice编辑器"><strong><span leaf="">单细胞免疫组库</span></strong><span leaf=""> 是一种基于单细胞测序技术的高精度研究方法，用于解析免疫细胞（如T细胞、B细胞）的抗原受体（TCR/BCR）序列及其转录组特征。传统bulk测序无法揭示细胞异质性，而单细胞技术可精准识别克隆型分布、分化轨迹及功能状态，为免疫机制研究提供分子级分辨率。</span></p><p data-tool="mdnice编辑器"><span leaf="">10X  Genomics 通过其Chromium平台开发了专为免疫组库设计的解决方案（如10x Chromium Single-Cell V(D)J Assay），可在单细胞层面同时获取全长配对 V (D) J 序列、基因表达、细胞表面蛋白表达和抗原特异性数据。该检测方法将数千个细胞分隔到乳液包裹凝胶微珠（GEMs）中，单个液滴内生成的所有互补 DNA（cDNA）都具有相同的 10X Barcode。从 cDNA 构建文库并进行测序，根据10X Barcode将每条读取的序列追溯到其对应的单个cell，实现大规模单细胞水平免疫受体库的深度解析，支持克隆演化、抗原特异性响应及免疫治疗靶点发现。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSeSv3e1yzJnsibrbdV3qKrv61EMF353DiaFgZSHE9Og4DKb74DGGZAOwQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.2064814814814815" data-type="png" data-w="1080" data-imgfileid="100049199" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSeSv3e1yzJnsibrbdV3qKrv61EMF353DiaFgZSHE9Og4DKb74DGGZAOwQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">分析环境</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">同10X单细胞转录组，10X Genomics 也提供了完善的分析 pipeline 。</span></p><ul><li><section><span leaf="">https://www.10xgenomics.com/support/software/cell-ranger/latest/analysis/running-pipelines/cr-5p-multi</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">首先用的软件还是 cellranger ,前面也多次介绍，并且共享服务器也有提供现成的软件和参考基因组，可以直接调用。【服务器详情见：</span><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" textvalue="满足你生信分析计算需求的低价解决方案" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></span><span leaf="">】</span></p><ul><li><section><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247531629&amp;idx=1&amp;sn=43d865532dcf678c8892e722c43d57d9&amp;scene=21#wechat_redirect" textvalue="玩转服务器—零帧起手单细胞上下游分析" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">玩转服务器—零帧起手单细胞上下游分析</a></span></section></li><li><section><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247532481&amp;idx=1&amp;sn=fc1ba75e6fb619987239178099250a74&amp;scene=21#wechat_redirect" textvalue="玩转服务器-cellranger可以自动注释了?" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">玩转服务器-cellranger可以自动注释了?</a></span></section></li><li><section><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247525047&amp;idx=1&amp;sn=bb85ac8c669cec1ed3db5e56b241b690&amp;scene=21#wechat_redirect" textvalue="CellRanger ARC—单细胞RNAseq和ATAC联合分析套件" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">CellRanger ARC—单细胞RNAseq和ATAC联合分析套件</a></span></section></li></ul><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecS80viaedu4mg9QT0KPbQsby4D79pyFItKVe5xEsdCWa3P3f29czySsXg/640?wx_fmt=png&amp;from=appmsg" alt="共享服务器" data-ratio="0.17222222222222222" data-type="png" data-w="1080" data-imgfileid="100049200" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecS80viaedu4mg9QT0KPbQsby4D79pyFItKVe5xEsdCWa3P3f29czySsXg/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">共享服务器</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">如果需要自己下载，也可以直接在官网下载：</span></p><ul><li><section><span leaf="">https://www.10xgenomics.com/support/software/cell-ranger/downloads</span></section></li></ul><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">wget -O cellranger-9.0.1.tar.gz "https://cf.10xgenomics.com/releases/cell-exp/cellranger-9.0.1.tar.gz?Expires=1742333081&amp;Key-Pair-Id=APKAI7S6A5RYOXBWRPDA&amp;Signature=aSXlUageSwcEjNHFjw6JGYuf6ccW7AAe5uVmOJ4YrH~fX28OCPGGb4q5pJ7tFYSSvz6f4vv-35D0G4tOLIvG7ptV8k8EQhjVFnVzU9OEY4yZ1qPNVcB0UR~qnRvego4~diZrKz0covGULCVNf~l4lmnPtlNnbM7Z2O4A2~x~2be3peRTchZ4eLC7PUJhVFFHPABx4fVqlMabd6g2wabJQuuxg37r1uXuxoOim3YlOs2lbN4Nm~LTpZ6BdK3M7-Ai9AOMCmwmut41mi-h32rJgZT9M0Ga~LpKatCgOysCHkwCQNe-CNyv1X~h44ipI18NCpvxoSN3VVJbb8SHzVQgBg__"</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">其次是所需的参考基因组文件</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">#</span></span><span><span leaf="">human </span></span><span leaf=""><br></span><span leaf="">wget "https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-GRCh38-2024-A.tar.gz"</span><span leaf=""><br></span><span leaf="">wget "https://cf.10xgenomics.com/supp/cell-vdj/refdata-cellranger-vdj-GRCh38-alts-ensembl-7.1.0.tar.gz"</span><span leaf=""><br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">免疫组库定量</span></span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">定量脚本</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">根据官方文档，我们可以很容易写出我们所需的定量脚本：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">$</span></span><span><span leaf="">cat ~/scRNAseq_pipeline/st3_cellranger9_vdj_multi.sh</span></span><span leaf=""><br></span><span><span leaf="">#</span></span><span><span leaf="">! /bin/bash -xe</span></span><span leaf=""><br></span><span><span leaf="">#</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">bin=/home/username/software/cellranger-9.0.1/cellranger</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">/usr/bin/time -v $bin multi --id=${1} \</span><span leaf=""><br></span><span leaf="">--csv=${2} \</span><span leaf=""><br></span><span leaf="">--localcores=4 \</span><span leaf=""><br></span><span leaf="">--localmem=50 </span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">准备输入文件</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">从定量脚本，可以看出对于整个pipeline最主要的就是准备一个样本信息的csv文件。 根据文档信息：</span></p><ul><li><section><span leaf="">https://www.10xgenomics.com/support/software/cell-ranger/latest/analysis/running-pipelines/cr-5p-multi</span></section></li></ul><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSGoW60CTK8zpnFMdA6FK5iaRP28Gd1EKsrIkibhpvbjXuyKcFvNPvwibqA/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.1018518518518519" data-type="png" data-w="1080" data-imgfileid="100049201" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSGoW60CTK8zpnFMdA6FK5iaRP28Gd1EKsrIkibhpvbjXuyKcFvNPvwibqA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">如果少量样本，我们按示例格式手动修改即可。例如：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">$</span></span><span><span leaf="">cat C1008587.csv</span></span><span leaf=""><br></span><span leaf="">[gene-expression]</span><span leaf=""><br></span><span leaf="">reference,/home/username/reference/human/refdata-gex-GRCh38-2024-A</span><span leaf=""><br></span><span leaf="">create-bam,false</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[vdj]</span><span leaf=""><br></span><span leaf="">reference,/home/username/reference/human/refdata-cellranger-vdj-GRCh38-alts-ensembl-7.1.0</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[libraries]</span><span leaf=""><br></span><span leaf="">fastq_id,fastqs,feature_types</span><span leaf=""><br></span><span leaf="">C1008587,/home/username/project/b_scrna,Gene Expression</span><span leaf=""><br></span><span leaf="">C1008587_BCR,/home/username/project/b_rawdata/C1008587_BCR,VDJ-B</span><span leaf=""><br></span><span leaf="">C1008587_TCR,/home/username/project/b_rawdata/C1008587_TCR,VDJ-T</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">提交定量任务</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">#</span></span><span><span><span leaf=""># 单样本提交后台</span></span></span><span leaf=""><br></span><span leaf="">nohup bash /home/usernam/scRNAseq_pipeline/st3_cellranger9_vdj_multi.sh C1008587 /home/usernam/project/cellrgr9/C1008587.csv 1&gt;log_C1008587.txt 2&gt;&amp;1 &amp;</span><span leaf=""><br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">多样本批处理</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">如果有多个样本，那么再手动逐一修改csv文件就会显得很低效了。这时候就需要考虑如何快速批量生成样本对应的csv文件。</span></p><p data-tool="mdnice编辑器"><span leaf="">这边提供一个思路是：</span></p><ul><li><section><span leaf="">对应每个样本的csv文件我们需要变动的地方也只是</span><code><span leaf="">libraries</span></code></section></li><li><section><span leaf="">先做一个头文件</span></section></li><li><section><span leaf="">批量生成后面的信息，最后合并成一个完整的csv文件</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">首先根据自己的参考基因组和vdj参考文件新建一个</span><code><span leaf="">head.txt</span></code></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">$</span></span><span><span leaf="">cat head.txt </span></span><span leaf=""><br></span><span leaf="">[gene-expression]</span><span leaf=""><br></span><span leaf="">reference,/home/username/reference/human/refdata-gex-GRCh38-2024-A</span><span leaf=""><br></span><span leaf="">create-bam,false</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[vdj]</span><span leaf=""><br></span><span leaf="">reference,/home/username/reference/human/refdata-cellranger-vdj-GRCh38-alts-ensembl-7.1.0</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[libraries]</span><span leaf=""><br></span><span leaf="">fastq_id,fastqs,feature_types</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">然后批量生成csv文件后半部分样品信息：</span></p><p data-tool="mdnice编辑器"><span leaf="">前提条件：</span></p><ul><li><section><span leaf="">文件名符合cellranger要求</span></section></li><li><section><span leaf="">所有样本的表达量数据在同一个目录下</span></section></li><li><section><span leaf="">每个样本的BCR、TCR数据 分别在单独的子目录</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">GEX数据目录结构示例：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecST1iaic8nr1YufAvADLibpwd4ImIknyecAcVrtfUAFFnyTnHFSIY7hPDgQ/640?wx_fmt=png&amp;from=appmsg" alt="GEX数据" data-ratio="0.4361111111111111" data-type="png" data-w="1080" data-imgfileid="100049198" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecST1iaic8nr1YufAvADLibpwd4ImIknyecAcVrtfUAFFnyTnHFSIY7hPDgQ/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">GEX数据</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">BCR\TCR目录结构示例：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSPByJIqGnhd9iadnTI7icfJjUjibH7DibrGicLaBtKWicicorcgFoqqLC1ibE1w/640?wx_fmt=png&amp;from=appmsg" alt="BCR、TCR数据" data-ratio="0.7555555555555555" data-type="png" data-w="1080" data-imgfileid="100049197" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSPByJIqGnhd9iadnTI7icfJjUjibH7DibrGicLaBtKWicicorcgFoqqLC1ibE1w/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">BCR、TCR数据</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">根据gz文件目录结构信息，批量创建样本的csv文件，脚本命名为</span><code><span leaf="">generate_csv.sh </span></code></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">$</span></span><span><span leaf="">cat generate_csv.sh </span></span><span leaf=""><br></span><span><span leaf="">#</span></span><span><span leaf="">!/bin/bash</span></span><span leaf=""><br></span><span><span leaf="">#</span></span><span leaf=""><br></span><span><span leaf=""><br></span><span leaf="">#</span></span><span><span leaf="">Define variables</span></span><span leaf=""><br></span><span leaf="">gex_gz=~/project/b_scrna/*gz</span><span leaf=""><br></span><span leaf="">bcr_gz=~/project/b_rawdata/*BCR*/*BCR*.gz</span><span leaf=""><br></span><span leaf="">tcr_gz=~/project/b_rawdata/*TCR*/*TCR*.gz</span><span leaf=""><br></span><span leaf="">headfile=~/project/b_scrna/head.txt </span><span leaf=""><br></span><span leaf="">out_dir=~/project/c_multi_outs</span><span leaf=""><br></span><span><span leaf=""><br></span><span leaf="">#</span></span><span><span leaf="">GEX data</span></span><span leaf=""><br></span><span leaf="">ls ${gex_gz}|grep -E -v "BCR|TCR"|awk -F'/' '</span><span leaf=""><br></span><span leaf="">{</span><span leaf=""><br></span><span leaf="">    full_dir_path = $0</span><span leaf=""><br></span><span leaf="">    sub(/\/[^\/]+$/, "", full_dir_path)</span><span leaf=""><br></span><span leaf="">    split($NF, parts, "_S1")</span><span leaf=""><br></span><span leaf="">    print parts[1] "," full_dir_path</span><span leaf=""><br></span><span leaf="">}'|sort -u|awk '{print $0 ",Gene Expression"}'  &gt; ge_data.txt </span><span leaf=""><br></span><span><span leaf=""><br></span><span leaf="">#</span></span><span><span leaf="">BCR data</span></span><span leaf=""><br></span><span leaf="">ls ${bcr_gz} | awk -F'/' '</span><span leaf=""><br></span><span leaf="">{</span><span leaf=""><br></span><span leaf="">    full_dir_path = $0</span><span leaf=""><br></span><span leaf="">    sub(/\/[^\/]+$/, "", full_dir_path)</span><span leaf=""><br></span><span leaf="">    split($NF, parts, "_S1")</span><span leaf=""><br></span><span leaf="">    print parts[1] "," full_dir_path</span><span leaf=""><br></span><span leaf="">}'|sort -u|awk '{print $0 ",VDJ-B"}' &gt; bcr_data.txt</span><span leaf=""><br></span><span><span leaf=""><br></span><span leaf="">#</span></span><span><span leaf="">TCR data</span></span><span leaf=""><br></span><span leaf="">ls ${tcr_gz} | awk -F'/' '</span><span leaf=""><br></span><span leaf="">{</span><span leaf=""><br></span><span leaf="">    full_dir_path = $0</span><span leaf=""><br></span><span leaf="">    sub(/\/[^\/]+$/, "", full_dir_path)</span><span leaf=""><br></span><span leaf="">    split($NF, parts, "_S1")</span><span leaf=""><br></span><span leaf="">    print parts[1] "," full_dir_path</span><span leaf=""><br></span><span leaf="">}'|sort -u|awk '{print $0 ",VDJ-T"}' &gt; tcr_data.txt</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">paste ge_data.txt bcr_data.txt tcr_data.txt &gt; data_list.txt</span><span leaf=""><br></span><span><span leaf=""><br></span><span leaf="">#</span></span><span><span leaf=""> Check whether the head file exists</span></span><span leaf=""><br></span><span leaf="">if [ ! -f ${headfile} ]; then</span><span leaf=""><br></span><span leaf="">    echo "head file does not exist."</span><span leaf=""><br></span><span leaf="">    exit 1</span><span leaf=""><br></span><span leaf="">fi</span><span leaf=""><br></span><span><span leaf=""><br></span><span leaf="">#</span></span><span><span leaf="">Create a CSV file of each sample</span></span><span leaf=""><br></span><span leaf="">cat data_list.txt |while read id; do</span><span leaf=""><br></span><span leaf="">    sample=$(echo "$id" | cut -d "," -f 1)</span><span leaf=""><br></span><span leaf="">    cp ${headfile} ${out_dir}/${sample}.csv</span><span leaf=""><br></span><span leaf="">    printf "%s\n" "$id" | xargs -n 1 -d "\t" &gt;&gt; ${out_dir}/${sample}.csv</span><span leaf=""><br></span><span leaf="">done</span><span leaf=""><br></span><span><span leaf=""><br></span><span leaf="">#</span></span><span><span><span leaf=""># Delete temporary files</span></span></span><span leaf=""><br></span><span leaf="">rm data_list.txt ge_data.txt bcr_data.txt tcr_data.txt</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">echo "All CSV files have been </span><doubao-vocabulary-highlight data-key="generated"><span leaf="">generated</span></doubao-vocabulary-highlight><span leaf="">."</span><span leaf=""><br></span></code></pre><blockquote><span></span><p><span leaf="">注：不一定适合所有情况，可根据自己数据的目录结构修改脚本。上述代码不是最优解，也可自己重写。</span></p></blockquote><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSWsEafcjcOU8yT4Mia6NV8dPSHIDuzkvHHUgIFxoMnYL9tgRpZr2F5yQ/640?wx_fmt=png&amp;from=appmsg" alt="每个样本一次csv文件" data-ratio="0.5571776155717761" data-type="png" data-w="822" data-imgfileid="100049205" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSWsEafcjcOU8yT4Mia6NV8dPSHIDuzkvHHUgIFxoMnYL9tgRpZr2F5yQ/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">每个样本一个csv文件</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">检查CSV文件，确保符合程序要求。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">$</span></span><span><span leaf="">cat C1008587.csv</span></span><span leaf=""><br></span><span leaf="">[gene-expression]</span><span leaf=""><br></span><span leaf="">reference,/home/username/reference/human/refdata-gex-GRCh38-2024-A</span><span leaf=""><br></span><span leaf="">create-bam,false</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[vdj]</span><span leaf=""><br></span><span leaf="">reference,/home/username/reference/human/refdata-cellranger-vdj-GRCh38-alts-ensembl-7.1.0</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[libraries]</span><span leaf=""><br></span><span leaf="">fastq_id,fastqs,feature_types</span><span leaf=""><br></span><span leaf="">C1008587,/home/username/project/b_scrna,Gene Expression</span><span leaf=""><br></span><span leaf="">C1008587_BCR,/home/username/project/b_rawdata/C1008587_BCR,VDJ-B</span><span leaf=""><br></span><span leaf="">C1008587_TCR,/home/username/project/b_rawdata/C1008587_TCR,VDJ-T</span><span leaf=""><br></span><span><span leaf=""><br></span><span leaf="">$</span></span><span><span leaf="">cat C1010319.csv</span></span><span leaf=""><br></span><span leaf="">[gene-expression]</span><span leaf=""><br></span><span leaf="">reference,/home/username/reference/human/refdata-gex-GRCh38-2024-A</span><span leaf=""><br></span><span leaf="">create-bam,false</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[vdj]</span><span leaf=""><br></span><span leaf="">reference,/home/username/reference/human/refdata-cellranger-vdj-GRCh38-alts-ensembl-7.1.0</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[libraries]</span><span leaf=""><br></span><span leaf="">fastq_id,fastqs,feature_types</span><span leaf=""><br></span><span leaf="">C1010319,/home/username/project/b_scrna,Gene Expression</span><span leaf=""><br></span><span leaf="">C1010319_BCR,/home/username/project/b_rawdata/C1010319_BCR,VDJ-B</span><span leaf=""><br></span><span leaf="">C1010319_TCR,/home/username/project/b_rawdata/C1010319_TCR,VDJ-T</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">批量提交后台任务</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">提交任务的时候需要根据服务器可用资源来调整调用的内存和线程，以及是分批提交，还是一次性全部提交。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">#</span></span><span><span><span leaf="">#多样本分批执行</span></span></span><span leaf=""><br></span><span leaf="">ls *.csv|cut -d "." -f 1 |awk '{print "bash /home/username/scRNAseq_pipeline/st3_cellranger9_vdj_multi.sh " $1 " /home/username/project/c_multi_outs/"$1".csv 1&gt;log_"$1".txt 2&gt;&amp;1"}'  &gt; screen_run.sh</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">screen -R vdj</span><span leaf=""><br></span><span leaf="">cat screen_run.sh |xargs -iF -P 3 sh -c "F"</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSx77kjh6E7M4wWES6bonlD4dNSnSYdPNm8dZf4q5zhwf5ooaoY16aKw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.16018518518518518" data-type="png" data-w="1080" data-imgfileid="100049206" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicbVwEmR7HQBAuCuXialicecSx77kjh6E7M4wWES6bonlD4dNSnSYdPNm8dZf4q5zhwf5ooaoY16aKw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">结果输出</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">正常运行结束，每个样本ID目录下面会有一个outs目录，outs目录里面就是我们需要的结果文件。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">$</span></span><span><span leaf="">tree -L 5</span></span><span leaf=""><br></span><span leaf="">.</span><span leaf=""><br></span><span leaf="">├── config.csv</span><span leaf=""><br></span><span leaf="">├── multi</span><span leaf=""><br></span><span leaf="">│   ├── count</span><span leaf=""><br></span><span leaf="">│   │   ├── raw_cloupe.cloupe</span><span leaf=""><br></span><span leaf="">│   │   ├── raw_feature_bc_matrix</span><span leaf=""><br></span><span leaf="">│   │   │   ├── barcodes.tsv.gz</span><span leaf=""><br></span><span leaf="">│   │   │   ├── features.tsv.gz</span><span leaf=""><br></span><span leaf="">│   │   │   └── matrix.mtx.gz</span><span leaf=""><br></span><span leaf="">│   │   ├── raw_feature_bc_matrix.h5</span><span leaf=""><br></span><span leaf="">│   │   └── raw_molecule_info.h5</span><span leaf=""><br></span><span leaf="">│   ├── vdj_b</span><span leaf=""><br></span><span leaf="">│   │   ├── all_contig_annotations.bed</span><span leaf=""><br></span><span leaf="">│   │   ├── all_contig_annotations.csv</span><span leaf=""><br></span><span leaf="">│   │   ├── all_contig_annotations.json</span><span leaf=""><br></span><span leaf="">│   │   ├── all_contig.bam</span><span leaf=""><br></span><span leaf="">│   │   ├── all_contig.bam.bai</span><span leaf=""><br></span><span leaf="">│   │   ├── all_contig.fasta</span><span leaf=""><br></span><span leaf="">│   │   ├── all_contig.fasta.fai</span><span leaf=""><br></span><span leaf="">│   │   └── all_contig.fastq</span><span leaf=""><br></span><span leaf="">│   └── vdj_t</span><span leaf=""><br></span><span leaf="">│       ├── all_contig_annotations.bed</span><span leaf=""><br></span><span leaf="">│       ├── all_contig_annotations.csv</span><span leaf=""><br></span><span leaf="">│       ├── all_contig_annotations.json</span><span leaf=""><br></span><span leaf="">│       ├── all_contig.bam</span><span leaf=""><br></span><span leaf="">│       ├── all_contig.bam.bai</span><span leaf=""><br></span><span leaf="">│       ├── all_contig.fasta</span><span leaf=""><br></span><span leaf="">│       ├── all_contig.fasta.fai</span><span leaf=""><br></span><span leaf="">│       └── all_contig.fastq</span><span leaf=""><br></span><span leaf="">├── per_sample_outs</span><span leaf=""><br></span><span leaf="">│   └── C1008587</span><span leaf=""><br></span><span leaf="">│       ├── count</span><span leaf=""><br></span><span leaf="">│       │   ├── analysis</span><span leaf=""><br></span><span leaf="">│       │   │   ├── clustering</span><span leaf=""><br></span><span leaf="">│       │   │   ├── diffexp</span><span leaf=""><br></span><span leaf="">│       │   │   ├── pca</span><span leaf=""><br></span><span leaf="">│       │   │   ├── tsne</span><span leaf=""><br></span><span leaf="">│       │   │   └── umap</span><span leaf=""><br></span><span leaf="">│       │   ├── sample_cloupe.cloupe</span><span leaf=""><br></span><span leaf="">│       │   ├── sample_filtered_barcodes.csv</span><span leaf=""><br></span><span leaf="">│       │   ├── sample_filtered_feature_bc_matrix</span><span leaf=""><br></span><span leaf="">│       │   │   ├── barcodes.tsv.gz</span><span leaf=""><br></span><span leaf="">│       │   │   ├── features.tsv.gz</span><span leaf=""><br></span><span leaf="">│       │   │   └── matrix.mtx.gz</span><span leaf=""><br></span><span leaf="">│       │   ├── sample_filtered_feature_bc_matrix.h5</span><span leaf=""><br></span><span leaf="">│       │   └── sample_molecule_info.h5</span><span leaf=""><br></span><span leaf="">│       ├── metrics_summary.csv</span><span leaf=""><br></span><span leaf="">│       ├── vdj_b</span><span leaf=""><br></span><span leaf="">│       │   ├── airr_rearrangement.tsv</span><span leaf=""><br></span><span leaf="">│       │   ├── cell_barcodes.json</span><span leaf=""><br></span><span leaf="">│       │   ├── clonotypes.csv</span><span leaf=""><br></span><span leaf="">│       │   ├── concat_ref.bam</span><span leaf=""><br></span><span leaf="">│       │   ├── concat_ref.bam.bai</span><span leaf=""><br></span><span leaf="">│       │   ├── concat_ref.fasta</span><span leaf=""><br></span><span leaf="">│       │   ├── concat_ref.fasta.fai</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus_annotations.csv</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus.bam</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus.bam.bai</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus.fasta</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus.fasta.fai</span><span leaf=""><br></span><span leaf="">│       │   ├── donor_regions.fa</span><span leaf=""><br></span><span leaf="">│       │   ├── filtered_contig_annotations.csv</span><span leaf=""><br></span><span leaf="">│       │   ├── filtered_contig.fasta</span><span leaf=""><br></span><span leaf="">│       │   ├── filtered_contig.fastq</span><span leaf=""><br></span><span leaf="">│       │   ├── vdj_contig_info.pb</span><span leaf=""><br></span><span leaf="">│       │   └── vloupe.vloupe</span><span leaf=""><br></span><span leaf="">│       ├── vdj_t</span><span leaf=""><br></span><span leaf="">│       │   ├── airr_rearrangement.tsv</span><span leaf=""><br></span><span leaf="">│       │   ├── cell_barcodes.json</span><span leaf=""><br></span><span leaf="">│       │   ├── clonotypes.csv</span><span leaf=""><br></span><span leaf="">│       │   ├── concat_ref.bam</span><span leaf=""><br></span><span leaf="">│       │   ├── concat_ref.bam.bai</span><span leaf=""><br></span><span leaf="">│       │   ├── concat_ref.fasta</span><span leaf=""><br></span><span leaf="">│       │   ├── concat_ref.fasta.fai</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus_annotations.csv</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus.bam</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus.bam.bai</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus.fasta</span><span leaf=""><br></span><span leaf="">│       │   ├── consensus.fasta.fai</span><span leaf=""><br></span><span leaf="">│       │   ├── donor_regions.fa</span><span leaf=""><br></span><span leaf="">│       │   ├── filtered_contig_annotations.csv</span><span leaf=""><br></span><span leaf="">│       │   ├── filtered_contig.fasta</span><span leaf=""><br></span><span leaf="">│       │   ├── filtered_contig.fastq</span><span leaf=""><br></span><span leaf="">│       │   ├── vdj_contig_info.pb</span><span leaf=""><br></span><span leaf="">│       │   └── vloupe.vloupe</span><span leaf=""><br></span><span leaf="">│       └── web_summary.html</span><span leaf=""><br></span><span leaf="">└── vdj_reference</span><span leaf=""><br></span><span leaf="">    ├── fasta</span><span leaf=""><br></span><span leaf="">    │   └── regions.fa</span><span leaf=""><br></span><span leaf="">    └── reference.json</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">19 directories, 70 files</span><span leaf=""><br></span></code></pre></section><p><span leaf=""><br></span></p><section><section act="xmy"><section data-id="123409" data-type="lspecial02,lspecial04" powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><span leaf=""><br></span></section><section powered-by="xmyeditor.com" data-md5="8b46d"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" data-ratio="0.6940298507462687" data-type="gif" data-w="134" data-imgfileid="100043272" src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp"></span></section><section powered-by="xmyeditor.com" data-md5="8b46d"><span leaf=""><br></span></section></section></section></section></section></section><p><span></span><span leaf=""><br></span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span leaf="">文末友情宣传</span></h4><p data-tool="mdnice编辑器"><span leaf="">强烈建议你推荐给身边的</span><strong><span leaf="">博士后以及年轻生物学PI</span></strong><span leaf="">，多一点数据认知，让他们的科研上一个台阶：</span></p><ul></ul></section><ul><li><section><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247539788&amp;idx=1&amp;sn=62a09c7af6373658bf81c149eb0b4026&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课4月班" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2"><span textstyle="">生信入门&amp;数据挖掘线上直播课4月班</span></a><span textstyle="">，你的生物信息学入门课</span></span></section></li><li><section><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525079&amp;idx=1&amp;sn=0b997af16a58195b4192691373048fd5&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2"><span textstyle="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></span></section></li><li><section><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" textvalue="满足你生信分析计算需求的低价解决方案" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></span></section></li></ul><ul><li><p><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247539236&amp;idx=1&amp;sn=34ca8c9359a338ae147b986a069e8e12&amp;scene=21#wechat_redirect" textvalue="单细胞数据挖掘全国巡讲·北京专场" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2"><span textstyle="">单细胞数据挖掘全国巡讲·北京专场</span></a></span></p></li></ul><p><span leaf=""><br></span></p><section><span leaf=""><br></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/WTMshznQb9hJuYUDOptwEQ",target="_blank" rel="noopener noreferrer">原文链接</a>
