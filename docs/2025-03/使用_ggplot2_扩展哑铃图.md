---
title: "使用 ggplot2 扩展哑铃图"
date: 2025-03-20T00:29:32Z
draft: ["false"]
tags: [
  "fetched",
  "R 学习践行者"
]
categories: ["Acdemic"]
---
使用 ggplot2 扩展哑铃图 by R 学习践行者
------
<div><p><span leaf="">本文将介绍如何在 R 中创建扩展的哑铃图（Extended Dumbbell Plot），该图不仅显示基础的哑铃图形，还额外展示了分组均值和标准差。本方法由 Tobias Stalder 提出，他是一位来自瑞士的地理学家和数据可视化专家；请注意，原始 R 脚本可以在 TidyTuesday GitHub 仓库中找到。</span></p><section nodeleaf=""><img data-imgfileid="100005671" data-type="png" data-ratio="1.45" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5c4Gib5ZYbmCF1NLyNOvgH74EqRs3HfASA5xgRBX0CRjxFsKhsffF4ow/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5c4Gib5ZYbmCF1NLyNOvgH74EqRs3HfASA5xgRBX0CRjxFsKhsffF4ow/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf="">1.加载包和数据集</span></p><p><span leaf="">extrafont 包用于导入额外的字体，如果您之前没有使用过该包，需要运行以下命令以加载和导入字体。</span></p><pre><code><span><span leaf="">library</span></span><span leaf="">(tidyverse)</span><br><span><span leaf="">library</span></span><span leaf="">(ggtext)</span><br><span><span leaf="">library</span></span><span leaf="">(extrafont)</span><br><br><span><span leaf=""># font_import()  # 仅需运行一次</span></span><br><span leaf="">loadfonts(device = </span><span><span leaf="">"win"</span></span><span leaf="">) </span><span><span leaf=""># 每次会话运行一次</span></span></code></pre><p><span leaf="">本数据集来自 TidyTuesday，这是一项在 Twitter 上的每周数据可视化挑战，该数据集涉及 历史上黑人学院和大学（HBCUs） 的入学情况。</span></p><p><span leaf="">可以通过以下代码加载数据：</span></p><pre><code><span leaf="">hbcu_all &lt;- readr::read_csv(</span><span><span leaf="">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-02/hbcu_all.csv'</span></span><span leaf="">)</span><br><br><span leaf="">head(hbcu_all)</span></code></pre><pre><code><span leaf="">  # A tibble: 6 × 12</span><br><span leaf="">     Year `Total enrollment`  Males Females `4-year` `2-year` `Total - Public`</span><br><span leaf="">    &lt;dbl&gt;              &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;</span><br><span leaf="">  1  1976             222613 104669  117944   206676    15937           156836</span><br><span leaf="">  2  1980             233557 106387  127170   218009    15548           168217</span><br><span leaf="">  3  1982             228371 104897  123474   212017    16354           165871</span><br><span leaf="">  4  1984             227519 102823  124696   212844    14675           164116</span><br><span leaf="">  5  1986             223275  97523  125752   207231    16044           162048</span><br><span leaf="">  6  1988             239755 100561  139194   223250    16505           173672</span><br><span leaf="">  # ℹ 5 more variables: `4-year - Public` &lt;dbl&gt;, `2-year - Public` &lt;dbl&gt;,</span><br><span leaf="">  #   `Total - Private` &lt;dbl&gt;, `4-year - Private` &lt;dbl&gt;, `2-year - Private` &lt;dbl&gt;</span></code></pre><p><span leaf="">我们查看了数据的前几行，可以发现它是一个按年份分辨的入学情况数据集。</span></p><p><span leaf="">2.数据处理</span></p><p><span leaf="">在本示例图表中，我们关注 1990 年及之后 的男性和女性入学情况。因此，我们首先进行数据整理，以获取一个较小的数据集，其中包含每年的男性和女性入学人数以及它们之间的数值差异。</span></p><p><span leaf="">我们使用 dplyr 包进行初步数据整理，如下所示：</span></p><pre><code><span><span leaf="">library</span></span><span leaf="">(tidyverse)</span><br><br><span leaf="">hbcu_all %&gt;%</span><br><span leaf="">  filter(Year &gt;= </span><span><span leaf="">1990</span></span><span leaf="">) %&gt;%  </span><span><span leaf=""># 筛选 1990 年及之后的数据</span></span><br><span leaf="">  select(Year, Males, Females) %&gt;%  </span><span><span leaf=""># 选择感兴趣的列</span></span><br><span leaf="">  mutate(diff = Females - Males) %&gt;%  </span><span><span leaf=""># 计算女性与男性的入学差值</span></span><br><span leaf="">  pivot_longer(cols = c(Males, Females)) %&gt;%  </span><span><span leaf=""># 转换为长格式数据</span></span><br><span leaf="">  rename(Gender = name,  </span><span><span leaf=""># 重命名列</span></span><br><span leaf="">         Enrollments = value) -&gt; dat_gender  </span><br><br><span leaf="">head(dat_gender)</span></code></pre><pre><code><span leaf="">  # A tibble: 6 × 4</span><br><span leaf="">     Year  diff Gender  Enrollments</span><br><span leaf="">    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;</span><br><span leaf="">  1  1990 46838 Males        105157</span><br><span leaf="">  2  1990 46838 Females      151995</span><br><span leaf="">  3  1991 48451 Males        110442</span><br><span leaf="">  4  1991 48451 Females      158893</span><br><span leaf="">  5  1992 50297 Males        114622</span><br><span leaf="">  6  1992 50297 Females      164919</span></code></pre><p><span leaf="">拆分性别数据集</span></p><p><span leaf="">为了在后续绘图时显示两个性别之间的范围，我们需要创建两个 tibble 数据框，分别仅包含男性或女性的数据。</span></p><pre><code><span leaf="">Males &lt;- dat_gender %&gt;%</span><br><span leaf="">  filter(Gender == </span><span><span leaf="">"Males"</span></span><span leaf="">)</span><br><br><span leaf="">Females &lt;- dat_gender %&gt;%</span><br><span leaf="">  filter(Gender == </span><span><span leaf="">"Females"</span></span><span leaf="">)</span></code></pre><p><span leaf="">这样，我们就分别得到了仅包含男性和仅包含女性的数据集，为后续绘图做好准备。</span></p><mpcpc data-category_id_list="16|21|31|39|42|46|47|5|56|57|59|60|64|65|66|7" js_editor_cpcad="" src="/cgi-bin/readtemplate?t=tmpl/cpc_tmpl#1741942199110" data-id="1741942199110"></mpcpc><p><span leaf=""><br></span></p><p><span leaf="">3.基础哑铃图</span></p><p><span leaf="">现在，我们可以使用 ggplot2 包来绘制基础哑铃图。 在绘制时，我们使用以下两个几何对象（geoms）：</span></p><p><span leaf="">geom_point() 用于绘制每个组（性别）在各年份的入学点;</span></p><p><span leaf="">geom_segment() 用于在同一年份的两个组之间创建可视化连接。</span></p><pre><code><span leaf="">p &lt;- ggplot(dat_gender) +</span><br><span leaf="">  geom_segment(data = Males,</span><br><span leaf="">              aes(x = Enrollments,</span><br><span leaf="">                  y = Year,</span><br><span leaf="">                  yend = Females$Year, </span><br><span leaf="">                  xend = Females$Enrollments),  </span><span><span leaf=""># 使用 $ 运算符从 "Females" tibble 获取数据</span></span><br><span leaf="">              color = </span><span><span leaf="">"#aeb6bf"</span></span><span leaf="">,</span><br><span leaf="">              size = </span><span><span leaf="">4.5</span></span><span leaf="">,  </span><span><span leaf=""># 使线段大小适配点的大小</span></span><br><span leaf="">              alpha = </span><span><span leaf="">.5</span></span><span leaf="">) +</span><br><span leaf="">  geom_point(aes(x = Enrollments,</span><br><span leaf="">                 y = Year, </span><br><span leaf="">                 color = Gender), </span><br><span leaf="">             size = </span><span><span leaf="">4</span></span><span leaf="">, </span><br><span leaf="">             show.legend = </span><span><span leaf="">TRUE</span></span><span leaf="">) +</span><br><span leaf="">  ggtitle(</span><span><span leaf="">"Enrollment Trends at Historically Black Colleges and Universities"</span></span><span leaf="">)</span><br><br><span leaf="">p</span></code></pre><section nodeleaf=""><img data-imgfileid="100005672" data-type="png" width="672" data-ratio="0.7138888888888889" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5N3av8fDXAhia23uDKkoWRUs5fqHSdBjgyDyzKP8u4alpsicjfls9cyEg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5N3av8fDXAhia23uDKkoWRUs5fqHSdBjgyDyzKP8u4alpsicjfls9cyEg/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf="">4.数据处理 II —— 扩展版本</span></p><p><span leaf="">为了绘制扩展版本的可视化，我们需要添加以下内容：标注入学人数范围的标签:按组计算均值 ± 1 标准差，并绘制均值线和阴影区域</span></p><p><span leaf="">首先，我们计算每组（性别）的均值和标准差，然后创建两个独立的数据框，分别用于男性和女性数据。</span></p><pre><code><span leaf="">dat_gender %&gt;%</span><br><span leaf="">  group_by(Gender) %&gt;%</span><br><span leaf="">  summarise(mean = mean(Enrollments),</span><br><span leaf="">            SE = sd(Enrollments)) %&gt;%</span><br><span leaf="">  mutate(meanpos = mean + </span><span><span leaf="">1</span></span><span leaf=""> * SE,  </span><span><span leaf=""># 计算均值 + 1 标准差</span></span><br><span leaf="">         meanneg = mean - </span><span><span leaf="">1</span></span><span leaf=""> * SE) -&gt; stats  </span><span><span leaf=""># 计算均值 - 1 标准差</span></span><br><br><span leaf="">stats_males &lt;- stats %&gt;%</span><br><span leaf="">  filter(Gender == </span><span><span leaf="">"Males"</span></span><span leaf="">)</span><br><br><span leaf="">stats_females &lt;- stats %&gt;%</span><br><span leaf="">  filter(Gender == </span><span><span leaf="">"Females"</span></span><span leaf="">)</span><br><br><span leaf="">head(stats)</span></code></pre><pre><code><span leaf="">  # A tibble: 2 × 5</span><br><span leaf="">    Gender     mean     SE meanpos meanneg</span><br><span leaf="">    &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span><br><span leaf="">  1 Females 177866. 13908. 191774. 163958.</span><br><span leaf="">  2 Males   115789.  6065. 121854. 109724.</span></code></pre><p><span leaf="">计算范围标签位置</span></p><p><span leaf="">为了在哑铃图上正确放置标签，我们需要创建一个包含性别差异的数据框，并添加标签的 X 轴位置。</span></p><pre><code><span leaf="">diff &lt;- dat_gender %&gt;% </span><br><span leaf="">  filter(Gender == </span><span><span leaf="">"Males"</span></span><span leaf="">) %&gt;%  </span><span><span leaf=""># 选择 "Males" 或 "Females" 都可以</span></span><br><span leaf="">  mutate(x_pos = Enrollments + (diff / </span><span><span leaf="">2</span></span><span leaf="">))  </span><span><span leaf=""># 计算标签的 X 轴位置（男性入学人数 + 差值/2）</span></span><br><br><span leaf="">head(diff)</span></code></pre><pre><code><span leaf="">  # A tibble: 6 × 5</span><br><span leaf="">     Year  diff Gender Enrollments   x_pos</span><br><span leaf="">    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;</span><br><span leaf="">  1  1990 46838 Males       105157 128576 </span><br><span leaf="">  2  1991 48451 Males       110442 134668.</span><br><span leaf="">  3  1992 50297 Males       114622 139770.</span><br><span leaf="">  4  1993 50062 Males       116397 141428 </span><br><span leaf="">  5  1994 52059 Males       114006 140036.</span><br><span leaf="">  6  1995 53451 Males       112637 139362.</span></code></pre><p><span leaf="">5.构建扩展版本</span></p><p><span leaf="">5.1 添加范围标签</span></p><p><span leaf="">首先，我们使用 diff 数据框，在哑铃图的范围上添加标签，标注两性别间的入学差值。</span></p><p><span leaf="">这里我们使用 geom_text() 来显示文本标签，并注意编码问题，将希腊字母 Δ 替换为 “D:”。</span></p><pre><code><span leaf="">p + </span><br><span leaf="">   geom_text(data = diff,</span><br><span leaf="">             aes(label = paste(</span><span><span leaf="">"D: "</span></span><span leaf="">, diff), x = x_pos, y = Year),  </span><span><span leaf=""># 显示入学差值</span></span><br><span leaf="">             fill = </span><span><span leaf="">"white"</span></span><span leaf="">,</span><br><span leaf="">             color = </span><span><span leaf="">"#4a4e4d"</span></span><span leaf="">,</span><br><span leaf="">             size = </span><span><span leaf="">2.5</span></span><span leaf="">,</span><br><span leaf="">             family = </span><span><span leaf="">"Segoe UI Semibold"</span></span><span leaf="">) -&gt; p_labelled</span><br><br><span leaf="">p_labelled</span></code></pre><section nodeleaf=""><img data-imgfileid="100005673" data-type="png" width="672" data-ratio="0.7138888888888889" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5vLPlG1RbWXicFAWsZ0JRPrIXZM5DSoZI6InTMpLF6pWM9feNVbCWibaA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5vLPlG1RbWXicFAWsZ0JRPrIXZM5DSoZI6InTMpLF6pWM9feNVbCWibaA/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf="">5.2 添加分面（Facet）&amp; 主题（Theme）</span></p><p><span leaf="">为了更好地控制不同年份的入学范围显示，我们在 y 轴上添加分面（facet），并进一步优化样式，调整分面标签的角度和整体主题风格。</span></p><pre><code><span leaf="">p_labelled +</span><br><span leaf="">  </span><span><span leaf=""># 添加分面，按年份拆分</span></span><br><span leaf="">  facet_grid(Year ~ ., scales = </span><span><span leaf="">"free"</span></span><span leaf="">, </span><span><span leaf="">switch</span></span><span leaf=""> = </span><span><span leaf="">"y"</span></span><span leaf="">) +</span><br><span><span leaf=""># 主题优化</span></span><br><span leaf="">  theme_minimal() +</span><br><span leaf="">  theme(</span><br><span leaf="">        panel.grid.major.y = element_blank(),</span><br><span leaf="">        panel.grid.minor.y = element_blank(),</span><br><span leaf="">        panel.grid.major.x = element_blank(),</span><br><span leaf="">        panel.grid.minor.x = element_blank(),</span><br><span leaf="">        axis.title.y = element_blank(),</span><br><span leaf="">        axis.text.y = element_blank(),</span><br><span leaf="">        axis.ticks.y = element_blank(),</span><br><span leaf="">        axis.ticks.x = element_line(color = </span><span><span leaf="">"#4a4e4d"</span></span><span leaf="">),</span><br><span leaf="">        text = element_text(family = </span><span><span leaf="">"Segoe UI Semibold"</span></span><span leaf="">,</span><br><span leaf="">                            color = </span><span><span leaf="">"#4a4e4d"</span></span><span leaf="">),</span><br><span leaf="">        strip.text.y.left  = element_text(angle = </span><span><span leaf="">0</span></span><span leaf="">),  </span><span><span leaf=""># 调整分面标题角度</span></span><br><span leaf="">        panel.background = element_rect(fill = </span><span><span leaf="">"white"</span></span><span leaf="">, </span><br><span leaf="">                                        color = </span><span><span leaf="">"white"</span></span><span leaf="">),</span><br><span leaf="">        strip.background = element_rect(fill = </span><span><span leaf="">"white"</span></span><span leaf="">, </span><br><span leaf="">                                        color = </span><span><span leaf="">"white"</span></span><span leaf="">),</span><br><span leaf="">        strip.text = element_text(color = </span><span><span leaf="">"#4a4e4d"</span></span><span leaf="">, </span><br><span leaf="">                                  family = </span><span><span leaf="">"Segoe UI"</span></span><span leaf="">),</span><br><span leaf="">        plot.background = element_rect(fill = </span><span><span leaf="">"white"</span></span><span leaf="">, </span><br><span leaf="">                                       color = </span><span><span leaf="">"white"</span></span><span leaf="">),</span><br><span leaf="">        panel.spacing = unit(</span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">"lines"</span></span><span leaf="">),</span><br><span leaf="">        plot.margin = margin(</span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">0.5</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">"cm"</span></span><span leaf="">)  </span><span><span leaf=""># 调整边距</span></span><br><span leaf="">  ) -&gt; p_ext_facetted</span><br><br><span leaf="">p_ext_facetted</span></code></pre><section nodeleaf=""><img data-imgfileid="100005670" data-type="png" width="672" data-ratio="0.7138888888888889" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w58J0zN0mmTLW1nXjgzpaon3toEUg7EvDOI7TWmugJT4SSfZwXlXk2TA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w58J0zN0mmTLW1nXjgzpaon3toEUg7EvDOI7TWmugJT4SSfZwXlXk2TA/640?wx_fmt=png&amp;from=appmsg"></section><mpcpc data-category_id_list="16|21|31|39|42|46|47|5|56|57|59|60|64|65|66|7" js_editor_cpcad="" src="/cgi-bin/readtemplate?t=tmpl/cpc_tmpl#1741942171935" data-id="1741942171935"></mpcpc><p><span leaf=""><br></span></p><p><span leaf="">5.3 添加均值与标准差标注</span></p><p><span leaf="">接下来，我们需要在图上添加两个小的文本标注，用于说明均值（Mean）和标准差（Standard Deviation, STDEV），以便读者能够理解这些统计信息的意义。</span></p><p><span leaf="">在这个步骤中，我们还需要定义点的颜色 (scale_color_manual())，并在绘图时优先绘制均值和标准差的阴影区域，以确保数据点和范围线位于其上方，提高可读性。</span></p><pre><code><span leaf="">ggplot(dat_gender) +</span><br><span leaf="">  </span><span><span leaf=""># 为男性组（Males）添加均值 ± 1 标准差的矩形阴影</span></span><br><span leaf="">  geom_rect(xmin = stats_males$meanneg,</span><br><span leaf="">            xmax = stats_males$meanpos,</span><br><span leaf="">            ymin = </span><span><span leaf="">2016</span></span><span leaf="">, </span><br><span leaf="">            ymax = </span><span><span leaf="">1989</span></span><span leaf="">, </span><br><span leaf="">            fill = </span><span><span leaf="">"#762a83"</span></span><span leaf="">, </span><br><span leaf="">            alpha = </span><span><span leaf="">.05</span></span><span leaf="">) +</span><br><span leaf="">  geom_vline(xintercept = stats_males$mean, </span><br><span leaf="">             linetype = </span><span><span leaf="">"solid"</span></span><span leaf="">, </span><br><span leaf="">             size = </span><span><span leaf="">.5</span></span><span leaf="">, </span><br><span leaf="">             alpha = </span><span><span leaf="">.8</span></span><span leaf="">, </span><br><span leaf="">             color = </span><span><span leaf="">"#762a83"</span></span><span leaf="">) +</span><br><span><span leaf=""># 为女性组（Females）添加均值 ± 1 标准差的矩形阴影</span></span><br><span leaf="">  geom_rect(xmin = stats_females$meanneg, </span><br><span leaf="">            xmax = stats_females$meanpos,</span><br><span leaf="">            ymin = </span><span><span leaf="">2016</span></span><span leaf="">, </span><br><span leaf="">            ymax = </span><span><span leaf="">1989</span></span><span leaf="">, </span><br><span leaf="">            fill = </span><span><span leaf="">"#009688"</span></span><span leaf="">, </span><br><span leaf="">            alpha = </span><span><span leaf="">.05</span></span><span leaf="">) +  </span><br><span leaf="">  geom_vline(xintercept = stats_females$mean, </span><br><span leaf="">             color = </span><span><span leaf="">"#009688"</span></span><span leaf="">, </span><br><span leaf="">             linetype = </span><span><span leaf="">"solid"</span></span><span leaf="">, </span><br><span leaf="">             size = </span><span><span leaf="">.5</span></span><span leaf="">, </span><br><span leaf="">             alpha = </span><span><span leaf="">.8</span></span><span leaf="">) +</span><br><br><span><span leaf=""># 添加哑铃线（点范围连接线）</span></span><br><span leaf="">  geom_segment(data = Males, </span><br><span leaf="">               aes(x = Enrollments, </span><br><span leaf="">                   y = Year, </span><br><span leaf="">                   yend = Females$Year, </span><br><span leaf="">                   xend = Females$Enrollments),</span><br><span leaf="">               color = </span><span><span leaf="">"#aeb6bf"</span></span><span leaf="">, </span><br><span leaf="">               size = </span><span><span leaf="">6</span></span><span leaf="">, </span><br><span leaf="">               alpha = </span><span><span leaf="">.5</span></span><span leaf="">) +</span><br><br><span><span leaf=""># 添加数据点</span></span><br><span leaf="">  geom_point(aes(x = Enrollments, </span><br><span leaf="">                 y = Year, </span><br><span leaf="">                 color = Gender), </span><br><span leaf="">             size = </span><span><span leaf="">5.5</span></span><span leaf="">, </span><br><span leaf="">             show.legend = </span><span><span leaf="">FALSE</span></span><span leaf="">) +</span><br><br><span><span leaf=""># 自定义点的颜色</span></span><br><span leaf="">  scale_color_manual(values = c(</span><span><span leaf="">"#009688"</span></span><span leaf="">, </span><span><span leaf="">"#762a83"</span></span><span leaf="">)) +</span><br><br><span><span leaf=""># 添加点范围的文本标签</span></span><br><span leaf="">  geom_text(data = diff, </span><br><span leaf="">            aes(label = paste(</span><span><span leaf="">"D: "</span></span><span leaf="">, diff),</span><br><span leaf="">                x = x_pos, y = Year), </span><br><span leaf="">            fill = </span><span><span leaf="">"white"</span></span><span leaf="">, </span><br><span leaf="">            color = </span><span><span leaf="">"#4a4e4d"</span></span><span leaf="">, </span><br><span leaf="">            size = </span><span><span leaf="">4</span></span><span leaf="">, </span><br><span leaf="">            family = </span><span><span leaf="">"Segoe UI"</span></span><span leaf="">) +</span><br><br><span><span leaf=""># 添加均值和标准差的文本标注</span></span><br><span leaf="">  geom_text(x = stats_females$mean - </span><span><span leaf="">1500</span></span><span leaf="">,</span><br><span leaf="">            y = </span><span><span leaf="">1990</span></span><span leaf="">, </span><br><span leaf="">            label = </span><span><span leaf="">"MEAN"</span></span><span leaf="">, </span><br><span leaf="">            angle = </span><span><span leaf="">90</span></span><span leaf="">, </span><br><span leaf="">            size = </span><span><span leaf="">2</span></span><span leaf="">, </span><br><span leaf="">            color = </span><span><span leaf="">"#009688"</span></span><span leaf="">, </span><br><span leaf="">            family = </span><span><span leaf="">"Segoe UI"</span></span><span leaf="">) +</span><br><span leaf="">  geom_text(x = stats_females$meanpos - </span><span><span leaf="">1500</span></span><span leaf="">, </span><br><span leaf="">            y = </span><span><span leaf="">1990</span></span><span leaf="">, </span><br><span leaf="">            label = </span><span><span leaf="">"STDEV"</span></span><span leaf="">, </span><br><span leaf="">            angle = </span><span><span leaf="">90</span></span><span leaf="">, </span><br><span leaf="">            size = </span><span><span leaf="">2</span></span><span leaf="">, </span><br><span leaf="">            color = </span><span><span leaf="">"#009688"</span></span><span leaf="">, </span><br><span leaf="">            family = </span><span><span leaf="">"Segoe UI"</span></span><span leaf="">) +</span><br><br><span><span leaf=""># 添加分面（facet），按年份拆分图表</span></span><br><span leaf="">  facet_grid(Year ~ ., </span><br><span leaf="">             scales = </span><span><span leaf="">"free"</span></span><span leaf="">, </span><br><span leaf="">             </span><span><span leaf="">switch</span></span><span leaf=""> = </span><span><span leaf="">"y"</span></span><span leaf="">) +</span><br><br><span><span leaf=""># 添加图表标题</span></span><br><span leaf="">  ggtitle(</span><span><span leaf="">"Enrollment Trends at Historically Black Colleges and Universities"</span></span><span leaf="">) +</span><br><br><span><span leaf=""># 应用主题样式</span></span><br><span leaf="">  theme_minimal() +</span><br><span leaf="">  theme(panel.grid.major.y = element_blank(),</span><br><span leaf="">        panel.grid.minor.y = element_blank(),</span><br><span leaf="">        panel.grid.major.x = element_blank(),</span><br><span leaf="">        panel.grid.minor.x = element_blank(),</span><br><span leaf="">        </span><br><span leaf="">        axis.title.y = element_blank(),</span><br><span leaf="">        axis.text.y = element_blank(),</span><br><span leaf="">        axis.ticks.y = element_blank(),</span><br><span leaf="">        axis.ticks.x = element_line(color = </span><span><span leaf="">"#4a4e4d"</span></span><span leaf="">),</span><br><span leaf="">        </span><br><span leaf="">        text = element_text(family = </span><span><span leaf="">"Segoe UI"</span></span><span leaf="">, color = </span><span><span leaf="">"#4a4e4d"</span></span><span leaf="">),</span><br><span leaf="">        strip.text.y.left  = element_text(angle = </span><span><span leaf="">0</span></span><span leaf="">),</span><br><span leaf="">        </span><br><span leaf="">        panel.background = element_rect(fill = </span><span><span leaf="">"white"</span></span><span leaf="">, </span><br><span leaf="">                                        color = </span><span><span leaf="">"white"</span></span><span leaf="">),</span><br><span leaf="">        strip.background = element_rect(fill = </span><span><span leaf="">"white"</span></span><span leaf="">, </span><br><span leaf="">                                        color = </span><span><span leaf="">"white"</span></span><span leaf="">),</span><br><span leaf="">        strip.text = element_text(color = </span><span><span leaf="">"#4a4e4d"</span></span><span leaf="">, </span><br><span leaf="">                                  family = </span><span><span leaf="">"Segoe UI"</span></span><span leaf="">),</span><br><span leaf="">        </span><br><span leaf="">        plot.background = element_rect(fill = </span><span><span leaf="">"white"</span></span><span leaf="">,</span><br><span leaf="">                                       color = </span><span><span leaf="">"white"</span></span><span leaf="">),</span><br><span leaf="">        panel.spacing = unit(</span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">"lines"</span></span><span leaf="">),</span><br><span leaf="">        plot.margin = margin(</span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">0.5</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">"cm"</span></span><span leaf="">)) -&gt; p_styled</span><br><br><span leaf="">p_styled</span></code></pre><section nodeleaf=""><img data-imgfileid="100005674" data-type="png" width="768" data-ratio="1.25" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5O4Z7OGfcGTPN7dhhFdjQB0LvjXj78uDxEV0ZPItAd8Bb05JSsyic9Yw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5O4Z7OGfcGTPN7dhhFdjQB0LvjXj78uDxEV0ZPItAd8Bb05JSsyic9Yw/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf="">5.4 使用 ggtext 完善最终图表</span></p><p><span leaf="">在最后一步中，我们将添加副标题（subtitle）和图表说明（caption），并利用 ggtext 包中的 element_markdown() 来支持富文本格式（如颜色和加粗文本）。</span></p><pre><code><span leaf="">p_styled +   </span><br><span leaf="">  </span><span><span leaf=""># 添加副标题和图表说明</span></span><br><span leaf="">  labs(subtitle = </span><span><span leaf="">"&lt;span style = 'color: #762a83;'&gt;**Male**&lt;/span&gt; and &lt;span style = 'color: #009688;'&gt;**Female**&lt;/span&gt; Enrollment from 1990 to 2015&lt;br&gt;"</span></span><span leaf="">,</span><br><span leaf="">       caption = </span><span><span leaf="">"Plot by **Tobias Stalder** | tobias-stalder.netlify.app&lt;br&gt;Data from **data.world** | data.world/nces | originally by NCES&lt;br&gt;**#TidyTuesday**"</span></span><span leaf="">) +</span><br><span leaf="">  </span><br><span leaf="">  </span><span><span leaf=""># 设置标题、字幕和说明的样式</span></span><br><span leaf="">  theme(plot.caption = element_markdown(hjust = </span><span><span leaf="">0</span></span><span leaf="">, lineheight = </span><span><span leaf="">1</span></span><span leaf="">),</span><br><span leaf="">        plot.subtitle = element_markdown(size = </span><span><span leaf="">12</span></span><span leaf="">, hjust = -</span><span><span leaf="">.06</span></span><span leaf="">),</span><br><span leaf="">        plot.title = element_text(size = </span><span><span leaf="">15</span></span><span leaf="">, hjust = -</span><span><span leaf="">.04</span></span><span leaf="">)) -&gt; p_fin </span><span><span leaf=""># hjust 取决于导出尺寸</span></span><br><br><span leaf="">p_fin</span></code></pre><section nodeleaf=""><img data-imgfileid="100005675" data-type="png" width="768" data-ratio="1.25" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5ZDGvYtFFJG6dyFycsgvoFzSSd57xwrjVLOM1O8db40PHqheP2O3z9Q/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50mYE4V6Q8jXfmLV5b2Ka9w5ZDGvYtFFJG6dyFycsgvoFzSSd57xwrjVLOM1O8db40PHqheP2O3z9Q/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/T6D1aTs8N_58Ps_7li9v5g",target="_blank" rel="noopener noreferrer">原文链接</a>
