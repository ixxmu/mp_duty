---
title: "顶刊Nature杂志同款配色一流的山峦图"
date: 2025-10-20T22:50:43Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
顶刊Nature杂志同款配色一流的山峦图 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><blockquote><p><span leaf="">今天分享一篇来自顶刊 Nature 杂志的山峦图，这个图配色一流，来自文献《Ovarian cancer mutational processes drive site-specific immune evasion》，于2022年12月14号发表在 Nature 上。</span></p></blockquote><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWC9Jqsic8CUu4NM4vTotgzc2wMWzv2m4AsQfGz7DWwpYhqdo0HqCZyAA/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="0.45740740740740743" data-type="jpeg" data-w="1080" data-imgfileid="100062633" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWC9Jqsic8CUu4NM4vTotgzc2wMWzv2m4AsQfGz7DWwpYhqdo0HqCZyAA/640?wx_fmt=jpeg&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">图注：</span></p><blockquote><p><span leaf="">图5 | HLA缺失作为一种免疫逃逸机制。a，左图，按细胞类型中位数 6p BAF 排序的单细胞 RNA 测序数据中 6 号染色体臂 6p BAF 的细胞分布。右图，癌症细胞簇中 6p BAF 的等位基因不平衡。白色垂直线表示中位数。Chr.，染色体</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">山峦图我们在前面也分享过一篇：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247540687&amp;idx=1&amp;sn=315b1f5757a97375a6425c3e751f7304&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">Nat Commun同款山脊图：千里江山图</a></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">数据背景</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">使用 signals 工具在 scrna-seq 数据中推断等位基因特异性拷贝数得到的结果，上面的山峦图展示的每个细胞亚群中得到的 BAF 在 6p 染色体上的结果分布。signals 这个工具的数据要求比较多，这里不太容易能够复现这个分析，感兴趣的可以去工具的网址看看那：https://shahcompbio.github.io/signals/articles/ASCN-RNA.html</span></p><p data-tool="mdnice编辑器"><span leaf="">我这里就找一下数据的随便一个特征绘制上面的图好了，这个特征只需要是每个细胞的连续值就行。</span></p><p data-tool="mdnice编辑器"><span leaf="">单细胞数据总共有156样本，共 929,686个细胞，上传到了 GEO：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE180661，</span></p><p data-tool="mdnice编辑器"><span leaf="">此外在这里可以下载到 h5ad格式的注释后的数据：</span></p><p data-tool="mdnice编辑器"><span leaf="">scRNA-seq  cellxgene：https://cellxgene.cziscience.com/collections/4796c91c-9d8f-4692-be43-347b1727f9d8</span></p><p data-tool="mdnice编辑器"><span leaf="">我们从GEO下载：GSE180661_GEO_cells.tsv.gz 文件，读取进来：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf="">###</span></span><span leaf=""><br></span><span><span leaf="">### juan zhang (492482942@qq.com)</span></span><span leaf=""><br></span><span><span leaf="">### </span></span><span leaf=""><br></span><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span leaf="">library(dplyr) </span><span leaf=""><br></span><span leaf="">library(future)</span><span leaf=""><br></span><span leaf="">library(Seurat)</span><span leaf=""><br></span><span leaf="">library(data.table)</span><span leaf=""><br></span><span leaf="">library(ggplot2)</span><span leaf=""><br></span><span leaf="">library(patchwork)</span><span leaf=""><br></span><span leaf="">library(stringr)</span><span leaf=""><br></span><span leaf="">library(qs)</span><span leaf=""><br></span><span leaf="">library(Matrix)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">phe &lt;- data.table::fread(</span><span><span leaf="">'GSE180661_GEO_cells.tsv.gz'</span></span><span leaf="">,data.table = F)</span><span leaf=""><br></span><span leaf="">head(phe)</span><span leaf=""><br></span><span leaf="">table(phe</span><span><span leaf="">$sample</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">table(phe</span><span><span leaf="">$cell_type</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">有细胞类型，还有每个细胞中的连续数据有 表达的umi数，基因数，线粒体基因表达比例：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWDD93w2fMSialfStLaSiaOBCzaRBA9yppa63HFVL5xgSqTlUlOFMEeYwg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.0824074074074074" data-type="png" data-w="1080" data-imgfileid="100062630" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWDD93w2fMSialfStLaSiaOBCzaRBA9yppa63HFVL5xgSqTlUlOFMEeYwg/640?wx_fmt=png&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100062632" data-ratio="0.175" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWMn6jzC1RwdgkWK6T4DHxkHkrQFK7vr72UibOtYqsibO4eIYer64a6UQA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWMn6jzC1RwdgkWK6T4DHxkHkrQFK7vr72UibOtYqsibO4eIYer64a6UQA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">我们就用上面的每个细胞亚群中表达的线粒体百分比绘图吧，看看每个亚群中的这个比值分布情况。后面你套用任何特征都可以。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">山峦图绘制</span></span></h2><h4 data-tool="mdnice编辑器"><span></span><span leaf="">首先提取必要的绘图数据并进行预处理：</span><span></span></h4><pre data-tool="mdnice编辑器"><code><span><span leaf="">## 数据预处理</span></span><span leaf=""><br></span><span leaf="">df &lt;- phe[,c(</span><span><span leaf="">"cell_type"</span></span><span leaf="">,</span><span><span leaf="">"percent.mt"</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf="">table(df</span><span><span leaf="">$cell_type</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 去掉4个other 细胞</span></span><span leaf=""><br></span><span leaf="">df &lt;- df[df</span><span><span leaf="">$cell_type</span></span><span leaf="">!=</span><span><span leaf="">"Other"</span></span><span leaf="">, ]</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 将细胞名字中的. 换成空格</span></span><span leaf=""><br></span><span leaf="">df</span><span><span leaf="">$cell_type</span></span><span leaf=""> &lt;- gsub(</span><span><span leaf="">"\\."</span></span><span leaf="">,</span><span><span leaf="">" "</span></span><span leaf="">, df</span><span><span leaf="">$cell_type</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">head(df)</span><span leaf=""><br></span><span leaf="">table(df</span><span><span leaf="">$cell_type</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 设置因子水平</span></span><span leaf=""><br></span><span leaf="">df</span><span><span leaf="">$cell_type</span></span><span leaf=""> &lt;- factor(df</span><span><span leaf="">$cell_type</span></span><span leaf="">, levels = rev(c(</span><span><span leaf="">"Plasma cell"</span></span><span leaf="">, </span><span><span leaf="">"Endothelial cell"</span></span><span leaf="">,</span><span><span leaf="">"Fibroblast"</span></span><span leaf="">,</span><span><span leaf="">"T cell"</span></span><span leaf="">,</span><span><span leaf="">"Dendritic cell"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                                                    </span><span><span leaf="">"B cell"</span></span><span leaf="">,</span><span><span leaf="">"Myeloid cell"</span></span><span leaf="">,</span><span><span leaf="">"Mast cell"</span></span><span leaf="">,</span><span><span leaf="">"Ovarian cancer cell"</span></span><span leaf="">)))</span><span leaf=""><br></span><span leaf="">str(df)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100062629" data-ratio="0.1111111111111111" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWlSQTJZHxyzLWo7unpV7Cic44CUpsCZuKKtUuDvzSrNyVIFTjr9AZicyg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="972" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWlSQTJZHxyzLWo7unpV7Cic44CUpsCZuKKtUuDvzSrNyVIFTjr9AZicyg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h4 data-tool="mdnice编辑器"><span></span><span leaf="">使用ggplot2绘图：</span><span></span></h4><pre data-tool="mdnice编辑器"><code><span><span leaf="">## 绘图</span></span><span leaf=""><br></span><span leaf="">colors &lt;- c(</span><span><span leaf="">"<a topic-id="mgyyu3cz-7az8pg" data-topic="1">#cae2ee</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mgyyu3cz-7ltye3" data-topic="1">#ded0e5</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mgyyu3cz-v9tg7m" data-topic="1">#a68bc2</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mgyyu3cz-rgbbhb" data-topic="1">#85c680</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mgyyu3cz-6ue8ed" data-topic="1">#d09b7e</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mgyyu3cz-tq9lv5" data-topic="1">#79aed2</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mgyyu3cz-r3qtp9" data-topic="1">#ffb266</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mgyyu3cz-h2a6sq" data-topic="1">#dcca83</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mgyyu3d0-v8qur5" data-topic="1">#ee7677</a>"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">names(colors) &lt;- c(</span><span><span leaf="">"Plasma cell"</span></span><span leaf="">, </span><span><span leaf="">"Endothelial cell"</span></span><span leaf="">,</span><span><span leaf="">"Fibroblast"</span></span><span leaf="">,</span><span><span leaf="">"T cell"</span></span><span leaf="">,</span><span><span leaf="">"Dendritic cell"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                   </span><span><span leaf="">"B cell"</span></span><span leaf="">,</span><span><span leaf="">"Myeloid cell"</span></span><span leaf="">,</span><span><span leaf="">"Mast cell"</span></span><span leaf="">,</span><span><span leaf="">"Ovarian cancer cell"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">colors</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">library(ggridges)</span><span leaf=""><br></span><span leaf="">p &lt;- ggplot(df, aes(x = percent.mt, y = cell_type, fill = cell_type)) +</span><span leaf=""><br></span><span leaf="">  geom_density_ridges(quantile_lines = TRUE, quantiles = 2, color= </span><span><span leaf="">'white'</span></span><span leaf="">, </span><span><span leaf=""># <a topic-id="mgyyu3d0-1earnr" data-topic="1">#显示分位数线</a>,2为显示中位数，颜色为白色</span></span><span leaf=""><br></span><span leaf="">                      rel_min_height = 0.01, </span><span><span leaf=""><a topic-id="mgyyu3d0-mtxqc9" data-topic="1">#尾部修剪</a>，数值越大修剪程度越高</span></span><span leaf=""><br></span><span leaf="">                      scale = 2, </span><span><span leaf=""><a topic-id="mgyyu3d0-87u3cg" data-topic="1">#山脊重叠程度</a>，数值越大重叠度越高</span></span><span leaf=""><br></span><span leaf="">                      ) +</span><span leaf=""><br></span><span leaf="">  scale_fill_manual(values = colors) + </span><span leaf=""><br></span><span leaf="">  ggtitle(</span><span><span leaf="">"Cell type"</span></span><span leaf="">) + </span><span leaf=""><br></span><span leaf="">  theme_classic()</span><span leaf=""><br></span><span leaf="">p</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100062631" data-ratio="0.8080924855491329" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWXQsRezkic7300QooTo8syxe5icvJQHrtcPHdveKXcOOuwQbvfA82njFg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="865" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWXQsRezkic7300QooTo8syxe5icvJQHrtcPHdveKXcOOuwQbvfA82njFg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h4 data-tool="mdnice编辑器"><span></span><span leaf="">美化修整一下：</span><span></span></h4><pre data-tool="mdnice编辑器"><code><span><span leaf="">## 美化</span></span><span leaf=""><br></span><span leaf="">p1 &lt;- p + </span><span leaf=""><br></span><span leaf="">  scale_x_continuous(limits = c(0.0, 20), breaks = seq(0, 20, by = 5)) +  </span><span><span leaf=""># 设置线粒体范围0-20%</span></span><span leaf=""><br></span><span leaf="">  geom_vline(xintercept = c(0.0, 20),size = 0.5, color = </span><span><span leaf="">'grey'</span></span><span leaf="">,lty = </span><span><span leaf="">'dashed'</span></span><span leaf="">) + </span><span><span leaf=""># 添加两条竖着的虚线</span></span><span leaf=""><br></span><span leaf="">  ylab(label = </span><span><span leaf="">""</span></span><span leaf="">) + </span><span leaf=""><br></span><span leaf="">  theme(legend.position = </span><span><span leaf="">'none'</span></span><span leaf="">,  </span><span><span leaf=""># 去掉图例</span></span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># 设置标题居中、加粗、放大</span></span><span leaf=""><br></span><span leaf="">        plot.title = element_text(hjust = 0.5, size = 14, face = </span><span><span leaf="">"bold"</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># 加粗和放大坐标轴线</span></span><span leaf=""><br></span><span leaf="">        axis.line = element_line(color = </span><span><span leaf="">"black"</span></span><span leaf="">, size = 0.8),</span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># 加粗和放大x坐标轴刻度</span></span><span leaf=""><br></span><span leaf="">        axis.ticks = element_line(color = </span><span><span leaf="">"black"</span></span><span leaf="">, size = 0.8),</span><span leaf=""><br></span><span leaf="">        axis.ticks.length = unit(0.2, </span><span><span leaf="">"cm"</span></span><span leaf="">),  </span><span><span leaf=""># x坐标轴刻度线长度</span></span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># 加粗和放大x坐标轴刻度标签</span></span><span leaf=""><br></span><span leaf="">        axis.text = element_text(color = </span><span><span leaf="">"black"</span></span><span leaf="">, size = 14, face = </span><span><span leaf="">"bold"</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># 加粗和放大x坐标轴标题</span></span><span leaf=""><br></span><span leaf="">        axis.title = element_text(color = </span><span><span leaf="">"black"</span></span><span leaf="">, size = 16, face = </span><span><span leaf="">"bold"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">        )</span><span leaf=""><br></span><span leaf="">p1</span><span leaf=""><br></span><span leaf="">ggsave(filename = </span><span><span leaf="">"Fig5a.pdf"</span></span><span leaf="">,width = 5.5,height = 5,plot = p1)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">最终结果如下：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100062634" data-ratio="0.9135483870967742" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWLBz86DnMv03bGWdrtG27IvUYTiaO9hvdibzfRYUvLkVv28wZtXgWuOuA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="775" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwsO8NNGAEYXvZNvQCxcpLWLBz86DnMv03bGWdrtG27IvUYTiaO9hvdibzfRYUvLkVv28wZtXgWuOuA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">今天分享到这~</span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">如果上面的内容对你有帮助，欢迎一键三连~</span></span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">友情转发：</span></span></p></section><ul><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247545889&amp;idx=1&amp;sn=b7b37a458eead4645137126753d58c34&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课10月班" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">生信入门&amp;数据挖掘线上直播课10月班</span></a><span textstyle="">，你的生物信息学入门课</span></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525079&amp;idx=1&amp;sn=0b997af16a58195b4192691373048fd5&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" textvalue="满足你生信分析计算需求的低价解决方案" data-itemshowtype="0" linktype="text" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=1679199708449144836&amp;scene=173&amp;subscene=207&amp;sessionid=1745492310&amp;enterid=1745492314&amp;from_msgid=2247541298&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信故事会" data-itemshowtype="0" linktype="text" data-linktype="2">生信故事会</a>，来看看他们的生信入门故事</span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=3690970204957147140&amp;scene=173&amp;subscene=207&amp;sessionid=1745066271&amp;enterid=1745066274&amp;from_msgid=2247540702&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信马拉松答疑专辑" data-itemshowtype="0" linktype="text" data-linktype="2">生信马拉松答疑专辑</a>，获取你的生信专属答疑</span></section></li></ul><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/0kpG2t4lo-iesSoBrRbm2A",target="_blank" rel="noopener noreferrer">原文链接</a>
