---
title: "SATURN：跨物种的单细胞数据集整合"
date: 2025-10-31T11:36:59Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
SATURN：跨物种的单细胞数据集整合 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><blockquote><span></span><p><span leaf="">Toward universal cell embeddings: integrating single-cell RNA-seq datasets across species with SATURN</span></p><p><span leaf="">刊登日期：16 February 2024</span></p><p><span leaf="">发表杂志：nature methods</span></p><p><span leaf="">IF：32.1</span></p></blockquote><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100054175" data-ratio="0.4685185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los96rFZIibMcTPEIMF7hSD38VojialxpdQdib9QDWoVL7mYzjA0fGydP0011uIuOEBT0Gz3ic0FZ2Fkjrw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los96rFZIibMcTPEIMF7hSD38VojialxpdQdib9QDWoVL7mYzjA0fGydP0011uIuOEBT0Gz3ic0FZ2Fkjrw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">跨物种整合的主要挑战在于不同数据集包含不同的基因，而这些基因之间可能不存在一一对应的同源关系。如果仅将每个物种的基因集合限制为共有的“一对一”同源基因，将导致大量生物学相关信息的丢失。SATURN 通过把“蛋白嵌入 + RNA 表达”耦合，提出了宏基因"macrogene"的概念，从而克服了这一问题。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">SATURN模型原理</span></span><span></span><span></span></h2><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100054174" data-ratio="0.5712962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los96rFZIibMcTPEIMF7hSD38V2PqAv3AGWOJib1gicI549AXlmE3fXbcevHYwmNTFYTfJvnPw07icftcCg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los96rFZIibMcTPEIMF7hSD38V2PqAv3AGWOJib1gicI549AXlmE3fXbcevHYwmNTFYTfJvnPw07icftcCg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">1. 输入与宏基因初始化</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">首先，模型的输入是：</span></p><ul><li><section><span leaf="">多个物种的 scRNA-seq 原始 count 数据集，每个数据集都需要带有细胞类型标签（本身自带的或者可以通过聚类获得）；</span></section></li><li><section><span leaf="">蛋白质序列信息：每个基因对应的氨基酸序列。</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">然后使用蛋白质语言模型 ESM2 处理每个基因的蛋白质序列，为每个基因生成一个 5120 维的高维向量，这个向量可以捕捉蛋白质的结构和功能特性，具体实现细节可以看https://www.science.org/doi/10.1126/science.ade2574这篇论文。</span></p><p data-tool="mdnice编辑器"><span leaf="">接下来，SATURN 将所有物种的所有基因的蛋白质嵌入向量聚集在一起，使用 </span><code><span leaf="">k-means</span></code><span leaf=""> 聚类算法将这些向量划分为 M 个簇，每个簇的中心点，把它定义为一个宏基因，宏基因代表的是一组在蛋白质嵌入空间中相近，所以功能可能相关的基因。</span></p><p data-tool="mdnice编辑器"><span leaf="">对于每个基因 </span><span data-formula="g"><span data-formula="g"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 477 647" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g></g></g><g></g></svg></span></span><span leaf=""> 和每个宏基因 </span><span data-formula="m"><span data-formula="m"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 878 453" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g></g></svg></span></span><span leaf=""> 计算它们的欧式距离排秩，SATURN 可以通过距离的秩次计算得到一个初始权重 </span><span data-formula="W_{g,m}"><span data-formula="W_{g,m}"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 2148.7 978" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="TeXAtom" transform="translate(944, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mo" transform="translate(477, 0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(755, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g></g><g></g></svg></span></span><span leaf="">，距离越近则权重越大，这个权重可以进行训练，且始终是个正值，确保每个基因都对与它功能相似的宏基因有正向贡献。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">2. 预训练</span></span><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">（1）编码过程</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">对一个细胞的基因表达 </span><span data-formula="X_c"><span data-formula="X_c"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 1184.2 840.8" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="58" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mi" transform="translate(828, -150) scale(0.707)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g></g><g></g></svg></span></span><span leaf=""> ，通过基因-宏基因权重矩阵 </span><span data-formula="W"><span data-formula="W"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 1048 705" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g></g></g><g></g></svg></span></span><span leaf=""> 聚合，从而计算宏基因的基因表达 </span><span data-formula="e_c"><span data-formula="e_c"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 822.2 599.8" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(466, -150) scale(0.707)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g></g><g></g></svg></span></span><span leaf="">，将不同物种、不同名称但功能相似的基因的表达信号汇总到共享的宏基因上。然后，宏基因表达向量 </span><span data-formula="e_c"><span data-formula="e_c"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 822.2 599.8" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(466, -150) scale(0.707)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g></g><g></g></svg></span></span><span leaf=""> 通过一个编码器神经网络，生成一个低维的细胞嵌入 </span><span data-formula="z_c"><span data-formula="z_c"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 821.2 599.8" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mi" transform="translate(465, -150) scale(0.707)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g></g><g></g></svg></span></span><span leaf="">。</span></p><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">（2）解码过程</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">解码过程的目标是从低维细胞嵌入 </span><span data-formula="z_c"><span data-formula="z_c"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 821.2 599.8" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mi" transform="translate(465, -150) scale(0.707)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g></g><g></g></svg></span></span><span leaf=""> 重建原始的基因表达向量 </span><span data-formula="X_c"><span data-formula="X_c"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 1184.2 840.8" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="58" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mi" transform="translate(828, -150) scale(0.707)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g></g><g></g></svg></span></span><span leaf="">。与编码过程相反，解码器需要将压缩的细胞信息"解压缩"回原始的基因表达空间。解码器包含三个并行的神经网络头，每个头负责生成</span><strong><span leaf="">零膨胀负二项分布（ZINB）</span></strong><span leaf="">的一个参数：均值参数 </span><span data-formula="\mu_c"><span data-formula="\mu_c"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -442 959.2 658" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="3BC" d="M58 -216Q44 -216 34 -208T23 -186Q23 -176 96 116T173 414Q186 442 219 442Q231 441 239 435T249 423T251 413Q251 401 220 279T187 142Q185 131 185 107V99Q185 26 252 26Q261 26 270 27T287 31T302 38T315 45T327 55T338 65T348 77T356 88T365 100L372 110L408 253Q444 395 448 404Q461 431 491 431Q504 431 512 424T523 412T525 402L449 84Q448 79 448 68Q448 43 455 35T476 26Q485 27 496 35Q517 55 537 131Q543 151 547 152Q549 153 557 153H561Q580 153 580 144Q580 138 575 117T555 63T523 13Q510 0 491 -8Q483 -10 467 -10Q446 -10 429 -4T402 11T385 29T376 44T374 51L368 45Q362 39 350 30T324 12T288 -4T246 -11Q199 -11 153 12L129 -85Q108 -167 104 -180T92 -202Q76 -216 58 -216Z"></path></g><g data-mml-node="mi" transform="translate(603, -150) scale(0.707)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g></g><g></g></svg></span></span><span leaf="">、分散度参数 </span><span data-formula="\theta"><span data-formula="\theta"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -705 469 715" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="3B8" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g><g></g></svg></span></span><span leaf=""> 和零膨胀参数 </span><span data-formula="o_c"><span data-formula="o_c"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -441 841.2 598.8" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(485, -150) scale(0.707)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g></g><g></g></svg></span></span><span leaf="">。</span></p><p data-tool="mdnice编辑器"><span leaf="">重构损失用于衡量解码器重建原始基因表达数据的能力，采用零膨胀负二项分布的负对数似然作为损失函数。为了防止训练过程中丢失蛋白质功能信息，SATURN 增加了一个正则化损失项，确保学习到的宏基因空间始终锚定在生物学功能上。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">3. 微调</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">这一阶段通过</span><strong><span leaf="">弱监督学习</span></strong><span leaf="">来实现跨物种的细胞类型对齐。SATURN 使用</span><strong><span leaf="">三重边际损失</span></strong><span leaf="">，主要方法是：当前嵌入空间中，为一个物种（如青蛙）的某个细胞（锚点）寻找它在另一个物种（如斑马鱼）中的最近邻，然后检查这个最近邻细胞在其自身物种中的最近邻是否与原始锚点细胞属于同一细胞类型。如果是，则构成一个有效的正样本对，负样本则从不是正样本的细胞里随机选择。三重边际损失的目标是将锚点细胞与正样本细胞之间的距离拉近，同时将锚点细胞与负样本细胞之间的距离推远。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">4. 输出与应用</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">经过上面的步骤，SATURN 最终生成了一个物种共享的、低维的细胞嵌入空间，这个空间中细胞之间的距离仅由它们的生物学类型和状态决定，而与它们来自哪个物种无关。这个通用的细胞嵌入可以用于跨物种的细胞标签转移、多物种联合的可视化、在宏基因层面进行差异表达分析、细胞类型重注释等等。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">5. 限制</span></span><span></span></h3><ul><li><section><span leaf="">需要物种有高质量的参考蛋白质组数据，对于许多非模式生物而言，这种参考数据可能不存在或者不完整，整合就会受到限制；</span></section></li><li><section><span leaf="">SATURN 的微调阶段</span><strong><span leaf="">严重依赖</span></strong><span leaf="">每个数据集内部预先提供的细胞类型标签，这些标签的质量将直接影响跨物种细胞类型对齐的效果；</span></section></li><li><section><span leaf="">对于细胞数量极少的稀有细胞类型难以进行对齐。</span></section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">蛋白嵌入向量的生成</span></span><span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">使用 SATURN 进行跨物种整合之前首先需要利用 ESM2 模型将各个物种的蛋白质序列信息转换为蛋白嵌入向量，这里我整合的数据集是人和小鼠的。</span></p><p data-tool="mdnice编辑器"><span leaf="">先下载 FASTA 格式的人和小鼠蛋白序列数据：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">mkdir proteome</span><span leaf=""><br></span><span><span leaf="">cd</span></span><span leaf=""> proteome/</span><span leaf=""><br></span><span leaf="">wget http://ftp.ensembl.org/pub/release-115/fasta/homo_sapiens/pep/Homo_sapiens.GRCh38.pep.all.fa.gz</span><span leaf=""><br></span><span leaf="">wget http://ftp.ensembl.org/pub/release-115/fasta/mus_musculus/pep/Mus_musculus.GRCm39.pep.all.fa.gz</span><span leaf=""><br></span><span leaf="">gunzip Homo_sapiens.GRCh38.pep.all.fa.gz</span><span leaf=""><br></span><span leaf="">gunzip Mus_musculus.GRCm39.pep.all.fa.gz</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">接下来通过 </span><code><span leaf="">clean_fasta.py</span></code><span leaf=""> 脚本去除包含终止密码子的序列，以便用于 ESM 模型：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">python ../../../SATURN-main/protein_embeddings/clean_fasta.py --data_path Homo_sapiens.GRCh38.pep.all.fa --save_path Homo_sapiens.GRCh38.pep.all_clean.fa</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Number of original sequences = 245,535</span><span leaf=""><br></span><span leaf="">100%|███████████████████████████████████████████████████| 245535/245535 [00:01&lt;00:00, 148168.20it/s]</span><span leaf=""><br></span><span leaf="">Number of cleaned sequences = 245,383</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">python ../../../SATURN-main/protein_embeddings/clean_fasta.py --data_path Mus_musculus.GRCm39.pep.all.fa --save_path Mus_musculus.GRCm39.pep.all_clean.fa</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Number of original sequences = 66,668</span><span leaf=""><br></span><span leaf="">100%|███████████████████████████████████████████████████| 66668/66668 [00:00&lt;00:00, 193554.76it/s]</span><span leaf=""><br></span><span leaf="">Number of cleaned sequences = 66,565</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">指定一下 Torch hub 缓存目录：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">export</span></span><span leaf=""> TORCH_HOME=</span><span><span leaf="">"</span><span><span leaf="">$PWD</span></span><span leaf="">"</span></span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">然后使用 ESM2 来生成蛋白嵌入向量，具体见</span><span leaf="" data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;data-tool&quot;:&quot;mdnice编辑器&quot;,&quot;data-website&quot;:&quot;https://www.mdnice.com&quot;,&quot;style&quot;:&quot;margin-top: 0px;margin-bottom: 0px;margin-left: 0px;margin-right: 0px;padding-top: 0px;padding-bottom: 0px;padding-left: 10px;padding-right: 10px;background-attachment: scroll;background-clip: border-box;background-color: rgba(0, 0, 0, 0);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;font-family: Optima, 'Microsoft YaHei', PingFangSC-regular, serif;font-size: 16px;color: rgb(0, 0, 0);line-height: 1.5em;word-spacing: 0em;letter-spacing: 0em;word-break: break-word;overflow-wrap: break-word;text-align: left;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;data-tool&quot;:&quot;mdnice编辑器&quot;,&quot;style&quot;:&quot;color: rgb(0, 0, 0);font-size: 16px;line-height: 1.8em;letter-spacing: 0em;text-align: left;text-indent: 0em;margin-top: 0px;margin-bottom: 0px;margin-left: 0px;margin-right: 0px;padding-top: 8px;padding-bottom: 8px;padding-left: 0px;padding-right: 0px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">https://github.com/facebookresearch/esm</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">#!/bin/bash</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohl-taw38j" data-topic="1">#SBATCH</a> --job-name=human_embedding</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-caivzt" data-topic="1">#SBATCH</a> --partition=gpu</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-av7o7e" data-topic="1">#SBATCH</a> --gres=gpu:2</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-bwywwc" data-topic="1">#SBATCH</a> --cpus-per-task=8</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-5fl1qo" data-topic="1">#SBATCH</a> --mem=200G</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-ps2wr8" data-topic="1">#SBATCH</a> --output=logs/human_embedding_%j.log</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-b74xnf" data-topic="1">#SBATCH</a> --error=logs/human_embedding_%j.err</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">export</span></span><span leaf=""> PYTHONUNBUFFERED=1</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">python esm-main/scripts/extract.py \</span><span leaf=""><br></span><span leaf="">        esm1b_t33_650M_UR50S \</span><span leaf=""><br></span><span leaf="">        proteome/Homo_sapiens.GRCh38.pep.all_clean.fa \</span><span leaf=""><br></span><span leaf="">        embedding/Homo_sapiens.GRCh38.pep.all_clean.fa_esm1b \</span><span leaf=""><br></span><span leaf="">        --include mean</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">其中 </span><code><span leaf="">esm1b_t33_650M_UR50S</span></code><span leaf=""> 指的是旧版 ESM 模型的权重文件，</span><code><span leaf="">esm1b</span></code><span leaf=""> 表示模型第一代b版，</span><code><span leaf="">t33</span></code><span leaf=""> 表示 Transformer 层数为 33 层，</span><code><span leaf="">650M</span></code><span leaf=""> 表示可训练参数量约 650 million，</span><code><span leaf="">UR50S</span></code><span leaf=""> 表示训练语料。模型会将每一个蛋白序列的嵌入向量生成一个单独的 </span><code><span leaf="">.pt</span></code><span leaf=""> 文件并存储在</span><code><span leaf="">embedding/Homo_sapiens.GRCh38.pep.all_clean.fa_esm1b</span></code><span leaf=""> 文件夹下。下面是运行时的部分输出：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Transferred model to GPU</span><span leaf=""><br></span><span leaf="">Read proteome/Homo_sapiens.GRCh38.pep.all_clean.fa </span><span><span leaf="">with</span></span><span leaf=""> </span><span><span leaf="">245383</span></span><span leaf=""> sequences</span><span leaf=""><br></span><span leaf="">Processing </span><span><span leaf="">1</span></span><span leaf=""> of </span><span><span leaf="">31819</span></span><span leaf=""> batches (</span><span><span leaf="">372</span></span><span leaf=""> sequences)</span><span leaf=""><br></span><span leaf="">Processing </span><span><span leaf="">2</span></span><span leaf=""> of </span><span><span leaf="">31819</span></span><span leaf=""> batches (</span><span><span leaf="">273</span></span><span leaf=""> sequences)</span><span leaf=""><br></span><span leaf="">Processing </span><span><span leaf="">3</span></span><span leaf=""> of </span><span><span leaf="">31819</span></span><span leaf=""> batches (</span><span><span leaf="">227</span></span><span leaf=""> sequences)</span><span leaf=""><br></span><span leaf="">Processing </span><span><span leaf="">4</span></span><span leaf=""> of </span><span><span leaf="">31819</span></span><span leaf=""> batches (</span><span><span leaf="">195</span></span><span leaf=""> sequences)</span><span leaf=""><br></span><span leaf="">Processing </span><span><span leaf="">5</span></span><span leaf=""> of </span><span><span leaf="">31819</span></span><span leaf=""> batches (</span><span><span leaf="">178</span></span><span leaf=""> sequences)</span><span leaf=""><br></span><span leaf="">Processing </span><span><span leaf="">6</span></span><span leaf=""> of </span><span><span leaf="">31819</span></span><span leaf=""> batches (</span><span><span leaf="">170</span></span><span leaf=""> sequences)</span><span leaf=""><br></span><span leaf="">Processing </span><span><span leaf="">7</span></span><span leaf=""> of </span><span><span leaf="">31819</span></span><span leaf=""> batches (</span><span><span leaf="">157</span></span><span leaf=""> sequences)</span><span leaf=""><br></span><span leaf="">Processing </span><span><span leaf="">8</span></span><span leaf=""> of </span><span><span leaf="">31819</span></span><span leaf=""> batches (</span><span><span leaf="">151</span></span><span leaf=""> sequences)</span><span leaf=""><br></span><span leaf="">Processing </span><span><span leaf="">9</span></span><span leaf=""> of </span><span><span leaf="">31819</span></span><span leaf=""> batches (</span><span><span leaf="">141</span></span><span leaf=""> sequences)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">接下来按照类似的步骤对小鼠的蛋白序列生成嵌入向量：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">#!/bin/bash</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-ioiv57" data-topic="1">#SBATCH</a> --job-name=mouse_embedding</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-kulin7" data-topic="1">#SBATCH</a> --partition=gpu</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-o2u5fe" data-topic="1">#SBATCH</a> --gres=gpu:2</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-ed0hsx" data-topic="1">#SBATCH</a> --cpus-per-task=8</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-cufp2m" data-topic="1">#SBATCH</a> --mem=200G</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohm-rbmtls" data-topic="1">#SBATCH</a> --output=logs/mouse_embedding_%j.log</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mhelvohn-4isf3j" data-topic="1">#SBATCH</a> --error=logs/mouse_embedding_%j.err</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">export</span></span><span leaf=""> PYTHONUNBUFFERED=1</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">python esm-main/scripts/extract.py \</span><span leaf=""><br></span><span leaf="">        esm1b_t33_650M_UR50S \</span><span leaf=""><br></span><span leaf="">        proteome/Mus_musculus.GRCm39.pep.all_clean.fa \</span><span leaf=""><br></span><span leaf="">        embedding/Mus_musculus.GRCm39.pep.all_clean.fa_esm1b \</span><span leaf=""><br></span><span leaf="">        --include mean</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">这里的结果还需要等一段时间，今天先到这里，其他部分下次再分享~</span></p></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/S127x4Zp1D6wEiDrH-Yo-g",target="_blank" rel="noopener noreferrer">原文链接</a>
