---
title: "单细胞转录组上下游分析一文打通"
date: 2025-10-22T08:00:43Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
单细胞转录组上下游分析一文打通 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-from="0" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-id="MzkyMTI1MTYxNA==" data-is_biz_ban="0" data-service_type="1" data-verify_status="1"></mp-common-profile></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">引言</span></span><span></span></h2><blockquote><span></span><p><span leaf="">走一个</span><strong><span leaf="">酒精性脂肪性肝病（NAFLD）肝脏</span></strong><span leaf="">的单细胞基因表达谱的上下游分析。GSE 编号为 </span><strong><span leaf="">GSE270583</span></strong><span leaf="">，四个样本。</span></p></blockquote><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035924" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2FoTw3iaawBNfRKBoGfXhibZic2UrGpwbNDlcIsJKChX7SH6ghcfU9RF7Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2FoTw3iaawBNfRKBoGfXhibZic2UrGpwbNDlcIsJKChX7SH6ghcfU9RF7Q/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">原始数据下载</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">使用 </span><strong><span leaf="">aspera</span></strong><span leaf=""> 下载原始 fastq 文件，查看文件每个样本有 </span><strong><span leaf="">r1</span></strong><span leaf=""> 和 </span><strong><span leaf="">r2</span></strong><span leaf=""> 文件，但是 r1 和 r2 的序列都是 </span><strong><span leaf="">150bp</span></strong><span leaf=""> 长度，可能 r1 的 </span><strong><span leaf="">barcode+umi</span></strong><span leaf=""> 序列包含了其他接头序列什么的没有去除：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">#!/usr/bin/env bash</span></span><br><span leaf="">ascp -QT -l 300m -P33001 -i </span><span><span leaf="">$HOME</span></span><span leaf="">/.aspera/connect/etc/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:vol1/fastq/SRR295/021/SRR29534021/SRR29534021_1.fastq.gz . &amp;&amp; mv SRR29534021_1.fastq.gz SRR29534021_GSM8347727_NCD_replicate_1_ScRNA-seq_Mus_musculus_RNA-Seq_1.fastq.gz</span><br><span leaf="">ascp -QT -l 300m -P33001 -i </span><span><span leaf="">$HOME</span></span><span leaf="">/.aspera/connect/etc/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:vol1/fastq/SRR295/021/SRR29534021/SRR29534021_2.fastq.gz . &amp;&amp; mv SRR29534021_2.fastq.gz SRR29534021_GSM8347727_NCD_replicate_1_ScRNA-seq_Mus_musculus_RNA-Seq_2.fastq.gz</span><br><span leaf="">ascp -QT -l 300m -P33001 -i </span><span><span leaf="">$HOME</span></span><span leaf="">/.aspera/connect/etc/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:vol1/fastq/SRR295/018/SRR29534018/SRR29534018_1.fastq.gz . &amp;&amp; mv SRR29534018_1.fastq.gz SRR29534018_GSM8347730_JQF_replicate_1_ScRNA-seq_Mus_musculus_RNA-Seq_1.fastq.gz</span><br><span leaf="">ascp -QT -l 300m -P33001 -i </span><span><span leaf="">$HOME</span></span><span leaf="">/.aspera/connect/etc/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:vol1/fastq/SRR295/018/SRR29534018/SRR29534018_2.fastq.gz . &amp;&amp; mv SRR29534018_2.fastq.gz SRR29534018_GSM8347730_JQF_replicate_1_ScRNA-seq_Mus_musculus_RNA-Seq_2.fastq.gz</span><br><span leaf="">ascp -QT -l 300m -P33001 -i </span><span><span leaf="">$HOME</span></span><span leaf="">/.aspera/connect/etc/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:vol1/fastq/SRR295/019/SRR29534019/SRR29534019_1.fastq.gz . &amp;&amp; mv SRR29534019_1.fastq.gz SRR29534019_GSM8347729_HFD_replicate_2_ScRNA-seq_Mus_musculus_RNA-Seq_1.fastq.gz</span><br><span leaf="">ascp -QT -l 300m -P33001 -i </span><span><span leaf="">$HOME</span></span><span leaf="">/.aspera/connect/etc/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:vol1/fastq/SRR295/019/SRR29534019/SRR29534019_2.fastq.gz . &amp;&amp; mv SRR29534019_2.fastq.gz SRR29534019_GSM8347729_HFD_replicate_2_ScRNA-seq_Mus_musculus_RNA-Seq_2.fastq.gz</span><br><span leaf="">ascp -QT -l 300m -P33001 -i </span><span><span leaf="">$HOME</span></span><span leaf="">/.aspera/connect/etc/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:vol1/fastq/SRR295/020/SRR29534020/SRR29534020_1.fastq.gz . &amp;&amp; mv SRR29534020_1.fastq.gz SRR29534020_GSM8347728_HFD_replicate_1_ScRNA-seq_Mus_musculus_RNA-Seq_1.fastq.gz</span><br><span leaf="">ascp -QT -l 300m -P33001 -i </span><span><span leaf="">$HOME</span></span><span leaf="">/.aspera/connect/etc/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:vol1/fastq/SRR295/020/SRR29534020/SRR29534020_2.fastq.gz . &amp;&amp; mv SRR29534020_2.fastq.gz SRR29534020_GSM8347728_HFD_replicate_1_ScRNA-seq_Mus_musculus_RNA-Seq_2.fastq.gz</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">下载参考基因组索引</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">去 </span><strong><span leaf="">cellranger</span></strong><span leaf=""> 官网下载对应物种的索引文件：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">wget </span><span><span leaf="">"https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-GRCm39-2024-A.tar.gz"</span></span><br><br><span leaf="">tar -zxvf refdata-gex-GRCm39-2024-A.tar.gz</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">定量</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">去官网下载 cellranger 软件，然后进行定量：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">for</span></span><span leaf=""> i </span><span><span leaf="">in</span></span><span leaf=""> HFD_rep1 HFD_rep2 JQF_rep1 NCD_rep1</span><br><span><span leaf="">do</span></span><br><span leaf=""> ../../cellranger_test/cellranger-9.0.0/cellranger count \</span><br><span leaf="">  --id </span><span><span leaf="">${i}</span></span><span leaf=""> \</span><br><span leaf="">  --transcriptome ../refdata-gex-GRCm39-2024-A \</span><br><span leaf="">  --fastqs ../1.raw-data/ \</span><br><span leaf="">    --localcores 15 \</span><br><span leaf="">  --sample </span><span><span leaf="">${i}</span></span><span leaf=""> \</span><br><span leaf="">    --chemistry SC3Pv3 \</span><br><span leaf="">  --create-bam </span><span><span leaf="">true</span></span><span leaf=""> \</span><br><span leaf="">    --nosecondary</span><br><span><span leaf="">done</span></span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035923" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2tR710nm4b49a9yicI9JbMmy7ujvE3aACFk77lsOQ4qAw93iaQHkNw79g/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2tR710nm4b49a9yicI9JbMmy7ujvE3aACFk77lsOQ4qAw93iaQHkNw79g/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">每个样本文件夹下的 </span><strong><span leaf="">outs</span></strong><span leaf=""> 文件夹就是输出结果：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035922" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ21CQtQaqcjAvbNK6bxI4ibiaFcPOdAciaVMvOcj6ZeibsGunsQHDMmNaYEg/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ21CQtQaqcjAvbNK6bxI4ibiaFcPOdAciaVMvOcj6ZeibsGunsQHDMmNaYEg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">下游分析</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">标准 seurat 流程，批量读取表达矩阵：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">library(Seurat)</span><br><br><span leaf="">samples &lt;- c(</span><span><span leaf="">"NCD_rep1"</span></span><span leaf="">,</span><span><span leaf="">"JQF_rep1"</span></span><span leaf="">,</span><span><span leaf="">"HFD_rep1"</span></span><span leaf="">,</span><span><span leaf="">"HFD_rep2"</span></span><span leaf="">)</span><br><br><span><span leaf=""># create SeuratObject</span></span><br><span><span leaf=""># x = 1</span></span><br><span leaf="">lapply(seq_along(samples), </span><span><span leaf="">function</span></span><span leaf="">(x){</span><br><span leaf="">  path &lt;- paste(</span><span><span leaf="">"~/junjun_proj/17.sc_test/GSE270583-proj/2.count-data/"</span></span><span leaf="">,</span><br><span leaf="">                samples[x],</span><br><span leaf="">                </span><span><span leaf="">"/outs/filtered_feature_bc_matrix"</span></span><span leaf="">,sep = </span><span><span leaf="">""</span></span><span leaf="">)</span><br><br><span leaf="">  tmp &lt;- Read10X(path)</span><br><br><span leaf="">  sct &lt;- CreateSeuratObject(counts = tmp,</span><br><span leaf="">                            project = samples[x],</span><br><span leaf="">                            min.cells = 5,</span><br><span leaf="">                            min.features = 200)</span><br><br><span leaf="">  </span><span><span leaf=""># calculate mito</span></span><br><span leaf="">  sct[[</span><span><span leaf="">"percent.mt"</span></span><span leaf="">]] &lt;- PercentageFeatureSet(sct, pattern = </span><span><span leaf="">"mt-"</span></span><span leaf="">)</span><br><br><span leaf="">  </span><span><span leaf="">return</span></span><span leaf="">(sct)</span><br><span leaf="">}) -&gt; sct.list</span><br><br><br><span><span leaf=""># combine list into object</span></span><br><span leaf="">sct.all &lt;- merge(x = sct.list[[1]],</span><br><span leaf="">                 y = sct.list[-1],</span><br><span leaf="">                 add.cell.ids = samples)</span><br><span leaf="">sct.all</span><br><span><span leaf=""># An object of class Seurat</span></span><br><span><span leaf=""># 23474 features across 32392 samples within 1 assay</span></span><br><span><span leaf=""># Active assay: RNA (23474 features, 0 variable features)</span></span><br><span><span leaf="">#  4 layers present: counts.NCD_rep1, counts.JQF_rep1, counts.HFD_rep1, counts.HFD_rep2</span></span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">简单质控：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># Visualize mt</span></span><br><span leaf="">VlnPlot(sct.all, features = c(</span><span><span leaf="">"nFeature_RNA"</span></span><span leaf="">, </span><span><span leaf="">"nCount_RNA"</span></span><span leaf="">,</span><span><span leaf="">"percent.mt"</span></span><span leaf="">),</span><br><span leaf="">        group.by = </span><span><span leaf="">"orig.ident"</span></span><span leaf="">,pt.size = 0)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035925" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ22MibtmTS6cqIvrxXDxmum7rDicpa5KJOBvVKLovxibuPdlxLibm07So0eg/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ22MibtmTS6cqIvrxXDxmum7rDicpa5KJOBvVKLovxibuPdlxLibm07So0eg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">过滤细胞，然后标准化：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># filter cells</span></span><br><span leaf="">sct.ft &lt;- subset(sct.all, percent.mt &lt; 5 &amp; nFeature_RNA &lt; 7500)</span><br><br><span leaf="">sct.ft &lt;- SCTransform(object = sct.ft,</span><br><span leaf="">                      variable.features.n = 3000,</span><br><span leaf="">                      vars.to.regress = </span><span><span leaf="">"percent.mt"</span></span><span leaf="">)</span><br><br><span leaf="">DefaultAssay(sct.ft)</span><br><span><span leaf=""># [1] "SCT"</span></span><br><br><span leaf="">saveRDS(sct.ft,file = </span><span><span leaf="">"sct.ft.rda"</span></span><span leaf="">)</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">接着降维、聚类和分群：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">sct.ft &lt;- RunPCA(sct.ft,features = VariableFeatures(object = sct.ft))</span><br><span leaf="">sct.ft &lt;- FindNeighbors(sct.ft, reduction = </span><span><span leaf="">"pca"</span></span><span leaf="">, dims = 1:30)</span><br><br><span><span leaf=""># multiple resolution</span></span><br><span><span leaf="">for</span></span><span leaf=""> (res </span><span><span leaf="">in</span></span><span leaf=""> seq(0.1,1,by = 0.1)) {</span><br><span leaf="">  sct.ft &lt;- FindClusters(sct.ft, resolution = res)</span><br><span leaf="">}</span><br><br><span leaf="">library(clustree)</span><br><br><span leaf="">clustree::clustree(sct.ft, prefix = </span><span><span leaf="">'SCT_snn_res.'</span></span><span leaf="">)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035926" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2nOwMT0FEIgSZIJ9G6s6hkwC1vMjTfQEXHPsgSbg5AOlSzialpaJh6aQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2nOwMT0FEIgSZIJ9G6s6hkwC1vMjTfQEXHPsgSbg5AOlSzialpaJh6aQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">使用 </span><strong><span leaf="">0.1</span></strong><span leaf=""> 的分辨率来分群：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">sct.ft &lt;- FindClusters(sct.ft, resolution = 0.1,</span><br><span leaf="">                       cluster.name = </span><span><span leaf="">"unintegrated_clusters"</span></span><span leaf="">)</span><br><br><span leaf="">sct.ft &lt;- RunUMAP(sct.ft,dims = 1:30,</span><br><span leaf="">                  reduction = </span><span><span leaf="">"pca"</span></span><span leaf="">,</span><br><span leaf="">                  reduction.name = </span><span><span leaf="">"umap.unintegrated"</span></span><span leaf="">)</span><br><br><span leaf="">p1 &lt;- DimPlot(sct.ft,</span><br><span leaf="">              reduction = </span><span><span leaf="">"umap.unintegrated"</span></span><span leaf="">,</span><br><span leaf="">              group.by = c(</span><span><span leaf="">"orig.ident"</span></span><span leaf="">, </span><span><span leaf="">"unintegrated_clusters"</span></span><span leaf="">))</span><br><span leaf="">p1</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035930" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2GCFxVyhEUkVVzIibGyrvmicS0g5EoMqug0s8YhuUbZlyhUuDQRE9SZEA/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2GCFxVyhEUkVVzIibGyrvmicS0g5EoMqug0s8YhuUbZlyhUuDQRE9SZEA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">看着有一些批次效应，下面进行去除：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># ==============================================================================</span></span><br><span><span leaf=""># after harmony intergation</span></span><br><span><span leaf=""># ==============================================================================</span></span><br><br><br><span leaf="">sct.la &lt;- IntegrateLayers(object = sct.ft,</span><br><span leaf="">                          method = HarmonyIntegration,</span><br><span leaf="">                          orig.reduction = </span><span><span leaf="">"pca"</span></span><span leaf="">,</span><br><span leaf="">                          new.reduction = </span><span><span leaf="">"harmony"</span></span><span leaf="">,</span><br><span leaf="">                          normalization.method = </span><span><span leaf="">"SCT"</span></span><span leaf="">,</span><br><span leaf="">                          verbose = F)</span><br><br><span leaf="">sct.la &lt;- FindNeighbors(sct.la,</span><br><span leaf="">                        reduction = </span><span><span leaf="">"harmony"</span></span><span leaf="">,</span><br><span leaf="">                        dims = 1:30)</span><br><span leaf="">sct.la &lt;- FindClusters(sct.la,</span><br><span leaf="">                       resolution = 0.1,</span><br><span leaf="">                       cluster.name = </span><span><span leaf="">"harmony_clusters"</span></span><span leaf="">)</span><br><span leaf="">sct.la &lt;- RunUMAP(sct.la,dims = 1:30,</span><br><span leaf="">                  reduction = </span><span><span leaf="">"harmony"</span></span><span leaf="">,</span><br><span leaf="">                  reduction.name = </span><span><span leaf="">"umap.harmony"</span></span><span leaf="">)</span><br><br><span leaf="">p2 &lt;- DimPlot(sct.la,</span><br><span leaf="">              reduction = </span><span><span leaf="">"umap.harmony"</span></span><span leaf="">,</span><br><span leaf="">              group.by = c(</span><span><span leaf="">"orig.ident"</span></span><span leaf="">, </span><span><span leaf="">"harmony_clusters"</span></span><span leaf="">))</span><br><br><span leaf="">p1 / p2</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035931" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2GgTEibKUrNfDFvKm90mdU0TgZLUPz12VLdNTn4DLaeM2pqWz9PHgK7A/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2GgTEibKUrNfDFvKm90mdU0TgZLUPz12VLdNTn4DLaeM2pqWz9PHgK7A/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">寻找 </span><strong><span leaf="">marker</span></strong><span leaf=""> 基因：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># ==============================================================================</span></span><br><span><span leaf=""># find markers</span></span><br><span><span leaf=""># ==============================================================================</span></span><br><br><span leaf="">DefaultAssay(sct.la) &lt;- </span><span><span leaf="">"RNA"</span></span><br><span leaf="">sct.la &lt;- JoinLayers(sct.la)</span><br><span leaf="">DefaultAssay(sct.la) &lt;- </span><span><span leaf="">"SCT"</span></span><br><br><span leaf="">sct.la &lt;- PrepSCTFindMarkers(sct.la, assay = </span><span><span leaf="">"SCT"</span></span><span leaf="">, verbose = TRUE)</span><br><br><span leaf="">sct.markers &lt;- SeuratWrappers::RunPrestoAll(object = sct.la,</span><br><span leaf="">                                            only.pos = T,</span><br><span leaf="">                                            logfc.threshold = 0.25,</span><br><span leaf="">                                            assay = </span><span><span leaf="">"SCT"</span></span><span leaf="">,</span><br><span leaf="">                                            test.use = </span><span><span leaf="">"wilcox"</span></span><span leaf="">,</span><br><span leaf="">                                            min.pct = 0.25)</span><br><br><br><span leaf="">save(sct.markers, file = </span><span><span leaf="">"sct.markers.rda"</span></span><span leaf="">)</span><br><br><span leaf="">library(dplyr)</span><br><br><span><span leaf=""># get top markers</span></span><br><span leaf="">top.markers &lt;- sct.markers %&gt;%</span><br><span leaf="">  dplyr::group_by(cluster) %&gt;%</span><br><span leaf="">  dplyr::filter(avg_log2FC &gt; 0.25 &amp; p_val_adj &lt; 0.05) %&gt;%</span><br><span leaf="">  top_n(n = 5,wt = avg_log2FC)</span><br><br><span leaf="">DoHeatmap(sct.la, features = top.markers</span><span><span leaf="">$gene</span></span><span leaf="">) +</span><br><span leaf="">  NoLegend() +</span><br><span leaf="">  scale_fill_gradient2(low = </span><span><span leaf="">"blue"</span></span><span leaf="">,mid = </span><span><span leaf="">"white"</span></span><span leaf="">,high = </span><span><span leaf="">"red"</span></span><span leaf="">,</span><br><span leaf="">                       midpoint = 0)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035929" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2y96bUlE6UYicxyUo3tc9ouHfdFjgEo02lTM6Wnf9sxW5c5rGZDx8HiaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2y96bUlE6UYicxyUo3tc9ouHfdFjgEo02lTM6Wnf9sxW5c5rGZDx8HiaA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">dotplot 看看：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">DotPlot(sct.la,features = top.markers</span><span><span leaf="">$gene</span></span><span leaf="">) +</span><br><span leaf="">  coord_flip()</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035927" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2LE9Db8a0ZYvFrpibFlbNOPN6GFA5GMQL0RZlIjNicJxcMn8zAtYIicbUQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2LE9Db8a0ZYvFrpibFlbNOPN6GFA5GMQL0RZlIjNicJxcMn8zAtYIicbUQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">亚群注释，这里使用 </span><strong><span leaf="">easybio</span></strong><span leaf=""> 包自动注释看看：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># ==============================================================================</span></span><br><span><span leaf=""># cell annotate</span></span><br><span><span leaf=""># ==============================================================================</span></span><br><span leaf="">library(easybio)</span><br><br><span leaf="">table(sct.la</span><span><span leaf="">$harmony_clusters</span></span><span leaf="">)</span><br><br><br><span leaf="">marker &lt;- matchCellMarker2(marker = sct.markers,</span><br><span leaf="">                           n = 50,</span><br><span leaf="">                           spc = </span><span><span leaf="">'Mouse'</span></span><span leaf="">,</span><br><span leaf="">                           tissueType = </span><span><span leaf="">"Brain"</span></span><span leaf="">)[, head(.SD, 3), by = cluster]</span><br><br><span leaf="">cl2cell &lt;- marker[, head(.SD, 1), by = .(cluster)]</span><br><br><span leaf="">cl2cell &lt;- setNames(cl2cell[[</span><span><span leaf="">"cell_name"</span></span><span leaf="">]], cl2cell[[</span><span><span leaf="">"cluster"</span></span><span leaf="">]])</span><br><br><span><span leaf=""># add celltype</span></span><br><span leaf="">sct.la &lt;- RenameIdents(sct.la, cl2cell)</span><br><br><span leaf="">DimPlot(sct.la,</span><br><span leaf="">        reduction = </span><span><span leaf="">"umap.harmony"</span></span><span leaf="">,</span><br><span leaf="">        label = TRUE, pt.size = 0.5) +</span><br><span leaf="">  NoLegend()</span><br><br><span><span leaf=""># save</span></span><br><span leaf="">saveRDS(sct.la, file = </span><span><span leaf="">"sct.la.anno.rds"</span></span><span leaf="">)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035928" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2yPKJdsfuabCrtpeen4zEnCUhRicwg7OB1sdPF955ccnjAiaxEhW07ibgg/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2yPKJdsfuabCrtpeen4zEnCUhRicwg7OB1sdPF955ccnjAiaxEhW07ibgg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">结尾</span></span><span></span></h2><blockquote><span></span><p><strong><span leaf="">路漫漫其修远兮,吾将上下而求索。</span></strong></p></blockquote><hr><p data-tool="mdnice编辑器"><span leaf="">欢迎加入生信交流群。加我微信我也拉你进 </span><strong><span leaf="">微信群聊</span></strong><strong><span leaf="">老俊俊生信交流群</span></strong><strong><span leaf="">(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</span></strong><span leaf=""> 。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035936" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2nlicJPKFbOuSHQyKvswbEEuBupZ9teLibUj5d2e5uqYTFMyDme8GE8cQ/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2nlicJPKFbOuSHQyKvswbEEuBupZ9teLibUj5d2e5uqYTFMyDme8GE8cQ/640?wx_fmt=jpeg&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035935" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2sUfLTDfFOs4Cy6E5egRGmCXutkialdbI1J2KPaSZxXfNcshdRkgZmKA/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usewhiazsuP0KdxbgiaibFGcfMQ2sUfLTDfFOs4Cy6E5egRGmCXutkialdbI1J2KPaSZxXfNcshdRkgZmKA/640?wx_fmt=png&amp;from=appmsg"></span></figure><hr><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong><span leaf=""> 往期回顾目录 </span></strong></center><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><blockquote><span></span><ul><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519569&amp;idx=1&amp;sn=019d1afac2474ac15daa81b85a7a7004&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">使用 TIMER3 数据库进行在线免疫浸润分析</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519551&amp;idx=1&amp;sn=48fbcdf922f7ea2fe4e61d61f9fb0ecb&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">omicScope 对接 UCSC xena 下载数据</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519507&amp;idx=1&amp;sn=d541b6166515701362547420421f6b01&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">coverage_plot 指定基因组区间绘图</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519484&amp;idx=1&amp;sn=6d62d7d0f789f292776bb32774d8b432&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">omicScope 可视化基因基因组上的 coverage</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519461&amp;idx=1&amp;sn=1a2e3fd2a82c02a9a99dc9e3e5aa7d90&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">omicScope：转录组数据一站式分析平台</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519428&amp;idx=1&amp;sn=32a5474edc16d44f491dd2c3e226c8a1&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">告别坐标解析噩梦！GenomicCoordinates 包来拯救你了</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519408&amp;idx=1&amp;sn=3b17ece77d10c7cce60543bb5350d12b&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">读博，就像骑自行车</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519399&amp;idx=1&amp;sn=5f654a4daa1d32407844eab08118079c&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">pyMut：遗传变异分析及可视化 python 工具</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519382&amp;idx=1&amp;sn=514605db6847df187ba15cf3acafd008&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">Cell：邻近特异性核糖体分析揭示定位线粒体翻译的逻辑机制</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519363&amp;idx=1&amp;sn=671309f5114c2d01dbcb2fb9f2f6a7ba&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">S7：新的面向对象系统</a></span></left></strong></section></li></ul></blockquote></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/lEBNOFW3HPmIOP6f91G3sQ",target="_blank" rel="noopener noreferrer">原文链接</a>
