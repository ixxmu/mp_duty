---
title: "omicScope 对接 UCSC xena 下载数据"
date: 2025-10-18T09:41:48Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
omicScope 对接 UCSC xena 下载数据 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-from="0" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-id="MzkyMTI1MTYxNA==" data-is_biz_ban="0" data-service_type="1" data-verify_status="1"></mp-common-profile></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">引言</span></span><span></span></h2><blockquote><span></span><p><span leaf="">有时候大家可能会直接去 </span><strong><span leaf="">UCSC xena</span></strong><span leaf=""> 数据库下载对应癌种表达数据自学分析和绘图。这也是需要较为繁琐的代码操作。</span><strong><span leaf="">omicScope</span></strong><span leaf=""> 直接可以整合分析这些数据，一键分析和绘图。</span></p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">安装</span></span><span></span></h2><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># Install from GitHub</span></span><br><span><span leaf="">if</span></span><span leaf=""> (!requireNamespace(</span><span><span leaf="">"devtools"</span></span><span leaf="">, quietly = TRUE)) {</span><br><span leaf="">    install.packages(</span><span><span leaf="">"devtools"</span></span><span leaf="">)</span><br><span leaf="">}</span><br><span leaf="">devtools::install_github(</span><span><span leaf="">"junjunlab/omicScope"</span></span><span leaf="">)</span><br><br><span><span leaf=""># Or using pak (recommended)</span></span><br><span><span leaf="">if</span></span><span leaf=""> (!requireNamespace(</span><span><span leaf="">"pak"</span></span><span leaf="">, quietly = TRUE)) {</span><br><span leaf="">    install.packages(</span><span><span leaf="">"pak"</span></span><span leaf="">)</span><br><span leaf="">}</span><br><span leaf="">pak::pak(</span><span><span leaf="">"junjunlab/omicScope"</span></span><span leaf="">)</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">示例</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">这里我们去</span><strong><span leaf="">UCSC xena</span></strong><span leaf=""> 数据库下载</span><strong><span leaf="">LUAD</span></strong><span leaf="">的</span><strong><span leaf="">counts 定量数据</span></strong><span leaf="">，</span><strong><span leaf="">临床样本数据</span></strong><span leaf="">和</span><strong><span leaf="">生存数据</span></strong><span leaf="">，此外去</span><strong><span leaf="">GTEx</span></strong><span leaf="">数据库下载后肺的</span><strong><span leaf="">正常组织</span></strong><span leaf="">的测序数据：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035868" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuX6qGEFH796SkabxG5AGPkicqcjNdeb7v6vrnMqH73CaGGVbibvxUalm6g/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuX6qGEFH796SkabxG5AGPkicqcjNdeb7v6vrnMqH73CaGGVbibvxUalm6g/640?wx_fmt=png&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035869" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXPJIHQHV3yEDkudAtCVibicFcNjSXvRZ8Xk2z93hFrdZ6SRiaP5tET5PWw/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXPJIHQHV3yEDkudAtCVibicFcNjSXvRZ8Xk2z93hFrdZ6SRiaP5tET5PWw/640?wx_fmt=png&amp;from=appmsg"></span></figure><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># Counts</span></span><br><span leaf="">wget https://gdc-hub.s3.us-east-1.amazonaws.com/download/TCGA-LUAD.star_counts.tsv.gz</span><br><br><span><span leaf=""># Phenotype data</span></span><br><span leaf="">wget https://gdc-hub.s3.us-east-1.amazonaws.com/download/TCGA-LUAD.clinical.tsv.gz</span><br><br><span><span leaf=""># Survival data</span></span><br><span leaf="">wget https://gdc-hub.s3.us-east-1.amazonaws.com/download/TCGA-LUAD.survival.tsv.gz</span><br><br><span leaf="">wget https://storage.googleapis.com/adult-gtex/bulk-gex/v10/rna-seq/counts-by-tissue/gene_reads_v10_lung.gct.gz</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">构建 omicscope 对象</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">obj &lt;- ucscZenaToObj(gtf_anno = </span><span><span leaf="">"gencode.v36.annotation.gtf.gz"</span></span><span leaf="">,</span><br><span leaf="">                     counts_data = </span><span><span leaf="">"TCGA-LUAD.star_counts.tsv.gz"</span></span><span leaf="">,</span><br><span leaf="">                     pheno_data = </span><span><span leaf="">"TCGA-LUAD.clinical.tsv.gz"</span></span><span leaf="">,</span><br><span leaf="">                     survival_data = </span><span><span leaf="">"TCGA-LUAD.survival.tsv.gz"</span></span><span leaf="">,</span><br><span leaf="">                     gtex_counts_data = </span><span><span leaf="">"gene_reads_v10_lung.gct.gz"</span></span><span leaf="">)</span><br><br><span leaf="">obj</span><br><span><span leaf=""># class: omicscope</span></span><br><span><span leaf=""># dim: 52739 1193</span></span><br><span><span leaf=""># metadata(0):</span></span><br><span><span leaf=""># assays(1): counts</span></span><br><span><span leaf=""># rownames(52739): ENSG00000223972.5 ENSG00000227232.5 ... ENSG00000210195.2 ENSG00000210196.2</span></span><br><span><span leaf=""># rowData names(3): gene_id gene_name gene_biotype</span></span><br><span><span leaf=""># colnames(1193): TCGA-38-7271-01A TCGA-55-7914-01A ... GTEX-ZZPT-1326-SM-5E43H GTEX-ZZPU-0526-SM-5E44U</span></span><br><span><span leaf=""># colData names(97): sample id ... X_PATIENT group2</span></span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">数据标准化和降维分析：</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">obj &lt;- normalize_data(obj, norm_type = </span><span><span leaf="">"tpm"</span></span><span leaf="">)</span><br><br><span leaf="">obj &lt;- run_reduction(object = obj,</span><br><span leaf="">                     reduction = </span><span><span leaf="">"pca"</span></span><span leaf="">,</span><br><span leaf="">                     top_hvg_genes = 3000)</span><br><br><span leaf="">obj &lt;- run_reduction(object = obj,</span><br><span leaf="">                     reduction = </span><span><span leaf="">"umap"</span></span><span leaf="">,</span><br><span leaf="">                     top_hvg_genes = 3000)</span><br><br><span leaf="">obj &lt;- run_reduction(object = obj,</span><br><span leaf="">                     reduction = </span><span><span leaf="">"tsne"</span></span><span leaf="">,</span><br><span leaf="">                     top_hvg_genes = 3000)</span><br><br><span leaf="">p1 &lt;- dim_plot(obj, reduction = </span><span><span leaf="">"pca"</span></span><span leaf="">, color_by = </span><span><span leaf="">"group2"</span></span><span leaf="">)</span><br><span leaf="">p2 &lt;- dim_plot(obj, reduction = </span><span><span leaf="">"umap"</span></span><span leaf="">, color_by = </span><span><span leaf="">"group2"</span></span><span leaf="">)</span><br><span leaf="">p3 &lt;- dim_plot(obj, reduction = </span><span><span leaf="">"tsne"</span></span><span leaf="">, color_by = </span><span><span leaf="">"group2"</span></span><span leaf="">)</span><br><br><br><span leaf="">cowplot::plot_grid(plotlist = list(p1,p2,p3),</span><br><span leaf="">                   ncol = 2)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035870" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXw3Tbib9PxQiaY4icZRGaZgnno8KC4EgWkJZ6L9YGC3HxbiaricrzRibm2zUQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXw3Tbib9PxQiaY4icZRGaZgnno8KC4EgWkJZ6L9YGC3HxbiaricrzRibm2zUQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">批次效应去除</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">可以看到 GTEx 的正常组织样本有明显的批次效应，需要去除批次效应：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">obj &lt;- correct_batch_effect(obj)</span><br><span><span leaf=""># Found 2 batches</span></span><br><span><span leaf=""># Using full model in ComBat-seq.</span></span><br><span><span leaf=""># Adjusting for 1 covariate(s) or covariate level(s)</span></span><br><span><span leaf=""># Estimating dispersions</span></span><br><span><span leaf=""># Fitting the GLM model</span></span><br><span><span leaf=""># Shrinkage off - using GLM estimates for parameters</span></span><br><span><span leaf=""># Adjusting the data</span></span><br><br><span leaf="">obj &lt;- normalize_data(obj, norm_type = </span><span><span leaf="">"tpm"</span></span><span leaf="">)</span><br><br><span leaf="">obj &lt;- run_reduction(object = obj,</span><br><span leaf="">                     reduction = </span><span><span leaf="">"pca"</span></span><span leaf="">,</span><br><span leaf="">                     top_hvg_genes = 3000)</span><br><br><span leaf="">obj &lt;- run_reduction(object = obj,</span><br><span leaf="">                     reduction = </span><span><span leaf="">"umap"</span></span><span leaf="">,</span><br><span leaf="">                     top_hvg_genes = 3000)</span><br><br><span leaf="">obj &lt;- run_reduction(object = obj,</span><br><span leaf="">                     reduction = </span><span><span leaf="">"tsne"</span></span><span leaf="">,</span><br><span leaf="">                     top_hvg_genes = 3000)</span><br><br><span leaf="">p1 &lt;- dim_plot(obj, reduction = </span><span><span leaf="">"pca"</span></span><span leaf="">, color_by = </span><span><span leaf="">"group2"</span></span><span leaf="">)</span><br><span leaf="">p2 &lt;- dim_plot(obj, reduction = </span><span><span leaf="">"umap"</span></span><span leaf="">, color_by = </span><span><span leaf="">"group2"</span></span><span leaf="">)</span><br><span leaf="">p3 &lt;- dim_plot(obj, reduction = </span><span><span leaf="">"tsne"</span></span><span leaf="">, color_by = </span><span><span leaf="">"group2"</span></span><span leaf="">)</span><br><br><br><span leaf="">cowplot::plot_grid(plotlist = list(p1,p2,p3),</span><br><span leaf="">                   ncol = 2)</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">基本上癌症数据里的正常样本和 GTEx 的聚在一起了：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035867" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXV14yG8qJF8DibeZ4qwKHlxRHccG4Kxon389pIGSiaKDDuQnV6DKljicFw/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXV14yG8qJF8DibeZ4qwKHlxRHccG4Kxon389pIGSiaKDDuQnV6DKljicFw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">差异表达分析</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">obj &lt;- differential_expression(obj,</span><br><span leaf="">                               method = </span><span><span leaf="">"limma"</span></span><span leaf="">,</span><br><span leaf="">                               limmaApproach = </span><span><span leaf="">"voom"</span></span><span leaf="">)</span><br><br><span leaf="">diff &lt;- obj@diffExpData</span><span><span leaf="">$limma</span></span><span><span leaf="">$treat_vs_control</span></span><br><br><span leaf="">str(diff)</span><br><span><span leaf=""># Formal class 'diffdata' [package "omicScope"] with 9 slots</span></span><br><span><span leaf="">#   ..@ contrastName   : chr "treat_vs_control"</span></span><br><span><span leaf="">#   ..@ method         : chr "limma"</span></span><br><span><span leaf="">#   ..@ design         :List of 1</span></span><br><span><span leaf="">#   .. ..$ : num [1:589, 1:2] 1 1 1 1 1 1 1 1 1 1 ...</span></span><br><span><span leaf="">#   .. .. ..- attr(*, "dimnames")=List of 2</span></span><br><span><span leaf="">#   .. .. .. ..$ : chr [1:589] "TCGA-38-7271-01A" "TCGA-55-7914-01A" "TCGA-95-7043-01A" "TCGA-73-4658-01A" ...</span></span><br><span><span leaf="">#   .. .. .. ..$ : chr [1:2] "(Intercept)" "groupTumor"</span></span><br><span><span leaf="">#   .. .. ..- attr(*, "assign")= int [1:2] 0 1</span></span><br><span><span leaf="">#   .. .. ..- attr(*, "contrasts")=List of 1</span></span><br><span><span leaf="">#   .. .. .. ..$ group: chr "contr.treatment"</span></span><br><span><span leaf="">#   ..@ log2FCthreshold: num 1</span></span><br><span><span leaf="">#   ..@ pvalueThreshold: num 0.05</span></span><br><span><span leaf="">#   ..@ sigUp          : int 3973</span></span><br><span><span leaf="">#   ..@ sigDown        : int 3955</span></span><br><span><span leaf="">#   ..@ nonSig         : int 52732</span></span><br><span><span leaf="">#   ..@ data           :'data.frame':   60660 obs. of  10 variables:</span></span><br><span><span leaf="">#   .. ..$ gene_id       : chr [1:60660] "ENSG00000000003.15" "ENSG00000000005.6" "ENSG00000000419.13" "ENSG00000000457.14" ...</span></span><br><span><span leaf="">#   .. ..$ log2FoldChange: num [1:60660] 1.1 -0.429 0.296 0.526 1.678 ...</span></span><br><span><span leaf="">#   .. ..$ AveExpr       : num [1:60660] 5.87 -4.76 4.99 3.99 2.82 ...</span></span><br><span><span leaf="">#   .. ..$ t             : num [1:60660] 9.26 -1.37 3.97 7.06 13.32 ...</span></span><br><span><span leaf="">#   .. ..$ pvalue        : num [1:60660] 3.86e-19 1.70e-01 8.08e-05 4.80e-12 1.39e-35 ...</span></span><br><span><span leaf="">#   .. ..$ padj          : num [1:60660] 7.05e-18 2.33e-01 3.16e-04 4.65e-11 7.96e-34 ...</span></span><br><span><span leaf="">#   .. ..$ B             : num [1:60660] 32.26 -6.11 0.07 16.3 69.99 ...</span></span><br><span><span leaf="">#   .. ..$ gene_name     : chr [1:60660] "TSPAN6" "TNMD" "DPM1" "SCYL3" ...</span></span><br><span><span leaf="">#   .. ..$ gene_biotype  : chr [1:60660] "protein_coding" "protein_coding" "protein_coding" "protein_coding" ...</span></span><br><span><span leaf="">#   .. ..$ type          : chr [1:60660] "sigUp" "nonSig" "nonSig" "nonSig" ...</span></span><br><br><span><span leaf=""># Check</span></span><br><span leaf="">diff@data |&gt; head()</span><br><span><span leaf="">#              gene_id log2FoldChange   AveExpr          t       pvalue         padj            B gene_name   gene_biotype    type</span></span><br><span><span leaf=""># 1 ENSG00000000003.15      1.0997480  5.872692   9.255036 3.862856e-19 7.051485e-18  32.25994586    TSPAN6 protein_coding   sigUp</span></span><br><span><span leaf=""># 2  ENSG00000000005.6     -0.4286831 -4.762921  -1.374252 1.698829e-01 2.329236e-01  -6.10668869      TNMD protein_coding  nonSig</span></span><br><span><span leaf=""># 3 ENSG00000000419.13      0.2959509  4.987883   3.969822 8.075471e-05 3.155024e-04   0.07004036      DPM1 protein_coding  nonSig</span></span><br><span><span leaf=""># 4 ENSG00000000457.14      0.5261200  3.994452   7.056095 4.798641e-12 4.649187e-11  16.30391548     SCYL3 protein_coding  nonSig</span></span><br><span><span leaf=""># 5 ENSG00000000460.17      1.6777640  2.815088  13.316756 1.391922e-35 7.957963e-34  69.98860263  C1orf112 protein_coding   sigUp</span></span><br><span><span leaf=""># 6 ENSG00000000938.13     -2.2200498  4.360530 -18.605462 3.380108e-61 6.571710e-59 128.43374484       FGR protein_coding sigDown</span></span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">可视化差异结果：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">volcano_plot(object = obj,  method = </span><span><span leaf="">"limma"</span></span><span leaf="">)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035866" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXWkP3mZSHibu2BuyWCcZZsxkRBQqq9XPrZbH0OiaJtIh7hm5PSTQRq4GQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXWkP3mZSHibu2BuyWCcZZsxkRBQqq9XPrZbH0OiaJtIh7hm5PSTQRq4GQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">对特定的基于热图展示表达量变化</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">obj &lt;- get_normalized_data(obj)</span><br><br><span leaf="">dif.res &lt;- diff@data</span><br><br><span leaf="">gene &lt;- subset(dif.res, startsWith(gene_name,</span><span><span leaf="">"METTL"</span></span><span leaf="">))</span><br><br><span><span leaf=""># Plot</span></span><br><span leaf="">exp_heatmap_plot(obj,</span><br><span leaf="">                 selected_gene = gene</span><span><span leaf="">$gene_name</span></span><span leaf="">)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035873" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXmKy0OJgkrByThibmiacS1JZs2zas6IRF8XGkkx8yH6jlJ2PABDh0PHvg/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXmKy0OJgkrByThibmiacS1JZs2zas6IRF8XGkkx8yH6jlJ2PABDh0PHvg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">取消样本聚类：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">exp_heatmap_plot(obj,</span><br><span leaf="">                 selected_gene = gene</span><span><span leaf="">$gene_name</span></span><span leaf="">,</span><br><span leaf="">                 complexHeatmap_params = list(cluster_rows = FALSE))</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035872" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXkdMEqRyYgH9dAbWqp9Uj5xGnyx4slTP75bMBDl8eSlorquuOVwDiafw/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXkdMEqRyYgH9dAbWqp9Uj5xGnyx4slTP75bMBDl8eSlorquuOVwDiafw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">箱线图展示：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">gene_boxViolin_plot(obj,</span><br><span leaf="">                    selected_gene = c(</span><span><span leaf="">"METTL3"</span></span><span leaf="">,</span><span><span leaf="">"METTL14"</span></span><span leaf="">,</span><br><span leaf="">                                      </span><span><span leaf="">"YTHDC1"</span></span><span leaf="">,</span><span><span leaf="">"YTHDC2"</span></span><span leaf="">,</span><br><span leaf="">                                      </span><span><span leaf="">"YTHDF1"</span></span><span leaf="">,</span><span><span leaf="">"YTHDF2"</span></span><span leaf="">,</span><span><span leaf="">"YTHDF3"</span></span><span leaf="">),</span><br><span leaf="">                    point_col = </span><span><span leaf="">"grey50"</span></span><span leaf="">,</span><br><span leaf="">                    point_alpha = 0.3)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035874" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXDeRQw8aNjI8FZiceBXdeibupSpZMNabkpzOOkMQzBHZiaQ9pGNF4LlFzw/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXDeRQw8aNjI8FZiceBXdeibupSpZMNabkpzOOkMQzBHZiaQ9pGNF4LlFzw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">小提琴图：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">gene_boxViolin_plot(obj,</span><br><span leaf="">                    selected_gene = c(</span><span><span leaf="">"METTL3"</span></span><span leaf="">,</span><span><span leaf="">"METTL14"</span></span><span leaf="">,</span><br><span leaf="">                                      </span><span><span leaf="">"YTHDC1"</span></span><span leaf="">,</span><span><span leaf="">"YTHDC2"</span></span><span leaf="">,</span><br><span leaf="">                                      </span><span><span leaf="">"YTHDF1"</span></span><span leaf="">,</span><span><span leaf="">"YTHDF2"</span></span><span leaf="">,</span><span><span leaf="">"YTHDF3"</span></span><span leaf="">),</span><br><span leaf="">                    </span><span><span leaf="">type</span></span><span leaf=""> = </span><span><span leaf="">"violin"</span></span><span leaf="">,</span><br><span leaf="">                    jitter.width = 0.15,</span><br><span leaf="">                    point_col = </span><span><span leaf="">"grey50"</span></span><span leaf="">,</span><br><span leaf="">                    point_alpha = 0.3)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035875" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXLVdGh8q7xk9I8xd1w9aib5hKTHTA7cnzse5dZnIhHTI5M7UBr1AV6QA/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXLVdGh8q7xk9I8xd1w9aib5hKTHTA7cnzse5dZnIhHTI5M7UBr1AV6QA/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">基因相关性分析</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">p1 &lt;- gene_cor_plot(obj,</span><br><span leaf="">                    gene_1 = </span><span><span leaf="">"METTL3"</span></span><span leaf="">,</span><br><span leaf="">                    gene_2 = </span><span><span leaf="">"YTHDF2"</span></span><span leaf="">,</span><br><span leaf="">                    selected_group = </span><span><span leaf="">"Tumor"</span></span><span leaf="">)</span><br><br><span leaf="">p2 &lt;- gene_cor_plot(obj,</span><br><span leaf="">                    gene_1 = </span><span><span leaf="">"METTL3"</span></span><span leaf="">,</span><br><span leaf="">                    gene_2 = </span><span><span leaf="">"YTHDF2"</span></span><span leaf="">,</span><br><span leaf="">                    selected_group = </span><span><span leaf="">"Normal"</span></span><span leaf="">)</span><br><br><span leaf="">p1 + p2</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035871" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXeSWiazahJVN51tSUttl03mo2b119BTmJn2bBva5NC2DEgMpjfEJyJRw/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXeSWiazahJVN51tSUttl03mo2b119BTmJn2bBva5NC2DEgMpjfEJyJRw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">生存预后分析</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">surv_plot(obj,</span><br><span leaf="">          selected_gene = c(</span><span><span leaf="">"YTHDF1"</span></span><span leaf="">,</span><span><span leaf="">"YTHDF2"</span></span><span leaf="">,</span><span><span leaf="">"YTHDF3"</span></span><span leaf="">,</span><span><span leaf="">"METTL5"</span></span><span leaf="">))</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035880" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXVolib0FCglpNhLFOAO2C5gMYx7Rcm8T3YCPZhbbx70pOvA9MmwibpBHw/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXVolib0FCglpNhLFOAO2C5gMYx7Rcm8T3YCPZhbbx70pOvA9MmwibpBHw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">肿瘤微环境分析</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">obj &lt;- run_TME_analysis(obj,</span><br><span leaf="">                        method = </span><span><span leaf="">"deconvo"</span></span><span leaf="">,</span><br><span leaf="">                        deconvo_method = </span><span><span leaf="">"cibersort"</span></span><span leaf="">)</span><br><span><span leaf=""># ==========================================================================</span></span><br><span><span leaf="">#   IOBR v0.99.99  Immuno-Oncology Biological Research</span></span><br><span><span leaf="">#   For Tutorial: https://iobr.github.io/book/</span></span><br><span><span leaf="">#   For Help: https://github.com/IOBR/IOBR/issues</span></span><br><span><span leaf="">#</span></span><br><span><span leaf="">#  If you use IOBR in published research, please cite:</span></span><br><span><span leaf="">#  DQ Zeng, YR Fang, ..., GC Yu*, WJ Liao*,</span></span><br><span><span leaf="">#  Enhancing immuno-oncology investigations through multidimensional decoding</span></span><br><span><span leaf="">#  of tumor microenvironment with IOBR 2.0. Cell Rep Methods 4, 100910 (2024).</span></span><br><span><span leaf="">#  &amp;</span></span><br><span><span leaf="">#  YR Fang, ..., WJ Liao*, DQ Zeng*,</span></span><br><span><span leaf="">#  Systematic Investigation of Tumor Microenvironment and</span></span><br><span><span leaf="">#  Antitumor Immunity With IOBR, Med Research (2025).</span></span><br><span><span leaf="">#  https://onlinelibrary.wiley.com/doi/epdf/10.1002/mdr2.70001</span></span><br><span><span leaf=""># ==========================================================================</span></span><br><span><span leaf="">#</span></span><br><span><span leaf=""># &gt;&gt;&gt; Running CIBERSORT</span></span><br><br><span leaf="">obj &lt;- run_TME_analysis(obj,</span><br><span leaf="">                        method = </span><span><span leaf="">"signature"</span></span><span leaf="">,</span><br><span leaf="">                        signature_method = </span><span><span leaf="">"pca"</span></span><span leaf="">)</span><br><span><span leaf=""># &gt;&gt;&gt; Calculating signature score using PCA method</span></span><br><span><span leaf=""># &gt;&gt;&gt; log2 transformation was finished</span></span><br><span><span leaf=""># There were 50 or more warnings (use warnings() to see the first 50)</span></span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">结果可视化：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">tme_plot(obj,</span><br><span leaf="">         method = </span><span><span leaf="">"deconvo"</span></span><span leaf="">,</span><br><span leaf="">         </span><span><span leaf="">type</span></span><span leaf=""> = </span><span><span leaf="">"box"</span></span><span leaf="">)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035878" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXhxA7X8ITRCHjGHdUnWL3QHI6xZGrSHGouWsNqxhyK1Vb8Y7QfCyfMQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXhxA7X8ITRCHjGHdUnWL3QHI6xZGrSHGouWsNqxhyK1Vb8Y7QfCyfMQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">热图：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">tme_plot(obj,</span><br><span leaf="">         method = </span><span><span leaf="">"deconvo"</span></span><span leaf="">,</span><br><span leaf="">         </span><span><span leaf="">type</span></span><span leaf=""> = </span><span><span leaf="">"heatmap"</span></span><span leaf="">)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035879" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXWDMWKnO319rmp0W4jCYVJ7VlImVHmGRQQJejolsXcrdZ7c9WIUbukg/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXWDMWKnO319rmp0W4jCYVJ7VlImVHmGRQQJejolsXcrdZ7c9WIUbukg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">对接 TCGAbiolinks</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">TCGAbiolinks 下载表达谱示例代码：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># BiocManager::install("TCGAbiolinks")</span></span><br><span leaf="">library(TCGAbiolinks)</span><br><span leaf="">library(SummarizedExperiment)</span><br><br><span leaf="">query.exp &lt;- GDCquery(</span><br><span leaf="">  project = </span><span><span leaf="">"TCGA-LUAD"</span></span><span leaf="">,</span><br><span leaf="">  data.category = </span><span><span leaf="">"Transcriptome Profiling"</span></span><span leaf="">,</span><br><span leaf="">  data.type = </span><span><span leaf="">"Gene Expression Quantification"</span></span><span leaf="">,</span><br><span leaf="">  workflow.type = </span><span><span leaf="">"STAR - Counts"</span></span><br><span leaf="">)</span><br><br><span leaf="">GDCdownload(</span><br><span leaf="">  query = query.exp,</span><br><span leaf="">  files.per.chunk = 200</span><br><span leaf="">)</span><br><br><span leaf="">luad.exp &lt;- GDCprepare(</span><br><span leaf="">  query = query.exp,</span><br><span leaf="">  save = TRUE,</span><br><span leaf="">  save.filename = </span><span><span leaf="">"luadExp.rda"</span></span><br><span leaf="">)</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">然后就可以构建 omicscope 对象，也可以支持整合 GTEx 样本数据：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">library(omicScope)</span><br><br><span leaf="">load(</span><span><span leaf="">"luadExp.rda"</span></span><span leaf="">)</span><br><br><span><span leaf=""># obj &lt;- TCGAbiolinksToObj(tcgabiolinks_obj = data)</span></span><br><br><span leaf="">obj &lt;- TCGAbiolinksToObj(gtf_anno = </span><span><span leaf="">"gencode.v36.annotation.gtf.gz"</span></span><span leaf="">,</span><br><span leaf="">                         tcgabiolinks_obj = data,</span><br><span leaf="">                         gtex_counts_data = </span><span><span leaf="">"gene_reads_v10_lung.gct.gz"</span></span><span leaf="">)</span><br><span leaf="">obj</span><br><span><span leaf=""># class: omicscope</span></span><br><span><span leaf=""># dim: 52739 1204</span></span><br><span><span leaf=""># metadata(0):</span></span><br><span><span leaf=""># assays(1): counts</span></span><br><span><span leaf=""># rownames(52739): ENSG00000223972.5 ENSG00000227232.5 ... ENSG00000210195.2 ENSG00000210196.2</span></span><br><span><span leaf=""># rowData names(3): gene_id gene_name gene_biotype</span></span><br><span><span leaf=""># colnames(1204): TCGA-44-6147-01B-06R-A277-07 TCGA-44-6147-01A-11R-1755-07 ...</span></span><br><span><span leaf="">#   GTEX-ZZPT-1326-SM-5E43H GTEX-ZZPU-0526-SM-5E44U</span></span><br><span><span leaf=""># colData names(99): sample patient ... OS group2</span></span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">下面就是差不多的分析了，大家可以自行探索。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">结尾</span></span><span></span></h2><blockquote><span></span><p><strong><span leaf="">路漫漫其修远兮,吾将上下而求索。</span></strong></p></blockquote><hr><p data-tool="mdnice编辑器"><span leaf="">欢迎加入生信交流群。加我微信我也拉你进 </span><strong><span leaf="">微信群聊</span></strong><strong><span leaf="">老俊俊生信交流群</span></strong><strong><span leaf="">(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</span></strong><span leaf=""> 。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035876" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXHe65EcPAQBrQV7eYkNQgE2eWQ2EszriboeqUUXytESsBFN0cly1EBdA/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXHe65EcPAQBrQV7eYkNQgE2eWQ2EszriboeqUUXytESsBFN0cly1EBdA/640?wx_fmt=jpeg&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100035877" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXtDVfnqwDh6YymzFLwqXwhtpNFnicJjh8cu0W0ViceZzbfNSR84dxYrzA/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezs9yV6V7C1ka8Dl9L0RDuXtDVfnqwDh6YymzFLwqXwhtpNFnicJjh8cu0W0ViceZzbfNSR84dxYrzA/640?wx_fmt=png&amp;from=appmsg"></span></figure><hr><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong><span leaf=""> 往期回顾目录 </span></strong></center><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><blockquote><span></span><ul><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519507&amp;idx=1&amp;sn=d541b6166515701362547420421f6b01&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">coverage_plot 指定基因组区间绘图</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519484&amp;idx=1&amp;sn=6d62d7d0f789f292776bb32774d8b432&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">omicScope 可视化基因基因组上的 coverage</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519461&amp;idx=1&amp;sn=1a2e3fd2a82c02a9a99dc9e3e5aa7d90&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">omicScope：转录组数据一站式分析平台</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519428&amp;idx=1&amp;sn=32a5474edc16d44f491dd2c3e226c8a1&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">告别坐标解析噩梦！GenomicCoordinates 包来拯救你了</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519408&amp;idx=1&amp;sn=3b17ece77d10c7cce60543bb5350d12b&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">读博，就像骑自行车</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519399&amp;idx=1&amp;sn=5f654a4daa1d32407844eab08118079c&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">pyMut：遗传变异分析及可视化 python 工具</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519382&amp;idx=1&amp;sn=514605db6847df187ba15cf3acafd008&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">Cell：邻近特异性核糖体分析揭示定位线粒体翻译的逻辑机制</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519363&amp;idx=1&amp;sn=671309f5114c2d01dbcb2fb9f2f6a7ba&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">S7：新的面向对象系统</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519336&amp;idx=1&amp;sn=2d6847265c4ce4a5fe114f7b3d923220&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">pyMSAviz：多序列比对可视化</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247519315&amp;idx=1&amp;sn=973c8227fd4d2a66ec3c47866e89175e&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">Click-qPCR：一个超简单的交互式 qPCR 数据分析工具</a></span></left></strong></section></li></ul></blockquote></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Ivb7lStplcBCX1I4S4rE0g",target="_blank" rel="noopener noreferrer">原文链接</a>
