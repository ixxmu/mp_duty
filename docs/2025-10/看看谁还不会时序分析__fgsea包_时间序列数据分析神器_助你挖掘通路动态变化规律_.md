---
title: "看看谁还不会时序分析！ fgsea包，时间序列数据分析神器！助你挖掘通路动态变化规律！"
date: 2025-10-05T11:36:00Z
draft: ["false"]
tags: [
  "fetched",
  "云生信"
]
categories: ["Acdemic"]
---
看看谁还不会时序分析！ fgsea包，时间序列数据分析神器！助你挖掘通路动态变化规律！ by 云生信
------
<div><section nodeleaf=""><img data-imgfileid="100012638" data-ratio="0.2222222222222222" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEUeRH9VLyWbQoJghgIrTRx383Ak7ibU8ltoFYv9E74BicnHHtASRb1mJJU3Arr9qX25DhJ5pErPgDPw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="900" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEUeRH9VLyWbQoJghgIrTRx383Ak7ibU8ltoFYv9E74BicnHHtASRb1mJJU3Arr9qX25DhJ5pErPgDPw/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span><span leaf=""><img data-ratio="0.2127371273712737" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmpyekpfqnFCWOMP2dQibsSmGjTJoTlz78qLqrYcn0ICCgYfvvQ0iaLx0Q/640?wx_fmt=png" data-w="1476" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmpyekpfqnFCWOMP2dQibsSmGjTJoTlz78qLqrYcn0ICCgYfvvQ0iaLx0Q/640?wx_fmt=png"></span></span></p><p><span><span leaf=""><span textstyle="">同学们好呀！今天小师妹要带大家解锁一个在时间序列数据分析中超级好用的R包——fgsea！这个包不仅能做常规的基因集富集分析，还内置了GESECA算法专门处理时间序列数据。无论你是研究Th2细胞激活过程，还是分析其他动态生物过程，fgsea包都能帮你快速找到显著变化的通路。</span></span></span><span><span leaf=""><span textstyle="">就算面对复杂的时序数据，小师妹也能轻松驾驭！遇到分析难题随时找我交流哦~</span></span></span></p><p><span><span leaf=""><span textstyle="">本次教程将从数据下载预处理开始，逐步演示如何获取Hallmark通路集、运行GESECA分析，并通过可视化揭示关键通路的激活模式。我们还会教你用PCA降维加速分析的小技巧，最后通过结果对比验证方法的可靠性。准备好你们的RStudio，话不多说，跟着小师妹一起学习时间序列分析的技巧吧！</span></span></span></p><p><span><span leaf=""><span textstyle="">本次介绍的R包在服务器上能更加流畅地运行，如果没有服务器，欢迎联系我们进行服务器租赁~</span></span><span data-pm-slice="0 0 []"><span leaf="">需要代码示例数据等的小伙伴也记得找师妹哦</span></span></span></p><section><section><section><section><section><section><section><span leaf=""><img data-cropselx1="0" data-cropselx2="194" data-cropsely1="0" data-cropsely2="194" data-imgfileid="100011261" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWesJCYlntv06OhltJriajm4LeGalupZW22ZNynYrOMW2MVzVNRghGJlq7GC8rj3ibl7m9cV4pTup3A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="396" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWesJCYlntv06OhltJriajm4LeGalupZW22ZNynYrOMW2MVzVNRghGJlq7GC8rj3ibl7m9cV4pTup3A/640?wx_fmt=png&amp;from=appmsg"></span></section></section></section><section><section><section><p><span><strong><span leaf="">定制生信分析</span></strong></span></p><p><span><strong><span leaf="">生信云服务器</span></strong></span></p></section></section></section></section></section></section></section><p><span><span leaf=""><span textstyle="">fgsea包与GESECA方法</span></span></span></p><p><span><span leaf=""><span textstyle="">fgsea包是基因集富集分析领域的明星工具，其核心功能GESECA(Gene Set Co-regulation Analysis)专门用于分析基因集在样本维度上的协同变化模式。与传统GSEA不同，GESECA通过主成分分析评估基因集的整体变异度，特别适合时间序列、剂量响应等有序实验设计。</span></span></span><span><span leaf=""><span textstyle="">该方法能有效识别随时间变化呈现规律性激活/抑制的通路，是研究动态生物过程的利器。</span></span></span></p><p><span><span leaf=""><span textstyle="">环境配置与安装</span></span></span></p><p><span><span leaf=""><span textstyle="">通过CRAN和Bioconductor安装所需包：</span></span></span></p><section><ul><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span>if</span><span> </span>(!<span>require</span>(<span>"BiocManager"</span>, quietly = <span>TRUE</span>))          </span></code><code><span leaf="">    install.<span>packages</span>(<span>"BiocManager"</span>)          </span></code><code><span leaf=""><span>BiocManager</span>::<span>install</span>(<span>c</span>(<span>"GEOquery"</span>, <span>"limma"</span>, <span>"fgsea"</span>))          </span></code><code><span leaf="">install.<span>packages</span>(<span>c</span>(<span>"msigdbr"</span>, “msigdbdf”))</span></code></pre></section><p><span><span leaf=""><span textstyle="">验证安装结果：</span></span></span></p><section><ul><li></ul><pre data-lang="apache"><code><span leaf=""><span>packageVersion</span>(<span>"fgsea"</span>)# 应显示<span>1</span>.<span>24</span>.<span>0</span>或更高版本</span></code></pre></section><p><page></page></p><p><span><span leaf=""><img data-ratio="0.1298917568692756" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAm5Kr8YZia9nbck1bhkTMe0H6QXTdlFctPiagUFrxEa7VjSmKlhNRAk08w/640?wx_fmt=png" data-w="1201" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAm5Kr8YZia9nbck1bhkTMe0H6QXTdlFctPiagUFrxEa7VjSmKlhNRAk08w/640?wx_fmt=png"></span></span><span></span></p><p><span><span leaf=""><span textstyle="">如果显示版本号为1.32.4，说明成功安装了fgsea包！</span></span></span></p><p><span><span leaf=""><span textstyle="">Th2细胞激活时序数据分析实战</span></span></span></p><p><span><span leaf=""><span textstyle="">数据准备与预处理：</span></span></span></p><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span># 加载GEO数据集          </span></span></code><code><span leaf=""><span>library</span>(GEOquery)          </span></code><code><span leaf=""><span>library</span>(limma)          </span></code><code><span leaf="">gse200250 &lt;- <span>getGEO</span>(<span>"GSE200250"</span>, AnnotGPL = <span>TRUE</span>)[[<span>1</span>]]          </span></code><code><span leaf=""><span># 筛选Th2样本并按时间排序          </span></span></code><code><span leaf="">es &lt;- gse200250          </span></code><code><span leaf="">es &lt;- es[, <span>grep</span>(<span>"Th2_"</span>, es<span>$title</span>)]          </span></code><code><span leaf="">es<span>$time </span>&lt;- <span>as</span>.<span>numeric</span>(<span>gsub</span>(<span>" hours"</span>, <span>""</span>, es$`<span>time point</span>:ch1`))          </span></code><code><span leaf="">es &lt;- es[, <span>order</span>(es<span>$time</span>)]</span></code></pre></section><p><page></page></p><p><span><span leaf=""><img data-ratio="0.3493670886075949" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmhKvrOhMB5Mib5ibXH0KVdU7zNrP8YCjusK6jtabFGj4Cft94u3gdmU6g/640?wx_fmt=png" data-w="1185" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmhKvrOhMB5Mib5ibXH0KVdU7zNrP8YCjusK6jtabFGj4Cft94u3gdmU6g/640?wx_fmt=png"></span></span></p><p><span><span leaf=""><span textstyle="">过滤之后剩余20080个特征，18个样本。</span></span></span><page></page></p><section><ul><li><li><li><li></ul><pre data-lang="bash"><code><span leaf=""><span># 保留表达量最高的12000个基因          </span></span></code><code><span leaf="">fData(es) &lt;- fData(es)[, c(<span>"ID"</span>, <span>"Gene ID"</span>, <span>"Gene symbol"</span>)]          </span></code><code><span leaf="">es &lt;- es[<span>head</span>(order(rowMeans(exprs(es)), decreasing=TRUE), 12000), ]          </span></code><code><span leaf=""><span>head</span>(exprs(es))</span></code></pre></section><p><span><span leaf=""><img data-ratio="0.2488599348534202" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmw3zfOfvOOUzQibj7Lnq7tjzIflChflST7THG8qhz24TKEMVTXWibPnMQ/640?wx_fmt=png" data-w="1535" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmw3zfOfvOOUzQibj7Lnq7tjzIflChflST7THG8qhz24TKEMVTXWibPnMQ/640?wx_fmt=png"></span></span></p><p><span><span leaf=""><span textstyle="">通过以上的步骤，小师妹带领大家从GEO数据库下载数据集，筛选Th2细胞样本并提取时间信息。经过log2转换和分位数标准化后，去除重复基因和低质量探针，最终保留表达量最高的12000个基因。</span></span></span></p><p><span><span leaf=""><span textstyle="">通路数据准备：</span></span></span></p><section><ul><li><li><li><li></ul><pre data-lang="bash"><code><span leaf=""><span># 获取小鼠Hallmark通路          </span></span></code><code><span leaf="">library(msigdbr)          </span></code><code><span leaf="">pathwaysDF &lt;- msigdbr(<span>"mouse"</span>, collection=<span>"H"</span>)          </span></code><code><span leaf="">pathways &lt;- <span>split</span>(as.character(pathwaysDF<span>$ncbi_gene</span>), pathwaysDF<span>$gs_name</span>)</span></code></pre></section><p><span><span leaf=""><span textstyle="">使用msigdbr包获取小鼠的Hallmark基因集，将通路信息转换为基因列表格式，方便后续分析。</span></span></span><page></page></p><p><span><span leaf=""><span textstyle="">GESECA核心分析：</span></span></span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 运行GESECA分析          </span></span></code><code><span leaf=""><span>library</span>(fgsea)          </span></code><code><span leaf=""><span>set</span>.seed(<span>1</span>)          </span></code><code><span leaf=""><span>gesecaRes</span> &lt;- geseca(pathways, exprs(es), minSize = <span>15</span>, maxSize = <span>500</span>)          </span></code><code><span leaf=""><span># 查看TOP10结果          </span></span></code><code><span leaf=""><span>head</span>(gesecaRes, <span>10</span>)</span></code></pre></section><p><span><span leaf=""><img data-ratio="0.2639676113360324" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAm6UF70CeBAQPHh1QXRtzbVsxO9My3gicdGzRiaxB41XWAVhjTMIGN4exg/640?wx_fmt=png" data-w="1235" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAm6UF70CeBAQPHh1QXRtzbVsxO9My3gicdGzRiaxB41XWAVhjTMIGN4exg/640?wx_fmt=png"></span></span></p><p><span><span leaf=""><span textstyle="">设置随机种子保证结果可重复，筛选基因数在15-500之间的通路。结果表显示各通路的方差解释度(pctVar)和统计显著性。</span></span></span></p><p><span><span leaf=""><span textstyle="">结果可视化：</span></span></span></p><section><ul><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span># E2F通路表达模式          </span></span></code><code><span leaf=""><span>plotCoregulationProfile</span>(pathway=pathways[[<span>"HALLMARK_E2F_TARGETS"</span>]],          </span></code><code><span leaf="">                      E=<span>exprs</span>(es),           </span></code><code><span leaf="">                      titles = es<span>$title</span>,          </span></code><code><span leaf="">                      conditions=es$`<span>time point</span>:ch1`)</span></code></pre></section><p><span></span><page></page></p><p><span><span leaf=""><img data-ratio="0.5784418356456777" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmwnpictBJzyln150mwwpswbGJSmIsR0spH8SYEnkZvcm8icTvmGzibe1qA/640?wx_fmt=jpeg" data-w="937" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmwnpictBJzyln150mwwpswbGJSmIsR0spH8SYEnkZvcm8icTvmGzibe1qA/640?wx_fmt=jpeg"></span></span></p><section><ul><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span># 低氧通路表达模式          </span></span></code><code><span leaf=""><span>plotCoregulationProfile</span>(pathway=pathways[[<span>"HALLMARK_HYPOXIA"</span>]],          </span></code><code><span leaf="">                      E=<span>exprs</span>(es),          </span></code><code><span leaf="">                      titles = es<span>$title</span>,          </span></code><code><span leaf="">                      conditions=es$`<span>time point</span>:ch1`)  </span></code></pre></section><section nodeleaf=""><img data-imgfileid="100013840" data-ratio="0.5791304347826087" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmJic5OFw553NKcLPZlUEUb66cqUDWkrUSrrbqp5Nvvz1lz0YdQicNnSbg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="575" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmJic5OFw553NKcLPZlUEUb66cqUDWkrUSrrbqp5Nvvz1lz0YdQicNnSbg/640?wx_fmt=png&amp;from=appmsg"></section><section><ul><li><li><li><li><li></ul><pre data-lang="bash"><code><span leaf=""><span># 结果汇总表          </span></span></code><code><span leaf="">plotGesecaTable(gesecaRes |&gt; <span>head</span>(10),           </span></code><code><span leaf="">               pathways,           </span></code><code><span leaf="">               E=exprs(es),          </span></code><code><span leaf="">               titles = es<span>$title</span>)</span></code></pre></section><p><page></page></p><p><span><span leaf=""><img data-ratio="0.5784418356456777" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmY4gnI0ItXgytFvkm4ib02InOQUFlBchiavX7uPgCVoTibWb9uCWrSyFibA/640?wx_fmt=jpeg" data-w="937" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmY4gnI0ItXgytFvkm4ib02InOQUFlBchiavX7uPgCVoTibWb9uCWrSyFibA/640?wx_fmt=jpeg"></span></span><page></page></p><p><span><span leaf=""><span textstyle="">E2F靶基因在24小时显著激活，参与细胞周期调控；低氧通路在48小时激活，反映后期代谢适应。汇总表直观展示Top通路的激活模式。</span></span></span></p><p><span><span leaf=""><span textstyle="">PCA加速分析：</span></span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="css"><code><span leaf=""># PCA降维          </span></code><code><span leaf="">E &lt;- t(base::<span>scale</span>(<span>t</span>(<span>exprs</span>(es)), scale=FALSE))          </span></code><code><span leaf="">pcaRev &lt;- <span>prcomp</span>(E, center=FALSE)          </span></code><code><span leaf="">Ered &lt;- pcaRev$x[, <span>1</span>:<span>10</span>]          </span></code><code><span leaf=""># 降维后重新分析          </span></code><code><span leaf="">gesecaResRed &lt;- <span>geseca</span>(pathways, Ered, minSize = <span>15</span>, maxSize = <span>500</span>, center=FALSE)          </span></code><code><span leaf=""># 结果对比          </span></code><code><span leaf=""><span>library</span>(ggplot2)          </span></code><code><span leaf=""><span>ggplot</span>(<span>merge</span>(gesecaRes[, <span>list</span>(pathway, logPvalFull=<span>-log10</span>(pval))],          </span></code><code><span leaf="">            gesecaResRed[, <span>list</span>(pathway, logPvalRed=<span>-log10</span>(pval))])) +          </span></code><code><span leaf="">  <span>geom_point</span>(<span>aes</span>(x=logPvalFull, y=logPvalRed)) +          </span></code><code><span leaf="">  <span>coord_fixed</span>() + <span>theme_classic</span>()</span></code></pre></section><p><span><span leaf=""><br></span></span><page></page></p><p><span><span leaf=""><img data-ratio="0.5784418356456777" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmpZ1dI4oMQdhtnKkcOUy9FnHscpia6NlxdKv1aWgbGHauCQmaGtZHwvw/640?wx_fmt=jpeg" data-w="937" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEV1kE0ibIsEBP4p85D8m2BAmpZ1dI4oMQdhtnKkcOUy9FnHscpia6NlxdKv1aWgbGHauCQmaGtZHwvw/640?wx_fmt=jpeg"></span></span></p><p><span><span leaf=""><span textstyle="">通过PCA将样本维度从18降维到10，分析速度提升但结果保持一致。散点图显示降维前后p值高度一致，证明方法可靠性。</span></span></span></p><p><span><span leaf=""><span textstyle="">总结</span></span></span><page></page></p><p><span><span leaf=""><span textstyle="">本次教程完整演示了使用fgsea包进行时间序列分析的全流程。从数据标准化、通路分析到结果可视化，GESECA方法展现出强大的时序模式捕捉能力。特别是PCA降维技巧，在保持结果准确性的同时显著提升分析效率。希望同学们能将这些方法应用到自己的时序数据研究中，解锁基因集动态变化的奥秘！</span></span></span></p><p><span><span leaf=""><span textstyle="">同学们如果觉得自己写代码麻烦，可以体验一下我们的云生信小工具，只需输入数据，即可轻松生成所需图表。立即访问云生信</span></span></span><span><span><span leaf=""><span textstyle="">（</span></span></span></span><span><span><span leaf=""><span textstyle="">http://www.biocloudservice.com/home.html</span></span></span></span><span><span><span leaf=""><span textstyle="">）</span></span></span></span><span></span><span><span leaf=""><span textstyle="">，开启便捷的生信之旅！</span></span></span></p><p><span leaf=""><br></span></p><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section powered-by="xiumi.us"><p><span leaf="">E</span></p></section></section><section><section powered-by="xiumi.us"><p><span leaf="">N</span></p></section></section><section><section powered-by="xiumi.us"><p><span leaf="">D</span></p></section></section><section><section powered-by="xiumi.us"><section><span leaf=""><br></span></section></section></section></section></section><p><span leaf=""><br></span></p><section><section><section><section><section><section><section><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWesJCYlntv06OhltJriajm4LeGalupZW22ZNynYrOMW2MVzVNRghGJlq7GC8rj3ibl7m9cV4pTup3A/640?wx_fmt=png&amp;from=appmsg" data-ratio="1" data-s="300,640" data-type="png" data-w="396" data-cropselx1="0" data-cropselx2="219" data-cropsely1="0" data-cropsely2="219" data-imgfileid="100013742" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWesJCYlntv06OhltJriajm4LeGalupZW22ZNynYrOMW2MVzVNRghGJlq7GC8rj3ibl7m9cV4pTup3A/640?wx_fmt=png&amp;from=appmsg"></span></section></section></section><section><section><p><span leaf="">定制生信分析</span></p><p><span leaf="">课题思路设计</span></p><p><span leaf="">生信云服务器</span></p></section></section></section></section></section></section><section powered-by="xiumi.us"><section><section><section><section><section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section><section><section><section><p><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5MDk3Mzg4OA==&amp;action=getalbum&amp;album_id=3073838745411518465#wechat_redirect" textvalue="生信实操" linktype="text" data-linktype="2">生信分析实操</a></span></p></section></section><section><section><section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section></section></section></section><section><section><section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section><section><section><section><p><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5MDk3Mzg4OA==&amp;action=getalbum&amp;album_id=3113598048028459016#wechat_redirect" textvalue="生信文章思路" linktype="text" data-linktype="2">生信文章思路</a></span></p></section></section></section></section></section></section></section><page></page></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/RNF-_2DuEz4nug-UW3UBAA",target="_blank" rel="noopener noreferrer">原文链接</a>
