---
title: "Nature 复现 | 绝美时间序列图"
date: 2025-05-06T14:57:07Z
draft: ["false"]
tags: [
  "fetched",
  "MsTt笔记"
]
categories: ["Acdemic"]
---
Nature 复现 | 绝美时间序列图 by MsTt笔记
------
<div><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="0 0 []"><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="MsTt笔记" data-from="1" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKJLwvM2QW48QKCicY8yHrEfwZA1qzJqmnSDuICrXOZEk6YYntc7QSLbdwg12uibFOEziaEVEXhEJQ4vQ/0?wx_fmt=png" data-signature="💕Keep learning 代码分享 ⚠️只分享不答疑 🉑代做" data-id="MzkxNDcwNzY2NQ==" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><p data-tool="mdnice编辑器"><span leaf="">请尊重原创劳动成果🙏</span></p><p><span><span leaf="">未经允许，不得转载，不可抄袭！</span></span></p><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf="">今天来复现 4 个 Nature 期刊中的时序图（Time Series Plot）。</span></p><ul><li><section><span leaf="">时序图1：分组+误差带(Nature)</span></section></li><li><section><span leaf="">时序图2：分面+误差带(Nat Commun)</span></section></li><li><section><span leaf="">时序图3：分组分面+误差棒(Nature)</span></section></li><li><section><span leaf="">时序图4：重复测量方差分析+事后检验(Nature)</span></section></li></ul><section><span leaf=""><br></span></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTkOUgNIU7vtXDsZZYxQzVrib3CvjPs3A6GzKCXv5B7QSL4ib1TiczQ7C7Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.425" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001154" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTkOUgNIU7vtXDsZZYxQzVrib3CvjPs3A6GzKCXv5B7QSL4ib1TiczQ7C7Q/640?wx_fmt=png&amp;from=appmsg"></section><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现一</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">第一篇是 </span><strong><span leaf="">Nature</span></strong><span leaf=""> 文章中 (Kosse, C., Ivanov, J., Knight, Z. et al. A subcortical feeding circuit linking an interoceptive node to jaw movement. Nature 636, 151–161 (2024). https://doi.org/10.1038/s41586-024-08098-1) 的 Fig. 3e</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">原图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhT5yslB31Y8TPuTW5YNhK5icwWrgbBTJByB9h545e6WnqXcoQtPjauZRQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8023407022106632" data-type="png" data-w="769" data-imgfileid="100001155" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhT5yslB31Y8TPuTW5YNhK5icwWrgbBTJByB9h545e6WnqXcoQtPjauZRQ/640?wx_fmt=png&amp;from=appmsg"></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTenwL5C7NKwlCwd714WOYjVNibsniaGoCNKPtYr51Ytvw96r7l8cYd7Ew/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.839142091152815" data-type="png" data-w="746" data-imgfileid="100001156" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTenwL5C7NKwlCwd714WOYjVNibsniaGoCNKPtYr51Ytvw96r7l8cYd7Ew/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf="">如果两个分组的数据呈现出明显不同的趋势，就适合在一张图中展示，这样可以直观地对比两组数据的差异，便于观察它们各自的变化规律以及相互之间的关系。相反，如果两组数据的趋势较为相似，那么采用分面展示的方式会更加清晰，接着往后看复现2。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载R包，准备数据</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="powershell"><code><span leaf=""><span># 加载必要的包</span></span></code><code><span leaf="">library(ggplot2)</span></code><code><span leaf="">library(readxl)   <span># 读取Excel文件</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 读入数据</span></span></code><code><span leaf=""><span>data</span> &lt;- read_excel(<span>"data_1.xlsx"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 转换为长格式</span></span></code><code><span leaf="">data_long &lt;- data.frame(</span></code><code><span leaf="">  time = c(<span>data</span><span>$</span>`Time (s)`, <span>data</span><span>$</span>`Time (s)`),</span></code><code><span leaf="">  <span>group</span> = rep(c(<span>"Fasted"</span>, <span>"4 weeks HPD"</span>), each = nrow(<span>data</span>)),</span></code><code><span leaf="">  average = c(<span>data</span><span>$Fasted_Average</span>, <span>data</span><span>$HPD_Average</span>),</span></code><code><span leaf="">  SEM = c(<span>data</span><span>$Fasted_SEM</span>, <span>data</span><span>$HPD_SEM</span>)</span></code><code><span leaf="">)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义展示顺序</span></span></code><code><span leaf="">data_long<span>$group</span> &lt;- factor(data_long<span>$group</span>, levels = c(<span>"4 weeks HPD"</span>, <span>"Fasted"</span>))</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义颜色</span></span></code><code><span leaf="">my_color = c(<span>"#c1966b"</span>, <span>"#642e8e"</span>)</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">读入数据，将数据转成适合绘图的长格式，自定义分组的展示顺序和颜色。</span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">此绘图数据，如需文末可以自助获取。</span></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>ggplot</span>(data_long, aes(x = time, y = average, fill = group, color = group)) +</span></code><code><span leaf="">  <span>geom_ribbon</span>(aes(ymin = average - SEM, ymax = average + SEM), </span></code><code><span leaf="">              <span>alpha</span> = <span>0</span>.<span>2</span>, color = NA) + </span></code><code><span leaf="">  <span>geom_line</span>(linewidth = <span>0</span>.<span>7</span>) +</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = c(<span>20</span>, <span>30</span>), linetype = <span>"dashed"</span>, color = <span>"grey50"</span>) +</span></code><code><span leaf="">  <span>scale_fill_manual</span>(values = my_color) +         </span></code><code><span leaf="">  <span>scale_color_manual</span>(values = my_color) +        </span></code><code><span leaf="">  <span>guides</span>(fill = guide_legend(override.aes = list(color = my_color, fill = my_color, </span></code><code><span leaf="">                                                 <span>alpha</span> = <span>0</span>.<span>3</span>, linewidth = <span>0</span>.<span>6</span>)),</span></code><code><span leaf="">         <span>color</span> = <span>"none"</span>) +</span></code><code><span leaf="">  <span>scale_x_continuous</span>(limits = c(<span>0</span>, <span>50</span>), expand = c(<span>0</span>, <span>0</span>)) +     </span></code><code><span leaf="">  <span>scale_y_continuous</span>(limits = c(-<span>6</span>, <span>8</span>), breaks = seq(-<span>6</span>, <span>8</span>, <span>2</span>), expand = c(<span>0</span>, <span>0</span>)) +     </span></code><code><span leaf="">  <span>labs</span>(x = <span>"Time (s)"</span>, y = <span>"ΔF/F (%)"</span>) +  </span></code><code><span leaf="">  <span>theme_classic</span>(base_size = <span>12</span>) +</span></code><code><span leaf="">  <span>theme</span>(axis.title = element_text(size = <span>11</span>),   </span></code><code><span leaf="">        <span>axis</span>.text = element_text(size = <span>11</span>, color = <span>"black"</span>),   </span></code><code><span leaf="">        <span>axis</span>.ticks.length = unit(-<span>3</span>, <span>"pt"</span>),</span></code><code><span leaf="">        <span>legend</span>.title = element_blank(),  </span></code><code><span leaf="">        <span>legend</span>.text = element_text(size = <span>11</span>),  </span></code><code><span leaf="">        <span>legend</span>.position = c(<span>0</span>.<span>9</span>, <span>0</span>.<span>95</span>),</span></code><code><span leaf="">        <span>legend</span>.key.size = unit(<span>10</span>, <span>"pt"</span>),</span></code><code><span leaf="">        <span>legend</span>.key.spacing.y = unit(<span>5</span>, 'pt'),</span></code><code><span leaf="">        <span>plot</span>.margin = margin(<span>15</span>, <span>30</span>, <span>10</span>, <span>10</span>, unit = <span>"pt"</span>))  </span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">geom_ribbon()</span></code><span leaf="">函数绘制带状区域表示误差范围：</span></p><ul><li><section><code><span leaf="">ymin/ymax</span></code><span leaf="">: 定义误差带上下边界（均值±标准误）</span></section></li><li><section><code><span leaf="">alpha = 0.2</span></code><span leaf="">: 设置透明度为20%</span></section></li><li><section><code><span leaf="">color = NA</span></code><span leaf="">: 移除带状区域的边框线</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">geom_line()</span></code><span leaf="">函数绘制连接均值的线条。</span></p><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">geom_vline()</span></code><span leaf="">函数绘制垂直参考线：</span></p><ul><li><section><code><span leaf="">xintercept = c(20, 30)</span></code><span leaf="">: 在 x=20 和 x=30 处添加线</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTenwL5C7NKwlCwd714WOYjVNibsniaGoCNKPtYr51Ytvw96r7l8cYd7Ew/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.839142091152815" data-type="png" data-w="746" data-imgfileid="100001157" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTenwL5C7NKwlCwd714WOYjVNibsniaGoCNKPtYr51Ytvw96r7l8cYd7Ew/640?wx_fmt=png&amp;from=appmsg"></span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现二</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">第二篇是 </span><strong><span leaf="">Nature Communications</span></strong><span leaf=""> 文章中 (Zhao, Y., Mei, Y., Liu, Z. et al. Molecularly engineered supramolecular fluorescent chemodosimeter for measuring epinephrine dynamics. Nat Commun 16, 1848 (2025). https://doi.org/10.1038/s41467-025-57100-5) 的 Fig.5C</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">原图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTsyY0wNwsDZiaeWugZP0tsXne0oPmWYibjGabvLnNH2FNhaib4rd9ibOXMg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.28888888888888886" data-type="png" data-w="1080" data-imgfileid="100001158" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTsyY0wNwsDZiaeWugZP0tsXne0oPmWYibjGabvLnNH2FNhaib4rd9ibOXMg/640?wx_fmt=png&amp;from=appmsg"></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTcsX54gCYCNVXZF0VKeWUU5uwMhl20C21CMGSfaWt1yrkjLZx1df1cQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.2935185185185185" data-type="png" data-w="1080" data-imgfileid="100001159" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTcsX54gCYCNVXZF0VKeWUU5uwMhl20C21CMGSfaWt1yrkjLZx1df1cQ/640?wx_fmt=png&amp;from=appmsg"></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载R包，准备数据</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 加载必要的包</span></span></code><code><span leaf=""><span>library</span>(ggplot2)</span></code><code><span leaf=""><span>library</span>(readxl)     # 读取Excel文件</span></code><code><span leaf=""><span>library</span>(patchwork)  # 组合图形</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 读入数据</span></span></code><code><span leaf=""><span>data1</span> &lt;- read_excel(<span>"data_2.xlsx"</span>, sheet = <span>1</span>)</span></code><code><span leaf=""><span>data2</span> &lt;- read_excel(<span>"data_2.xlsx"</span>, sheet = <span>2</span>)</span></code><code><span leaf=""><span>data3</span> &lt;- read_excel(<span>"data_2.xlsx"</span>, sheet = <span>3</span>)</span></code><code><span leaf=""><span>data4</span> &lt;- read_excel(<span>"data_2.xlsx"</span>, sheet = <span>4</span>)</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">将数据放在不同的 sheet 表中，依次读入，分别绘图，再组合图形。</span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">此绘图数据，如需文末可以自助获取。</span></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 图1-S1BF变量</span></span></code><code><span leaf=""><span>p1</span> &lt;- ggplot(data1, aes(x = `Time (s)`)) +</span></code><code><span leaf="">  <span>geom_ribbon</span>(aes(ymin = S1BF - SD, ymax = S1BF + SD), fill = <span>"#dc96f0"</span>) + </span></code><code><span leaf="">  <span>geom_line</span>(aes(y = S1BF, color = <span>"S1BF"</span>), linewidth = <span>0</span>.<span>7</span>) +</span></code><code><span leaf="">  <span>scale_color_manual</span>(values = <span>"#7813f3"</span>) +   # 自定义线条颜色</span></code><code><span leaf="">  <span>scale_x_continuous</span>(limits = c(-<span>10</span>, <span>20</span>),</span></code><code><span leaf="">                     <span>breaks</span> = seq(-<span>10</span>, <span>20</span>, by = <span>5</span>),</span></code><code><span leaf="">                     <span>expand</span> = c(<span>0</span>, <span>0</span>)) +</span></code><code><span leaf="">  <span>scale_y_continuous</span>(limits = c(<span>3</span>.<span>75</span>, <span>4</span>.<span>0</span>),</span></code><code><span leaf="">                     <span>breaks</span> = seq(<span>3</span>.<span>8</span>, <span>4</span>.<span>0</span>, by = <span>0</span>.<span>1</span>),</span></code><code><span leaf="">                     <span>expand</span> = c(<span>0</span>, <span>0</span>)) +</span></code><code><span leaf="">  <span>labs</span>(y = expression(F[<span>570</span>]*<span>"/"</span>*F[<span>595</span>]~<span>"Ratio"</span>)) +  </span></code><code><span leaf="">  <span>theme_classic</span>()</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">geom_ribbon()</span></code><span leaf="">函数绘制带状区域表示误差范围：</span></p><ul><li><section><code><span leaf="">ymin/ymax</span></code><span leaf="">: 定义误差带上下边界（均值±标准误）</span></section></li><li><section><code><span leaf="">fill = "#dc96f0"</span></code><span leaf="">: 设置误差带填充颜色为浅紫色</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">geom_line()</span></code><span leaf="">函数绘制连接均值的线条:</span></p><ul><li><section><code><span leaf="">color = "S1BF"</span></code><span leaf="">: 设置图例标签为"S1BF"</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">scale_color_manual()</span></code><span leaf="">函数自定义线条颜色：</span></p><ul><li><section><code><span leaf="">values = "#7813f3"</span></code><span leaf="">: 将线条颜色设置为深紫色</span></section></li></ul><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTh1PjPQ2Ja8nznrkaUzRwL0JG3WARjOtXLN9AhAPibhxtmrnibAOBjVVg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5826235093696763" data-s="300,640" data-type="png" data-w="587" type="block" data-imgfileid="100001160" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTh1PjPQ2Ja8nznrkaUzRwL0JG3WARjOtXLN9AhAPibhxtmrnibAOBjVVg/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="mdnice编辑器"><span leaf="">另外 3 个图形代码一样，不再赘述！都画出来之后，再将四个图形(p1-p4)组合成一个图形。</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 组合图形</span></span></code><code><span leaf=""><span>all</span> &lt;- p1 + p2 + p3 + p4 +</span></code><code><span leaf="">  <span>plot_layout</span>(nrow = <span>1</span>) &amp;   # 水平排列</span></code><code><span leaf="">  <span>theme</span>(axis.title = element_text(size = <span>20</span>),  </span></code><code><span leaf="">        <span>axis</span>.text = element_text(size = <span>16</span>,color = <span>"black"</span>),  </span></code><code><span leaf="">        <span>legend</span>.title = element_blank(),  </span></code><code><span leaf="">        <span>legend</span>.position = c(<span>0</span>.<span>6</span>, <span>0</span>.<span>95</span>),  </span></code><code><span leaf="">        <span>legend</span>.background = element_blank(),  </span></code><code><span leaf="">        <span>legend</span>.text = element_text(size = <span>14</span>),    </span></code><code><span leaf="">        <span>legend</span>.key.width = unit(<span>2</span>.<span>5</span>, <span>"lines"</span>),    </span></code><code><span leaf="">        <span>plot</span>.margin = margin(<span>5</span>, <span>13</span>, <span>5</span>, <span>5</span>, unit = <span>"pt"</span>))  </span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">plot_layout()</span></code><span leaf="">设置图形布局：</span></p><ul><li><section><code><span leaf="">nrow = 1</span></code><span leaf="">: 所有图形排成一行（水平排列）</span></section></li><li><section><span leaf="">使用</span><code><span leaf="">&amp;</span></code><span leaf="">统一设置所有子图的主题样式</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTcsX54gCYCNVXZF0VKeWUU5uwMhl20C21CMGSfaWt1yrkjLZx1df1cQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.2935185185185185" data-type="png" data-w="1080" data-imgfileid="100001161" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTcsX54gCYCNVXZF0VKeWUU5uwMhl20C21CMGSfaWt1yrkjLZx1df1cQ/640?wx_fmt=png&amp;from=appmsg"></span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现三</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">第三篇是 </span><strong><span leaf="">Nature</span></strong><span leaf=""> 文章中 (Zhang, S.X., Kim, A., Madara, J.C. et al. Stochastic neuropeptide signals compete to calibrate the rate of satiation. Nature 637, 137–144 (2025). https://doi.org/10.1038/s41586-024-08164-8) 的 Extended Data Fig. 2l</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">原图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhT9V5FsCPBydxD5O3iboQLyibqhIdaLY9jgC9DPoStIzG8qSr1SvSIrU7Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.3624627606752731" data-type="png" data-w="1007" data-imgfileid="100001162" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhT9V5FsCPBydxD5O3iboQLyibqhIdaLY9jgC9DPoStIzG8qSr1SvSIrU7Q/640?wx_fmt=png&amp;from=appmsg"></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTdxVah48JrMBLbL9zR8ibpgzicic94wC1T6jcib65aWyRhhbrNWicZzYNLvw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.36283185840707965" data-type="png" data-w="1017" data-imgfileid="100001163" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTdxVah48JrMBLbL9zR8ibpgzicic94wC1T6jcib65aWyRhhbrNWicZzYNLvw/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf="">这个图的特点是，使用的<span textstyle="">误差棒</span>而不是<span textstyle="">误差带</span>来表示误差范围，它适合数据点相对比较少的情况。继续往下看复现4，误差棒的优势就显而易见了。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载R包，准备数据</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="powershell"><code><span leaf=""><span># 加载必要的包</span></span></code><code><span leaf="">library(ggplot2)</span></code><code><span leaf="">library(readxl)     <span># 读取Excel文件</span></span></code><code><span leaf="">library(patchwork)  <span># 组合图形</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 读入数据</span></span></code><code><span leaf="">data1 &lt;- read_excel(<span>"data_3.xlsx"</span>, sheet = <span>1</span>)</span></code><code><span leaf="">data2 &lt;- read_excel(<span>"data_3.xlsx"</span>, sheet = <span>2</span>)</span></code><code><span leaf="">data3 &lt;- read_excel(<span>"data_3.xlsx"</span>, sheet = <span>3</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 转换为长格式的函数</span></span></code><code><span leaf="">prepare_data &lt;- function(<span>data</span>) {</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 转换为长格式</span></span></code><code><span leaf="">  data_long &lt;- data.frame(</span></code><code><span leaf="">    time = c(<span>data</span><span>$</span>`Time (s)`, <span>data</span><span>$</span>`Time (s)`),</span></code><code><span leaf="">    <span>group</span> = rep(c(<span>"SHU9119"</span>, <span>"ACSF"</span>), each = nrow(<span>data</span>)),</span></code><code><span leaf="">    mean = c(<span>data</span><span>$SHU9119_Mean</span>, <span>data</span><span>$ACSF_Mean</span>),</span></code><code><span leaf="">    SEM = c(<span>data</span><span>$SHU9119_SEM</span>, <span>data</span><span>$ACSF_SEM</span>)</span></code><code><span leaf="">  )</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 定义展示顺序</span></span></code><code><span leaf="">  data_long<span>$group</span> &lt;- factor(data_long<span>$group</span>, levels = c(<span>"ACSF"</span>, <span>"SHU9119"</span>))</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span>return</span>(data_long)</span></code><code><span leaf="">}</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 使用函数转数据为长格式</span></span></code><code><span leaf="">data1_long &lt;- prepare_data(data1)</span></code><code><span leaf="">data2_long &lt;- prepare_data(data2)</span></code><code><span leaf="">data3_long &lt;- prepare_data(data3)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义颜色</span></span></code><code><span leaf="">my_color &lt;- c(<span>"#808080"</span>, <span>"#f15a24"</span>)</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">将数据放在不同的 sheet 表中，依次读入，转成长格式，分别绘图，再组合图形。</span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">此绘图数据，如需文末可以自助获取。</span></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># data1 - 图left</span></span></code><code><span leaf=""><span>p1</span> &lt;- ggplot(data1_long, aes(x = time, y = mean, fill = group, color = group)) +</span></code><code><span leaf="">  <span>geom_hline</span>(yintercept = <span>0</span>, linetype = <span>"dashed"</span>, linewidth = <span>0</span>.<span>8</span>) +</span></code><code><span leaf="">  <span>geom_errorbar</span>(aes(ymin = mean - SEM, ymax = mean + SEM, width = <span>0</span>), alpha = <span>0</span>.<span>2</span>) +</span></code><code><span leaf="">  <span>geom_line</span>(linewidth = <span>0</span>.<span>7</span>) +</span></code><code><span leaf="">  <span>scale_color_manual</span>(values = my_color) +   </span></code><code><span leaf="">  <span>scale_fill_manual</span>(values = my_color) +    </span></code><code><span leaf="">  <span>scale_x_continuous</span>(limits = c(-<span>20</span>, <span>120</span>), expand = c(<span>0</span>, <span>0</span>)) +  </span></code><code><span leaf="">  <span>scale_y_continuous</span>(limits = c(-<span>0</span>.<span>05</span>, <span>0</span>.<span>15</span>),                   </span></code><code><span leaf="">                     <span>breaks</span> = seq(-<span>0</span>.<span>05</span>, <span>0</span>.<span>15</span>, by = <span>0</span>.<span>05</span>),</span></code><code><span leaf="">                     <span>expand</span> = c(<span>0</span>, <span>0</span>)) +</span></code><code><span leaf="">  <span>labs</span>(x = <span>"Time (s)"</span>, y = expression(-ΔF/F[<span>0</span>]), title = <span>"Hits: Mouse 1"</span>) +  </span></code><code><span leaf="">  <span>theme_classic</span>() +</span></code><code><span leaf="">  <span>annotate</span>(<span>"segment"</span>, x = -<span>10</span>, xend = -<span>10</span>, y = -<span>0</span>.<span>04</span>, yend = -<span>0</span>.<span>01</span>, </span></code><code><span leaf="">           <span>arrow</span> = arrow(type = <span>"closed"</span>, length = unit(<span>0</span>.<span>3</span>, <span>"cm"</span>)), size = <span>0</span>.<span>6</span>) +</span></code><code><span leaf="">  <span>annotate</span>(<span>"text"</span>, x = -<span>9</span>, y = -<span>0</span>.<span>03</span>, label = <span>"cAMP"</span>, size = <span>6</span>, hjust = <span>0</span>) +</span></code><code><span leaf="">  <span>annotate</span>(<span>"text"</span>, x = <span>70</span>, y = <span>0</span>.<span>14</span>, label = <span>"ACSF"</span>, size = <span>6</span>, color = <span>"#808080"</span>, hjust = <span>0</span>) +</span></code><code><span leaf="">  <span>annotate</span>(<span>"text"</span>, x = <span>40</span>, y = <span>0</span>.<span>02</span>, label = <span>"SHU9119"</span>, size = <span>6</span>, color = <span>"#f15a24"</span>, hjust = <span>0</span>)</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">geom_hline()</span></code><span leaf="">函数绘制水平参考线：</span></p><ul><li><section><code><span leaf="">yintercept = 0</span></code><span leaf="">: 在 y=0 处画线</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">geom_errorbar()</span></code><span leaf="">函数添加误差棒(表示标准误范围)：</span></p><ul><li><section><code><span leaf="">ymin/ymax</span></code><span leaf="">: 定义误差条上下边界(均值±标准误)</span></section></li><li><section><code><span leaf="">width = 0</span></code><span leaf="">: 误差条宽度为0(垂直线)</span></section></li><li><section><code><span leaf="">alpha = 0.2</span></code><span leaf="">: 设置透明度为20%</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">geom_line()</span></code><span leaf="">函数绘制连接均值的线条。</span></p><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">annotate("segment")</span></code><span leaf="">函数添加箭头注释(cAMP注射标记)。</span></p><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">annotate("text")</span></code><span leaf="">函数添加文本注释。</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTFXHHJ3k3ep3z60JBZJiaMia8DJIDNY2AUE5mAVcib7DC54B3w0QUoRMQA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6610169491525424" data-s="300,640" data-type="png" data-w="826" type="block" data-imgfileid="100001164" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTFXHHJ3k3ep3z60JBZJiaMia8DJIDNY2AUE5mAVcib7DC54B3w0QUoRMQA/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="mdnice编辑器"><span leaf="">另外 2 个图形代码一样，不再赘述！都画出来之后，再将四个图形(p1-p3)组合成一个图形。</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 组合图形</span></span></code><code><span leaf=""><span>all</span> &lt;- p1 + p2 + p3 +</span></code><code><span leaf="">  <span>plot_layout</span>(nrow = <span>1</span>) &amp;   # 水平排列</span></code><code><span leaf="">  <span>theme</span>(axis.title = element_text(size = <span>18</span>),       </span></code><code><span leaf="">        <span>axis</span>.text = element_text(size = <span>18</span>,color = <span>"black"</span>),  </span></code><code><span leaf="">        <span>axis</span>.line = element_line(linewidth = <span>0</span>.<span>8</span>),  </span></code><code><span leaf="">        <span>axis</span>.ticks = element_line(linewidth = <span>0</span>.<span>8</span>), </span></code><code><span leaf="">        <span>axis</span>.ticks.length = unit(<span>7</span>, <span>"pt"</span>),          </span></code><code><span leaf="">        <span>plot</span>.title = element_text(size = <span>18</span>, hjust = <span>0</span>.<span>5</span>),  </span></code><code><span leaf="">        <span>legend</span>.position = <span>"none"</span>,  </span></code><code><span leaf="">        <span>plot</span>.margin = margin(<span>5</span>, <span>25</span>, <span>5</span>, <span>5</span>, unit = <span>"pt"</span>))  </span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">plot_layout()</span></code><span leaf="">设置图形布局：</span></p><ul><li><section><code><span leaf="">nrow = 1</span></code><span leaf="">: 所有图形排成一行（水平排列）</span></section></li><li><section><span leaf="">使用</span><code><span leaf="">&amp;</span></code><span leaf="">统一设置所有子图的主题样式</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTdxVah48JrMBLbL9zR8ibpgzicic94wC1T6jcib65aWyRhhbrNWicZzYNLvw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.36283185840707965" data-type="png" data-w="1017" data-imgfileid="100001165" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTdxVah48JrMBLbL9zR8ibpgzicic94wC1T6jcib65aWyRhhbrNWicZzYNLvw/640?wx_fmt=png&amp;from=appmsg"></span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现四</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">第四篇是 </span><strong><span leaf="">Nature</span></strong><span leaf=""> 文章中 (Beddows, C.A., Shi, F., Horton, A.L. et al. Pathogenic hypothalamic extracellular matrix promotes metabolic disease. Nature 633, 914–922 (2024). https://doi.org/10.1038/s41586-024-07922-y) 的 Fig. 3l</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">原图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhT5SLYhpibszeC88yOsddsPlhFjqic2tUibhe75pKq0jxdafUkafShOuFgA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6625835189309577" data-type="png" data-w="898" data-imgfileid="100001166" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhT5SLYhpibszeC88yOsddsPlhFjqic2tUibhe75pKq0jxdafUkafShOuFgA/640?wx_fmt=png&amp;from=appmsg"></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTPuTg3etmwN9d56FqFiavOiarDNPyvIgOEewrG0kXegfNbFZy9pEnAIFA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6514476614699332" data-type="png" data-w="898" data-imgfileid="100001167" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTPuTg3etmwN9d56FqFiavOiarDNPyvIgOEewrG0kXegfNbFZy9pEnAIFA/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">复现过程中学习到的技巧：</span></span></p><p data-tool="mdnice编辑器"><span leaf="">对于重复测量值，如何正确地进行方差分析？文章中是这样描述的： Two-way ANOVA with multiple comparisons or repeated-measures，我使用 </span><strong><span leaf="">rstatix</span></strong><span leaf=""> 包的</span><code><span leaf="">anova_test()</span></code><span leaf="">函数进行重复测量方差分析（ANOVA），</span><code><span leaf="">t_test</span></code><span leaf="">函数进行事后检验。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载R包，准备数据</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="powershell"><code><span leaf=""><span># 加载必要的包</span></span></code><code><span leaf="">library(tidyverse)</span></code><code><span leaf="">library(readxl)</span></code><code><span leaf="">library(rstatix) <span># 重复测量方差分析</span></span></code><code><span leaf="">library(ggpubr)  <span># 添加显著性标记</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 读入数据</span></span></code><code><span leaf=""><span>data</span>  = read_xlsx(<span>"data_4.xlsx"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 宽数据转换成长数据</span></span></code><code><span leaf="">data_long &lt;- <span>data</span> %&gt;%</span></code><code><span leaf="">  pivot_longer(</span></code><code><span leaf="">    cols = value1:value6,</span></code><code><span leaf="">    names_to = <span>"subject"</span>,</span></code><code><span leaf="">    values_to = <span>"GIR"</span></span></code><code><span leaf="">  ) %&gt;%</span></code><code><span leaf="">  <span>filter</span>(!(<span>group</span> == <span>"chABC"</span> &amp; subject == <span>"value6"</span>)) %&gt;% <span># 移除chABC组的value6(缺失值)</span></span></code><code><span leaf="">  mutate(</span></code><code><span leaf="">    subject = paste0(<span>group</span>, <span>"_"</span>, str_remove(subject, <span>"value"</span>)),</span></code><code><span leaf="">    <span>group</span> = factor(<span>group</span>, levels=c(<span>"chABC"</span>, <span>"Vehicle"</span>)),</span></code><code><span leaf="">    time = factor(time, levels = c(<span>-15</span>, <span>-5</span>, <span>0</span>, <span>10</span>, <span>20</span>, <span>30</span>, <span>40</span>, <span>50</span>, <span>60</span>, <span>70</span>, <span>80</span>, <span>90</span>, <span>100</span>, <span>110</span>, <span>120</span>)),</span></code><code><span leaf="">    phase = ifelse(time %<span>in</span>% c(<span>-15</span>, <span>-5</span>, <span>0</span>), <span>"Basal"</span>, <span>"Clamp"</span>)</span></code><code><span leaf="">  )</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">读入数据，将宽格式数据转换为长格式，生成唯一的受试者ID(组名+编号)，自定义分组的展示顺序和颜色，并创建实验阶段变量(基础期和钳制期，只对钳制期进行方差分析)。</span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">此绘图数据，如需文末可以自助获取。</span></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">统计分析</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="sql"><code><span leaf=""># 重复测量方差分析</span></code><code><span leaf="">res.aov <span>&lt;-</span> anova_test(</span></code><code><span leaf="">  data <span>=</span> <span>filter</span>(data_long, phase <span>==</span> "Clamp"),  # 仅分析钳制期</span></code><code><span leaf="">  dv <span>=</span> GIR,         </span></code><code><span leaf="">  wid <span>=</span> subject,    </span></code><code><span leaf="">  <span>within</span> <span>=</span> <span>time</span>,    </span></code><code><span leaf="">  <span>between</span> <span>=</span> <span>group</span>   </span></code><code><span leaf="">)</span></code><code><span leaf=""><br></span></code><code><span leaf="">anova_results <span>&lt;-</span> get_anova_table(res.aov)  </span></code><code><span leaf="">print(anova_results)   </span></code><code><span leaf=""><br></span></code><code><span leaf=""># 事后检验(组间比较)</span></code><code><span leaf="">posthoc <span>&lt;-</span> data_long <span>%&gt;%</span></span></code><code><span leaf="">  <span>filter</span>(phase <span>==</span> "Clamp") <span>%&gt;%</span>    </span></code><code><span leaf="">  group_by(<span>time</span>) <span>%&gt;%</span>              </span></code><code><span leaf="">  t_test(GIR <span>~</span> <span>group</span>) <span>%&gt;%</span>         </span></code><code><span leaf="">  #adjust_pvalue(<span>method</span> <span>=</span> "bonferroni") <span>%&gt;%</span>  # 矫正 </span></code><code><span leaf="">  add_significance()              </span></code><code><span leaf=""><br></span></code><code><span leaf="">print(posthoc)  </span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">anova_test()</span></code><span leaf="">函数进行重复测量方差分析(仅分析钳制期数据)：</span></p><ul><li><section><code><span leaf="">data = filter(data_long, phase == "Clamp")</span></code><span leaf="">: 使用</span><code><span leaf="">filter()</span></code><span leaf="">函数从数据集中选择“钳制期”的数据</span></section></li><li><section><code><span leaf="">dv = GIR</span></code><span leaf="">: 设置因变量</span></section></li><li><section><code><span leaf="">wid = subject</span></code><span leaf="">: 指定受试者ID变量</span></section></li><li><section><code><span leaf="">within = time</span></code><span leaf="">: 设置组内因素，表示在不同时间点对同一组受试者进行测量</span></section></li><li><section><code><span leaf="">between = group</span></code><span leaf="">: 设置组间因素，表示不同处理组之间的比较</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTDUQj0O7NdgmsjGCXRy1DCVzaEIRlaY5YleC3lWM0VxibA9xJc9L7uVA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.22210065645514224" data-s="300,640" data-type="png" data-w="914" type="block" data-imgfileid="100001168" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTDUQj0O7NdgmsjGCXRy1DCVzaEIRlaY5YleC3lWM0VxibA9xJc9L7uVA/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">t_test(GIR ~ group)</span></code><span leaf="">函数对每个时间点执行t检验，比较不同处理组之间的差异。</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTh9c8w0xM7HODU29Fx7ukVdouqbMmkNOs8bR1CC4npL1oO7EGo4m1sA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.47685185185185186" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001169" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTh9c8w0xM7HODU29Fx7ukVdouqbMmkNOs8bR1CC4npL1oO7EGo4m1sA/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 点线+误差线图</span></span></code><code><span leaf=""><span>p</span> &lt;- ggplot(data_long, aes(x = time, y = GIR)) +</span></code><code><span leaf="">  <span>annotate</span>(<span>"rect"</span>, xmin = <span>0</span>, xmax = <span>"0"</span>, ymin = <span>0</span>, ymax = <span>40</span>, fill = <span>"#dae2f3"</span>) +       </span></code><code><span leaf="">  <span>annotate</span>(<span>"rect"</span>, xmin = <span>"90"</span>, xmax = <span>"120"</span>, ymin = <span>0</span>, ymax = <span>40</span>, fill = <span>"#dae2f3"</span>) +  </span></code><code><span leaf="">  <span>annotate</span>(<span>"text"</span>, x = <span>"-15"</span>, y = <span>40</span>, label = <span>"Basal"</span>, hjust = <span>0</span>.<span>3</span>, vjust = -<span>0</span>.<span>4</span>, size = <span>7</span>) +  </span></code><code><span leaf="">  <span>annotate</span>(<span>"text"</span>, x = <span>"90"</span>, y = <span>40</span>, label = <span>"Clamp"</span>, hjust = -<span>0</span>.<span>1</span>, vjust = -<span>0</span>.<span>4</span>, size = <span>7</span>) +  </span></code><code><span leaf="">  <span>stat_summary</span>(aes(group = group), </span></code><code><span leaf="">               <span>geom</span> = <span>"errorbar"</span>,fun.data = <span>"mean_se"</span>, </span></code><code><span leaf="">               <span>width</span> = <span>0</span>.<span>4</span>, size = <span>0</span>.<span>6</span>) +</span></code><code><span leaf="">  <span>stat_summary</span>(aes(group = group),</span></code><code><span leaf="">               <span>geom</span> = <span>"line"</span>, fun = <span>"mean"</span>, </span></code><code><span leaf="">               <span>linewidth</span> = <span>1</span>) +</span></code><code><span leaf="">  <span>stat_summary</span>(aes(fill = group), </span></code><code><span leaf="">               <span>geom</span> = <span>"point"</span>, fun = <span>"mean"</span>, </span></code><code><span leaf="">               <span>size</span> = <span>5</span>, shape = <span>21</span>, color = <span>"black"</span>, stroke = <span>1</span>) +</span></code><code><span leaf="">  <span>scale_fill_manual</span>(values = c(<span>"#ffc000"</span>, <span>"black"</span>),</span></code><code><span leaf="">                    <span>labels</span> = c(expression(paste(<span>"chABC ("</span>, italic(<span>"n"</span>), <span>" = 5)"</span>)),</span></code><code><span leaf="">                               <span>expression</span>(paste(<span>"Vehicle ("</span>, italic(<span>"n"</span>), <span>" = 6)"</span>)))) +</span></code><code><span leaf="">  <span>scale_x_discrete</span>(breaks = c(-<span>15</span>, -<span>5</span>, <span>0</span>, <span>20</span>, <span>40</span>, <span>60</span>, <span>80</span>, <span>100</span>, <span>120</span>)) +</span></code><code><span leaf="">  <span>scale_y_continuous</span>(expand = c(<span>0</span>, <span>0</span>), breaks = seq(<span>0</span>, <span>40</span>, <span>5</span>)) +</span></code><code><span leaf="">  <span>coord_cartesian</span>(ylim = c(<span>0</span>, <span>40</span>), clip = <span>"off"</span>) +</span></code><code><span leaf="">  <span>labs</span>(x = <span>"Time (min)"</span>,</span></code><code><span leaf="">       <span>y</span> = expression(paste(<span>"GIR (mg "</span>, kg^{-<span>1</span>}, <span>" "</span>, min^{-<span>1</span>}, <span>")"</span>))) +</span></code><code><span leaf="">  <span>theme_classic</span>(base_size = <span>20</span>) +</span></code><code><span leaf="">  <span>theme</span>(plot.margin = margin(<span>30</span>, <span>10</span>, <span>10</span>, <span>10</span>, unit = <span>"pt"</span>), # 调整图形边距（上、右、下、左）</span></code><code><span leaf="">        <span>axis</span>.text = element_text(color = <span>"black"</span>),</span></code><code><span leaf="">        <span>legend</span>.title = element_blank(),</span></code><code><span leaf="">        <span>legend</span>.text = element_text(size = <span>18</span>),</span></code><code><span leaf="">        <span>legend</span>.position = c(<span>0</span>.<span>25</span>, <span>0</span>.<span>35</span>), </span></code><code><span leaf="">        <span>legend</span>.justification = c(<span>0</span>,<span>1</span>),</span></code><code><span leaf="">        <span>legend</span>.background = element_blank())</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">annotate("rect")</span></code><span leaf="">函数在图中添加矩形区域，即背景色块，以标记不同的实验阶段。</span></p><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">annotate("text")</span></code><span leaf="">函数在图中添加阶段文本标签。</span></p><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">stat_summary(...)</span></code><span leaf="">函数计算并绘制统计摘要：</span></p><ul><li><section><code><span leaf="">geom = "errorbar"</span></code><span leaf="">: 绘制误差条。</span><code><span leaf="">fun.data = "mean_se"</span></code><span leaf="">表示使用均值和标准误差来计算误差条的高度。</span></section></li><li><section><code><span leaf="">geom="line"</span></code><span leaf="">: 绘制连接各点的折线。</span><code><span leaf="">fun.data = "mean"</span></code><span leaf="">表示使用均值来绘制折线。</span></section></li><li><section><code><span leaf="">geom="point"</span></code><span leaf="">: 绘制散点。</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">coord_cartesian()</span></code><span leaf="">函数设置 y 轴的显示范围，并允许超出范围的元素不被裁剪。</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTicicibHN29YFWcwQ2icKV3xLFVZb0icicrtiavX7LpKO2f43VwTnbSzKU0dZg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6342592592592593" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001170" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTicicibHN29YFWcwQ2icKV3xLFVZb0icicrtiavX7LpKO2f43VwTnbSzKU0dZg/640?wx_fmt=png&amp;from=appmsg"></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 添加显著性标记（仅显示 p&lt;0.05 的比较）</span></span></code><code><span leaf=""><span>sig_data</span> &lt;- filter(posthoc, p &lt; <span>0</span>.<span>05</span>) %&gt;%     # 筛选p&lt;<span>0</span>.<span>05</span>的显著结果</span></code><code><span leaf="">  <span>add_xy_position</span>(x = <span>"time"</span>, scales = <span>"free"</span>, fun = <span>"mean"</span>)  %&gt;%</span></code><code><span leaf="">  <span>mutate</span>(xmin = xmin + <span>0</span>.<span>2</span>,            </span></code><code><span leaf="">         <span>xmax</span> = xmax - <span>0</span>.<span>2</span>,            </span></code><code><span leaf="">         <span>y</span>.position = y.position + <span>2</span>)  </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>p</span> + stat_pvalue_manual(sig_data, </span></code><code><span leaf="">                       <span>label</span> = <span>"p.signif"</span>,     # 显示显著性符号(*)</span></code><code><span leaf="">                       <span>label</span>.size = <span>6</span>,         # 符号大小</span></code><code><span leaf="">                       <span>remove</span>.bracket = TRUE,  # 不显示括号</span></code><code><span leaf="">                       <span>tip</span>.length = <span>0</span>)         # 不显示提示线    </span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">筛选显著性结果:</span></p><ul><li><section><code><span leaf="">filter()</span></code><span leaf="">: 从事后检验结果 posthoc 中筛选出 p 值小于 0.05 的显著比较。这将只保留统计上显著的结果。</span></section></li><li><section><code><span leaf="">add_xy_position()</span></code><span leaf="">: 为显著性标记计算 x 和 y 的位置。这里指定</span><code><span leaf="">x = "time"</span></code><span leaf="">表示使用时间作为 x 轴变量，</span><code><span leaf="">scales = "free"</span></code><span leaf="">表示允许 y 轴自由扩展，</span><code><span leaf="">fun = "mean"</span></code><span leaf="">表示计算均值位置。</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">stat_pvalue_manual()</span></code><span leaf="">将显著性标记添加到图中。</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTkMPxHslKI4UOVCLCEozKwuRTSEGSPSgsicyOoytzYkpzRT6ppwo2JiaQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6425925925925926" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001171" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKIL6JtLgmASAS1Wof6c0LhTkMPxHslKI4UOVCLCEozKwuRTSEGSPSgsicyOoytzYkpzRT6ppwo2JiaQ/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">获取以 RProject 形式保存的</span></span><strong><span leaf=""><span textstyle="">绘图代码+注释+数据模板</span></span></strong><span leaf=""><span textstyle="">，后台回复关键词: </span></span><strong><em><span leaf=""><span textstyle="">250506_time_series</span></span></em></strong></p></section></section><section nodeleaf=""><mp-common-cpsad data-pluginname="mpcps" data-templateid="list" data-cpsversion="v120" data-goodssouce="1" data-traceid="a603c662-1f75-4aba-b355-6eb73590a0fb" data-pid="101_14835066"></mp-common-cpsad></section><section nodeleaf=""><mp-common-cpsad data-pluginname="mpcps" data-templateid="list" data-cpsversion="v120" data-goodssouce="1" data-traceid="a603c662-1f75-4aba-b355-6eb73590a0fb" data-pid="101_14324026"></mp-common-cpsad></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/mAOgsMJJJnHVHHMteS5O_A",target="_blank" rel="noopener noreferrer">原文链接</a>
