---
title: "rawrr: 一个可以直接访问Orbitrap数据的R包"
date: 2025-05-02T10:37:09Z
draft: ["false"]
tags: [
  "fetched",
  "MS driven Multiomics"
]
categories: ["Acdemic"]
---
rawrr: 一个可以直接访问Orbitrap数据的R包 by MS driven Multiomics
------
<div><p data-pm-slice="0 0 []"><span leaf=""> </span></p><section><h1 data-heading="true"><span leaf="">rawrr: 一个可以直接访问Orbitrap数据的R包</span></h1><h2 data-heading="true"><span leaf="">rawrr</span></h2><p><span leaf="">rawrr上层为 R，底层为隐藏的 C# 层。R中用于访问二进制raw文件中数据的函数通过调用已编译的 C# 。这些 C 包装器方法的调用会执行 Thermo Fisher Scientific 提供的 RawFileReader API中的方法。为了将提取的数据返回给R，rawrr采用了file I/O的方式,提取的信息会被写入硬盘的临时位置，然后再读取并解析为R对象。结构示意图如下：</span></p><figure><span leaf=""><img alt="结构示意图" data-imgfileid="100001277" data-type="png" title="null" data-ratio="1.0732538330494037" data-w="587" data-src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xszIpkH0RB0ls3Mu4DCuo4j0iajFHnGvRb9vBcEmBlyRH5Kdqu9DBDwGQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xszIpkH0RB0ls3Mu4DCuo4j0iajFHnGvRb9vBcEmBlyRH5Kdqu9DBDwGQ/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">结构示意图</span></figcaption></figure><h2 data-heading="true"><span leaf="">安装</span></h2><p><span leaf="">rawrr包依赖于Thermo的 RawFileReader .NET 程序,为了在 R 中直接访问原始质谱数据，需要安装 rawrr.exe 可执行文件:</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span><span leaf="">if</span></span><span><span leaf="">(</span></span><span><span leaf="">!</span></span><span leaf="">require</span><span><span leaf="">(</span></span><span><span leaf="">"BiocManager"</span></span><span><span leaf="">,</span></span><span leaf=""> quietly </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">TRUE</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><br><span leaf="">    install.packages</span><span><span leaf="">(</span></span><span><span leaf="">"BiocManager"</span></span><span><span leaf="">)</span></span><br><span><span leaf="">if</span></span><span><span leaf="">(</span></span><span><span leaf="">!</span></span><span leaf="">require</span><span><span leaf="">(</span></span><span><span leaf="">"rawrr"</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><span><span leaf="">{</span></span><span leaf="">BiocManager</span><span><span leaf="">::</span></span><span leaf="">install</span><span><span leaf="">(</span></span><span><span leaf="">"rawrr"</span></span><span><span leaf="">)</span></span><span><span leaf="">}</span></span><br><span leaf="">rawrr</span><span><span leaf="">::</span></span><span leaf="">installRawrrExe</span><span><span leaf="">(</span></span><span><span leaf="">)</span></span></code></pre><h2 data-heading="true"><span leaf="">Orbitrap谱图分析</span></h2><p><span leaf="">rawrr的read函数功能介绍：</span></p><section><table><thead><tr><td><section><span leaf="">函数</span></section></td><td><section><span leaf="">作用</span></section></td><td><section><span leaf="">返回数据</span></section></td></tr></thead><tbody><tr><td><section><span leaf="">readFileHeader()</span></section></td><td><section><span leaf="">读取文件头元信息</span></section></td><td><section><span leaf="">返回list</span></section></td></tr><tr><td><section><span leaf="">readIndex()</span></section></td><td><section><span leaf="">生成扫描索引</span></section></td><td><section><span leaf="">返回data.frame</span></section></td></tr><tr><td><section><span leaf="">readSpectrum()</span></section></td><td><section><span leaf="">读取质谱扫描</span></section></td><td><section><span leaf="">返回rawrrSpectrum</span></section></td></tr><tr><td><section><span leaf="">readTrailer()</span></section></td><td><section><span leaf="">读取 trailer 信息</span></section></td><td><section><span leaf="">返回vector</span></section></td></tr><tr><td><section><span leaf="">readChromatogram()</span></section></td><td><section><span leaf="">读取色谱数据</span></section></td><td><section><span leaf="">返回rawrrChromatogram</span></section></td></tr></tbody></table></section><p><span leaf="">比如一个DIA数据：</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">demo.rawfile </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">"raw/demo.raw"</span></span><br><span leaf="">H </span><span><span leaf="">=</span></span><span leaf=""> rawrr</span><span><span leaf="">::</span></span><span leaf="">readFileHeader</span><span><span leaf="">(</span></span><span leaf="">demo.rawfile</span><span><span leaf="">)</span></span><br></code></pre><p><span leaf="">质谱采集信息：</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">scan_index </span><span><span leaf="">=</span></span><span leaf=""> rawrr</span><span><span leaf="">::</span></span><span leaf="">readIndex</span><span><span leaf="">(</span></span><span leaf="">demo.rawfile</span><span><span leaf="">)</span></span><br><span leaf="">tibble</span><span><span leaf="">::</span></span><span leaf="">as_tibble</span><span><span leaf="">(</span></span><span leaf="">scan_index</span><span><span leaf="">)</span></span><br></code></pre><section><table><thead><tr><td><section><span leaf="">scan</span></section></td><td><section><span leaf="">scanType</span></section></td><td><section><span leaf="">StartTime</span></section></td><td><section><span leaf="">precursorMass</span></section></td><td><section><span leaf="">MSOrder</span></section></td><td><section><span leaf="">charge</span></section></td><td><section><span leaf="">masterScan</span></section></td><td><section><span leaf="">dependencyType</span></section></td></tr></thead><tbody><tr><td><section><span leaf="">1</span></section></td><td><section><span leaf="">FTMS + p NSI Full ms [350.0000-1300.0000]</span></section></td><td><section><span leaf="">0.001041654</span></section></td><td><section><span leaf="">NA</span></section></td><td><section><span leaf="">Ms</span></section></td><td><section><span leaf="">0</span></section></td><td><section><span leaf="">NA</span></section></td><td><section><span leaf="">FALSE</span></section></td></tr><tr><td><section><span leaf="">2</span></section></td><td><section><span leaf="">FTMS + c NSI Full ms2 </span><span><span leaf="">366.4164@hcd33.00</span></span><span leaf=""> [200.0000-1600.0000]</span></section></td><td><section><span leaf="">0.009983212</span></section></td><td><section><span leaf="">366.4164</span></section></td><td><section><span leaf="">Ms2</span></section></td><td><section><span leaf="">2</span></section></td><td><section><span leaf="">0</span></section></td><td><section><span leaf="">FALSE</span></section></td></tr><tr><td><section><span leaf="">3</span></section></td><td><section><span leaf="">FTMS + c NSI Full ms2 </span><span><span leaf="">394.9294@hcd33.00</span></span><span leaf=""> [200.0000-1600.0000]</span></section></td><td><section><span leaf="">0.010196317</span></section></td><td><section><span leaf="">394.9294</span></section></td><td><section><span leaf=""><br></span></section></td><td><section><span leaf="">Ms2</span></section></td><td><section><span leaf="">2</span></section></td><td><section><span leaf="">0</span></section></td></tr><tr><td><section><span leaf="">4</span></section></td><td><section><span leaf="">FTMS + c NSI Full ms2 </span><span><span leaf="">417.4396@hcd33.00</span></span><span leaf=""> [200.0000-1600.0000]</span></section></td><td><section><span leaf="">0.012262398</span></section></td><td><section><span leaf="">417.4396</span></section></td><td><section><span leaf="">Ms2</span></section></td><td><section><span leaf="">2</span></section></td><td><section><span leaf="">0</span></section></td><td><section><span leaf="">FALSE</span></section></td></tr></tbody></table></section><p><span leaf="">通过获取的scan_index信息，我们可以获取数据的采集方法，其中scanType显示Full scan范围为350-1300，其中每个full ms 后面跟了35个ms2 scan:</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">scan_index = scan_index  |&gt; </span><br><span leaf="">  dplyr::mutate(scan_id = dplyr::row_number())</span><br><span leaf="">scan_index  = scan_index  |&gt; </span><br><span leaf="">  dplyr::mutate(ms1_block = cumsum(MSOrder == "Ms"))</span><br><br><span leaf="">ms2_counts  =scan_index  |&gt; </span><br><span leaf="">  dplyr::filter(MSOrder == "Ms2")  |&gt; </span><br><span leaf="">  dplyr::count(ms1_block, name = "n_MS2")</span><br><span leaf="">ms2_counts</span></code></pre><section><table><thead><tr><td><section><span leaf="">ms1_block</span></section></td><td><section><span leaf="">n_MS2</span></section></td></tr></thead><tbody><tr><td><section><span leaf="">1</span></section></td><td><section><span leaf="">35</span></section></td></tr></tbody></table></section><p><span leaf="">同样也可以计算采集方法的cycle time,结合色谱峰宽就可以粗略估计每个色谱峰的采集点数来评估方法是否合理:</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">cycle_time</span><span><span leaf="">=</span></span><span><span leaf="">(</span></span><span><span leaf="">(</span></span><span leaf="">scan_index</span><span><span leaf="">[</span></span><span><span leaf="">1</span></span><span><span leaf="">:</span></span><span><span leaf="">37</span></span><span><span leaf="">,</span></span><span><span leaf="">]</span></span><span><span leaf="">[</span></span><span><span leaf="">c</span></span><span><span leaf="">(</span></span><span><span leaf="">1</span></span><span><span leaf="">,</span></span><span><span leaf="">37</span></span><span><span leaf="">)</span></span><span><span leaf="">,</span></span><span><span leaf="">3</span></span><span><span leaf="">]</span></span><span><span leaf="">[</span></span><span><span leaf="">2</span></span><span><span leaf="">]</span></span><span><span leaf="">)</span></span><span><span leaf="">-</span></span><span><span leaf="">(</span></span><span leaf="">scan_index</span><span><span leaf="">[</span></span><span><span leaf="">1</span></span><span><span leaf="">:</span></span><span><span leaf="">37</span></span><span><span leaf="">,</span></span><span><span leaf="">]</span></span><span><span leaf="">[</span></span><span><span leaf="">c</span></span><span><span leaf="">(</span></span><span><span leaf="">1</span></span><span><span leaf="">,</span></span><span><span leaf="">37</span></span><span><span leaf="">)</span></span><span><span leaf="">,</span></span><span><span leaf="">3</span></span><span><span leaf="">]</span></span><span><span leaf="">[</span></span><span><span leaf="">1</span></span><span><span leaf="">]</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><span><span leaf="">*</span></span><span><span leaf="">60</span></span><br><span leaf="">print</span><span><span leaf="">(</span></span><span leaf="">paste0</span><span><span leaf="">(</span></span><span><span leaf="">"cycle time:"</span></span><span><span leaf="">,</span></span><span><span leaf="">round</span></span><span><span leaf="">(</span></span><span leaf="">cycle_time</span><span><span leaf="">,</span></span><span><span leaf="">3</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span></code></pre><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">[1] "cycle time:4.823"</span></code></pre><p><span leaf="">基于读取的扫描谱图索引信息，可以提取单张谱图数据：</span></p><p><span leaf="">谱图数据可视化:</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">scan_number</span><span><span leaf="">=</span></span><span><span leaf="">21446</span></span><span><span leaf="">#第21446张谱图</span></span><br><span leaf="">spectrum </span><span><span leaf="">=</span></span><span leaf=""> rawrr</span><span><span leaf="">::</span></span><span leaf="">readSpectrum</span><span><span leaf="">(</span></span><span leaf="">demo.rawfile</span><span><span leaf="">,</span></span><span leaf=""> scan </span><span><span leaf="">=</span></span><span leaf=""> scan_number</span><span><span leaf="">)</span></span><br><span><span leaf="">#summary(spectrum)</span></span><br><span leaf="">plot</span><span><span leaf="">(</span></span><span leaf="">spectrum</span><span><span leaf="">[[</span></span><span><span leaf="">1</span></span><span><span leaf="">]</span></span><span><span leaf="">]</span></span><span><span leaf="">,</span></span><span leaf=""> centroid</span><span><span leaf="">=</span></span><span><span leaf="">TRUE</span></span><span><span leaf="">,</span></span><span leaf="">SN </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">FALSE</span></span><span><span leaf="">)</span></span><span><span leaf="">#如果是MS1的数据 centroid是无效参数</span></span><br></code></pre><figure><span leaf=""><img alt="Figure2" data-imgfileid="100001278" data-type="png" title="null" data-ratio="0.6175925925925926" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsrjTvSRPcpqJiayFzwvgx1dDbEfef40k3O4Ra2O7XV7kr9ia60Bc1FgzQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsrjTvSRPcpqJiayFzwvgx1dDbEfef40k3O4Ra2O7XV7kr9ia60Bc1FgzQ/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">Figure2</span></figcaption></figure><p><span leaf="">当然也可以提取每张谱图数据进行额外筛选过滤和可视化：</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">Info</span><span><span leaf="">=</span></span><span leaf="">spectrum</span><span><span leaf="">[[</span></span><span><span leaf="">1</span></span><span><span leaf="">]</span></span><span><span leaf="">]</span></span><br><span leaf="">mz </span><span><span leaf="">=</span></span><span leaf=""> Info</span><span><span leaf="">$</span></span><span leaf="">centroid.mZ</span><br><span leaf="">intensity </span><span><span leaf="">=</span></span><span leaf=""> Info</span><span><span leaf="">$</span></span><span leaf="">centroid.intensity</span><br><span leaf="">Res</span><span><span leaf="">=</span></span><span leaf="">Info</span><span><span leaf="">$</span></span><span leaf="">resolutions</span><br><span leaf="">Instrument_Res</span><span><span leaf="">=</span></span><span leaf="">Info</span><span><span leaf="">$</span></span><span leaf="">`Orbitrap Resolution:`</span><br><span leaf="">z</span><span><span leaf="">=</span></span><span leaf="">Info</span><span><span leaf="">$</span></span><span leaf="">charge</span><br><span leaf="">dt </span><span><span leaf="">=</span></span><span leaf=""> data.frame</span><span><span leaf="">(</span></span><span leaf="">mz</span><span><span leaf="">,</span></span><span leaf="">intensity</span><span><span leaf="">,</span></span><span leaf="">Res</span><span><span leaf="">,</span></span><span leaf="">charge</span><span><span leaf="">=</span></span><span leaf="">z</span><span><span leaf="">)</span></span><span><span leaf="">|&gt;</span></span><br><span leaf="">  dplyr</span><span><span leaf="">::</span></span><span leaf="">mutate</span><span><span leaf="">(</span></span><span leaf="">scannumber</span><span><span leaf="">=</span></span><span leaf="">Info</span><span><span leaf="">$</span></span><span leaf="">scan</span><span><span leaf="">,</span></span><span leaf="">scanType</span><span><span leaf="">=</span></span><span leaf="">Info</span><span><span leaf="">$</span></span><span leaf="">scanType</span><span><span leaf="">,</span></span><span leaf="">TIC</span><span><span leaf="">=</span></span><span leaf="">Info</span><span><span leaf="">$</span></span><span leaf="">TIC</span><span><span leaf="">,</span></span><span leaf="">Real_Res</span><span><span leaf="">=</span></span><span leaf="">Res</span><span><span leaf="">,</span></span><span leaf="">Setting_Res</span><span><span leaf="">=</span></span><span leaf="">Instrument_Res</span><span><span leaf="">,</span></span><span leaf="">scan_range</span><span><span leaf="">=</span></span><span leaf="">paste0</span><span><span leaf="">(</span></span><span leaf="">Info</span><span><span leaf="">$</span></span><span leaf="">massRange</span><span><span leaf="">[</span></span><span><span leaf="">1</span></span><span><span leaf="">]</span></span><span><span leaf="">,</span></span><span><span leaf="">"-"</span></span><span><span leaf="">,</span></span><span leaf="">Info</span><span><span leaf="">$</span></span><span leaf="">massRange</span><span><span leaf="">[</span></span><span><span leaf="">2</span></span><span><span leaf="">]</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><br><br><br><span leaf="">plot_peaks </span><span><span leaf="">=</span></span><span><span leaf="">function</span></span><span><span leaf="">(</span></span><span leaf="">dt</span><span><span leaf="">,</span></span><span leaf=""> top_n </span><span><span leaf="">=</span></span><span><span leaf="">10</span></span><span><span leaf="">,</span></span><span leaf=""> title </span><span><span leaf="">=</span></span><span><span leaf="">NULL</span></span><span><span leaf="">)</span></span><span><span leaf="">{</span></span><br><span leaf="">  top_peaks </span><span><span leaf="">=</span></span><span leaf="">dt </span><span><span leaf="">|&gt;</span></span><br><span leaf="">    dplyr</span><span><span leaf="">::</span></span><span leaf="">arrange</span><span><span leaf="">(</span></span><span leaf="">dplyr</span><span><span leaf="">::</span></span><span leaf="">desc</span><span><span leaf="">(</span></span><span leaf="">intensity</span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><span><span leaf="">|&gt;</span></span><br><span leaf="">    dplyr</span><span><span leaf="">::</span></span><span leaf="">slice</span><span><span leaf="">(</span></span><span><span leaf="">1</span></span><span><span leaf="">:</span></span><span leaf="">top_n</span><span><span leaf="">)</span></span><span><span leaf="">|&gt;</span></span><br><span leaf="">    dplyr</span><span><span leaf="">::</span></span><span leaf="">mutate</span><span><span leaf="">(</span></span><span leaf="">label </span><span><span leaf="">=</span></span><span leaf=""> paste0</span><span><span leaf="">(</span></span><span><span leaf="">"z="</span></span><span><span leaf="">,</span></span><span leaf=""> charge</span><span><span leaf="">,</span></span><span><span leaf="">"\nR="</span></span><span><span leaf="">,</span></span><span leaf=""> Res</span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><br><span leaf=""> p</span><span><span leaf="">=</span></span><span leaf=""> ggplot2</span><span><span leaf="">::</span></span><span leaf="">ggplot</span><span><span leaf="">(</span></span><span leaf="">dt</span><span><span leaf="">,</span></span><span leaf=""> ggplot2</span><span><span leaf="">::</span></span><span leaf="">aes</span><span><span leaf="">(</span></span><span leaf="">x </span><span><span leaf="">=</span></span><span leaf=""> mz</span><span><span leaf="">,</span></span><span leaf=""> y </span><span><span leaf="">=</span></span><span leaf=""> intensity</span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><span><span leaf="">+</span></span><br><span leaf="">    ggplot2</span><span><span leaf="">::</span></span><span leaf="">geom_segment</span><span><span leaf="">(</span></span><span leaf="">ggplot2</span><span><span leaf="">::</span></span><span leaf="">aes</span><span><span leaf="">(</span></span><span leaf="">xend </span><span><span leaf="">=</span></span><span leaf=""> mz</span><span><span leaf="">,</span></span><span leaf=""> yend </span><span><span leaf="">=</span></span><span><span leaf="">0</span></span><span><span leaf="">)</span></span><span><span leaf="">,</span></span><span leaf=""> color </span><span><span leaf="">=</span></span><span><span leaf="">"darkblue"</span></span><span><span leaf="">)</span></span><span><span leaf="">+</span></span><br><span leaf="">    ggplot2</span><span><span leaf="">::</span></span><span leaf="">geom_point</span><span><span leaf="">(</span></span><span leaf="">data </span><span><span leaf="">=</span></span><span leaf=""> top_peaks</span><span><span leaf="">,</span></span><span leaf=""> color </span><span><span leaf="">=</span></span><span><span leaf="">"red"</span></span><span><span leaf="">,</span></span><span leaf=""> size </span><span><span leaf="">=</span></span><span><span leaf="">2</span></span><span><span leaf="">)</span></span><span><span leaf="">+</span></span><br><span leaf="">    ggplot2</span><span><span leaf="">::</span></span><span leaf="">geom_text</span><span><span leaf="">(</span></span><span leaf="">data </span><span><span leaf="">=</span></span><span leaf=""> top_peaks</span><span><span leaf="">,</span></span><span leaf=""> ggplot2</span><span><span leaf="">::</span></span><span leaf="">aes</span><span><span leaf="">(</span></span><span leaf="">label </span><span><span leaf="">=</span></span><span leaf=""> label</span><span><span leaf="">)</span></span><span><span leaf="">,</span></span><span leaf=""> vjust </span><span><span leaf="">=</span></span><span><span leaf="">-</span></span><span><span leaf="">1</span></span><span><span leaf="">,</span></span><span leaf=""> size </span><span><span leaf="">=</span></span><span><span leaf="">3</span></span><span><span leaf="">)</span></span><span><span leaf="">+</span></span><br><span leaf="">    ggplot2</span><span><span leaf="">::</span></span><span leaf="">labs</span><span><span leaf="">(</span></span><span leaf="">title </span><span><span leaf="">=</span></span><span leaf=""> title</span><span><span leaf="">,</span></span><span leaf=""> x </span><span><span leaf="">=</span></span><span><span leaf="">"m/z"</span></span><span><span leaf="">,</span></span><span leaf=""> y </span><span><span leaf="">=</span></span><span><span leaf="">"Intensity"</span></span><span><span leaf="">)</span></span><span><span leaf="">+</span></span><br><span leaf="">    ggplot2</span><span><span leaf="">::</span></span><span leaf="">theme_classic</span><span><span leaf="">(</span></span><span><span leaf="">)</span></span><span><span leaf="">+</span></span><br><span leaf="">   ggplot2</span><span><span leaf="">::</span></span><span leaf="">theme</span><span><span leaf="">(</span></span><span leaf="">plot.title </span><span><span leaf="">=</span></span><span leaf=""> ggplot2</span><span><span leaf="">::</span></span><span leaf="">element_text</span><span><span leaf="">(</span></span><span leaf="">hjust </span><span><span leaf="">=</span></span><span><span leaf="">0.5</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><br><span><span leaf="">return</span></span><span><span leaf="">(</span></span><span leaf="">p</span><span><span leaf="">)</span></span><br><span><span leaf="">}</span></span><br><br><span leaf="">plot_peaks</span><span><span leaf="">(</span></span><span leaf="">dt</span><span><span leaf="">,</span></span><span leaf="">top_n </span><span><span leaf="">=</span></span><span><span leaf="">10</span></span><span><span leaf="">,</span></span><span leaf="">title </span><span><span leaf="">=</span></span><span leaf="">paste0</span><span><span leaf="">(</span></span><span><span leaf="">"scan number:"</span></span><span><span leaf="">,</span></span><span leaf="">unique</span><span><span leaf="">(</span></span><span leaf="">dt</span><span><span leaf="">$</span></span><span leaf="">scannumber</span><span><span leaf="">)</span></span><span><span leaf="">,</span></span><span><span leaf="">"\n"</span></span><span><span leaf="">,</span></span><span leaf="">unique</span><span><span leaf="">(</span></span><span leaf="">dt</span><span><span leaf="">$</span></span><span leaf="">scanType</span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><br></code></pre><figure><span leaf=""><img alt="Figure3" data-imgfileid="100001276" data-type="png" title="null" data-ratio="0.6175925925925926" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsANmXWibQfSgx3ic2rxMBo52mSVjpFXmibeY2ROuFfMk1QQZ8uqRMOOpHA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsANmXWibQfSgx3ic2rxMBo52mSVjpFXmibeY2ROuFfMk1QQZ8uqRMOOpHA/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">Figure3</span></figcaption></figure><p><span leaf="">从谱图标注的数据我们可以看到Orbitrap中峰的基本属性，比如分辨率R和电荷数z(要求该谱图数据为centroid格式)。同时基于图中的分辨率信息，我们也可以计算每个碎片离子大致的S/N：</span></p><section><svg aria-hidden="true" viewbox="0 -1006.3 8231 1256.3" role="img" height="2.842ex" xmlns="http://www.w3.org/2000/svg"><g transform="scale(1,-1)" stroke-width="0" fill="currentColor" stroke="currentColor"><g data-mml-node="math"><g data-mml-node="mtext"><path d="M55 507Q55 590 112 647T243 704H257Q342 704 405 641L426 672Q431 679 436 687T446 700L449 704Q450 704 453 704T459 705H463Q466 705 472 699V462L466 456H448Q437 456 435 459T430 479Q413 605 329 646Q292 662 254 662Q201 662 168 626T135 542Q135 508 152 480T200 435Q210 431 286 412T370 389Q427 367 463 314T500 191Q500 110 448 45T301 -21Q245 -21 201 -4T140 27L122 41Q118 36 107 21T87 -7T78 -21Q76 -22 68 -22H64Q61 -22 55 -16V101Q55 220 56 222Q58 227 76 227H89Q95 221 95 214Q95 182 105 151T139 90T205 42T305 24Q352 24 386 62T420 155Q420 198 398 233T340 281Q284 295 266 300Q261 301 239 306T206 314T174 325T141 343T112 367T85 402Q55 451 55 507Z" data-c="53"></path><path transform="translate(556,0)" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z" data-c="2F"></path><path transform="translate(1056,0)" d="M42 46Q74 48 94 56T118 69T128 86V634H124Q114 637 52 637H25V683H232L235 680Q237 679 322 554T493 303L578 178V598Q572 608 568 613T544 627T492 637H475V683H483Q498 680 600 680Q706 680 715 683H724V637H707Q634 633 622 598L621 302V6L614 0H600Q585 0 582 3T481 150T282 443T171 605V345L172 86Q183 50 257 46H274V0H265Q250 3 150 3Q48 3 33 0H25V46H42Z" data-c="4E"></path></g><g transform="translate(2083.8,0)" data-mml-node="mo"><path d="M56 124T56 216T107 375T238 442Q260 442 280 438T319 425T352 407T382 385T406 361T427 336T442 315T455 297T462 285L469 297Q555 442 679 442Q687 442 722 437V398H718Q710 400 694 400Q657 400 623 383T567 343T527 294T503 253T495 235Q495 231 520 192T554 143Q625 44 696 44Q717 44 719 46H722V-5Q695 -11 678 -11Q552 -11 457 141Q455 145 454 146L447 134Q362 -11 235 -11Q157 -11 107 56ZM93 213Q93 143 126 87T220 31Q258 31 292 48T349 88T389 137T413 178T421 196Q421 200 396 239T362 288Q322 345 288 366T213 387Q163 387 128 337T93 213Z" data-c="221D"></path></g><g transform="translate(3139.6,0)" data-mml-node="mtext"><path d="M255 0Q240 3 140 3Q48 3 39 0H32V46H47Q119 49 139 88Q140 91 192 245T295 553T348 708Q351 716 366 716H376Q396 715 400 709Q402 707 508 390L617 67Q624 54 636 51T687 46H717V0H708Q699 3 581 3Q458 3 437 0H427V46H440Q510 46 510 64Q510 66 486 138L462 209H229L209 150Q189 91 189 85Q189 72 209 59T259 46H264V0H255ZM447 255L345 557L244 256Q244 255 345 255H447Z" data-c="41"></path><path transform="translate(750,0)" d="M56 342Q56 428 89 500T174 615T283 681T391 705Q394 705 400 705T408 704Q499 704 569 636L582 624L612 663Q639 700 643 704Q644 704 647 704T653 705H657Q660 705 666 699V419L660 413H626Q620 419 619 430Q610 512 571 572T476 651Q457 658 426 658Q401 658 376 654T316 633T254 592T205 519T177 411Q173 369 173 335Q173 259 192 201T238 111T302 58T370 31T431 24Q478 24 513 45T559 100Q562 110 562 160V212Q561 213 557 216T551 220T542 223T526 225T502 226T463 227H437V273H449L609 270Q715 270 727 273H735V227H721Q674 227 668 215Q666 211 666 108V6Q660 0 657 0Q653 0 639 10Q617 25 600 42L587 54Q571 27 524 3T406 -22Q317 -22 238 22T108 151T56 342Z" data-c="47"></path><path transform="translate(1535,0)" d="M56 342Q56 428 89 500T174 615T283 681T391 705Q394 705 400 705T408 704Q499 704 569 636L582 624L612 663Q639 700 643 704Q644 704 647 704T653 705H657Q660 705 666 699V419L660 413H626Q620 419 619 430Q610 512 571 572T476 651Q457 658 426 658Q322 658 252 588Q173 509 173 342Q173 221 211 151Q232 111 263 84T328 45T384 29T428 24Q517 24 571 93T626 244Q626 251 632 257H660L666 251V236Q661 133 590 56T403 -21Q262 -21 159 83T56 342Z" data-c="43"></path></g><g transform="translate(5618.8,0)" data-mml-node="mo"><path d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z" data-c="D7"></path></g><g transform="translate(6619,0)" data-mml-node="msqrt"><g transform="translate(853,0)"><g data-mml-node="mi"><path d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z" data-c="1D445"></path></g></g><g transform="translate(0,146.3)" data-mml-node="mo"><path d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z" data-c="221A"></path></g><rect y="886.3" x="853" height="60" width="759"></rect></g></g></g></svg></section><ul><li><section><span leaf="">• </span><strong><span leaf="">charges</span></strong><span leaf=""> 表示注入 Orbitrap 分析器中的基本电荷数量，由参数 AGC target控制；</span></section></li><li><section><span leaf="">• </span><strong><span leaf="">R</span></strong><span leaf=""> 表示当前扫描的分辨率。</span></section></li></ul><p><span leaf="">使用</span><code><span leaf="">protViz</span></code><span leaf="">对LGGNEQVTR++肽段计算结果获取的y离子信息进行标注，发现y离子信号都不太好，提示这张谱图数据质量不佳（无参考意义，随便找的demo数据），实际上上面可以看到最大注入时间以及对应的AGC target信息:</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">plot</span><span><span leaf="">(</span></span><span leaf="">spectrum</span><span><span leaf="">[[</span></span><span><span leaf="">1</span></span><span><span leaf="">]</span></span><span><span leaf="">]</span></span><span><span leaf="">,</span></span><span leaf=""> centroid</span><span><span leaf="">=</span></span><span><span leaf="">TRUE</span></span><span><span leaf="">,</span></span><span leaf=""> SN </span><span><span leaf="">=</span></span><span><span leaf="">TRUE</span></span><span><span leaf="">,</span></span><span leaf=""> diagnostic </span><span><span leaf="">=</span></span><span><span leaf="">TRUE</span></span><span><span leaf="">)</span></span><br><span><span leaf="">#S/N 阈值</span></span><br><span leaf="">abline</span><span><span leaf="">(</span></span><span leaf="">h </span><span><span leaf="">=</span></span><span><span leaf="">5</span></span><span><span leaf="">,</span></span><span leaf=""> lty </span><span><span leaf="">=</span></span><span><span leaf="">2</span></span><span><span leaf="">,</span></span><span leaf=""> col </span><span><span leaf="">=</span></span><span><span leaf="">"blue"</span></span><span><span leaf="">)</span></span><br><span><span leaf="">#Target peptide LGGNEQVTR++</span></span><br><span><span leaf="">(</span></span><span leaf="">yIonSeries </span><span><span leaf="">=</span></span><span leaf=""> protViz</span><span><span leaf="">::</span></span><span leaf="">fragmentIon</span><span><span leaf="">(</span></span><span><span leaf="">"LGGNEQVTR"</span></span><span><span leaf="">)</span></span><span><span leaf="">[[</span></span><span><span leaf="">1</span></span><span><span leaf="">]</span></span><span><span leaf="">]</span></span><span><span leaf="">$</span></span><span leaf="">y</span><span><span leaf="">[</span></span><span><span leaf="">1</span></span><span><span leaf="">:</span></span><span><span leaf="">8</span></span><span><span leaf="">]</span></span><span><span leaf="">)</span></span><br><span><span leaf="">names</span></span><span><span leaf="">(</span></span><span leaf="">yIonSeries</span><span><span leaf="">)</span></span><span><span leaf="">=</span></span><span leaf="">paste0</span><span><span leaf="">(</span></span><span><span leaf="">"y"</span></span><span><span leaf="">,</span></span><span leaf=""> seq</span><span><span leaf="">(</span></span><span><span leaf="">1</span></span><span><span leaf="">,</span></span><span><span leaf="">length</span></span><span><span leaf="">(</span></span><span leaf="">yIonSeries</span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><br><span leaf="">abline</span><span><span leaf="">(</span></span><span leaf="">v </span><span><span leaf="">=</span></span><span leaf=""> yIonSeries</span><span><span leaf="">,</span></span><span leaf=""> col</span><span><span leaf="">=</span></span><span><span leaf="">'#DDDDDD88'</span></span><span><span leaf="">,</span></span><span leaf=""> lwd</span><span><span leaf="">=</span></span><span><span leaf="">5</span></span><span><span leaf="">)</span></span><br><span leaf="">axis</span><span><span leaf="">(</span></span><span><span leaf="">3</span></span><span><span leaf="">,</span></span><span leaf=""> yIonSeries</span><span><span leaf="">,</span></span><span><span leaf="">names</span></span><span><span leaf="">(</span></span><span leaf="">yIonSeries</span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><br></code></pre><figure><span leaf=""><img alt="Figure4" data-imgfileid="100001280" data-type="png" title="null" data-ratio="0.6175925925925926" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsiaRHPnFJd5hAEic1McovvRcWPyrbXTmT0cw4pA7tmkH78VzIicLRgFVXA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsiaRHPnFJd5hAEic1McovvRcWPyrbXTmT0cw4pA7tmkH78VzIicLRgFVXA/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">Figure4</span></figcaption></figure><p><span leaf="">当然，TIC也可以：</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">rawrr</span><span><span leaf="">::</span></span><span leaf="">readChromatogram</span><span><span leaf="">(</span></span><span leaf="">rawfile </span><span><span leaf="">=</span></span><span leaf=""> demo.rawfile</span><span><span leaf="">,</span></span><span leaf=""> type </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">"tic"</span></span><span><span leaf="">)</span></span><span leaf=""> </span><span><span leaf="">|&gt;</span></span><br><span leaf="">  plot</span><span><span leaf="">(</span></span><span><span leaf="">)</span></span></code></pre><figure><span leaf=""><img alt="Figure5" data-imgfileid="100001279" data-type="png" title="null" data-ratio="0.6175925925925926" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsicO1PU3GYdnZFxNlANakVUZTeca1za529EHCO7O5Zlj8lAms3xwSrGw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsicO1PU3GYdnZFxNlANakVUZTeca1za529EHCO7O5Zlj8lAms3xwSrGw/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">Figure5</span></figcaption></figure><p><span leaf="">BPC也行：</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">rawrr</span><span><span leaf="">::</span></span><span leaf="">readChromatogram</span><span><span leaf="">(</span></span><span leaf="">rawfile </span><span><span leaf="">=</span></span><span leaf="">demo.rawfile</span><span><span leaf="">,</span></span><span leaf=""> type </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">"bpc"</span></span><span><span leaf="">)</span></span><span leaf=""> </span><span><span leaf="">|&gt;</span></span><br><span leaf="">  plot</span><span><span leaf="">(</span></span><span><span leaf="">)</span></span></code></pre><figure><span leaf=""><img alt="Figure6" data-imgfileid="100001284" data-type="png" title="null" data-ratio="0.6175925925925926" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xs0HNDpGDHbIEANLWw2gIOeIzyI4hCUeK7P9TBd3MuQI4q7NuWibPnL2A/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xs0HNDpGDHbIEANLWw2gIOeIzyI4hCUeK7P9TBd3MuQI4q7NuWibPnL2A/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">Figure6</span></figcaption></figure><p><span leaf="">自定义一些iRT信息提取EIC：</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">iRTmz </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">c</span></span><span><span leaf="">(</span></span><span><span leaf="">487.2571</span></span><span><span leaf="">,</span></span><span><span leaf="">547.2984</span></span><span><span leaf="">,</span></span><span><span leaf="">622.8539</span></span><span><span leaf="">,</span></span><span><span leaf="">636.8695</span></span><span><span leaf="">,</span></span><span><span leaf="">644.8230</span></span><span><span leaf="">,</span></span><span><span leaf="">669.8384</span></span><span><span leaf="">,</span></span><span><span leaf="">683.8282</span></span><span><span leaf="">,</span></span><br><span leaf="">            </span><span><span leaf="">683.8541</span></span><span><span leaf="">,</span></span><span><span leaf="">699.3388</span></span><span><span leaf="">,</span></span><span><span leaf="">726.8361</span></span><span><span leaf="">,</span></span><span><span leaf="">776.9301</span></span><span><span leaf="">)</span></span><br><br><span><span leaf="">names</span></span><span><span leaf="">(</span></span><span leaf="">iRTmz</span><span><span leaf="">)</span></span><span><span leaf="">=</span></span><span><span leaf="">c</span></span><span><span leaf="">(</span></span><span><span leaf="">"LGGNEQVTR"</span></span><span><span leaf="">,</span></span><span><span leaf="">"YILAGVENSK"</span></span><span><span leaf="">,</span></span><span><span leaf="">"GTFIIDPGGVIR"</span></span><span><span leaf="">,</span></span><span><span leaf="">"GTFIIDPAAVIR"</span></span><span><span leaf="">,</span></span><br><span leaf="">                 </span><span><span leaf="">"GAGSSEPVTGLDAK"</span></span><span><span leaf="">,</span></span><span><span leaf="">"TPVISGGPYEYR"</span></span><span><span leaf="">,</span></span><span><span leaf="">"VEATFGVDESNAK"</span></span><span><span leaf="">,</span></span><br><span leaf="">                 </span><span><span leaf="">"TPVITGAPYEYR"</span></span><span><span leaf="">,</span></span><span><span leaf="">"DGLDAASYYAPVR"</span></span><span><span leaf="">,</span></span><span><span leaf="">"ADVTPADFSEWSK"</span></span><span><span leaf="">,</span></span><br><span leaf="">                 </span><span><span leaf="">"LFLQFGAQGSPFLK"</span></span><span><span leaf="">)</span></span><br><br><span leaf="">C </span><span><span leaf="">=</span></span><span leaf=""> rawrr</span><span><span leaf="">::</span></span><span leaf="">readChromatogram</span><span><span leaf="">(</span></span><span leaf="">demo.rawfile</span><span><span leaf="">,</span></span><span leaf=""> mass </span><span><span leaf="">=</span></span><span leaf=""> iRTmz</span><span><span leaf="">,</span></span><span leaf=""> tol </span><span><span leaf="">=</span></span><span><span leaf="">10</span></span><span><span leaf="">,</span></span><span leaf=""> type </span><span><span leaf="">=</span></span><span><span leaf="">"xic"</span></span><span><span leaf="">,</span></span><span leaf=""> filter </span><span><span leaf="">=</span></span><span><span leaf="">"ms"</span></span><span><span leaf="">)</span></span><br><span leaf="">plot</span><span><span leaf="">(</span></span><span leaf="">C</span><span><span leaf="">,</span></span><span leaf=""> diagnostic </span><span><span leaf="">=</span></span><span><span leaf="">TRUE</span></span><span><span leaf="">)</span></span></code></pre><figure><span leaf=""><img alt="image-20250502180058073" data-imgfileid="100001281" data-type="png" title="null" data-ratio="0.6175925925925926" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xs3VMkdYln67HLhk8icnHy1Bd2H0SOEicSknH7lraGe8zOt41jGEducwWQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xs3VMkdYln67HLhk8icnHy1Bd2H0SOEicSknH7lraGe8zOt41jGEducwWQ/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">image-20250502180058073</span></figcaption></figure><p><span leaf="">当然也可以选择肽段的离子类型：</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">rawrr</span><span><span leaf="">::</span></span><span leaf="">readChromatogram</span><span><span leaf="">(</span></span><span leaf="">rawfile </span><span><span leaf="">=</span></span><span leaf=""> demo.rawfile</span><span><span leaf="">,</span></span><br><span leaf="">      mass </span><span><span leaf="">=</span></span><span leaf=""> yIonSeries</span><span><span leaf="">[</span></span><span><span leaf="">c</span></span><span><span leaf="">(</span></span><span><span leaf="">"y6"</span></span><span><span leaf="">,</span></span><span leaf=""> </span><span><span leaf="">"y7"</span></span><span><span leaf="">,</span></span><span leaf=""> </span><span><span leaf="">"y8"</span></span><span><span leaf="">)</span></span><span><span leaf="">]</span></span><span><span leaf="">,</span></span><br><span leaf="">      type </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">'xic'</span></span><span><span leaf="">,</span></span><br><span leaf="">      tol </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">10</span></span><span><span leaf="">,</span></span><br><span leaf="">      filter </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">"FTMS + c NSI Full ms2 394.9294@hcd33.00 [200.0000-1600.0000]"</span></span><span><span leaf="">)</span></span><span leaf=""> </span><span><span leaf="">|&gt;</span></span><br><span leaf="">  plot</span><span><span leaf="">(</span></span><span leaf="">diagnostic </span><span><span leaf="">=</span></span><span leaf=""> </span><span><span leaf="">TRUE</span></span><span><span leaf="">)</span></span><br></code></pre><figure><span leaf=""><img alt="image-20250502180119969" data-imgfileid="100001282" data-type="png" title="null" data-ratio="0.6175925925925926" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsJJCjktKueRNeEz7XQYRCxFDIicNqHRP444u96vb63wXdG7TVfsVWpWw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xsJJCjktKueRNeEz7XQYRCxFDIicNqHRP444u96vb63wXdG7TVfsVWpWw/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">image-20250502180119969</span></figcaption></figure><p><span leaf="">也可以从rawrrChromatogram对象的XIC中实现拟合每条色谱曲线（强度 vs. 时间）并找到拟合曲线的apex RT，然后建立一个RT~score的回归模型，最后可以用这个模型去矫正位置肽段的RT：</span></p><pre><span hidden=""><svg viewbox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code><span leaf="">par</span><span><span leaf="">(</span></span><span leaf="">mfrow </span><span><span leaf="">=</span></span><span><span leaf="">c</span></span><span><span leaf="">(</span></span><span><span leaf="">3</span></span><span><span leaf="">,</span></span><span><span leaf="">4</span></span><span><span leaf="">)</span></span><span><span leaf="">,</span></span><span leaf=""> mar</span><span><span leaf="">=</span></span><span><span leaf="">c</span></span><span><span leaf="">(</span></span><span><span leaf="">4</span></span><span><span leaf="">,</span></span><span><span leaf="">4</span></span><span><span leaf="">,</span></span><span><span leaf="">4</span></span><span><span leaf="">,</span></span><span><span leaf="">1</span></span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><br><span leaf="">rtFittedAPEX</span><span><span leaf="">=</span></span><span leaf=""> C </span><span><span leaf="">|&gt;</span></span><br><span leaf="">  rawrr</span><span><span leaf="">:::</span></span><span leaf="">pickPeak.rawrrChromatogram</span><span><span leaf="">(</span></span><span><span leaf="">)</span></span><span><span leaf="">|&gt;</span></span><br><span leaf="">  rawrr</span><span><span leaf="">:::</span></span><span leaf="">fitPeak.rawrrChromatogram</span><span><span leaf="">(</span></span><span><span leaf="">)</span></span><span><span leaf="">|&gt;</span></span><br><span leaf="">  lapply</span><span><span leaf="">(</span></span><span><span leaf="">function</span></span><span><span leaf="">(</span></span><span leaf="">x</span><span><span leaf="">)</span></span><span><span leaf="">{</span></span><br><span leaf="">    plot</span><span><span leaf="">(</span></span><span leaf="">x</span><span><span leaf="">$</span></span><span leaf="">times</span><span><span leaf="">,</span></span><span leaf=""> x</span><span><span leaf="">$</span></span><span leaf="">intensities</span><span><span leaf="">,</span></span><span leaf=""> type</span><span><span leaf="">=</span></span><span><span leaf="">'p'</span></span><span><span leaf="">,</span></span><br><span leaf="">         ylim</span><span><span leaf="">=</span></span><span><span leaf="">range</span></span><span><span leaf="">(</span></span><span><span leaf="">c</span></span><span><span leaf="">(</span></span><span leaf="">x</span><span><span leaf="">$</span></span><span leaf="">intensities</span><span><span leaf="">,</span></span><span leaf="">x</span><span><span leaf="">$</span></span><span leaf="">yp</span><span><span leaf="">)</span></span><span><span leaf="">)</span></span><span><span leaf="">,</span></span><br><span leaf="">         main</span><span><span leaf="">=</span></span><span leaf="">x</span><span><span leaf="">$</span></span><span leaf="">mass</span><span><span leaf="">)</span></span><span leaf="">; lines</span><span><span leaf="">(</span></span><span leaf="">x</span><span><span leaf="">$</span></span><span leaf="">xx</span><span><span leaf="">,</span></span><span leaf=""> x</span><span><span leaf="">$</span></span><span leaf="">yp</span><span><span leaf="">,</span></span><br><span leaf="">                             col</span><span><span leaf="">=</span></span><span><span leaf="">'red'</span></span><span><span leaf="">)</span></span><span leaf="">; x</span><span><span leaf="">}</span></span><span><span leaf="">)</span></span><span><span leaf="">|&gt;</span></span><br><span leaf="">  sapply</span><span><span leaf="">(</span></span><span><span leaf="">function</span></span><span><span leaf="">(</span></span><span leaf="">x</span><span><span leaf="">)</span></span><span><span leaf="">{</span></span><span leaf="">x</span><span><span leaf="">$</span></span><span leaf="">xx</span><span><span leaf="">[</span></span><span leaf="">which.max</span><span><span leaf="">(</span></span><span leaf="">x</span><span><span leaf="">$</span></span><span leaf="">yp</span><span><span leaf="">)</span></span><span><span leaf="">[</span></span><span><span leaf="">1</span></span><span><span leaf="">]</span></span><span><span leaf="">]</span></span><span><span leaf="">}</span></span><span><span leaf="">)</span></span><br><br><span leaf="">rt </span><span><span leaf="">=</span></span><span leaf="">sapply</span><span><span leaf="">(</span></span><span leaf="">C</span><span><span leaf="">,</span></span><span><span leaf="">function</span></span><span><span leaf="">(</span></span><span leaf="">x</span><span><span leaf="">)</span></span><span leaf=""> x</span><span><span leaf="">$</span></span><span leaf="">times</span><span><span leaf="">[</span></span><span leaf="">which.max</span><span><span leaf="">(</span></span><span leaf="">x</span><span><span leaf="">$</span></span><span leaf="">intensities</span><span><span leaf="">)</span></span><span><span leaf="">[</span></span><span><span leaf="">1</span></span><span><span leaf="">]</span></span><span><span leaf="">]</span></span><span><span leaf="">)</span></span><br></code></pre><figure><span leaf=""><img alt="image-20250502180143663" data-imgfileid="100001283" data-type="png" title="null" data-ratio="0.6175925925925926" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xs3icRZgSSsoDOjQRNmaxdflUMEJaibT3wp1icWGt0iaH3fBhKxfSn88rRhQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/yDgqbg2dgMVcEmQgaXBHBCngS5gyp5xs3icRZgSSsoDOjQRNmaxdflUMEJaibT3wp1icWGt0iaH3fBhKxfSn88rRhQ/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">image-20250502180143663</span></figcaption></figure></section><p><span leaf=""> </span></p><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/VjmPtKBQoTXNsIo5b2XxHg",target="_blank" rel="noopener noreferrer">原文链接</a>
