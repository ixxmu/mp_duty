---
title: "Loupe Browser + loupeR——80万细胞流畅可视化！"
date: 2025-05-08T04:53:21Z
draft: ["false"]
tags: [
  "fetched",
  "Eula的生信小金鱼"
]
categories: ["Acdemic"]
---
Loupe Browser + loupeR——80万细胞流畅可视化！ by Eula的生信小金鱼
------
<div><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor" data-pm-slice="0 0 []"><h1 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf=""><br></span></span></h1><section nodeleaf=""><mp-common-clmusic data-pluginname="insertaudio" type="1" music_name="炽烈的还魂诗·再现 Ode of Resurrection: Recapitulation" albumurl="http://wx.y.gtimg.cn/music/photo_new/T002R500x500M000000cLiAe23Bq5s_1.jpg" singer="HOYO-MiX" count="0" is_vip="0" duration="231000" music_source="1" listenid="78348917212620507"></mp-common-clmusic></section><blockquote><span><span leaf="">“</span></span><p><span leaf="">众里寻他千百度，蓦然回首，那人却在灯火阑珊处。</span></p><span></span></blockquote><h2 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">前言</span></span></h2><p data-tool="markdown.com.cn编辑器"><span leaf="">一开始拿到动辄几万甚至几十万单细胞的数据时，我们免不了需要做一些</span><strong><span leaf="">探索式的分析</span></strong><span leaf="">。比如查看某些cluster或marker基因的分布，对分群结果做细胞类型鉴定，或者快速选取某些分组或亚群的细胞。</span></p><p data-tool="markdown.com.cn编辑器"><span leaf="">这些分析是单细胞数据挖掘的基石，同时又包含大量细碎、重复的可视化操作。尽管目前社区中有铺天盖地的R或python教程，可以帮助我们利用代码轻松画出各种探索用的图形，但我们常常很难预见到，需要重复多少次这样的画图操作，才能抵达探索的终点。在这种情境下，</span><strong><span leaf="">交互式可视化</span></strong><span leaf="">或许是比写脚本更高效的选择。</span></p><p data-tool="markdown.com.cn编辑器"><span leaf="">中文社区中常见的交互式可视化工具，包括</span><code><span leaf="">Rstudio</span></code><span leaf="">、</span><code><span leaf="">jupyter notebook</span></code><span leaf="">和</span><code><span leaf="">R shiny app</span></code><span leaf="">等。前两者本质上还是写代码，只不过你可以随时修改脚本中的参数或代码细节，借助交互工具反复运行同一段画图代码，来查看你关注的不同内容。而</span><code><span leaf="">R shiny app</span></code><span leaf="">则是依托于前端架构搭建的图形界面，可以仅通过</span><strong><span leaf="">鼠标点击</span></strong><span leaf="">和有限的参数选取，实现交互式出图。然而，</span><code><span leaf="">shiny</span></code><span leaf="">也存在一些明显短板：</span></p><ul><li><section><span leaf="">底层逻辑仍是通过R语言生态搭建，遇到大量数据时性能堪忧。例如当需要画十几万个散点的图形时，可能直接就卡死</span></section></li><li><section><code><span leaf="">服务端</span></code><span leaf="">和</span><code><span leaf="">客户端</span></code><span leaf="">常位于不同的主机，使用体验会受网络等因素影响</span></section></li><li><section><span leaf="">后台数据常位于远程服务器，用户在使用app时很难对数据做其他操作，也会面临科研数据安全的问题</span></section></li></ul><p data-tool="markdown.com.cn编辑器"><span leaf="">事实上，除了</span><code><span leaf="">shiny</span></code><span leaf="">框架之外的其他云平台工具也或多或少存在类似的短板。那么，有没有一种工具，可以支持用户在</span><strong><span leaf="">本地电脑</span></strong><span leaf="">上流畅地探索大样本单细胞数据呢？有的兄弟，有的！10x Genomics的桌面软件</span><code><span leaf="">Loupe Browser</span></code><span leaf="">就可以做到。</span></p><h2 data-tool="markdown.com.cn编辑器"><span></span><span><code><span leaf="">Loupe Browser</span></code></span></h2><p data-tool="markdown.com.cn编辑器"><span leaf="">熟悉单细胞测序的人，不太可能不知道</span><code><span leaf="">Loupe Browser</span></code><span leaf="">。每一个10x Genomics平台建库测序的样本，在跑完</span><code><span leaf="">cellranger</span></code><span leaf="">之后都必定会生成一个</span><code><span leaf="">.cloupe</span></code><span leaf="">文件，可用</span><code><span leaf="">Loupe Browser</span></code><span leaf="">在本地电脑直接双击打开：</span></p><figure data-tool="markdown.com.cn编辑器"><span leaf=""><img data-imgfileid="100000316" data-ratio="0.6592592592592592" data-src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmSiafhcmLYFxAsGcHJD2lnOUz6XsWSOFRDaIK0YcDEYNvFOhmiczH0C7Hw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmSiafhcmLYFxAsGcHJD2lnOUz6XsWSOFRDaIK0YcDEYNvFOhmiczH0C7Hw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="markdown.com.cn编辑器"><span leaf="">如此，我们就可以交互式查看该样本的分群和一些基因表达分布的信息，甚至可以通过自定义亚群的操作来完成细胞类型鉴定。但</span><code><span leaf="">cellranger</span></code><span leaf="">通常仅生成单个样本的结果，而实际项目中，我们需要把很多个样本的表达矩阵合并，用</span><code><span leaf="">Seurat</span></code><span leaf="">或</span><code><span leaf="">scanpy</span></code><span leaf="">完成降维分群，再做探索性分析。那么，有没有可能把这些</span><span leaf="">分析结果导入</span><code><span leaf="">Loupe Browser</span></code><span leaf="">做可视化呢？</span></p><p data-tool="markdown.com.cn编辑器"><span leaf="">在R语言环境，10x公司提供了名为</span><code><span leaf="">loupeR</span></code><span leaf="">的开源工具，可以把R中的表达矩阵和分群等信息转成</span><code><span leaf="">.cloupe</span></code><span leaf="">文件。详情可以移步 https://github.com/10XGenomics/loupeR</span></p><h2 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">安装</span><code><span leaf="">loupeR</span></code><span leaf="">和</span><code><span leaf="">Loupe Browser</span></code></span></h2><p data-tool="markdown.com.cn编辑器"><span leaf="">本次演示使用</span><code><span leaf="">windows11</span></code><span leaf="">系统台式机（CPU Intel i9-9820X 3.30GHz、128Gb内存、三星980Pro固态硬盘）。直接从github安装</span><code><span leaf="">loupeR</span></code><span leaf="">：</span></p><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">remotes::install_github(</span><span><span leaf="">"10XGenomics/loupeR"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">loupeR::setup()</span><span leaf=""><br></span></code></pre><p data-tool="markdown.com.cn编辑器"><span leaf="">一定要运行</span><code><span leaf="">loupeR::setup()</span></code><span leaf="">！它会自动检查并下载10x预编译好的转换程序。</span></p><p data-tool="markdown.com.cn编辑器"><code><span leaf="">Loupe Browser</span></code><span leaf="">的安装包可以从官网 https://www.10xgenomics.com/support/software/loupe-browser/downloads 下载安装。</span></p><h2 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">演示数据</span></span></h2><p data-tool="markdown.com.cn编辑器"><span leaf="">本次演示的数据来自2022年发表在</span><em><span leaf="">Cell</span></em><span leaf="">的新冠外周血单细胞图谱文章[1]</span><span leaf="">，一共</span><strong><span leaf="">80万细胞</span></strong><span leaf="">。让我们给</span><code><span leaf="">Loupe Browser</span></code><span leaf="">上点强度！</span></p><pre data-tool="markdown.com.cn编辑器"><code><span><span leaf="">library</span></span><span leaf="">(Seurat)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(dplyr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(loupeR)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(hdf5r.Extra)</span><span leaf=""><br></span></code></pre><h2 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">读取</span><code><span leaf="">.h5ad</span></code><span leaf="">文件</span></span></h2><p data-tool="markdown.com.cn编辑器"><span leaf="">需要用到我开发的</span><code><span leaf="">hdf5r.Extra</span></code><span leaf="">，把</span><code><span leaf="">.h5ad</span></code><span leaf="">整个作为一个</span><code><span leaf="">list</span></code><span leaf="">读到R里面。这一步非常耗内存！</span></p><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">adata &lt;- h5Read(</span><span><span leaf="">"ahern_pbmc.h5ad"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="markdown.com.cn编辑器"><span leaf="">在</span><code><span leaf="">AnnData</span></code><span leaf="">结构中，</span><code><span leaf="">obs</span></code><span leaf="">是一个保存了所有细胞信息的表格，等同于</span><code><span leaf="">Seurat</span></code><span leaf="">对象的</span><code><span leaf="">meta.data</span></code><span leaf="">。</span><code><span leaf="">loupeR</span></code><span leaf="">允许我们把任意</span><code><span leaf="">factor</span></code><span leaf="">类型的数据，作为细胞分组、分样本或亚群的信息。</span></p><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">is.fct &lt;- sapply(</span><span><span leaf="">1</span></span><span leaf="">:ncol(adata$obs), </span><span><span leaf="">function</span></span><span leaf="">(i) is.factor(adata$obs[[i]]))</span><span leaf=""><br></span><span leaf="">obs &lt;- adata$obs[, is.fct]</span><span leaf=""><br></span><span leaf="">head(obs)</span><span leaf=""><br></span></code></pre><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">                                   Source                GEX_region</span><span leaf=""><br></span><span leaf="">AAACCTGAGAAAGTGG-1-gPlexA1      COVID_SEV B: TEM/prolif. T/NK cells</span><span leaf=""><br></span><span leaf="">AAACCTGAGCGGATCA-1-gPlexA1     COVID_MILD B: TEM/prolif. T/NK cells</span><span leaf=""><br></span><span leaf="">AAACCTGAGGACATTA-1-gPlexA1 COVID_HCW_MILD         D: B/Plasma cells</span><span leaf=""><br></span><span leaf="">AAACCTGAGGCGACAT-1-gPlexA1     COVID_CRIT          C: Monocytes/cDC</span><span leaf=""><br></span><span leaf="">AAACCTGAGGGAACGG-1-gPlexA1      COVID_SEV          C: Monocytes/cDC</span><span leaf=""><br></span><span leaf="">AAACCTGAGTTAACGA-1-gPlexA1      COVID_LDN A: CD4/naive/reg. T cells</span><span leaf=""><br></span><span leaf="">                                      cluster               cluster_source</span><span leaf=""><br></span><span leaf="">AAACCTGAGAAAGTGG-1-gPlexA1        NK.CD16hi.1        NK.CD16hi.1_COVID_SEV</span><span leaf=""><br></span><span leaf="">AAACCTGAGCGGATCA-1-gPlexA1        CD8.TEMRA.1       CD8.TEMRA.1_COVID_MILD</span><span leaf=""><br></span><span leaf="">AAACCTGAGGACATTA-1-gPlexA1                nan           nan_COVID_HCW_MILD</span><span leaf=""><br></span><span leaf="">AAACCTGAGGCGACAT-1-gPlexA1             ncMono            ncMono_COVID_CRIT</span><span leaf=""><br></span><span leaf="">AAACCTGAGGGAACGG-1-gPlexA1 cMono.LGALS2.AHNAK cMono.LGALS2.AHNAK_COVID_SEV</span><span leaf=""><br></span><span leaf="">AAACCTGAGTTAACGA-1-gPlexA1                nan                nan_COVID_LDN</span><span leaf=""><br></span><span leaf="">                           minor_subset  minor_subset_source major_subset</span><span leaf=""><br></span><span leaf="">AAACCTGAGAAAGTGG-1-gPlexA1    NK.CD16hi  NK.CD16hi_COVID_SEV           NK</span><span leaf=""><br></span><span leaf="">AAACCTGAGCGGATCA-1-gPlexA1    CD8.TEMRA CD8.TEMRA_COVID_MILD          CD8</span><span leaf=""><br></span><span leaf="">AAACCTGAGGACATTA-1-gPlexA1          nan   nan_COVID_HCW_MILD          nan</span><span leaf=""><br></span><span leaf="">AAACCTGAGGCGACAT-1-gPlexA1       ncMono    ncMono_COVID_CRIT       ncMono</span><span leaf=""><br></span><span leaf="">AAACCTGAGGGAACGG-1-gPlexA1        cMono      cMono_COVID_SEV        cMono</span><span leaf=""><br></span><span leaf="">AAACCTGAGTTAACGA-1-gPlexA1          nan        nan_COVID_LDN          nan</span><span leaf=""><br></span><span leaf="">                           major_subset_source   cell_type_source donor_id</span><span leaf=""><br></span><span leaf="">AAACCTGAGAAAGTGG-1-gPlexA1        NK_COVID_SEV       NK_COVID_SEV   S00109</span><span leaf=""><br></span><span leaf="">AAACCTGAGCGGATCA-1-gPlexA1      CD8_COVID_MILD       T_COVID_MILD   S00112</span><span leaf=""><br></span><span leaf="">AAACCTGAGGACATTA-1-gPlexA1  nan_COVID_HCW_MILD nan_COVID_HCW_MILD   G05153</span><span leaf=""><br></span><span leaf="">AAACCTGAGGCGACAT-1-gPlexA1   ncMono_COVID_CRIT     MNP_COVID_CRIT   S00005</span><span leaf=""><br></span><span leaf="">AAACCTGAGGGAACGG-1-gPlexA1     cMono_COVID_SEV      MNP_COVID_SEV   S00061</span><span leaf=""><br></span><span leaf="">AAACCTGAGTTAACGA-1-gPlexA1       nan_COVID_LDN      nan_COVID_LDN   U00515</span><span leaf=""><br></span></code></pre><p data-tool="markdown.com.cn编辑器"><span leaf="">可以看到作者对于每个细胞的信息定义十分丰富，涵盖了不同层次的细胞类型、样本、建库方式和个体ID等。</span></p><p data-tool="markdown.com.cn编辑器"><span leaf="">再观察细胞</span><code><span leaf="">barcode</span></code><span leaf="">的部分，是用barcode序列加上</span><strong><span leaf="">样本</span></strong><span leaf="">后缀。但是，</span><code><span leaf="">loupeR</span></code><span leaf="">要求细胞</span><code><span leaf="">barcode</span></code><span leaf="">的前、后缀必须用</span><code><span leaf="">_</span></code><span leaf="">下划线连接，不可以用</span><code><span leaf="">-</span></code><span leaf="">短横线！因此这里需要对行名做一些处理：</span></p><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">rownames(obs) &lt;- gsub(</span><span><span leaf="">"\\-[0-9]+\\-"</span></span><span leaf="">, </span><span><span leaf="">"_"</span></span><span leaf="">, rownames(obs))</span><span leaf=""><br></span><span leaf="">head(obs)</span><span leaf=""><br></span></code></pre><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">                                 Source                GEX_region</span><span leaf=""><br></span><span leaf="">AAACCTGAGAAAGTGG_gPlexA1      COVID_SEV B: TEM/prolif. T/NK cells</span><span leaf=""><br></span><span leaf="">AAACCTGAGCGGATCA_gPlexA1     COVID_MILD B: TEM/prolif. T/NK cells</span><span leaf=""><br></span><span leaf="">AAACCTGAGGACATTA_gPlexA1 COVID_HCW_MILD         D: B/Plasma cells</span><span leaf=""><br></span><span leaf="">AAACCTGAGGCGACAT_gPlexA1     COVID_CRIT          C: Monocytes/cDC</span><span leaf=""><br></span><span leaf="">AAACCTGAGGGAACGG_gPlexA1      COVID_SEV          C: Monocytes/cDC</span><span leaf=""><br></span><span leaf="">AAACCTGAGTTAACGA_gPlexA1      COVID_LDN A: CD4/naive/reg. T cells</span><span leaf=""><br></span><span leaf="">                                    cluster               cluster_source</span><span leaf=""><br></span><span leaf="">AAACCTGAGAAAGTGG_gPlexA1        NK.CD16hi.1        NK.CD16hi.1_COVID_SEV</span><span leaf=""><br></span><span leaf="">AAACCTGAGCGGATCA_gPlexA1        CD8.TEMRA.1       CD8.TEMRA.1_COVID_MILD</span><span leaf=""><br></span><span leaf="">AAACCTGAGGACATTA_gPlexA1                nan           nan_COVID_HCW_MILD</span><span leaf=""><br></span><span leaf="">AAACCTGAGGCGACAT_gPlexA1             ncMono            ncMono_COVID_CRIT</span><span leaf=""><br></span><span leaf="">AAACCTGAGGGAACGG_gPlexA1 cMono.LGALS2.AHNAK cMono.LGALS2.AHNAK_COVID_SEV</span><span leaf=""><br></span><span leaf="">AAACCTGAGTTAACGA_gPlexA1                nan                nan_COVID_LDN</span><span leaf=""><br></span><span leaf="">                         minor_subset  minor_subset_source major_subset</span><span leaf=""><br></span><span leaf="">AAACCTGAGAAAGTGG_gPlexA1    NK.CD16hi  NK.CD16hi_COVID_SEV           NK</span><span leaf=""><br></span><span leaf="">AAACCTGAGCGGATCA_gPlexA1    CD8.TEMRA CD8.TEMRA_COVID_MILD          CD8</span><span leaf=""><br></span><span leaf="">AAACCTGAGGACATTA_gPlexA1          nan   nan_COVID_HCW_MILD          nan</span><span leaf=""><br></span><span leaf="">AAACCTGAGGCGACAT_gPlexA1       ncMono    ncMono_COVID_CRIT       ncMono</span><span leaf=""><br></span><span leaf="">AAACCTGAGGGAACGG_gPlexA1        cMono      cMono_COVID_SEV        cMono</span><span leaf=""><br></span><span leaf="">AAACCTGAGTTAACGA_gPlexA1          nan        nan_COVID_LDN          nan</span><span leaf=""><br></span><span leaf="">                         major_subset_source   cell_type_source donor_id</span><span leaf=""><br></span><span leaf="">AAACCTGAGAAAGTGG_gPlexA1        NK_COVID_SEV       NK_COVID_SEV   S00109</span><span leaf=""><br></span><span leaf="">AAACCTGAGCGGATCA_gPlexA1      CD8_COVID_MILD       T_COVID_MILD   S00112</span><span leaf=""><br></span><span leaf="">AAACCTGAGGACATTA_gPlexA1  nan_COVID_HCW_MILD nan_COVID_HCW_MILD   G05153</span><span leaf=""><br></span><span leaf="">AAACCTGAGGCGACAT_gPlexA1   ncMono_COVID_CRIT     MNP_COVID_CRIT   S00005</span><span leaf=""><br></span><span leaf="">AAACCTGAGGGAACGG_gPlexA1     cMono_COVID_SEV      MNP_COVID_SEV   S00061</span><span leaf=""><br></span><span leaf="">AAACCTGAGTTAACGA_gPlexA1       nan_COVID_LDN      nan_COVID_LDN   U00515</span><span leaf=""><br></span></code></pre><p data-tool="markdown.com.cn编辑器"><span leaf="">这样，细胞水平的信息就处理完了。我们可以把细胞名称和基因symbol加到表达矩阵：</span></p><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">counts &lt;- adata$raw$X</span><span leaf=""><br></span><span leaf="">rownames(counts) &lt;- adata$raw$var$feature_name</span><span leaf=""><br></span><span leaf="">colnames(counts) &lt;- rownames(obs)</span><span leaf=""><br></span><span leaf="">counts[</span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">5</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">5</span></span><span leaf="">]</span><span leaf=""><br></span></code></pre><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">5 x 5 sparse Matrix of class "dgCMatrix"</span><span leaf=""><br></span><span leaf="">             AAACCTGAGAAAGTGG_gPlexA1 AAACCTGAGCGGATCA_gPlexA1</span><span leaf=""><br></span><span leaf="">MIR1302-2HG                         .                        .</span><span leaf=""><br></span><span leaf="">FAM138A                             .                        .</span><span leaf=""><br></span><span leaf="">OR4F5                               .                        .</span><span leaf=""><br></span><span leaf="">RP11-34P13.7                        .                        .</span><span leaf=""><br></span><span leaf="">RP11-34P13.8                        .                        .</span><span leaf=""><br></span><span leaf="">             AAACCTGAGGACATTA_gPlexA1 AAACCTGAGGCGACAT_gPlexA1</span><span leaf=""><br></span><span leaf="">MIR1302-2HG                         .                        .</span><span leaf=""><br></span><span leaf="">FAM138A                             .                        .</span><span leaf=""><br></span><span leaf="">OR4F5                               .                        .</span><span leaf=""><br></span><span leaf="">RP11-34P13.7                        .                        .</span><span leaf=""><br></span><span leaf="">RP11-34P13.8                        .                        .</span><span leaf=""><br></span><span leaf="">             AAACCTGAGGGAACGG_gPlexA1</span><span leaf=""><br></span><span leaf="">MIR1302-2HG                         .</span><span leaf=""><br></span><span leaf="">FAM138A                             .</span><span leaf=""><br></span><span leaf="">OR4F5                               .</span><span leaf=""><br></span><span leaf="">RP11-34P13.7                        .</span><span leaf=""><br></span><span leaf="">RP11-34P13.8                        .</span><span leaf=""><br></span></code></pre><h2 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">输出</span><code><span leaf="">.cloupe</span></code><span leaf="">文件</span></span></h2><p data-tool="markdown.com.cn编辑器"><span leaf="">基本素材准备完成，可以用</span><code><span leaf="">create_loupe()</span></code><span leaf="">来创建</span><code><span leaf="">.cloupe</span></code><span leaf="">文件了。重要参数包括：</span></p><ul><li><section><span leaf="">UMI count矩阵</span></section></li><li><section><code><span leaf="">clusters</span></code><span leaf="">：细胞的亚群信息。可以有多个，必须以</span><code><span leaf="">list</span></code><span leaf="">方式传递。这里我把</span><code><span leaf="">obs</span></code><span leaf="">中所有可用的信息都传进去！</span></section></li><li><section><code><span leaf="">projections</span></code><span leaf="">：降维结果（PCA、UMAP等）。也必须以</span><code><span leaf="">list</span></code><span leaf="">方式传递。在</span><code><span leaf="">AnnData</span></code><span leaf="">中对应的是</span><code><span leaf="">obsm</span></code><span leaf="">，这里依旧是使用所有结果。</span></section></li><li><section><code><span leaf="">feature_ids</span></code><span leaf="">：代表基因ID的字符串。这里由于矩阵的行名使用了symbol，我从</span><code><span leaf="">var</span></code><span leaf="">中提取了对应的基因ID。</span></section></li><li><section><code><span leaf="">output_dir</span></code><span leaf="">：输出目录，用</span><code><span leaf="">getwd()</span></code><span leaf="">表示当前工作目录。</span></section></li><li><section><code><span leaf="">output_name</span></code><span leaf="">：输出文件名（不带扩展名）</span></section></li><li><section><code><span leaf="">force</span></code><span leaf="">：是否覆盖已存在的文件</span></section></li></ul><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">create_loupe(</span><span leaf=""><br></span><span leaf="">  counts, </span><span leaf=""><br></span><span leaf="">  clusters = as.list(obs),</span><span leaf=""><br></span><span leaf="">  projections = lapply(adata$obsm, t),</span><span leaf=""><br></span><span leaf="">  feature_ids = rownames(adata$raw$var),</span><span leaf=""><br></span><span leaf="">  output_dir = getwd(),</span><span leaf=""><br></span><span leaf="">  output_name = </span><span><span leaf="">"adata"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  force = </span><span><span leaf="">TRUE</span></span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span></code></pre><pre data-tool="markdown.com.cn编辑器"><code><span leaf="">2025/05/07 17:19:27 validating count matrix</span><span leaf=""><br></span><span leaf="">2025/05/07 17:19:56 validating clusters</span><span leaf=""><br></span><span leaf="">2025/05/07 17:19:56 validating projections</span><span leaf=""><br></span><span leaf="">2025/05/07 17:19:56 creating temporary hdf5 file: C:\Users\ADMINI~1\AppData\Local\Temp\Rtmpcl2ryC\file2b3c10501e21.h5</span><span leaf=""><br></span><span leaf="">2025/05/07 17:23:12 invoking louper executable</span><span leaf=""><br></span><span leaf="">2025/05/07 17:23:12 running command: "C:\Users\Administrator\AppData\Roaming\R\data\R\loupeR\louper.exe create --input="C:\Users\Administrator\AppData\Local\Temp\Rtmpcl2ryC\file2b3c10501e21.h5" --output="D:\R语言\loupeR\adata.cloupe" --force"</span><span leaf=""><br></span></code></pre><p data-tool="markdown.com.cn编辑器"><span leaf="">根据输出日志，最终程序生成了</span><code><span leaf="">D:\R语言\loupeR\adata.cloupe</span></code><span leaf="">文件，就是我们想要的结果啦！</span></p><h2 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">交互可视化</span></span></h2><p data-tool="markdown.com.cn编辑器"><span leaf="">如果你已经安装好</span><code><span leaf="">Loupe Browser</span></code><span leaf="">，直接双击生成的</span><code><span leaf="">adata.cloupe</span></code><span leaf="">文件即可打开：</span></p><figure data-tool="markdown.com.cn编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmS6LLJnuGwpib8Oqg0J3DWhMX2RRhqmmQHXibusGGJSJnDsT1LGckicPxbw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6527777777777778" data-type="png" data-w="1080" data-imgfileid="100000317" src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmS6LLJnuGwpib8Oqg0J3DWhMX2RRhqmmQHXibusGGJSJnDsT1LGckicPxbw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="markdown.com.cn编辑器"><span leaf="">在左侧的</span><code><span leaf="">LoupeR Analysis groups</span></code><span leaf="">，可以随意点击切换不同的分组变量，主窗口的细胞颜色会随之改变，就可以查看不同样本、分组、细胞类型或组织来源的细胞分布：</span></p><figure data-tool="markdown.com.cn编辑器"><span leaf=""><img data-imgfileid="100000319" data-ratio="0.6555555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmSJQtvE5ibcW0EVdsw14h3zKxafzsamHIqXFJeXr8ECXfrBicJcm7ibR5rA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmSJQtvE5ibcW0EVdsw14h3zKxafzsamHIqXFJeXr8ECXfrBicJcm7ibR5rA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="markdown.com.cn编辑器"><span leaf="">用鼠标滚轮可以对主图放大或缩小，利用右上角的</span><code><span leaf="">手形工具</span></code><span leaf="">可以随意拖动主图观察细节。80万个点，拖动和放缩竟然意外地流畅！</span></p><figure data-tool="markdown.com.cn编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmS7fbrqjQuhCOJ4mnekHNxBAARTVlnceM5j50orpwFflejfqke8QD1UA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6537037037037037" data-type="png" data-w="1080" data-imgfileid="100000320" src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmS7fbrqjQuhCOJ4mnekHNxBAARTVlnceM5j50orpwFflejfqke8QD1UA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="markdown.com.cn编辑器"><span leaf="">利用右上角的</span><code><span leaf="">套索工具</span></code><span leaf="">可以随意圈选细胞，选出来的部分也可以生成自定义的亚群分组：</span></p><figure data-tool="markdown.com.cn编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmStTHbqOialIV2lqRrJcAt4HmRrcrKJSUY4pZulLsxK6DicTTTI2TqsWyw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6555555555555556" data-type="png" data-w="1080" data-imgfileid="100000318" src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmStTHbqOialIV2lqRrJcAt4HmRrcrKJSUY4pZulLsxK6DicTTTI2TqsWyw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="markdown.com.cn编辑器"><span leaf="">除了查看各种分类变量的分布情况，</span><code><span leaf="">Loupe Browser</span></code><span leaf="">也可以查看各个基因的表达分布：</span></p><figure data-tool="markdown.com.cn编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmSsicISZ6ZUhqGajEHjHKFZZqQ2ymKy61GESL0ko82AO9DKBXTxBYVFEw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6407407407407407" data-type="png" data-w="1080" data-imgfileid="100000321" src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmSsicISZ6ZUhqGajEHjHKFZZqQ2ymKy61GESL0ko82AO9DKBXTxBYVFEw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="markdown.com.cn编辑器"><span leaf="">除了用UMAP图，也可以画简易的小提琴图查看基因在各个亚群或分组的分布：</span></p><figure data-tool="markdown.com.cn编辑器"><span leaf=""><img data-imgfileid="100000322" data-ratio="0.6509259259259259" data-src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmSqSSiaUPO8b7nD4XywUEcPicKHxxw8lRr0MBZQZfU3Te76QNOvODCGg9g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/weQiaZ04F2NvbKuibJXhGuIb54IgDHqZmSqSSiaUPO8b7nD4XywUEcPicKHxxw8lRr0MBZQZfU3Te76QNOvODCGg9g/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="markdown.com.cn编辑器"><span leaf="">更多</span><code><span leaf="">Loupe Browser</span></code><span leaf="">的操作细节，可以去软件官网查看帮助文档。本文涉及到的操作基本都很流畅，而且</span><code><span leaf="">任务管理器</span></code><span leaf="">显示的内存占用也只有1-2GB，可以说对个人电脑非常友好了。</span></p><h2 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">小结</span></span></h2><p data-tool="markdown.com.cn编辑器"><span leaf="">本文的演示中，主要性能瓶颈还是</span><code><span leaf="">loupeR</span></code><span leaf="">的步骤，因为它需要把整个80万细胞的矩阵读到内存中，我粗略测了一下会用掉</span><strong><span leaf="">60G左右</span></strong><span leaf="">。这归根到底是R语言的特性，而不是</span><code><span leaf="">Loupe Browser</span></code><span leaf="">的短板。希望未来有空的时候，我有可能想办法优化一下这个瓶颈？（不要再挖坑啦喂！）</span></p><h2 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">参考文献</span></span></h2><span leaf="">- [1] COvid-19 Multi-omics Blood ATlas (COMBAT) Consortium. Electronic address: julian.knight@well.ox.ac.uk; COvid-19 Multi-omics Blood ATlas (COMBAT) Consortium. A blood atlas of COVID-19 defines hallmarks of disease severity and specificity. Cell. 2022;185(5):916-938.e58. doi:10.1016/j.cell.2022.01.012</span></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/73w8VlsOM5-0IHfg8ytveA",target="_blank" rel="noopener noreferrer">原文链接</a>
