---
title: "利用 HADDOCK3 进行抗原抗体对接"
date: 2025-05-12T15:07:48Z
draft: ["false"]
tags: [
  "fetched",
  "ByteLink"
]
categories: ["Acdemic"]
---
利用 HADDOCK3 进行抗原抗体对接 by ByteLink
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf="">HADDOCK3 可以用来做抗原-抗体的对接，参考文献为：Towards the accurate modelling of antibody−antigen complexes from sequence using machine learning and information-driven docking</span></p><p data-tool="mdnice编辑器"><span leaf="">HADDOCK 介绍： Basics of docking and introduction to HADDOCK（</span><span leaf="">https://www.youtube.com/watch?v=PiiEyRyO07g） 教程参考：www.bonvinlab.org/education/HADDOCK3/HADDOCK3-antibody-antigen/</span></p><p data-tool="mdnice编辑器"><span leaf="">Docking 一般分为两个步骤：抽样（sampling），产生大量复合物的模型；第二个则是打分（scoring）：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpmyhTbWn86212I3jN4BzIQPH7v3X7SIU6DpnYw8uM0h2BIGszlAiaGew/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5435185185185185" data-type="png" data-w="1080" data-imgfileid="100001056" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpmyhTbWn86212I3jN4BzIQPH7v3X7SIU6DpnYw8uM0h2BIGszlAiaGew/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">将数据整合进 docking 过程则有可能减少搜索空间：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OplUcDkS43VA2GjialDSbpb3O1ic63icAt9jAFApUAMquS6ckxibJCvecozw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5537037037037037" data-type="png" data-w="1080" data-imgfileid="100001057" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OplUcDkS43VA2GjialDSbpb3O1ic63icAt9jAFApUAMquS6ckxibJCvecozw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">本地安装并使用</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">github.com/haddocking/haddock3</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">conda create -n haddock3 python=3.10</span><span leaf=""><br></span><span leaf="">conda activate haddock3</span><span leaf=""><br></span><span leaf="">git </span><span><span leaf="">clone</span></span><span leaf=""> https://github.com/haddocking/haddock3.git</span><span leaf=""><br></span><span><span leaf="">cd</span></span><span leaf=""> haddock3</span><span leaf=""><br></span><span leaf="">pip install .</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">HADDOCK3 的特点就是可自由组合的模块：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpPVdEelbc862ib9CePrOxcJqiaQjrOmR4nkeEctCryNI1xicaIicGCH0Oaw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5944444444444444" data-type="png" data-w="1080" data-imgfileid="100001054" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpPVdEelbc862ib9CePrOxcJqiaQjrOmR4nkeEctCryNI1xicaIicGCH0Oaw/640?wx_fmt=png&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpLibHlicv3AXG10xeqS3yYKdyJwVUHczVMYyaHqWqzT99pmF0F3JMNuJw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5361111111111111" data-type="png" data-w="1080" data-imgfileid="100001055" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpLibHlicv3AXG10xeqS3yYKdyJwVUHczVMYyaHqWqzT99pmF0F3JMNuJw/640?wx_fmt=png&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpECvSLRrWH28wXxx7xLWNv4a85B9JXsQZia4meObvrmD2G9ic6czMIfDw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5324074074074074" data-type="png" data-w="1080" data-imgfileid="100001058" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpECvSLRrWH28wXxx7xLWNv4a85B9JXsQZia4meObvrmD2G9ic6czMIfDw/640?wx_fmt=png&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpKanSmjYicB6hOUIWO6GQzlDMOah8b8dx1eQnrY7tTkiadCDxsurXaLwA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.49537037037037035" data-type="png" data-w="1080" data-imgfileid="100001061" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpKanSmjYicB6hOUIWO6GQzlDMOah8b8dx1eQnrY7tTkiadCDxsurXaLwA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">在 Github 仓库中有示例文件：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpxfTiamZpiciasCzmOTt5a7INgcd00b8iaBdDjcHXwsJed2IXvzNCNFTQRw/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.2743823146944082" data-type="png" data-w="769" data-imgfileid="100001059" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpxfTiamZpiciasCzmOTt5a7INgcd00b8iaBdDjcHXwsJed2IXvzNCNFTQRw/640?wx_fmt=png&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpYcmAAKq4uFGv17JrdzGIOdD8OI5o4Dahp29ZJqAC140iavAH7mtK7WA/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.1109741060419236" data-type="png" data-w="811" data-imgfileid="100001060" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpYcmAAKq4uFGv17JrdzGIOdD8OI5o4Dahp29ZJqAC140iavAH7mtK7WA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">示例文件的抗原为 Interleukin-1β (IL-1β, </span><strong><span leaf="">4I1B</span></strong><span leaf="">)，抗体为 gevokizumab (</span><strong><span leaf="">4G6K</span></strong><span leaf="">)，复合物结构为 4G6M</span></p><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">准备输入文件</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">抗体结构文件的处理如下：</span></p><ul><li><section><span leaf="">使用 </span><code><span leaf="">pdb_fetch</span></code><span leaf=""> 下载 PDB 文件</span></section></li><li><section><code><span leaf="">pdb_tidy</span></code><span leaf=""> 清理 PDB 文件</span></section></li><li><section><code><span leaf="">pdb_selchain</span></code><span leaf=""> 选择需要的链</span></section></li><li><section><code><span leaf="">pdb_delhetatm</span></code><span leaf=""> 除去杂原子（any atom that is not carbon or hydrogen）</span></section></li><li><section><code><span leaf="">pdb_selaltloc</span></code><span leaf=""> 除去侧链重复（高分辨率结构中可能会出现侧链多重构象）</span></section></li><li><section><code><span leaf="">pdb_fixinsert</span></code><span leaf=""> 处理氨基酸残基编码插入（比如抗体的 Chothia numbering）</span></section></li><li><section><code><span leaf="">pdb_keepcoord</span></code><span leaf=""> 只保留有坐标的行</span></section></li><li><section><code><span leaf="">pdb_selres</span></code><span leaf=""> 选择抗体的 Fv 区域（减少计算量）</span></section></li></ul><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pdb_fetch 4G6K | pdb_tidy -strict | pdb_selchain -H | pdb_delhetatm | pdb_selaltloc | pdb_fixinsert | pdb_keepcoord | pdb_selres -1:120 | pdb_tidy -strict &gt; 4G6K_H.pdb </span><span leaf=""><br></span><span leaf="">pdb_fetch 4G6K | pdb_tidy -strict | pdb_selchain -L | pdb_delhetatm | pdb_selaltloc| pdb_fixinsert | pdb_keepcoord | pdb_selres -1:107 | pdb_tidy -strict &gt; 4G6K_L.pdb </span><span leaf=""><br></span></code></pre><p updated="20250512225914" data-pm-slice="0 0 []"><span leaf="">HADDOCK 输入需要一条链，因此，如果抗体有 H 和 L 链，需要将其合并成一条链。接下来将重链和轻链合并，并将残基和链ID重新编码：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pdb_merge 4G6K_H.pdb 4G6K_L.pdb | pdb_reres -1 | pdb_chain -A | pdb_chainxseg | pdb_tidy -strict &gt; 4G6K_clean.pdb </span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">处理抗原结构，将其链 ID 改为 B：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pdb_fetch 4I1B | pdb_tidy -strict | pdb_delhetatm | pdb_selaltloc | pdb_keepcoord | pdb_chain -B | pdb_chainxseg | pdb_tidy -strict &gt; 4I1B_clean.pdb </span><span leaf=""><br></span></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">定义对接约束</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">距离约束定义的格式为（具体可以参考文献 The HADDOCK2.4 web server for integrative modeling of biomolecular complexes）：</span></p><blockquote><span></span><p><span leaf="">assign (selection1) (selection2) distance, lower-bound correction, upper-bound correction</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">其中链 ID 用 </span><code><span leaf="">segid</span></code><span leaf=""> 表示，残基编号用 </span><code><span leaf="">resid</span></code><span leaf=""> 表示，原子名字用 </span><code><span leaf="">name</span></code><span leaf="">表示。比如下面表示 A 链的 602 号残基和 A 链的 603 号残基与 B 链的 85 号残基之间的距离小于 2 A：</span></p><blockquote><span></span><p><span leaf="">assign (</span><span leaf=""><br></span><span leaf="">(resid 602 and segid A)</span><span leaf=""><br></span><span leaf="">or</span><span leaf=""><br></span><span leaf="">(resid 603 and segid A)</span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">(resid 85 and segid B) 2.0 2.0 0.0</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">又比如下面表示链 A 和 B 中残基 10 和 200 的 Cβ 原子之间的距离范围为 10 A 到 20 A：</span></p><blockquote><span></span><p><span leaf="">assign (segid A and resid 10 and name CB) (segid B and resid 200 and name CB) 20.0 10.0 0.0</span></p></blockquote><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">识别抗体中的 paratope</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">此教程中用的是 ProABC-2 来预测抗体中的 paratope，预测得到的 paratope 残基为：</span></p><blockquote><span></span><p><span leaf="">31,32,33,34,35,52,54,55,56,100,101,102,103,104,105,106,151,152,169,170,173,211,212,213,214,216</span></p></blockquote><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93Op857p7a2U1E0tNVaV7ztgtSggaNK4vBtBWL30dZk4DytQgy0lia4Odyw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6731481481481482" data-type="png" data-w="1080" data-imgfileid="100001063" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93Op857p7a2U1E0tNVaV7ztgtSggaNK4vBtBWL30dZk4DytQgy0lia4Odyw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">识别抗原中的表位</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">表示是基于 NMR 来识别，表位残基为：</span></p><blockquote><span></span><p><span leaf="">72,73,74,75,81,83,84,89,90,92,94,96,97,98,115,116,117</span></p></blockquote><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OprOMILRnJKcK9TPQPQdaKa9sa2cfG7icdBS0R65BArnGa7uibR03ultOQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7424975798644724" data-type="png" data-w="1033" data-imgfileid="100001062" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OprOMILRnJKcK9TPQPQdaKa9sa2cfG7icdBS0R65BArnGa7uibR03ultOQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">在 HADDOCK 中还需要定义 </span><code><span leaf="">passive</span></code><span leaf=""> 残基，这些残基为表位周围的一些残基，在进行对接的时候这些残基会被添加为互作界面的一部分，但是如果这些残基在最终模型中不是结合位点的一部分的话，在计算能量得分的时候也不会进行罚分；相反 </span><code><span leaf="">active</span></code><span leaf=""> 残基（识别或预测的结合位点）在最终模型的结合位点没有出现就会进行罚分。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">haddock3-restraints passive_from_active 4I1B_clean.pdb 72,73,74,75,81,83,84,89,90,92,94,96,97,98,115,116,117</span><span leaf=""><br></span><span><span leaf="">###3 24 46 47 48 50 66 76 77 79 80 82 86 87 88 91 93 95 118 119 120</span></span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpQVBd7EvX2yATAzgwTsW3fOWRou8kNqG7ZWttQ3nnweCZBeJrZypxTA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7877697841726619" data-type="png" data-w="834" data-imgfileid="100001067" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpQVBd7EvX2yATAzgwTsW3fOWRou8kNqG7ZWttQ3nnweCZBeJrZypxTA/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">生成约束定义文件（tbl）</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">使用的命令为</span><code><span leaf="">haddock3-restraints active_passive_to_ambig</span></code><span leaf="">，输入为代表抗体、抗原的两个文件，每个文件有两行：第一行是 active 残基，第二行是 passive 残基，每个残基编号用空格隔开；注意抗体文件中只需要定义 activate 残基，因此第二行是空行：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">###抗体文件名为 antibody-paratope.txt</span></span><span leaf=""><br></span><span leaf="">31 32 33 34 35 52 54 55 56 100 101 102 103 104 105 106 151 152 169 170 173 211 212 213 214 216</span><span leaf=""><br></span><span><span leaf="">###抗原文件名为 antigen-epitope.txt</span></span><span leaf=""><br></span><span leaf="">72 73 74 75 81 83 84 89 90 92 94 96 97 98 115 116 117</span><span leaf=""><br></span><span leaf="">3 24 46 47 48 50 66 76 77 79 80 82 86 87 88 91 93 95 118 119 120</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">运行命令：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">haddock3-restraints active_passive_to_ambig antibody-paratope.txt antigen-epitope.txt --segid-one A --segid-two B &gt; ambig-paratope-epitope.tbl </span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">得到的文件部分内容如下：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">assign (resi 1 and segid A)  </span><span leaf=""><br></span><span leaf="">(  </span><span leaf=""><br></span><span leaf="">    (resi 72 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 73 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 74 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 75 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 81 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 83 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 84 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 89 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 90 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 92 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 94 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 96 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 97 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 98 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 115 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 116 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 117 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 3 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 24 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 46 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 47 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 48 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 50 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 66 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 76 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 77 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 79 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 80 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 82 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 86 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 87 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 88 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 91 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 93 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 95 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 118 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 119 and segid B)  </span><span leaf=""><br></span><span leaf="">     or  </span><span leaf=""><br></span><span leaf="">    (resi 120 and segid B)  </span><span leaf=""><br></span><span leaf="">) 2.0 2.0 0.0</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">....</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">可以进一步检查生成的文件是不是符合要求的：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">haddock3-restraints validate_tbl ambig-paratope-epitope.tbl --silent</span><span leaf=""><br></span><span><span leaf="">##如果没有输出则是符合要求</span></span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">由于抗体由两条链组成，因此需要定义一些距离限制使两条链保持在一起，否则在 refinement 步骤中可能会轻微分开：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">haddock3-restraints restrain_bodies 4G6K_clean.pdb &gt; antibody-unambig.tbl </span><span leaf=""><br></span></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">设置、运行 HADDOCK3</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">经典流程包括：刚体对接，半柔性细化，能量最小化，然后进行聚类。并且整合了两个分析模块：</span></p><ul><li><section><code><span leaf="">caprieval</span></code><span leaf=""> 将得到的模型和最好的打分模型或者参考结构（这里就是</span><code><span leaf="">4G6M</span></code><span leaf="">）进行比较，可以用来评估性能</span></section></li><li><section><code><span leaf="">contactmap</span></code><span leaf=""> 作为最后一个模块，生成分子内和分子间接触的接触矩阵以及每个簇的分子间接触弦图（chordchart）</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">整体的流程包括的步骤为：</span></p><ol><li><section><strong><code><span leaf="">topoaa</span></code></strong><span leaf="">: 产生全原子拓扑</span></section></li><li><section><strong><code><span leaf="">rigidbody</span></code></strong><span leaf="">: 进行刚体能量最小化</span></section></li><li><section><strong><code><span leaf="">caprieval</span></code></strong><span leaf="">: 通过和排名靠前的模型或者参考结构比较，计算 CAPRI 指标(i-RMSD, l-RMSD, Fnat, DockQ)</span></section></li><li><section><strong><code><span leaf="">seletop</span></code></strong><span leaf=""> : 选择 top X 模型</span></section></li><li><section><strong><code><span leaf="">flexref</span></code></strong><span leaf="">: 进行界面的半柔性细化（refinement）</span></section></li><li><section><strong><code><span leaf="">caprieval</span></code></strong></section></li><li><section><strong><code><span leaf="">emref</span></code></strong><span leaf="">: 通过能量最小化进行最终的细化</span></section></li><li><section><strong><code><span leaf="">caprieval</span></code></strong></section></li><li><section><strong><code><span leaf="">clustfcc</span></code></strong><span leaf="">: 基于 FCC（fraction of common contacts）对模型进行聚类</span></section></li><li><section><strong><code><span leaf="">seletopclusts</span></code></strong><span leaf="">: 选择所有聚类簇的 top 模型</span></section></li><li><section><strong><code><span leaf="">caprieval</span></code></strong></section></li><li><section><strong><code><span leaf="">contactmap</span></code></strong><span leaf="">: 产生接触矩阵以及弦图</span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">toml 配置文件为（可以在 </span><code><span leaf="">examples/docking-antibody-antigen/</span></code><span leaf=""> 中找到）：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf=""># ====================================================================</span><span leaf=""><br></span><span leaf=""># Antibody-antigen docking example with restraints from the antibody</span><span leaf=""><br></span><span leaf=""># paratope to the NMR-identified epitope on the antigen </span><span leaf=""><br></span><span leaf=""># ====================================================================</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""># Directory in which the scoring will be done</span><span leaf=""><br></span><span leaf="">run_dir = "run1"</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""># Compute mode</span><span leaf=""><br></span><span leaf="">mode = "local"</span><span leaf=""><br></span><span leaf="">ncores = 50</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""># Self contained rundir (to avoid problems with long filename paths)</span><span leaf=""><br></span><span leaf="">self_contained = true</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""># Post-processing to generate statistics and plots</span><span leaf=""><br></span><span leaf="">postprocess = true</span><span leaf=""><br></span><span leaf="">clean = true</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">molecules =  [</span><span leaf=""><br></span><span leaf="">    "4G6K_clean.pdb",</span><span leaf=""><br></span><span leaf="">    "4I1B_clean.pdb"</span><span leaf=""><br></span><span leaf="">    ]</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""># ====================================================================</span><span leaf=""><br></span><span leaf=""># Parameters for each stage are defined below, prefer full paths</span><span leaf=""><br></span><span leaf=""># ====================================================================</span><span leaf=""><br></span><span leaf="">[topoaa]</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[rigidbody]</span><span leaf=""><br></span><span leaf=""># CDR to NMR epitope ambig restraints</span><span leaf=""><br></span><span leaf="">ambig_fname = "ambig-paratope-epitope.tbl"</span><span leaf=""><br></span><span leaf=""># Restraints to keep the antibody chains together</span><span leaf=""><br></span><span leaf="">unambig_fname = "antibody-unambig.tbl"</span><span leaf=""><br></span><span leaf=""># Reduced sampling (100 instead of the default of 1000)</span><span leaf=""><br></span><span leaf="">sampling = 100</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[caprieval]</span><span leaf=""><br></span><span leaf="">reference_fname = "4G6M_matched.pdb"</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[seletop]</span><span leaf=""><br></span><span leaf=""># Selection of the top 40 best scoring complexes (instead of the default of 200)</span><span leaf=""><br></span><span leaf="">select = 40</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[flexref]</span><span leaf=""><br></span><span leaf="">tolerance = 5</span><span leaf=""><br></span><span leaf=""># CDR to NMR epitope ambig restraints</span><span leaf=""><br></span><span leaf="">ambig_fname = "ambig-paratope-epitope.tbl"</span><span leaf=""><br></span><span leaf=""># Restraints to keep the antibody chains together</span><span leaf=""><br></span><span leaf="">unambig_fname = "antibody-unambig.tbl"</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[caprieval]</span><span leaf=""><br></span><span leaf="">reference_fname = "4G6M_matched.pdb"</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[emref]</span><span leaf=""><br></span><span leaf="">tolerance = 5</span><span leaf=""><br></span><span leaf=""># CDR to NMR epitope ambig restraints</span><span leaf=""><br></span><span leaf="">ambig_fname = "ambig-paratope-epitope.tbl"</span><span leaf=""><br></span><span leaf=""># Restraints to keep the antibody chains together</span><span leaf=""><br></span><span leaf="">unambig_fname = "antibody-unambig.tbl"</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[caprieval]</span><span leaf=""><br></span><span leaf="">reference_fname = "4G6M_matched.pdb"</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[clustfcc]</span><span leaf=""><br></span><span leaf="">plot_matrix = true</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[seletopclusts]</span><span leaf=""><br></span><span leaf=""># Selection of the top 4 best scoring complexes from each cluster</span><span leaf=""><br></span><span leaf="">top_models = 4</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[caprieval]</span><span leaf=""><br></span><span leaf="">reference_fname = "4G6M_matched.pdb"</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">[contactmap]</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""># ====================================================================</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">由于这里我们已经知道了界面的信息，因此采用了低采样的策略，用的计算资源较少。rigidbody 模块的初始采样参数设置为100个模型，其中最好的40个模型通过 seletop 模块传递到 flexref 模块。后续的flexref模块和emref模块将使用seletop模块传递的所有模型。clustfcc 则将有着较为一致的界面接触比例的模型聚类到一起，seletopclusts模块保存每个簇的前4个模型。</span></p><p data-tool="mdnice编辑器"><span leaf="">注意事项：</span></p><ul><li><section><span leaf="">采样参数最好是可用核数的整数倍</span></section></li><li><section><span leaf="">可以使用命令 </span><code><span leaf="">haddock3-cfg -m &lt;module-name&gt;</span></code><span leaf=""> 来获取某个模块的可用参数，加上</span><code><span leaf="">-d</span></code><span leaf=""> 会输出参数的详细描述</span></section></li><li><section><span leaf="">默认的采样数量为 1000，其中最好的 200个模型被选择进入后续的refinement步骤</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">运行：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">haddock3 test.cfg &gt; haddock3.log &amp; </span><span><span leaf="">###后台运行</span></span><span leaf=""><br></span></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">分析对接结果</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">运行结束后，会生成一个 </span><code><span leaf="">run1</span></code><span leaf=""> 的文件夹，包括的内容有：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">$ ls run1/</span><span leaf=""><br></span><span leaf="">00_topoaa     02_caprieval  04_flexref    06_emref      08_clustfcc       10_caprieval   analysis  data  toppar</span><span leaf=""><br></span><span leaf="">01_rigidbody  03_seletop    05_caprieval  07_caprieval  09_seletopclusts  11_contactmap  cns       </span><span><span leaf="">log</span></span><span leaf="">   traceback</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">最简单的方式获取排序信息和对接分数是查看</span><code><span leaf="">caprieval</span></code><span leaf="">文件夹中的</span><code><span leaf="">capri_ss.tsv</span></code><span leaf="">，比如最后一个</span><code><span leaf="">10_caprieval</span></code><span leaf="">:</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93Opxo23IVtPcpLclyUWkicASClC6vrrqPQp4k7UzWDlxDufKliabNBeBmqA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.31851851851851853" data-type="png" data-w="1080" data-imgfileid="100001066" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93Opxo23IVtPcpLclyUWkicASClC6vrrqPQp4k7UzWDlxDufKliabNBeBmqA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">指标的含义：</span></p><ul><li><section><strong><span leaf="">score</span></strong><span leaf="">: </span><em><span leaf="">the HADDOCK score (arbitrary units)</span></em></section></li><li><section><strong><span leaf="">irmsd</span></strong><span leaf="">: </span><em><span leaf="">the interface RMSD, calculated over the interfaces the molecules</span></em></section></li><li><section><strong><span leaf="">fnat</span></strong><span leaf="">: </span><em><span leaf="">the fraction of native contacts</span></em></section></li><li><section><strong><span leaf="">lrmsd</span></strong><span leaf="">: </span><em><span leaf="">the ligand RMSD, calculated on the ligand after fitting on the receptor (1st component)</span></em></section></li><li><section><strong><span leaf="">ilrmsd</span></strong><span leaf="">: </span><em><span leaf="">the interface-ligand RMSD, calculated over the interface of the ligand after fitting on the interface of the  receptor (more relevant for small ligands for example)</span></em></section></li><li><section><strong><span leaf="">dockq</span></strong><span leaf="">: </span><em><span leaf="">the DockQ score, which is a  combination of irmsd, lrmsd and fnat and provides a continuous scale  between 1 (exactly equal to reference) and 0</span></em></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">其他的一些指标（参考文献 AI-Based Antibody Design Targeting Recent H5N1 Avian Influenza Strains）</span></p><ul><li><section><span leaf="">Van der Waals intermolecular energy (</span><em><span leaf="">vdw</span></em><span leaf="">) in kcal/mol</span></section></li><li><section><span leaf="">Electrostatic intermolecular energy (</span><em><span leaf="">elec</span></em><span leaf="">) in kcal/mol</span></section></li><li><section><span leaf="">Desolvation energy (</span><em><span leaf="">desolv</span></em><span leaf="">) in kcal/mol</span></section></li><li><section><span leaf="">Restraints violation energy (</span><em><span leaf="">air</span></em><span leaf="">) in arbitrary units</span></section></li><li><section><span leaf="">Buried surface area (</span><em><span leaf="">bsa</span></em><span leaf="">) in Å</span><sup><span leaf="">2</span></sup></section></li><li><section><span leaf="">Total energy (</span><em><span leaf="">total</span></em><span leaf="">): 1.0</span><em><span leaf="">vdw</span></em><span leaf=""> + 1.0</span><em><span leaf="">elec</span></em><span leaf=""> in kcal/mol</span></section></li><li><section><span leaf="">HADDOCK score: 1.0</span><em><span leaf="">vdw</span></em><span leaf=""> + 0.2</span><em><span leaf="">elec</span></em><span leaf=""> + 1.0</span><em><span leaf="">desolv</span></em><span leaf=""> + 0.1</span><em><span leaf="">air</span></em></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">如果</span><code><span leaf="">caprieval</span></code><span leaf="">是在聚类步骤后运行的，那么还会有一个</span><code><span leaf="">capri_clt.tsv</span></code><span leaf="">文件，包含簇的结果和打分：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpiaicsCAgtWZfKWGz5daibVQ0w4en3icD1boEDETeqPZj8QRJxIQia21WPJA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.11203703703703703" data-type="png" data-w="1080" data-imgfileid="100001065" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93OpiaicsCAgtWZfKWGz5daibVQ0w4en3icD1boEDETeqPZj8QRJxIQia21WPJA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><code><span leaf="">cluster_rank</span></code><span leaf=""> 为前一步中 </span><code><span leaf="">seletop</span></code><span leaf=""> 文件夹中 cluster 的名称，</span><code><span leaf="">cluster_id</span></code><span leaf=""> 为 cluster 的大小，1 是最大的（这里面都是一样大，因此这一列没有什么意义）；一般选择排序最高的 cluster 里面最好的模型（</span><code><span leaf="">cluster_1_model_1</span></code><span leaf="">）。</span></p><p data-tool="mdnice编辑器"><span leaf="">族的结果可视化在</span><code><span leaf="">analysis/10_caprieval_analysis</span></code><span leaf="">，接触图可视化在 </span><code><span leaf="">11_contactmap</span></code><span leaf="">。</span></p><p data-tool="mdnice编辑器"><span leaf="">最终的对接得到的PDB文件在 </span><code><span leaf="">09_seletopclusts/</span></code><span leaf="">，我们可以打开最优的模型（HADDOCK score 最低），并和实际的复合物进行对比（4G6M）：</span></p><section data-tool="mdnice编辑器" nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93Op3Ko76QWKGpYJ17524BjtCdEAWzyiczd86H6sETj0XxvrGLicBGUXMctA/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.0662177328843996" data-type="png" data-w="891" data-imgfileid="100001068" src="https://mmbiz.qpic.cn/mmbiz_png/lbL4A1lQyl2JlwTzMB14iaaL1G5sE93Op3Ko76QWKGpYJ17524BjtCdEAWzyiczd86H6sETj0XxvrGLicBGUXMctA/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="mdnice编辑器"><span leaf="">注意：具体的抗原-抗体对接流程文件可以参考 </span><span leaf="">https://www.bonvinlab.org/haddock3/examples.html#docking-antibody-antigen。有三个现成的可以用：</span></p><ul><li><section><strong><span leaf="">CDR-accessible</span></strong><span leaf="">，需要定义抗体 loop 和抗原表面溶剂可及残基（不一定是表位）之间的距离限制，进行 10000 次刚性采样对接，选择前 500 的模型进行柔性细化，并进行能量最小化；</span></section></li><li><section><strong><span leaf="">ranairCDR</span></strong><span leaf="">，抗体 loop 和抗原表面溶剂可及残基都进行采样，因此不需要提供距离限制文件，需要在配置文件中指定抗体采样的区域（6个 CDR），10000 次刚性对接，FCC 聚类，每个 cluster 选择 20 个模型，进行柔性细化，并进行能量最小化</span></section></li><li><section><strong><span leaf="">CDR-NMR-CSP</span></strong><span leaf="">，需要提供距离限制文件，并且明确表位氨基酸（就是上面所讲的步骤），1000 次刚性对接，选择前 200 个模型进行柔性细化和能量最小化；因为有表位和 paratope 的信息，因此采样不需要那么多。</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">‍</span></p></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/7MXbz3Dkkqq_InrPtMcVsQ",target="_blank" rel="noopener noreferrer">原文链接</a>
