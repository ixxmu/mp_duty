---
title: "点太多？取 bin 再画相关性散点图｜FigureYa73batchCorrelation"
date: 2025-11-23T23:23:21Z
draft: ["false"]
tags: [
  "fetched",
  "小丫画图"
]
categories: ["Acdemic"]
---
点太多？取 bin 再画相关性散点图｜FigureYa73batchCorrelation by 小丫画图
------
<div><section><section powered-by="xiumi.us"><section><section><section><section><section><p><span><span leaf="">小丫碎碎念：</span></span></p><p><span><span leaf=""><br></span></span></p><p><span leaf="">图的选择，应因数据制宜。</span></p><ul><li><p><span><span><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{"style":"margin-bottom: 0px;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{"powered-by":"xiumi.us"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"p","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"node",{"tagName":"span","attributes":{"style":"font-family: mp-quote, \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif;letter-spacing: 0.034em;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>小样本量，多组相关分析可以画到一个坐标系里，便于直观比较不同组的相关性斜率。</span></span><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg3NTA1MTM0NQ==&amp;mid=2247487462&amp;idx=1&amp;sn=4babd84b3ccaddeced9f9f17d4396316&amp;scene=21#wechat_redirect" textvalue="一个坐标系，多个分组的相关性分析结果｜FigureYa181multiCorrelation" data-itemshowtype="0" linktype="text" data-linktype="2">一个坐标系，多个分组的相关性分析结果｜FigureYa181multiCorrelation</a></span></span></p></li><li><p><span><span leaf="">中样本量，多组相关分析结果画到一个坐标系里就太拥挤了，适合分面，每个坐标系里只画一组相关分析结果，便于逐一解读。</span><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{"style":"margin-bottom: 0px;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{"powered-by":"xiumi.us"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"p","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>可参考FigureYa73batchCorrelation，在参数设置里pointnumber设为NULL。</span></span></p></li><li><p><span><span leaf="">大样本量，每组都有上万个点，就算一个坐标系只画一组数据，也太拥挤。将大样本分成同等大小的区间，用中位数代表该区间所有的点，既保留趋势，又简化显示。可参考FigureYa73batchCorrelation，在参数设置里pointnumber设为20（根据自己数据情况灵活设置）。</span></span></p></li></ul><p><span><span leaf=""><br></span></span></p></section></section></section><p><strong><span><span leaf="">需求描述</span></span></strong></p><p data-pm-slice="0 0 []"><span leaf="">输入TCGA的表达矩阵，按文章中的方法计算bin(或者不取bin)、批量计算一个基因跟多个基因的相关系数、pvalue，画出文章里的图</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/fTGTY7Bwuzcxx92nESAvTbNcROgmc0bNy2FfickUPxvHwTCjlURT2TyRSpwhkN36EBMcibrIUOGqA8S3xmz4q9dg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8638132295719845" data-type="png" data-w="514" data-imgfileid="100003815" src="https://mmbiz.qpic.cn/sz_mmbiz_png/fTGTY7Bwuzcxx92nESAvTbNcROgmc0bNy2FfickUPxvHwTCjlURT2TyRSpwhkN36EBMcibrIUOGqA8S3xmz4q9dg/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf="">From https://www.nature.com/articles/nature13473</span></p><p><span leaf=""><br></span></p><h2><strong><span><span leaf="">应用场景</span></span></strong></h2><p data-pm-slice="0 0 []"><span leaf="">批量筛选哪些基因跟你感兴趣的基因呈正/负相关。</span></p><p><span leaf="">不仅适用于基因表达的相关性分析，还适用于像例文那样的转录因子结合（ChIP）跟靶基因变化倍数（RNA-seq）的相关性分析。把示例中的基因信息替换成位点信息即可。</span></p><p><span leaf="">在画ChIP-seq、ATAC-seq或DNA甲基化等动辄成千上万个位点时，可以尝试这种取bin的方式画图。</span></p><p><span leaf=""><br></span></p></section></section></section></section><h2><strong><span><span leaf="">环境设置</span></span></strong></h2><section><ul><li><li><li><li><li></ul><pre data-lang="makefile"><code><span leaf="">source(<span>"install_dependencies.R"</span>) <span>#自动识别缺哪些R包，自动安装</span></span></code><code><span leaf="">library(reshape2)   <span># 数据重塑工具（如宽表转长表） Data reshaping tools (e.g., wide to long format)</span></span></code><code><span leaf="">library(ggplot2)    <span># 高级数据可视化 Advanced data visualization</span></span></code><code><span leaf="">library(cowplot)    <span># 提供图形排版功能 Enhanced plot arrangement tools</span></span></code><code><span leaf="">library(plyr)       <span># 数据分割-应用-合并工具 Tools for splitting-applying-combining data</span></span></code></pre></section><p data-pm-slice="0 0 []"><span leaf="">参数设置</span></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 设置目标基因 / Set target gene symbol</span></span></code><code><span leaf=""><span>symbol</span> &lt;- <span>"HDAC1"</span>  # 这里以组蛋白去乙酰化酶<span>1</span>基因为例 / Example: Histone Deacetylase <span>1</span> gene</span></code><code><span leaf=""><span># 设置选取的Top基因数量 / Set number of top genes to select</span></span></code><code><span leaf=""><span>topnumber</span> = <span>6</span>  # 选取正相关和负相关各Top <span>6</span>的基因 / Select top <span>6</span> positively and negatively correlated genes</span></code><code><span leaf=""><span># 绘图设置：通过将基因表达水平分组到等大小的区间来绘制特殊点</span></span></code><code><span leaf=""><span># Plot settings: Group gene expression levels into equally sized bins for special points</span></span></code><code><span leaf=""><span>pointnumber</span> = <span>20</span>  # 设置每个区间包含<span>20</span>个点 / Set <span>20</span> points per bin</span></code><code><span leaf=""><span># 可选：不使用分组区间的绘图方式</span></span></code><code><span leaf=""><span># Alternative: Plot without binning</span></span></code><code><span leaf=""><span># pointnumber = NULL  # 取消分组区间设置 / Disable binning</span></span></code></pre></section><h2 data-heading="true"><strong><span><span leaf="">输入文件</span></span></strong></h2><p data-pm-slice="0 0 []"><span><span leaf="">easy_input.csv，基因表达矩阵，第一列是gene symbol，后面是表达矩阵。</span></span></p><p><span><span leaf="">示例数据取自FigureYa71ssGSEA的not_easy_input_expr.txt文件，把表达矩阵的第一列gene_id换成gene symbol，可参考FigureYa71ssGSEA或FigureYa56immune_inflitration的处理方式。为方便传输，取了表达量最高的1000个基因。</span></span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 读取TCGA表达数据 / Read TCGA expression data</span></span></code><code><span leaf=""><span># 从CSV文件读取表达矩阵，第一列作为行名 / Read expression matrix from CSV file, using first column as row names</span></span></code><code><span leaf=""><span>tcga_expr</span> &lt;- read.csv(<span>"easy_input.csv"</span>, row.names = <span>1</span>)</span></code><code><span leaf=""><span># 查看数据前3行和前3列 / Display first 3 rows and first 3 columns</span></span></code><code><span leaf=""><span># 用于快速检查数据格式和内容 / Quick check of data format and content</span></span></code><code><span leaf=""><span>tcga_expr</span>[<span>1</span>:<span>3</span>, <span>1</span>:<span>3</span>]</span></code></pre></section><p data-pm-slice="0 0 []"><span leaf="">计算相关系数</span></p><p data-pm-slice="0 0 []"><span><span leaf="">此处采用两种方法计算相关系数：pearson和spearman</span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span># 获取目标基因的表达数据 / Extract expression data of target gene</span></span></code><code><span leaf=""><span># 从表达矩阵中提取目标基因(symbol)的表达值 / Get expression values of target gene from expression matrix</span></span></code><code><span leaf="">target.exps &lt;- tcga_expr[symbol,]</span></code><code><span leaf=""><span># 获取其他基因的表达数据 / Extract expression data of other genes</span></span></code><code><span leaf=""><span># 从表达矩阵中移除目标基因所在行 / Remove target gene row from expression matrix</span></span></code><code><span leaf="">other.expr &lt;- tcga_expr[-<span>which</span>(<span>rownames</span>(tcga_expr)==symbol),]</span></code><code><span leaf=""><span># 计算Pearson相关系数 / Calculate Pearson correlation</span></span></code><code><span leaf=""><span># 转置矩阵后计算各基因与目标基因的相关性 / Transpose matrix and calculate correlation with target gene</span></span></code><code><span leaf="">sgcor &lt;- <span>as</span>.data.<span>frame</span>(<span>cor</span>(<span>t</span>(other.expr), <span>t</span>(target.exps))) <span>#默认pearson / Default is Pearson</span></span></code><code><span leaf=""><span>colnames</span>(sgcor) &lt;- <span>"r_pearson"</span>  <span># 重命名列 / Rename column</span></span></code><code><span leaf=""><span># 计算Pearson相关系数的p值（耗时操作） / Calculate p-values for Pearson correlation (time-consuming)</span></span></code><code><span leaf="">sgcor<span>$pval_pearson </span>&lt;- <span>apply</span>(other.expr, <span>1</span>, function(x) (cor.<span>test</span>(x, <span>t</span>(target.exps))<span>$p</span>.value))</span></code><code><span leaf=""><span># 计算Spearman相关系数 / Calculate Spearman correlation</span></span></code><code><span leaf="">sgcor_spearman &lt;- <span>as</span>.data.<span>frame</span>(<span>cor</span>(<span>t</span>(other.expr), <span>t</span>(target.exps), method = <span>"spearman"</span>))</span></code><code><span leaf=""><span>colnames</span>(sgcor_spearman) &lt;- <span>"r_spearman"</span>  <span># 重命名列 / Rename column</span></span></code><code><span leaf="">sgcor_spearman<span>$pval_spearman </span>&lt;- <span>apply</span>(other.expr, <span>1</span>, function(x)(cor.<span>test</span>(x, <span>t</span>(target.exps), method = <span>"spearman"</span>)<span>$p</span>.value))</span></code><code><span leaf=""><span># 合并两种相关系数结果 / Combine both correlation results</span></span></code><code><span leaf="">cors &lt;- <span>cbind</span>(sgcor, sgcor_spearman)</span></code><code><span leaf="">cors<span>$gene </span>&lt;- <span>rownames</span>(other.expr)  <span># 添加基因名列 / Add gene name column</span></span></code><code><span leaf=""><span>head</span>(cors)  <span># 查看前几行结果 / Preview results</span></span></code><code><span leaf=""><span># 筛选有效结果（去除NA值） / Filter valid results (remove NAs)</span></span></code><code><span leaf="">newcor &lt;- cors[!(is.<span>na</span>(cors<span>$r_pearson</span>)),]</span></code><code><span leaf=""><span>dim</span>(newcor)  <span># 查看剩余基因数量 / Check remaining gene count</span></span></code><code><span leaf=""><span># 按Pearson相关系数排序 / Sort by Pearson correlation coefficient</span></span></code><code><span leaf="">sortcor &lt;- newcor[<span>order</span>(newcor<span>$r_pearson</span>, newcor<span>$r_spearman</span>, decreasing = T),]</span></code><code><span leaf=""><span># 提取Top相关基因 / Extract top correlated genes</span></span></code><code><span leaf=""><span># 获取正相关Top6和负相关Top6 / Get top 6 positive and negative correlated genes</span></span></code><code><span leaf="">topcor &lt;- sortcor[<span>c</span>(<span>1</span>:topnumber, <a topic-id="mia4hoph-v2916v" data-topic="1">#正相关Top</a> <span>6</span> / Top <span>6</span> positive</span></code><code><span leaf="">                   (<span>nrow</span>(sortcor) - topnumber + <span>1</span>):<span>nrow</span>(sortcor)),] <span>#负相关Top 6 / Top 6 negative</span></span></code><code><span leaf=""><span>rownames</span>(topcor)  <span># 显示Top基因名 / Show top gene names</span></span></code><code><span leaf=""><span># 准备可视化数据 / Prepare visualization data</span></span></code><code><span leaf="">genes &lt;- <span>c</span>(symbol,<span>rownames</span>(topcor))  <span># 合并目标基因和Top相关基因 / Combine target and top genes</span></span></code><code><span leaf="">genesexps &lt;- <span>as</span>.data.<span>frame</span>(<span>t</span>(tcga_expr[genes,]))  <span># 转置表达矩阵 / Transpose expression matrix</span></span></code><code><span leaf="">sortgenesexps &lt;- genesexps[<span>order</span>(genesexps[,<span>1</span>]),]  <span># 按目标基因表达量排序 / Sort by target gene expression</span></span></code><code><span leaf="">samplenum &lt;- <span>nrow</span>(sortgenesexps)  <span># 获取样本数量 / Get sample count</span></span></code></pre></section><p data-pm-slice="0 0 []"><span><span leaf="">例文中输入数据是ChIP-seq的peak，直接画甚至会有上万个点，因此，作者取了bin。</span></span></p><p><span><span leaf="">你也可以不取bin，而是画出所有的点，在参数设置里pointnumber设为NULL</span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span leaf=""><span># 设置绘图点数 / Set number of points for plotting</span></span></code><code><span leaf=""><span># 如果未指定pointnumber，则使用所有样本 / If pointnumber is NULL, use all samples</span></span></code><code><span leaf=""><span>if</span>(is.null(pointnumber)){</span></code><code><span leaf="">  pointnumber = samplenum</span></code><code><span leaf="">}</span></code><code><span leaf=""><span># 将样本分组为等大小的区间 / Group samples into equally sized bins</span></span></code><code><span leaf=""><span># 创建分组因子变量 / Create grouping factor variable</span></span></code><code><span leaf="">group &lt;- as.integer(cut(<span>1</span>:samplenum, </span></code><code><span leaf="">                       breaks = c(se<span>q(from = 0.5, to = samplenum, </span></span></code><code><span leaf="">                                     by = samplenum/pointnumber), </span></code><code><span leaf="">                                 samplenum + <span>0</span>.<span>5</span>)))</span></code><code><span leaf=""><span># 初始化数据框用于存储结果 / Initialize dataframe for storing results</span></span></code><code><span leaf="">ddf &lt;- data.frame(row.names = <span>1</span>:pointnumber)</span></code><code><span leaf=""><span># 计算每个基因在每个区间的中位数表达值 / Calculate median expression for each gene in each bin</span></span></code><code><span leaf=""><span>for</span>(i in <span>1</span>:(<span>1</span> + topnumber*<span>2</span>)){  <span># 遍历目标基因和所有top基因 / Loop through target and top genes</span></span></code><code><span leaf="">  ddf &lt;- cbind(ddf, tapply(sortgenesexps[,i], group, median))</span></code><code><span leaf="">}</span></code><code><span leaf=""><span># 设置列名 / Set column names</span></span></code><code><span leaf="">colnames(ddf) &lt;- c(symbol, topcor<span>$gene</span>)</span></code><code><span leaf=""><span># 转换数据为长格式便于ggplot绘图 / Melt data to long format for ggplot</span></span></code><code><span leaf="">mddf &lt;- melt(ddf, id.vars = symbol)</span></code><code><span leaf=""><span># 添加相关系数和p值信息 / Add correlation coefficients and p-values</span></span></code><code><span leaf=""><span># 使用Pearson相关结果 / Using Pearson correlation results</span></span></code><code><span leaf=""><span># 如需Spearman结果，可替换为r_spearman和pval_spearman / For Spearman, replace with r_spearman and pval_spearman</span></span></code><code><span leaf="">mddf<span>$r</span> &lt;- topcor[mddf<span>$variable</span>, ]<span>$r_pearson</span></span></code><code><span leaf="">mddf<span>$P</span> &lt;- topcor[mddf<span>$variable</span>, ]<span>$pval_pearson</span></span></code></pre></section><h2 data-heading="true"><strong><span><span leaf="">开始画图</span></span></strong></h2><h3 data-pm-slice="0 0 []"><span leaf="">一次画一个基因，以EIF3I为例</span></h3><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span># 选择特定基因的数据 / Select data for specific gene</span></span></code><code><span leaf="">friend &lt;- <span>"EIF3I"</span>  <span># 设置要分析的基因 / Set gene to analyze</span></span></code><code><span leaf="">df &lt;- mddf[mddf<span>$variable </span>== friend,]  <span># 筛选该基因的数据 / Filter data for this gene</span></span></code><code><span leaf=""><span># 格式化相关系数r的显示 / Format correlation coefficient r display</span></span></code><code><span leaf=""><span># 创建斜体r值和数值的表达式 / Create expression with italic r and value</span></span></code><code><span leaf="">rvalue &lt;- <span>as</span>.<span>character</span>(<span>as</span>.<span>expression</span>(<span>substitute</span>(~~<span>italic</span>(r)~<span>"="</span>~rvalue, <span>list</span>(rvalue = <span>format</span>(<span>round</span>(<span>unique</span>(df<span>$r</span>),<span>2</span>), nsmall= <span>2</span>)))))</span></code><code><span leaf=""><span># 格式化p值的显示 / Format p-value display</span></span></code><code><span leaf=""><span># 创建斜体P值和科学计数法数值的表达式 / Create expression with italic P and scientific notation</span></span></code><code><span leaf="">pvalue &lt;- <span>as</span>.<span>character</span>(<span>as</span>.<span>expression</span>(<span>substitute</span>(~~<span>italic</span>(P)~<span>"="</span>~pvalue, <span>list</span>(pvalue = <span>format</span>(<span>sprintf</span>(<span>"%1.1e"</span>, <span>unique</span>(df<span>$P</span>)), nsmall= <span>2</span>)))))</span></code><code><span leaf=""><span># 绘制散点图 / Create scatter plot</span></span></code><code><span leaf=""><span>ggplot</span>(df, <span>aes_string</span>(x = symbol, y = <span>"value"</span>)) +</span></code><code><span leaf="">  <span>geom_point</span>() +  <span># 添加散点 / Add points</span></span></code><code><span leaf="">  <span>ylab</span>(friend) +  <span># 设置y轴标签为基因名 / Set y-axis label as gene name</span></span></code><code><span leaf="">  <span>theme_classic</span>() +  <span># 使用经典主题 / Use classic theme</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 添加统计注释 / Add statistical annotations</span></span></code><code><span leaf="">  <span># 需要根据数据范围调整x,y坐标位置 / Need to adjust x,y positions based on data range</span></span></code><code><span leaf="">  <span>annotate</span>(<span>"text"</span>, x = <span>334</span>, y = <span>350</span>, label = rvalue, parse = <span>TRUE</span>) +  <span># 添加r值 / Add r value</span></span></code><code><span leaf="">  <span>annotate</span>(<span>"text"</span>, x = <span>340</span>, y = <span>300</span>, label = pvalue, parse = <span>TRUE</span>) +  <span># 添加p值 / Add p value</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 添加线性回归线 / Add linear regression line</span></span></code><code><span leaf="">  <span>geom_smooth</span>(method = <span>"lm"</span>, se = <span>FALSE</span>, colour = <span>"#206BB5"</span>)  <span># 蓝色回归线 / Blue regression line</span></span></code><code><span leaf=""><span># 保存图形 / Save plot</span></span></code><code><span leaf=""><span>ggsave</span>(<span>paste0</span>(symbol, <span>"_"</span>, friend, <span>".pdf"</span>))  <span># 输出PDF文件 / Output PDF file</span></span></code></pre></section><p data-pm-slice="0 0 []"><span><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/fTGTY7Bwuzcxx92nESAvTbNcROgmc0bNdnwQwkLbxg5kcwy2syI9R9PEZiccExx4zBHOY4ATfgKJQmvGARHLsPQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7138888888888889" data-type="png" data-w="1080" data-imgfileid="100003817" src="https://mmbiz.qpic.cn/sz_mmbiz_png/fTGTY7Bwuzcxx92nESAvTbNcROgmc0bNdnwQwkLbxg5kcwy2syI9R9PEZiccExx4zBHOY4ATfgKJQmvGARHLsPQ/640?wx_fmt=png&amp;from=appmsg"></span></span></p><p data-pm-slice="0 0 []"><span><span leaf="">批量画图 </span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="ruby"><code><span leaf=""><span># 使用dlply按基因拆分数据并创建多个ggplot对象</span></span></code><code><span leaf=""><span># Split data by gene using dlply and create multiple ggplot objects</span></span></code><code><span leaf=""><span># 对mddf数据框按variable(基因名)分组，为每个基因创建一个散点图</span></span></code><code><span leaf=""><span># Group mddf dataframe by variable (gene name), create scatter plot for each gene</span></span></code><code><span leaf="">plist &lt;- dlply(mddf, .(variable), function(trig) {</span></code><code><span leaf="">  ggplot(trig, aes_string(x = symbol, y = <span>"value"</span>)) +</span></code><code><span leaf="">    geom_point() +  <span># 添加散点 / Add scatter points</span></span></code><code><span leaf="">    ylab(unique(trig<span>$variable</span>)) +  <span># 设置y轴标签为当前基因名 / Set y-axis label to current gene name</span></span></code><code><span leaf="">    theme_classic() +  <span># 使用简洁的经典主题 / Use clean classic theme</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span># 添加标题显示相关系数和p值</span></span></code><code><span leaf="">    <span># Add title showing correlation coefficient and p-value</span></span></code><code><span leaf="">    ggtitle(paste0(<span>"r = "</span>, round(unique(trig<span>$r</span>), <span>2</span>),  <span># 显示r值并保留2位小数 / Show r rounded to 2 decimal places</span></span></code><code><span leaf="">            <span>"\nP = "</span>, sprintf(<span>"%1.1e"</span>, unique(trig<span>$P</span>)))) +  <span># 显示科学计数法p值 / Show p-value in scientific notation</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span># 添加线性回归线(蓝色，无置信区间)</span></span></code><code><span leaf="">    <span># Add linear regression line (blue, no confidence interval)</span></span></code><code><span leaf="">    geom_smooth(method = <span>"lm"</span>, se = <span>FALSE</span>, colour = <span>"#206BB5"</span>)</span></code><code><span leaf="">})</span></code><code><span leaf=""><span># 使用cowplot包的plot_grid将所有图形排列成网格</span></span></code><code><span leaf=""><span># Arrange all plots into grid using plot_grid from cowplot package</span></span></code><code><span leaf="">pg &lt;- plot_grid(</span></code><code><span leaf="">  plotlist = plist,  <span># 图形列表 / List of plots</span></span></code><code><span leaf="">  ncol = <span>3</span>,  <span># 每行3个图 / 3 plots per row</span></span></code><code><span leaf="">  align = <span>"hv"</span>  <span># 水平和垂直对齐 / Align horizontally and vertically</span></span></code><code><span leaf="">)</span></code><code><span leaf=""><span># 显示组合后的图形</span></span></code><code><span leaf=""><span># Display combined plot</span></span></code><code><span leaf="">pg</span></code><code><span leaf=""><span># 保存图形为PDF文件</span></span></code><code><span leaf=""><span># Save plot as PDF file</span></span></code><code><span leaf="">filename &lt;- paste0(symbol, <span>"_cor.pdf"</span>)  <span># 生成文件名(如"HDAC1_cor.pdf") / Generate filename (e.g., "HDAC1_cor.pdf")</span></span></code><code><span leaf="">ggsave(</span></code><code><span leaf="">  filename, </span></code><code><span leaf="">  width = <span>8</span>,  <span># 宽度8英寸 / Width 8 inches</span></span></code><code><span leaf="">  height = <span>10</span>  <span># 高度10英寸 / Height 10 inches</span></span></code><code><span leaf="">)</span></code></pre></section><p><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/fTGTY7Bwuzcxx92nESAvTbNcROgmc0bNKQljkNteib3vqtWMJficoGR2ibGDSWS2t6o4LweGWUTI54rQkASUpHjWw/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.2" data-type="png" data-w="1080" data-imgfileid="100003818" src="https://mmbiz.qpic.cn/sz_mmbiz_png/fTGTY7Bwuzcxx92nESAvTbNcROgmc0bNKQljkNteib3vqtWMJficoGR2ibGDSWS2t6o4LweGWUTI54rQkASUpHjWw/640?wx_fmt=png&amp;from=appmsg"></span></p><p><span leaf=""><br></span></p><section data-pm-slice="5 3 []"><section><span data-pm-slice="0 0 []"><h1 tabindex="-1" dir="auto" data-pm-slice="0 0 []"><span><strong><span><span leaf="">代码、输入、输出文件</span></span></strong></span></h1></span></section><p><span><span leaf="">https://github.com/ying-ge/FigureYa/tree/main/</span><span leaf="">FigureYa73batchCorrelation</span></span></p><p><span><span leaf=""><br></span></span></p><section data-pm-slice="3 3 []"><p><span data-pm-slice="0 0 []"><span><strong><span><span leaf="">下载某个FigureYa的压缩包</span></span></strong></span></span></p><p><span leaf="">https://github.com/ying-ge/FigureYa-compressed</span></p></section><p><span leaf=""><br></span></p></section><h1 tabindex="-1" dir="auto" data-pm-slice="0 0 []"><span><strong><span><span leaf="">Citation</span></span></strong></span></h1><section><span><span leaf="">Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005</span></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/IW9qIUuaSSvaI8uTfuELVw",target="_blank" rel="noopener noreferrer">原文链接</a>
