---
title: "RNA-seq数据分析(8) GSVA功能通路活性分析"
date: 2025-11-25T13:30:06Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
RNA-seq数据分析(8) GSVA功能通路活性分析 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">欢迎关注R语言数据分析指南</span></span><span></span></h3><blockquote><span><span leaf="">❝</span></span><p><span leaf="">在上一节中介绍了WGCNA分析，那么rna_seq分析中还有一个重要的内容即GSVA分析。本节小编就来结合之前得到的数据参考GSVA官方文档来进行一些实际的演示，个人观点仅供参考，更多详细内容请查看官方文档。</span></p></blockquote><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">参考文档</span></span><span></span></h3><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1ibQic0LxQMBQCg5CoTNOaicWG5mTrMa7Kq8PfTADGIZ8TCCadZ8d8Fuvxdxronc9uMJekia3icoSOqg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5666666666666667" data-type="png" data-w="1080" data-imgfileid="100054680" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1ibQic0LxQMBQCg5CoTNOaicWG5mTrMa7Kq8PfTADGIZ8TCCadZ8d8Fuvxdxronc9uMJekia3icoSOqg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">https://www.bioconductor.org/packages/release/bioc/vignettes/GSVA/inst/doc/GSVA.html</span><span leaf=""><br></span><span leaf="">https://igordot.github.io/msigdbr/articles/msigdbr-intro.html</span></p><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">数据论文</span></span><span></span></h3><p data-tool="mdnice编辑器"><strong><span leaf="">Enteric bacterial infection stimulates remodelling of bile metabolites to promote intestinal homeostasis</span></strong><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1ibQic0LxQMBQCg5CoTNOaictUmzfcmbp96T4eBx2LaaNI12XUhlVqtbpicy5LfDjKWIfRONSBU6sPw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.4148148148148148" data-type="png" data-w="1080" data-imgfileid="100054677" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1ibQic0LxQMBQCg5CoTNOaictUmzfcmbp96T4eBx2LaaNI12XUhlVqtbpicy5LfDjKWIfRONSBU6sPw/640?wx_fmt=png&amp;from=appmsg"></span></p><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">加载R包</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(tidyverse)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(tximport)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(edgeR)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(GSVA)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(msigdbr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(AnnotationDbi)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(org.Mm.eg.db)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1ibQic0LxQMBQCg5CoTNOaicxJ2FKWx68qiaWpbM6wB8KicOmb4PicEUkC9W84icpOhWfrhqKxKprOE5Vg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.24074074074074073" data-type="png" data-w="1080" data-imgfileid="100054678" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1ibQic0LxQMBQCg5CoTNOaicxJ2FKWx68qiaWpbM6wB8KicOmb4PicEUkC9W84icpOhWfrhqKxKprOE5Vg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">tximport → 得到基因层面的 counts</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">meta &lt;- read_csv(</span><span><span leaf="">"samplesheet.csv"</span></span><span leaf="">) %&gt;% </span><span leaf=""><br></span><span leaf="">  column_to_rownames(</span><span><span leaf="">"sample"</span></span><span leaf="">) %&gt;% </span><span leaf=""><br></span><span leaf="">  mutate(group = factor(group))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">tx2gene &lt;- read_tsv(</span><span><span leaf="">"tx2gene.tsv"</span></span><span leaf="">) %&gt;% dplyr::select(</span><span><span leaf="">1</span></span><span leaf="">,</span><span><span leaf="">2</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">files &lt;- list.files(</span><span><span leaf="">"."</span></span><span leaf="">, pattern=</span><span><span leaf="">"quant.sf$"</span></span><span leaf="">, recursive=</span><span><span leaf="">TRUE</span></span><span leaf="">, full.names=</span><span><span leaf="">TRUE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">names(files) &lt;- basename(dirname(files))</span><span leaf=""><br></span><span><span leaf=""># 重新排序，使文件顺序=样本顺序</span></span><span leaf=""><br></span><span leaf="">files &lt;- files[ match(rownames(meta), names(files)) ]</span><span leaf=""><br></span><span leaf="">stopifnot(all(names(files) == rownames(meta)))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">txi &lt;- tximport(files, type=</span><span><span leaf="">"salmon"</span></span><span leaf="">, tx2gene=tx2gene)</span><span leaf=""><br></span><span leaf="">counts_mat &lt;- txi$counts</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">构建logCPM</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(edgeR)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">dge &lt;- DGEList(counts = counts_mat)</span><span leaf=""><br></span><span leaf="">dge &lt;- calcNormFactors(dge)        </span><span><span leaf=""># TMM normalization</span></span><span leaf=""><br></span><span leaf="">logCPM &lt;- cpm(dge, log = </span><span><span leaf="">TRUE</span></span><span leaf="">)     </span><span><span leaf=""># 得到 logCPM 矩阵</span></span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">Ensembl → Symbol</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(org.Mm.eg.db)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(AnnotationDbi)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">symbols &lt;- mapIds(</span><span leaf=""><br></span><span leaf="">  org.Mm.eg.db,</span><span leaf=""><br></span><span leaf="">  keys = rownames(logCPM),</span><span leaf=""><br></span><span leaf="">  column = </span><span><span leaf="">"SYMBOL"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  keytype = </span><span><span leaf="">"ENSEMBL"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  multiVals = </span><span><span leaf="">"first"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">logCPM_symbol &lt;- logCPM</span><span leaf=""><br></span><span leaf="">rownames(logCPM_symbol) &lt;- symbols</span><span leaf=""><br></span><span leaf="">logCPM_symbol &lt;- logCPM_symbol[!is.na(rownames(logCPM_symbol)), ]</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">同名symbol合并</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">logCPM_symbol &lt;- logCPM_symbol %&gt;%</span><span leaf=""><br></span><span leaf="">  as.data.frame() %&gt;%</span><span leaf=""><br></span><span leaf="">  rownames_to_column(</span><span><span leaf="">"symbol"</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  group_by(symbol) %&gt;%</span><span leaf=""><br></span><span leaf="">  summarise(across(everything(), mean)) %&gt;%</span><span leaf=""><br></span><span leaf="">  column_to_rownames(</span><span><span leaf="">"symbol"</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  as.matrix()</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">获取小鼠基因集</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(msigdbr)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">m_df &lt;- msigdbr(db_species = </span><span><span leaf="">"MM"</span></span><span leaf="">, species = </span><span><span leaf="">"Mus musculus"</span></span><span leaf="">,category=</span><span><span leaf="">"MH"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">gene_sets &lt;- split(m_df$gene_symbol,m_df$gs_name)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(GSVA)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">gpar &lt;- gsvaParam(</span><span leaf=""><br></span><span leaf="">  exprData = logCPM_symbol,</span><span leaf=""><br></span><span leaf="">  geneSets = gene_sets,</span><span leaf=""><br></span><span leaf="">  kcdf = </span><span><span leaf="">"Gaussian"</span></span><span leaf="">,      </span><span><span leaf=""># logCPM → Gaussian kernel</span></span><span leaf=""><br></span><span leaf="">  minSize = </span><span><span leaf="">10</span></span><span leaf="">,maxSize = </span><span><span leaf="">500</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">es &lt;- gsva(gpar, verbose = </span><span><span leaf="">TRUE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">es &lt;- es[, rownames(meta)]</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">GSVA 热图</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(pheatmap)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(RColorBrewer)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 选方差最高的 pathway</span></span><span leaf=""><br></span><span leaf="">sel &lt;- order(apply(es, </span><span><span leaf="">1</span></span><span leaf="">, sd), decreasing=</span><span><span leaf="">TRUE</span></span><span leaf="">)[</span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">50</span></span><span leaf="">]</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">annotation_col &lt;- data.frame(Group = meta$group)</span><span leaf=""><br></span><span leaf="">rownames(annotation_col) &lt;- rownames(meta)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">ann_colors &lt;- list(</span><span leaf=""><br></span><span leaf="">  Group = setNames(brewer.pal(nlevels(meta$group), </span><span><span leaf="">"Set1"</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">                   levels(meta$group)))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">pheatmap(</span><span leaf=""><br></span><span leaf="">  es[sel, ],</span><span leaf=""><br></span><span leaf="">  scale = </span><span><span leaf="">"row"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  annotation_col = annotation_col,</span><span leaf=""><br></span><span leaf="">  annotation_colors = ann_colors,</span><span leaf=""><br></span><span leaf="">  show_colnames = </span><span><span leaf="">FALSE</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  clustering_method = </span><span><span leaf="">"ward.D2"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  color = colorRampPalette(rev(brewer.pal(</span><span><span leaf="">11</span></span><span leaf="">, </span><span><span leaf="">"RdBu"</span></span><span leaf="">)))(</span><span><span leaf="">100</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">  fontsize_row = </span><span><span leaf="">7</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  border_color = </span><span><span leaf="">NA</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  main = </span><span><span leaf="">"GSVA Pathway Enrichment Heatmap"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1ibQic0LxQMBQCg5CoTNOaicsOHw24CEAVS2yREEdmbr4vDic9OJQInaSAkDLNzBDffswpkAaVb0RiaA/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.1314814814814815" data-type="png" data-w="1080" data-imgfileid="100054681" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAa1ibQic0LxQMBQCg5CoTNOaicsOHw24CEAVS2yREEdmbr4vDic9OJQInaSAkDLNzBDffswpkAaVb0RiaA/640?wx_fmt=png&amp;from=appmsg"></span></p><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">关注下方公众号下回更新不迷路</span></span><span></span></h3><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-from="0" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-id="Mzg3MzQzNTYzMw==" data-is_biz_ban="0" data-service_type="1" data-verify_status="0"></mp-common-profile></section></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Zwth0amelXAyGnWkx3Sx0w",target="_blank" rel="noopener noreferrer">原文链接</a>
