---
title: "基于DESeq2与Salmon定量数据的多通路GSEA富集分析与可视化全流程"
date: 2025-11-28T02:05:33Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
基于DESeq2与Salmon定量数据的多通路GSEA富集分析与可视化全流程 by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">欢迎关注R语言数据分析指南</span></span><span></span></h3><blockquote><span><span leaf="">❝</span></span><p><span leaf="">在之前的RNA_seq分析流程中结合相关论文介绍过GSEA分析，本节来使用</span><strong><span leaf="">GseaVis</span></strong><span leaf="">包来介绍如何基于分析结果来绘制多通路GSEA的富集分析图。从定量数据开始一步步进行展示，希望对各位读者有所帮助。个人观点，仅供参考</span></p></blockquote><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">GseaVis官方文档</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">https://github.com/junjunlab/GseaVis<img data-ratio="1.2814814814814814" data-type="png" data-w="1080" data-imgfileid="100054757" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fzvS68gTGrY0J1mIrXrRstSic4F14aI20esgsYDdDagC9E2nZ5AwL4Alg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fzvS68gTGrY0J1mIrXrRstSic4F14aI20esgsYDdDagC9E2nZ5AwL4Alg/640?wx_fmt=png&amp;from=appmsg">Jun Zhang, Hongyuan Li, Wenjun Tao, Jun Zhou. GseaVis: An R Package for Enhanced Visualization of Gene Set Enrichment Analysis in Biomedicine. Med Research, 2025.</span></p><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">结果图</span></span><span></span></h3><figure data-tool="mdnice编辑器"><span leaf=""><img data-ratio="0.825925925925926" data-type="png" data-w="1080" data-imgfileid="100054755" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fzRs0iaNhB8GBibibric2DExK5o7F9JF37XeIbxy0P7YwrLSx1F1ImmloSIA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fzRs0iaNhB8GBibibric2DExK5o7F9JF37XeIbxy0P7YwrLSx1F1ImmloSIA/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">整体过程</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Salmon quant.sf -&gt; tximport -&gt; DESeq2 -&gt; lfcShrink -&gt; </span><span leaf=""><br></span><span leaf="">geneList（SYMBOL = log2FC）-&gt;GSEA -&gt; gseaNb</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">加载R包</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(DESeq2)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(tximport)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(tidyverse)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(apeglm)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(clusterProfiler)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(org.Mm.eg.db)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(msigdbr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(enrichplot)</span><span leaf=""><br></span><span><span leaf=""><a topic-id="mihozi2e-j3d77j" data-topic="1">#devtools</a>::install_github("junjunlab/GseaVis")</span></span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(GseaVis)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-ratio="0.2537037037037037" data-type="png" data-w="1080" data-imgfileid="100054753" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fzx7bIicrMCLUVbibwSdjqGbL5icFGuA2z4ZA1C1iaSsicE1OEGOXPYVnziaYA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fzx7bIicrMCLUVbibwSdjqGbL5icFGuA2z4ZA1C1iaSsicE1OEGOXPYVnziaYA/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">数据读取</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">meta &lt;- read_csv(</span><span><span leaf="">"samplesheet.csv"</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  column_to_rownames(</span><span><span leaf="">"sample"</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(group = factor(group))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">tx2gene &lt;- read_tsv(</span><span><span leaf="">"tx2gene.tsv"</span></span><span leaf="">) %&gt;% dplyr::select(</span><span><span leaf="">1</span></span><span leaf="">,</span><span><span leaf="">2</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">files &lt;- list.files(</span><span><span leaf="">"."</span></span><span leaf="">, pattern=</span><span><span leaf="">"quant.sf$"</span></span><span leaf="">, recursive=</span><span><span leaf="">TRUE</span></span><span leaf="">, full.names=</span><span><span leaf="">TRUE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">names(files) &lt;- basename(dirname(files))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">files &lt;- files[ match(rownames(meta), names(files)) ]</span><span leaf=""><br></span><span leaf="">stopifnot(all(names(files) == rownames(meta)))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">txi &lt;- tximport(files, type=</span><span><span leaf="">"salmon"</span></span><span leaf="">, tx2gene=tx2gene)</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">DESeq2 + lfcShrink</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">dds &lt;- DESeqDataSetFromTximport(txi, meta, design=~group)</span><span leaf=""><br></span><span leaf="">dds$group &lt;- relevel(dds$group, ref=</span><span><span leaf="">"SPF"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">dds &lt;- DESeq(dds)</span><span leaf=""><br></span><span leaf="">dds &lt;- nbinomWaldTest(dds)</span><span leaf=""><br></span><span leaf="">res.lm &lt;- lfcShrink(dds, coef=</span><span><span leaf="">"group_Lm_vs_SPF"</span></span><span leaf="">, type=</span><span><span leaf="">"apeglm"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-ratio="0.262037037037037" data-type="png" data-w="1080" data-imgfileid="100054754" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fz02N1rGgK9ltVSBZp6wT6vEyd0icUHZvuPKx0cKJQjZBcDaHn9ic8PNqA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fz02N1rGgK9ltVSBZp6wT6vEyd0icUHZvuPKx0cKJQjZBcDaHn9ic8PNqA/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">构建 GSEA geneList</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">tbl &lt;- as.data.frame(res.lm) %&gt;% rownames_to_column(</span><span><span leaf="">"geneid"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">geneList &lt;- tbl %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(</span><span leaf=""><br></span><span leaf="">    SYMBOL = mapIds(org.Mm.eg.db,</span><span leaf=""><br></span><span leaf="">      keys      = gsub(</span><span><span leaf="">"\\.[0-9]*"</span></span><span leaf="">, </span><span><span leaf="">""</span></span><span leaf="">, geneid),</span><span leaf=""><br></span><span leaf="">      keytype   = </span><span><span leaf="">"ENSEMBL"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">      column    = </span><span><span leaf="">"SYMBOL"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">      multiVals = </span><span><span leaf="">"first"</span></span><span leaf="">)) %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(!is.na(SYMBOL), !is.na(log2FoldChange)) %&gt;%</span><span leaf=""><br></span><span leaf="">  group_by(SYMBOL) %&gt;%</span><span leaf=""><br></span><span leaf="">  slice_max(abs(log2FoldChange), n=</span><span><span leaf="">1</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  ungroup() %&gt;%</span><span leaf=""><br></span><span leaf="">  arrange(desc(log2FoldChange)) %&gt;%</span><span leaf=""><br></span><span leaf="">  { setNames(.$log2FoldChange, .$SYMBOL) }</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">MSigDB hallmark 基因集</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">msig &lt;- msigdbr(species=</span><span><span leaf="">"Mus musculus"</span></span><span leaf="">, category=</span><span><span leaf="">"H"</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  dplyr::select(gs_name, gene_symbol) %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(gs_name = gsub(</span><span><span leaf="">"HALLMARK_"</span></span><span leaf="">, </span><span><span leaf="">""</span></span><span leaf="">, gs_name))</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">运行 GSEA</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">gsea.lm &lt;- GSEA(geneList= geneList,</span><span leaf=""><br></span><span leaf="">  TERM2GENE= msig,</span><span leaf=""><br></span><span leaf="">  pvalueCutoff = </span><span><span leaf="">0.2</span></span><span leaf="">,eps= </span><span><span leaf="">0</span></span><span leaf="">,seed= </span><span><span leaf="">TRUE</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">GSEAVis：多通路+基因标注</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">geneSetID &lt;- c(</span><span leaf=""><br></span><span leaf="">  </span><span><span leaf="">"ALLOGRAFT_REJECTION"</span></span><span leaf="">,</span><span leaf=""><br></span><span><span leaf="">"UNFOLDED_PROTEIN_RESPONSE"</span></span><span leaf="">,</span><span leaf=""><br></span><span><span leaf="">"E2F_TARGETS"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">highlight.genes &lt;- c(</span><span><span leaf="">"Cdkn2a"</span></span><span leaf="">,</span><span><span leaf="">"Ccr1"</span></span><span leaf="">,</span><span><span leaf="">"Aldh18a1"</span></span><span leaf="">,</span><span><span leaf="">"Mcm5"</span></span><span leaf="">,</span><span><span leaf="">"Cd28"</span></span><span leaf="">,</span><span><span leaf="">"Dnmt1"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">gseaNb(object= gsea.lm,geneSetID= geneSetID,</span><span leaf=""><br></span><span leaf="">  subPlot= </span><span><span leaf="">2</span></span><span leaf="">,termWidth= </span><span><span leaf="">35</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  addGene = highlight.genes,</span><span leaf=""><br></span><span leaf="">  addPval = </span><span><span leaf="">T</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  pvalX = </span><span><span leaf="">0.2</span></span><span leaf="">,pvalY = </span><span><span leaf="">0.05</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  legend.position= c(</span><span><span leaf="">0.8</span></span><span leaf="">,</span><span><span leaf="">0.8</span></span><span leaf="">))</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">关注下方公众号下回更新不迷路</span></span><span></span></h3><section><mp-common-profile data-pluginname="mpprofile" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-from="0" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-id="Mzg3MzQzNTYzMw==" data-service_type="1" data-verify_status="0"></mp-common-profile></section><blockquote><span><span leaf="">❝</span></span><p><span leaf="">本节介绍到此结束，最近依然有不少读者想购买小编之前写的R绘图文档，因此在附上一下购买方式及所能提供的服务具体如下：</span><strong><span leaf="">以往的交流群已经满员不在考虑建立新群，因此只会通过公众号后台发送腾讯文档链接</span></strong></p></blockquote><p data-tool="mdnice编辑器"><strong><span leaf="">1.内容更新截止2025年/12月/31日结束，后期无任何更新。</span></strong><span leaf=""><br></span><strong><span leaf="">2.只分享案例内容，无答疑。</span></strong><span leaf=""><br></span><strong><span leaf="">3.内容只包含R语言绘图内容，无任何生信分析全套代码，有过高期望者不要买。</span></strong><span leaf=""><br></span><strong><span leaf="">4.有充足时间者可以考虑继续等待，2026年会正式出版R语言绘图相关的书籍</span></strong></p><blockquote><span><span leaf="">❝</span></span><p><span leaf="">若上述几点都可以接受，欢迎付费购买此文档，购买后会通过公众号后台发送文档链接，通过在线腾讯文档分析案例清单，内附案例下载链接，案例代码文件夹支持下载到本地查看。只分享文档查看链接，</span><strong><span leaf="">无交流群，不添加任何联系方式</span></strong></p></blockquote><p data-tool="mdnice编辑器"><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247537380&amp;idx=1&amp;sn=7b952b84f02efaa68667ee110134e9db&amp;scene=21#wechat_redirect" textvalue="R绘图进阶实战｜ggplot2数百经典案例" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">R绘图进阶实战｜ggplot2数百经典案例</span></a></span><a href="https://mp.weixin.qq.com/s?__biz=Mzg3MzQzNTYzMw==&amp;mid=2247537380&amp;idx=1&amp;sn=7b952b84f02efaa68667ee110134e9db&amp;scene=21#wechat_redirect" imgurl="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAb0SUlyPxbez37AhpHWjuBBcapggRH3K55bzNFd3WkAOxNppXPpkdDqfWDGMH3vkR2zuPjAuEHRaQ/640?wx_fmt=png&amp;from=appmsg" linktype="image" tab="innerlink" data-itemshowtype="0" target="_blank" data-linktype="1"><span><img data-ratio="0.4255555555555556" data-w="900" data-type="png" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAb0SUlyPxbez37AhpHWjuBBcapggRH3K55bzNFd3WkAOxNppXPpkdDqfWDGMH3vkR2zuPjAuEHRaQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAb0SUlyPxbez37AhpHWjuBBcapggRH3K55bzNFd3WkAOxNppXPpkdDqfWDGMH3vkR2zuPjAuEHRaQ/640?wx_fmt=png&amp;from=appmsg"></span></a></p><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">在线目录大纲</span></span><span></span></h3><blockquote><span><span leaf="">❝</span></span><p><span leaf="">通过腾讯文档在线编辑，小编可实时进行bug注解，只要保证R软件及R包版本号与案例所示一致，无须担心代码运行报错问题。在线文档内附有案例代码下载链接</span></p></blockquote><figure data-tool="mdnice编辑器"><span leaf=""><img data-ratio="0.5333333333333333" data-type="png" data-w="1080" data-imgfileid="100054756" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fziagmTW0yUD6EtEnvB03L10eSvJ7Nh7h68PLkqoyfRvohektGBGZOITA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fziagmTW0yUD6EtEnvB03L10eSvJ7Nh7h68PLkqoyfRvohektGBGZOITA/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">html注释文档</span></span><span></span></h3><p data-tool="mdnice编辑器"><strong><span leaf="">从2025年起的除极个别案例外，其余案例图提供下方所示html注释文档非常方便查看</span></strong><span leaf=""><img data-ratio="0.8675925925925926" data-type="png" data-w="1080" data-imgfileid="100054762" data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fzkD0fQfT7V0WAE0RooxhuvRqREgIHxqVuiaXu5WJoKs3knfTq5aBaQdw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZictiaIPXdvEkzpw3AQHE7fzkD0fQfT7V0WAE0RooxhuvRqREgIHxqVuiaXu5WJoKs3knfTq5aBaQdw/640?wx_fmt=png&amp;from=appmsg"></span></p></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ow0qIy0lZc4qdFtrywsZQg",target="_blank" rel="noopener noreferrer">原文链接</a>
