---
title: "画个同款新奇的“Galaxy”星系UMAP图（Nat Immunol：IF27.8）"
date: 2025-02-25T03:04:20Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
画个同款新奇的“Galaxy”星系UMAP图（Nat Immunol：IF27.8） by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span>前面我们已经介绍了如何在umap图上加圈：</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247537290&amp;idx=1&amp;sn=ad76831349df67bb5236370dab088536&amp;scene=21#wechat_redirect" data-linktype="2">给你的单细胞umap图加个cell杂志同款的圈</a><span>，以及绘制星系umap图：</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247536822&amp;idx=1&amp;sn=5f695d4ee6d8ba00a0961c02c4cf83bd&amp;scene=21#wechat_redirect" data-linktype="2">5种方式美化你的单细胞umap散点图</a><span>，那两者组合起来呢？今天学习的这个好看的图来自文献《<strong>The aged tumor microenvironment limits T cell control of cancer</strong>》，<strong>于2024年6月25日发表在Nat Immunol杂志上（IF27.8）</strong>。如下：</span></p><p data-tool="mdnice编辑器"><span>颜色的深浅表示细胞密度，圈内为不同的细胞类型</span>，左边为年轻组，右边为老年组，可以看出 yong 和 old组两种截然不同的细胞浸润模式。</p><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100055111" data-ratio="0.6029593094944513" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyBjagLf1OaZSr7H56xDINZJNoiayIZDvnNeydEluDSqJwygWOD797jQyA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="811" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyBjagLf1OaZSr7H56xDINZJNoiayIZDvnNeydEluDSqJwygWOD797jQyA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">图注：</p><blockquote data-tool="mdnice编辑器"><span></span><p>Fig. 1 ∣. Aging promotes tumor growth and alters CD8+ T cell fate and effector function. . e, Galaxy plots depicting the cell density in UMAP space fortumor-infiltrating CD8+ T cells from young (left) and aged (right) tumor-bearing mice.  <span>Cooler colors indicate low density, and warmer colors indicate high density</span>. The relative proportion of CD8+ T cells from young (blue, n = 5) and aged (red, n = 5) tumors within TProg, TTerm, dividing T (TDivi) and TTAD cell clusters is shown。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>示例数据</span><span></span></h2><p data-tool="mdnice编辑器">使用的数据还是自 <strong>GSE128531</strong> 数据注释后的seurat对象，你自己用的时候可以使用任何一个经过了注释后的seurat对象。</p><pre data-tool="mdnice编辑器"><span></span><code><span>###</span><br><span>### Create: Jianming Zeng</span><br><span>### Date:  2023-12-31  </span><br><span>### Email: jmzeng1314@163.com</span><br><span>### Blog: http://www.bio-info-trainee.com/</span><br><span>### Forum:  http://www.biotrainee.com/thread-1376-1-1.html</span><br><span>### CAFS/SUSTC/Eli Lilly/University of Macau</span><br><span>### Update Log: 2023-12-31   First version </span><br><span>### Update Log: 2024-12-09   by juan zhang (492482942@qq.com)</span><br><span>### </span><br><br>rm(list=ls())<br>library(COSG)<br>library(harmony)<br>library(ggsci)<br>library(dplyr) <br>library(future)<br>library(Seurat)<br>library(clustree)<br>library(cowplot)<br>library(data.table)<br>library(dplyr)<br>library(ggplot2)<br>library(patchwork)<br>library(stringr)<br>library(qs)<br><br><span># 导入数据</span><br>sce.all.int &lt;- readRDS(<span>'2-harmony/sce.all_int.rds'</span>)<br>sp &lt;- <span>'human'</span><br>head(sce.all.int@meta.data)<br>load(<span>"phe.Rdata"</span>)<br>head(phe)<br>sce.all.int &lt;- AddMetaData(sce.all.int, metadata = phe)<br><br>Idents(sce.all.int) &lt;- <span>"celltype"</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>先画银河中星系</span><span></span></h2><p data-tool="mdnice编辑器">用的 ggpointdensity 包，绘制不同的细胞密度：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247536822&amp;idx=1&amp;sn=5f695d4ee6d8ba00a0961c02c4cf83bd&amp;scene=21#wechat_redirect" data-linktype="2">5种方式美化你的单细胞umap散点图</a></p><pre data-tool="mdnice编辑器"><span></span><code>library(ggpointdensity)<br><span># 提取数据</span><br><span># dat &lt;- Embeddings(sce.all.int, reduction = "umap")</span><br><span># head(dat)</span><br><br>dat &lt;- FetchData(object=sce.all.int, vars=c(<span>"umap_1"</span>,<span>"umap_2"</span>,<span>"celltype"</span>))<br>head(dat)<br><br>p &lt;- ggplot(data = dat, mapping = aes(x = umap_1, y = umap_2)) +<br>  geom_pointdensity() +<br>  scale_color_viridis_c(option=<span>"inferno"</span>, alpha = 0.4) + <br>  theme_classic(base_size = 15) <br>p<br></code></pre><p data-tool="mdnice编辑器">结果如下：</p><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100055110" data-ratio="0.7692307692307693" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyBew5aiaWcqUQeKJX9eHtHQkqBp1hmFB69h5MYQzgULJib3JsEdxf6Hribw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="624" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyBew5aiaWcqUQeKJX9eHtHQkqBp1hmFB69h5MYQzgULJib3JsEdxf6Hribw/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>添加银河黑暗背景</span><span></span></h2><p data-tool="mdnice编辑器">这里简单的调整ggplot主题：</p><pre data-tool="mdnice编辑器"><span></span><code>p1 &lt;- p +<br>  labs(color=<span>'Density'</span>) +  <span># 设置图例标题 </span><br>  theme(<br>    panel.background = element_rect(fill = <span>"black"</span>, color = <span>"black"</span>),  <span># 设置坐标轴内区域背景颜色为黑色</span><br>    plot.background = element_rect(fill = <span>"white"</span>, color = <span>"white"</span>),  <span># 设置整个图形背景颜色为白色</span><br>    panel.grid.major = element_blank(),  <span># 去掉主要的网格线</span><br>    panel.grid.minor = element_blank(),  <span># 去掉次要的网格线</span><br>    axis.line = element_line(color = <span>"white"</span>),  <span># 设置坐标轴线颜色为白色</span><br>    axis.text = element_text(color = <span>"white"</span>),  <span># 设置坐标轴文本颜色为白色</span><br>    axis.ticks = element_line(color = <span>"white"</span>),  <span># 设置坐标轴刻度颜色为白色</span><br>    axis.title = element_text(color = <span>"white"</span>),  <span># 设置坐标轴标题文本颜色为白色</span><br>    legend.background = element_blank(),  <span># 设置图例背景为透明</span><br>    legend.key = element_blank(),  <span># 设置图例键为透明</span><br>    legend.text = element_text(color = <span>"white"</span>),  <span># 设置图例文本颜色为白色</span><br>    legend.title = element_text(color = <span>"black"</span>))  <span># 设置图例标题文本颜色为白色</span><br>  <br>p1<br></code></pre><p data-tool="mdnice编辑器">结果如下：</p><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100055108" data-ratio="0.826955074875208" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyB4wcHATEGEPAcgjpmL5QdicGY2icRaqWGx9NEM61nCZMUe1kKD3UEXfoA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="601" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyB4wcHATEGEPAcgjpmL5QdicGY2icRaqWGx9NEM61nCZMUe1kKD3UEXfoA/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>加圈圈住</span><span></span></h2><p data-tool="mdnice编辑器">上次介绍的办法：mascarade 包，<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247537290&amp;idx=1&amp;sn=ad76831349df67bb5236370dab088536&amp;scene=21#wechat_redirect" data-linktype="2">给你的单细胞umap图加个cell杂志同款的圈</a></p><pre data-tool="mdnice编辑器"><span></span><code><span># 加圈</span><br>library(mascarade)<br><br><span># 制作masktable</span><br><span># smoothSigma = 0.05：控制加圈的平滑成都，值越大加的圈越平滑</span><br><span># minDensity ：控制 加圈的松紧成都，值越小，加的圈边界与umap散点距离越大越宽松</span><br>maskTable &lt;- generateMask( dims=dat[,1:2], cluster=dat<span>$celltype</span>, minDensity = 15,smoothSigma = 0.1 )<br>class(maskTable)<br>dim(maskTable)<br>head(maskTable)<br><br>p2 &lt;- p1 + <br>  geom_path(data=maskTable, aes(group=group),linewidth=0.6,linetype = 2, colour = <span>"white"</span>)<br>p2<br>ggsave(filename = <span>"Galaxy_UMP.pdf"</span>, width = 7.8, height = 6.5, plot = p2)<br></code></pre><p data-tool="mdnice编辑器">结果如下：</p><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100055107" data-ratio="0.7944732297063903" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyBQVd5KDkIG5HarHFpiaRicTuvaewzEG8KNscLY49ToibJE0u5qHp0aCn1Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="579" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyBQVd5KDkIG5HarHFpiaRicTuvaewzEG8KNscLY49ToibJE0u5qHp0aCn1Q/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>PPT修饰</span><span></span></h2><p data-tool="mdnice编辑器">这里没有找到很好的办法加上细胞标签，用ppt好了，最终结果如下：</p><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100055109" data-ratio="0.797940797940798" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyBiayicyNfrkTqOm0zuEmhgGbElicNfwdDfdicFJVmCKLbgxI811NkXxMmIA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="777" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wy3z6OibpLjMxfEqzjMIKYyBiayicyNfrkTqOm0zuEmhgGbElicNfwdDfdicFJVmCKLbgxI811NkXxMmIA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">完美~，绘图小技巧开了新群，感兴趣的可以进：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247538699&amp;idx=1&amp;sn=871cb62f043fc30e1996066dc50430dd&amp;scene=21#wechat_redirect" data-linktype="2">绘图小技巧2025交流群</a>。</p><h3 data-tool="mdnice编辑器"><span></span><span></span><span><strong>文末友情宣传</strong></span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247538467&amp;idx=1&amp;sn=aa5500b24a92b86355c242d02e742f1b&amp;scene=21#wechat_redirect" data-linktype="2">生信入门&amp;数据挖掘线上直播课3月班</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" data-linktype="2">时隔5年，我们的生信技能树VIP学徒继续招生啦</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247535760&amp;idx=2&amp;sn=1e02a2e982a046ecf6389231e6768d5b&amp;scene=21#wechat_redirect" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></section></li></ul></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/CljLXy9au2sjm4sR_gp9wQ",target="_blank" rel="noopener noreferrer">原文链接</a>
