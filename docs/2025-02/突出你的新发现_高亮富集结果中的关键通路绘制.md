---
title: "突出你的新发现：高亮富集结果中的关键通路绘制"
date: 2025-02-28T08:46:42Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
突出你的新发现：高亮富集结果中的关键通路绘制 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>今天来学习一篇于2024年12月30日发表在Nature Communications上的文献，标题为：《<strong>Integrated multi-omics profiling reveals neutrophil extracellular traps potentiate Aortic dissection progression</strong>》。这个文献中的双向富集结果展示了 Scissor+ cells 与 Scissor- cells 差异分析后GO BP富集结果，并高亮了通路中的关键通路：中性粒细胞的激活、趋化和脱颗粒。</p></blockquote><p data-tool="mdnice编辑器"><span>这个文章给我们提供了一种筛选与疾病高度相关的细胞亚群方法，即Scissor算法，它利用单细胞数据和 bulk RNA-seq 数据及表型信息识别与疾病高度相关的细胞亚群。</span>关于什么是 Scissor+ cells 细胞以及 如何鉴定 Scissor+ cells 与 Scissor- cells，我们下期介绍，前面生信技能树也有相关介绍的贴子：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247510495&amp;idx=1&amp;sn=e5fff63aed5568e47f8a52c23bd77a58&amp;scene=21#wechat_redirect" data-linktype="2">寻找表型特异性单细胞亚群的工具Scissor</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247520158&amp;idx=2&amp;sn=47c80d140c2994d0575c24605cd914b4&amp;scene=21#wechat_redirect" data-linktype="2">整合单细胞数据和Bulk数据的多种方法（二）：R包Scissor</a></section></li></ul><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100054569" data-ratio="0.581668625146886" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1X8YFNoI14fO47Ktt6M6gsJLgTphghElbAwkKZMNF8vVObZGe1ExknGg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="851" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1X8YFNoI14fO47Ktt6M6gsJLgTphghElbAwkKZMNF8vVObZGe1ExknGg/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span></span><p>Fig. 2 | A phenotype-associated macrophage subset orchestrates neutrophil within aortic microenvironment. F A bar plot of the GO enrichment of biological processes showing the significantly enriched pathways in Scissor+ cells.</p></blockquote><h4 data-tool="mdnice编辑器"><span></span><span>今天先来绘制上面的富集结果双向通路图，并熟悉文章数据背景，分析思路。</span><span></span></h4><h2 data-tool="mdnice编辑器"><span></span><span>数据背景</span><span></span></h2><p data-tool="mdnice编辑器">作者的样本采样以及数据组学思路如下，这里作者还做了预实验蛋白组学：</p><figure data-tool="mdnice编辑器"><img alt="image-20250212184910682" data-imgfileid="100054567" data-ratio="0.28888888888888886" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1XCvsEVTarSJ5MpJkjA4lSaNvTKvDBrL3j76TTfdoRoo2LRPRpjF5APA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1XCvsEVTarSJ5MpJkjA4lSaNvTKvDBrL3j76TTfdoRoo2LRPRpjF5APA/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20250212184910682</figcaption></figure><p data-tool="mdnice编辑器">其中单细胞数据来自三名健康个体和三名急性主动脉夹层（AD）患者的主动脉。数据为：<span>https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE254132</span>。</p><p data-tool="mdnice编辑器">下载并解压之后的文件如下：</p><pre data-tool="mdnice编辑器"><span></span><code>.<br>├── ATAD1<br>│   ├── barcodes.tsv.gz<br>│   ├── features.tsv.gz<br>│   ├── matrix.mtx.gz<br>│   └── web_summary.html<br>├── ATAD2<br>│   ├── barcodes.tsv.gz<br>│   ├── features.tsv.gz<br>│   ├── matrix.mtx.gz<br>│   └── web_summary.html<br>├── ATAD3<br>│   ├── barcodes.tsv.gz<br>│   ├── features.tsv.gz<br>│   ├── matrix.mtx.gz<br>│   └── web_summary.html<br>├── NA1<br>│   ├── barcodes.tsv.gz<br>│   ├── features.tsv.gz<br>│   ├── matrix.mtx.gz<br>│   └── web_summary.html<br>├── NA2<br>│   ├── barcodes.tsv.gz<br>│   ├── features.tsv.gz<br>│   ├── matrix.mtx.gz<br>│   └── web_summary.html<br>└── NA3<br>    ├── barcodes.tsv.gz<br>    ├── features.tsv.gz<br>    └── matrix.mtx.gz<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>数据简单处理并分析</span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span></span><span>1、先读取并创建Seurat对象：</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>###</span><br><span>### Create: Jianming Zeng</span><br><span>### Date:  2023-12-31  </span><br><span>### Email: jmzeng1314@163.com</span><br><span>### Blog: http://www.bio-info-trainee.com/</span><br><span>### Forum:  http://www.biotrainee.com/thread-1376-1-1.html</span><br><span>### CAFS/SUSTC/Eli Lilly/University of Macau</span><br><span>### Update Log: 2023-12-31   First version </span><br><span>### Update Log: 2024-12-09   by juan zhang (492482942@qq.com)</span><br><span>### </span><br><br>rm(list=ls())<br>options(stringsAsFactors = F)<br>library(ggsci)<br>library(dplyr) <br>library(future)<br>library(Seurat)<br>library(clustree)<br>library(cowplot)<br>library(data.table)<br>library(ggplot2)<br>library(patchwork)<br>library(stringr)<br>library(qs)<br>library(Matrix)<br>getwd()<br><br><span># 创建目录</span><br>getwd()<br>gse &lt;- <span>"GSE254132"</span><br>dir.create(gse)<br><br><span># 下载raw文件夹</span><br><span># https://ftp.ncbi.nlm.nih.gov/geo/series/GSE163nnn/GSE163558/suppl/GSE163558_RAW.tar</span><br><span># 使用正则表达式替换：\w{3}$ 匹配每个单词最后的三个字符替换为空字符串，即去掉它们</span><br>s &lt;- gsub(<span>"(\\w{3}$)"</span>, <span>""</span>, gse, perl = TRUE)<br>s<br>file &lt;- paste0(gse,<span>"_RAW.tar"</span>)<br>file<br>url &lt;- paste0(<span>"https://ftp.ncbi.nlm.nih.gov/geo/series/"</span>,s,<span>"nnn/"</span>,gse,<span>"/suppl/"</span>,gse,<span>"_RAW.tar"</span>)<br>url<br><span>#downloader::download(url, destfile = file)</span><br><br><span># 方式一：标准文件夹</span><br><span>###### step1: 导入数据 ######   </span><br>samples &lt;- list.dirs(<span>"GSE254132/"</span>, recursive = F, full.names = F)<br>samples<br>scRNAlist &lt;- lapply(samples, <span>function</span>(pro){<br>  <span>#pro &lt;- samples[1]</span><br>  <span>print</span>(pro)<br>  folder &lt;- file.path(<span>"GSE254132/"</span>, pro)<br>  folder<br>  counts &lt;- Read10X(folder, gene.column = 2)<br>  sce &lt;- CreateSeuratObject(counts, project=pro)<br>  <span>return</span>(sce)<br>})<br>names(scRNAlist) &lt;-  samples<br>scRNAlist<br><br><span># merge</span><br>sce.all &lt;- merge(scRNAlist[[1]], y=scRNAlist[-1], add.cell.ids=samples)<br>sce.all &lt;- JoinLayers(sce.all) <span># seurat v5</span><br>sce.all<br><br><span># 查看特征</span><br>as.data.frame(sce.all@assays<span>$RNA</span><span>$counts</span>[1:10, 1:2])<br>head(sce.all@meta.data, 10)<br>table(sce.all<span>$orig</span>.ident) <br><br>library(qs)<br>qsave(sce.all, file=<span>"GSE254132/sce.all.qs"</span>)<br></code></pre><p data-tool="mdnice编辑器">共得到 53864  个细胞，然后简单质控并降维聚类分群，得到如下注释结果：</p><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100054570" data-ratio="0.7932551319648093" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1Xhgbvm5G4uicJAwN8YZLVUxibb0bu9YmVC0CUtsnN2GZ6LNycibvJcpFNQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="682" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1Xhgbvm5G4uicJAwN8YZLVUxibb0bu9YmVC0CUtsnN2GZ6LNycibvJcpFNQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>2、功能富集分析</span><span></span></h3><p data-tool="mdnice编辑器">我这里还没有做完 Scissor+ cells 细胞的鉴定，所以本次就随意提取巨噬细胞，分析巨噬细胞在 二分组：健康和急性主动脉夹层（AD）的组间差异并进行功能富集分析，得到一个富集结果用于绘图。</p><pre data-tool="mdnice编辑器"><span></span><code><span># 加载包</span><br>library(org.Hs.eg.db)<br>library(clusterProfiler)<br>library(ggplot2)<br><span># 得到 疾病和正常对照组</span><br>table(sce.all.int<span>$orig</span>.ident)<br>sce.all.int<span>$group</span> &lt;- ifelse(grepl(<span>"ATAD"</span>, sce.all.int<span>$orig</span>.ident), <span>"ATAD"</span>, <span>"NA"</span>)<br>table(sce.all.int<span>$group</span>)<br>table(sce.all.int<span>$group</span>, sce.all.int<span>$orig</span>.ident)<br><br><span># 提取其中的巨噬细胞</span><br>sce_sub &lt;- subset(sce.all.int, idents = c(<span>"Macrophage"</span>))<br>sce_sub<br>Idents(sce_sub) &lt;- <span>"group"</span><br><br><span># 组间差异分析</span><br>sce.sub.markers &lt;- FindMarkers(sce_sub, ident.1 = <span>"ATAD"</span>, ident.2 = <span>"NA"</span>, logfc.threshold = 0.25, min.pct = 0.1)<br>sce.sub.markers &lt;- sce.sub.markers[sce.sub.markers<span>$p_val_adj</span> &lt; 0.01, ]<br>sce.sub.markers<span>$name</span> &lt;- rownames(sce.sub.markers)<br>sce.sub.markers<span>$g</span> &lt;- ifelse(sce.sub.markers<span>$avg_log2FC</span>&gt;0, <span>"up"</span>, <span>"down"</span>)<br>head(sce.sub.markers)<br>table(sce.sub.markers<span>$g</span>)<br><br><br><span># 基因转成ENTREZID</span><br>ids &lt;- bitr(sce.sub.markers<span>$name</span>, fromType = <span>"SYMBOL"</span>,toType = <span>"ENTREZID"</span>, OrgDb = <span>"org.Hs.eg.db"</span>)<br>head(ids)<br><span># 合并ENTREZID到obj.markers中</span><br>data &lt;- merge(sce.sub.markers, ids, by.x=<span>"name"</span>, by.y=<span>"SYMBOL"</span>)<br>head(data)<br>gcSample &lt;- split(data<span>$ENTREZID</span>, data<span>$g</span>)<br>str(gcSample)<br><br><span>## 富集分析 </span><br><span># KEGG</span><br><span># xx_kegg &lt;- compareCluster(gcSample, fun="enrichKEGG", organism="hsa", pvalueCutoff=1, qvalueCutoff=1)</span><br><span># GO</span><br>xx_go &lt;- compareCluster(gcSample, fun=<span>"enrichGO"</span>, OrgDb=<span>"org.Hs.eg.db"</span>, ont=<span>"BP"</span>, pvalueCutoff=1, qvalueCutoff=1)<br>res &lt;- xx_go@compareClusterResult<br>head(res)<br><br><span>## 将富集结果中的 ENTREZID 重新转为 SYMBOL</span><br>Symbol &lt;- mapIds(get(<span>"org.Hs.eg.db"</span>), keys = sce.sub.markers<span>$name</span>, keytype = <span>"SYMBOL"</span>, column=<span>"ENTREZID"</span>)<br>head(Symbol)<br><span>for</span> (i <span>in</span> 1:dim(res)[1]) {<br>  arr = unlist(strsplit(as.character(res[i,<span>"geneID"</span>]), split=<span>"/"</span>))<br>  gene_names = paste(unique(names(Symbol[Symbol %<span>in</span>% arr])), collapse=<span>"/"</span>)<br>  res[i,<span>"geneID"</span>] = gene_names<br>}<br>head(res)<br></code></pre><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100054566" data-ratio="0.1574074074074074" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1XUKLpEQym1e6ia2F2NENUFXUPwiaocJS3Eykbt3deVI7Q4qOdDYtwUE6Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1XUKLpEQym1e6ia2F2NENUFXUPwiaocJS3Eykbt3deVI7Q4qOdDYtwUE6Q/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>3、绘制</span><span></span></h3><p data-tool="mdnice编辑器">还是大家喜欢的ggplot2定制化绘图，先提取绘图数据并简单处理：高亮其实很简单，一个颜色向量里面设置关注通路的颜色为红色</p><pre data-tool="mdnice编辑器"><span></span><code><span>## 通路筛选Top10</span><br>enrich &lt;- res %&gt;% <br>  group_by(Cluster) %&gt;% <br>  top_n(n = 10, wt = -pvalue) <br>  <br><span># 绘图数据</span><br>dt &lt;- enrich<br><span># 通路排序</span><br>dt &lt;- dt[order(dt<span>$Cluster</span>,dt<span>$pvalue</span>, decreasing = F), ]<br>dt<span>$Description</span> &lt;- factor(dt<span>$Description</span>, levels = rev(unique(dt<span>$Description</span>)))<br>dt<span>$Cluster</span> &lt;- factor(dt<span>$Cluster</span>, levels = c(<span>"up"</span>,<span>"down"</span>))<br><br><span># 得到双向横坐标，上调的应该在右边，乘以一个正值</span><br>dt<span>$lable</span> &lt;- ifelse(dt<span>$Cluster</span>==<span>"up"</span>, 1, -1)<br>dt<span>$pvalue_loc</span> &lt;- -log10(dt<span>$pvalue</span>)<br>dt<span>$pvalue_loc</span> &lt;- dt<span>$pvalue_loc</span> * dt<span>$lable</span><br>head(dt)<br><br><span># 调整添加的y轴方向通路的对其方式</span><br>dt<span>$lable_hjust</span> &lt;- ifelse(dt<span>$Cluster</span>==<span>"up"</span>, 1, 0)<br><span># 对其的x轴起点，上调通路在x轴左边，起点隔0.5, 避免与柱子粘在一起</span><br>dt<span>$lable_xloc</span> &lt;- ifelse(dt<span>$Cluster</span>==<span>"up"</span>, -0.5, 0.5)<br><br><span># 设置通路高亮颜色，这里随便选了三条通路进行高亮，标为红色</span><br>dt<span>$label_color</span> &lt;- <span>"black"</span><br>dt<span>$label_color</span>[1:3] &lt;- <span>"red"</span><br><br>head(dt)<br>summary(dt<span>$pvalue_loc</span>)<br></code></pre><p data-tool="mdnice编辑器">绘图，条形图：</p><pre data-tool="mdnice编辑器"><span></span><code><span>## 绘图</span><br>color &lt;- c(up=<span>"#e15759"</span>, down=<span>"#586ea6"</span>)<br>color<br><br>p &lt;- ggplot(dt, aes(x = pvalue_loc, y = Description, fill = Cluster)) + <br>  geom_bar(<span>stat</span> = <span>"identity"</span>,color=<span>"black"</span>, width = 0.6) + <span># 绘制条形图，边框为黑色</span><br>  scale_fill_manual(values = color) +<br>  scale_x_continuous(limits = c(-34,34)) + <br>  geom_text(data = dt, aes(x=lable_xloc, y = Description, label = Description, hjust = lable_hjust), <br>            color=dt<span>$label_color</span>, size = 4.5) +  <span># 添加通路名称</span><br>  labs(x=<span>"Log10(pvalue)"</span>, y=NULL, title=<span>""</span>) +<br>  annotate(<span>"text"</span>, x = 25,  y = 15, label = <span>"Up"</span>, size=6, fontface = <span>"bold"</span>, color=<span>"black"</span>) +<br>  annotate(<span>"text"</span>, x = -25, y =5, label = <span>"Down"</span>, size=6, fontface = <span>"bold"</span>, color=<span>"black"</span>) +<br>  theme_classic() +<br>  theme( axis.text.x = element_text(size = 15),<br>    axis.title.x = element_text(size = 15),<br>    axis.text.y = element_blank(), <span># 不显示Y轴标签</span><br>    axis.line.y = element_blank(),<br>    axis.ticks.y = element_blank(),<br>    legend.position = <span>'none'</span> )<br>p<br>ggsave(filename = <span>"Enrich_cometplot.pdf"</span>, width = 12, height = 6, plot = p)<br></code></pre><p data-tool="mdnice编辑器">结果如下：</p><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100054568" data-ratio="0.49246231155778897" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1XHibMcK9CdiacYhuO2QemOJrSzB33qxvfX1sJLYEmicmjaCrVb4ze3oxDw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="995" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1XHibMcK9CdiacYhuO2QemOJrSzB33qxvfX1sJLYEmicmjaCrVb4ze3oxDw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">看文献时，突然想起导师的日常灵魂发问，深入骨髓那种：这个文章做了什么？如何做的？结论是什么？<span><strong>这个文章你觉得最有意思的地方在哪？</strong></span></p><p data-tool="mdnice编辑器">嗯，我觉得文章中如何使用 Scissor算法鉴定与 急性主动脉夹层相关的细胞亚群这个地方比较有意思。这种细胞亚群鉴定出来后，我可以看看他具体是什么细胞类型，他是倾向于一种细胞亚群比如T细胞都是 Scissor+细胞呢还是T细胞里面只有一部分是？如果是后者，他有什么比较特殊的特征吗？这一群细胞可能会发挥什么作用呢？下期，我们来学习！</p><figure data-tool="mdnice编辑器"><img alt="" data-imgfileid="100054575" data-ratio="0.4352701325178389" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1XASdRNUibIyJUa4u4N4Nl3lv8Hy8XRRtK7WTsIsibX4ytwzbialB0WOlPg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="981" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwrZv4thetZicOSn7KaCUn1XASdRNUibIyJUa4u4N4Nl3lv8Hy8XRRtK7WTsIsibX4ytwzbialB0WOlPg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span><strong>友情宣传</strong></span><span></span></h3><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247527230&amp;idx=1&amp;sn=7156afcd5ab734c7d391b9048695747a&amp;scene=21#wechat_redirect" data-linktype="2">生信入门&amp;数据挖掘线上直播课2025年1月班</a></p><p data-tool="mdnice编辑器"><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" data-linktype="2">时隔5年，我们的生信技能树VIP学徒继续招生啦</a></p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247535760&amp;idx=2&amp;sn=1e02a2e982a046ecf6389231e6768d5b&amp;scene=21#wechat_redirect" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/w5IcRAfUwPI2CHYhzNOn0Q",target="_blank" rel="noopener noreferrer">原文链接</a>
