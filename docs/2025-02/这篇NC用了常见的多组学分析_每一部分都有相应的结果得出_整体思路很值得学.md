---
title: "è¿™ç¯‡NCç”¨äº†å¸¸è§çš„å¤šç»„å­¦åˆ†æï¼Œæ¯ä¸€éƒ¨åˆ†éƒ½æœ‰ç›¸åº”çš„ç»“æœå¾—å‡ºï¼Œæ•´ä½“æ€è·¯å¾ˆå€¼å¾—å­¦"
date: 2025-02-11T00:12:21Z
draft: ["false"]
tags: [
  "fetched",
  "ç”Ÿä¿¡é’±åŒå­¦"
]
categories: ["Acdemic"]
---
è¿™ç¯‡NCç”¨äº†å¸¸è§çš„å¤šç»„å­¦åˆ†æï¼Œæ¯ä¸€éƒ¨åˆ†éƒ½æœ‰ç›¸åº”çš„ç»“æœå¾—å‡ºï¼Œæ•´ä½“æ€è·¯å¾ˆå€¼å¾—å­¦ by ç”Ÿä¿¡é’±åŒå­¦
------
<div><p><span><strong>ä¹Ÿä¸ç”¨åšå•ç»†èƒçš„å¤šç»„å­¦å¤šè´µå•Šï¼Œè¿™ä¸ªå¤šç»„ç»„çš„è¿ç”¨çš„å°±å¾ˆå¥½ï¼Œæ¯ä¸€ç§ç»„å­¦ä¿¡æ¯éƒ½èƒ½å¾—å‡ºç›¸åº”çš„ç»“è®º</strong></span><br></p><p>è¿‘æ—¥ï¼Œä¸€é¡¹å‘è¡¨äº<span data-token-index="1">Nature Communications</span>çš„ç ”ç©¶é€šè¿‡å¤šç»„å­¦åˆ†æï¼Œ<span data-token-index="3">å¯¹ I æœŸéå°ç»†èƒè‚ºç™Œï¼ˆNSCLCï¼‰æœ¯åå¤å‘</span>çš„ç”Ÿç‰©å­¦æœºåˆ¶å’Œä¸´åºŠç®¡ç†è¿›è¡Œäº†æ·±å…¥æ¢ç©¶ï¼Œä¸ºè¯¥ç–¾ç—…çš„æ²»ç–—æä¾›äº†æ–°çš„æ€è·¯å’Œæ½œåœ¨ç­–ç•¥ã€‚è¯¥ç ”ç©¶ç”±å››å·å¤§å­¦åè¥¿åŒ»é™¢çš„å›¢é˜Ÿä¸»å¯¼ï¼Œç ”ç©¶æˆæœæœ‰æœ›æ”¹å˜ I æœŸ NSCLC çš„æ²»ç–—ç°çŠ¶ã€‚</p><p><img data-galleryid="" data-imgfileid="100008578" data-ratio="0.32037037037037036" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JOFe4FARnUe5n3OuDnHHz0aTTE2ChOfgr2UjacPQheMibEZECzoib8AVg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JOFe4FARnUe5n3OuDnHHz0aTTE2ChOfgr2UjacPQheMibEZECzoib8AVg/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008570" data-ratio="0.4601851851851852" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JevollxpcfXX6EedO7mXflz5B8wtFvOfSKEzzQ7rlOJe7g6ibdrF9hwg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JevollxpcfXX6EedO7mXflz5B8wtFvOfSKEzzQ7rlOJe7g6ibdrF9hwg/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008579" data-ratio="1.375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JKWFmySpMJ6luJicVcZeoWtAQLAX4qgzIgjuuZJoA0TNbpVyTVx83DDw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JKWFmySpMJ6luJicVcZeoWtAQLAX4qgzIgjuuZJoA0TNbpVyTVx83DDw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008571" data-ratio="0.39166666666666666" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6J2szibiac7RutT7Ywa2dfLCGFt4llKoKY4jZx4Yve1BGy4FKywcKFTGdw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6J2szibiac7RutT7Ywa2dfLCGFt4llKoKY4jZx4Yve1BGy4FKywcKFTGdw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008580" data-ratio="1.4" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JpBGLOpZXBicf8hzMLoZ2uOV08EZxuVx9WMgicM9PqEZXRQDj9AoyU6Sw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JpBGLOpZXBicf8hzMLoZ2uOV08EZxuVx9WMgicM9PqEZXRQDj9AoyU6Sw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008572" data-ratio="0.3814814814814815" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JOfd96hPBE9OqglBS2hicVQ953wqHP1iclRjIPKGyJZFknmjoGOnnuoHQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JOfd96hPBE9OqglBS2hicVQ953wqHP1iclRjIPKGyJZFknmjoGOnnuoHQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008581" data-ratio="0.9462962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JZTN4TY5htgibCdnbEUvqVS5wCjSUaEygNGA5vQ7vlDdJpsmlu9nqQiaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JZTN4TY5htgibCdnbEUvqVS5wCjSUaEygNGA5vQ7vlDdJpsmlu9nqQiaQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008573" data-ratio="0.3333333333333333" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JpwCmm8T0H4ibibiaib3hsxFTT3tCDNTCppozzq9ubnkoGW71L3m49OhBkQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JpwCmm8T0H4ibibiaib3hsxFTT3tCDNTCppozzq9ubnkoGW71L3m49OhBkQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008582" data-ratio="1.424074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jh3mnYxZSwPw7T7YqrysRIVHV0tu7G7IelR5cqAAgq3ofXmT7zibhiaMw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jh3mnYxZSwPw7T7YqrysRIVHV0tu7G7IelR5cqAAgq3ofXmT7zibhiaMw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008576" data-ratio="0.3851851851851852" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jz0cM4ia38fBFOEia9kaW6yAAla2gxY27WBzxt6GoB2VSB3icrmbdibjYBQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jz0cM4ia38fBFOEia9kaW6yAAla2gxY27WBzxt6GoB2VSB3icrmbdibjYBQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008583" data-ratio="1.2342592592592592" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6J5x1VNMngpPdG5sNQ93DAqbG0DRsCtLNuYeGDZGaWm68h0asE7V4PQA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6J5x1VNMngpPdG5sNQ93DAqbG0DRsCtLNuYeGDZGaWm68h0asE7V4PQA/640?wx_fmt=png&amp;from=appmsg"></p><p><span><strong>å¯ä»¥å­¦ä¹ ä¸‹<span data-token-index="0">éè´ŸçŸ©é˜µåˆ†è§£ï¼ˆNMFï¼‰ä¸ä¸´åºŠä¿¡æ¯å…³è”çš„éƒ¨åˆ†</span></strong><strong><span data-token-index="0">ï¼Œä¸é”™</span></strong></span><span data-token-index="0"></span></p><p><img data-galleryid="" data-imgfileid="100008577" data-ratio="0.3907407407407407" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jx4mnXeZZMUCVDyCNezicvr2oxnyxTss9gl46FdkgiaYsCdic1EEFVFFnQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jx4mnXeZZMUCVDyCNezicvr2oxnyxTss9gl46FdkgiaYsCdic1EEFVFFnQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008585" data-ratio="1.4157407407407407" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JT3kSQCc4tCrCzCx6iao6FYqa2CHQCQBSaWWvg3mCXVZG5fk6EszHzzA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JT3kSQCc4tCrCzCx6iao6FYqa2CHQCQBSaWWvg3mCXVZG5fk6EszHzzA/640?wx_fmt=png&amp;from=appmsg"></p><p>è¿˜æ˜¯å‰å‡ å¤©çš„ä»£ç ï¼Œç”»æ¡‘å‰å›¾</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><br></span></code><code><span><span>##########</span></span></code><code><span><span>### Load data</span></span></code><code><span><span>##########</span></span></code><code><span><br></span></code><code><span><span># å®šä¹‰å­˜å‚¨å›¾ç‰‡çš„ç›®å½•</span></span></code><code><span>figure_dir = <span>"paper_figures/revision_figures/"</span></span></code><code><span><span># åˆ›å»ºå›¾ç‰‡ç›®å½•ï¼Œå¦‚æœç›®å½•å·²å­˜åœ¨åˆ™ä¸æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯</span></span></code><code><span>dir.create(figure_dir, showWarnings = <span>FALSE</span>)</span></code><code><span><br></span></code><code><span><span># å¼•å…¥è‡ªå®šä¹‰çš„ç»˜å›¾å‡½æ•°è„šæœ¬</span></span></code><code><span>source(<span>"paper_figures/tree_plotting_functions.R"</span>)</span></code><code><span>source(<span>"paper_figures/celltype_heatmaps_functions.R"</span>)</span></code><code><span><br></span></code><code><span><span># å®šä¹‰äººç±»ä¸‹ä¸˜è„‘æ•°æ®çš„å­˜å‚¨è·¯å¾„</span></span></code><code><span>human_hypo_path = <span>"/beegfs/scratch/bruening_scratch/lsteuernagel/data/human_HYPOMAP_publication/"</span></span></code><code><span><span># åŠ è½½å¿…è¦çš„RåŒ…</span></span></code><code><span>library(Seurat)</span></code><code><span>library(tidyverse)</span></code><code><span>library(ggtree)</span></code><code><span><br></span></code><code><span><span># è¯»å–äººç±»ä¸‹ä¸˜è„‘åˆå¹¶æ•°æ®é›†</span></span></code><code><span>human_hypo_combined = readRDS(paste0(human_hypo_path, <span>"human_HYPOMAP.rds"</span>))</span></code><code><span><br></span></code><code><span><span>## extra colors:</span></span></code><code><span><span># ä»Okabe-Itoè°ƒè‰²æ¿ä¸­è·å–é¢œè‰²</span></span></code><code><span>short_palette = <span>as</span>.character(palette.colors(palette = <span>"Okabe-Ito"</span>))</span></code><code><span><span># ç§»é™¤ç°è‰²å’Œé»‘è‰²</span></span></code><code><span>short_palette = short_palette[!short_palette %in% c(<span>"#999999"</span>, <span>"#000000"</span>)]</span></code><code><span><span># åˆ›å»ºä¸€ä¸ªé¢œè‰²æ¸å˜å‡½æ•°</span></span></code><code><span>getOkabeItoPalette = colorRampPalette(short_palette)</span></code><code><span><br></span></code><code><span><span># åŠ è½½ç»†èƒç±»å‹åŒ¹é…ç»“æœ</span></span></code><code><span>matched_clusters_final = data.table::fread(<span>"merge_human_mouse_neurons/matched_clusters_scviCorPruned.tsv"</span>, data.table = F)</span></code><code><span><br></span></code><code><span><span>## mouse</span></span></code><code><span><span># è¯»å–å°é¼ ä¸‹ä¸˜è„‘å›¾è°±æ•°æ®ï¼Œè¯¥æ•°æ®å¯ä»æŒ‡å®šé“¾æ¥ä¸‹è½½</span></span></code><code><span>hypoMap = readRDS(<span>"/beegfs/scratch/bruening_scratch/lsteuernagel/data/hypoMap_publication/hypoMap.rds"</span>) <span># requires mouse HypoMap from: https://doi.org/10.17863/CAM.87955</span></span></code><code><span><br></span></code><code><span><span>##########</span></span></code><code><span><span>### Campbell comparison</span></span></code><code><span><span>##########</span></span></code><code><span><br></span></code><code><span><span># ä»…é€‰æ‹©C286è¿›è¡Œåˆ†æ</span></span></code><code><span><span># get C465 to Campbell &amp; subset to cell types matched to Campbell</span></span></code><code><span><span># ä»hypoMapçš„å…ƒæ•°æ®ä¸­ç­›é€‰å‡ºæ•°æ®é›†ä¸ºCampbellDropseqçš„æ•°æ®</span></span></code><code><span>cluster_matching = hypoMap@meta.data %&gt;%</span></code><code><span>  dplyr::filter(Dataset == <span>"CampbellDropseq"</span>) %&gt;%</span></code><code><span>  <span># æŒ‰ä½œè€…å®šä¹‰çš„ç»†èƒç±»å‹å’ŒC286å‘½åçš„èšç±»è¿›è¡Œåˆ†ç»„</span></span></code><code><span>  dplyr::group_by(Author_CellType, C286_named) %&gt;% </span></code><code><span>  <span># ç»Ÿè®¡æ¯ä¸ªåˆ†ç»„ä¸­çš„ç»†èƒæ•°é‡</span></span></code><code><span>  dplyr::count() %&gt;%</span></code><code><span>  <span># ç­›é€‰å‡ºç»†èƒæ•°é‡ä¸å°‘äº10çš„åˆ†ç»„</span></span></code><code><span>  dplyr::filter(n &gt;= <span>10</span>)</span></code><code><span><br></span></code><code><span><span># å°†å°é¼ èšç±»ä¸äººç±»èšç±»è¿›è¡ŒåŒ¹é…</span></span></code><code><span>cluster_matching = dplyr::left_join(cluster_matching, matched_clusters_final[, c(<span>"from"</span>, <span>"to_parent"</span>, <span>"similarity"</span>)], by = c(<span>"C286_named"</span> = <span>"to_parent"</span>)) %&gt;%</span></code><code><span>  <span># å–æ¶ˆåˆ†ç»„</span></span></code><code><span>  dplyr::ungroup() %&gt;%</span></code><code><span>  <span># æŒ‰C286å‘½åçš„èšç±»è¿›è¡Œåˆ†ç»„</span></span></code><code><span>  dplyr::group_by(C286_named) %&gt;%</span></code><code><span>  <span># é€‰æ‹©ç›¸ä¼¼åº¦æœ€é«˜çš„è®°å½•</span></span></code><code><span>  dplyr::slice_max(similarity, n = <span>1</span>, with_ties = F) %&gt;%</span></code><code><span>  <span># é‡å‘½ååˆ—å</span></span></code><code><span>  dplyr::rename(human_cluster = from, mouse_cluster = C286_named, Campbell_cluster = Author_CellType) %&gt;%</span></code><code><span>  <span># ç­›é€‰å‡ºåŒ…å«GABAæˆ–GLUçš„å°é¼ èšç±»</span></span></code><code><span>  dplyr::filter(grepl(<span>"GABA|GLU"</span>, mouse_cluster))</span></code><code><span><br></span></code><code><span><span># è®¡ç®—äººç±»æ¯ä¸ªèšç±»ä¸­çš„ç»†èƒæ•°é‡</span></span></code><code><span>human_cellcounts = human_hypo_combined@meta.data %&gt;% dplyr::group_by(C4_named) %&gt;% dplyr::count(name = <span>"nhuman"</span>)</span></code><code><span><span># å°†äººç±»ç»†èƒæ•°é‡ä¿¡æ¯æ·»åŠ åˆ°èšç±»åŒ¹é…ç»“æœä¸­</span></span></code><code><span>cluster_matching = dplyr::left_join(cluster_matching, human_cellcounts, by = c(<span>"human_cluster"</span> = <span>"C4_named"</span>))</span></code><code><span><br></span></code><code><span><span># å°†ç¼ºå¤±çš„Campbellèšç±»å’Œäººç±»èšç±»æ ‡è®°ä¸º"NA"</span></span></code><code><span>cluster_matching$Campbell_cluster[is.na(cluster_matching$Campbell_cluster)] = <span>"NA"</span></span></code><code><span>cluster_matching$human_cluster[is.na(cluster_matching$human_cluster)] = <span>"NA"</span></span></code><code><span><br></span></code><code><span><span># maybe reduced to C286</span></span></code><code><span><br></span></code><code><span><span># make 3 level sankey</span></span></code><code><span><br></span></code><code><span><span># compare with ARC clustering</span></span></code><code><span><br></span></code><code><span><span># Maybe pull out ARH clusters and re-run ?</span></span></code><code><span><br></span></code><code><span><span>##########</span></span></code><code><span><span>### Campbell comparison</span></span></code><code><span><span>##########</span></span></code><code><span><br></span></code><code><span><span># åŠ è½½networkD3åŒ…ç”¨äºç»˜åˆ¶æ¡‘åŸºå›¾</span></span></code><code><span>library(networkD3)</span></code><code><span><br></span></code><code><span><span>## using fun code</span></span></code><code><span><span># å®šä¹‰é“¾æ¥çš„æœ€å°ç»†èƒæ•°é‡é˜ˆå€¼</span></span></code><code><span>nlink = <span>40</span></span></code><code><span><span># ç­›é€‰å‡ºç»†èƒæ•°é‡ä¸å°‘äºnlinkçš„èšç±»åŒ¹é…ç»“æœ</span></span></code><code><span>sankey_edges = cluster_matching %&gt;% dplyr::filter(n &gt;= nlink)</span></code><code><span><span># å°†ç¼ºå¤±çš„Campbellèšç±»ã€å°é¼ èšç±»å’Œäººç±»èšç±»æ·»åŠ ç‰¹å®šçš„åç¼€</span></span></code><code><span>sankey_edges$Campbell_cluster[sankey_edges$Campbell_cluster == <span>"NA"</span>] = paste0(<span>"NA_campbell"</span>)</span></code><code><span>sankey_edges$mouse_cluster[sankey_edges$mouse_cluster == <span>"NA"</span>] = paste0(<span>"NA_mm"</span>)</span></code><code><span>sankey_edges$human_cluster[sankey_edges$human_cluster == <span>"NA"</span>] = paste0(<span>"NA_hs"</span>)</span></code><code><span><br></span></code><code><span><span># åˆ›å»ºåŒ…å«Campbellèšç±»çš„èŠ‚ç‚¹æ•°æ®æ¡†</span></span></code><code><span>sankey_nodes1 = data.frame(name = sankey_edges$Campbell_cluster, group = <span>"Campbell_cluster"</span>)</span></code><code><span><span># åˆ›å»ºåŒ…å«å°é¼ èšç±»çš„èŠ‚ç‚¹æ•°æ®æ¡†</span></span></code><code><span>sankey_nodes2 = data.frame(name = sankey_edges$mouse_cluster, group = <span>"mouse_cluster"</span>)</span></code><code><span><span># åˆ›å»ºåŒ…å«äººç±»èšç±»çš„èŠ‚ç‚¹æ•°æ®æ¡†</span></span></code><code><span>sankey_nodes3 = data.frame(name = sankey_edges$human_cluster, group = <span>"human_cluster"</span>)</span></code><code><span><br></span></code><code><span><span># åˆå¹¶æ‰€æœ‰èŠ‚ç‚¹æ•°æ®æ¡†ï¼Œå¹¶å»é™¤é‡å¤çš„èŠ‚ç‚¹</span></span></code><code><span>sankey_nodes &lt;- rbind(rbind(sankey_nodes3, sankey_nodes2), sankey_nodes1) %&gt;% </span></code><code><span>  dplyr::distinct(name, group) %&gt;% <span>as</span>.data.frame()</span></code><code><span><br></span></code><code><span><span># åˆ›å»ºäººç±»èšç±»åˆ°å°é¼ èšç±»çš„é“¾æ¥æ•°æ®æ¡†</span></span></code><code><span>sankey_edges1 = sankey_edges %&gt;% dplyr::select(NAMEsource = human_cluster, NAMEtarget = mouse_cluster, value = nhuman)</span></code><code><span><span># å°†ç¼ºå¤±çš„äººç±»ç»†èƒæ•°é‡è®¾ç½®ä¸º1</span></span></code><code><span>sankey_edges1$value[is.na(sankey_edges1$value)] = <span>1</span></span></code><code><span><span># å°†äººç±»ç»†èƒæ•°é‡å¤§äº1000çš„è®¾ç½®ä¸º1000</span></span></code><code><span>sankey_edges1$value[sankey_edges1$value &gt; <span>1000</span>] = <span>1000</span></span></code><code><span><span># å¯¹äººç±»ç»†èƒæ•°é‡è¿›è¡Œå½’ä¸€åŒ–</span></span></code><code><span>sankey_edges1$value = sankey_edges1$value / sum(sankey_edges1$value)</span></code><code><span><span># åˆ›å»ºå°é¼ èšç±»åˆ°Campbellèšç±»çš„é“¾æ¥æ•°æ®æ¡†</span></span></code><code><span>sankey_edges2 = sankey_edges %&gt;% dplyr::select(NAMEsource = mouse_cluster, NAMEtarget = Campbell_cluster, value = n)</span></code><code><span><span># å¯¹å°é¼ ç»†èƒæ•°é‡è¿›è¡Œå½’ä¸€åŒ–</span></span></code><code><span>sankey_edges2$value = sankey_edges2$value / sum(sankey_edges2$value)</span></code><code><span><span># åˆå¹¶æ‰€æœ‰é“¾æ¥æ•°æ®æ¡†</span></span></code><code><span>sankey_edges_b = rbind(sankey_edges1, sankey_edges2)</span></code><code><span><br></span></code><code><span><span># å°†é“¾æ¥æ•°æ®æ¡†ä¸­çš„æºèŠ‚ç‚¹å’Œç›®æ ‡èŠ‚ç‚¹åç§°è½¬æ¢ä¸ºèŠ‚ç‚¹æ•°æ®æ¡†ä¸­çš„ç´¢å¼•</span></span></code><code><span>sankey_edges_b$IDsource &lt;- match(sankey_edges_b$NAMEsource, sankey_nodes$name) - <span>1</span></span></code><code><span>sankey_edges_b$IDtarget &lt;- match(sankey_edges_b$NAMEtarget, sankey_nodes$name) - <span>1</span></span></code><code><span><span># å°†é“¾æ¥æ•°æ®æ¡†è½¬æ¢ä¸ºæ•°æ®æ¡†æ ¼å¼</span></span></code><code><span>sankey_edges_b = <span>as</span>.data.frame(sankey_edges_b)</span></code><code><span><br></span></code><code><span><span># ä¿å­˜é“¾æ¥æ•°æ®æ¡†åˆ°æ–‡ä»¶</span></span></code><code><span>data.table::fwrite(sankey_edges_b, paste0(<span>"data/campbell_comparison_sankey_links_"</span>, nlink, <span>".tsv"</span>), sep = <span>"\t"</span>)</span></code><code><span><span># ä¿å­˜èŠ‚ç‚¹æ•°æ®æ¡†åˆ°æ–‡ä»¶</span></span></code><code><span>data.table::fwrite(sankey_nodes, paste0(<span>"data/campbell_comparison_sankey_nodes"</span>, nlink, <span>".tsv"</span>), sep = <span>"\t"</span>)</span></code><code><span><br></span></code><code><span><span># å®šä¹‰æ–‡æœ¬å¤§å°</span></span></code><code><span>text_size = <span>13</span></span></code><code><span><span># ç»˜åˆ¶æ¡‘åŸºå›¾</span></span></code><code><span>p &lt;- networkD3::sankeyNetwork(Links = sankey_edges_b, Nodes = sankey_nodes, </span></code><code><span>                              Source = <span>"IDsource"</span>, Target = <span>"IDtarget"</span>, Value = <span>"value"</span>, </span></code><code><span>                              NodeID = <span>"name"</span>, NodeGroup = <span>"group"</span>, sinksRight = <span>FALSE</span>, fontSize = text_size)</span></code><code><span><span># æ˜¾ç¤ºæ¡‘åŸºå›¾</span></span></code><code><span>p</span></code><code><span><br></span></code><code><span><span>#, colourScale = networkD3::JS(paste0("d3.scaleOrdinal() .domain([\"clustering_1\",\"clustering_2\",\"clustering_1_added\",\"clustering_2_added\"]) .range([\"",  col1, "\",\"", col2, "\",\"", color_vector_lighter[1],  "\",\"", color_vector_lighter[2], "\"]);")), </span></span></code><code><span><br></span></code><code><span><span># # save sankeys</span></span></code><code><span><span># åŠ è½½webshotåŒ…ç”¨äºä¿å­˜ç½‘ç»œå›¾è¡¨ä¸ºé™æ€å›¾åƒ</span></span></code><code><span>library(webshot)</span></code><code><span><span># https://stackoverflow.com/questions/65158327/how-can-i-save-a-networkd3sankeynetwork-into-a-static-image-automatically-vi</span></span></code><code><span><span># å®šä¹‰ä¿å­˜æ–‡ä»¶çš„è·¯å¾„</span></span></code><code><span>save_path = <span>"/beegfs/scratch/bruening_scratch/lsteuernagel/data/dump/"</span></span></code><code><span><span># å°†æ¡‘åŸºå›¾ä¿å­˜ä¸ºHTMLæ–‡ä»¶</span></span></code><code><span>networkD3::saveNetwork(p, paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".html"</span>))</span></code><code><span><span># å°†HTMLæ–‡ä»¶è½¬æ¢ä¸ºPNGå›¾åƒ</span></span></code><code><span>webshot::webshot(paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".html"</span>), file = paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".png"</span>), vwidth = <span>1000</span>, vheight = <span>900</span>)</span></code><code><span><span># å°†HTMLæ–‡ä»¶è½¬æ¢ä¸ºPDFæ–‡ä»¶</span></span></code><code><span>webshot::webshot(paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".html"</span>), file = paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".pdf"</span>), vwidth = <span>1000</span>, vheight = <span>900</span>)</span></code><code><span><br></span></code><code><span><span># I used a local script to export with webshot !!</span></span></code><code><span><br></span></code><code><span><span># Sankey diagram showing the overlap of clusters between human HYPOMAP (darkbluedark-blue, left), mouse HypoMap (light-blue, centre) and a mouse ARC reference atlas by Campbell et al {Campbell, 2017 #30} (orange, right).</span></span></code><code><span><span># In the left comparison, lines indicate conserved clusters between levels C4 and C286 and linewidth is approximately proportional to human ARC cell numbers (large clusters are capped at 1000 cells each).</span></span></code><code><span><span># Mouse clusters without a conserved human cluster are shown as thin lines labelled â€˜(NA_hsâ€™). In the right comparison, linewidth is proportional to the number of ARC reference cells in each C286 cluster.</span></span></code><code><span><span># Only ARC reference clusters with at least 30 cells in a mouse HypoMap cluster are included and cells without an annotation are shown as â€˜NA_campbellâ€™.</span></span></code><code><span><br></span></code><code><span><span># and the number of human cells for the human to mouse HYPOMAP comparison. Only Campbell ARH reference clusters with at least 30 cells in a mouse HypoMap cluster are included. </span></span></code><code><span><span># ARHCampbell reference cells without an annotation are shown as â€˜NA_campbellâ€™. Mouse clusters without a conserved human cluster are shown as thin lines labelled â€˜(NA_hsâ€™).</span></span></code><code><span><br></span></code></pre></section><p><span>â€</span></p><section data-role="outer" label="Powered by 135editor.com onekey"><section><section data-bdopacity="20%"><section data-bdopacity="40%"><section data-bdopacity="60%"><section data-bdopacity="80%"><section data-bgopacity="90%"><p data-brushtype="text"><strong><strong><strong>åè‹”â†©ï¸ä¹‹å‰è´´å­çš„å²¸å·å³å¯éœå¾—ä¹‹å‰çš„ä»£ç ï¼Œä»Šæ—¥å…³é”®è¯ï¼š250207</strong></strong></strong></p></section></section></section></section></section></section></section><p data-brushtype="text"><strong><strong><strong><span></span>Tadross, J.A., Steuernagel, L., Dowsett, G.K.C. et al. A comprehensive spatio-cellular map of the human hypothalamus. Nature (2025).Â </strong></strong></strong></p><p data-brushtype="text"><strong><strong>Wang, C., Li, J., Chen, J.Â et al.Â Multi-omics analyses reveal biological and clinical insights in recurrent stage I non-small cell lung cancer.Â Nat CommunÂ 16, 1477 (2025).</strong></strong></p><p><strong><strong><strong>å¦‚æœä½ è¿˜ä¸ä¼šåˆ©ç”¨ AIè¾…åŠ©ä½ çš„å­¦ä¹ ï¼Œæ¨èä½ çœ‹ä¸‹è¿™ä¸ª</strong></strong></strong></p><p><strong><strong><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247492171&amp;idx=1&amp;sn=2de095de30c6330a6ac5dcb4e539206b&amp;scene=21#wechat_redirect" textvalue="å¤§ç«çš„deepseekè€æ˜¯å´©æ€ä¹ˆåŠï¼Œç®€å•é…ç½®å°±å¯æ— é™åˆ¶ä½¿ç”¨â€”â€”ç”Ÿä¿¡å­¦ä¹ ç¥å™¨" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">å¤§ç«çš„deepseekè€æ˜¯å´©æ€ä¹ˆåŠï¼Œç®€å•é…ç½®å°±å¯æ— é™åˆ¶ä½¿ç”¨â€”â€”ç”Ÿä¿¡å­¦ä¹ ç¥å™¨</a></strong></strong></strong><strong><strong></strong></strong></p><p><span><strong><span>è¿™æ¬¡ç”Ÿä¿¡çš„å¤§çº²å†…å®¹è¿›è¡Œå…¨é¢çš„è°ƒæ•´ï¼Œæƒ³äº†è§£ç”Ÿä¿¡çš„ï¼Œè·Ÿç­çš„ï¼Œå¯ä»¥çœ‹ä¸‹é¢</span><strong>ğŸ‘‡è¿™ä¸ªæ–‡ç« </strong></strong></span></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247489898&amp;idx=1&amp;sn=36e03c6c81e651b9c81eaf558e07aa24&amp;chksm=c09394dff7e41dc94b801cad43f802037589975b4c01de6659d39027f3efa91c5989d88f5cca&amp;scene=21#wechat_redirect" textvalue="è¿™æ¬¡å¯ä¸æ˜¯åªå­¦å•ç»†èƒï¼ŒåŸºæœ¬ä¸Šä»åŸºç¡€åˆ°å¤šç»„å­¦ã€ç©ºé—´ã€æœºå™¨å­¦ä¹ ä¸€æ¡é¾™å…¨æ‰“é€šäº†" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1"><span><strong>è¿™æ¬¡å¯ä¸æ˜¯åªå­¦å•ç»†èƒï¼ŒåŸºæœ¬ä¸Šä»åŸºç¡€åˆ°å¤šç»„å­¦ã€ç©ºé—´ã€æœºå™¨å­¦ä¹ ä¸€æ¡é¾™å…¨æ‰“é€šäº†</strong></span></a></p><p><span><strong><span>å•ç»†èƒæ•°æ®åˆ†æéœ€æ±‚çš„å¯ä»¥çœ‹<strong><strong>ğŸ‘‡è¿™ä¸ªæ–‡ç« </strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247490275&amp;idx=1&amp;sn=200ccc0a415860f9d73b9068657096ff&amp;scene=21#wechat_redirect" textvalue="æ²¡æœ‰æœåŠ¡å™¨ï¼Œå•ç»†èƒæ•°æ®æä¸å®šï¼Ÿæˆ‘ä»¬ç›®å‰åšå¥½äº†è¿™äº›pipelineï¼Œå¯ä»¥å¸®ä½ åš" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><strong><span><strong><strong></strong></strong></span></strong></a><strong><strong><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247490275&amp;idx=1&amp;sn=200ccc0a415860f9d73b9068657096ff&amp;scene=21#wechat_redirect" textvalue="æ²¡æœ‰æœåŠ¡å™¨ï¼Œå•ç»†èƒæ•°æ®æä¸å®šï¼Ÿæˆ‘ä»¬ç›®å‰åšå¥½äº†è¿™äº›pipelineï¼Œå¯ä»¥å¸®ä½ åš" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">æ²¡æœ‰æœåŠ¡å™¨ï¼Œå•ç»†èƒæ•°æ®æä¸å®šï¼Ÿæˆ‘ä»¬ç›®å‰åšå¥½äº†è¿™äº›pipelineï¼Œå¯ä»¥å¸®ä½ åš</a>ï¼ˆè¿‘æœŸåˆæ·»åŠ äº†21 å¹´å‘è¡¨åœ¨äº† Cellä¸Šé¢çš„å•ç»†èƒè½¬å½•ç»„åˆ†æä»£è°¢çš„åˆ†æâ€”â€”compassï¼‰</strong></strong></strong></strong></strong></span></strong></span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/RbY4KvzMMZIkVfL2EMDmrA",target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a>
