---
title: "这篇NC用了常见的多组学分析，每一部分都有相应的结果得出，整体思路很值得学"
date: 2025-02-11T00:12:21Z
draft: ["false"]
tags: [
  "fetched",
  "生信钱同学"
]
categories: ["Acdemic"]
---
这篇NC用了常见的多组学分析，每一部分都有相应的结果得出，整体思路很值得学 by 生信钱同学
------
<div><p><span><strong>也不用做单细胞的多组学多贵啊，这个多组组的运用的就很好，每一种组学信息都能得出相应的结论</strong></span><br></p><p>近日，一项发表于<span data-token-index="1">Nature Communications</span>的研究通过多组学分析，<span data-token-index="3">对 I 期非小细胞肺癌（NSCLC）术后复发</span>的生物学机制和临床管理进行了深入探究，为该疾病的治疗提供了新的思路和潜在策略。该研究由四川大学华西医院的团队主导，研究成果有望改变 I 期 NSCLC 的治疗现状。</p><p><img data-galleryid="" data-imgfileid="100008578" data-ratio="0.32037037037037036" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JOFe4FARnUe5n3OuDnHHz0aTTE2ChOfgr2UjacPQheMibEZECzoib8AVg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JOFe4FARnUe5n3OuDnHHz0aTTE2ChOfgr2UjacPQheMibEZECzoib8AVg/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008570" data-ratio="0.4601851851851852" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JevollxpcfXX6EedO7mXflz5B8wtFvOfSKEzzQ7rlOJe7g6ibdrF9hwg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JevollxpcfXX6EedO7mXflz5B8wtFvOfSKEzzQ7rlOJe7g6ibdrF9hwg/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008579" data-ratio="1.375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JKWFmySpMJ6luJicVcZeoWtAQLAX4qgzIgjuuZJoA0TNbpVyTVx83DDw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JKWFmySpMJ6luJicVcZeoWtAQLAX4qgzIgjuuZJoA0TNbpVyTVx83DDw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008571" data-ratio="0.39166666666666666" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6J2szibiac7RutT7Ywa2dfLCGFt4llKoKY4jZx4Yve1BGy4FKywcKFTGdw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6J2szibiac7RutT7Ywa2dfLCGFt4llKoKY4jZx4Yve1BGy4FKywcKFTGdw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008580" data-ratio="1.4" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JpBGLOpZXBicf8hzMLoZ2uOV08EZxuVx9WMgicM9PqEZXRQDj9AoyU6Sw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JpBGLOpZXBicf8hzMLoZ2uOV08EZxuVx9WMgicM9PqEZXRQDj9AoyU6Sw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008572" data-ratio="0.3814814814814815" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JOfd96hPBE9OqglBS2hicVQ953wqHP1iclRjIPKGyJZFknmjoGOnnuoHQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JOfd96hPBE9OqglBS2hicVQ953wqHP1iclRjIPKGyJZFknmjoGOnnuoHQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008581" data-ratio="0.9462962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JZTN4TY5htgibCdnbEUvqVS5wCjSUaEygNGA5vQ7vlDdJpsmlu9nqQiaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JZTN4TY5htgibCdnbEUvqVS5wCjSUaEygNGA5vQ7vlDdJpsmlu9nqQiaQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008573" data-ratio="0.3333333333333333" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JpwCmm8T0H4ibibiaib3hsxFTT3tCDNTCppozzq9ubnkoGW71L3m49OhBkQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JpwCmm8T0H4ibibiaib3hsxFTT3tCDNTCppozzq9ubnkoGW71L3m49OhBkQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008582" data-ratio="1.424074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jh3mnYxZSwPw7T7YqrysRIVHV0tu7G7IelR5cqAAgq3ofXmT7zibhiaMw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jh3mnYxZSwPw7T7YqrysRIVHV0tu7G7IelR5cqAAgq3ofXmT7zibhiaMw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008576" data-ratio="0.3851851851851852" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jz0cM4ia38fBFOEia9kaW6yAAla2gxY27WBzxt6GoB2VSB3icrmbdibjYBQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jz0cM4ia38fBFOEia9kaW6yAAla2gxY27WBzxt6GoB2VSB3icrmbdibjYBQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008583" data-ratio="1.2342592592592592" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6J5x1VNMngpPdG5sNQ93DAqbG0DRsCtLNuYeGDZGaWm68h0asE7V4PQA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6J5x1VNMngpPdG5sNQ93DAqbG0DRsCtLNuYeGDZGaWm68h0asE7V4PQA/640?wx_fmt=png&amp;from=appmsg"></p><p><span><strong>可以学习下<span data-token-index="0">非负矩阵分解（NMF）与临床信息关联的部分</span></strong><strong><span data-token-index="0">，不错</span></strong></span><span data-token-index="0"></span></p><p><img data-galleryid="" data-imgfileid="100008577" data-ratio="0.3907407407407407" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jx4mnXeZZMUCVDyCNezicvr2oxnyxTss9gl46FdkgiaYsCdic1EEFVFFnQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6Jx4mnXeZZMUCVDyCNezicvr2oxnyxTss9gl46FdkgiaYsCdic1EEFVFFnQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008585" data-ratio="1.4157407407407407" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JT3kSQCc4tCrCzCx6iao6FYqa2CHQCQBSaWWvg3mCXVZG5fk6EszHzzA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtxBxM5PXKr8Hbia8RiaqPq6JT3kSQCc4tCrCzCx6iao6FYqa2CHQCQBSaWWvg3mCXVZG5fk6EszHzzA/640?wx_fmt=png&amp;from=appmsg"></p><p>还是前几天的代码，画桑吉图</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><br></span></code><code><span><span>##########</span></span></code><code><span><span>### Load data</span></span></code><code><span><span>##########</span></span></code><code><span><br></span></code><code><span><span># 定义存储图片的目录</span></span></code><code><span>figure_dir = <span>"paper_figures/revision_figures/"</span></span></code><code><span><span># 创建图片目录，如果目录已存在则不显示警告信息</span></span></code><code><span>dir.create(figure_dir, showWarnings = <span>FALSE</span>)</span></code><code><span><br></span></code><code><span><span># 引入自定义的绘图函数脚本</span></span></code><code><span>source(<span>"paper_figures/tree_plotting_functions.R"</span>)</span></code><code><span>source(<span>"paper_figures/celltype_heatmaps_functions.R"</span>)</span></code><code><span><br></span></code><code><span><span># 定义人类下丘脑数据的存储路径</span></span></code><code><span>human_hypo_path = <span>"/beegfs/scratch/bruening_scratch/lsteuernagel/data/human_HYPOMAP_publication/"</span></span></code><code><span><span># 加载必要的R包</span></span></code><code><span>library(Seurat)</span></code><code><span>library(tidyverse)</span></code><code><span>library(ggtree)</span></code><code><span><br></span></code><code><span><span># 读取人类下丘脑合并数据集</span></span></code><code><span>human_hypo_combined = readRDS(paste0(human_hypo_path, <span>"human_HYPOMAP.rds"</span>))</span></code><code><span><br></span></code><code><span><span>## extra colors:</span></span></code><code><span><span># 从Okabe-Ito调色板中获取颜色</span></span></code><code><span>short_palette = <span>as</span>.character(palette.colors(palette = <span>"Okabe-Ito"</span>))</span></code><code><span><span># 移除灰色和黑色</span></span></code><code><span>short_palette = short_palette[!short_palette %in% c(<span>"#999999"</span>, <span>"#000000"</span>)]</span></code><code><span><span># 创建一个颜色渐变函数</span></span></code><code><span>getOkabeItoPalette = colorRampPalette(short_palette)</span></code><code><span><br></span></code><code><span><span># 加载细胞类型匹配结果</span></span></code><code><span>matched_clusters_final = data.table::fread(<span>"merge_human_mouse_neurons/matched_clusters_scviCorPruned.tsv"</span>, data.table = F)</span></code><code><span><br></span></code><code><span><span>## mouse</span></span></code><code><span><span># 读取小鼠下丘脑图谱数据，该数据可从指定链接下载</span></span></code><code><span>hypoMap = readRDS(<span>"/beegfs/scratch/bruening_scratch/lsteuernagel/data/hypoMap_publication/hypoMap.rds"</span>) <span># requires mouse HypoMap from: https://doi.org/10.17863/CAM.87955</span></span></code><code><span><br></span></code><code><span><span>##########</span></span></code><code><span><span>### Campbell comparison</span></span></code><code><span><span>##########</span></span></code><code><span><br></span></code><code><span><span># 仅选择C286进行分析</span></span></code><code><span><span># get C465 to Campbell &amp; subset to cell types matched to Campbell</span></span></code><code><span><span># 从hypoMap的元数据中筛选出数据集为CampbellDropseq的数据</span></span></code><code><span>cluster_matching = hypoMap@meta.data %&gt;%</span></code><code><span>  dplyr::filter(Dataset == <span>"CampbellDropseq"</span>) %&gt;%</span></code><code><span>  <span># 按作者定义的细胞类型和C286命名的聚类进行分组</span></span></code><code><span>  dplyr::group_by(Author_CellType, C286_named) %&gt;% </span></code><code><span>  <span># 统计每个分组中的细胞数量</span></span></code><code><span>  dplyr::count() %&gt;%</span></code><code><span>  <span># 筛选出细胞数量不少于10的分组</span></span></code><code><span>  dplyr::filter(n &gt;= <span>10</span>)</span></code><code><span><br></span></code><code><span><span># 将小鼠聚类与人类聚类进行匹配</span></span></code><code><span>cluster_matching = dplyr::left_join(cluster_matching, matched_clusters_final[, c(<span>"from"</span>, <span>"to_parent"</span>, <span>"similarity"</span>)], by = c(<span>"C286_named"</span> = <span>"to_parent"</span>)) %&gt;%</span></code><code><span>  <span># 取消分组</span></span></code><code><span>  dplyr::ungroup() %&gt;%</span></code><code><span>  <span># 按C286命名的聚类进行分组</span></span></code><code><span>  dplyr::group_by(C286_named) %&gt;%</span></code><code><span>  <span># 选择相似度最高的记录</span></span></code><code><span>  dplyr::slice_max(similarity, n = <span>1</span>, with_ties = F) %&gt;%</span></code><code><span>  <span># 重命名列名</span></span></code><code><span>  dplyr::rename(human_cluster = from, mouse_cluster = C286_named, Campbell_cluster = Author_CellType) %&gt;%</span></code><code><span>  <span># 筛选出包含GABA或GLU的小鼠聚类</span></span></code><code><span>  dplyr::filter(grepl(<span>"GABA|GLU"</span>, mouse_cluster))</span></code><code><span><br></span></code><code><span><span># 计算人类每个聚类中的细胞数量</span></span></code><code><span>human_cellcounts = human_hypo_combined@meta.data %&gt;% dplyr::group_by(C4_named) %&gt;% dplyr::count(name = <span>"nhuman"</span>)</span></code><code><span><span># 将人类细胞数量信息添加到聚类匹配结果中</span></span></code><code><span>cluster_matching = dplyr::left_join(cluster_matching, human_cellcounts, by = c(<span>"human_cluster"</span> = <span>"C4_named"</span>))</span></code><code><span><br></span></code><code><span><span># 将缺失的Campbell聚类和人类聚类标记为"NA"</span></span></code><code><span>cluster_matching$Campbell_cluster[is.na(cluster_matching$Campbell_cluster)] = <span>"NA"</span></span></code><code><span>cluster_matching$human_cluster[is.na(cluster_matching$human_cluster)] = <span>"NA"</span></span></code><code><span><br></span></code><code><span><span># maybe reduced to C286</span></span></code><code><span><br></span></code><code><span><span># make 3 level sankey</span></span></code><code><span><br></span></code><code><span><span># compare with ARC clustering</span></span></code><code><span><br></span></code><code><span><span># Maybe pull out ARH clusters and re-run ?</span></span></code><code><span><br></span></code><code><span><span>##########</span></span></code><code><span><span>### Campbell comparison</span></span></code><code><span><span>##########</span></span></code><code><span><br></span></code><code><span><span># 加载networkD3包用于绘制桑基图</span></span></code><code><span>library(networkD3)</span></code><code><span><br></span></code><code><span><span>## using fun code</span></span></code><code><span><span># 定义链接的最小细胞数量阈值</span></span></code><code><span>nlink = <span>40</span></span></code><code><span><span># 筛选出细胞数量不少于nlink的聚类匹配结果</span></span></code><code><span>sankey_edges = cluster_matching %&gt;% dplyr::filter(n &gt;= nlink)</span></code><code><span><span># 将缺失的Campbell聚类、小鼠聚类和人类聚类添加特定的后缀</span></span></code><code><span>sankey_edges$Campbell_cluster[sankey_edges$Campbell_cluster == <span>"NA"</span>] = paste0(<span>"NA_campbell"</span>)</span></code><code><span>sankey_edges$mouse_cluster[sankey_edges$mouse_cluster == <span>"NA"</span>] = paste0(<span>"NA_mm"</span>)</span></code><code><span>sankey_edges$human_cluster[sankey_edges$human_cluster == <span>"NA"</span>] = paste0(<span>"NA_hs"</span>)</span></code><code><span><br></span></code><code><span><span># 创建包含Campbell聚类的节点数据框</span></span></code><code><span>sankey_nodes1 = data.frame(name = sankey_edges$Campbell_cluster, group = <span>"Campbell_cluster"</span>)</span></code><code><span><span># 创建包含小鼠聚类的节点数据框</span></span></code><code><span>sankey_nodes2 = data.frame(name = sankey_edges$mouse_cluster, group = <span>"mouse_cluster"</span>)</span></code><code><span><span># 创建包含人类聚类的节点数据框</span></span></code><code><span>sankey_nodes3 = data.frame(name = sankey_edges$human_cluster, group = <span>"human_cluster"</span>)</span></code><code><span><br></span></code><code><span><span># 合并所有节点数据框，并去除重复的节点</span></span></code><code><span>sankey_nodes &lt;- rbind(rbind(sankey_nodes3, sankey_nodes2), sankey_nodes1) %&gt;% </span></code><code><span>  dplyr::distinct(name, group) %&gt;% <span>as</span>.data.frame()</span></code><code><span><br></span></code><code><span><span># 创建人类聚类到小鼠聚类的链接数据框</span></span></code><code><span>sankey_edges1 = sankey_edges %&gt;% dplyr::select(NAMEsource = human_cluster, NAMEtarget = mouse_cluster, value = nhuman)</span></code><code><span><span># 将缺失的人类细胞数量设置为1</span></span></code><code><span>sankey_edges1$value[is.na(sankey_edges1$value)] = <span>1</span></span></code><code><span><span># 将人类细胞数量大于1000的设置为1000</span></span></code><code><span>sankey_edges1$value[sankey_edges1$value &gt; <span>1000</span>] = <span>1000</span></span></code><code><span><span># 对人类细胞数量进行归一化</span></span></code><code><span>sankey_edges1$value = sankey_edges1$value / sum(sankey_edges1$value)</span></code><code><span><span># 创建小鼠聚类到Campbell聚类的链接数据框</span></span></code><code><span>sankey_edges2 = sankey_edges %&gt;% dplyr::select(NAMEsource = mouse_cluster, NAMEtarget = Campbell_cluster, value = n)</span></code><code><span><span># 对小鼠细胞数量进行归一化</span></span></code><code><span>sankey_edges2$value = sankey_edges2$value / sum(sankey_edges2$value)</span></code><code><span><span># 合并所有链接数据框</span></span></code><code><span>sankey_edges_b = rbind(sankey_edges1, sankey_edges2)</span></code><code><span><br></span></code><code><span><span># 将链接数据框中的源节点和目标节点名称转换为节点数据框中的索引</span></span></code><code><span>sankey_edges_b$IDsource &lt;- match(sankey_edges_b$NAMEsource, sankey_nodes$name) - <span>1</span></span></code><code><span>sankey_edges_b$IDtarget &lt;- match(sankey_edges_b$NAMEtarget, sankey_nodes$name) - <span>1</span></span></code><code><span><span># 将链接数据框转换为数据框格式</span></span></code><code><span>sankey_edges_b = <span>as</span>.data.frame(sankey_edges_b)</span></code><code><span><br></span></code><code><span><span># 保存链接数据框到文件</span></span></code><code><span>data.table::fwrite(sankey_edges_b, paste0(<span>"data/campbell_comparison_sankey_links_"</span>, nlink, <span>".tsv"</span>), sep = <span>"\t"</span>)</span></code><code><span><span># 保存节点数据框到文件</span></span></code><code><span>data.table::fwrite(sankey_nodes, paste0(<span>"data/campbell_comparison_sankey_nodes"</span>, nlink, <span>".tsv"</span>), sep = <span>"\t"</span>)</span></code><code><span><br></span></code><code><span><span># 定义文本大小</span></span></code><code><span>text_size = <span>13</span></span></code><code><span><span># 绘制桑基图</span></span></code><code><span>p &lt;- networkD3::sankeyNetwork(Links = sankey_edges_b, Nodes = sankey_nodes, </span></code><code><span>                              Source = <span>"IDsource"</span>, Target = <span>"IDtarget"</span>, Value = <span>"value"</span>, </span></code><code><span>                              NodeID = <span>"name"</span>, NodeGroup = <span>"group"</span>, sinksRight = <span>FALSE</span>, fontSize = text_size)</span></code><code><span><span># 显示桑基图</span></span></code><code><span>p</span></code><code><span><br></span></code><code><span><span>#, colourScale = networkD3::JS(paste0("d3.scaleOrdinal() .domain([\"clustering_1\",\"clustering_2\",\"clustering_1_added\",\"clustering_2_added\"]) .range([\"",  col1, "\",\"", col2, "\",\"", color_vector_lighter[1],  "\",\"", color_vector_lighter[2], "\"]);")), </span></span></code><code><span><br></span></code><code><span><span># # save sankeys</span></span></code><code><span><span># 加载webshot包用于保存网络图表为静态图像</span></span></code><code><span>library(webshot)</span></code><code><span><span># https://stackoverflow.com/questions/65158327/how-can-i-save-a-networkd3sankeynetwork-into-a-static-image-automatically-vi</span></span></code><code><span><span># 定义保存文件的路径</span></span></code><code><span>save_path = <span>"/beegfs/scratch/bruening_scratch/lsteuernagel/data/dump/"</span></span></code><code><span><span># 将桑基图保存为HTML文件</span></span></code><code><span>networkD3::saveNetwork(p, paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".html"</span>))</span></code><code><span><span># 将HTML文件转换为PNG图像</span></span></code><code><span>webshot::webshot(paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".html"</span>), file = paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".png"</span>), vwidth = <span>1000</span>, vheight = <span>900</span>)</span></code><code><span><span># 将HTML文件转换为PDF文件</span></span></code><code><span>webshot::webshot(paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".html"</span>), file = paste0(save_path, <span>"sankey_clusters_campbell_human_"</span>, nlink, <span>".pdf"</span>), vwidth = <span>1000</span>, vheight = <span>900</span>)</span></code><code><span><br></span></code><code><span><span># I used a local script to export with webshot !!</span></span></code><code><span><br></span></code><code><span><span># Sankey diagram showing the overlap of clusters between human HYPOMAP (darkbluedark-blue, left), mouse HypoMap (light-blue, centre) and a mouse ARC reference atlas by Campbell et al {Campbell, 2017 #30} (orange, right).</span></span></code><code><span><span># In the left comparison, lines indicate conserved clusters between levels C4 and C286 and linewidth is approximately proportional to human ARC cell numbers (large clusters are capped at 1000 cells each).</span></span></code><code><span><span># Mouse clusters without a conserved human cluster are shown as thin lines labelled ‘(NA_hs’). In the right comparison, linewidth is proportional to the number of ARC reference cells in each C286 cluster.</span></span></code><code><span><span># Only ARC reference clusters with at least 30 cells in a mouse HypoMap cluster are included and cells without an annotation are shown as ‘NA_campbell’.</span></span></code><code><span><br></span></code><code><span><span># and the number of human cells for the human to mouse HYPOMAP comparison. Only Campbell ARH reference clusters with at least 30 cells in a mouse HypoMap cluster are included. </span></span></code><code><span><span># ARHCampbell reference cells without an annotation are shown as ‘NA_campbell’. Mouse clusters without a conserved human cluster are shown as thin lines labelled ‘(NA_hs’).</span></span></code><code><span><br></span></code></pre></section><p><span>‍</span></p><section data-role="outer" label="Powered by 135editor.com onekey"><section><section data-bdopacity="20%"><section data-bdopacity="40%"><section data-bdopacity="60%"><section data-bdopacity="80%"><section data-bgopacity="90%"><p data-brushtype="text"><strong><strong><strong>后苔↩️之前贴子的岸号即可霍得之前的代码，今日关键词：250207</strong></strong></strong></p></section></section></section></section></section></section></section><p data-brushtype="text"><strong><strong><strong><span></span>Tadross, J.A., Steuernagel, L., Dowsett, G.K.C. et al. A comprehensive spatio-cellular map of the human hypothalamus. Nature (2025). </strong></strong></strong></p><p data-brushtype="text"><strong><strong>Wang, C., Li, J., Chen, J. et al. Multi-omics analyses reveal biological and clinical insights in recurrent stage I non-small cell lung cancer. Nat Commun 16, 1477 (2025).</strong></strong></p><p><strong><strong><strong>如果你还不会利用 AI辅助你的学习，推荐你看下这个</strong></strong></strong></p><p><strong><strong><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247492171&amp;idx=1&amp;sn=2de095de30c6330a6ac5dcb4e539206b&amp;scene=21#wechat_redirect" textvalue="大火的deepseek老是崩怎么办，简单配置就可无限制使用——生信学习神器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">大火的deepseek老是崩怎么办，简单配置就可无限制使用——生信学习神器</a></strong></strong></strong><strong><strong></strong></strong></p><p><span><strong><span>这次生信的大纲内容进行全面的调整，想了解生信的，跟班的，可以看下面</span><strong>👇这个文章</strong></strong></span></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247489898&amp;idx=1&amp;sn=36e03c6c81e651b9c81eaf558e07aa24&amp;chksm=c09394dff7e41dc94b801cad43f802037589975b4c01de6659d39027f3efa91c5989d88f5cca&amp;scene=21#wechat_redirect" textvalue="这次可不是只学单细胞，基本上从基础到多组学、空间、机器学习一条龙全打通了" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1"><span><strong>这次可不是只学单细胞，基本上从基础到多组学、空间、机器学习一条龙全打通了</strong></span></a></p><p><span><strong><span>单细胞数据分析需求的可以看<strong><strong>👇这个文章</strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247490275&amp;idx=1&amp;sn=200ccc0a415860f9d73b9068657096ff&amp;scene=21#wechat_redirect" textvalue="没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><strong><span><strong><strong></strong></strong></span></strong></a><strong><strong><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247490275&amp;idx=1&amp;sn=200ccc0a415860f9d73b9068657096ff&amp;scene=21#wechat_redirect" textvalue="没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做</a>（近期又添加了21 年发表在了 Cell上面的单细胞转录组分析代谢的分析——compass）</strong></strong></strong></strong></strong></span></strong></span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/RbY4KvzMMZIkVfL2EMDmrA",target="_blank" rel="noopener noreferrer">原文链接</a>
