---
title: "RNA-seq原理详解｜以DESeq2为例"
date: 2025-02-10T09:06:13Z
draft: ["false"]
tags: [
  "fetched",
  "X Omics"
]
categories: ["Acdemic"]
---
RNA-seq原理详解｜以DESeq2为例 by X Omics
------
<div><p data-mpa-powered-by="yiban.io"><img data-galleryid="" data-imgfileid="100001509" data-ratio="0.24444444444444444" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJthibdUnpv2PziaT5cQIaiavMK3WsaCBTQu9Y9GjMUouvrIlokfpuINNW6iaqSntbUibJHNcicXkuP4vRMXQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJthibdUnpv2PziaT5cQIaiavMK3WsaCBTQu9Y9GjMUouvrIlokfpuINNW6iaqSntbUibJHNcicXkuP4vRMXQ/640?wx_fmt=png&amp;from=appmsg"></p><p data-first-child="" data-pid="UdrbbZWI"><span></span></p><p data-first-child="" data-pid="UdrbbZWI"><span>1.序列比对及表达定量。</span></p><p data-pid="CetZ0Ta_">首先是测序得到的fastq文件，通过和<span>参考序列的比对</span>和<span>表达定量</span>，生成原始的定量结果（<span>如下图所示</span>）。最左列是基因名，最上列是<span>不同细胞系/不同处理</span>的名称，中间的数字就是对测序结果的定量值（<span>绝对定量</span>）。</p><p><br></p><figure data-size="normal"><img data-imgfileid="100002915" data-ratio="0.6077981651376146" data-type="other" data-w="436" height="265" width="436" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtgVzC0rgfibQNgopVxxoxTRSxWHj1SsRRwRtyj2HPpciaGkyMDQ1ZHxTg/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtgVzC0rgfibQNgopVxxoxTRSxWHj1SsRRwRtyj2HPpciaGkyMDQ1ZHxTg/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="oDkSvfA3"><span>2.数据标准化。</span></p><p data-pid="CKPW-2Bf">DESeq2将对原始reads进行建模，使用标准化因子（<span>scale factor/size factor</span>）来解释库深度的差异。然后，<span><strong>DESeq2估计基因的离散度，并缩小这些估计值以生成更准确的离散度估计，从而对reads count进行建模。</strong></span></p><p data-pid="d2CL9XwE">数据矫正步骤：</p><p data-pid="qj3WueJU">1）首先对样本量进行以<span>自然对数</span>为底数的<strong><span>log转换</span></strong>；</p><figure data-size="normal"><img data-imgfileid="100002912" data-ratio="0.35424354243542433" data-type="other" data-w="271" height="96" width="271" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtCsa9gIbOKvic1MMaUFmZC1jocfeVndkVNShicwicWY4hIzFhNoqibWOA2Q/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtCsa9gIbOKvic1MMaUFmZC1jocfeVndkVNShicwicWY4hIzFhNoqibWOA2Q/640?wx_fmt=other&amp;from=appmsg"></figure><figure data-size="normal"><img data-imgfileid="100002914" data-ratio="0.38" data-type="other" data-w="250" height="95" width="250" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtSlHibTOXYWibS62kQv2cjwuxfB6HBNTtTusBdEE6GO1Lpy80tYB6YIwg/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtSlHibTOXYWibS62kQv2cjwuxfB6HBNTtTusBdEE6GO1Lpy80tYB6YIwg/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="Omo9NkYm">2）对每一行的值进行平均值计算；</p><figure data-size="normal"><img data-imgfileid="100002916" data-ratio="0.21121495327102804" data-type="other" data-w="535" height="113" width="535" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtlpQ2f62Dv3lTdov7Y5E4efibfMmCEtjhMLuT4dBejMfzStQm0zovZrQ/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtlpQ2f62Dv3lTdov7Y5E4efibfMmCEtjhMLuT4dBejMfzStQm0zovZrQ/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="2AYReB8Y">第二、三列都比较好理解，第一列因为样本1的gene1的log值是-inf，因此gene1这一列的平均值也是-inf。当我们将gene3的平均表达的正常数值转换为log时，e4.3 ≈ 73.7，而对基因表达值的原始矩阵计算得到的平均值为(33+55+200)/3=96。我们可以看到96 &gt; 73.7，因此这种取对数的方法可以使得基因更不容易受到异常值的影响。事实上这种取完log之后取平均的方法，计算的是<span><strong>几何平均数</strong></span>。</p><p data-pid="FA5c378y">3）移除具有-Inf值的基因；</p><figure data-size="normal"><img data-imgfileid="100002913" data-ratio="0.24944812362030905" data-type="other" data-w="453" height="113" width="453" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtYQgS9db2nppJQrbrUvoChvp2bUNN2ogXCted25sc5xicslQRybibkFiaw/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtYQgS9db2nppJQrbrUvoChvp2bUNN2ogXCted25sc5xicslQRybibkFiaw/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="zLfhjDKk">4）对基因的reads count取log并减去基因的log值的平均数；</p><figure data-size="normal"><img data-imgfileid="100002918" data-ratio="0.44680851063829785" data-type="other" data-w="423" height="189" width="423" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt3bwrvK3aJXogaH6YEHIYTKIN7JbHJNYogv176RmL1P8LX2S4Alb4ibQ/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt3bwrvK3aJXogaH6YEHIYTKIN7JbHJNYogv176RmL1P8LX2S4Alb4ibQ/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="YMBRnQir">通过这个计算方式，我们将得到每个样本中geneX的表达水平与geneX在所有样本平均表达水平的比值：</p><figure data-size="normal"><img data-imgfileid="100002919" data-ratio="0.15228426395939088" data-type="png" data-w="394" height="60" width="394" data-src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtoqykhmnMHrMhTS6ib1HgKic83OIxfy0XCwLoeYmu1fSULnTNyUcQp8Nw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtoqykhmnMHrMhTS6ib1HgKic83OIxfy0XCwLoeYmu1fSULnTNyUcQp8Nw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-pid="OXewOxFh">5）计算 <strong><em>步骤4</em></strong> 所得的样本表达矩阵中，每个样本中的基因表达中位数：</p><figure data-size="normal"><img data-imgfileid="100002917" data-ratio="0.5705128205128205" data-type="other" data-w="312" height="178" width="312" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt8oULm8lc4kH2utvwDtIrDTb78IW3eS5iahogGbODwnKBDZDcyXuXrRw/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt8oULm8lc4kH2utvwDtIrDTb78IW3eS5iahogGbODwnKBDZDcyXuXrRw/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="5hJF0QdG">6）将 <strong><em>步骤5</em> </strong>计算的每个样本的中位数，进行指数计算；</p><figure data-size="normal"><img data-imgfileid="100002920" data-ratio="0.1511111111111111" data-type="png" data-w="450" height="68" width="450" data-src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt4Mibu0qOWIVAFw2l9klxLproHMxerL1bwiae3vrxos88AfaibyutDjgnw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt4Mibu0qOWIVAFw2l9klxLproHMxerL1bwiae3vrxos88AfaibyutDjgnw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-pid="qrOJTB2E">通过该方法，我们最终得到了样本的校正因子（<span>scale factor</span>）。</p><p data-pid="zcQzp0cK">7）将原始样本表达矩阵<span>除以 <strong><em>步骤6 </em></strong></span>所得到的scale factor，得到校正后结果；</p><figure data-size="normal"><img data-imgfileid="100002921" data-ratio="0.3013972055888224" data-type="other" data-w="501" height="151" width="501" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtfL8mNicicrS1mA021wr3sAcEIjYibLFqFReajNqLiccDDD5WW2XsGxHK5Q/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtfL8mNicicrS1mA021wr3sAcEIjYibLFqFReajNqLiccDDD5WW2XsGxHK5Q/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="4BJKUdV0">实际结果如下图所示：</p><figure data-size="normal"><img data-imgfileid="100002927" data-ratio="0.5419222903885481" data-type="other" data-w="489" height="265" width="489" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt0c031aiaCWly9ibtWhLq5MmPpClfGxmXB3mZvJKyHFDmzm2OtbQUJdQQ/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt0c031aiaCWly9ibtWhLq5MmPpClfGxmXB3mZvJKyHFDmzm2OtbQUJdQQ/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="Qc-4Oyck"><span>3.差异分析。</span></p><p data-pid="CSHmQGIV">计算log2foldchange和p值等。</p><figure data-size="normal"><img data-imgfileid="100002926" data-ratio="0.3392461197339246" data-type="other" data-w="451" height="153" width="451" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtqFGVe7j75ibvwGJplxia3O5R0wpnNGgyZibibicWG1QfFQEOM5dM01ZlaFA/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtqFGVe7j75ibvwGJplxia3O5R0wpnNGgyZibibicWG1QfFQEOM5dM01ZlaFA/640?wx_fmt=other&amp;from=appmsg"></figure><blockquote data-type="2" data-url="" data-author-name="" data-content-utf8-length="300" data-source-title="" data-text="其中results函数的解释：results extracts a result table from a DESeq analysis giving baseMeans across samples, log2foldchanges, standard errors, test statistics, p-values and adjusted p-values; resultsNames returns the names of the estimated effects (coefficents) of the model; removeResults returns a DESeqDataSet object with results columns removed。" data-editid="5edhk1v4yz2s3stszk"><section><section>其中results函数的解释：results extracts a result table from a DESeq analysis giving baseMeans across samples, log2foldchanges, standard errors, test statistics, p-values and adjusted p-values; resultsNames returns the names of the estimated effects (coefficents) of the model; removeResults returns a DESeqDataSet object with results columns removed。</section></section></blockquote><p data-pid="7L9GSI0L">一些基因在各个样本中表达量都接近0，如上面截图的res结果的第二行，无法计算lfcSE和pvalue，是NA，去掉后，剩下17983个基因的差异表达结果。</p><figure data-size="normal"><img data-imgfileid="100002923" data-ratio="0.17613636363636365" data-type="other" data-w="352" height="62" width="352" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtolfxVdFtmqxXaqJ15sdsMCgYvK160mymAUwYLbzrORycic221TjjPJg/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtolfxVdFtmqxXaqJ15sdsMCgYvK160mymAUwYLbzrORycic221TjjPJg/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="H8g9CNBY"><span><strong>IfcSE是标准误，标准误越小，样本均值和总体均值差距越小；标准误越大，样本均值和总体均值差距越大</strong></span>。标准误是由样本的标准差（<span>SD</span>）比上样本数的二次根号得到的数值。</p><figure data-size="normal"><img data-imgfileid="100002922" data-ratio="0.5357142857142857" data-type="other" data-w="84" height="45" width="84" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtlQ0wHT6iclhNIlmaBgkFlmAWCI6eIWGEIoOnGzicr5Uy3tK485CGPjzg/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtlQ0wHT6iclhNIlmaBgkFlmAWCI6eIWGEIoOnGzicr5Uy3tK485CGPjzg/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="SUa-xwXq"><strong>FoldChange优点是计算简单直观，缺点是没有考虑到差异表达的统计显著性</strong>；通常以2倍差异为阈值（<span>取log2时阈值为1</span>），判断基因是否差异表达。计算公式如下：</p><figure data-size="normal"><img data-imgfileid="100002925" data-ratio="0.31690140845070425" data-type="png" data-w="142" height="45" width="142" data-src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtpGujRFHUvthbJqkMhugvia7XzbCza2Gw4Oj5NglGrib8DfyEN1k9sxdw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtpGujRFHUvthbJqkMhugvia7XzbCza2Gw4Oj5NglGrib8DfyEN1k9sxdw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-pid="d8zPQCC1">Pvalue通过<em><strong>T检验</strong></em>得到，对每一个RNA-seq计算一个T统计量来衡量处理组与对照组情况下RNA-seq表达的差异，然后根据<strong>t分布</strong>计算显著性p值来衡量这种差异的显著性，T统计量计算公式如下：</p><figure data-size="normal"><img data-imgfileid="100002930" data-ratio="0.24782608695652175" data-type="other" data-w="230" height="57" width="230" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtkyUuFTVbpn5YjqV7icQLViaibgpDzFPcAwibQ52fuEnIqqmQOh5WwSbeCQ/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtkyUuFTVbpn5YjqV7icQLViaibgpDzFPcAwibQ52fuEnIqqmQOh5WwSbeCQ/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="IYi_NaZk">对于得到的显著性p值（<span>padj</span>），我们需要进行多重检验校正（<span>padj/qvalue/FDR</span>），比较常用的是BH方法（<em><span>Benjamini and Hochberg, 1995</span></em>）。P ×（ m / k ），<strong>其中的p为普通的pvalue，m为检验次数，k为此次检验的pvalue在所有检验次数中的排名</strong>。例如，检验了100次（m），则排名为10的qvalue 则为0.03(100/10)=0.3，代表在这前十次检验中假的差异基因不多于10×0.3个。FDR常见的阈值为0.1%，1%，5%等，也可设置宽松达25%，表示差异基因结果中有25%是假的。</p><figure data-size="normal"><img data-imgfileid="100002928" data-ratio="0.439873417721519" data-type="other" data-w="316" height="139" width="316" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtWLlrhXnFlv5BpETDae86xgsHUoGNB0qGicvfUosGq7UmkuJSG6hCPrQ/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtWLlrhXnFlv5BpETDae86xgsHUoGNB0qGicvfUosGq7UmkuJSG6hCPrQ/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="EgOgKeFp"><span>4.结果可视化。</span></p><p data-pid="jVy23Ost">对原始测序文件fastq的表达定量得到绝对定量，可以绘制<span>PCA（主成分分析）图</span>。通过RNA-seq差异分析，得到相对表达量（CPM）可以绘制<span>热图</span>，pvalue和foldchange可以绘制<span>火山图</span>。</p><figure data-size="normal"><img data-imgfileid="100002929" data-ratio="1.125" data-type="other" data-w="200" height="225" width="200" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt3zz8icdut6FOdPoicQYzp8ugZHAniaTkS1lq6W06rNZO3f53W7iaJHuFoA/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFt3zz8icdut6FOdPoicQYzp8ugZHAniaTkS1lq6W06rNZO3f53W7iaJHuFoA/640?wx_fmt=other&amp;from=appmsg"></figure><figure data-size="normal"><img data-imgfileid="100002931" data-ratio="1.0462962962962963" data-type="other" data-w="216" height="226" width="216" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtuRDmiaMELqn5GeGK8vE6Ud5LFN1HCnUkh2sT7hQ4ibHv8DW8n0rqvAMQ/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtuRDmiaMELqn5GeGK8vE6Ud5LFN1HCnUkh2sT7hQ4ibHv8DW8n0rqvAMQ/640?wx_fmt=other&amp;from=appmsg"></figure><figure data-size="normal"><img data-imgfileid="100002932" data-ratio="0.7444794952681388" data-type="other" data-w="317" height="236" width="317" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtQ12nxweEicLrGzJg4Ob2FGSSWpEIlyaRjtFajdbUuib0xtneDXrgmB6Q/640?wx_fmt=other&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_jpg/ZaeG2UyAJtgGIJQFibIt7XpWSibF5MfFFtQ12nxweEicLrGzJg4Ob2FGSSWpEIlyaRjtFajdbUuib0xtneDXrgmB6Q/640?wx_fmt=other&amp;from=appmsg"></figure><p data-pid="GjUxqyFp"><br></p><p><img data-galleryid="" data-imgfileid="100001510" data-ratio="0.5287037037037037" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJthibdUnpv2PziaT5cQIaiavMK3mzhKW8nV9iaib7tv7nQhG8AdFQkt0dibI5wuKsXvia26tydcShryuNROVA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/mmbiz_png/ZaeG2UyAJthibdUnpv2PziaT5cQIaiavMK3mzhKW8nV9iaib7tv7nQhG8AdFQkt0dibI5wuKsXvia26tydcShryuNROVA/640?wx_fmt=png&amp;from=appmsg"></p><p></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/NkN8ysNPuP8z_zVNLa5kMQ",target="_blank" rel="noopener noreferrer">原文链接</a>
