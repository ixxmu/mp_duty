---
title: "好的方法，从异质样本中精准解析单细胞复制时间（scRT）谱"
date: 2025-02-09T23:51:36Z
draft: ["false"]
tags: [
  "fetched",
  "生信钱同学"
]
categories: ["Acdemic"]
---
好的方法，从异质样本中精准解析单细胞复制时间（scRT）谱 by 生信钱同学
------
<div><p><span data-token-index="0">机器学习助力解析单细胞 DNA 复制时间动态，揭示癌症进展异质性</span></p><p><span data-token-index="0">近日，一项发表于《Nature Communications》的研究利用机器学习技术深入剖析<span data-token-index="1">单细胞 DNA 复制时间动态，</span>为癌症研究带来重要突破。该研究由来自巴黎居里研究所等机构的 Joseph M. Josephides 和 Chun-Long Chen 共同完成，<span data-token-index="3">他们开发的MnM工具，能够从异质样本中精准解析单细胞复制时间（scRT）谱，揭示癌症进展中的异质性，为癌症研究开辟新方向。</span></span></p><p><img data-galleryid="" data-imgfileid="100008546" data-ratio="0.937037037037037" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSYN2RDujNvs2EkXDnhXY1WDnjHUiauD1UdWicsmC2bVicSOcCee5l3ReOQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSYN2RDujNvs2EkXDnhXY1WDnjHUiauD1UdWicsmC2bVicSOcCee5l3ReOQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008540" data-ratio="0.4203703703703704" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzS8ZWpaiaWg0uLenMlFlzV335ibksozsDYPQdeobK1ZKgrExKdscsMic76A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzS8ZWpaiaWg0uLenMlFlzV335ibksozsDYPQdeobK1ZKgrExKdscsMic76A/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008547" data-ratio="0.7805555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSmp4lD38gxgfk9Eia9mWibf9FiaXZuAzx14KF5fuD3dpTta42iahLaV5Fqw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSmp4lD38gxgfk9Eia9mWibf9FiaXZuAzx14KF5fuD3dpTta42iahLaV5Fqw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008541" data-ratio="0.799074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSFXxXNnLTjiap26puTspqWaLZxYw3NWyOK5Gl2AV0fQLdBbXCVHHb3gw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSFXxXNnLTjiap26puTspqWaLZxYw3NWyOK5Gl2AV0fQLdBbXCVHHb3gw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008548" data-ratio="0.7129629629629629" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSW09liadH5jJoQHzVYAwibEsRibqOb0wE2KlqrmS8reZyG8Pq91ZSWJfGg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSW09liadH5jJoQHzVYAwibEsRibqOb0wE2KlqrmS8reZyG8Pq91ZSWJfGg/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008542" data-ratio="0.6787037037037037" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzS5cwKyTL6SEBynjWPKyDLbQpc1rwY7tqbxdwia0je0W6ApCMibMsx8Mhg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzS5cwKyTL6SEBynjWPKyDLbQpc1rwY7tqbxdwia0je0W6ApCMibMsx8Mhg/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008549" data-ratio="0.8435185185185186" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSdbug2g2G8ZjsQw9RJKyd6INLqfP4aaDicaFWkoBTkvDicVq2oDrawe5Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSdbug2g2G8ZjsQw9RJKyd6INLqfP4aaDicaFWkoBTkvDicVq2oDrawe5Q/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008544" data-ratio="0.41574074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSG54yaAG6S1wRGp4YxtgGiaicI96I49GtbxH6TGO4WeBUha9wDqgn3P2A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSG54yaAG6S1wRGp4YxtgGiaicI96I49GtbxH6TGO4WeBUha9wDqgn3P2A/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008550" data-ratio="1.1027777777777779" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSgWcpOKnkuS55k5bnqcgWwBRpiagWOgGShBr81Muurptr5CmD6XFkGkQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSgWcpOKnkuS55k5bnqcgWwBRpiagWOgGShBr81Muurptr5CmD6XFkGkQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008545" data-ratio="0.3648148148148148" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSx8ibtpu8SXhyu81eybqj5j6PeTe5xyUtfxZW5Xr6soauQiaMH5C1vmIA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSx8ibtpu8SXhyu81eybqj5j6PeTe5xyUtfxZW5Xr6soauQiaMH5C1vmIA/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100008551" data-ratio="0.5564814814814815" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzS6Caf7iag2wg28tKTGgOxS23jNW7N3pmGm0HgbZtvbaLt0FruyRafkPg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzS6Caf7iag2wg28tKTGgOxS23jNW7N3pmGm0HgbZtvbaLt0FruyRafkPg/640?wx_fmt=png&amp;from=appmsg"></p><p><span><strong>学习到的两个工具，首先是MnM ，它是一种机器学习方法，用于从全基因组测序数据中检测单细胞 DNA 复制时间的复制状态和基因组亚群。</strong></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="properties"><code><span><span># 它包含单细胞拷贝数插补方法、复制状态分类器和亚群检测器。至少需要 10 个细胞。</span></span></code><code><span><br></span></code><code><span><span># 使用说明</span></span></code><code><span><span># 移动到下载的目录</span></span></code><code><span><span>cd</span> <span>path_to_directory</span></span></code><code><span><br></span></code><code><span><span># 使 MnM 可执行</span></span></code><code><span><span>chmod</span> <span>+x MnM</span></span></code><code><span><br></span></code><code><span><span># 查看所有选项和解释</span></span></code><code><span><span>./MnM</span> <span>-h</span></span></code><code><span><br></span></code><code><span><span># 启动 MnM 程序</span></span></code><code><span><span># 参数说明：</span></span></code><code><span><span># -i INPUTFILE: 输入文件路径</span></span></code><code><span><span># [-m]: 标记输入文件是矩阵而不是 BAM 文件</span></span></code><code><span><span># [--sep SEP]: 输入文件的分隔符</span></span></code><code><span><span># [-o OUTPUT]: 输出目录</span></span></code><code><span><span># [-n NAME]: 输出文件的名称</span></span></code><code><span><span># [-g GENOME]: 指定参考基因组</span></span></code><code><span><span># [-w WINDOWSIZE]: 窗口大小</span></span></code><code><span><span># [--seed SEED]: 随机种子</span></span></code><code><span><span># [--maxcells MAXCELLS]: 最大细胞数</span></span></code><code><span><span># [-r]: 报告复制状态</span></span></code><code><span><span># [-s]: 发现基因组异质性（亚群）</span></span></code><code><span><span># [--cpu CPU]: 使用的 CPU 核心数</span></span></code><code><span><span># [--CNcol CNCOL]: 拷贝数列的索引</span></span></code><code><span><span># [--Cellcol CELLCOL]: 细胞列的索引</span></span></code><code><span><span># [--groups GROUPS]: 分组信息</span></span></code><code><span><span># [-p]: 显示进度条</span></span></code><code><span><span># [-b]: 批量处理模式</span></span></code><code><span><span># [-v]: 详细模式</span></span></code><code><span><span># [-h]: 显示帮助信息</span></span></code><code><span><span>./MnM</span> <span>-i INPUTFILE [-m] [--sep SEP] [-o OUTPUT] [-n NAME] [-g GENOME] [-w WINDOWSIZE] [--seed SEED] [--maxcells MAXCELLS] [-r] [-s] [--cpu CPU] [--CNcol CNCOL] [--Cellcol CELLCOL] [--groups GROUPS] [-p] [-b] [-v] [-h]</span></span></code><code><span><br></span></code><code><span><span># 以 MCF - 7 细胞为例</span></span></code><code><span><span># 从已发表数据中使用 Kronos scRT 获得的 MCF - 7 细胞的处理后 CNV 数据可以作为示例。</span></span></code><code><span><span># 这些数据包含在 scRT/scCNV 图谱中。我们可以使用以下命令发现复制状态和基因组异质性：</span></span></code><code><span><span># -i: 输入文件（scCNV 矩阵）</span></span></code><code><span><span># -o: 输出目录</span></span></code><code><span><span># -m: 标记输入文件是矩阵而不是 BAM 文件</span></span></code><code><span><span># -g: 指定参考基因组为 hg38</span></span></code><code><span><span># -n: 输出文件命名为 MCF - 7</span></span></code><code><span><span># -r: 报告复制状态</span></span></code><code><span><span># -s: 发现基因组异质性（亚群）</span></span></code><code><span><span>MnM</span> <span>-i scRT_scCNV_Atlas/Gnan2022_MCF-7/Gnan2022_MCF-7_scCNV_Matrix.tsv.gz -o ~/Documents/MnM_test_MCF-7_MnM_Output -m -g hg38 -n MCF-7 -r -s</span></span></code><code><span><br></span></code><code><span><span># 结果</span></span></code><code><span><span># 程序会生成以下图形：</span></span></code><code><span><span># 1. 在全基因组单细胞图上可视化区分复制细胞和非复制细胞。</span></span></code><code><span><span># 2. 可视化从非复制细胞中检测到的亚群：</span></span></code><code><span><span>#    - 在全基因组单细胞水平上。</span></span></code><code><span><span>#    - 每个亚群的染色体水平。</span></span></code><code><span><span>#    - 在 UMAP 图上。</span></span></code><code><span><br></span></code><code><span><span># 并且会生成一个元数据文件，列出每个细胞的复制状态和亚群：</span></span></code><code><span><span># 示例格式：</span></span></code><code><span><span># Cell           Phase    Subpopulation</span></span></code><code><span><span># AAACCTGCAACCCAAT-1_First_exp.bam    G1    1</span></span></code><code><span><span># AAACCTGGTCATTACG-1_Normal.bam      S     1</span></span></code><code><span><span># AAACGGGTCGGGAAAC-1_Normal.bam      G1    2</span></span></code><code><span><span># AAAGATGAGCTATGCT-1_Normal.bam      S     1</span></span></code><code><span><span># AAAGATGAGTAAGTAC-1_Normal.bam      S     2</span></span></code><code><span><span># AAAGATGGTTTGCCTC-1_Normal.bam      G1    1</span></span></code><code><span><span># CTAGTGAAGTGCTGCC-1_Normal.bam      S     1</span></span></code><code><span><span># ...            ...    ...</span></span></code><code><span><br></span></code><code><span><span># 免责声明</span></span></code><code><span><span># 此软件按原样提供，不提供任何保证。使用此软件即表示您同意遵守许可证中规定的条款。</span></span></code><code><span><br></span></code><code><span><span># 测试版本</span></span></code><code><span><span># 此程序已使用以下软件版本进行测试。建议您使用相同或更高版本。</span></span></code><code><span><span># Python 3.9.11</span></span></code><code><span><span># pandas 1.5.0</span></span></code><code><span><span># numpy 1.24.3</span></span></code><code><span><span># sklearn 1.1.2</span></span></code><code><span><span># natsort 8.2.0</span></span></code><code><span><span># seaborn 0.12.1</span></span></code><code><span><span># matplotlib 3.6.2</span></span></code><code><span><span># pybedtools 0.9.0</span></span></code><code><span><span># multiprocess 0.70.14</span></span></code><code><span><span># tensorflow 2.13.0</span></span></code><code><span><span># umap 0.5.3</span></span></code><code><span><br></span></code><code><span><span># 可以使用以下命令安装所需的 Python 库：</span></span></code><code><span><span>pip</span> <span>install pandas==1.5.0</span></span></code><code><span><span>pip</span> <span>install numpy==1.24.3</span></span></code><code><span><span>pip</span> <span>install scikit-learn==1.1.2</span></span></code><code><span><span>pip</span> <span>install natsort==8.2.0</span></span></code><code><span><span>pip</span> <span>install seaborn==0.12.1</span></span></code><code><span><span>pip</span> <span>install matplotlib==3.6.2</span></span></code><code><span><span>pip</span> <span>install pybedtools==0.9.0</span></span></code><code><span><span>pip</span> <span>install multiprocess==0.70.14</span></span></code><code><span><span>pip</span> <span>install tensorflow==2.13.0</span></span></code><code><span><span>pip</span> <span>install umap==0.5.3</span></span></code><code><span><br></span></code></pre></section><p><br></p><p><span><strong><span>然后就是另一个工具，单细胞复制时间（single-cell Replication Timing，scRT）分析的软件。这个工具 22 年就发了 NC了</span></strong></span></p><p><img data-galleryid="" data-imgfileid="100008552" data-ratio="1.1657407407407407" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSPGdwk0Kr4gv1lMx7yAeWrBdZUVINDPk2KRazdgXjAm05nk98Vz89Tw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFufX75UU1oq9goFMKPVUuzSPGdwk0Kr4gv1lMx7yAeWrBdZUVINDPk2KRazdgXjAm05nk98Vz89Tw/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="properties"><code><span><span># Kronos scRT Tutorial</span></span></code><code><span><span># 本教程将引导你完成 Kronos scRT 的主要步骤，这是一个用于单细胞复制时间（scRT）分析的软件。</span></span></code><code><span><br></span></code><code><span><span># 目录</span></span></code><code><span><span># 1. 安装与准备</span></span></code><code><span><span># 2. MCF - 7 细胞教程</span></span></code><code><span><span>#    - 基因组分箱</span></span></code><code><span><span>#    - 拷贝数变异分析</span></span></code><code><span><span>#    - 诊断模块（校正参数并揭示细胞阶段）</span></span></code><code><span><span>#    - 复制时间计算</span></span></code><code><span><span>#    - 降维处理</span></span></code><code><span><span># 3. 运行时间</span></span></code><code><span><span># 4. 引用说明</span></span></code><code><span><br></span></code><code><span><span># 安装与准备</span></span></code><code><span><span># 使用 git 将 Kronos scRT 下载到指定目录</span></span></code><code><span><span>git</span> <span>clone https://github.com/CL-CHEN-Lab/Kronos_scRT</span></span></code><code><span><br></span></code><code><span><span># 使 Kronos scRT 可执行，并将其路径添加到环境变量中，方便后续调用</span></span></code><code><span><span>chmod</span> <span>+X ./Kronos_scRT/Kronos</span></span></code><code><span><span>PATH</span>=<span>$PATH:$(pwd)/Kronos_scRT</span></span></code><code><span><br></span></code><code><span><span># 查看帮助信息，列出各个模块</span></span></code><code><span><span>Kronos</span> <span>-h</span></span></code><code><span><br></span></code><code><span><span># 安装所需的 R 包</span></span></code><code><span><span>Kronos</span> <span>InstRpacks</span></span></code><code><span><br></span></code><code><span><span># MCF - 7 细胞教程</span></span></code><code><span><br></span></code><code><span><span># 开始</span></span></code><code><span><span># 前提条件</span></span></code><code><span><span># 本教程需使用 hg38 作为参考基因组。若没有 hg38 模板，可从 Illumina 的 iGenome 网站下载，该网站提供了 bowtie2 索引；也可自行下载或创建 bowtie2 索引。</span></span></code><code><span><span># 还需要安装 TrimGalore、Cutadapt、Java 和 Picard 工具。</span></span></code><code><span><span># 强烈建议使用黑名单文件来屏蔽有问题的基因组区域（如着丝粒、端粒、微卫星等）</span></span></code><code><span><br></span></code><code><span><span># 教程所需数据</span></span></code><code><span><span># 下载 36 个 MCF - 7 细胞的全基因组测序相关数据，这些数据已将读取结果与参考基因组（此处为 hg38）进行了比对，每个细胞对应一个 BAM 文件</span></span></code><code><span><span># 使用 curl 下载压缩数据，用 tar 解压，并进入下载目录</span></span></code><code><span><span>curl</span> <span>-O https://xfer.curie.fr/get/nil/WujPODodyAG/Kronos_scRT_Tutorial.tar.gz</span></span></code><code><span><span>tar</span> <span>-xf Kronos_scRT_Tutorial.tar.gz</span></span></code><code><span><span>cd</span> <span>Kronos_scRT_Tutorial</span></span></code><code><span><br></span></code><code><span><span># 下载黑名单文件和 MCF - 7 参考复制时间（RT）文件</span></span></code><code><span><span># 黑名单文件</span></span></code><code><span><span>curl</span> <span>-O https://raw.githubusercontent.com/Boyle-Lab/Blacklist/master/lists/hg38-blacklist.v2.bed.gz</span></span></code><code><span><span>gunzip</span> <span>hg38-blacklist.v2.bed.gz</span></span></code><code><span><span># 参考 RT 文件</span></span></code><code><span><span># 对于 MacOS，在浏览器中打开链接并保存到当前目录</span></span></code><code><span><span>open</span> <span>'https://www2.replicationdomain.com/download_data.php?dataset=Int67688290&amp;build=hg38'</span></span></code><code><span><span># 对于 Linux，在浏览器中打开链接并保存到当前目录</span></span></code><code><span><span>xdg-open</span> <span>'https://www2.replicationdomain.com/download_data.php?dataset=Int67688290&amp;build=hg38'</span></span></code><code><span><span># 移除文件头部信息</span></span></code><code><span><span>cat</span> <span>RT_MCF-7_Adenocarcinoma_Int67688290_hg38.bedgraph | tail -n +12 &gt; RT_MCF-7_Adenocarcinoma_Int67688290_hg38_no_header.bedgraph</span></span></code><code><span><br></span></code><code><span><span># 声明路径</span></span></code><code><span><span># 第一步是声明所有要使用的路径和值，需将以下路径更新为实际位置</span></span></code><code><span><span># 程序路径</span></span></code><code><span><span>TrimGalore</span>=<span>$(which trim_galore)  # 获取 TrimGalore 的实际路径</span></span></code><code><span><span>Cutadapt</span>=<span>$(which cutadapt)      # 获取 Cutadapt 的实际路径</span></span></code><code><span><span>Java</span>=<span>$(which java)              # 获取 Java 的实际路径</span></span></code><code><span><span>Picard</span>=<span>Path_to_Picard/picard.jar # 需替换为 Picard 的实际路径</span></span></code><code><span><br></span></code><code><span><span># 参考基因组文件路径</span></span></code><code><span><span>hg38Ref</span>=<span>../Homo_sapiens_UCSC_hg38/Homo_sapiens/UCSC/hg38/Sequence/WholeGenomeFasta/genome.fa</span></span></code><code><span><span>hg38BT2</span>=<span>../Homo_sapiens_UCSC_hg38/Homo_sapiens/UCSC/hg38/Sequence/Bowtie2Index/genome</span></span></code><code><span><span>hg38Blist</span>=<span>./hg38-blacklist.v2.bed</span></span></code><code><span><br></span></code><code><span><span># 包含用于分析的 BAM 文件的目录路径</span></span></code><code><span><span>BAMDir</span>=<span>./BAM_files/MCF7_BAM</span></span></code><code><span><span># 参考 RT 文件路径</span></span></code><code><span><span>RefRT</span>=<span>./RT_MCF-7_Adenocarcinoma_Int67688290_hg38_no_header.bedgraph</span></span></code><code><span><br></span></code><code><span><span># 同时处理数据的处理单元（核心）数量</span></span></code><code><span><span>cores</span>=<span>4</span></span></code><code><span><br></span></code><code><span><span># 基因组分箱</span></span></code><code><span><span># 将参考基因组切割成 20 千碱基（kb）的箱</span></span></code><code><span><span># 参数说明：</span></span></code><code><span><span># -R：参考基因组的 Fasta 文件</span></span></code><code><span><span># -i：Bowtie 2 的索引基因组</span></span></code><code><span><span># -B：黑名单 bed 文件</span></span></code><code><span><span># --bin_size：箱的大小</span></span></code><code><span><span># --paired_ends：表示使用双端读取数据</span></span></code><code><span><span># -o：输出目录，会自动创建</span></span></code><code><span><span># -c：核心数量</span></span></code><code><span><span>Kronos</span> <span>binning -R $hg38Ref -i $hg38BT2 -B $hg38Blist --bin_size 20000 --paired_ends -o ./Binning -c $cores</span></span></code><code><span><br></span></code><code><span><span># 分箱输出文件说明</span></span></code><code><span><span># TSV 文件包含每个 20kb 箱的可映射性和 GC 含量，用于 CNV 分析的 -B 参数</span></span></code><code><span><span># | Binning Output File | Further Usage |</span></span></code><code><span><span># | ---| --- |</span></span></code><code><span><span># | TSV file with mappability and GC content of each 20kb bin. | CNV -B |</span></span></code><code><span><br></span></code><code><span><span># 拷贝数变异分析</span></span></code><code><span><span># 在将基因组切割成固定大小的箱后，统计每个细胞每个箱中的读取数量，以估计拷贝数</span></span></code><code><span><span># 参数说明：</span></span></code><code><span><span># -D：包含 BAM 文件的目录</span></span></code><code><span><span># -B：之前计算的分箱文件</span></span></code><code><span><span># -o：输出目录</span></span></code><code><span><span># -e：实验名称</span></span></code><code><span><span># -c：核心数量</span></span></code><code><span><span>Kronos</span> <span>CNV -D $BAMDir -B ./Binning/*.tsv -o ./CNV -e MCF7 -c $cores</span></span></code><code><span><br></span></code><code><span><span># CNV 输出文件说明</span></span></code><code><span><span># BED 文件包含每个细胞中每个包含读取的 20kb 箱的拷贝数，用于 RT 分析的 -T 参数</span></span></code><code><span><span># CSV 文件包含每个细胞的统计信息，用于诊断模块的 -F 参数、WhoIsWho 模块的 -F 参数和 RT 分析的 -F 参数</span></span></code><code><span><span># | CNV Output File | Further Usage |</span></span></code><code><span><span># | ---| --- |</span></span></code><code><span><span># | BED file containing the copy-number for each 20kb bin containing reads in each cell. | RT -T |</span></span></code><code><span><span># | CSV file containing statistics for each cell. | Diagnostic -F; WhoIsWho -F; RT -F |</span></span></code><code><span><br></span></code><code><span><span># 诊断模块：校正参数并揭示细胞阶段</span></span></code><code><span><span># 下一步是将细胞分为两大类：正在复制（S 期）和非复制（G1/G2 期），为此需要找到箱间变异性和细胞倍性的截断值，有以下几种方法</span></span></code><code><span><br></span></code><code><span><span># 1. S/G 期的箱间变异性截断值</span></span></code><code><span><span># 由于计算的拷贝数是相对的，S 期的细胞会分为早期和晚期，在诊断图中相对于 G1/G2 群体分别显示在左上角和右上角</span></span></code><code><span><span># 首次调用诊断模块，在图中可视化细胞</span></span></code><code><span><span># 参数说明：</span></span></code><code><span><span># -F：CNV 分析得到的 CSV 细胞统计文件</span></span></code><code><span><span># -o：输出目录</span></span></code><code><span><span># -b：输出文件的基本名称</span></span></code><code><span><span># -c：核心数量</span></span></code><code><span><span># -m：每兆碱基每单倍体基因组的读取阈值</span></span></code><code><span><span>Kronos</span> <span>diagnostic -F ./CNV/MCF7_per_Cell_summary_metrics.csv -o ./Diagnostic -b MCF7_inspection -c $cores -m 117</span></span></code><code><span><br></span></code><code><span><span># 由于此处细胞数量有限，无法实现自动阶段检测，Kronos scRT 无法区分复制和非复制细胞，所有细胞都标记为 G1/G2 期细胞</span></span></code><code><span><span># 通过目视检查此图，可以设置：</span></span></code><code><span><span># - S 期细胞与 G1/G2 期细胞的箱间拷贝数变异性截断参数（y 轴）</span></span></code><code><span><span># - S 期前半部分和后半部分的校正参数，用于相应地调整这些细胞的平均倍性</span></span></code><code><span><br></span></code><code><span><span># 这里仅定义 S 期变异性阈值，让 Kronos 为 S 期细胞选择最佳倍性校正参数（不提供 -f 和 -s 参数，Kronos scRT 会自动完成）</span></span></code><code><span><span># 可以看到细胞在 0.8 到 0.9 之间开始向左右分支，因此选择 0.85 作为 S 期变异性截断值</span></span></code><code><span><span># 参数说明：</span></span></code><code><span><span># -S：定义 S 期细胞的变异性截断参数</span></span></code><code><span><span># -C：请求校正 S 期并生成包含所有选定参数的最终输出文件</span></span></code><code><span><span>Kronos</span> <span>diagnostic -F ./CNV/MCF7_per_Cell_summary_metrics.csv -o ./Diagnostic -b MCF7_manual -c $cores -m 117 -S 0.85 -C</span></span></code><code><span><br></span></code><code><span><span># 2. 提供细胞阶段信息</span></span></code><code><span><span># 如果有元数据（如来自 FACS 分选），可以使用此信息为每个细胞分配阶段（S 或 G），然后调用诊断模块</span></span></code><code><span><span># 为演示此功能，提供了一个包含细胞阶段信息的文件，可与 WhoIsWho 模块一起使用</span></span></code><code><span><span># 参数说明：</span></span></code><code><span><span># -F：CNV 分析得到的 CSV 细胞统计文件</span></span></code><code><span><span># -W：细胞名称/类型对应 TSV 文件</span></span></code><code><span><span># -o：输出目录</span></span></code><code><span><span>Kronos</span> <span>WhoIsWho -F ./CNV/MCF7_per_Cell_summary_metrics.csv -W ./MCF-7_Cell_Phase_Correspondence.tsv -o ./WhoIsWho</span></span></code><code><span><span># 这次，向诊断模块提供 WhoIsWho 模块生成的包含强制细胞阶段信息的新文件，让 Kronos scRT 计算倍性校正值</span></span></code><code><span><span>Kronos</span> <span>diagnostic -F ./WhoIsWho/phased_MCF7_per_Cell_summary_metrics.csv -o ./Diagnostic -b MCF7_who -c $cores -m 117</span></span></code><code><span><br></span></code><code><span><span># 3. 完全自动参数检测</span></span></code><code><span><span># 当有足够的细胞（数量可能因细胞类型和实验而异）时，可以让 Kronos scRT 自动计算所有截断和校正参数，无需提供额外参数（-S -G -f -s）</span></span></code><code><span><span># 本教程中细胞数量不足，无法演示，但可以通过以下命令实现</span></span></code><code><span><span># Just for reference. Do not run.</span></span></code><code><span><span>Kronos</span> <span>diagnostic -F ./CNV/MCF7_per_Cell_summary_metrics.csv -o ./Diagnostic -b MCF7_auto -c $cores -m 117 -C</span></span></code><code><span><br></span></code><code><span><span># WhoIsWho 输出文件说明</span></span></code><code><span><span># CSV 文件包含根据细胞阶段数据校正后的细胞统计信息，用于诊断模块的 -F 参数</span></span></code><code><span><span># | WhoIsWho Output File | Further Usage |</span></span></code><code><span><span># | ---| --- |</span></span></code><code><span><span># | CSV file containing corrected cell statistics from the cell phase data. | Diagnostic -F |</span></span></code><code><span><br></span></code><code><span><span># 诊断模块输出文件说明</span></span></code><code><span><span># TXT 文件包含用于拷贝数调整和变异性截断的参数，用于 RT 分析的 -S 参数</span></span></code><code><span><span># | Diagnostic Output File | Further Usage |</span></span></code><code><span><span># | ---| --- |</span></span></code><code><span><span># | TXT file with the parameters used for the copy-number adjustments and variability cut-offs. | RT -S |</span></span></code><code><span><br></span></code><code><span><span># 复制时间计算</span></span></code><code><span><span># 在计算复制时间（RT）之前，需要一个包含常染色体长度的文件</span></span></code><code><span><span>cut</span> <span>-f1,2 ../Homo_sapiens_UCSC_hg38/Homo_sapiens/UCSC/hg38/Sequence/WholeGenomeFasta/genome.fa.fai &gt; ./hg38_autosomal_sizes.tsv</span></span></code><code><span><br></span></code><code><span><span># 计算复制时间，向 RT 模块提供以下参数</span></span></code><code><span><span># 参数说明：</span></span></code><code><span><span># -F：CNV 分析得到的 CSV 细胞统计文件</span></span></code><code><span><span># -T：CNV 分析得到的拷贝数 BED 文件</span></span></code><code><span><span># -S：诊断模块得到的倍性校正参数和变异性阈值文件</span></span></code><code><span><span># -C：染色体大小文件</span></span></code><code><span><span># -R：批量 RT 参考文件</span></span></code><code><span><span># --ref_name：RT 参考名称</span></span></code><code><span><span># -B：CNV 和 RT 计算的箱大小</span></span></code><code><span><span># -N：用于 Twidth 计算的类别数量（如早期/中期/晚期 S 期）</span></span></code><code><span><span># -o：输出目录</span></span></code><code><span><span># -p：创建绘图的标志</span></span></code><code><span><span># -r：要绘制的区域的基因组坐标</span></span></code><code><span><span># -b：输出文件的基本名称</span></span></code><code><span><span># -f：输出文件的补充基本名称（在合并重复实验时有用）</span></span></code><code><span><span># -c：核心数量</span></span></code><code><span><span>Kronos</span> <span>RT -F ./CNV/MCF7_per_Cell_summary_metrics.csv -T ./CNV/MCF7_cnv_calls.bed -C ./hg38_autosomal_sizes.tsv -o ./RT -b MCF7_Tutorial -f 250kb -S ./Diagnostic/MCF7_manual_settings.txt -c $cores -p -r chr2:30Mb-60Mb -R $RefRT -B 250000 --ref_name MCF7_Reference -N 3</span></span></code><code><span><br></span></code><code><span><span># RT 输出文件说明</span></span></code><code><span><span># TSV 文件包含每个类别（所有/早期/中期/晚期）的 T - width 值</span></span></code><code><span><span># TSV 文件包含从单细胞计算得到的伪批量 RT 值</span></span></code><code><span><span># TSV 文件包含 250kb 箱中的参考 RT 值</span></span></code><code><span><span># TSV 文件包含每个区域的 scRT 变异性</span></span></code><code><span><span># TSV 文件包含每个细胞在 250kb 箱中的单细胞拷贝数和二值化 RT，用于降维分析</span></span></code><code><span><span># TXT 文件列出过滤细胞后每个细胞名称的索引（如图中）</span></span></code><code><span><span># TXT 文件列出过滤细胞前每个细胞名称的索引（如图中）</span></span></code><code><span><span># | RT Output File | Further Usage |</span></span></code><code><span><span># | ---| --- |</span></span></code><code><span><span># | TSV file with the T-width values for each category (All/Early/Mid/Late). | |</span></span></code><code><span><span># | TSV file with the calculated pseudo-bulk RT values from the single cells. | |</span></span></code><code><span><span># | TSV file with the reference RT values in 250kb bins. | |</span></span></code><code><span><span># | TSV file containing scRT variability per region. | |</span></span></code><code><span><span># | TSV file containing single cell copy-numbers and binarized RT for each cell in 250kb bins. | DRed |</span></span></code><code><span><span># | TXT file listing the index for each cell name (e.g. in the plots) after filtering out cells. | |</span></span></code><code><span><span># | TXT file listing the index for each cell name (e.g. in the plots) before filtering out cells. | |</span></span></code><code><span><br></span></code><code><span><span># 降维处理</span></span></code><code><span><span># 使用 DRed 模块可视化细胞间 RT 变异性，提供以下参数</span></span></code><code><span><span># 参数说明：</span></span></code><code><span><span># -C：Kronos RT 生成的 CNV/RT 文件</span></span></code><code><span><span># -o：输出目录</span></span></code><code><span><span># -f：输出文件的基本名称</span></span></code><code><span><span># --CNV_values：要绘制的值，例如二值化 RT 值而非 CNV 值</span></span></code><code><span><span># -s：用于重现结果的随机种子</span></span></code><code><span><span># -U：跳过 t - SNE，仅绘制 UMAP</span></span></code><code><span><span># -c：核心数量</span></span></code><code><span><span>Kronos</span> <span>DRed -C ./RT/250kb_single_cells_CNV_250Kb.tsv -o ./DimRed -f MCF7_Tutorial --CNV_values B -s 2022 -U -c $cores</span></span></code><code><span><br></span></code><code><span><span># 运行时间</span></span></code><code><span><span># 在 macOS 12.3.1 系统上，使用 32GB 内存和 2.3 GHz 四核 Intel Core i7 处理器测试本教程各部分的执行时间</span></span></code><code><span><span># | Kronos Module | Runtime |</span></span></code><code><span><span># | ---| --- |</span></span></code><code><span><span># | Binning | 45min |</span></span></code><code><span><span># | CNV | 15min |</span></span></code><code><span><span># | Diagnostic | &lt;1min |</span></span></code><code><span><span># | WhoIsWho | &lt;1min |</span></span></code><code><span><span># | RT | 1min |</span></span></code><code><span><span># | DRed | &lt;1min |</span></span></code><code><span><span># | **Total** | 1h2min |</span></span></code><code><span><br></span></code></pre></section><p><strong><strong><strong>如果你还不会利用 AI辅助你的学习，推荐你看下这个</strong></strong></strong></p><p><strong><strong><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247492171&amp;idx=1&amp;sn=2de095de30c6330a6ac5dcb4e539206b&amp;scene=21#wechat_redirect" textvalue="大火的deepseek老是崩怎么办，简单配置就可无限制使用——生信学习神器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">大火的deepseek老是崩怎么办，简单配置就可无限制使用——生信学习神器</a></strong></strong></strong></p><p><span><strong><span>这次生信的大纲内容进行全面的调整，想了解生信的，跟班的，可以看下面</span><strong>👇这个文章</strong></strong></span></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247489898&amp;idx=1&amp;sn=36e03c6c81e651b9c81eaf558e07aa24&amp;chksm=c09394dff7e41dc94b801cad43f802037589975b4c01de6659d39027f3efa91c5989d88f5cca&amp;scene=21#wechat_redirect" textvalue="这次可不是只学单细胞，基本上从基础到多组学、空间、机器学习一条龙全打通了" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1"><span><strong>这次可不是只学单细胞，基本上从基础到多组学、空间、机器学习一条龙全打通了</strong></span></a></p><p><span><strong><span>单细胞数据分析需求的可以看<strong><strong>👇这个文章</strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247490275&amp;idx=1&amp;sn=200ccc0a415860f9d73b9068657096ff&amp;scene=21#wechat_redirect" textvalue="没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span><strong></strong></span></a><strong><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247490275&amp;idx=1&amp;sn=200ccc0a415860f9d73b9068657096ff&amp;scene=21#wechat_redirect" textvalue="没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做</a>（近期又添加了21 年发表在了 Cell上面的单细胞转录组分析代谢的分析——compass）</strong></strong></strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><strong><strong><br></strong></strong></strong></strong></span></strong></span></p><p><strong><strong><strong>Josephides, J.M., Chen, CL. Unravelling single-cell DNA replication timing dynamics using machine learning reveals heterogeneity in cancer progression. Nat Commun 16, 1472 (2025)</strong></strong></strong><span role="button"><span><span><span></span></span></span></span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/eSjxrDtabUWJ5FmFf91mxw",target="_blank" rel="noopener noreferrer">原文链接</a>
