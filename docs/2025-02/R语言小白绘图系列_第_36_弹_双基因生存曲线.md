---
title: "R语言小白绘图系列|第 36 弹·双基因生存曲线"
date: 2025-02-06T10:08:09Z
draft: ["false"]
tags: [
  "fetched",
  "科研生信充电宝"
]
categories: ["Acdemic"]
---
R语言小白绘图系列|第 36 弹·双基因生存曲线 by 科研生信充电宝
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span>R 语言小白绘图系列</span><span></span></h1><h1 data-tool="mdnice编辑器"><span></span><span>第 36 弹|双基因生存曲线</span><span></span></h1><h2 data-tool="mdnice编辑器"><span></span><span>1 双基因生存曲线简介</span><span></span></h2><p data-tool="mdnice编辑器">双基因生存曲线是一种用于分析生存数据的统计方法，通常在生物医学和生物统计学中使用。以下是关于双基因生存曲线的简要介绍：</p><h3 data-tool="mdnice编辑器"><span></span><span>定义</span><span></span></h3><p data-tool="mdnice编辑器">双基因生存曲线用于评估两个基因（或变量）对生存时间的联合影响，通常以Kaplan-Meier曲线的形式呈现。</p><h3 data-tool="mdnice编辑器"><span></span><span>主要步骤</span><span></span></h3><ol data-tool="mdnice编辑器"><li><section><p><strong>数据收集</strong>：</p></section></li></ol><ul><li><section>收集相关生存数据，包括生存时间、状态（生存或死亡）、以及两个基因的表达水平。</section></li></ul><li><section><p><strong>分组</strong>：</p></section></li><ul><li><section>根据基因表达水平将样本分为不同组（如高表达组和低表达组）。</section></li></ul><li><section><p><strong>生存分析</strong>：</p></section></li><ul><li><section>使用Kaplan-Meier方法计算各组的生存曲线，并进行对比。</section></li></ul><li><section><p><strong>统计检验</strong>：</p></section></li><ul><li><section>进行Log-rank检验等统计检验，评估不同组之间的生存差异是否显著。</section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>应用</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><strong>临床研究</strong>：分析特定基因对疾病预后的影响。</section></li><li><section><strong>个体化医疗</strong>：根据基因表达情况，制定更合适的治疗方案。</section></li></ul><p data-tool="mdnice编辑器">这种方法的具体实施通常需要使用统计软件（如R或Python）来处理数据并生成生存曲线。</p><h3 data-tool="mdnice编辑器"><span></span><span>应用实例</span><span></span></h3><p data-tool="mdnice编辑器">如下图，根据两个基因的高低表达，将样本分为四组（高-高，低-低，高-低，低-高），然后比较组间生存是否具有差异。<br>横坐标代表生存时间，单位是年；纵坐标代表生存率；随着时间推移，可以看到生存率逐渐下降。通过P值可以了解组间生存率是否存在差异，若p&lt;0.05则说明组间的生存率存在差异；<br>如下图，p&lt;0.001,说明组间生存具有差异。同时可以看到，两基因均高表达时，生存是最差的；两基因均低表达时，生存是最优的。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100009198" data-ratio="0.6666666666666666" data-src="https://mmbiz.qpic.cn/mmbiz_png/hN03ibG0t2HtsO5GEz7HCPwT5KL4CwRmpHbicB1GbDk63mWicXZxuuheXicfzJJFcgCIBASqsT9txSC82LiaZy64Ysw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="894" src="https://mmbiz.qpic.cn/mmbiz_png/hN03ibG0t2HtsO5GEz7HCPwT5KL4CwRmpHbicB1GbDk63mWicXZxuuheXicfzJJFcgCIBASqsT9txSC82LiaZy64Ysw/640?wx_fmt=png&amp;from=appmsg"><figcaption>双基因生存曲线</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>2 源文件</span><span></span></h2><figure data-tool="mdnice编辑器"><img data-imgfileid="100009197" data-ratio="0.4017094017094017" data-src="https://mmbiz.qpic.cn/mmbiz_png/hN03ibG0t2HtsO5GEz7HCPwT5KL4CwRmpibqaFtAOa7GFbwZbRAgwqUibgKxgYkhb50oRuGG59fpqAv924gle65DA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="468" src="https://mmbiz.qpic.cn/mmbiz_png/hN03ibG0t2HtsO5GEz7HCPwT5KL4CwRmpibqaFtAOa7GFbwZbRAgwqUibgKxgYkhb50oRuGG59fpqAv924gle65DA/640?wx_fmt=png&amp;from=appmsg"></figure><h4 data-tool="mdnice编辑器"><span></span><span>输入文件有五列信息</span><span></span></h4><ul data-tool="mdnice编辑器"><li><section>id: 样品名称</section></li><li><section>futime:生存时间，单位为年。</section></li><li><section>fustat:生存状态，0代表存活，1代表死亡。</section></li><li><section>VCAN基因表达量</section></li><li><section>CXCR4基因表达量</section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span>3 代码</span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span>环境准备</span><span></span></h3><p data-tool="mdnice编辑器">这段代码的目的是进行包含两个变量的生存分析，以下是逐行解释：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 安装和加载需要的R包</span><br><span># install.packages("survival")</span><br><span># install.packages("survminer")</span><br><br><span>library</span>(survival)    <span># 加载生存分析包</span><br><span>library</span>(survminer)   <span># 加载生存图形化包</span><br></code></pre><p data-tool="mdnice编辑器">这部分注释掉的代码是用于安装<code>survival</code>和<code>survminer</code>两个包，后面两行代码是加载这两个包，以便使用其中的函数进行生存分析和可视化。</p><pre data-tool="mdnice编辑器"><span></span><code>inputFile = <span>"input.txt"</span>         <span># 输入文件</span><br>outFile = <span>"survival.pdf"</span>        <span># 输出PDF文件</span><br>var1 = <span>"VCAN"</span>                   <span># 用于生存分析的变量1</span><br>var2 = <span>"CXCR4"</span>                  <span># 用于生存分析的变量2</span><br>setwd(<span>"D:\\biowolf\\bioR\\37.survival2vars"</span>)  <span># 设置工作目录</span><br></code></pre><p data-tool="mdnice编辑器">这部分代码定义了几个重要的变量：</p><ul data-tool="mdnice编辑器"><li><section><code>inputFile</code>: 指定输入数据文件的名称为<code>"input.txt"</code>。</section></li><li><section><code>outFile</code>: 指定输出文件的名称为<code>"survival.pdf"</code>。</section></li><li><section><code>var1</code>和<code>var2</code>: 这两个变量分别代表用于生存分析的生物标志物（或基因），在后续分析中将被使用。</section></li><li><section><code>setwd()</code>: 设置当前的工作目录，以便后续读取输入文件和保存输出文件。</section></li></ul><pre data-tool="mdnice编辑器"><span></span><code>rt = read.table(inputFile, header=<span>T</span>, sep=<span>"\t"</span>, check.names=<span>F</span>)  <span># 读取输入数据</span><br></code></pre><p data-tool="mdnice编辑器">这一行代码使用<code>read.table</code>函数读取指定的输入文件，参数含义如下：</p><ul data-tool="mdnice编辑器"><li><section><code>header=T</code>: 表示文件的第一行包含列名。</section></li><li><section><code>sep="\t"</code>: 指定文件使用制表符（Tab）分隔。</section></li><li><section><code>check.names=F</code>: 表示在读取列名时不进行修改，保留原有的列名。</section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span>总结</span><span></span></h4><p data-tool="mdnice编辑器">整段代码的功能是准备进行包含两个变量（<code>VCAN</code>和<code>CXCR4</code>）的生存分析，设置输入输出文件和工作目录，并读取输入数据。后续分析会基于这些准备工作进行。</p><h3 data-tool="mdnice编辑器"><span></span><span>根据基因表达，对数据分组</span><span></span></h3><p data-tool="mdnice编辑器">这段代码的作用是根据两个基因（<code>var1</code>和<code>var2</code>）的表达水平将数据分组，具体解释如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 根据基因表达，对数据分组</span><br>a = ifelse(rt[, var1] &lt; median(rt[, var1]), paste0(var1, <span>" low"</span>), paste0(var1, <span>" high"</span>))<br>b = ifelse(rt[, var2] &lt; median(rt[, var2]), paste0(var2, <span>" low"</span>), paste0(var2, <span>" high"</span>))<br>Type = paste(a, <span>"+"</span>, b)<br>rt = cbind(rt, Type)<br></code></pre><ol data-tool="mdnice编辑器"><li><section><p><strong>分组操作</strong>：</p></section></li></ol><ul><li><section>类似地，对<code>var2</code>的表达值进行比较，结果存储在<code>b</code>中。</section></li><li><section>这行代码对<code>var1</code>的表达值进行比较，若小于中位数则标记为<code>"VCAN low"</code>，否则标记为<code>"VCAN high"</code>。结果存储在<code>a</code>中。</section></li><li><section><code>ifelse(rt[, var1] &lt; median(rt[, var1]), paste0(var1, " low"), paste0(var1, " high"))</code>：</section></li><li><section><code>ifelse(rt[, var2] &lt; median(rt[, var2]), paste0(var2, " low"), paste0(var2, " high"))</code>：</section></li></ul><li><section><p><strong>组合分组信息</strong>：</p></section></li><ul><li><section>将<code>a</code>和<code>b</code>的分组信息结合，形成一个新的分组标签，如<code>"VCAN low + CXCR4 high"</code>。</section></li><li><section><code>Type = paste(a, "+", b)</code>：</section></li></ul><li><section><p><strong>将分组信息添加到数据框中</strong>：</p></section></li><ul><li><section>将新的<code>Type</code>列添加到原始数据框<code>rt</code>中，形成一个新的数据框，包含基因表达分组的信息。</section></li><li><section><code>rt = cbind(rt, Type)</code>：</section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span>总结</span><span></span></h4><p data-tool="mdnice编辑器">这段代码通过比较基因表达值与中位数，创建了一个新的分组变量<code>Type</code>，用于后续的生存分析，便于分析不同组合的生存情况。</p><h3 data-tool="mdnice编辑器"><span></span><span>生存差异统计</span><span></span></h3><p data-tool="mdnice编辑器">这段代码的目的是进行生存差异统计，具体步骤如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 生存差异统计</span><br>length = length(levels(factor(Type)))  <span># 计算分组的数量</span><br>diff = survdiff(Surv(futime, fustat) ~ Type, data = rt)  <span># 进行生存差异分析</span><br>pValue = <span>1</span> - pchisq(diff$chisq, df = length - <span>1</span>)  <span># 计算p值</span><br><span>if</span> (pValue &lt; <span>0.001</span>) {<br>    pValue = <span>"p&lt;0.001"</span>  <span># 如果p值小于0.001，则设定为"p&lt;0.001"</span><br>} <span>else</span> {<br>    pValue = paste0(<span>"p="</span>, sprintf(<span>"%.03f"</span>, pValue))  <span># 否则格式化p值</span><br>}<br>fit &lt;- survfit(Surv(futime, fustat) ~ Type, data = rt)  <span># 拟合生存曲线</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>逐行解释：</span><span></span></h3><ol data-tool="mdnice编辑器"><li><section><p><strong>计算分组数量</strong>：</p></section></li></ol><ul><li><section>使用<code>factor()</code>函数将<code>Type</code>转换为因子类型，<code>levels()</code>获取因子的水平（不同分组），然后用<code>length()</code>计算这些分组的数量。</section></li><li><section><code>length = length(levels(factor(Type)))</code>：</section></li></ul><li><section><p><strong>进行生存差异分析</strong>：</p></section></li><ul><li><section>使用<code>survdiff()</code>函数进行生存分析，比较不同<code>Type</code>分组的生存差异，返回的结果包含了卡方统计量等信息。</section></li><li><section><code>diff = survdiff(Surv(futime, fustat) ~ Type, data = rt)</code>：</section></li></ul><li><section><p><strong>计算p值</strong>：</p></section></li><ul><li><section>使用卡方分布的累积分布函数<code>pchisq()</code>计算p值，<code>diff$chisq</code>是前一步得到的卡方统计量，<code>df</code>为自由度（分组数减1）。</section></li><li><section><code>pValue = 1 - pchisq(diff$chisq, df = length - 1)</code>：</section></li></ul><li><section><p><strong>格式化p值</strong>：</p></section></li><ul><li><section><code>if</code>语句判断p值是否小于0.001，如果是，则赋值为<code>"p&lt;0.001"</code>；否则格式化p值为三位小数的字符串。</section></li></ul><li><section><p><strong>拟合生存曲线</strong>：</p></section></li><ul><li><section>使用<code>survfit()</code>函数根据生存时间<code>futime</code>和生存状态<code>fustat</code>拟合生存曲线，按<code>Type</code>分组进行。</section></li><li><section><code>fit &lt;- survfit(Surv(futime, fustat) ~ Type, data = rt)</code>：</section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span>总结</span><span></span></h4><p data-tool="mdnice编辑器">这段代码的核心是通过生存分析方法比较不同分组的生存差异，并计算相应的p值，最终得到生存曲线的拟合结果。</p><h3 data-tool="mdnice编辑器"><span></span><span>绘制生存曲线</span><span></span></h3><p data-tool="mdnice编辑器">这段代码的目的是绘制生存曲线并保存为PDF文件，具体步骤如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 绘制生存曲线</span><br>surPlot = ggsurvplot(fit, <br>                     data = rt,<br>                     conf.int = <span>F</span>,  <span># 不包含置信区间</span><br>                     pval = pValue,<br>                     pval.size = <span>5</span>,<br>                     legend.labs = levels(factor(rt[,<span>"Type"</span>])),  <span># 图例标签</span><br>                     legend.title = <span>"Type"</span>,  <span># 图例标题</span><br>                     legend = <span>"right"</span>,  <span># 图例位置</span><br>                     xlab = <span>"Time(years)"</span>,  <span># x轴标签</span><br>                     break.time.by = <span>1</span>,  <span># x轴刻度间隔</span><br>                     risk.table.title = <span>""</span>,  <span># 风险表格标题</span><br>                     risk.table = <span>F</span>,  <span># 不显示风险表</span><br>                     risk.table.height = <span>.25</span>)  <span># 风险表高度</span><br>pdf(file = outFile, onefile = <span>FALSE</span>, width = <span>7.5</span>, height = <span>5</span>)  <span># 设置PDF输出</span><br>print(surPlot)  <span># 打印生存曲线</span><br>dev.off()  <span># 关闭PDF设备</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>逐行解释：</span><span></span></h3><ol data-tool="mdnice编辑器"><li><section><p><strong>绘制生存曲线</strong>：</p></section></li></ol><ul><li><section>使用<code>ggsurvplot()</code>函数绘制生存曲线，传入拟合结果<code>fit</code>和数据集<code>rt</code>。</section></li><li><section><code>surPlot = ggsurvplot(...)</code>：</section></li></ul><li><section><p><strong>参数设置</strong>：</p></section></li><ul><li><section><code>conf.int = F</code>：不显示置信区间。</section></li><li><section><code>pval = pValue</code>：显示生存差异的p值。</section></li><li><section><code>pval.size = 5</code>：设置p值的字体大小。</section></li><li><section><code>legend.labs = levels(factor(rt[,"Type"]))</code>：根据<code>Type</code>的水平设置图例标签。</section></li><li><section><code>legend.title = "Type"</code>：图例的标题。</section></li><li><section><code>legend = "right"</code>：设置图例在图的右侧。</section></li><li><section><code>xlab = "Time(years)"</code>：x轴的标签为“Time(years)”。</section></li><li><section><code>break.time.by = 1</code>：x轴刻度每1单位。</section></li><li><section><code>risk.table.title = ""</code>：设置风险表格的标题为空。</section></li><li><section><code>risk.table = F</code>：不显示风险表格。</section></li><li><section><code>risk.table.height = .25</code>：如果显示风险表格，则设置高度为0.25。</section></li></ul><li><section><p><strong>保存为PDF</strong>：</p></section></li><ul><li><section>开始一个新的PDF设备，将生存曲线输出到指定的文件，设置宽度为7.5，高度为5。</section></li><li><section><code>pdf(file = outFile, onefile = FALSE, width = 7.5, height = 5)</code>：</section></li></ul><li><section><p><strong>打印生存曲线</strong>：</p></section></li><ul><li><section><code>print(surPlot)</code>：将绘制的生存曲线打印到PDF文件中。</section></li></ul><li><section><p><strong>关闭PDF设备</strong>：</p></section></li><ul><li><section><code>dev.off()</code>：关闭当前的PDF设备，完成文件的写入。</section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span>总结</span><span></span></h4><p data-tool="mdnice编辑器">这段代码的核心功能是绘制生存曲线，并配置相应的图例、标签和输出选项，最终将图形保存为PDF文件。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100009199" data-ratio="0.6666666666666666" data-src="https://mmbiz.qpic.cn/mmbiz_png/hN03ibG0t2HtsO5GEz7HCPwT5KL4CwRmpHbicB1GbDk63mWicXZxuuheXicfzJJFcgCIBASqsT9txSC82LiaZy64Ysw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="894" src="https://mmbiz.qpic.cn/mmbiz_png/hN03ibG0t2HtsO5GEz7HCPwT5KL4CwRmpHbicB1GbDk63mWicXZxuuheXicfzJJFcgCIBASqsT9txSC82LiaZy64Ysw/640?wx_fmt=png&amp;from=appmsg"><figcaption>双基因生存曲线</figcaption></figure></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/UPqZl1mJ6KYM3R3yvJ6JwQ",target="_blank" rel="noopener noreferrer">原文链接</a>
