---
title: "单细胞Ro/e分析学习和整理"
date: 2024-10-14T02:18:16Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
单细胞Ro/e分析学习和整理 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span>Ro/e</span>主要目的是评<strong>估不同的细胞系在组织分布是否显著偏离随机期望值</strong>，开发者指出这个工具比卡方检验有所不同，卡方检验只能观察结果偏离随机期望的程度，而Ro/e则能够进一步表明特定细胞簇在特定组织中的富集/消耗的情况。例如，如果 Ro/e&gt;1，则表明在该组织中，某细胞簇的细胞数量高于随机期望，即表现为富集；如果 Ro/e&lt;1，则表明某细胞簇在该组织中的细胞数量低于随机期望，即表现为消耗。<img data-imgfileid="100002420" data-ratio="0.5643564356435643" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEbrLaq1HATQdQfcq6pgjH1tf1mbegUuCz1pntALLIxomtJsO4wegHKr2HI24HPiaf1mtJMB69YoCA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1212" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEbrLaq1HATQdQfcq6pgjH1tf1mbegUuCz1pntALLIxomtJsO4wegHKr2HI24HPiaf1mtJMB69YoCA/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><strong>Ro/e指数的含义</strong><img data-imgfileid="100002419" data-ratio="0.9283387622149837" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEbrLaq1HATQdQfcq6pgjH1P2MeFFsKWt7CEpG3IZz4sZmVf6ibhlD5qQyQEMmMku7edDgwccUnmtg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="614" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEbrLaq1HATQdQfcq6pgjH1P2MeFFsKWt7CEpG3IZz4sZmVf6ibhlD5qQyQEMmMku7edDgwccUnmtg/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><strong>Ro/e 指数的评分规则：</strong></p><p data-tool="mdnice编辑器">+++, Ro/e &gt; 1;++, 0.8 &lt; Ro/e ≤ 1;+, 0.2 ≤ Ro/e ≤ 0.8;+/−, 0 &lt; Ro/e &lt; 0.2;−, Ro/e = 0<img data-imgfileid="100002418" data-ratio="0.26785714285714285" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEbrLaq1HATQdQfcq6pgjH1CtDsVQ7xNb54LHFK5LyU9DicPVHgAU3BxqFaibQwsRpuB4OYJtygibsicQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="616" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEbrLaq1HATQdQfcq6pgjH1CtDsVQ7xNb54LHFK5LyU9DicPVHgAU3BxqFaibQwsRpuB4OYJtygibsicQ/640?wx_fmt=png&amp;from=appmsg">与比较不同条件下细胞的RNA扰动和细胞数量变化不同，该工具更加侧重于同一组织内部不同细胞群的变化情况。顺便我们再回顾一下Augur和miloR这两个工具，<strong>Augur主要是关注基因表达差异，评估细胞在不同条件下所产生的RNA扰动情况，miloR是关注不同条件下细胞数量的变化，从数理的角度来看它是根据细胞群体的空间拓扑结构而做的分析(比如非转移和转移，需要先整合在一起然后进行比较)。而Ro/e指数的目前的用法更像是增加分析的细粒度，通过统计学结果告诉大家组织内部不同细胞簇的实际情况和预测情况的差异</strong>。</p><h4 data-tool="mdnice编辑器"><span></span><span>分析步骤</span><span></span></h4><h5 data-tool="mdnice编辑器"><span></span><span>1.导入</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>V5_path = <span>"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/seurat5/"</span><br>.libPaths(V5_path)<br>.libPaths()<br><span>library</span>(Startrac)<br><span>library</span>(ggplot2)<br><span>library</span>(tictoc)<br><span>library</span>(ggpubr)<br><span>library</span>(ComplexHeatmap)<br><span>library</span>(RColorBrewer)<br><span>library</span>(circlize)<br><span>library</span>(tidyverse)<br><span>library</span>(sscVis)<br><span>library</span>(Seurat)<br><span>library</span>(tidyverse)<br><span>library</span>(readr)<br><span>library</span>(qs)<br><span>library</span>(BiocParallel)<br>register(MulticoreParam(workers = <span>8</span>, progressbar = <span>TRUE</span>)) <br><br>load(<span>"scRNA.Rdata"</span>) <span># 老演员了</span><br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>2.数据预处理</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>dat  &lt;- scRNA@meta.data<br><br><span># 提取两种T细胞数据</span><br>data &lt;- dat[dat$celltype %<span>in</span>% c(<span>"CD4+ T-cells"</span>, <span>"CD8+ T-cells"</span>), ]<br><span># 创造出不同的组织</span><br>data$tissue &lt;- c(rep(<span>"N"</span>,<span>800</span>),rep(<span>"T"</span>,<span>754</span>))<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>3.Ro/e分析</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>colnames(data)<br>data &lt;- data[,c(<span>1</span>,<span>8</span>:<span>10</span>)]<br>colnames(data) &lt;- c(<span>"patient"</span>,<span>"clone.id"</span>,<span>"majorCluster"</span>,<span>"loc"</span>)<br>data$Cell_Name &lt;- c(<span>"T cell"</span>)<br>data$patient &lt;- as.character(data$patient)<br>data$clone.id &lt;- as.character(data$clone.id)<br>data$majorCluster &lt;- as.character(data$majorCluster)<br>data$loc &lt;- as.character(data$loc)<br><br>Roe &lt;- calTissueDist(data,<br>         byPatient = <span>F</span>,<br>         colname.cluster = <span>"majorCluster"</span>, <span># 不同细胞亚群</span><br>         colname.patient = <span>"patient"</span>, <span># 不同样本</span><br>         colname.tissue = <span>"loc"</span>, <span># 不同组织</span><br>         method = <span>"chisq"</span>, <span># "chisq", "fisher", and "freq" </span><br>         min.rowSum = <span>0</span>) <br>Roe<br><span>#                           N         T</span><br><span># CD4+ T-cells      0.9992205 1.0008271</span><br><span># CD8+ T-cells      1.0014351 0.9984773</span><br></code></pre><p data-tool="mdnice编辑器">Roe这是最关键的值，然后进行可视化即可，甚至不可视化直接放一个excel表格在附件或者正文中也可以。</p><h5 data-tool="mdnice编辑器"><span></span><span>4.可视化</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>col_fun &lt;- colorRamp2(c(min(Roe, na.rm = <span>TRUE</span>), <span>1</span>, max(Roe, na.rm = <span>TRUE</span>)), <br>                      c(<span>"blue"</span>, <span>"white"</span>, <span>"red"</span>))<br>Heatmap(as.matrix(Roe),<br>        show_heatmap_legend = <span>TRUE</span>, <br>        cluster_rows = <span>TRUE</span>, <br>        cluster_columns = <span>TRUE</span>,<br>        row_names_side = <span>'right'</span>, <br>        show_column_names = <span>TRUE</span>,<br>        show_row_names = <span>TRUE</span>,<br>        col = col_fun,<br>        row_names_gp = gpar(fontsize = <span>10</span>),<br>        column_names_gp = gpar(fontsize = <span>10</span>),<br>        heatmap_legend_param = list(<br>          title = <span>"Ro/e Index"</span>,  <span># 自定义图注名称</span><br>          at = seq(<span>0.5</span>, <span>1.5</span>, by = <span>0.5</span>), <span># 例刻度的位置/自己的数据必须修改一下！</span><br>          labels = seq(<span>0.5</span>, <span>1.5</span>, by = <span>0.5</span>) <span># 每个刻度的标签/自己的数据必须修改一下！</span><br>        ),<br>        cell_fun = <span>function</span>(j, i, x, y, width, height, fill) {<br>          grid.text(sprintf(<span>"%.2f"</span>, Roe[i, j]), x, y, gp = gpar(fontsize = <span>8</span>, col = <span>"black"</span>))<br>        }<br>)<br><span># cell_fun = function(j, i, x, y, width, height, fill)</span><br><span># j 和 i：分别表示单元格的列和行索引。</span><br><span># x 和 y：是单元格的中心位置坐标，用于确定文本的位置。</span><br><span># width 和 height：表示单元格的宽度和高度，可以用来调整文本位置或大小。</span><br><span># fill：表示单元格的背景颜色。</span><br></code></pre><p data-tool="mdnice编辑器">不要在意这张奇怪的图，仅仅是一个可视化。<img data-imgfileid="100002416" data-ratio="1.1723356009070294" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEbrLaq1HATQdQfcq6pgjH1Jw1bIdlibnmfIvJq2KL8eM0AjgGUd2ib5icr1ywQcPVHMp8rdRdKZ8ucg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="441" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEbrLaq1HATQdQfcq6pgjH1Jw1bIdlibnmfIvJq2KL8eM0AjgGUd2ib5icr1ywQcPVHMp8rdRdKZ8ucg/640?wx_fmt=png&amp;from=appmsg"></p><h4 data-tool="mdnice编辑器"><span></span><span>参考资料：</span><span></span></h4><ol data-tool="mdnice编辑器"><li><section>A pan-cancer single-cell transcriptional atlas of tumor infiltrating myeloid cells. Cell. 2021 Feb 4;184(3):792-809.e23.</section></li><li><section>Lineage tracking reveals dynamic relationships of T cells in colorectal cancer. Nature. 2018 Dec;564(7735):268-272.</section></li><li><section>github：https://github.com/Japrin/STARTRAC</section></li><li><section>生信侃侃谈：https://mp.weixin.qq.com/s/EW4WWfizX98uM8cqS-S1gg</section></li><li><section>TOP生物信息：https://mp.weixin.qq.com/s/GCubkqV6Xo2VwNeWG9Up0Q</section></li><li><section>BIO笔记本：https://mp.weixin.qq.com/s/AfYRmLEw1oXE5S8zr5UQDA</section></li><li><section>生信随笔：https://mp.weixin.qq.com/s/oHzfFx02Kp5w2x_v3l9iKw</section></li></ol><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。更多内容可关注公众号：<strong>生信方舟</strong></p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/MYIGKrskIWp5FXhSQffSYA",target="_blank" rel="noopener noreferrer">原文链接</a>
