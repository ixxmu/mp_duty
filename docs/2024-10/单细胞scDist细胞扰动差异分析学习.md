---
title: "单细胞scDist细胞扰动差异分析学习"
date: 2024-10-04T14:14:05Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
单细胞scDist细胞扰动差异分析学习 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">scDist通过分析不同状态下细胞的距离来找到差异最大的细胞亚群(见下图的A)，然后再分析每一个细胞亚群的PCA通过线性的混合模型并结合最终的系数去预估不同干预方式下细胞群之间的距离。</p><p data-tool="mdnice编辑器">Augur是通过对每一个细胞进行AUC评分并排序最终找到扰动最佳的细胞群，开发者认为Augur忽略了样本间的异质性，可能会导致由于样本本身的异质性而导致差异的出现。</p><p data-tool="mdnice编辑器">笔者在回溯Augur代码的时候发现开发者其实已在函数中设置了矫正参数(可以用于批次矫正/样本矫正等)，但开发者认为Augur并不能很好的把样本误差更抹去(可以读一读参考资料中的scDist的文章)，即使使用了harmony去矫正之后也无法处理的很完美。</p><p data-tool="mdnice编辑器">但笔者认为我们并不应该去重点关注样本间的差异，因为样本间的差异就应该是存在的，要以一个整体去看待纳入分析的样本，因此不同干预方式去处理了样本之后出现的扰动差异是样本本身的异质性导致的，但是也有可能是真实存在的扰动结果。</p><p data-tool="mdnice编辑器">因此笔者认为scDist可以作为Augur的辅助分析，来验证Augur的结果。<img data-imgfileid="100002253" data-ratio="0.8456090651558074" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0lCJ6tniboA24qcaGPXc6vG9oMqt6qnPVLjibzhgzpCzVggfznA3uuuZQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="706" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0lCJ6tniboA24qcaGPXc6vG9oMqt6qnPVLjibzhgzpCzVggfznA3uuuZQ/640?wx_fmt=png&amp;from=appmsg"></p><h4 data-tool="mdnice编辑器"><span></span><span>分析流程</span><span></span></h4><h5 data-tool="mdnice编辑器"><span></span><span>1.导入</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>V5_path = <span>"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/seurat5/"</span><br>.libPaths(V5_path)<br>.libPaths()<br><span>library</span>(stringr)<br><span>library</span>(Seurat)<br><span>library</span>(scDist)<br><span>library</span>(dplyr)<br><span>library</span>(patchwork)<br><span>library</span>(viridis)<br><span>library</span>(qs)<br><span>library</span>(BiocParallel)<br>register(MulticoreParam(workers = <span>4</span>, progressbar = <span>TRUE</span>))<br><br>load(<span>"scRNA.Rdata"</span>)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>2.数据预处理</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span># check</span><br>table(scRNA$orig.ident)<br>table(scRNA$celltype)<br><br>dat &lt;- scRNA@meta.data<br><span># 增加一下批次信息,转换成数字</span><br>dat$batch &lt;- ifelse(grepl(<span>"sample2|sample4|sample6"</span>, dat$orig.ident), <span>"1"</span>, <span>"2"</span>)<br><span># 增加一下分组信息，这里是随意编造的</span><br>dat$group &lt;- ifelse(grepl(<span>"sample[1-3]"</span>, dat$orig.ident), <span>"con"</span>, <span>"treat"</span>)<br>scRNA@meta.data &lt;- dat<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>3.scDist分析</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>dat &lt;- GetAssayData(scRNA,layer = <span>"counts"</span>) <span>#其实是需要normalize data，但这样也行</span><br>out &lt;- scDist(dat,scRNA@meta.data,<br>              fixed.effects = <span>"group"</span>,<br>              random.effects=<span>"batch"</span>,<br>              clusters=<span>"celltype"</span>)<br>qsave(out,<span>"out.qs"</span>)<br><br>out$results<br><span>#                      Dist. 95% CI (low) 95% CI (upper)        p.val</span><br><span># CD4+ T-cells      113.06663     85.67429      141.45175 0.0000099999</span><br><span># Fibroblasts       583.03755    522.70365      658.58584 0.0000099999</span><br><span># B-cells           211.53939     45.76088      443.12152 0.7932920671</span><br><span># CD8+ T-cells      138.91180    116.46147      162.53086 0.0000099999</span><br><span># Neutrophils        42.07108     34.69947       48.30078 0.0000099999</span><br><span># Monocytes         165.83546     76.16444      221.11992 0.0000099999</span><br><span># Adipocytes         89.43945     61.25896      119.64719 0.0000099999</span><br><span># NK cells          118.44792     34.25347      175.22504 0.0000099999</span><br><span># Endothelial cells   0.00000      0.00000       66.57318 0.2874671253</span><br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>4.可视化</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>DistPlot(out)<br></code></pre><p data-tool="mdnice编辑器">scDist分析结果，细胞的排序和Augur的AUC分数排序存在较大的不同。<img data-imgfileid="100002255" data-ratio="0.7230514096185738" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0CY0lI44TtyPdia8aGBD2upQLjFEQvmcc6ozmmKmRu3Wkf9T1EVBib7yw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1206" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0CY0lI44TtyPdia8aGBD2upQLjFEQvmcc6ozmmKmRu3Wkf9T1EVBib7yw/640?wx_fmt=png&amp;from=appmsg">Augur分析结果<img data-imgfileid="100002252" data-ratio="0.9976190476190476" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0dIreGGc7u895o8MXOr1vhicKF8xTqNicJyFc92fy6ic0TnteeGRvUEL3w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="840" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0dIreGGc7u895o8MXOr1vhicKF8xTqNicJyFc92fy6ic0TnteeGRvUEL3w/640?wx_fmt=png&amp;from=appmsg"></p><pre data-tool="mdnice编辑器"><span></span><code>distGenes(out, cluster = <span>"Fibroblasts"</span>)<br></code></pre><p data-tool="mdnice编辑器">展示一下差异基因<img data-imgfileid="100002256" data-ratio="0.7230514096185738" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0Qyjy4gkOv17Mhpa8Hf0kTW4qm1LgUWotux5RocICJg1ibGvjNHB3XGA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1206" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0Qyjy4gkOv17Mhpa8Hf0kTW4qm1LgUWotux5RocICJg1ibGvjNHB3XGA/640?wx_fmt=png&amp;from=appmsg"></p><pre data-tool="mdnice编辑器"><span></span><code>plotBetas(out,cluster = <span>"Fibroblasts"</span>)<br></code></pre><p data-tool="mdnice编辑器">不同主成分的影响程度<img data-imgfileid="100002254" data-ratio="0.809433962264151" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0H2ibhVibgN2ZR1VgibyFJrlfH0ROZiazOtxmSAnmlfic2MKibPiatVp7zbSag/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1060" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0H2ibhVibgN2ZR1VgibyFJrlfH0ROZiazOtxmSAnmlfic2MKibPiatVp7zbSag/640?wx_fmt=png&amp;from=appmsg"></p><pre data-tool="mdnice编辑器"><span></span><code>FDRDistPlot(out)<br></code></pre><p data-tool="mdnice编辑器">这个图既说明了不同细胞亚群之间的距离差异排序，也说明了不同处理后细胞亚群是否存在统计学差异。<img data-imgfileid="100002261" data-ratio="0.7308347529812607" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0H9FboibbqVWSN2EROSgl3n7WjgqbnNpGls2wicEXXmV6RQ8hoFfmbXjw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1174" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyG1YTbZm16wiaYPAsA1Z2xI0H9FboibbqVWSN2EROSgl3n7WjgqbnNpGls2wicEXXmV6RQ8hoFfmbXjw/640?wx_fmt=png&amp;from=appmsg">所有的图片都是基于ggplot绘制的，可以提取原始数据自行修改美化。</p><h4 data-tool="mdnice编辑器"><span></span><span>参考资料：</span><span></span></h4><p data-tool="mdnice编辑器">1、Robust identification of perturbed cell types in single-cell RNA-seq data. Nat Commun.2024 Sep 1;15(1):7610.</p><p data-tool="mdnice编辑器">2、scDist:</p><p data-tool="mdnice编辑器">https://github.com/phillipnicol/scDist/tree/master</p><p data-tool="mdnice编辑器">3、生信碱移：</p><p data-tool="mdnice编辑器">https://mp.weixin.qq.com/s/N-XEc9xFCnwf4PHbaraGaw</p><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。更多内容可关注公众号：<strong>生信方舟</strong></p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Ib26DiUXadSr5EBcfwYj9Q",target="_blank" rel="noopener noreferrer">原文链接</a>
