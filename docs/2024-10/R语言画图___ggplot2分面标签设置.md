---
title: "R语言画图 | ggplot2分面标签设置"
date: 2024-10-17T02:04:32Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
R语言画图 | ggplot2分面标签设置 by 被炸熟的虾
------
<div><section><strong><span>前言：</span></strong></section><p><span><span>分面（</span><span>facet</span><span>）是</span><code><span>ggplot2</span></code><span>的一个常用功能，当绘制的指标过多时，我们可以利用</span><span>facet</span><span>函数分类绘图，使得数据展示完整且美观。</span></span></p><p><span>本文使用</span><span>R</span><span>内置数据集</span><span>mpg</span><span>进行演示，该数据集包含</span><span>11</span><span>个变量，包括汽车的品牌、型号、车型、发动机排量、气缸数量、马力、重量、加速度、型号年份、产地和燃油经济性能等。以下是每个变量的详细说明：</span></p><ol><li><section><span>manufacturer</span><span>（制造商）：汽车制造商的名称。</span></section></li><li><section><span>model</span><span>（型号）：汽车的型号。</span></section></li><li><section><span>displ</span><span>（发动机排量）：汽车发动机的排量（升）。</span></section></li><li><section><span>year</span><span>（型号年份）：汽车的型号年份。</span></section></li><li><section><span>cyl</span><span>（气缸数量）：汽车发动机的气缸数量。</span></section></li><li><section><span>trans</span><span>（变速器类型）：汽车的变速器类型。</span></section></li><li><section><span>drv</span><span>（驱动方式）：汽车的驱动方式（前驱、后驱或四驱）。</span></section></li><li><section><span>cty</span><span>（城市里程）：汽车的城市里程（每加仑）。</span></section></li><li><section><span>hwy</span><span>（高速公路里程）：汽车的高速公路里程（每加仑）。</span></section></li><li><section><span>fl</span><span>（燃料类型）：汽车使用的燃料类型。</span></section></li><li><section><span>class</span><span>（车型）：汽车的车型。</span></section></li></ol><pre><code><span>library</span>(ggplot2)<br>mpg$manufacturer &lt;- factor(mpg$manufacturer,levels = unique(mpg$manufacturer))<br>mpg$model &lt;- factor(mpg$model,levels = unique(mpg$model))<br>mpg$trans &lt;- factor(mpg$trans,levels = unique(mpg$trans))<br>mpg$drv &lt;- factor(mpg$drv,levels = unique(mpg$drv))<br>mpg$fl &lt;- factor(mpg$fl,levels = unique(mpg$fl))<br>mpg$class &lt;- factor(mpg$class,levels = unique(mpg$class))<br>summary(mpg)<br><span>#     manufacturer                 model         displ            year           cyl       </span><br><span># dodge     :37    caravan 2wd        : 11   Min.   :1.600   Min.   :1999   Min.   :4.000  </span><br><span># toyota    :34    ram 1500 pickup 4wd: 10   1st Qu.:2.400   1st Qu.:1999   1st Qu.:4.000  </span><br><span># volkswagen:27    dakota pickup 4wd  :  9   Median :3.300   Median :2004   Median :6.000  </span><br><span># ford      :25    mustang            :  9   Mean   :3.472   Mean   :2004   Mean   :5.889  </span><br><span># chevrolet :19    civic              :  9   3rd Qu.:4.600   3rd Qu.:2008   3rd Qu.:8.000  </span><br><span># audi      :18    jetta              :  9   Max.   :7.000   Max.   :2008   Max.   :8.000  </span><br><span># (Other)   :74    (Other)            :177                                                 </span><br><span>#        trans    drv          cty             hwy        fl             class   </span><br><span># auto(l4)  :83   f:106   Min.   : 9.00   Min.   :12.00   p: 52   compact   :47  </span><br><span># manual(m5):58   4:103   1st Qu.:14.00   1st Qu.:18.00   r:168   midsize   :41  </span><br><span># auto(l5)  :39   r: 25   Median :17.00   Median :24.00   e:  8   suv       :62  </span><br><span># manual(m6):19           Mean   :16.86   Mean   :23.44   d:  5   2seater   : 5  </span><br><span># auto(s6)  :16           3rd Qu.:19.00   3rd Qu.:27.00   c:  1   minivan   :11  </span><br><span># auto(l6)  : 6           Max.   :35.00   Max.   :44.00           pickup    :33  </span><br><span># (Other)   :13                                                   subcompact:35  </span><br>head(mpg)<br><span># A tibble: 6 × 11</span><br><span>##  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class  </span><br><span>#  &lt;fct&gt;        &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt;      &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  </span><br><span>#1 audi         a4      1.8  1999     4 auto(l5)   f        18    29 p     compact</span><br><span>#2 audi         a4      1.8  1999     4 manual(m5) f        21    29 p     compact</span><br><span>#3 audi         a4      2    2008     4 manual(m6) f        20    31 p     compact</span><br><span>#4 audi         a4      2    2008     4 auto(av)   f        21    30 p     compact</span><br><span>#5 audi         a4      2.8  1999     6 auto(l5)   f        16    26 p     compact</span><br><span>#6 audi         a4      2.8  1999     6 manual(m5) f        18    26 p     compact</span><br></code></pre><p><span>我们看一个简单的例子：使用</span><span>R</span><span>内置数据集</span><span>mpg</span><span>查看</span><span>displ</span><span>（发动机排量）与</span><span>hwy</span><span>（高速公路里程）的相关性：</span></p><pre><code><span>library</span>(ggplot2)<br><span>library</span>(patchwork)<br><span>library</span>(ggpubr)<br>p1 &lt;- ggplot(mpg, aes(displ, hwy)) + <br>      geom_point(size = <span>3</span>,col = <span>"#88c4e8"</span>) +<br>      labs(x = <span>"Engine displacement"</span>, y = <span>"Highway miles per gallon"</span>) +<br>      guides(colour = <span>"none"</span>) + theme_bw(base_size = <span>18</span>) +<br>      stat_cor(aes(label = paste(..r.label.., ..p.label.., sep = <span>'~`,`~'</span>)), <br>              method = <span>'spearman'</span>, <br>              label.x.npc = <span>'left'</span>, label.y.npc = <span>'top'</span>, size = <span>6</span>) <br></code></pre><p><img data-imgfileid="100004796" data-ratio="0.41388888888888886" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KlCXphibEC5uJ9icvnL1fqPRbQGZRJeYJbhBqWRDMYUH9GqNPjszd3pbsmEs2x0DBfoSZYKvGSzfJw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KlCXphibEC5uJ9icvnL1fqPRbQGZRJeYJbhBqWRDMYUH9GqNPjszd3pbsmEs2x0DBfoSZYKvGSzfJw/640?wx_fmt=png&amp;from=appmsg"></p><p><span>如果我们想</span><span>分别检查不同<span>class</span><span>（车型）中</span>这一相关性是否依然存在，那就可以按照</span><span>class</span><span>分面，这样就不用提取数据分别绘图。</span></p><pre><code>p2 &lt;- p1 + facet_wrap(~ class)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004772" data-ratio="0.8067860508953817" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFj0dtyjTVqWNN2WMJO0Fibia4QtBEAstsATy5Yibrx7m8cPzOTgJKLZHZA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1061" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFj0dtyjTVqWNN2WMJO0Fibia4QtBEAstsATy5Yibrx7m8cPzOTgJKLZHZA/640?wx_fmt=png&amp;from=appmsg"></p><p><span><span>可以看到初始图中的点按照</span><span>class</span><span>拆分为多个子图，以上每个子图对应顶部标签所示分组。</span></span></p><hr><p><span></span></p><p><span>下面我们开始系统记录一下</span><code><span>ggplot2</span></code><span>的分面方法。</span><code><span>ggplot2</span></code><span>包提供了两种分面方法：</span></p><ul><li><section><strong><span>一维分面</span></strong><span>：</span><code><span>facet_wrap()</span></code><span>函数。<span>将数据根据一个或多个变量进行分面，按行或列进行排列</span></span><span>，</span><span>仅是分面图</span><span>逐个排列，例如左到右，上到下。</span></section></li><li><section><strong><span>二维分面</span></strong><span>：</span><code><span>facet_grid()</span></code><span>函数。<span>考虑</span><span>分</span><span>面方向，</span></span><strong><span><span><span>可以同时控制行和列的分面，</span>形成table网格对照关系。</span></span><span>适合用来表示两个变量的交互效应</span></strong><span>。</span></section></li></ul><h2><span>一、一维面板<span></span></span></h2><p><code><span>facet_wrap()</span></code><span>函数的写法比较多样，例如如果我们想按照</span><span>class</span><span>（车型）分组，达到和上例相同的效果，还可以写作：</span></p><pre><code>p1 + facet_wrap(facets = vars(class))<br>p1 + facet_wrap(facets = class ~ .)<br>p1 + facet_wrap(facets = . ~ class)<br></code></pre><section><strong><span>多变量叠加</span></strong><br></section><section><span>如果想再叠加一层其他变量，比如</span><span>year</span><span>（型号年份）可以按照如下写法：</span></section><pre><code>table(mpg$class,mpg$year)            <br><span>#             1999 2008</span><br><span>#  compact      25   22</span><br><span>#  midsize      20   21</span><br><span>#  suv          29   33</span><br><span>#  2seater       2    3</span><br><span>#  minivan       6    5</span><br><span>#  pickup       16   17</span><br><span>#  subcompact   19   16</span></code></pre><pre><code>p1 + facet_wrap(facets = vars(class, year))<br>p1 + facet_wrap(facets = c(<span>"class"</span>, <span>"year"</span>))<br>p1 + facet_wrap(facets = ~ class + year)<br>p1 + facet_wrap(facets = ~ class ~ year)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004773" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFvf37UKbNWzafgTTmhiaMbtIhL4S8sQapS4fhUsH5atoEUQqnCA4o4Bw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFvf37UKbNWzafgTTmhiaMbtIhL4S8sQapS4fhUsH5atoEUQqnCA4o4Bw/640?wx_fmt=png&amp;from=appmsg"></p><p><span>获得了</span><span>7×2=14</span><span>个子图，第一个子图中的每个点就代表</span><span>1999</span><span>年的</span><span>compact</span><span>车型的</span><span>displ</span><span>（发动机排量）与</span><span>hwy</span><span>（</span><span>高速公路里程）。</span></p><p><strong><span>调整输入列名的顺序即可修改分面标签的顺序</span></strong><span>（另几种写法同理）：</span></p><pre><code>p1 + facet_wrap(facets = ~ year + class)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004774" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFPVGn5lkCRGzS41jaq6pOXlBgczA3msvSPD8UL7eeDmAFjJZA9lGf8g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFPVGn5lkCRGzS41jaq6pOXlBgczA3msvSPD8UL7eeDmAFjJZA9lGf8g/640?wx_fmt=png&amp;from=appmsg"></p><section><strong><code><span>facet_wrap()</span></code><span>函数提供了很多参数用于分面的调整</span></strong><span>，主要包括：</span></section><ul><li><section><code><span>nrow</span></code><span>,</span><code><span>ncol</span></code><span>：设置分面排列成的行和列数；</span></section></li><li><section><code><span>scales</span></code><span>：设置坐标轴刻度是否固定。默认为</span><span>"</span><code><span>fixed</span></code><span>"</span><span>，所有分面的坐标轴刻度范围一致</span><span>；设置为</span><span>"</span><code><span>free</span></code><span>"</span><span>则会自动适配<span>分面的</span>数据范围自由调整，也可以单独设置成</span><span>"</span><code><span>free_x</span></code><span>"</span><span>或"</span><code><span>free_y</span></code><span>"</span><span>；</span></section></li><li><section><code><span>shrink</span></code><span>：也和坐标轴刻度有关，如果为</span><code><span>TRUE</span></code><span>（默认值）则按统计后的数据调整刻度范围，否则按统计前的数据设定坐标；</span></section></li><li><section><code><span>drop</span></code><span>：表示是否去掉没有数据的分组，默认情况下不显示，逻辑值为</span><code><span>FALSE</span></code><span>；</span></section></li><li><section><code><span>as.table</span></code><span>：和小图排列顺序有关的选项。如果为</span><code><span>TRUE</span></code><span>（默认）则按表格方式排列，即最大值（指分组</span><span>level</span><span>值）排在表格最后即右下角，否则排在左上角；</span></section></li><li><section><code><span>margins</span></code><span>：</span><span>是否设置一个所有分组的综合统计分面，默认情况为</span><code><span>FALSE</span></code><span>，即不设置；</span></section></li><li><section><code><span>space</span></code><span>：设置分面空间是否可以按照数据进行缩放，参数和</span><code><span>scales</span></code><span>一样；</span></section></li><li><section><code><span>labeller</span></code><span>：设置分面标签，默认直接显示分面变量的值，也可以简单加上变量的名称，如：</span><span>"</span><code><span>label_both</span></code><span>"。</span></section></li></ul><section><strong><span>我们记录几个常用参数示例：</span></strong><span></span></section><section><strong><span><br></span></strong></section><h3><span><strong><span>修改分面标签内容</span></strong></span></h3><section><span>分面标签默认直接展示不同分组变量的值。有时候不止一个分组，为了直观区分来源，可以通过</span><code><span>labeller</span></code><span>参数把组名也加上：</span></section><pre><code>p1 + facet_wrap(facets = ~ year + class, labeller = <span>"label_both"</span>)<br>p1 + facet_wrap(facets = ~ year + class, labeller = label_both)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004775" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFYLOx9rChjzPIQgvpFwM2US7AVy0jwfX1Rc9A0A8PISFpOpguZXydYw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFYLOx9rChjzPIQgvpFwM2US7AVy0jwfX1Rc9A0A8PISFpOpguZXydYw/640?wx_fmt=png&amp;from=appmsg"></p><p><span>我们还可以自定义函数，比如我们定义一个对输入年份截取</span><span>3-4</span><span>位数字的函数，然后使用</span><code><span>labeller</span></code><span>函数转换为参数传递给</span><code><span>labeller</span></code><span>选项：</span></p><pre><code>SUB &lt;- <span>function</span>(x) {<br>  substr(as.character(x), <span>3</span>, <span>4</span>)<br>}<br>p1 + facet_wrap(facets = ~ year + class, <br>                labeller = labeller(year = SUB))<br></code></pre><p><img data-galleryid="" data-imgfileid="100004776" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgF7xlgCCfFyjn7IUicQYQBdEVLkRmr5ibX9feLToKA3ZE7H0ZH4uIdxUfg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgF7xlgCCfFyjn7IUicQYQBdEVLkRmr5ibX9feLToKA3ZE7H0ZH4uIdxUfg/640?wx_fmt=png&amp;from=appmsg"></p><p><span>或者直接指定替换内容，例如</span><span>1999</span><span>年换成</span><span>20</span><span>世纪，</span><span>2008</span><span>年换成</span><span>21</span><span>世纪（我学不好生物是有原因的<img data-ratio="1" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Yellowdog.png" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Yellowdog.png">）</span></p><pre><code>year2 &lt;- c(<span>"1999"</span> = <span>"20th century"</span>, <span>"2008"</span> = <span>"21st century"</span>)<br>p1 + facet_wrap(facets = ~ year + class, <br>                labeller = labeller(year = year2))<br></code></pre><p><img data-galleryid="" data-imgfileid="100004779" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgF5J20x8ExRsU1BvfBpkToiaFV9ibibP0YINEVHNTia6w2MqbBcjeBnd7M0g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgF5J20x8ExRsU1BvfBpkToiaFV9ibibP0YINEVHNTia6w2MqbBcjeBnd7M0g/640?wx_fmt=png&amp;from=appmsg"></p><h3><span><strong><span>调整分面标签位置</span></strong></span></h3><p><span>使用</span><code><span>strip.position</span></code><span>函数可以调整分面标签的位置，例如调整至右方：</span></p><pre><code>p1 + facet_wrap(facets = ~ year, strip.position = <span>"right"</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004780" data-ratio="1.125" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFc1erDknklBehwC1j9qvok3ddAFwlF8d6tzE4546EJQCFc3RAzx1Ncg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFc1erDknklBehwC1j9qvok3ddAFwlF8d6tzE4546EJQCFc3RAzx1Ncg/640?wx_fmt=png&amp;from=appmsg"></p><p><span>这一方法我们之前也写过一个例子：</span><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247488405&amp;idx=1&amp;sn=15d7a1f1e37a542b2dfe59df64fd6a35&amp;scene=21#wechat_redirect" data-linktype="2"><span><strong><span>图片复现 | 富集分析条形图-调整分面标记的位置</span></strong></span></a></p><p><img data-imgfileid="100004770" data-ratio="0.5296296296296297" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LXK8WZzFle3E9kPYuviaJ5vdcSwNDWqicDcgKd3icIVQLDhGBDWgq55iceZLibPZqViacsDia3RFmtOfq8w/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LXK8WZzFle3E9kPYuviaJ5vdcSwNDWqicDcgKd3icIVQLDhGBDWgq55iceZLibPZqViacsDia3RFmtOfq8w/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><h3><span><strong><span>调整分面展示顺序</span></strong></span></h3><p><span>分面本身堆砌的顺序也可以调整。在</span><code><span>facet_wrap()</span></code><span>中的</span><code><span>dir</span></code><span>参数默认值为</span><code><span>h</span></code><span>（水平方向），</span><code><span>as.table</span></code><span>参数默认值为</span><code><span>TRUE</span></code><span>，它会按照我们日常看表格的习惯来从上至下，从左至右排布。以下图为例：</span><span></span></p><pre><code>p1 + facet_wrap(facets = ~ year + class, labeller = <span>"label_both"</span>)<br></code></pre><section><span>我们设置了先</span><span>year</span><span>后</span><span>class</span><span>，因此会先按</span><span>year</span><span>再按</span><span>class</span><span>来排序。两个变量的各自顺序分别按照各自的因子（</span><span>levels</span><span>）顺序。</span></section><p><img data-galleryid="" data-imgfileid="100004781" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFa0PyIOnveye0ZCx4x7ibDKiamsw2EQMv0iaDkGcSRSPRNn5BLw6n6iaTAQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFa0PyIOnveye0ZCx4x7ibDKiamsw2EQMv0iaDkGcSRSPRNn5BLw6n6iaTAQ/640?wx_fmt=png&amp;from=appmsg"></p><p><span>如果要想按照垂直方向摆放图片，只需调整<code><span>dir</span></code><span>参数默认值为</span><code><span>v</span></code><span>（垂直方向）即可：</span></span></p><pre><code>p1 + facet_wrap(facets = ~ year + class, labeller = <span>"label_both"</span>, dir = <span>"v"</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004782" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgF4lly3TXgicuvra8vOicic1L6Xe08nsGkicBT2ibR5czasAHEYxbewCvTMaw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgF4lly3TXgicuvra8vOicic1L6Xe08nsGkicBT2ibR5czasAHEYxbewCvTMaw/640?wx_fmt=png&amp;from=appmsg"></p><p><span>而当</span><code><span>as.table</span></code><span>参数设置为</span><code><span>FALSE</span></code><span>时，则是按照绘图的逻辑，从下到上摆放（下次调整分组顺序时也要记得<span>绘图的逻辑与阅读顺序是反的<img data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/2_05.png" data-ratio="1" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/2_05.png"></span>）：</span></p><pre><code>p1 + facet_wrap(facets = ~ year + class, labeller = <span>"label_both"</span>,as.table = <span>F</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004783" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFNribF6vico2K211icJ75l6Iia3IbrBmVByibcib5ERQmrIYPmU0WXiceDIRfQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFNribF6vico2K211icJ75l6Iia3IbrBmVByibcib5ERQmrIYPmU0WXiceDIRfQ/640?wx_fmt=png&amp;from=appmsg"></p><h3><span><strong><span>调整分面行/列数</span></strong></span></h3><p><span>比如让所有分面排成一行或两列：</span></p><pre><code>p1 + facet_wrap(facets = ~ class, nrow = 1)<br>p1 + facet_wrap(facets = ~ class, ncol = 2)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004784" data-ratio="0.25" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFkO6ReCZVfrllsq0ibejN2LKaQcYIMzBpToeX9iaTa6w8z5XxAaicUsniaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFkO6ReCZVfrllsq0ibejN2LKaQcYIMzBpToeX9iaTa6w8z5XxAaicUsniaQ/640?wx_fmt=png&amp;from=appmsg"></p><h3><span><strong><span>根据数据自动浮动坐标轴范围</span></strong></span></h3><p><span>以上我们可以看到所有子图的坐标轴都是固定的（即所有子图完全一样，默认</span><code><span>scales = fixed</span></code><span>），如果想要坐标轴根据每个子图中的实际数值范围来决定，我们可以用设置</span><code><span>scales</span></code><span>选项为</span><code><span>free_x</span></code><span>（</span><span>X</span><span>轴自由浮动，固定</span><span>Y</span><span>轴）；</span><code><span>free_y</span></code><span>（</span><span>Y</span><span>轴自由<span>浮动</span>，固定</span><span>X</span><span>轴）；</span><code><span>free</span></code><span>（</span><span>X</span><span>和</span><span>Y</span><span>轴都自由<span>浮动</span>）。</span></p><pre><code>p1 + facet_wrap(facets = ~ class, ncol = <span>3</span>, scales = <span>'free'</span>)<br>p1 + facet_wrap(facets = ~ class, ncol = <span>3</span>, scales = <span>'free_y'</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004785" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFojXvSQFWpOhFU4ozF2l10DOuqb7SYicS5wLIgN7IChvWxJYukUiaicOUg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFojXvSQFWpOhFU4ozF2l10DOuqb7SYicS5wLIgN7IChvWxJYukUiaicOUg/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>之前更的一个帖子也许更能突出这一参数的价值</span></strong><span>：</span><a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247486809&amp;idx=1&amp;sn=5bf67d31a22dbe340345affe03df399e&amp;scene=21#wechat_redirect" data-linktype="2"><span><strong><span>R语言画图 | 箱线图（二）一个示例</span></strong></span></a></p><p><span>三组数据的组别并不完全一致，因此我们设置</span><code><span>facet_wrap(.~DataSet,scales = "free_x",nrow = 1)</span></code></p><p><img data-galleryid="" data-imgfileid="100004786" data-ratio="0.4888888888888889" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgF9FR5nH8q24zr22Qv4WGAU55fibynKz6mgia3JfzeoicVGicQT8rUcP9RLg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgF9FR5nH8q24zr22Qv4WGAU55fibynKz6mgia3JfzeoicVGicQT8rUcP9RLg/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>二、二维面板</span></h2><p><span>以上内容我们可以发现</span><code><span>facet_wrap()</span></code><span>函数结果</span><span>只有一个维度，它的排布没有行列的概念，只是根据子集作图然后按顺序排布。接下来我们了解一下使用</span><code><span>facet_grid()</span></code><span>函数。它既可以进行单分组，例如我们设置以</span><span>year</span><span>来按行分面，依旧有很多写法：</span></p><p><strong><span>按行分面<span>：</span></span></strong><span></span></p><pre><code>p1 + facet_grid(facets = year ~ .)<br>p1 + facet_grid(year ~ .)<br>p1 + facet_grid(rows = vars(year))<br>p1 + facet_grid(rows = <span>"year"</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004787" data-ratio="0.5833333333333334" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFFp9JNyRc6T1UabK1TzIgs07mtrC54KPsYM3fnb1EokzwxrzDWW5PRg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFFp9JNyRc6T1UabK1TzIgs07mtrC54KPsYM3fnb1EokzwxrzDWW5PRg/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>按列分面<span>：</span></span></strong><span></span></p><pre><code>p1 + facet_grid(facets = ~ year)<br>p1 + facet_grid(. ~ year)<br>p1 + facet_grid(cols = vars(year))<br></code></pre><p><img data-galleryid="" data-imgfileid="100004788" data-ratio="0.5833333333333334" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFcuf4YZYrBEIGR7DDWg0Pp3AIyNC7yYkHTtLkndQUa8ibuWcMsR15QxQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFcuf4YZYrBEIGR7DDWg0Pp3AIyNC7yYkHTtLkndQUa8ibuWcMsR15QxQ/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>也可以</span></strong><span><strong><span>既按行也按列</span></strong></span><strong><span>分面</span></strong><span>：这也是<code><span>facet_grid()</span></code><span>函数</span>的优势所在。例如行<span>按<span>year</span></span>，列<span>按</span><span>class</span>分面：</span></p><pre><code>p1 + facet_grid(year ~ class)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004789" data-ratio="0.6" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFs9m6miakoNiauicwUERsSSsQYVRjicDmXnOH2UDIvVQHQ21Srsh3hTqDLQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFs9m6miakoNiauicwUERsSSsQYVRjicDmXnOH2UDIvVQHQ21Srsh3hTqDLQ/640?wx_fmt=png&amp;from=appmsg"></p><p><span>亦或者<strong>持续叠加更多分组</strong>：</span></p><pre><code>p1 + facet_grid(drv ~ year + class)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004791" data-ratio="0.6" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFECCQNstwP9dfjJtSWmqKQV6wlib8xJ6g7VN15XH28oib5FapBBdSAPtQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFECCQNstwP9dfjJtSWmqKQV6wlib8xJ6g7VN15XH28oib5FapBBdSAPtQ/640?wx_fmt=png&amp;from=appmsg"></p><p><span>其他的参数使用和</span><code><span>facet_warp()</span></code><span>基本</span><span>一致，</span><span>例如：</span></p><h3><span><strong><span>根据数据自动浮动坐标轴范围</span></strong></span></h3><pre><code>p1 + facet_grid(year ~ class, scales = <span>"free"</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004792" data-ratio="0.6" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFVAqMoKotpD5ib7lib1tYPXr89PII2KqxQxe5ttrvRDdOkyY9Nh1AAwMw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFVAqMoKotpD5ib7lib1tYPXr89PII2KqxQxe5ttrvRDdOkyY9Nh1AAwMw/640?wx_fmt=png&amp;from=appmsg"><span></span></p><p><span></span></p><section><span><strong><span>添加一个额外的汇总分面：</span></strong></span></section><p><span></span><span>修改一个</span><code><span>margin</span></code><span>参数即可：</span><span></span></p><pre><code>p1 + facet_grid(year ~ class, scales = <span>"free"</span>, margins = <span>T</span>)<br></code></pre><p><span>如果只想显示其中一个分组方向的汇总数据，可以直接指定分面的变量名：</span></p><pre><code>p1 + facet_grid(year ~ class, scales = <span>"free"</span>, margins = <span>"year"</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004793" data-ratio="0.4722222222222222" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFHbak8btcBR4FTvEPu7nYhqP6OVbjWH35MBuHO4EiaQouSkaIYjl4UPA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3K0zbHKUyfKSoZhy5gibBhgFHbak8btcBR4FTvEPu7nYhqP6OVbjWH35MBuHO4EiaQouSkaIYjl4UPA/640?wx_fmt=png&amp;from=appmsg"></p><section><span>剩下的</span><span>就不</span><span>一一展示了</span></section><section><span><span><span><span><span><strong>总结</strong></span></span></span></span></span></section><ul data-v-md-line="29"><li><section><code><span>facet_wrap()</span></code><span>：</span><span>当你有一个分类变量，并希望快速查看不同类别的图形时，使用</span><code><span>facet_wrap()</span></code><span>更为简便。</span></section></li><section><span></span></section><li><section><code><span>facet_grid()</span></code><span>：</span><span>更适合用于显示两个相关变量之间的关系。</span><span>对于需要<strong>明确区分行和列时</strong>，比如分组比较，</span><code><span>facet_grid()</span></code><span>显得更为合适。</span></section></li><section><span></span></section><section><span></span></section></ul><section><span></span></section><h3><span><span><span><span><span><strong>参考文章：</strong></span></span></span></span></span></h3><p><span><strong><span>1、日常分享的小懒猫：</span></strong></span><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NjcxNzA1OQ==&amp;mid=2247487637&amp;idx=1&amp;sn=0842322129a0421145d72e5f80c7518d&amp;scene=21#wechat_redirect" data-linktype="2"><span><strong><span>R语言绘图|分面标签设置</span></strong></span></a></p><p><span><strong><span>2、狗图：</span></strong></span><a href="https://mp.weixin.qq.com/s?__biz=MzkzNTYwMjcwOA==&amp;mid=2247484596&amp;idx=1&amp;sn=737ca0d0494fe95142cd8d8ae9e744b1&amp;scene=21#wechat_redirect" data-linktype="2"><span><strong><span>ggplot2系列教程 第4节——分面</span></strong></span></a></p><p><span><strong><span>3、科研后花园：</span></strong></span><a href="https://mp.weixin.qq.com/s?__biz=MzkzODM4NzQ1NQ==&amp;mid=2247485848&amp;idx=1&amp;sn=de0860ee3f25ecf075e2c3cf1310346a&amp;scene=21#wechat_redirect" data-linktype="2"><span><strong><span>R可视化——ggplot2包实现图形分面技巧汇总</span></strong></span></a></p><p><span><strong><span>4、生态R学社：</span></strong></span><a href="https://mp.weixin.qq.com/s?__biz=Mzg3MjA3MDUxNQ==&amp;mid=2247491027&amp;idx=1&amp;sn=c8ed8d0b296ec9ec1f63aca107ac5074&amp;scene=21#wechat_redirect" data-linktype="2"><span><strong><span>ggplot2 facet ：绘制分面图的好帮手</span></strong></span></a></p><section><span><br></span></section><h3><span></span></h3><section><span></span></section><section><img data-imgfileid="100003752" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="png" data-w="341" src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section><section data-tools="135编辑器" data-id="116886" draggable="true"><section><section><section><section><strong data-brushtype="text">被炸熟的虾</strong></section></section></section><section><section><section data-width="35%"><section><img data-cropselx1="0" data-cropselx2="115" data-cropsely1="0" data-cropsely2="115" data-imgfileid="100003750" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="jpeg" data-w="258" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section></section><section data-width="63%"><section><section><strong>自己的摸索，发现问题麻烦告诉作者，光速回来改正</strong><strong><img data-imgfileid="100003751" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="png" data-w="64" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></strong></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Gg-d4M9W-TEw3nFglqbocg",target="_blank" rel="noopener noreferrer">原文链接</a>
