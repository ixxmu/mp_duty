---
title: "转录组上游分析流程(一）"
date: 2024-10-23T11:19:21Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
转录组上游分析流程(一） by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器"><span></span><span>流程一：</span><span></span></h4><p data-tool="mdnice编辑器">环境部署——数据下载——查看数据(非质控）</p><h4 data-tool="mdnice编辑器"><span></span><span>分析流程</span><span></span></h4><h5 data-tool="mdnice编辑器"><span></span><span>1.环境部署/软件安装：</span><span></span></h5><p data-tool="mdnice编辑器">尝试使用ARM架构(M1/M2芯片)去安装fastqc trim-galore hisat2 subread multiqc samtools salmon fastp，但这些软件中有几个是不兼容的。所以需要改回原来的x86_64架构(Intel芯片)，如果非mac/M1/M2的不需要用这种方式。</p><pre data-tool="mdnice编辑器"><span></span><code>CONDA_SUBDIR=osx-<span>64</span> conda create -n rna_x86_64 python=<span>3.9</span><br>conda activate rna_x86_64<br>conda install -y sra-tools<br>conda install -y fastqc trim-galore hisat2 subread multiqc samtools salmon fastp <br>conda install -y -c hcc aspera-cli<br></code></pre><p data-tool="mdnice编辑器">如果安装软件很慢的话可以先安装mamba再安装软件，比如：只需要把conda修改成mamba即可</p><pre data-tool="mdnice编辑器"><span></span><code>conda install -c conda-forge mamba<br>mamba install fastqc trim-galore hisat2 subread multiqc samtools salmon fastp<br></code></pre><p data-tool="mdnice编辑器">SRA-tools：一组用于访问和处理Sequence Read Archive (SRA) 数据的命令行工具。内含工具主要包括：</p><ol data-tool="mdnice编辑器"><li><section>prefetch：用于从 SRA 数据库下载测序数据。</section></li><li><section>fastq-dump：用于将下载的 SRA 文件转换为常见的 FASTQ 格式，以便进行进一步的分析。</section></li><li><section>fasterq-dump：fastq-dump 的改进版本，速度更快，适合处理大数据集。</section></li><li><section>sam-dump：用于将 SRA 数据转换为 SAM 格式（测序比对格式）。</section></li><li><section>vdb-config：配置 SRA 工具的参数，比如下载路径、缓存大小等。</section></li></ol><p data-tool="mdnice编辑器">FastQC：用于评估高通量测序数据的质量。</p><p data-tool="mdnice编辑器">Trim Galore：用于剪切测序数据中的低质量序列和接头序列。</p><p data-tool="mdnice编辑器">HISAT2：用于将RNA-Seq数据比对到参考基因组上。</p><p data-tool="mdnice编辑器">Subread：用于比对和量化RNA-Seq、DNA-Seq等高通量测序数据。</p><p data-tool="mdnice编辑器">MultiQC：用于整合并展示多个质控工具的结果。</p><p data-tool="mdnice编辑器">Samtools：用于处理比对后的SAM/BAM/CRAM文件。</p><p data-tool="mdnice编辑器">Salmon：用于RNA-Seq数据的转录本定量分析。</p><p data-tool="mdnice编辑器">Fastp：高效的测序数据质控和剪切工具。</p><p data-tool="mdnice编辑器">aspera CLI: IBM Aspera提供的命令行工具，用于通过Aspera的高速文件传输协议（Aspera FASP）传输大型文件和数据集。</p><h5 data-tool="mdnice编辑器"><span></span><span>2.创建工作目录</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>mkdir -p ~/RNA/Human-<span>3</span>-NPC-Tra<br>cd ~/RNA/Human-<span>3</span>-NPC-Tra<br><br>mkdir -p  rawdata  fastq_25000  qc  trim_galore  fastp hisat2 featureCounts<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100002617" data-ratio="0.7279411764705882" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3pRPWTicVWCWk9wrLXEr9LZDiaauns3lW6IeFJJBOxcpfHCXJje754Eqg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="544" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3pRPWTicVWCWk9wrLXEr9LZDiaauns3lW6IeFJJBOxcpfHCXJje754Eqg/640?wx_fmt=png&amp;from=appmsg"></figure><h5 data-tool="mdnice编辑器"><span></span><span>3.下载/解压缩数据</span><span></span></h5><h5 data-tool="mdnice编辑器"><span></span><span>下载数据</span><span></span></h5><p data-tool="mdnice编辑器">只要有SRR号，可以使用sra-tools工具中的prefetch进行下载。</p><p data-tool="mdnice编辑器">首先进入GEO的GSE227503数据集界面，拉到最下面进入SRA Run Selector<img data-imgfileid="100002619" data-ratio="0.558041958041958" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3eiaD2aWrQ3n1u20Po3TOM5Lvv0dkphHRWdJwXr6szAQoJsiakNRuaqQg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="715" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3eiaD2aWrQ3n1u20Po3TOM5Lvv0dkphHRWdJwXr6szAQoJsiakNRuaqQg/640?wx_fmt=png&amp;from=appmsg">接着获取Accession List<img data-imgfileid="100002620" data-ratio="0.18143100511073254" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3TjkOTsspvfgwgDvicFeYCNCtj7ibWf9CMwVlibTz2n15WqNxPPlF3pJCQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1174" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3TjkOTsspvfgwgDvicFeYCNCtj7ibWf9CMwVlibTz2n15WqNxPPlF3pJCQ/640?wx_fmt=png&amp;from=appmsg">得到三个SRR号码<img data-imgfileid="100002616" data-ratio="0.15315315315315314" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3oiaru1C8U4JxC3a5F27B2z9SzMOficy3z2bfVM17KufhicBGKUPbPCZGw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="444" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3oiaru1C8U4JxC3a5F27B2z9SzMOficy3z2bfVM17KufhicBGKUPbPCZGw/640?wx_fmt=png&amp;from=appmsg">开始下载，第一句是下载特定的数据，后一句是循环下载SRR_Acc_List中的数据</p><pre data-tool="mdnice编辑器"><span></span><code>prefetch SRR23881762 -O ./rawdata   <span>#-O . 指定到当前路径</span><br><br><span># cat SRR_Acc_List.txt | while read id; do (prefetch  ${id} );done #全部下载</span><br></code></pre><p data-tool="mdnice编辑器">cat SRR_Acc_List.txt: 使用 cat 命令显示并输出 SRR_Acc_List.txt 文件的内容</p><p data-tool="mdnice编辑器">while read id; do ... done: while 循环用于读取 SRR_Acc_List.txt 文件中的每一行内容，每次循环将一行内容存储在 id 变量中。read 命令会读取 SRR_Acc_List.txt 中的每一行，直到文件读取完毕。</p><p data-tool="mdnice编辑器">prefetch -X 100G <span><span role="presentation" data-formula="id: prefetch 是用来下载 SRA 数据的工具，这里使用它下载每一个 " data-formula-type="inline-equation"><embed src="https://mmbiz.qpic.cn/mmbiz_svg/wcib2GksmGOkoibE3a5Omm2tOmmOyQNCia7RK6o5GM33wfNtQIb3Yb8THB2iciby4RcoVImic5PY5dkryVHib4vn0Z0cQ7IIBiaEYq0g/0?wx_fmt=svg&amp;from=appmsg" data-type="svg+xml" data-imgfileid="100002615"></embed></span></span>id（每个 SRR 记录）。-X 100G: 选项 -X 用于设置下载文件的缓存大小，在这个例子中设置为 100GB，以确保处理较大文件时不会因为空间限制而出现问题。$id: 这是 while 循环中的 id，代表当前读取的 SRR 编号。&amp;: 这个符号将命令放入后台执行。</p><h6 data-tool="mdnice编辑器"><span></span><span>解压缩文件</span><span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>fasterq-dump SRR23881762.sra --split-files <span># 把双端测序文件分开</span><br>gzip *.fastq <span># 压缩fastq文件，但这一步会非常慢哦</span><br>rm *.fastq <span># 删除fastq文件</span><br></code></pre><p data-tool="mdnice编辑器">笔者没有压缩，因为有点慢<img data-imgfileid="100002618" data-ratio="0.25316455696202533" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3odJlFDdxQFgrgwzhKMPFHlZezSaD6Yib0W8z2NBvYoQug9N8icju4ObQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="790" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3odJlFDdxQFgrgwzhKMPFHlZezSaD6Yib0W8z2NBvYoQug9N8icju4ObQ/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100002623" data-ratio="0.1423728813559322" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3oOZPTYh1BaA0rx4iaR7zrJXyl8xSkgZiblTKibd6kHfaQiaG8ksk176ptQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1180" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3oOZPTYh1BaA0rx4iaR7zrJXyl8xSkgZiblTKibd6kHfaQiaG8ksk176ptQ/640?wx_fmt=png&amp;from=appmsg"></p><h5 data-tool="mdnice编辑器"><span></span><span>4.check数据(建议查看)</span><span></span></h5><p data-tool="mdnice编辑器">双端测序：一般一个样本对应两个fq文件，gz是压缩后缀。如SRR23881762.gz</p><p data-tool="mdnice编辑器">对应的为read1：SRR23881762_1.fastq.gz; read2: SRR23881762_2.fastq.gz</p><p data-tool="mdnice编辑器">fastq数据格式：高通量测序(如illumina NovaSeq等测序平台)得到的原始图像数据文件，经过碱基识别(Base calling)分析转化为原始测序序列(Sequenced Reads)，称之为Raw data或Raw reads，结果以FASTQ(简称为fq)文件格式存储，其中包含测序序列(Reads)的序列信息以及其对应的测序质量信息。</p><pre data-tool="mdnice编辑器"><span></span><code>head -n <span>8</span> SRR23881762_1.fastq <span># 查看前8行的数据</span><br></code></pre><p data-tool="mdnice编辑器"><strong>每4行为一个read</strong>：</p><ol data-tool="mdnice编辑器"><li><section>第1行主要储存序列测序时的坐标信息等。</section></li><li><section>第2行是测序得到的序列信息，一般用ATCGN(N 代表的是未确定的碱基（N 表示 "unknown" 或 "ambiguous" base）来表示。</section></li><li><section>第3行以“+”开始，可以储存一些附加信息，一般是空的。</section></li><li><section>第4行储存质量信息，与第2行的碱基序列一一对应。每个符号对应的ASCII值成为phred值，可以简单理解为对应位置碱基的质量，越大说明测序质量越好。<img data-imgfileid="100002624" data-ratio="0.11704119850187265" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3X1B3tk2KSX3tql8VR7eHyEPJc2xLGMWrficF9ZNYNicH5xLJVmdEFFaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="2136" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3X1B3tk2KSX3tql8VR7eHyEPJc2xLGMWrficF9ZNYNicH5xLJVmdEFFaA/640?wx_fmt=png&amp;from=appmsg">质量字符的ASCII值和质量得分的关系有如下两种：</section></li></ol><p data-tool="mdnice编辑器">Phred+64 质量字符的ASCII值 - 64/ Phred+33: 质量字符的ASCII值 - 33</p><p data-tool="mdnice编辑器">可以粗略分为 Phred+33和Phred+64，这里的33和64就是指ASCII值转换为得分需要减去的数值。<img data-imgfileid="100002625" data-ratio="0.43466666666666665" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz31tHLBuh0mNcgiaF0VYRY2ibep33Z8h9nicnZuztob1ajCd86c4UEJ9owQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="750" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz31tHLBuh0mNcgiaF0VYRY2ibep33Z8h9nicnZuztob1ajCd86c4UEJ9owQ/640?wx_fmt=png&amp;from=appmsg">统计reads_1.fq文件种共有多少条reads的方法</p><pre data-tool="mdnice编辑器"><span></span><code><span># zless 是一个用于查看压缩文件内容的命令</span><br><span># grep 是一个文本搜索工具，用于查找符合特定模式的行</span><br><span># wc 是 "word count" 的缩写，用于统计行数、单词数和字符数。-l 选项告诉 wc 只输出行数。</span><br><span># | 是管道符号，将 grep "@SRR" 的输出传递给 wc -l 作为输入，从而统计 @SRR 出现的次数。</span><br>zless  SRR23881762_1.fastq.gz | grep <span>"@SRR"</span> |wc -l<br><br><span># grep '^@SRR'：这里的 ^ 是正则表达式中的特殊符号，表示 "行首"。</span><br>zless  SRR23881762_1.fastq.gz | grep <span>'^@SRR'</span> |wc -l<br><br><span># paste：这是一个将多个行合并到一行的工具。</span><br><span># - - - -：这部分告诉paste命令每次读取四行并将它们拼接在一起</span><br><span># -S 表示不换行显示长行的内容</span><br>zless -S SRR23881762_1.fastq | paste - - - - |wc -l<br><br><span>#awk：这是一个文本处理工具。</span><br><span># $0/4：表示将 wc -l 计算的总行数除以 4，因为每4行代表一个完整的序列条目。</span><br>zless  SRR23881762_1.fastq |wc -l | awk <span>'{print $0/4}'</span><br><br><span># awk：这是一个文本处理工具，逐行处理输入的内容。NR：表示当前行号。</span><br><span># NR%4==2：这个条件判断用于选择每四行中的第2行，因为FASTQ文件的格式是每4行代表一个序列条目，而第2行是序列本身。NR%4是取行号对4的余数，NR%4==2 表示当行号除以4余2时，也就是第2行。</span><br><span># print：将满足条件的行打印出来，因此它会输出每个序列条目的序列部分。</span><br>zless -S SRR23881762_1.fastq |awk <span>'{ if(NR%4==2) {print} }'</span> |wc -l<br></code></pre><p data-tool="mdnice编辑器">使用了第一条代码，数据量大过程很慢，中途用Ctrl + T查看了一下数据，最后发现一共有3000万+的reads<img data-imgfileid="100002622" data-ratio="0.09018567639257294" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3TOBr9s4VFVKiaBIvz01AmzD8gL3bVIeIb6IkrT8XE4eMoUCjtJZppJQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1508" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEgshoxofxYNUeiaWNW9uqz3TOBr9s4VFVKiaBIvz01AmzD8gL3bVIeIb6IkrT8XE4eMoUCjtJZppJQ/640?wx_fmt=png&amp;from=appmsg">输出SRR23881762_1.fastq文件中所有的序列ID（即第一行）</p><pre data-tool="mdnice编辑器"><span></span><code>zless  SRR23881762_1.fastq | grep <span>'^@SRR'</span>  |less -S<br>zless  SRR23881762_1.fastq | paste - - - - |cut -f <span>1</span> |less -S<br>zless -S SRR23881762_1.fastq |awk <span>'{if(NR%4==1){print}}'</span> |less -S<br></code></pre><p data-tool="mdnice编辑器">输出SRR23881762_1.fastqz文件中所有的序列（即第二行）</p><pre data-tool="mdnice编辑器"><span></span><code>zless SRR23881762_1.fastq | paste - - - - |cut -f <span>2</span> |less -S<br>zless SRR23881762_1.fastq |awk <span>'{if(NR%4==2){print}}'</span> |less -S <br></code></pre><p data-tool="mdnice编辑器">统计SRR23881762_1.fastq碱基总数</p><pre data-tool="mdnice编辑器"><span></span><code><span># 简单版本</span><br>zless SRR23881762_1.fastq |paste - - - - |cut -f <span>2</span> |tr -d <span>'\n'</span> |wc -m<br>zless -S SRR23881762_1.fastq |paste - - - - |cut -f <span>2</span> |grep -o [ATCGN] |wc -l<br><br><span># awk的高阶用法：BEGIN END模块</span><br>zless -S SRR23881762_1.fastq |awk <span>'{ if(NR%4==2){print} }'</span> | awk <span>'BEGIN {num=0} {num=num+length($0)}  END{ print "num="num}'</span><br></code></pre><p data-tool="mdnice编辑器">查看reads拷贝数</p><pre data-tool="mdnice编辑器"><span></span><code>zless SRR23881762_1.fastq | paste - - - - | cut -f2 | sort | uniq -c | sort -nr | head<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span>参考资料：</span><span></span></h4><ol data-tool="mdnice编辑器"><li><section>Bioinformatics workbook: https://bioinformaticsworkbook.org/introduction/fastqquality-score-encoding.html#gsc.tab=0</section></li><li><section>生信技能树：https://mp.weixin.qq.com/s/dxoorMYHU-tlxMcICnTQTg</section></li><li><section>生信菜鸟团：https://mp.weixin.qq.com/s/Z5YNRkJ6tlY_tAeuUfL8SA</section></li><li><section>芒果师兄聊生信：https://mp.weixin.qq.com/s/X0SW5bKRgXZmlDJ-2eUjzQ</section></li></ol><p data-tool="mdnice编辑器"><strong>致谢</strong>：感谢曾老师以及生信技能树团队全体成员。</p><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。更多内容可关注公众号：<strong>生信方舟</strong></p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/bwUFJ-kBdUTp9WyQRQPnyg",target="_blank" rel="noopener noreferrer">原文链接</a>
