---
title: "流程更新----python版本分析10X HD数据（单样本）"
date: 2024-10-25T03:12:49Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞空间交响乐"
]
categories: ["Acdemic"]
---
流程更新----python版本分析10X HD数据（单样本） by 单细胞空间交响乐
------
<div><h4>作者，Evil Genius</h4><h4>我去，可以啊， 今年的第三次举报。</h4><h4>第一次举报在6月底刚上课不久，没有掀起什么风浪。</h4><h4>第二次举报在8月底课程上完，把我微信公众号的文章给举报了，然后大家就不能在这篇文章上报名了。</h4><h4>第三次举报就最近几天，昨天市场部的总监突变找我，把邮件拿出来给我看，说我被人举报了，把发邮件的邮箱号和ID查了查，不是公司的人，ID是外地的，邮箱号应该是临时的，问我最近得罪谁了？</h4><h4>这让我想起了2023年被医生还是医学生举报的情况，当时还稀里糊涂的，现在看起来，<strong><span>所有的事情都是有预谋的</span></strong>。</h4><h4>主要2023年就被举报了一次，2024年，已经三次了，有时候我在想，是不是自己的火的太快了？<span>让我躺平一会儿</span>。</h4><p><img data-imgfileid="100009696" data-ratio="1.7898148148148147" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8o6ZIRZY7voBMJodiavicjAe23Wibxa7lEg1zVfGKFJATesTkEUspREuEg/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8o6ZIRZY7voBMJodiavicjAe23Wibxa7lEg1zVfGKFJATesTkEUspREuEg/640?wx_fmt=other&amp;from=appmsg"></p><h4>我们再来分享一下课程内容吧，之前汇总过一次，文章在<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2MDY1NTYyOQ==&amp;mid=2247492666&amp;idx=1&amp;sn=d4d65130f71766e1cb79f18ec0ae59a1&amp;chksm=ce21bd58f956344e215d608d259d0efa9b46c11e8aa868cae9dcd8babeaadbf5ab9e314908ef&amp;scene=21#wechat_redirect" textvalue="课程汇总" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>课程汇总</span></a></h4><h4>2024年全系列单细胞空间课程，略有改动，包括单细胞六课，空间22课，2节汇总课程，空间包括Visium、HD、Xenium。</h4><p><img data-imgfileid="100009693" data-ratio="1.1677600749765698" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8ibktZxLzPpOFnOljSMENPQfVhN6jg0YFjoPib5AoicN804FjukN1tcECQ/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="1067" src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8ibktZxLzPpOFnOljSMENPQfVhN6jg0YFjoPib5AoicN804FjukN1tcECQ/640?wx_fmt=other&amp;from=appmsg"></p><h4>2024年的单细胞空间外显子6课，主要讲突变分析（单细胞 + 外显子）的，链接在<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg2MDY1NTYyOQ==&amp;mid=2247492778&amp;idx=1&amp;sn=8d634d8c8df1e22e7a64c709d6c156a8&amp;chksm=ce21bdc8f95634de8d2e032fa1981de4d6073b63589181f1427c8b4b1ff33f0b4cfef776d827&amp;scene=21#wechat_redirect" textvalue="2024年外显子分析系列课程" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>2024年外显子分析系列课程</span></a></h4><h4>2023年全系列空间课程表，也略有改动（基础分析 + 个性化分析）。</h4><p><img data-imgfileid="100009695" data-ratio="0.9322671683913453" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8tf0ia0niaMlgTyHoUkVILBGCnLVHp8hBrLyMmnxnwc7ibz179icOM28vZA/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="1063" src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8tf0ia0niaMlgTyHoUkVILBGCnLVHp8hBrLyMmnxnwc7ibz179icOM28vZA/640?wx_fmt=other&amp;from=appmsg"></p><h4><span>课程感觉怎么样，视频我都放开了，如果感觉可以，大家有条件下载下来保存一份，按照这个举报频率，下架不是没有可能，而且很快。</span></h4><h4>至于其中的资料，<span>有条件支持一下正版，我们加上微信，拉个群，多分享一些分析经验和最新的研究进展，处理处理大家分析上遇到的问题，没条件也没关系，现在盗版很多了，买一份认真学习就可以了。</span></h4><h4>还是那句话，做项目，钱多钱少大家没办法决定，但是大家能决定的是，机遇（样本）来临，能抓住（能分析好），就可以了。</h4><h4>好了，我们，我们要开始更新我们的分析流程了，我们以10X的官方示例数据为例，python分析单样本的HD数据，多样本整合我们放到下一篇。</h4><h4>首先看一下数据结构，</h4><p><img data-imgfileid="100009694" data-ratio="0.5090725806451613" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8U3EykKvn7mP3CuC3kumYPRBVjb7Hae6AHwYgJwnF5iaicXX0xg5v5tMA/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="992" src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8U3EykKvn7mP3CuC3kumYPRBVjb7Hae6AHwYgJwnF5iaicXX0xg5v5tMA/640?wx_fmt=other&amp;from=appmsg"></p><h4>其中最大的不同是，visium数据的空间坐标文件为tissue_positions_list.csv，而HD为了节省信息，采用的是tissue_positions.parquet,其中.parquet 文件是一种列式存储的二进制文件格式，常用于存储大规模数据集。它被设计为与 Apache Hadoop 和 Apache Spark 等大数据处理框架兼容，<span>我们将tissue_positions.parquet转换成tissue_positions_list.csv格式即可实现python的自动读取</span>，当然最好的方法就是大家跟我一样，直接封装，全流程直接转换运行。</h4><h4>转换后spatial下面的信息，多了一个csv文件，满足了我们的读取需求。</h4><p><img data-imgfileid="100009692" data-ratio="0.273989898989899" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8meklZibrTrQA3BTK9eib46Y6MKVLcK1tcS0diaza616FckzeicOP8374ww/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="792" src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ8meklZibrTrQA3BTK9eib46Y6MKVLcK1tcS0diaza616FckzeicOP8374ww/640?wx_fmt=other&amp;from=appmsg"></p><h4>接下来走全流程,我们以16um的数据为例，至于应该用8um 还是 16um，<span>要看大家的数据质量</span>。</h4><p><span aria-label="icon: copy"><svg viewbox="64 64 896 896" focusable="false" data-icon="copy" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></span></p><pre><code><span>import</span> numpy <span>as</span> np<br><span>import</span> pandas <span>as</span> pd<br><br><span>import</span> anndata <span>as</span> ad<br><span>import</span> scanpy <span>as</span> sc<br><span>import</span> squidpy <span>as</span> sq<br><br>####读取数据<br>adata <span>=</span> sc<span>.</span><span>read_visium</span><span>(</span><span>'/HD_data/breast_HD/binned_outputs/square_016um'</span><span>)</span><br>adata<br>AnnData object <span>with</span> n_obs × n_vars <span>=</span> <span>119082</span> × <span>18085</span><br>    obs<span>:</span> <span>'in_tissue'</span><span>,</span> <span>'array_row'</span><span>,</span> <span>'array_col'</span><br>    <span>var</span><span>:</span> <span>'gene_ids'</span><span>,</span> <span>'feature_types'</span><span>,</span> <span>'genome'</span><br>    uns<span>:</span> <span>'spatial'</span><br>    obsm<span>:</span> <span>'spatial'</span><br><span aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4>单样本119082个spot和18085个基因，看一下基础的信息。</h4><p><span aria-label="icon: copy"><svg viewbox="64 64 896 896" focusable="false" data-icon="copy" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></span></p><pre><code>sc<span>.</span>pp<span>.</span><span>normalize_total</span><span>(</span>adata<span>,</span> inplace<span>=</span><span>True</span><span>)</span><br>sc<span>.</span>pp<span>.</span><span>log1p</span><span>(</span>adata<span>)</span><br>sc<span>.</span>pp<span>.</span><span>highly_variable_genes</span><span>(</span>adata<span>,</span> flavor<span>=</span><span>"seurat"</span><span>,</span> n_top_genes<span>=</span><span>2000</span><span>)</span><br>sc<span>.</span>pp<span>.</span><span>scale</span><span>(</span>adata<span>)</span><br><br>sc<span>.</span>pp<span>.</span><span>pca</span><span>(</span>adata<span>)</span><br>sc<span>.</span>pp<span>.</span><span>neighbors</span><span>(</span>adata<span>)</span><br>sc<span>.</span>tl<span>.</span><span>umap</span><span>(</span>adata<span>)</span><br>sc<span>.</span>tl<span>.</span><span>leiden</span><span>(</span>adata<span>,</span> key_added<span>=</span><span>"clusters"</span><span>,</span> flavor<span>=</span><span>"igraph"</span><span>,</span> directed<span>=</span><span>False</span><span>,</span> n_iterations<span>=</span><span>2</span><span>,</span>resolution <span>=</span> <span>0.5</span> <span>)</span><br>sc<span>.</span>pl<span>.</span><span>spatial</span><span>(</span>adata<span>,</span> img_key<span>=</span><span>"hires"</span><span>,</span> color<span>=</span><span>"clusters"</span><span>)</span><br><span aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img data-imgfileid="100009697" data-ratio="0.7392857142857143" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ86g6zWSGzlxmwuq8M6ibH4zNEYjW9qUwu60hElQaGpXgian2h5nDYSg6w/640?wx_fmt=other&amp;from=appmsg" data-type="other" data-w="840" src="https://mmbiz.qpic.cn/mmbiz_jpg/srXAibe95MmmpPIfHDV5YSZA5AvuvicibZ86g6zWSGzlxmwuq8M6ibH4zNEYjW9qUwu60hElQaGpXgian2h5nDYSg6w/640?wx_fmt=other&amp;from=appmsg"></p><h4>跑的过程如果服务器性能好的话是没有什么问题的，如果查一点，可能会断掉，不过比R版本已经好很多了，作为项目，单样本的基础分析到聚类就可以了，接下来就是个性化分析了。</h4><h4>接下来我们会分享一些python的多样本HD数据整合和结合图像识别的内容。</h4><h4>生活很好，有你更好</h4><section><mp-common-cpsad data-pluginname="mpcps" data-templateid="list" data-traceid="e39a87f3-855b-4ba6-93ff-93de2ac4dcb7" data-goodssouce="1" data-pid="104_2024733417" data-appuin="3860655629" data-cpsversion="v112"></mp-common-cpsad></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/lwyt_MiqQGrLNslQm8y9hA",target="_blank" rel="noopener noreferrer">原文链接</a>
