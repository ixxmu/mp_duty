---
title: "这算是不一样吗"
date: 2024-10-31T14:39:05Z
draft: ["false"]
tags: [
  "fetched",
  "Investigator进修录"
]
categories: ["Acdemic"]
---
这算是不一样吗 by Investigator进修录
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">在《单细胞天地》的交流群，看到有粉丝提问关于 FindMarkers与AverageExpression 两个函数的差异 ：</p><blockquote data-tool="mdnice编辑器"><p>请问下怎么得到FindMarkers计算时ident.1和ident.2指定的cluster的平均表达量，因为输出结果中只会给avg_log2FC，我知道AverageExpression()函数可以计算平均表达量，但对应计算出来的logFC对应不上！都弄了2天了，一直找不到原因和解决办法，求大神解答！</p></blockquote><p data-tool="mdnice编辑器">而且还很贴心的给出来了一个示意图，如下所示：</p><p><img data-galleryid="" data-ratio="0.4166666666666667" data-s="300,640" data-type="png" data-w="792" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQqEtM0pibiawGPk0FLpTpXhzYdprIictWIiaRicgVl8tibG3fT8U7MzKUicQ7S0iafeUwPbEFmu5KCARzMGA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQqEtM0pibiawGPk0FLpTpXhzYdprIictWIiaRicgVl8tibG3fT8U7MzKUicQ7S0iafeUwPbEFmu5KCARzMGA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">这样的提问太棒了，所以我就让他把这个数据save成为rdata文件，然后把代码复制粘贴到交流群里面。我马上开始debug模式！</p><p data-tool="mdnice编辑器">我的代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br>load(<span>'pbmc_Platelet_DC.Rdata'</span>)<br>sce=pbmc_Platelet_DC<br>table(sce$seurat_clusters)<br>table(Idents(sce))<br><span>#计算平均表达量</span><br>av &lt;-AverageExpression(sce, assays = <span>"RNA"</span>) <br>av=as.data.frame(av$RNA)<br>av$diff = log(av[,<span>2</span>]+<span>0.1</span>) - log(av[,<span>1</span>]+<span>0.1</span>)<br><br><span>#计算差异基因</span><br>diff  &lt;- FindMarkers(sce,<br>                     ident.1 = <span>"Platelet"</span>, <br>                     ident.2 = <span>"DC"</span>,assay = <span>"RNA"</span>)<br><br>head(diff)<br>head(av)<br></code></pre><p data-tool="mdnice编辑器">很快就能重复出来 FindMarkers与AverageExpression 两个函数的结果 ：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; head(diff)<br>                 p_val avg_logFC pct.1 pct.2    p_val_adj<br>PPBP      1.511444e-10  6.028905 1.000 0.031 2.072795e-06<br>PF4       3.476540e-10  4.885316 1.000 0.062 4.767728e-06<br>GNG11     4.483201e-10  4.581688 0.929 0.000 6.148262e-06<br>HIST1H2AC 4.483201e-10  4.060724 0.929 0.000 6.148262e-06<br>SPARC     4.483201e-10  3.554182 0.929 0.000 6.148262e-06<br>GP9       4.483201e-10  3.553585 0.929 0.000 6.148262e-06<br>&gt; head(av)<br>                      DC Platelet       diff<br>AL627309.1    0.00000000        0  0.0000000<br>AP006222.2    0.00000000        0  0.0000000<br>RP11-206L10.2 0.08462847        0 -0.6131753<br>RP11-206L10.9 0.00000000        0  0.0000000<br>LINC00115     0.00000000        0  0.0000000<br>NOC2L         0.32861136        0 -1.4553804<br></code></pre><p data-tool="mdnice编辑器">如果这样的肉眼去查看，就是粉丝提问的截图，当然是看不出来啊！会错误的以为，两个函数得到的结果差异很大！</p><p data-tool="mdnice编辑器">我这里做一个小小的可视化，代码如下：</p><pre data-tool="mdnice编辑器"><span></span><code><br>ids=intersect(rownames(diff),<br>              rownames(av))<br>comp=data.frame(FindMarkers=diff[ids,<span>'avg_log2FC'</span>],<br>           AverageExpression=av[ids,<span>'diff'</span>])<br>head(comp)<br>plot(comp)<br>head(comp)<br><span>library</span>(ggpubr)<br>ggscatter(comp, x = <span>"FindMarkers"</span>, y = <span>"AverageExpression"</span>,<br>          color = <span>"black"</span>, shape = <span>21</span>, size = <span>3</span>, <span># Points color, shape and size</span><br>          add = <span>"reg.line"</span>,  <span># Add regressin line</span><br>          add.params = list(color = <span>"blue"</span>, fill = <span>"lightgray"</span>), <span># Customize reg. line</span><br>          conf.int = <span>TRUE</span>, <span># Add confidence interval</span><br>          cor.coef = <span>TRUE</span>, <span># Add correlation coefficient. see ?stat_cor</span><br>          cor.coeff.args = list(method = <span>"pearson"</span>,  label.sep = <span>"\n"</span>)<br>)<br></code></pre><p data-tool="mdnice编辑器">结果如下：</p><p><img data-galleryid="" data-ratio="0.65" data-s="300,640" data-type="png" data-w="820" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQqEtM0pibiawGPk0FLpTpXhz5AQu6xj8LHMBjnK552ibMpdh46j3hPice6nlLRMruvHiaxJhS9Qdfy3ibw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQqEtM0pibiawGPk0FLpTpXhz5AQu6xj8LHMBjnK552ibMpdh46j3hPice6nlLRMruvHiaxJhS9Qdfy3ibw/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><p data-tool="mdnice编辑器">可以看到，两个函数，FindMarkers与AverageExpression，其实计算得到 差异变化几乎是没有差异，这样的相关性已经是非常好了。（可能是粉丝对数据的一致性这个判断没有相应的统计学背景知识）</p><p data-tool="mdnice编辑器">那么，有没有可能让两个函数 FindMarkers与AverageExpression得到的结果完全一致呢？</p><p data-tool="mdnice编辑器">那就期待明天的讲解哈！</p><p data-tool="mdnice编辑器">另外，如果你也想拿到前面的 pbmc_Platelet_DC.Rdata 文件，走这个代码，其实超级容易，就是pbmc3k数据集哦。</p><p><br></p><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-ratio="0.9495798319327731" data-type="gif" data-w="119" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=gif"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247496614&amp;idx=1&amp;sn=6761831a1f5ee598ea20857de883ed94&amp;chksm=ea1cf524dd6b7c32c9db6f174cd7c12504d663fbfe0a5b2a241b8017eb900f16f27245d4f640&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">Seurat4.0系列教程11：使用sctransform</a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247496589&amp;idx=1&amp;sn=62661e8f6fe1f7ca77116170c367d710&amp;chksm=ea1cf50fdd6b7c19479c2853becde5b55b9887d8abe8c85dc879ad715bbbab2c72379563c4d4&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">OSCA单细胞数据分析笔记13—Multi-sample comparison</a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247496485&amp;idx=1&amp;sn=46686583722d6d63a62fb98e2cabf5e0&amp;chksm=ea1cf5a7dd6b7cb1dd0d69fbdb9c3dd69231167ab456d016edd674c921413de50834489d92b3&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">scRNA-seq计算方法的优势和局限性</a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247504010&amp;idx=2&amp;sn=0a82d588dce7e8a24340f5f35d90b372&amp;chksm=9b4b9031ac3c19278a0a7a888cf51ee1bdbaf6d4f3695df4f101731cfd2dc385259613b9a474&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生信入门课-2021第5期</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247504010&amp;idx=1&amp;sn=3839c684dde6f75684cb116984291986&amp;chksm=9b4b9031ac3c19270220e8846f3cd13a159ff4abbcda4ef2dbb9f16c2f6b045723b21f5cc051&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">数据挖掘（GEO,TCGA,单细胞）2021第5期</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247501667&amp;idx=2&amp;sn=b05cb7181f632a557f0d78c6f31160d3&amp;chksm=9b4b87d8ac3c0ece42e259d2c39948dd6a1227b6c392213cb4564ae6a9926a6735f871da941b&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1">明码标价之共享96线程384G内存服务器</a></p></li></ul><p><img data-ratio="1" data-type="gif" data-w="240" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-ratio="0.05278592375366569" data-type="jpeg" data-w="341" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-width="38%"><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-ratio="1" data-type="jpeg" data-w="258" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section><p data-tool="mdnice编辑器"><br></p></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/6HOyWXblLI_-EGD2KEZX_Q",target="_blank" rel="noopener noreferrer">原文链接</a>
