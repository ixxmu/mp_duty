---
title: "使用小提琴图可视化目的基因并计算显著性"
date: 2024-10-30T14:32:17Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
使用小提琴图可视化目的基因并计算显著性 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span></span><span></span><span>前情回顾</span><span></span></h3><p data-tool="mdnice编辑器">在这个月的前几期推文中，主要基于单细胞数据使用小提琴图可视化marker基因进行了整理：</p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247525623&amp;idx=1&amp;sn=cfb7764955e18b4bcf7f936dc104bcc5&amp;scene=21#wechat_redirect" data-linktype="2">VlnPlot结果及常用参数浅析</a></p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247525717&amp;idx=1&amp;sn=ac721876ef19aa52090e87a47445b905&amp;scene=21#wechat_redirect" data-linktype="2">基于VlnPlot参数及ggplot2美化小提琴图</a></p><p data-tool="mdnice编辑器">也有一期答读者问——<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247525822&amp;idx=1&amp;sn=068688d80fb550178a19a9e4ad1e3f0a&amp;scene=21#wechat_redirect" data-linktype="2">小提琴图有点无图是何缘由？</a></p><p data-tool="mdnice编辑器">这期就一起来学习一下<strong>画目的基因的小提琴图并计算显著性！</strong></p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>小提琴图可视化并计算显著性用途</span><span></span></h3><p data-tool="mdnice编辑器">在单细胞数据分析中，<strong>通过小提琴图可视化和显著性计算可以帮助研究者直观且统计地评估目的基因在不同细胞群体中的表达差异</strong></p><ol data-tool="mdnice编辑器"><li><section><p><strong>展示基因在不同细胞群体的表达分布</strong>：小提琴图可以直观地展示<strong>基因在各个细胞亚群中的表达水平和分布情况</strong>。</p><p>小提琴图能够反映<strong>不同群体中表达的中位数、四分位数及表达值的变化范围</strong>。特别是在复杂的细胞亚群中，这种分布展示非常有助于发现基因的差异性表达。</p></section></li><li><section><p><strong>确定基因在不同亚群中的特异性表达</strong>：通过显著性计算可以<strong>明确目的基因是否在特定细胞亚群中显著表达</strong>。</p><p>例如，通过t检验或非参数检验（如Wilcoxon检验）来比较不同亚群间的表达水平，帮助筛选出与特定功能或病理状态相关的细胞群体。</p></section></li><li><section><p><strong>为后续功能研究提供线索</strong>：显著性差异的基因表达通常可以看到<strong>基因可能在不同细胞群体的生物功能或疾病过程中起关键作用</strong>。</p></section></li></ol><p data-tool="mdnice编辑器">所以当我们需要查看<strong>单细胞不同分组，或者不同细胞亚群中某个目标基因的表达情况并且比较的时候，就可以计算一下显著性</strong></p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>基于小提琴图可视化目标基因</span><span></span></h3><p data-tool="mdnice编辑器">还是<strong>以pbmc数据为例，展示NKG7基因在不同细胞亚群中的表达情况，计算并展示不同分组间的显著性</strong></p><h4 data-tool="mdnice编辑器"><span></span><span>载入需要的数据</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>#给亚群命名</span><br>new.cluster.ids &lt;- c(<span>"Naive CD4 T"</span>, <span>"CD14+ Mono"</span>, <span>"Memory CD4 T"</span>,<br>                     <span>"B"</span>, <span>"CD8 T"</span>,<span>"FCGR3A+ Mono"</span>, <span>"NK"</span>, <span>"DC"</span>, <span>"Platelet"</span>)<br><br>names(new.cluster.ids) &lt;- levels(pbmc)<br><span># 修改Idents中分群编号为细胞类型</span><br>pbmc &lt;- RenameIdents(pbmc, new.cluster.ids)<br>DimPlot(pbmc, reduction = <span>"umap"</span>, label = TRUE,  <br>        repel = T,pt.size = 0.5) + NoLegend()<br>pbmc<span>$cluster_by_counts</span>=Idents(pbmc)<br>pbmc<span>$celltype</span>=Idents(pbmc)<br><br><span>#计算marker基因</span><br>pbmc.markers &lt;- FindAllMarkers(pbmc, only.pos = TRUE, min.pct = 0.25,  logfc.threshold = 0.25, verbose = FALSE)<br>top5 = pbmc.markers %&gt;% group_by(cluster) %&gt;% top_n(n = 5, wt = avg_log2FC)<br>g = unique(top5<span>$gene</span>)<br><br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span>可视化NKG7在不同分群表达情况</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span># 使用VlnPlot生成NKG7的分组小提琴图，并去掉图例</span><br>p &lt;- VlnPlot(object = pbmc, features = <span>'NKG7'</span>,  pt.size = 0) +<br>  NoLegend() +<br>  theme(axis.text.x = element_text(angle = 90, hjust = 1))<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100042476" data-ratio="0.7284991568296796" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTufxZr139AUQvdHPgV37CUQialoVU20ESXBk0Zzz3BP7UsPIIFBBUZK43s0BsWzY0khDibBNZIB0Jg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1779" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTufxZr139AUQvdHPgV37CUQialoVU20ESXBk0Zzz3BP7UsPIIFBBUZK43s0BsWzY0khDibBNZIB0Jg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">从小提琴图中可以看到<strong>NKG7基因在"CD8 T"以及"NK"中表达较高, 在"FCGR3A+ Mono"和"DC"中表达也较其余几个分组高，可以计算一下这几个分组间的显著性，然后比较</strong></p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>显著性计算和可视化</span><span></span></h3><p data-tool="mdnice编辑器"><strong>使用<code>ggpubr</code>包中的<code>stat_compare_means</code>函数在图形上显示不同组之间的显著性检验结果。</strong></p><ul data-tool="mdnice编辑器"><li><section><p>调用常见的统计检验方法（例如<strong>t检验、Wilcoxon秩和检验、ANOVA等</strong>）来比较不同组之间的数值差异，并返回显著性标记。</p></section></li><li><section><p>根据<code>comparisons</code>参数中定义的组别对来计算两两显著性。例如，如果<code>comparisons = list(c("Group1", "Group2"))</code>，则只比较“Group1”和“Group2”之间的显著性。 若未指定具体组对，并且数据包含多个组，会默认进行全局比较。</p></section></li><li><section><p>根据选择的检验方法，<code>stat_compare_means</code>会在数据内部执行相关的显著性检验，返回每组对的p值。</p></section></li><li><section><p>根据计算得到的p值，生成对应的显著性标记（如<code>*</code>、<code>**</code>、<code>***</code>、<code>****</code>），并根据p值范围控制标记显示：</p></section></li><ul><li><section>ns：表示“不显著”（not significant），即 p 值 &gt; 0.05，表明两组之间的差异没有统计学显著性。</section></li><li><section>*：表示 p 值 ≤ 0.05，表明两组之间的差异具有统计学显著性。</section></li><li><section>**：表示 p 值 ≤ 0.01，差异高度显著。</section></li><li><section>***：表示 p 值 ≤ 0.001，差异极显著。</section></li><li><section>****：表示 p 值 ≤ 0.0001，差异非常显著。</section></li></ul><li><section><p>可以通过参数<code>label = "p.signif"</code>（仅显示显著性标记）或<code>label = "p"</code>（显示具体的p值）进行控制。</p></section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span>1. 选择需要比较的分组进行显著性计算和展示</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>#根据需要选择进行比较的分组</span><br>my_comparisons &lt;- list( c(<span>"CD8 T"</span>, <span>"FCGR3A+ Mono"</span>), c(<span>"FCGR3A+ Mono"</span>, <span>"NK"</span>), c(<span>"NK"</span>, <span>"DC"</span>))<br><br>library(ggpubr)<br><span># 将VlnPlot转换为ggplot对象，然后添加显著性比较</span><br>p + stat_compare_means(comparisons = my_comparisons,method = <span>"t.test"</span>)+<br>  ylim(-2, 15)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100042475" data-ratio="0.8342696629213483" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTufxZr139AUQvdHPgV37CUDB5BuiagBXyMHgicBHoWBptib4tZicL9owPWJRc3vXhZnibwNyGaB94Ypfg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1068" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTufxZr139AUQvdHPgV37CUDB5BuiagBXyMHgicBHoWBptib4tZicL9owPWJRc3vXhZnibwNyGaB94Ypfg/640?wx_fmt=png&amp;from=appmsg"></figure><h4 data-tool="mdnice编辑器"><span></span><span>2. 用*号显示显著性标记，不显示具体数值</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>#用*号显示显著性标记，不显示具体数值</span><br>p + stat_compare_means(comparisons = my_comparisons,method = <span>"t.test"</span>,label = <span>"p.signif"</span>)+<br>  ylim(-2, 15)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100042474" data-ratio="0.8342696629213483" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTufxZr139AUQvdHPgV37CUlicvqcqtPPpgNBXTPmictqnMzChuRknfgk52TUWicYj50CmLowCg78oPA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1068" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTufxZr139AUQvdHPgV37CUlicvqcqtPPpgNBXTPmictqnMzChuRknfgk52TUWicYj50CmLowCg78oPA/640?wx_fmt=png&amp;from=appmsg"></figure><h4 data-tool="mdnice编辑器"><span></span><span>3. stat_summary()将每个组的均值显示为红点</span><span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>#stat_summary()将每个组的均值显示为红点，便于对比哪个组的平均表达水平更高。</span><br>p + stat_compare_means(comparisons = my_comparisons,method = <span>"t.test"</span>,label = <span>"p.signif"</span>)+<br>  ylim(-2, 15)+<br>  stat_summary(fun = mean, geom = <span>"point"</span>, color = <span>"red"</span>, size = 3)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100042477" data-ratio="0.7982791586998088" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTufxZr139AUQvdHPgV37CUx762mcxKl21hQpRtcUrb7G2M1lqoOh5y3QObL3OIqab1ke2tOiavOmw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1046" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTufxZr139AUQvdHPgV37CUx762mcxKl21hQpRtcUrb7G2M1lqoOh5y3QObL3OIqab1ke2tOiavOmw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>stat_summary 是ggplot2包中的一个函数，可用于在图中添加统计摘要（例如均值、标准差、中位数等），可以将将指定的统计计算结果（如平均值或中位数）直接叠加到现有的图层上</strong></p><p data-tool="mdnice编辑器">如果在计算出不同分组的显著性之后，不能直接看出来哪个组比哪个组高，可以<strong>tat_summary()将每个组的均值显示为红点，便于对比</strong></p><h3 data-tool="mdnice编辑器"><span data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjR90LFNLy4icTFEUCkE1Udpknb8E96eAShucxZzvaeVdgQVs8jJEEn58kJPwzic5JtYFQKyZV88Q3SQ/640?wx_fmt=png&amp;from=appmsg" data-fail="0"></span><span></span><span>文末友情宣传</span><span></span></h3><p data-tool="mdnice编辑器"><strong>如果你也想做单细胞转录组数据分析，最好是有自己的计算机资源哦，比如我们的<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a>，而且还需要有基本的生物信息学基础，也可以看看我们的<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247534569&amp;idx=1&amp;sn=b784451a39ca32e4d87200ea4c31bc57&amp;scene=21#wechat_redirect" textvalue="生物信息学‍马拉松授课" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2">生物信息学马拉松授课</a>，你的生物信息学入门课。</strong></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/mIQJN548ieM9gX4KskVIJw",target="_blank" rel="noopener noreferrer">原文链接</a>
