---
title: "看完还不会来揍/找我 | TCGA 与 GTEx 数据库联合分析 | 附完整代码 + 注释"
date: 2024-10-22T12:52:17Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
看完还不会来揍/找我 | TCGA 与 GTEx 数据库联合分析 | 附完整代码 + 注释 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span>看完还不会来揍/找我 | TCGA 与 GTEx 数据库联合分析 | 附完整代码 + 注释</span></h1><blockquote data-tool="mdnice编辑器"><p><strong>TCGA（The Cancer Genome Atlas）数据库</strong>提供了丰富的癌症组织样本数据，但由于其主要关注癌症类型，其中的正常组织样本数量有限。比如说乳腺癌，1200 多的转录组数据，其中 1100 左右都是肿瘤组织的测序数据，正常对照只有可怜巴巴一丢丢。这个时候我们就需要想办法加大正常组织样本量啦，既然 TCGA 数据库没有，我们就从其他数据库借一点过来！强烈推荐 <strong>GTEx（Genotype-Tissue Expression）数据库</strong>，因为 GTEx 涵盖了多个器官和组织中的大量正常组织样本数据。</p><p>两个数据库联合分析，怎么搞嘞！能随随便便拼接吗！那肯定不行！今天，咱们就一起来看看要怎么把它俩合并！</p></blockquote><p data-tool="mdnice编辑器">本文所用到的数据和代码，我已经上传到了 GitHub，有需要的话，大家可以在 https://github.com/hzyao/merge_TCGA_GTEx 进行查看下载<span>（点击阅读原文即可</span><span>直达</span><span>）</span>。</p><p data-tool="mdnice编辑器">如果有朋友想知道如何上传项目到 GitHub 的话，也可以看这里：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247484228&amp;idx=1&amp;sn=96b0e934b5e4bbee1faf7485b72c07fe&amp;chksm=c0042a45f773a353cc714cdabee71ebd7200942ffe08c37f714083beb8ebc936b189fd916d40&amp;scene=21#wechat_redirect" textvalue="使用 git 命令行上传项目到 GitHub（以 R 包为例）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">使用 git 命令行上传项目到 GitHub（以 R 包为例）</a></p><h1 data-tool="mdnice编辑器"><span></span><span>TCGA 与 GTEx 数据库联合分析</span></h1><h2 data-tool="mdnice编辑器"><span></span><span>数据库介绍</span></h2><p data-tool="mdnice编辑器"><strong>TCGA（The Cancer Genome Atlas）数据库：</strong> TCGA 数据库主要关注<strong>癌症组织</strong>，它收集了来自不同癌症类型的肿瘤组织样本的基因组、转录组、蛋白质组等多维度数据。这些数据有助于研究人员深入了解不同癌症类型的分子机制、致病基因、突变频率等，从而有助于癌症的诊断、治疗和预防。</p><p data-tool="mdnice编辑器"><strong>GTEx（Genotype-Tissue Expression）数据库：</strong> GTEx 数据库则关注<strong>正常组织</strong>中基因的表达模式，它收集了来自多个器官和组织的样本，分析了这些样本中基因的表达水平。通过 GTEx，研究人员可以了解不同组织中基因表达的变化，探索基因在正常生理状态下的功能和调控机制。</p><blockquote data-tool="mdnice编辑器"><p>想详细了解 GTEx 数据库的朋友们可以看这里：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247485062&amp;idx=1&amp;sn=2b8d3035466690b20e078f0332913aa1&amp;chksm=c0042f87f773a691a02937ffbb5b34224076504f8e9a834f386609912276a1a060bab95e37bd&amp;scene=21#wechat_redirect" textvalue="GTEx 数据库 - 再也不用担心没有正常组织样本啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">GTEx 数据库 - 再也不用担心没有正常组织样本啦</a></p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>数据准备</span></h2><p data-tool="mdnice编辑器">UCSC Xena 整合了来自不同研究项目、数据库和平台的生物医学数据，包括基因组学、转录组学、蛋白质组学等数据，这些数据来自于多个资源，如 TCGA、GTEx、ICGC 等。我们在这里下载后续整理也会很方便，所以咱们今天两个数据库的数据统一就在 UCSC Xena 下载！</p><blockquote data-tool="mdnice编辑器"><p>UCSC Xena 官网：http://xena.ucsc.edu/</p><figure><img data-ratio="0.6824074074074075" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K5KF49piaj63DpJc9RXutPyE3swiahAyuEDrR451RQM03ib8dOiceicd28yg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K5KF49piaj63DpJc9RXutPyE3swiahAyuEDrR451RQM03ib8dOiceicd28yg/640?wx_fmt=png"></figure></blockquote><p data-tool="mdnice编辑器">那我们开始下载！</p><p data-tool="mdnice编辑器">首先点击<code>Lauch Xena</code>进入主界面（https://xenabrowser.net/）。<img data-ratio="0.6851851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K5xWUOtVfbSunF1FzWB294VVHJkD82pNG08r9fbIJtdkAVD1d2lg2VQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K5xWUOtVfbSunF1FzWB294VVHJkD82pNG08r9fbIJtdkAVD1d2lg2VQ/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">点击<code>DATA SETS</code>进入数据集界面（https://xenabrowser.net/datapages/）。<img data-ratio="0.6407407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3Kh64BgJ6ThcvFlMuTpb4GA8c3TicicJBM2PHLlCOYN0AZ6ia9H5ZG7Aj8Q/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3Kh64BgJ6ThcvFlMuTpb4GA8c3TicicJBM2PHLlCOYN0AZ6ia9H5ZG7Aj8Q/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><img data-ratio="0.6407407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KFHQPTTnq6icdx38HlWwDTfx9u5NteUepXvkHyWP68xibvxKyvWMNStoA/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KFHQPTTnq6icdx38HlWwDTfx9u5NteUepXvkHyWP68xibvxKyvWMNStoA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">我们可以看到这个页面包含很多可下载的数据集，左侧是来自多个项目、数据库和平台的数据集列表，右侧展示了这些数据集的的来源。</p><h3 data-tool="mdnice编辑器"><span></span><span>TCGA 数据下载</span><span></span></h3><p data-tool="mdnice编辑器">我们今天以弥漫性大 B 细胞淋巴瘤（Lymphoid Neoplasm Diffuse Large B-cell Lymphoma）为例，它在 TCGA 中的缩写为 DLBC，所以我们点击<code>DC TCGA Large B-cell Lymphoma (DLBC) (14 datasets)</code>即可进入该肿瘤数据集下载页面。<img data-ratio="0.6407407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KS5UDxDhgNMRObzIey2ibDkxfz6kZdXwlnnxvNSNibqumgvA9r0D30Qog/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KS5UDxDhgNMRObzIey2ibDkxfz6kZdXwlnnxvNSNibqumgvA9r0D30Qog/640?wx_fmt=png"></p><p data-tool="mdnice编辑器">里面长这个样子！<img data-ratio="0.6398148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KYp1e8KQPwPdveFZzWbtPxL3T1MSnj86Ra9KoVTwb5HibIibqykkCSGWQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KYp1e8KQPwPdveFZzWbtPxL3T1MSnj86Ra9KoVTwb5HibIibqykkCSGWQ/640?wx_fmt=png"></p><blockquote data-tool="mdnice编辑器"><p>每个数据集点开都差不多，可能有的数据集包含的数据类型多一点有的少一点，如果在这里找不到你想要的，可能就需要辛苦点去原数据库官网去下载啦！</p></blockquote><p data-tool="mdnice编辑器">我们选择点击 <strong>gene expression RNAseq</strong> 中的<code>HTSeq - FPKM (n=48) GDC Hub</code>。选择 FPKM 是为了和接下来我们要下载的 GTEx 数据库中的数据计算方式保持一致（因为 GTEx 里面恰好有这种，一会儿你就知道啦！）</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6407407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KCUTic9ianu1sSGTWCGWOZyMaWuHhqnVC2onTsegicgAGCdAUKyYUh2Tsw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KCUTic9ianu1sSGTWCGWOZyMaWuHhqnVC2onTsegicgAGCdAUKyYUh2Tsw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p><strong>如果你不太清楚"Counts"、"FPKM" 和 "FPKM-UQ"有什么区别，请看这里！（该跳跳！）</strong></p></blockquote><p data-tool="mdnice编辑器">"Counts"、"FPKM" 和 "FPKM-UQ" 是在基因表达数据分析中常见的三种不同的表达量计算方法，用于衡量基因的表达水平。</p><p data-tool="mdnice编辑器"><strong>Counts</strong>：Counts 是一种基本的基因表达量计算方法，它直接对原始的 RNA-seq 测序数据进行处理，将每个基因在每个样本中的读数数目（即基因表达计数值）进行统计。它是通过对测序数据进行基因级别的计数来得到的，不考虑基因长度和测序深度等因素的影响。</p><p data-tool="mdnice编辑器"><strong>FPKM</strong> (Fragments Per Kilobase Million)：FPKM 是一种对基因表达水平进行归一化的计算方法。它考虑了基因长度和测序深度，并将基因表达计数值调整为每千碱基对的百万个读数。FPKM 是在基因长度归一化后的表达量，使得不同长度的基因之间可以进行比较。然而，FPKM 存在对测序深度敏感的问题，在低测序深度下容易产生高估的表达量。</p><p data-tool="mdnice编辑器"><strong>FPKM-UQ</strong> (FPKM-Upper Quartile normalization)：FPKM-UQ 是对 FPKM 进行进一步归一化的方法，旨在消除FPKM中的测序深度偏差。它使用上四分位数（Upper Quartile）对每个样本的FPKM值进行调整，将其调整为同一分布的中值。这样做的目的是减少测序深度偏差对 FPKM 值的影响，使得 FPKM-UQ 更适合用于样本间的比较分析。</p><p data-tool="mdnice编辑器">FPKM 和 FPKM-UQ 都是早期常用的表达量计算方法，随着技术的进步和对数据的更深入理解，已经出现了更先进的表达量计算方法，比如如 TPM（Transcripts Per Million）和 TPM-UQ等等，它们对于基因表达的定量更准确和可靠。</p><blockquote data-tool="mdnice编辑器"></blockquote><p data-tool="mdnice编辑器">点击<code>HTSeq - FPKM (n=48) GDC Hub</code>就会进入下面这个页面，点击<code>download</code>和<code>ID/Gene Mapping</code>的链接把它们都下载下来！</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6416666666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KmGwIibsuF3Xp4XdT9XnuiakhTzBDU6jticbfmC6dVyzZvYkgHeB03wRtw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KmGwIibsuF3Xp4XdT9XnuiakhTzBDU6jticbfmC6dVyzZvYkgHeB03wRtw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><code>download</code>：基因表达矩阵（像上图绿框框中那样）</p><p data-tool="mdnice编辑器"><code>ID/Gene Mapping</code>：用于进行基因 ID 的转换</p><p data-tool="mdnice编辑器">TCGA 中包含癌组织和癌旁组织，我们需要对它们进行区分（当然靠样本名我们也能进行区分，但是这不麻烦嘛）！所以我们下载 <strong>phenotype</strong> 中的<code>Phenotype (n=52) GDC Hub</code>，里面是临床信息，我们到时候用一下！顺便把生存数据（<code>survival data (n=51) GDC Hub</code>）也下载下来！</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6398148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KYq7IuKQdmrOhKYryj8tv9jjErG1Lm3AbX6xhI3IibD0R1YicuFYibVvRQ/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KYq7IuKQdmrOhKYryj8tv9jjErG1Lm3AbX6xhI3IibD0R1YicuFYibVvRQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">接下来，我们下载 GTEX 数据库中正常组织的 <strong>gene expression RNAseq</strong> 数据。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.6407407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K7iaUDClZiaz92GuaKpKjwKmnVx7hgfffrYY7AoibrTXbic5fibMV2mpbjIg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K7iaUDClZiaz92GuaKpKjwKmnVx7hgfffrYY7AoibrTXbic5fibMV2mpbjIg/640?wx_fmt=png"></figure><figure data-tool="mdnice编辑器"><img data-ratio="0.637962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KULj0RfpDeQJtDGXbWAMJibCEtllzY7AOvpm4F0QiabLsK5oNMlibicUsicg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KULj0RfpDeQJtDGXbWAMJibCEtllzY7AOvpm4F0QiabLsK5oNMlibicUsicg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">理论上 TPM 更先进，但 TCGA 只有 FPKM，为了保持数据一致性，所以我们统一下载 FPKM 数据类型。</p><p data-tool="mdnice编辑器">同样也要下载它的基因表达矩阵和基因 ID 转换文件。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5453703703703704" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K82pu1phwQzYlU8BMK4PnSyNdZ8fVeVFU20PwiboG4vVaF4esftVxoiaw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K82pu1phwQzYlU8BMK4PnSyNdZ8fVeVFU20PwiboG4vVaF4esftVxoiaw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">细心的朋友们可能已经注意到了，GTEx 的表达矩阵单位是 log2(fpkm+0.001)，和之前 TCGA 中的不一样（TCGA 中是 log2(fpkm+1)），在后续分析中，我们要记得转换成一致的！<img data-ratio="0.5462962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KkkYP3FBN54ia9aWTIbqic5BJAmXP0PyXx8gY78v22MAI7ZyurgpXHWdg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KkkYP3FBN54ia9aWTIbqic5BJAmXP0PyXx8gY78v22MAI7ZyurgpXHWdg/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><img data-ratio="0.5435185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KPXh8yZ37LgGHESTOEicg79TCLCzVmkJaOxVUBHG6l3ukf12bnD3V2zg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3KPXh8yZ37LgGHESTOEicg79TCLCzVmkJaOxVUBHG6l3ukf12bnD3V2zg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">当然，还要下载表型数据。</p><figure data-tool="mdnice编辑器"><img data-ratio="0.637962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K9FejeYkyK8ibZ8xF0rlyWmtgT2vG9nasSC9zeQp3IalEJ5mt7agCgSg/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/QQjtfWKmicLoRleEoicTStAb6TUEDhhd3K9FejeYkyK8ibZ8xF0rlyWmtgT2vG9nasSC9zeQp3IalEJ5mt7agCgSg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">好！到这里，我们整合所需要的所有数据就下载完毕啦！开始合体！</p><h2 data-tool="mdnice编辑器"><span></span><span>数据整合</span></h2><p data-tool="mdnice编辑器">解释部分我都放在注释里啦！</p><p data-tool="mdnice编辑器">本文所用到的数据和代码，我已经上传到了 GitHub，有需要的话，大家可以在 https://github.com/hzyao/merge_TCGA_GTEx 进行查看下载（点击阅读原文即可直达）。</p><blockquote data-tool="mdnice编辑器"><p>除了这位兄台：<code>gtex_RSEM_gene_fpkm</code>，它是在是太大了，大家自己去我们上面介绍的 UCSC Xena 下载好不好，或者直接去这里（https://xenabrowser.net/datapages/?dataset=gtex_RSEM_gene_fpkm&amp;host=https%3A%2F%2Ftoil.xenahubs.net&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443），就进去它的下载页面啦！我可真贴心！）。</p></blockquote><p data-tool="mdnice编辑器">如果有朋友想知道如何上传项目到 GitHub 的话，也可以看这里：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg5NjE1NTc1OA==&amp;mid=2247484228&amp;idx=1&amp;sn=96b0e934b5e4bbee1faf7485b72c07fe&amp;chksm=c0042a45f773a353cc714cdabee71ebd7200942ffe08c37f714083beb8ebc936b189fd916d40&amp;scene=21#wechat_redirect" textvalue="使用 git 命令行上传项目到 GitHub（以 R 包为例）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">使用 git 命令行上传项目到 GitHub（以 R 包为例）</a></p><pre data-tool="mdnice编辑器"><span></span><code><span>############################### TCGA + GTEx ####################################</span><br><br><span># 加载要用到的包，大家如果没有可以先自己安装一下</span><br><br><span>library</span>(data.table)  <span># 用于高效处理大数据集的库</span><br><span>library</span>(dplyr)       <span># 数据操作和转换的库</span><br><span>library</span>(tidyverse)   <span># 数据处理和可视化的综合库</span><br><br><span>#################################### TCGA ######################################</span><br><br><span># 读取表达矩阵</span><br>dlbc.fpkm &lt;- fread(<span>"./download_data/TCGA-DLBC.htseq_fpkm.tsv"</span>, header = <span>T</span>, sep = <span>'\t'</span>, data.table = <span>F</span>)<br><br><span># 查看表达矩阵，我们发现第一列是ensembl id，后面的列是样本名</span><br>head(dlbc.fpkm)[<span>1</span>:<span>5</span>, <span>1</span>:<span>5</span>]<br><span>#           Ensembl_ID TCGA-RQ-A6JB-01A TCGA-FF-8046-01A TCGA-FF-A7CW-01A TCGA-RQ-A68N-01A</span><br><span># 1  ENSG00000242268.2       0.00000000         0.000000       0.00000000         0.000000</span><br><span># 2  ENSG00000270112.3       0.04396508         0.000000       0.01294356         0.000000</span><br><span># 3 ENSG00000167578.15       3.15192692         3.399737       3.43036482         3.332282</span><br><span># 4  ENSG00000273842.1       0.00000000         0.000000       0.00000000         0.000000</span><br><span># 5  ENSG00000078237.5       3.03661720         3.183184       3.04236324         2.787429</span><br><br><span># 读取基因ID转换信息，目的是为了将ensembl id转换为gene symbol</span><br>dlbc.pro &lt;- fread(<span>"./download_data/gencode.v22.annotation.gene.probeMap"</span>, header = <span>T</span>, sep = <span>'\t'</span>, data.table = <span>F</span>)<br><br><span># 查看基因ID转换信息，我们发现第一列是ensembl id，第二列是gene symbol</span><br>head(dlbc.pro)<br><span>#                  id         gene chrom chromStart chromEnd strand</span><br><span># 1 ENSG00000223972.5      DDX11L1  chr1      11869    14409      +</span><br><span># 2 ENSG00000227232.5       WASH7P  chr1      14404    29570      -</span><br><span># 3 ENSG00000278267.1    MIR6859-3  chr1      17369    17436      -</span><br><span># 4 ENSG00000243485.3 RP11-34P13.3  chr1      29554    31109      +</span><br><span># 5 ENSG00000274890.1    MIR1302-9  chr1      30366    30503      +</span><br><span># 6 ENSG00000237613.2      FAM138A  chr1      34554    36081      -</span><br><br><span># 提取前两列用于进行转换</span><br>dlbc.pro &lt;- dlbc.pro[ , c(<span>1</span>, <span>2</span>)]<br>head(dlbc.pro)<br><span>#                  id         gene</span><br><span># 1 ENSG00000223972.5      DDX11L1</span><br><span># 2 ENSG00000227232.5       WASH7P</span><br><span># 3 ENSG00000278267.1    MIR6859-3</span><br><span># 4 ENSG00000243485.3 RP11-34P13.3</span><br><span># 5 ENSG00000274890.1    MIR1302-9</span><br><span># 6 ENSG00000237613.2      FAM138A</span><br><br><span># 基因ID转换信息和表达矩阵合并</span><br>dlbc.fpkm.pro &lt;- merge(dlbc.pro, dlbc.fpkm, by.y  = <span>"Ensembl_ID"</span>, by.x = <span>"id"</span> )<br>head(dlbc.fpkm.pro)[<span>1</span>:<span>5</span>, <span>1</span>:<span>5</span>]<br><span>#                   id     gene TCGA-RQ-A6JB-01A TCGA-FF-8046-01A TCGA-FF-A7CW-01A</span><br><span># 1 ENSG00000000003.13   TSPAN6         1.026771       0.76890645       0.35573821</span><br><span># 2  ENSG00000000005.5     TNMD         0.000000       0.07154948       0.02051499</span><br><span># 3 ENSG00000000419.11     DPM1         5.134474       5.01494933       5.28879599</span><br><span># 4 ENSG00000000457.12    SCYL3         1.534159       1.18431712       1.91343387</span><br><span># 5 ENSG00000000460.15 C1orf112         1.894523       1.72454346       2.24504933</span><br><br><span># 去重</span><br>dlbc.fpkm.pro &lt;- distinct(dlbc.fpkm.pro,gene, .keep_all = <span>T</span>)<br><br><span># 把基因名转换为行名</span><br>rownames(dlbc.fpkm.pro) &lt;- dlbc.fpkm.pro$gene<br>dlbc.fpkm.pro &lt;- dlbc.fpkm.pro[ , -c(<span>1</span>,<span>2</span>)]<br>dim(dlbc.fpkm.pro) <span># 58387  48</span><br>head(dlbc.fpkm.pro)[<span>1</span>:<span>5</span>, <span>1</span>:<span>5</span>]<br><span>#          TCGA-RQ-A6JB-01A TCGA-FF-8046-01A TCGA-FF-A7CW-01A TCGA-RQ-A68N-01A TCGA-FM-8000-01A</span><br><span># TSPAN6           1.026771       0.76890645       0.35573821        0.7864696        1.0575194</span><br><span># TNMD             0.000000       0.07154948       0.02051499        0.0000000        0.1362624</span><br><span># DPM1             5.134474       5.01494933       5.28879599        5.1281748        4.6654726</span><br><span># SCYL3            1.534159       1.18431712       1.91343387        1.2004038        1.5156969</span><br><span># C1orf112         1.894523       1.72454346       2.24504933        1.2145814        1.7478664</span><br><br><span># 现在表达矩阵就构建完毕啦！</span><br><span># 但是TCGA中不止有癌组织，还有癌旁组织，所以我们可以根据临床信息把它们分开</span><br><br><span># 读取淋巴癌的临床信息</span><br>dlbc.phe &lt;- fread(<span>"./download_data/TCGA-DLBC.GDC_phenotype.tsv"</span>, header = <span>T</span>, sep = <span>'\t'</span>, data.table = <span>F</span>)<br>dlbc.phe$submitter_id.samples[<span>1</span>:<span>5</span>]<br><span># [1] "TCGA-FA-A6HN-01A" "TCGA-GR-A4D4-01A" "TCGA-GS-A9TT-01A" "TCGA-FF-A7CQ-01A" "TCGA-FF-8046-01A"</span><br><br><span># 把行名改成样本名</span><br>rownames(dlbc.phe) &lt;- dlbc.phe$submitter_id.samples<br><br><span># 查看临床信息的sample_type.samples列</span><br>table(dlbc.phe$sample_type.samples)<br><span># Bone Marrow Normal      Primary Tumor </span><br><span>#                  4                 48</span><br><br><span># Primary Tumor为癌组织，我们将癌组织提取出来</span><br>dlbc.phe.t &lt;- filter(dlbc.phe, sample_type.samples == <span>"Primary Tumor"</span>)<br><br><span># 临床信息与表达矩阵取交集</span><br>merge_phe_fpkm &lt;- intersect(rownames(dlbc.phe.t), colnames(dlbc.fpkm.pro))<br><br><span># 提取癌组织的表达矩阵</span><br>dlbc.exp &lt;- dlbc.fpkm.pro[ , merge_phe_fpkm]<br>dim(dlbc.exp)<br><span># [1] 58387    48</span><br><br><span># TCGA DLBC 癌组织样本表达矩阵构建完成，保存一下！</span><br>saveRDS(dlbc.exp, file=<span>'./generated_data/dlbc.exp.rds'</span>)<br><br><span>#################################### GTEx ######################################</span><br><br><span># 读取gtex的表达矩阵，解压和不解压其实都可以读取（如果超级慢或者出现error，不要慌，据说可能因为内存小）</span><br>gtex.exp &lt;- fread(<span>"./download_data/gtex_RSEM_gene_fpkm"</span>, header = <span>T</span>, sep = <span>'\t'</span>, data.table = <span>F</span>)<br>gtex.exp[<span>1</span>:<span>5</span>, <span>1</span>:<span>4</span>]<br><span>#               sample GTEX-S4Q7-0003-SM-3NM8M GTEX-QV31-1626-SM-2S1QC GTEX-13QIC-0011-R1a-SM-5O9CJ</span><br><span># 1  ENSG00000242268.2                 -3.8160                 -9.9658                      -9.9658</span><br><span># 2  ENSG00000259041.1                 -9.9658                 -9.9658                      -9.9658</span><br><span># 3  ENSG00000270112.3                 -4.0350                 -2.9324                      -2.1779</span><br><span># 4 ENSG00000167578.16                  4.2958                  3.9204                       6.1528</span><br><span># 5  ENSG00000278814.1                 -9.9658                 -9.9658                      -9.9658</span><br><br>dim(gtex.exp)<br><span># [1] 60498  7863</span><br><br><span># 注意这里包含GTEx中所有正常组织来源的样本，我们保存一下，后面继续提取自己需要的组织样本</span><br><span># saveRDS(gtex.exp, file = './generated_data/gtex.exp.rds')</span><br><br><span># 读取gtex的基因ID转换信息，将ensembl id转换为gene symbol</span><br>gtex.pro &lt;- fread(<span>"./download_data/probeMap_gencode.v23.annotation.gene.probemap"</span>, header = <span>T</span>, sep = <span>'\t'</span>, data.table = <span>F</span>)<br>head(gtex.pro)<br><span>#                  id         gene chrom chromStart chromEnd strand</span><br><span># 1 ENSG00000223972.5      DDX11L1  chr1      11869    14409      +</span><br><span># 2 ENSG00000227232.5       WASH7P  chr1      14404    29570      -</span><br><span># 3 ENSG00000278267.1    MIR6859-1  chr1      17369    17436      -</span><br><span># 4 ENSG00000243485.3 RP11-34P13.3  chr1      29554    31109      +</span><br><span># 5 ENSG00000274890.1    MIR1302-2  chr1      30366    30503      +</span><br><span># 6 ENSG00000237613.2      FAM138A  chr1      34554    36081      -</span><br><br>dim(dlbc.pro) <span># 60483     2</span><br>dim(gtex.pro) <span># 60498     6</span><br><span># 我们顺便发现了v23和v22的差异有多少，60498 vs. 60483</span><br><br><span># 提取前两列用于基因ID转换</span><br>gtex.pro &lt;- gtex.pro[, c(<span>1</span>,<span>2</span>)]<br><br><span># 基因ID转换信息和表达矩阵合并</span><br>gtex.fpkm.pro &lt;- merge(gtex.pro, gtex.exp, by.y =<span>"sample"</span>, by.x = <span>"id"</span> )<br><br><span># 取交集，为了决定之后gtex和dlbc合并是按照gene symbol还是ensembl id进行</span><br>length(intersect(gtex.pro$id, dlbc.pro$id))  <span># 42566</span><br>length(intersect(rownames(dlbc.exp), gtex.fpkm.pro$gene)) <span># 57793</span><br><br><span># 按照gene symbol合并会有57793个，按照ensembl id合并有42566个，所以这次我们选择按照gene symbol进行合并</span><br><br><span># 接下来，提取正常淋巴组织的表达矩阵，根据gtex的临床信息来匹配淋巴组织的样本</span><br><br><span># 读取gtex的临床信息</span><br>gtex.phe &lt;- fread(<span>"./download_data/GTEX_phenotype"</span>, header = <span>T</span>, sep = <span>'\t'</span>, data.table = <span>F</span>)<br>rownames(gtex.phe) &lt;- gtex.phe$Sample<br><br><span># 给它改一下列名，好看点</span><br>colnames(gtex.phe) &lt;- c(<span>"Sample"</span>, <span>"body_site_detail (SMTSD)"</span>, <span>"primary_site"</span>, <span>"gender"</span>, <span>"patient"</span>, <span>"cohort"</span>)<br>table(gtex.phe$primary_site)<br><span># &lt;not provided&gt;  Adipose Tissue   Adrenal Gland         Bladder           Blood    Blood Vessel     Bone Marrow </span><br><span>#              5             621             161              13             595             753             102 </span><br><span>#          Brain          Breast    Cervix Uteri           Colon       Esophagus  Fallopian Tube           Heart </span><br><span>#           1426             221              11             384             805               7             493 </span><br><span>#         Kidney           Liver            Lung          Muscle           Nerve           Ovary        Pancreas </span><br><span>#             38             141             381             478             335             112             203 </span><br><span>#      Pituitary        Prostate  Salivary Gland            Skin Small Intestine          Spleen         Stomach </span><br><span>#            126             122              71             977             106             121             209 </span><br><span>#         Testis         Thyroid          Uterus          Vagina </span><br><span>#            208             366              93              99 </span><br><br><span># 上面展示的是GTEx中所有的组织来源，今天我们分析的是淋巴癌</span><br><span># TCGA中数据集名为DLBC，在GTEx中对应的组织来源应该为blood，上面显示有595个</span><br><br><span># 在本文最后，我附上了TCGA 与 GTEx 癌症类型与组织来源对应表，大家有需要可以去看哟！</span><br><br><span># 筛选出blood组织来源的样本</span><br>gtex.phe.s &lt;- filter(gtex.phe, primary_site == <span>"Blood"</span>)<br><br><span># 临床信息与表达矩阵取交集</span><br>merge_phe_fpkm_gtex &lt;- intersect(rownames(gtex.phe.s), colnames(gtex.fpkm.pro)) <span># 444</span><br>gtex.s &lt;- gtex.fpkm.pro[ , c(<span>"gene"</span>, merge_phe_fpkm_gtex)]<br><br><span># 去重</span><br>gtex.s &lt;- distinct(gtex.s, gene, .keep_all = <span>T</span>)<br>rownames(gtex.s) &lt;- gtex.s$gene<br>gtex.s &lt;- gtex.s[ , -<span>1</span>]<br>dim(gtex.s)<br><span># [1] 58581   444</span><br><br><span># 我们发现GTEx中有444个blood样本</span><br><br><span># gtex的表达矩阵是按照log2(fpkm+0.001)处理的，dlbc是按照log2(fpkm+1)</span><br><span># 所以合并之前，我们需要把它们的处理方式调整为相同的</span><br>gtex.s2 &lt;- <span>2</span>^gtex.s<br>gtex.s3 &lt;- log2(gtex.s2-<span>0.001</span>+<span>1</span>)<br><br><span># 现在数据的处理方式都相同，就有可比性啦！</span><br><br><span># 正式合并开始！</span><br><span># 把gtex的blood组织数据与tcga的dlbc数据合并</span><br>all.data &lt;- merge(gtex.s3, dlbc.exp, by = <span>0</span>)<br>all.data &lt;- column_to_rownames(all.data, <span>"Row.names"</span>)<br>dim(all.data)<br><span># [1] 57793   492</span><br><br>head(all.data)[<span>1</span>:<span>5</span>, <span>1</span>:<span>4</span>]<br><span>#           GTEX-111YS-0006-SM-5NQBE GTEX-1122O-0003-SM-5Q5DL GTEX-113IC-0006-SM-5NQ9C GTEX-113JC-0006-SM-5O997</span><br><span># 5_8S_rRNA            -1.571525e-08            -1.571525e-08            -1.571525e-08            -1.571525e-08</span><br><span># 5S_rRNA              -1.571525e-08            -1.571525e-08            -1.571525e-08            -1.571525e-08</span><br><span># 7SK                  -1.571525e-08            -1.571525e-08            -1.571525e-08            -1.571525e-08</span><br><span># A1BG                  2.641511e+00             3.407365e+00             3.005374e+00             1.545996e+00</span><br><span># A1BG-AS1              1.580150e+00             2.618198e+00             2.657654e+00             6.690156e-01</span><br><br><span># 前面444列是来自GTEx的正常blood组织样本，后面48列是来自TCGA的DLBC癌组织样本</span><br><br><span># 浅浅保存一下</span><br>saveRDS(all.data, file = <span>'./generated_data/all_data_tcga_gtex.rds'</span>)<br><br><span>############################### 整合完毕 #######################################</span><br><br><span># 去除批次效应</span><br><span>library</span>(limma)<br>nromalized.data &lt;- normalizeBetweenArrays(all.data)<br>nromalized.data &lt;- as.data.frame(nromalized.data)<br><br><span># 接下来，就可以进行我们的后续分析啦！</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>TCGA 与 GTEx 癌症类型与组织来源对应表</span><span></span></h3><section data-tool="mdnice编辑器"><table><thead><tr><th>TCGA</th><th>Cancer</th><th>Tumor</th><th>Normal</th><th>GTEx</th><th>Numer</th></tr></thead><tbody><tr><td>ACC</td><td>Adrenocortical carcinoma</td><td>77</td><td>-</td><td>Adrenal Gland</td><td>128</td></tr><tr><td>BLCA</td><td>Bladder Urothelial Carcinoma</td><td>404</td><td>19</td><td>Bladder</td><td>9</td></tr><tr><td>BRCA</td><td>Breast invasive carcinoma</td><td>1085</td><td>112</td><td>Breast</td><td>179</td></tr><tr><td>CESC</td><td>Cervical squamous cell carcinoma and endocervical adenocarcinoma</td><td>306</td><td>3</td><td>Cervix Uteri</td><td>10</td></tr><tr><td>CHOL</td><td>Cholangio carcinoma</td><td>36</td><td>9</td><td>-</td><td>-</td></tr><tr><td>COAD</td><td>Colon adenocarcinoma</td><td>275</td><td>41</td><td>Colon</td><td>308</td></tr><tr><td>DLBC</td><td>Lymphoid Neoplasm Diffuse Large B-cell Lymphoma</td><td>47</td><td>-</td><td>Blood</td><td>337</td></tr><tr><td>ESCA</td><td>Esophageal carcinoma</td><td>182</td><td>13</td><td>Esophagus</td><td>273</td></tr><tr><td>GBM</td><td>Glioblastoma multiforme</td><td>163</td><td>-</td><td>Brain</td><td>207</td></tr><tr><td>HNSC</td><td>Head and Neck squamous cell carcinoma</td><td>519</td><td>44</td><td>-</td><td>-</td></tr><tr><td>KICH</td><td>Kidney Chromophobe</td><td>66</td><td>25</td><td>Kidney</td><td>28</td></tr><tr><td>KIRC</td><td>Kidney renal clear cell carcinoma</td><td>523</td><td>72</td><td>Kidney</td><td>28</td></tr><tr><td>KIRP</td><td>Kidney renal papillary cell carcinoma</td><td>286</td><td>32</td><td>Kidney</td><td>28</td></tr><tr><td>LAML</td><td>Acute Myeloid Leukemia</td><td>173</td><td>-</td><td>Bone Marrow</td><td>70</td></tr><tr><td>LGG</td><td>Brain Lower Grade Glioma</td><td>518</td><td>-</td><td>Brain</td><td>207</td></tr><tr><td>LIHC</td><td>Liver hepatocellular carcinoma</td><td>369</td><td>50</td><td>Liver</td><td>110</td></tr><tr><td>LUAD</td><td>Lung adenocarcinoma</td><td>483</td><td>59</td><td>Lung</td><td>288</td></tr><tr><td>LUSC</td><td>Lung squamous cell carcinoma</td><td>486</td><td>50</td><td>Lung</td><td>288</td></tr><tr><td>MESO</td><td>Mesothelioma</td><td>87</td><td>-</td><td>-</td><td>-</td></tr><tr><td>OV</td><td>Ovarian serous cystadenocarcinoma</td><td>426</td><td>-</td><td>Ovary</td><td>88</td></tr><tr><td>PAAD</td><td>Pancreatic adenocarcinoma</td><td>179</td><td>4</td><td>Pancreas</td><td>167</td></tr><tr><td>PCPG</td><td>Pheochromocytoma and Paraganglioma</td><td>182</td><td>3</td><td>-</td><td>-</td></tr><tr><td>PRAD</td><td>Prostate adenocarcinoma</td><td>492</td><td>52</td><td>Prostate</td><td>100</td></tr><tr><td>READ</td><td>Rectum adenocarcinoma</td><td>92</td><td>10</td><td>Colon</td><td>308</td></tr><tr><td>SARC</td><td>Sarcoma</td><td>262</td><td>2</td><td>-</td><td>-</td></tr><tr><td>SKCM</td><td>Skin Cutaneous Melanoma</td><td>461</td><td>1</td><td>Skin</td><td>557</td></tr><tr><td>STAD</td><td>Stomach adenocarcinoma</td><td>408</td><td>36</td><td>Stomach</td><td>175</td></tr><tr><td>TGCT</td><td>Testicular Germ Cell Tumors</td><td>137</td><td>-</td><td>Testis</td><td>165</td></tr><tr><td>THCA</td><td>Thyroid carcinoma</td><td>512</td><td>59</td><td>Thyroid</td><td>278</td></tr><tr><td>THYM</td><td>Thymoma</td><td>118</td><td>2</td><td>Blood</td><td>337</td></tr><tr><td>UCEC</td><td>Uterine Corpus Endometrial Carcinoma</td><td>174</td><td>13</td><td>Uterus</td><td>78</td></tr><tr><td>UCS</td><td>Uterine Carcinosarcoma</td><td>57</td><td>-</td><td>Uterus</td><td>78</td></tr><tr><td>UVM</td><td>Uveal Melanoma</td><td>79</td><td>-</td><td>-</td><td>-</td></tr></tbody></table></section><h1 data-tool="mdnice编辑器"><span></span><span>参考资料</span></h1><ol data-tool="mdnice编辑器"><li><section>https://www.jianshu.com/p/dd5806d4678a</section></li><li><section>https://zhuanlan.zhihu.com/p/83140956</section></li><li><section>https://www.jingege.wang/2022/03/16/gtex联合tcga数据库差异分析/</section></li></ol></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/MEy5dqu1P7yh9VQR7OVYDQ",target="_blank" rel="noopener noreferrer">原文链接</a>
