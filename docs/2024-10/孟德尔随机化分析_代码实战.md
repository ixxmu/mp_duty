---
title: "孟德尔随机化分析：代码实战"
date: 2024-10-12T13:33:34Z
draft: ["false"]
tags: [
  "fetched",
  "育种数据分析之放飞自我"
]
categories: ["Acdemic"]
---
孟德尔随机化分析：代码实战 by 育种数据分析之放飞自我
------
<div><p data-mpa-powered-by="yiban.io">大家好，我是邓飞。</p><p>孟德尔随机化和GWAS一样，是比较常见的分析方法，这里用R语言包TwoSampleMR进行介绍，如何走通MR分析流程。</p><p><strong>孟德尔随机化定义：</strong></p><p>孟德尔随机化分析（Mendelian Randomization, MR）是一种流行的流行病学研究方法，主要用于探讨暴露因素（如生活习惯、环境因素等）与健康结果（如疾病、健康状况等）之间的因果关系。这种方法利用了遗传变异（通常是单核苷酸多态性，SNP）作为工具变量，以避免混杂因素和逆因果关系的影响。</p><p><strong>孟德尔随机化和孟德尔的关系：</strong><br></p><p>MR遵循“亲代等位基因随机分配给子代”的孟德尔遗传定律，选择合适的“基因变异”作为工具变量，指代无法测量的待研究暴露因素，通过测量遗传变异与暴露因素、遗传变异与疾病结局之间的关联，进而推断暴露因素与疾病结局之间的关联。</p><p><strong>孟德尔随机化的由来：</strong></p><p>1986年，Katan首次提出MR的遗传思想：由于配子形成时，遵循“亲代等位基因随机分配给子代”的孟德尔遗传规律，如果基因型决定表型，基因型通过表型而与疾病发生关联，因此可以使用基因型作为工具变量来推断表型与疾病的关联。</p><p><strong>一、数据来源</strong><br></p><p>示例数据使用官网的数据，进行了一点补充，对结果进行了可视化。（https://mrcieu.github.io/TwoSampleMR/articles/introduction.html）<br></p><p>整个步骤：</p><p><img data-galleryid="" data-imgfileid="100012354" data-ratio="0.20532319391634982" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7rekfialcjev56dfl3y2RMKicjN4TRuWHv3iborS39LvIDjx0KfmVsubU6eg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="789" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7rekfialcjev56dfl3y2RMKicjN4TRuWHv3iborS39LvIDjx0KfmVsubU6eg/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>步骤1：提取暴露数据的GWAS</strong><br></p><p><img data-galleryid="" data-imgfileid="100012355" data-ratio="0.21875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reBSucwlnLwwekl5fCbfemrKJaMAPGfH9goHS83XC9rf3bmOf6J3XX5Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="800" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reBSucwlnLwwekl5fCbfemrKJaMAPGfH9goHS83XC9rf3bmOf6J3XX5Q/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="shell"><code><span>&gt; ## 1, 安装TwoSampleMR，如果已安装，可以忽略</span></code><code><span>&gt; </span></code><code><span>&gt; # library(remotes)</span></code><code><span>&gt; # install_github("MRCIEU/TwoSampleMR")</span></code><code><span>&gt; </span></code><code><span>&gt; ## 2， 载入TwoSampleMR包</span></code><code><span>&gt; library(TwoSampleMR)</span></code><code><span>&gt; </span></code><code><span>&gt; ## 3，从数据库中提取暴露的GWAS summary数据</span></code><code><span>&gt; exposure_dat = extract_instruments("ieu-a-2")</span></code><code><span>&gt; dim(exposure_dat)</span></code><code><span>[1] 79 15</span></code></pre></section><p>共有79行15列的暴露数据结果。<br></p><p><strong>步骤2：提取结局数据的GWAS</strong></p><p><img data-galleryid="" data-imgfileid="100012356" data-ratio="0.2989949748743719" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reYOv5sHMX58UEicXT0ibibtVQq1vKmwV55okQ2qfOqvEL2IMaPkpdoUia1w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="796" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reYOv5sHMX58UEicXT0ibibtVQq1vKmwV55okQ2qfOqvEL2IMaPkpdoUia1w/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="shell"><code><span>&gt; ## 4，从数据库中提取结局变量的的GWAS summary数据，SNP用暴露数据的结果</span></code><code><span>&gt; # Get effects of instruments on outcome</span></code><code><span>&gt; outcome_dat = extract_outcome_data(snps=exposure_dat$SNP, outcomes = "ieu-a-7")</span></code><code><span>Extracting data for 79 SNP(s) from 1 GWAS(s)</span></code><code><span>&gt; dim(outcome_dat)</span></code><code><span>[1] 79 16</span></code></pre></section><p>共79行15列的结局数据，注意，这里直接使用暴露数据质控后的SNP，提取结局数据得到的结果，所以位点数是一样的。</p><p><strong>步骤3：合并暴露数据和结局数据</strong></p><p><img data-galleryid="" data-imgfileid="100012357" data-ratio="0.3748411689961881" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reYVPUZ7BBSuOR0mvBUnkBohibGibhBVG6fiaN1zfgneSfQMibnYnJ9HnwCA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="787" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reYVPUZ7BBSuOR0mvBUnkBohibGibhBVG6fiaN1zfgneSfQMibnYnJ9HnwCA/640?wx_fmt=png&amp;from=appmsg"></p><p><strong></strong></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span>&gt; ## 5，将暴露数据和结局数据合并</span></code><code><span>&gt; # Harmonise the exposure and outcome data</span></code><code><span>&gt; dat = harmonise_data(exposure_dat, outcome_dat)</span></code><code><span>Harmonising Body mass index || id:ieu-a-2 (ieu-a-2) and Coronary heart disease || id:ieu-a-7 (ieu-a-7)</span></code><code><span>&gt; dim(dat)</span></code><code><span>[1] 79 36</span></code></pre></section><p>合并的数据，共79行，36列，这些数据可以用于孟德尔随机化的分析。<br></p><p><strong>步骤4：孟德尔随机化分析及结果可视化</strong></p><p><img data-galleryid="" data-imgfileid="100012358" data-ratio="0.2786885245901639" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reQiaXFsbTMpicxTgQ9L5JxDbnUHNhIuB9tqaeZ6GEJaNIzDqIEm7rkicTA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="793" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reQiaXFsbTMpicxTgQ9L5JxDbnUHNhIuB9tqaeZ6GEJaNIzDqIEm7rkicTA/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span>&gt; ## 6，进行孟德尔随机化分析</span></code><code><span>&gt; res = mr(dat)</span></code><code><span>Analysing 'ieu-a-2' on 'ieu-a-7'</span></code><code><span>&gt; ## 7，异质化分析</span></code><code><span>&gt; mr_heterogeneity(dat)</span></code><code><span>  id.exposure id.outcome                              outcome                      exposure                    method        Q</span></code><code><span>1     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7 Body mass index || id:ieu-a-2                  MR Egger 143.3046</span></code><code><span>2     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7 Body mass index || id:ieu-a-2 Inverse variance weighted 143.6508</span></code><code><span>  Q_df       Q_pval</span></code><code><span>1   77 6.841585e-06</span></code><code><span>2   78 8.728420e-06</span></code><code><span>&gt; ## 8，水平多效性分析</span></code><code><span>&gt; mr_pleiotropy_test(dat)</span></code><code><span>  id.exposure id.outcome                              outcome                      exposure egger_intercept          se      pval</span></code><code><span>1     ieu-a-2    ieu-a-7 Coronary heart disease || id:ieu-a-7 Body mass index || id:ieu-a-2    -0.001719304 0.003985962 0.6674266</span></code><code><span>&gt; ## 9，留一法分析</span></code><code><span>&gt; res_loo = mr_leaveoneout(dat)</span></code><code><span>&gt; mr_leaveoneout_plot(res_loo)</span></code><code><span>$`ieu-a-2.ieu-a-7`</span></code><code><span><br></span></code><code><span>attr(,"split_type")</span></code><code><span>[1] "data.frame"</span></code><code><span>attr(,"split_labels")</span></code><code><span>  id.exposure id.outcome</span></code><code><span>1     ieu-a-2    ieu-a-7</span></code><code><span>&gt; ## 10，散点图</span></code><code><span>&gt; </span></code><code><span>&gt; p1 = mr_scatter_plot(res, dat)</span></code><code><span>&gt; p1</span></code><code><span>$`ieu-a-2.ieu-a-7`</span></code><code><span><br></span></code><code><span>attr(,"split_type")</span></code><code><span>[1] "data.frame"</span></code><code><span>attr(,"split_labels")</span></code><code><span>  id.exposure id.outcome</span></code><code><span>1     ieu-a-2    ieu-a-7</span></code><code><span>&gt; </span></code><code><span>&gt; ## 11，森林图</span></code><code><span>&gt; res_single = mr_singlesnp(dat)</span></code><code><span>&gt; mr_forest_plot(res_single)</span></code><code><span>$`ieu-a-2.ieu-a-7`</span></code><code><span><br></span></code><code><span>attr(,"split_type")</span></code><code><span>[1] "data.frame"</span></code><code><span>attr(,"split_labels")</span></code><code><span>  id.exposure id.outcome</span></code><code><span>1     ieu-a-2    ieu-a-7</span></code><code><span>Warning messages:</span></code><code><span>1: Removed 1 row containing missing values or values outside the scale range (`geom_errorbarh()`). </span></code><code><span>2: Removed 1 row containing missing values or values outside the scale range (`geom_point()`). </span></code><code><span>&gt; </span></code><code><span>&gt; ## 12，漏斗图</span></code><code><span>&gt; mr_funnel_plot(res_single)</span></code><code><span>$`ieu-a-2.ieu-a-7`</span></code><code><span><br></span></code><code><span>attr(,"split_type")</span></code><code><span>[1] "data.frame"</span></code><code><span>attr(,"split_labels")</span></code><code><span>  id.exposure id.outcome</span></code><code><span>1     ieu-a-2    ieu-a-7</span></code></pre></section><p><strong>留一法的森林图：</strong></p><p><img data-galleryid="" data-imgfileid="100012359" data-ratio="0.7726550079491256" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reSwcSGfVvFzVaA3kcsic8IDUzmLgh0tx3COGLhSTRiaAS7MhIQfdDAJ8A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="629" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reSwcSGfVvFzVaA3kcsic8IDUzmLgh0tx3COGLhSTRiaAS7MhIQfdDAJ8A/640?wx_fmt=png&amp;from=appmsg"></p><p><strong>孟德尔随机化的森林图：</strong><br></p><p><img data-galleryid="" data-imgfileid="100012366" data-ratio="0.5111111111111111" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reia6iaZozPgiaiboLibwcptDuLB80qCFhHFmqnLNp41jXWaUWv8VT48wrhGA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reia6iaZozPgiaiboLibwcptDuLB80qCFhHFmqnLNp41jXWaUWv8VT48wrhGA/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span>孟德尔随机化的散点图：</span></strong></p><p><img data-galleryid="" data-imgfileid="100012364" data-ratio="0.5111111111111111" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reY4ozlib3CLrKsNWHnPsVHz6kYRnrF4hE6UycURDsfAN16eEIQRerV2w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7reY4ozlib3CLrKsNWHnPsVHz6kYRnrF4hE6UycURDsfAN16eEIQRerV2w/640?wx_fmt=png&amp;from=appmsg"><strong></strong></p><p><strong>孟德尔随机化的漏斗图：</strong></p><p><strong><img data-galleryid="" data-imgfileid="100012365" data-ratio="0.5111111111111111" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7relicH6icJ73yO5mLvQY1asA0AfS4QXbtx4X4c9tqGgRl2mpr9eWmsBxvw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daD6LVw3O8uOCRMyHDrJr7relicH6icJ73yO5mLvQY1asA0AfS4QXbtx4X4c9tqGgRl2mpr9eWmsBxvw/640?wx_fmt=png&amp;from=appmsg"></strong></p><p><strong>还有哪些需要研究的？</strong><br></p><p><span>如何读取自己的GWAS summary结果，并将格式整理为TwoSampleMR的格式？</span></p><p><span>如何对暴露数据GWAS结果进行质控，包括LD质控，F值质控，R2质控等？<br></span></p><p><span>怎么对已发表的文章进行结果图标的复现？<br></span></p><p><span>这些都是细枝末节，等我后续一一完成博客的文章，欢迎继续关注。</span><br></p><p><strong><span>上面分析完整的代码汇总：</span></strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span><span>## 1, 安装TwoSampleMR，如果已安装，可以忽略</span></span></code><code><span><br></span></code><code><span><span># library(remotes)</span></span></code><code><span><span># install_github("MRCIEU/TwoSampleMR")</span></span></code><code><span><br></span></code><code><span><span>## 2， 载入TwoSampleMR包</span></span></code><code><span>library(TwoSampleMR)</span></code><code><span><br></span></code><code><span><span>## 3，从数据库中提取暴露的GWAS summary数据</span></span></code><code><span>exposure_dat = extract_instruments(<span>"ieu-a-2"</span>)</span></code><code><span>dim(exposure_dat)</span></code><code><span><br></span></code><code><span><span>## 4，从数据库中提取结局变量的的GWAS summary数据，SNP用暴露数据的结果</span></span></code><code><span><span># Get effects of instruments on outcome</span></span></code><code><span>outcome_dat = extract_outcome_data(snps=exposure_dat$SNP, outcomes = <span>"ieu-a-7"</span>)</span></code><code><span>dim(outcome_dat)</span></code><code><span><br></span></code><code><span><span>## 5，将暴露数据和结局数据合并</span></span></code><code><span><span># Harmonise the exposure and outcome data</span></span></code><code><span>dat = harmonise_data(exposure_dat, outcome_dat)</span></code><code><span>dim(dat)</span></code><code><span><br></span></code><code><span><span>## 6，进行孟德尔随机化分析</span></span></code><code><span>res = mr(dat)</span></code><code><span><br></span></code><code><span><span>## 7，异质化分析</span></span></code><code><span>mr_heterogeneity(dat)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>## 8，水平多效性分析</span></span></code><code><span>mr_pleiotropy_test(dat)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>## 9，留一法分析</span></span></code><code><span>res_loo = mr_leaveoneout(dat)</span></code><code><span>mr_leaveoneout_plot(res_loo)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>## 10，散点图</span></span></code><code><span><br></span></code><code><span>p1 = mr_scatter_plot(res, dat)</span></code><code><span>p1</span></code><code><span><br></span></code><code><span><span>## 11，森林图</span></span></code><code><span>res_single = mr_singlesnp(dat)</span></code><code><span>mr_forest_plot(res_single)</span></code><code><span><br></span></code><code><span><span>## 12，漏斗图</span></span></code><code><span>mr_funnel_plot(res_single)</span></code></pre></section><p><strong><strong><span>想要更好的学习和交流，快来加入</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0MTIzNjYwNQ==&amp;mid=2247491476&amp;idx=1&amp;sn=8512962ea1264b569db4aa8d15b8712f&amp;chksm=e90ff086de7879908a1fa151e81004993a15650bae3f68e4d518a332beb18a130373c492043e&amp;scene=21#wechat_redirect" textvalue="飞哥的知识星球" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">飞哥的知识星球</a><span>，这是一个生物统计+数量遗传学+GWAS+GS的社区，在这里你可以向飞哥提问、帮你制定学习计划、跟着飞哥一起做实战项目，冲冲冲。</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0MTIzNjYwNQ==&amp;mid=2247491476&amp;idx=1&amp;sn=8512962ea1264b569db4aa8d15b8712f&amp;chksm=e90ff086de7879908a1fa151e81004993a15650bae3f68e4d518a332beb18a130373c492043e&amp;scene=21#wechat_redirect" textvalue="点击这里加入吧：飞哥的学习圈子" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span><strong>点击这里加入吧：</strong></span>飞哥的学习圈子</a></strong></strong></p><p><strong><strong><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0MTIzNjYwNQ==&amp;mid=2247491476&amp;idx=1&amp;sn=8512962ea1264b569db4aa8d15b8712f&amp;chksm=e90ff086de7879908a1fa151e81004993a15650bae3f68e4d518a332beb18a130373c492043e&amp;scene=21#wechat_redirect" textvalue="点击这里加入吧：飞哥的学习圈子" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"></a></strong></strong></p><p><strong><img data-imgfileid="100012367" data-ratio="1.2462264150943396" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/XEicwVA08daCyoYQooxoH1tCzgN5xxevlQokBib7RiaStK9nPw4qo80OfqYAuRHsPAU4DJ2StOCUnHicqZNuG4fibow/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-w="1060" src="https://mmbiz.qpic.cn/mmbiz_jpg/XEicwVA08daCyoYQooxoH1tCzgN5xxevlQokBib7RiaStK9nPw4qo80OfqYAuRHsPAU4DJ2StOCUnHicqZNuG4fibow/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></strong></p><p><br></p><section><mp-common-profile data-pluginname="mpprofile" data-id="MzI0MTIzNjYwNQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/XEicwVA08daBIrllkaO46sRRbb3FItjeuFJ8omwhsLeNMmlvBtiaE8o3Dpib2h7XaAiaViaGQVlD5ufeDGvia2WQMU8g/300?wx_fmt=png&amp;wxfrom=19" data-nickname="育种数据分析之放飞自我" data-alias="R-breeding" data-signature="本公众号主要介绍动植物育种数据分析中的相关问题, 算法及程序代码." data-from="2" data-is_biz_ban="0" data-origin_num="845" data-isban="0" data-biz_account_status="0" data-index="0"></mp-common-profile></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/QuOBgxi9WNTe_x4rrk4Npw",target="_blank" rel="noopener noreferrer">原文链接</a>
