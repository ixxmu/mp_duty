---
title: "超越代码10：细胞互作分析"
date: 2024-10-18T00:10:18Z
draft: ["false"]
tags: [
  "fetched",
  "生信会客厅"
]
categories: ["Acdemic"]
---
超越代码10：细胞互作分析 by 生信会客厅
------
<div><section><em>本次分享的教程源自我多年优化的实战代码，其中有很多提高效率和优化结果的自定义函数封装于scPRIT包。由于scPRIT包依赖特定的R和Python环境，我特意将它集成在docker镜像kinesin/rstudio:2.0.0中。为了确保教程代码的顺畅运行，推荐使用该docker镜像提供的分析环境。</em></section><p><br></p><section>CellPhoneDB和CellChat无疑是当前细胞互作（通讯）分析领域应用最为广泛的两个工具包。CellPhoneDB专注于人类细胞互作的研究，其数据库涵盖了丰富的细胞互作分子对，为研究者提供了详尽的数据资源。然而，其在结果可视化方面的功能稍显薄弱。相比之下，CellChat作为后起之秀，凭借其精美的可视化效果以及对小鼠数据库的支持，因此受到了单细胞分析人员的广泛认可与欢迎。</section><section><br></section><p><span></span></p><p><span><strong>CellPhoneDB基础分析</strong></span><br></p><section><span></span><span>CellPhoneDB是一款基于Python开发的工具包，对于那些习惯于使用R语言进行单细胞分析的朋友来说，可能会有一点使用上的不便。针对这一问题，我开发的scPRIT包</span><span>提供了一个集成函数runCellPhoneDB，它能够自动完成数据转换，并执行基本的细胞互作分析，从而无缝衔接R语言用户的分析流程。</span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>library</span>(Seurat)</span></code><code><span><span>library</span>(tidyverse)</span></code><code><span><span>library</span>(patchwork)</span></code><code><span><span>library</span>(scPRIT)</span></code><code><span><span>setwd</span>(<span>"~/project/BeyondCode/CellPhoneDB"</span>)</span></code><code><span><span><span>options</span></span>(scprithost = <span>"xxx.xxx.xxx.xxx"</span>, authcode = <span>"xxxxxxxxxxxx"</span>)</span></code><code><span><br></span></code><code><span><span># 读取数据并剔除两个细胞数量少且不重要的细胞类型</span></span></code><code><span><span>scRNA</span> &lt;- readRDS(<span>"~/project/BeyondCode/Data/sco.hny_anno_clean.rds"</span>)</span></code><code><span><span>table</span>(scRNA$CellType, scRNA$SampleID)</span></code><code><span><span>scRNA</span> &lt;- subset(scRNA, CellType != <span>"Lymphatic EC"</span>)</span></code><code><span><span>scRNA</span> &lt;- subset(scRNA, CellType != <span>"Mesothelial cell"</span>)</span></code><code><span><span>scRNA</span>$CellType &lt;- as.character(scRNA$CellType)</span></code><code><span><br></span></code><code><span><span># 运行两个配对样本的基础分析</span></span></code><code><span><span>sco</span>.list &lt;- SplitObject(scRNA, split.by = <span>"SampleID"</span>)</span></code><code><span><span>runCellPhoneDB</span>(sco.list[[<span>"LUAD1"</span>]], group.by = <span>"CellType"</span>, output = <span>"LUAD1"</span>, ncore = 48)</span></code><code><span><span>runCellPhoneDB</span>(sco.list[[<span>"N1"</span>]], group.by = <span>"CellType"</span>, output = <span>"N1"</span>, ncore = 48)</span></code></pre></section><p>运行完成后得到以下文件<br></p><p><img data-galleryid="" data-imgfileid="100002736" data-ratio="0.3362676056338028" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwN7CB6lTJ5OKmaoHgwicx3959u5hBicloCRUafecxFuFdPJkmr23KHpTvg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="568" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwN7CB6lTJ5OKmaoHgwicx3959u5hBicloCRUafecxFuFdPJkmr23KHpTvg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong>CellPhoneDB结果可视化</strong></p><p>CellPhoneDB原生的可视化功能相对有限，为此，我借鉴了CellChat的优秀可视化设计，在scPRIT包中增添了一系列针对CellPhoneDB的可视化函数。这些新增功能在一定程度上填补了它在可视化方面的空白，增强了用户在分析细胞互作数据时的体验和便捷性。</p><section><br></section><p><strong>细胞显著互作数量</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="javascript"><code><span>setwd(<span>"~/project/BeyondCode/CellPhoneDB/LUAD1"</span>)</span></code><code><span># 读取分析数据</span></code><code><span>pvals &lt;- read.delim(dir(pattern=<span>"analysis_pvalues"</span>), check.names = FALSE)</span></code><code><span>means &lt;- read.delim(dir(pattern=<span>"analysis_means"</span>), check.names = FALSE)</span></code><code><span>decon = read.delim(dir(pattern=<span>"deconvoluted_\\d{2}"</span>), check.names = FALSE)</span></code><code><span><br></span></code><code><span>### 细胞显著互作数量统计</span></code><code><span># 热图</span></code><code><span>res &lt;- cpdb.CountHeatmap(cpdb_pvals = pvals, display_numbers = T, return_data = T)</span></code><code><span>ggsave(<span>"cci_count_heatmap.pdf"</span>, res$plot, width = <span>8</span>, height = <span>7.5</span>)</span></code><code><span>write.csv(res$table, file = <span>"cci_count_heatmap.csv"</span>)</span></code><code><span>celltypes &lt;- c(<span>"T cell"</span>,<span>"B cell"</span>,<span>"Monocyte"</span>,<span>"Macrophage"</span>,<span>"DC"</span>)</span></code><code><span>p &lt;- cpdb.CountHeatmap(cpdb_pvals = pvals, celltype.use = celltypes, display_numbers = F, return_data = F)</span></code><code><span>ggsave(<span>"cci_count_heatmap_immuneCells.pdf"</span>, p, width = <span>5</span>, height = <span>4.5</span>)</span></code><code><span># 网络图</span></code><code><span>pdf(<span>"cci_count_graph.pdf"</span>, width = <span>8</span>, height = <span>8</span>)</span></code><code><span>cpdb.CountGraph(cpdb_pvals = pvals)</span></code><code><span>dev.off()</span></code><code><span>pdf(<span>"cci_count_graph_StromalCell.pdf"</span>, width = <span>8</span>, height = <span>8</span>)</span></code><code><span>cpdb.CountGraph(cpdb_pvals = pvals, source.use = <span>"Stromal cell"</span>, edge.label = T)</span></code><code><span>dev.off()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002737" data-ratio="0.9396325459317585" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwN9KSI5b7OzqelIVGOdXqKHp3aAhzHdfbmEqHLTq9DtqvMXJ28Ij3BnA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="762" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwN9KSI5b7OzqelIVGOdXqKHp3aAhzHdfbmEqHLTq9DtqvMXJ28Ij3BnA/640?wx_fmt=png&amp;from=appmsg"></p><p><span>cci_count_heatmap</span></p><p><br></p><p><img data-galleryid="" data-imgfileid="100002739" data-ratio="0.8678071539657853" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNibkuLk4cBgFaoxD4wPqhnGpwxc7LhSjYEwmjKdmYG8dxz2UmRU9xZeg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="643" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNibkuLk4cBgFaoxD4wPqhnGpwxc7LhSjYEwmjKdmYG8dxz2UmRU9xZeg/640?wx_fmt=png&amp;from=appmsg"></p><p><span>cci_count_graph</span><span></span></p><p><img data-galleryid="" data-imgfileid="100002740" data-ratio="0.8838304552590267" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNIIGfDjYrZibClR5bEu519liavOAUOC1eU7LLWLD0gnYzSmBxebUdtwpw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="637" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNIIGfDjYrZibClR5bEu519liavOAUOC1eU7LLWLD0gnYzSmBxebUdtwpw/640?wx_fmt=png&amp;from=appmsg"></p><p><span>cci_count_graph_StromalCell</span><span></span></p><p><span><br></span></p><p><strong>细胞互作权重</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="xml"><code><span>### 细胞互作权重统计</span></code><code><span># 热图</span></code><code><span>res <span>&lt;<span>-</span> <span>cpdb.WeightHeatmap</span>(<span>cpdb_means</span> = <span>means,</span> <span>cpdb_pvals</span> = <span>pvals,</span> <span>display_numbers</span> = <span>T,</span> </span></span></code><code><span>                             <span>significant_only</span> = <span>T,</span> <span>return_data</span> = <span>T)</span></span></code><code><span><span>ggsave</span>("<span>cci_weight_heatmap.pdf</span>", <span>res</span>$<span>plot</span>, <span>width</span> = <span>8,</span> <span>height</span> = <span>7.5)</span></span></code><code><span># 网络图</span></code><code><span><span>pdf</span>("<span>cci_weight_graph.pdf</span>", <span>width</span> = <span>8,</span> <span>height</span> = <span>8)</span></span></code><code><span><span>cpdb.WeightGraph</span>(<span>cpdb_means</span> = <span>means,</span> <span>cpdb_pvals</span> = <span>pvals,</span> <span>significant_only</span> = <span>T)</span></span></code><code><span><span>dev.off</span>()</span></code><code><span><span>pdf</span>("<span>cci_weight_graph_StromalCell.pdf</span>", <span>width</span> = <span>8,</span> <span>height</span> = <span>8)</span></span></code><code><span><span>cpdb.WeightGraph</span>(<span>cpdb_means</span> = <span>means,</span> <span>cpdb_pvals</span> = <span>pvals,</span> <span>significant_only</span> = <span>T,</span> </span></code><code><span>                 <span>source.use</span> = <span>"Stromal cell"</span>, <span>edge.label</span> = <span>T)</span></span></code><code><span><span>dev.off</span>()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002741" data-ratio="0.937007874015748" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNIUian1iawRENfibLjG2wxGkZfKs9MqkPtpXkAqZJTqKiaPmWjGnGQr9ib2g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="762" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNIUian1iawRENfibLjG2wxGkZfKs9MqkPtpXkAqZJTqKiaPmWjGnGQr9ib2g/640?wx_fmt=png&amp;from=appmsg"></p><p>cci_weight_heatmap</p><p><br></p><p><strong>细胞互作气泡图</strong><br></p><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="objectivec"><code><span><span># 全部细胞与配受体</span></span></code><code><span>p &lt;- cpdb.Dotplot(means, pvals, grid = <span>TRUE</span>, rotated_axis = <span>TRUE</span>)</span></code><code><span>ggsave(<span>"cci_dotplot_all.pdf"</span>, p, width = <span>40</span>, height = <span>80</span>, limitsize = F)</span></code><code><span><br></span></code><code><span><span># 指定细胞类型与配受体</span></span></code><code><span>celltypes &lt;- c(<span>"T cell"</span>,<span>"B cell"</span>,<span>"Monocyte"</span>,<span>"Macrophage"</span>,<span>"DC"</span>)</span></code><code><span>chemokines &lt;- subset(pvals, classification==<span>"Signaling by Chemokines"</span>) %&gt;% pull(interacting_pair)</span></code><code><span>p &lt;- cpdb.Dotplot(means, pvals, inter_pair = chemokines, celltype2 = celltypes, grid = <span>TRUE</span>, rotated_axis = <span>TRUE</span>)</span></code><code><span>ggsave(<span>"cci_dotplot_chemokines.pdf"</span>, p, width = <span>12</span>, height = <span>5</span>, limitsize = F)</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002742" data-ratio="0.41203703703703703" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNLXLABPMvJEqfArGVjlYyM34cOsxcdO1k84MtKt9gGwEjwzjXibVqFKw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNLXLABPMvJEqfArGVjlYyM34cOsxcdO1k84MtKt9gGwEjwzjXibVqFKw/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong>配受体互作展示</strong></p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span># 网络图</span></span></code><code><span><span>pdf</span>(<span>"inter_pair_graph_ CXCL12_CXCR4.pdf"</span>, width = 8, height = 8)</span></code><code><span><span>cpdb</span>.ipGraph(cpdb_means = means, cpdb_pvals = pvals, inter_pair = <span>"CXCL12_CXCR4"</span>)</span></code><code><span><span>dev</span>.<span>off</span>()</span></code><code><span><span># 和弦图</span></span></code><code><span><span>pdf</span>(<span>"inter_pair_chord_CXCL12_CXCR4.pdf"</span>, width = 8, height = 8)</span></code><code><span><span>cpdb</span>.ipChord(cpdb_means = means, cpdb_pvals = pvals, inter_pair = <span>"CXCL12_CXCR4"</span>)</span></code><code><span><span>dev</span>.<span>off</span>()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002757" data-ratio="0.51340206185567" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNe6LgGyUpicxjj26S5ictX4Ibo3jv9jZPzvjIp9OzSdOOyyQnCTUfROpQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="970" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNe6LgGyUpicxjj26S5ictX4Ibo3jv9jZPzvjIp9OzSdOOyyQnCTUfROpQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><br></p><p><br></p><p><span><strong>CellPhoneDB配对数据分析</strong></span></p><p><strong>配对数据细胞互作差异分析</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span>setwd(<span>"~/project/BeyondCode/CellPhoneDB/"</span>)</span></code><code><span>means<span>.1</span> &lt;- read.delim(<span>"LUAD1/statistical_analysis_means_10_17_2024_020742.txt"</span>, check.names = F)</span></code><code><span>means<span>.2</span> &lt;- read.delim(<span>"N1/statistical_analysis_means_10_17_2024_020833.txt"</span>, check.names = F)</span></code><code><span>pvals<span>.1</span> &lt;- read.delim(<span>"LUAD1/statistical_analysis_pvalues_10_17_2024_020742.txt"</span>, check.names = F)</span></code><code><span>pvals<span>.2</span> &lt;- read.delim(<span>"N1/statistical_analysis_pvalues_10_17_2024_020833.txt"</span>, check.names = F)</span></code><code><span>decon<span>.1</span> &lt;- read.delim(<span>"LUAD1/statistical_analysis_deconvoluted_10_17_2024_020742.txt"</span>, check.names = F)</span></code><code><span>decon<span>.2</span> &lt;- read.delim(<span>"N1/statistical_analysis_deconvoluted_10_17_2024_020833.txt"</span>, check.names = F)</span></code><code><span><br></span></code><code><span><span>### 互作数量整体对比</span></span></code><code><span>p &lt;- cpdb.CountDiffHeatmap(cpdb_pvals<span>.1</span> = pvals<span>.1</span>, cpdb_pvals<span>.2</span> = pvals<span>.2</span>)</span></code><code><span>ggsave(<span>"cci_count_diff_heatmap.pdf"</span>, p, width = <span>8</span>, height = <span>7.5</span>)</span></code><code><span><br></span></code><code><span><span>### 互作数量分类对比</span></span></code><code><span>p &lt;- cpdb.CountDiffBarplot(cpdb_pvals<span>.1</span> = pvals<span>.1</span>, cpdb_pvals<span>.2</span> = pvals<span>.2</span>)</span></code><code><span>ggsave(<span>"cci_count_diff_barplot.pdf"</span>, p, width = <span>18</span>, height = <span>8</span>)</span></code><code><span><br></span></code><code><span><span>### 互作权重整体对比</span></span></code><code><span>p &lt;- cpdb.WeightDiffHeatmap(means<span>.1</span>, means<span>.2</span>, pvals<span>.1</span>, pvals<span>.2</span>)</span></code><code><span>ggsave(<span>"cci_weight_diff_heatmap.pdf"</span>, p, width = <span>8</span>, height = <span>7.5</span>)</span></code><code><span><br></span></code><code><span><span>### 互作权重分类对比</span></span></code><code><span>p &lt;- cpdb.WeightDiffBarplot(means<span>.1</span>, means<span>.2</span>, pvals<span>.1</span>, pvals<span>.2</span>)</span></code><code><span>ggsave(<span>"cci_weight_diff_barplot.pdf"</span>, p, width = <span>18</span>, height = <span>8</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>### 配受体基因差异分析</span></span></code><code><span><span># 差异分析</span></span></code><code><span>diff.ip &lt;- cpdb.findIPs(scRNA, ident<span>.1</span> = <span>"LUAD"</span>, ident<span>.2</span> = <span>"PT"</span>, <span>group</span>.<span>by</span> = <span>"Group"</span>,</span></code><code><span>                        cpdb_decon<span>.1</span> = decon<span>.1</span>, cpdb_decon<span>.2</span> = decon<span>.2</span>,</span></code><code><span>                        cpdb_pvals<span>.1</span> = pvals<span>.1</span>, cpdb_pvals<span>.2</span> = pvals<span>.2</span>,</span></code><code><span>                        log2fc.threshold = <span>0.25</span>, pval.threshold = <span>0.01</span>)</span></code><code><span>write.csv(diff.ip, file = <span>"significant_diff_interaction_pairs.csv"</span>)</span></code><code><span><br></span></code><code><span><span>### 互作对比气泡图</span></span></code><code><span>p &lt;- cpdb.CompareDotplot(means<span>.1</span>, means<span>.2</span>, pvals<span>.1</span>, pvals<span>.2</span>, </span></code><code><span>                         group_name = c(<span>"LUAD1"</span>, <span>"N1"</span>), </span></code><code><span>                         celltype1 = celltypes, celltype2 = celltypes,</span></code><code><span>                         inter_pair = diff.ip$interacting_pair)</span></code><code><span>ggsave(<span>"cci_comparision_dotplot.pdf"</span>, p, width = <span>15</span>, height = <span>16</span>, limitsize = F)</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002745" data-ratio="0.9369250985545335" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNMYpZmwphVN9lgCfN8TtucEO4ouLYRYdiaib6wM880UGZA6GWuBsdWJuw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="761" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNMYpZmwphVN9lgCfN8TtucEO4ouLYRYdiaib6wM880UGZA6GWuBsdWJuw/640?wx_fmt=png&amp;from=appmsg"></p><p><span>cci_count_diff_heatmap</span></p><p><span><br></span></p><p><img data-galleryid="" data-imgfileid="100002746" data-ratio="0.43703703703703706" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNibfdW4VSV5wKuuRmAR3haiaCKqXzcgIdS603jjvdYNKnEPSaUxxOfkaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNibfdW4VSV5wKuuRmAR3haiaCKqXzcgIdS603jjvdYNKnEPSaUxxOfkaA/640?wx_fmt=png&amp;from=appmsg"></p><p><span>cci_count_diff_barplot</span><span></span></p><p><span><br></span></p><p><img data-galleryid="" data-imgfileid="100002747" data-ratio="1.0697969543147208" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNrs9Kbl4ggvduk65XpvGIAozQyHtOjdNtxHT5XnkKInLlTyTDNwicPLg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="788" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNrs9Kbl4ggvduk65XpvGIAozQyHtOjdNtxHT5XnkKInLlTyTDNwicPLg/640?wx_fmt=png&amp;from=appmsg"></p><p><span>cci_comparision_dotplot</span><span></span></p><p><span><br></span></p><p><span><br></span></p><p><span><strong>CellCh</strong></span><span><strong>at基础分析</strong></span></p><section><code node="[object Object]">scPRIT</code><span> 包中的 </span><code node="[object Object]">runCellChat</code><span> 函数能够通过一条命令完成 CellChat 的通用基础分析流程。该函数集成了以下核心步骤：</span></section><ul><li><p>将 Seurat 对象转换为 CellChat 对象；</p></li><li><p>选择细胞互作数据库；</p></li><li><p>执行 <code node="[object Object]">CellChat::identifyOverExpressedGenes</code> 函数以识别过表达基因；</p></li><li><p>执行 <code node="[object Object]">CellChat::identifyOverExpressedInteractions</code> 函数以识别过表达的相互作用；</p></li><li><p>根据指定参数选择性执行 <code node="[object Object]">CellChat::projectData</code> 函数；</p></li><li><p>执行 <code node="[object Object]">CellChat::computeCommunProb</code> 函数计算通信概率；</p></li><li><p>执行 <code node="[object Object]">CellChat::filterCommunication</code> 函数过滤通信结果；</p></li><li><p>执行 <code node="[object Object]">CellChat::computeCommunProbPathway</code> 函数计算通路层面的通信概率；</p></li><li><p>执行 <code node="[object Object]">CellChat::aggregateNet</code> 函数聚合网络数据；</p></li><li><p>最后，通过 <code node="[object Object]">CellChat::netAnalysis_computeCentrality</code> 函数进行网络中心度分析。</p></li></ul><p data-spm-anchor-id="5176.28103460.0.i7.297c5d27hkPLpV">这些步骤对于 CellChat 分析而言至关重要，但是又缺乏个性化的调整空间。因此，我将它们封装到一个函数中，简化了分析流程，使代码更加简洁明了。</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="javascript"><code><span>library(Seurat)</span></code><code><span>library(tidyverse)</span></code><code><span>library(patchwork)</span></code><code><span>library(CellChat)</span></code><code><span>library(scPRIT)</span></code><code><span>setwd(<span>"~/project/BeyondCode/CellChat"</span>)</span></code><code><span><br></span></code><code><span>scRNA &lt;- readRDS(<span>"~/project/BeyondCode/Data/sco.hny_anno_clean.rds"</span>)</span></code><code><span>table(scRNA$CellType, scRNA$SampleID)</span></code><code><span>scRNA &lt;- subset(scRNA, CellType != <span>"Lymphatic EC"</span>)</span></code><code><span>scRNA &lt;- subset(scRNA, CellType != <span>"Mesothelial cell"</span>)</span></code><code><span>scRNA$CellType &lt;- <span>as</span>.character(scRNA$CellType)</span></code><code><span><br></span></code><code><span>sco.list &lt;- SplitObject(scRNA, split.by = <span>"Group"</span>)</span></code><code><span>sco.list &lt;- lapply(sco.list, FUN = NormalizeData)</span></code><code><span>sco &lt;- sco.list[[<span>'LUAD'</span>]]</span></code><code><span>runCellChat(sco, celltype.key = <span>"CellType"</span>, output = <span>"LUAD"</span>, species = <span>"human"</span>, min.cells = <span>5</span>)</span></code><code><span>sco &lt;- sco.list[[<span>'PT'</span>]]</span></code><code><span>runCellChat(sco, celltype.key = <span>"CellType"</span>, output = <span>"PT"</span>, species = <span>"human"</span>, min.cells = <span>5</span>)</span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p><br></p><p><span><strong>CellCh</strong></span><span><strong>at结果下游分析</strong></span></p><p><strong>细胞互作情况概览</strong></p><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span><span># 互作数量与强度总览</span></span></code><code><span>pdf(<span>"fig1a_cci_count_weight.pdf"</span>, width = <span>8</span>, height = <span>8</span>)</span></code><code><span>netVisual_circle(cellchat@net$count, vertex.weight = groupSize, weight.scale = T, </span></code><code><span>                 label.edge= F, margin = c(<span>0</span>.<span>2</span>,<span>0</span>.<span>2</span>,<span>0</span>.<span>4</span>,<span>0</span>.<span>2</span>),</span></code><code><span>                 title.name = <span>"Number of interactions"</span>)</span></code><code><span>netVisual_circle(cellchat@net$weight, vertex.weight = groupSize, weight.scale = T, </span></code><code><span>                 label.edge= F, margin = c(<span>0</span>.<span>2</span>,<span>0</span>.<span>2</span>,<span>0</span>.<span>4</span>,<span>0</span>.<span>2</span>),</span></code><code><span>                 title.name = <span>"Interaction weights/strength"</span>)</span></code><code><span>dev.off()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002748" data-ratio="0.5074074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNVedwjJ6NKCZLkz5xlKNeB6kaZ6CobT1icyOodahoatKH71By33tibXUg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNVedwjJ6NKCZLkz5xlKNeB6kaZ6CobT1icyOodahoatKH71By33tibXUg/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="swift"><code><span># 指定细胞类型的互作数量和强度</span></code><code><span>pdf(<span>"fig1b_cci_count_StromalCell.pdf"</span>, width = <span>8</span>, height = <span>8</span>)</span></code><code><span>mat &lt;- cellchat@net$<span>count</span></span></code><code><span>mat.sub &lt;- mat</span></code><code><span>mat.sub[rownames(mat.sub)!=<span>"Stromal cell"</span>,] &lt;- <span>0</span></span></code><code><span>netVisual_circle(mat.sub, vertex.weight = groupSize, weight.scale = <span>T</span>, label.edge = <span>T</span>,</span></code><code><span>                 edge.weight.<span>max</span> = <span>max</span>(mat), margin = <span>c</span>(<span>0.2</span>,<span>0.2</span>,<span>0.4</span>,<span>0.2</span>),</span></code><code><span>                 title.name = <span>"Stromal cell"</span>)</span></code><code><span>dev.off()</span></code><code><span>pdf(<span>"fig1b_cci_weight_StromalCell.pdf"</span>, width = <span>8</span>, height = <span>8</span>)</span></code><code><span>mat &lt;- cellchat@net$weight</span></code><code><span>mat.sub &lt;- mat</span></code><code><span>mat.sub[rownames(mat.sub)!=<span>"Stromal cell"</span>,] &lt;- <span>0</span></span></code><code><span>netVisual_circle(mat.sub, vertex.weight = groupSize, weight.scale = <span>T</span>, label.edge = <span>T</span>,</span></code><code><span>                 edge.weight.<span>max</span> = <span>max</span>(mat), margin = <span>c</span>(<span>0.2</span>,<span>0.2</span>,<span>0.4</span>,<span>0.2</span>),</span></code><code><span>                 title.name = <span>"Stromal cell"</span>)</span></code><code><span>dev.off()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002749" data-ratio="0.5222222222222223" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNOgm1nUjMFxiateey5XoOpLL0TT5liaY3yHP8u88yzUOnjmiaWBMcz0zicg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNOgm1nUjMFxiateey5XoOpLL0TT5liaY3yHP8u88yzUOnjmiaWBMcz0zicg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong>按信号通路探索细胞互作</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>print</span>(cellchat@netP$pathways)</span></code><code><span><span>pathway</span> = <span>"MHC-II"</span></span></code><code><span><br></span></code><code><span><span>## MHC-II通路的互作情况</span></span></code><code><span><span># 网络图</span></span></code><code><span><span>pdf</span>(<span>"fig2a_pathway_circle.pdf"</span>, width = 10, height = 8.5)</span></code><code><span><span>netVisual_aggregate</span>(cellchat, signaling = pathway, layout = <span>"circle"</span>)</span></code><code><span><span>dev</span>.<span>off</span>()</span></code><code><span><span># 和弦图</span></span></code><code><span><span>pdf</span>(<span>"fig2a_pathway_chord.pdf"</span>, width = 10, height = 8.5)</span></code><code><span><span>netVisual_aggregate</span>(cellchat, signaling = pathway, layout = <span>"chord"</span>)</span></code><code><span><span>dev</span>.<span>off</span>()</span></code><code><span><span># 热图</span></span></code><code><span><span>pdf</span>(<span>"fig2a_pathway_heatmap.pdf"</span>, width = 8, height = 5)</span></code><code><span><span>p</span> &lt;- netVisual_heatmap(cellchat, signaling = pathway, color.heatmap = <span>"Reds"</span>)</span></code><code><span><span>plot</span>(p)</span></code><code><span><span>dev</span>.<span>off</span>()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002750" data-ratio="0.4388888888888889" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNNGtm9NtyNfcr1G3giaoww0LOFZLgicRia74LBXOUAAFbhUOjlzohP2QCQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNNGtm9NtyNfcr1G3giaoww0LOFZLgicRia74LBXOUAAFbhUOjlzohP2QCQ/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>## MHC-II通路配受体的互作情况</span></span></code><code><span>myLRs &lt;- extractEnrichedLR(cellchat, signaling = pathway, geneLR.<span>return</span> = <span>FALSE</span>)$interaction_name</span></code><code><span><span>print</span>(myLRs)</span></code><code><span>myLR &lt;- <span>"HLA-DQB1_CD4"</span></span></code><code><span><span># 网络图展示</span></span></code><code><span>pdf(<span>"fig2b_lr_circle.pdf"</span>, width = <span>10</span>, height = <span>8.5</span>)</span></code><code><span>netVisual_individual(cellchat, signaling = pathway, pairLR.<span>use</span> = myLR, layout = <span>"circle"</span>)</span></code><code><span>dev.off()</span></code><code><span><span># 和弦图展示</span></span></code><code><span>pdf(<span>"fig2b_lr_chord.pdf"</span>, width = <span>10</span>, height = <span>8.5</span>)</span></code><code><span>netVisual_individual(cellchat, signaling = pathway, pairLR.<span>use</span> = myLR, layout = <span>"chord"</span>)</span></code><code><span>dev.off()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002751" data-ratio="0.6186107470511141" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNbL6x9zMtcwlSibzyfHeiamcmz9BvVUhvo4XtEUAC2ziccGBWI3E1Wx7OQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="763" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNbL6x9zMtcwlSibzyfHeiamcmz9BvVUhvo4XtEUAC2ziccGBWI3E1Wx7OQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong>信号通路内配体-受体互作详情</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>## MHC-II通路配受体的互作情况</span></span></code><code><span>myLRs &lt;- extractEnrichedLR(cellchat, signaling = pathway, geneLR.<span>return</span> = <span>FALSE</span>)$interaction_name</span></code><code><span><span>print</span>(myLRs)</span></code><code><span>myLR &lt;- <span>"HLA-DQB1_CD4"</span></span></code><code><span><span># 网络图展示</span></span></code><code><span>pdf(<span>"fig2b_lr_circle.pdf"</span>, width = <span>10</span>, height = <span>8.5</span>)</span></code><code><span>netVisual_individual(cellchat, signaling = pathway, pairLR.<span>use</span> = myLR, layout = <span>"circle"</span>)</span></code><code><span>dev.off()</span></code><code><span><span># 和弦图展示</span></span></code><code><span>pdf(<span>"fig2b_lr_chord.pdf"</span>, width = <span>10</span>, height = <span>8.5</span>)</span></code><code><span>netVisual_individual(cellchat, signaling = pathway, pairLR.<span>use</span> = myLR, layout = <span>"chord"</span>)</span></code><code><span>dev.off()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002752" data-ratio="0.525" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNEsvlkJOkibLxjZWjgNYujaARclsdgZB84jlItMZU83JmzHEmtJyCfhQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNEsvlkJOkibLxjZWjgNYujaARclsdgZB84jlItMZU83JmzHEmtJyCfhQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong>细胞互作气泡图</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span><span>## 显示所有细胞间配体-受体互作</span></span></code><code><span>nCT &lt;- length(levels(cellchat@idents))</span></code><code><span>p &lt;- netVisual_bubble(cellchat, sources.<span>use</span> = c(<span>1</span>:nCT), targets.<span>use</span> = c(<span>1</span>:nCT), remove.isolate = <span>FALSE</span>)</span></code><code><span>ggsave(<span>"fig3a_dotplot_all2all.pdf"</span>, p, width = <span>26</span>, height = <span>32</span>, limitsize = F)</span></code><code><span>data &lt;- cellchat.dotplotTable(p, id = <span>"fig3a_dotplot_all2all"</span>)</span></code><code><span><span>## 指定细胞亚型配受体互作</span></span></code><code><span>levels(cellchat@idents)</span></code><code><span><span># sources.use和targets.use的数字对应上一行代码结果的坐标</span></span></code><code><span>p &lt;- netVisual_bubble(cellchat, remove.isolate = <span>FALSE</span>, </span></code><code><span>                      sources.<span>use</span> = c(<span>2</span>,<span>4</span>,<span>5</span>,<span>6</span>,<span>7</span>,<span>8</span>,<span>10</span>), </span></code><code><span>                      targets.<span>use</span> = c(<span>2</span>,<span>4</span>,<span>5</span>,<span>6</span>,<span>7</span>,<span>8</span>,<span>10</span>))</span></code><code><span>ggsave(<span>"fig3b_dotplot_immun.pdf"</span>, p, width = <span>12</span>, height = <span>9</span>, limitsize = F)</span></code><code><span>data &lt;- cellchat.dotplotTable(p, id = <span>"fig3b_dotplot_immun"</span>)</span></code><code><span><span>## 指定细胞亚型和配受体画气泡图</span></span></code><code><span>lr.df &lt;- read.csv(<span>"fig3b_dotplot_immun_prob.csv"</span>, row.names = <span>1</span>)</span></code><code><span>p &lt;- netVisual_bubble(cellchat, remove.isolate = <span>FALSE</span>, </span></code><code><span>                      sources.<span>use</span> = c(<span>2</span>,<span>4</span>,<span>5</span>,<span>6</span>,<span>7</span>,<span>8</span>,<span>10</span>), </span></code><code><span>                      targets.<span>use</span> = c(<span>2</span>,<span>4</span>,<span>5</span>,<span>6</span>,<span>7</span>,<span>8</span>,<span>10</span>), </span></code><code><span>                      pairLR.<span>use</span> = lr.df[<span>1</span>:<span>15</span>,])</span></code><code><span>ggsave(<span>"fig3c_dotplot_immun_sub.pdf"</span>, p, width = <span>10</span>, height = <span>5</span>, limitsize = F)</span></code><code><span>data &lt;- cellchat.dotplotTable(p, id = <span>"fig3c_dotplot_immun_sub"</span>)</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002753" data-ratio="0.4989495798319328" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNrakpYicE4esMODVjDSj6Ipl3hNRMaOKRRHLbbOzcRBqSSaVfrvjU0cg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="952" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNrakpYicE4esMODVjDSj6Ipl3hNRMaOKRRHLbbOzcRBqSSaVfrvjU0cg/640?wx_fmt=png&amp;from=appmsg"></p><p><span>fig3c_dotplot_immun_sub</span></p><p><span><br></span></p><p><span><strong>CellCh</strong></span><span><strong>at配对数据分析</strong></span></p><p><strong>合并分析对象</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cpp"><code><span>rm(<span>list</span> = ls())</span></code><code><span>dir.create(<span>"~/project/BeyondCode/CellChat/LUAD_PT"</span>)</span></code><code><span>setwd(<span>"~/project/BeyondCode/CellChat/LUAD_PT"</span>)</span></code><code><span><br></span></code><code><span># 合并数据</span></code><code><span>cco.ctrl &lt;- readRDS(<span>"~/project/BeyondCode/CellChat/PT/cellchat_obj.rds"</span>)</span></code><code><span>cco.<span>case</span> &lt;- readRDS(<span>"~/project/BeyondCode/CellChat/LUAD/cellchat_obj.rds"</span>)</span></code><code><span>object.<span>list</span> &lt;- <span>list</span>("PT" = cco.ctrl, "LUAD" = cco.<span>case</span>) </span></code><code><span>cellchat &lt;- mergeCellChat(object.<span>list</span>, add.names = names(object.<span>list</span>))</span></code><code><span>save(cellchat, object.<span>list</span>, file = "cellchat.merge.rda")</span></code></pre></section><p><br></p><p><span>‍</span><strong>细胞互作数量与强度对比</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span># 互作数量与强度总体差异</span></span></code><code><span><span>p1</span> &lt;- compareInteractions(cellchat, show.legend = F, group = c(<span>1</span>,<span>2</span>), measure = <span>"count"</span>)</span></code><code><span>p2 &lt;- compareInteractions(cellchat, show.legend = F, group = c(<span>1</span>,<span>2</span>), measure = <span>"weight"</span>)</span></code><code><span>p &lt;- p1|p2</span></code><code><span>ggsave(<span>"fig1a_cci_comparision_barplot.pdf"</span>, p, width = <span>8</span>, height = <span>6</span>)</span></code><code><span><span># 热图展示</span></span></code><code><span>pdf(<span>"fig1a_cci_comparision_heatmap.pdf"</span>, width = <span>18</span>, height = <span>8</span>)</span></code><code><span>p1 &lt;- netVisual_heatmap(cellchat, measure = <span>"count"</span>)</span></code><code><span>p2 &lt;- netVisual_heatmap(cellchat, measure = <span>"weight"</span>)</span></code><code><span>p1 + p2</span></code><code><span>dev.<span>off</span>()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002754" data-ratio="0.43796296296296294" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNPm615kvkrAFxHPRP8iavZ4P9yRiaiahEx0nkuLufVZTrmIWKjic5O6Uf4w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNPm615kvkrAFxHPRP8iavZ4P9yRiaiahEx0nkuLufVZTrmIWKjic5O6Uf4w/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong>信号通路层面对比</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="objectivec"><code><span><span>## 信号通路对比总览</span></span></code><code><span>p1 &lt;- rankNet(cellchat, mode = <span>"comparison"</span>, stacked = T, <span>do</span>.stat = <span>TRUE</span>)</span></code><code><span>p2 &lt;- rankNet(cellchat, mode = <span>"comparison"</span>, stacked = F, <span>do</span>.stat = <span>TRUE</span>)</span></code><code><span>p &lt;- p1 + p2</span></code><code><span>ggsave(<span>"fig2a_pathwaySignal_overview.pdf"</span>, p, width = <span>10</span>, height = <span>12</span>)</span></code><code><span><br></span></code><code><span><span>## 信号通路按细胞类型对比</span></span></code><code><span>pathway.union &lt;- <span>union</span>(object.list[[<span>1</span>]]@netP$pathways, object.list[[<span>2</span>]]@netP$pathways)</span></code><code><span>ht1 = netAnalysis_signalingRole_heatmap(object.list[[<span>1</span>]], pattern = <span>"all"</span>, signaling = pathway.union, </span></code><code><span>                                        title = names(object.list)[<span>1</span>], width = <span>18</span>, height = <span>24</span>, color.heatmap = <span>"OrRd"</span>)</span></code><code><span>ht2 = netAnalysis_signalingRole_heatmap(object.list[[<span>2</span>]], pattern = <span>"all"</span>, signaling = pathway.union, </span></code><code><span>                                        title = names(object.list)[<span>2</span>], width = <span>18</span>, height = <span>24</span>, color.heatmap = <span>"OrRd"</span>)</span></code><code><span>pdf(<span>"fig2b_pathwaySignal_byCellType.pdf"</span>, width = <span>18</span>, height = <span>12</span>)</span></code><code><span>ComplexHeatmap::draw(ht1 + ht2, ht_gap = unit(<span>0.5</span>, <span>"cm"</span>))</span></code><code><span>dev.off()</span></code><code><span><br></span></code><code><span><span>## 输出信号通路按细胞类型对比</span></span></code><code><span>ht1 = netAnalysis_signalingRole_heatmap(object.list[[<span>1</span>]], pattern = <span>"outgoing"</span>, signaling = pathway.union, </span></code><code><span>                                        title = names(object.list)[<span>1</span>], width = <span>18</span>, height = <span>24</span>)</span></code><code><span>ht2 = netAnalysis_signalingRole_heatmap(object.list[[<span>2</span>]], pattern = <span>"outgoing"</span>, signaling = pathway.union, </span></code><code><span>                                        title = names(object.list)[<span>2</span>], width = <span>18</span>, height = <span>24</span>)</span></code><code><span>pdf(<span>"fig2c_outgoing_pathwaySignal_byCellType.pdf"</span>, width = <span>18</span>, height = <span>12</span>)</span></code><code><span>ComplexHeatmap::draw(ht1 + ht2, ht_gap = unit(<span>0.5</span>, <span>"cm"</span>))</span></code><code><span>dev.off()</span></code><code><span><br></span></code><code><span>ht1 = netAnalysis_signalingRole_heatmap(object.list[[<span>1</span>]], pattern = <span>"incoming"</span>, signaling = pathway.union, </span></code><code><span>                                        title = names(object.list)[<span>1</span>], width = <span>18</span>, height = <span>24</span>, color.heatmap = <span>"GnBu"</span>)</span></code><code><span>ht2 = netAnalysis_signalingRole_heatmap(object.list[[<span>2</span>]], pattern = <span>"incoming"</span>, signaling = pathway.union, </span></code><code><span>                                        title = names(object.list)[<span>2</span>], width = <span>18</span>, height = <span>24</span>, color.heatmap = <span>"GnBu"</span>)</span></code><code><span>pdf(<span>"fig2d_incoming_pathwaySignal_byCellType.pdf"</span>, width = <span>18</span>, height = <span>12</span>)</span></code><code><span>ComplexHeatmap::draw(ht1 + ht2, ht_gap = unit(<span>0.5</span>, <span>"cm"</span>))</span></code><code><span>dev.off()</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002755" data-ratio="0.6574074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwN8lIBQtXViasX9ibPNKuick7EoOibFN1PaMZ48D7THC3ibKttKtGhnsib7icyA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwN8lIBQtXViasX9ibPNKuick7EoOibFN1PaMZ48D7THC3ibKttKtGhnsib7icyA/640?wx_fmt=png&amp;from=appmsg"></p><p><span>fig2b_pathwaySignal_byCellType</span></p><p><span><br></span></p><p><strong>配体受体层面对比</strong></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span>nCT &lt;- length(levels(cellchat@idents$joint))</span></code><code><span><span>## 显示所有细胞间配体-受体对比</span></span></code><code><span>p &lt;- netVisual_bubble(cellchat, comparison = c(<span>1</span>, <span>2</span>), sources.<span>use</span> = c(<span>1</span>:nCT),</span></code><code><span>                      targets.<span>use</span> = c(<span>1</span>:nCT), remove.isolate = <span>FALSE</span>)</span></code><code><span>ggsave(<span>"fig3a_dotplot_all2all.pdf"</span>, p, width = <span>50</span>, height = <span>30</span>, limitsize = F)</span></code><code><span>data &lt;- cellchat.dotplotTable(p, id = <span>"fig3a_dotplot_all2all"</span>)</span></code><code><span><br></span></code><code><span><span>## 显示指定细胞间配体-受体对比</span></span></code><code><span>levels(cellchat@idents$joint)</span></code><code><span>p &lt;- netVisual_bubble(cellchat, comparison = c(<span>1</span>, <span>2</span>), sources.<span>use</span> = c(<span>2</span>,<span>4</span>,<span>5</span>,<span>6</span>,<span>7</span>,<span>8</span>,<span>10</span>),</span></code><code><span>                      targets.<span>use</span> = c(<span>2</span>,<span>4</span>,<span>5</span>,<span>6</span>,<span>7</span>,<span>8</span>,<span>10</span>), remove.isolate = <span>FALSE</span>)</span></code><code><span>ggsave(<span>"fig3b_dotplot_immun.pdf"</span>, p, width = <span>18</span>, height = <span>10</span>, limitsize = F)</span></code><code><span>data &lt;- cellchat.dotplotTable(p, id = <span>"fig3b_dotplot_immun"</span>)</span></code><code><span><br></span></code><code><span><span>## 指定细胞亚型和配受体画气泡图</span></span></code><code><span>lr.df &lt;- read.csv(<span>"fig3b_dotplot_immun_pval.csv"</span>, row.names = <span>1</span>)</span></code><code><span>p &lt;- netVisual_bubble(cellchat, comparison = c(<span>1</span>, <span>2</span>), sources.<span>use</span> = c(<span>2</span>,<span>4</span>,<span>5</span>,<span>6</span>,<span>7</span>,<span>8</span>,<span>10</span>), </span></code><code><span>                      targets.<span>use</span> = c(<span>2</span>,<span>4</span>,<span>5</span>,<span>6</span>,<span>7</span>,<span>8</span>,<span>10</span>), pairLR.<span>use</span> = lr.df[<span>1</span>:<span>20</span>,], </span></code><code><span>                      remove.isolate = <span>FALSE</span>)</span></code><code><span>ggsave(<span>"fig3c_dotplot_immun_sub.pdf"</span>, p, width = <span>18</span>, height = <span>6</span>, limitsize = F)</span></code><code><span>data &lt;- cellchat.dotplotTable(p, id = <span>"fig3c_dotplot_immun_sub"</span>)</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100002756" data-ratio="0.33055555555555555" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNIHqicAXvknmKM5TJawh8kqNgejXkAG1ic59IrHe0L4aOpdE5SXiawmYzw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/VTXDic6Eia0AFsXr2NeKHo7C3FB62B3cwNIHqicAXvknmKM5TJawh8kqNgejXkAG1ic59IrHe0L4aOpdE5SXiawmYzw/640?wx_fmt=png&amp;from=appmsg"></p><p><span>fig3c_dotplot_immun_sub</span></p><p><br></p><p><br></p><section><strong><span>数据与资源</span></strong></section><section>本节分析数据与结果百度云下载链接<span>https://pan.baidu.com/s/14E8kVZabmwcrYNykPutRUg?pwd=ls8q </span></section><p>提取码：ls8q </p><p><br></p><p><span>kinesin/rstudio:2.0.0</span><span>镜像</span><span>和scPRIT包的开发、测试非常耗费时间和精力，后续我希望可以持续提供维护和更新服务，因此计划采用收费授权的模式，具体标准如下：</span></p><ul><li><p>200元，授权使用90天</p></li><li><p>600元，授权使用一年</p></li></ul><p>授权期内如有更新免费升级，有意者添加Kinesin微信购买。</p><p><br></p><p><span><strong><span>超越代码实战训练班</span></strong></span></p><p>很多第一次分析单细胞数据的朋友，会把70%的时间耗费在代码和生信基础问题上，真正用来思考生物学问题的时间非常有限，因此产出高水平的文章相对比较困难。<span>近几年，我深度参与了几十个单细胞、空转项目的分析，目前已有十几篇合作的署名/致谢文章发表。<span>如果有我这么一个过来人提供分析环境和实战流程，并参与您的项目讨论，或许可以起到事半功倍的效果。如果您对此有兴趣，请阅读《<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyMzMwNDQ2MA==&amp;mid=2247486184&amp;idx=1&amp;sn=413328830d29341abafdb7906524f4f7&amp;chksm=e821048bdf568d9d356c855b38f7cb65d0e3fdb88293c0f5a6bcf320385a57a31f457e8cf932&amp;scene=21#wechat_redirect" textvalue="超越代码" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">超越代码</a>》和《<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzIyMzMwNDQ2MA==&amp;mid=2247486190&amp;idx=1&amp;sn=c5af0dd634837e61d5dea4744b8765cb&amp;chksm=e821048ddf568d9b3a734f53471d03d2b7009aeaa3c982fa3addb6c07aa0ef1a48e2e4325cac&amp;scene=21#wechat_redirect" textvalue="单细胞分析实战训练班的课程规划" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">单细胞分析实战训练班的课程规划</a>》了解详情！</span></span></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/eQrpep2OxV1hccihqYbZgA",target="_blank" rel="noopener noreferrer">原文链接</a>
