---
title: "单细胞测序不同亚群的特异性基因的计算新选择 starTracer"
date: 2024-10-28T23:24:53Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
单细胞测序不同亚群的特异性基因的计算新选择 starTracer by 生信技能树
------
<div><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">众所周知，单细胞转录组有两种差异分析，首先是不同单细胞亚群之间的，比如t细胞和b细胞，其次是同一个单细胞亚群在不同生物学条件下面的差异比如癌症和癌旁组织的t细胞的差异，<strong>这两个差异分析有的方法学区别很大！</strong></p></section></blockquote><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><ol data-tool="mdnice编辑器"><li><section><p><strong>不同单细胞亚群之间的差异分析</strong>：</p></section></li></ol><ul><li><section><strong>目的</strong>：比较不同细胞类型（如T细胞和B细胞）的基因表达模式，以揭示它们独特的生物学特性和功能。</section></li><li><section><strong>数据特点</strong>：通常涉及多个细胞亚群的比较，每个亚群可能包含数百到数千个单细胞。</section></li></ul><li><section><p><strong>同一单细胞亚群在不同生物学条件下的差异分析</strong>：</p></section></li><ul><li><section><strong>目的</strong>：探究同一细胞亚群（如T细胞）在不同生物学条件（如癌症和癌旁组织）下的基因表达变化，以理解环境或疾病状态对细胞功能的影响。</section></li><li><section><strong>数据特点</strong>：通常涉及同一细胞类型的内部比较，比较的是同一细胞亚群在不同条件下的表达差异。</section></li></ul><p data-tool="mdnice编辑器"><strong>区别</strong>：</p><ul data-tool="mdnice编辑器"><li><section><strong>生物学背景</strong>：第一种分析更关注细胞类型的固有特性，而第二种分析更关注环境或疾病状态对细胞功能的影响。</section></li><li><section><strong>统计模型</strong>：虽然两种分析都使用统计测试，但第二种分析可能需要更复杂的模型来控制混杂因素，如疾病进展、治疗历史等。</section></li><li><section><strong>生物学解释</strong>：第一种分析的生物学解释侧重于细胞类型的分类和特征，第二种分析则侧重于特定条件下的生物学变化和潜在的分子机制。</section></li><li><section><strong>应用</strong>：第一种分析有助于理解细胞异质性和发育轨迹，第二种分析有助于揭示疾病过程中的分子变化和治疗靶点。</section></li></ul><p data-tool="mdnice编辑器">在实际操作中，两种分析方法可以根据研究目的和数据特点进行选择和调整，以获得最有意义的生物学信息。</p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">通常情况下，<strong>不同单细胞亚群之间的差异（如T细胞和B细胞）往往比同一单细胞亚群在不同生物学条件下的差异（如癌症和癌旁组织的T细胞）更容易区分。</strong></p><p data-tool="mdnice编辑器">因为不同单细胞亚群，比如T细胞和B细胞是两种功能和发育路径截然不同的免疫细胞，<span><strong>它们具有不同的基因表达谱和生物学功能，因此它们之间的差异通常非常明显。</strong></span></p><p data-tool="mdnice编辑器">但是如果生物学重复的数量不足，<strong>那么随机变异可能会掩盖同一个细胞亚群在不同生物学条件下面的真实的生物学差异</strong>。同一细胞亚群在不同条件下的差异可能需要更精细的分析方法，包括复杂的统计模型和数据预处理步骤，以区分真实的生物学信号和噪声。同一细胞类型在不同条件下可能涉及复杂的生物学过程和调控机制，这些过程可能在基因表达水平上不易被察觉。</p></section><p data-tool="mdnice编辑器">关于前者，我们推荐过：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247521011&amp;idx=5&amp;sn=10dd5866e4e6dd5ab9602907077142fd&amp;chksm=9b4bd248ac3c5b5e6fc2d80f1de4352b15ffff83ff59114028ca782af00fcabdc35dc2365e2e&amp;scene=21#wechat_redirect" textvalue="神兵利器——单细胞细胞类群基因marker鉴定新方法：COSG" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">神兵利器——单细胞细胞类群基因marker鉴定新方法：COSG</a>，因为<span>Seurat 官方的 FindMarkers与FindAllMarkers函数，非常的耗时如果细胞数量比较多，除非搞多个线程去并行运算，但是如果并行就会超级耗费内存！所以我很早就放弃了它，现在给大家的代码里面都是COSG包啦。但是最近武汉大学的小伙伴们“毛遂自荐”了她的工作：</span></p></section><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">接下来我们介绍一下：starTracer：一个高效、准确的单细胞测序标志基因检索软件/R包</p><hr data-tool="mdnice编辑器"></section><p data-tool="mdnice编辑器">key words: starTracer, single-cell RNA-seq; marker gene; R package.</p><p data-tool="mdnice编辑器">关键词: starTracer；单细胞测序；标志基因；R包.</p><p data-tool="mdnice编辑器"><span>原文链接：starTracer is an accelerated approach for precise marker gene identification in single-cell RNA-Seq analysis</span><span>[1]</span></p><h1 data-tool="mdnice编辑器"><span>1 背景介绍</span></h1><p data-tool="mdnice编辑器"><span>有幸拜托Jimmy老师和生信技能树团队，借此平台，为我们的工作做一个介绍，让更多科研工作者的单细胞分析变得灵活而高效，也希望能够为我们的工作指出bug，精益求精。</span></p><p data-tool="mdnice编辑器"><span>这是关于R包starTracer的设计过程的思路、部分结果的呈现，文末附有使用方法的中文指导。具体的方法部分和完成的结果，还请大家移步原文。我将会主要在这里分享在论文中没有被记录的部分。<strong>如果在使用过程中有发现任何问题，请到我们的github page进行反馈，我希望帮助每一个愿意使用我们软件的科研工作者，在你们的数据上得到满意的结果。十分感谢！</strong></span></p><h1 data-tool="mdnice编辑器"><span>2 问题引入</span></h1><p data-tool="mdnice编辑器">不知道大家在进行单细胞测序的标志基因的计算的时候，是否面临了以下几个问题：</p><p data-tool="mdnice编辑器">a. 计算时间耗时长，有时候10万个细胞的样本需要花费40分钟来计算得到结果。（<span>用40分钟来摸鱼休息其实也是不错的</span>） b. 计算得到的标志基因的效果不佳。尤其是当我们对一个Major clust进行进一步亚群的划分时出现。这个时候Marker基因常常会呈现出一个“糊了满屏”的感觉：即特异性程度很低。这里给大家展示一下当时我在处理自己的数据的时候遇到的问题：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050621" data-ratio="0.6418816388467374" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2Y5mEewIr6MJ1UkybWRmto6cmQc5gBAfWEwS6J501n9Yicicib6ZyARdTg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="659" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2Y5mEewIr6MJ1UkybWRmto6cmQc5gBAfWEwS6J501n9Yicicib6ZyARdTg/640?wx_fmt=png&amp;from=appmsg"><figcaption>图，来自兴奋性神经元的sub-cluster的标志基因的小提琴图。使用Seurat包的FindAllMarkers函数获取，按照p-value进行筛选后，使用logFC进行排序。由于涉及未发表数据，仅选取部分作为展示使用。</figcaption></figure><h1 data-tool="mdnice编辑器"><span>3 解决方案：补丁</span></h1><p data-tool="mdnice编辑器">计算时间过长速度过慢，我想这是R的硬伤。所以，基于C++的<span>Presto</span><span>[2]</span> 便是一个不错的解决方案，这是一个用于加速Marker基因寻找的不错的工具，但是Seurat V4并没有纳入它，不过目前在网络上可以下载的Presto已经支持直接读取Seurta对象，对V4用户友好。而V5版本则是直接纳入了Presto。我们需要注意的是，Presto仅仅是对wilcox等统计学分析过程进行加速，其本身并不会改变FindAllMarkers的计算结果。</p><p data-tool="mdnice编辑器">而计算的效果不佳，我想这是很多研究人员在针对细分亚群的标志基因的时候面临的问题。常见的解答方案有以下几种（为了方便，我直接插入图片，大家感兴趣的可以去查阅原文）：补丁1，计算一个指标，用于衡量其特异性（来自Allen Brain Institute）</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050619" data-ratio="0.3181818181818182" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2icaRVqPPr4r5M2m7ia2iabluSmYJhZbRD7lO7l1fL6gdrxS68bu5B4odw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="220" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2icaRVqPPr4r5M2m7ia2iabluSmYJhZbRD7lO7l1fL6gdrxS68bu5B4odw/640?wx_fmt=png&amp;from=appmsg"><figcaption>Hodge et. al., 2019, p. 16. For gene i, the overall specificity level is measured by:sum(distance^2)/ sum(distance)0 ~ 1. low specificity; high specificity</figcaption></figure><p data-tool="mdnice编辑器">补丁2，计算一个指标，同样用于衡量特异性（实际上这个算法是在Stimulated Single Cell Data里面去生成Ground Truth Marker）</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050617" data-ratio="0.29955947136563876" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2mrZHTsujIrauBtcx0gKic4q0MiaEiaZiaia3uCvrsNUNl6omh6X1zqLkaGA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="227" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2mrZHTsujIrauBtcx0gKic4q0MiaEiaZiaia3uCvrsNUNl6omh6X1zqLkaGA/640?wx_fmt=png&amp;from=appmsg"><figcaption>Pullin ,McCarthy, 2024, p. 28. For gene g, the specificity level in cluster k’ is measured by:sum of the log-fold changes of gene g in cluster k’ comparing to all the rest of the clusters divided by total number of clusters (K) .</figcaption></figure><p data-tool="mdnice编辑器">补丁3，我的方法：（其实灵感来源于Seurat FindAllMarkers 函数的pct1和pct2）</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050618" data-ratio="0.4411764705882353" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2d31Uxqhzr3ZTsQWJCYdOl6w3bvDjD4tgE61Dgmztos9ia3n9ACE6VfQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="170" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2d31Uxqhzr3ZTsQWJCYdOl6w3bvDjD4tgE61Dgmztos9ia3n9ACE6VfQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>Feiyang et. al., 2024. For gene i, the overall specificity level in cluster k is measured by:For gene i, the intersected number of clusters that with gene i as marker and that expressed gene i, divided by the number of clusters that expressed i gene.</figcaption></figure><p data-tool="mdnice编辑器">当然，Seurat本身自己也提供了<code>pct.1</code>、<code>pct.2</code>以及<code>logFC</code>，Jimmy的生信技能树团队的推文对此有详细的介绍。限制pct以及限制FoldChange，本身都是一个不错的办法，但是Seurat的FindAllMarkers函数的过长的计算时间（10w个细胞，在我们很不错的芯片上，仍然需要计算40分钟；60w个细胞则需要花费6个小时）让这几个参数陷入一个使用上的困境：研究人员在得到结果之前，是不知道什么样的<code>logFC</code>和<code>pct.1</code>、<code>pct.2</code>是最好的，而只能够选择一个相对宽松的限制——使用过高的log2FC限制了特异性后，可能会导致自己忽略掉一些可能表达水平更高的基因（可以参考原文里关于基因表达水平和特异性的论述）。所以往往大家还是采用宽松的限制，花更多的时间来得到一个巨大的表格，再进行自己的手动筛选——例如上述的各种补丁。</p><p data-tool="mdnice编辑器">而我在“发明”了补丁3后，标志基因的效果得到了大幅度的提升，当然，总体表达水平出现了降低（图中没有体现）：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050620" data-ratio="0.651270207852194" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2aiauiccz6d8YSic8iba84OicuKPM3WZJBzDQgmTgV2wP8OOjs2afEzzP1Hg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="433" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2aiauiccz6d8YSic8iba84OicuKPM3WZJBzDQgmTgV2wP8OOjs2afEzzP1Hg/640?wx_fmt=png&amp;from=appmsg"><figcaption>图，过滤后的标志基因，我们发现基因的总体表达水平得到了降低，但是实际上相对的表达量获得了提高。同样的，为了数据隐私性，我把行和列名字给隐去了。</figcaption></figure><p data-tool="mdnice编辑器">“基因的总体表达水平得到了降低，但是实际上相对的表达量获得了提高”这个理念，我认为是来自于生物学本身的固有本质——这让研究人员想要找到更有特异性的表达结果时来筛选精细的细胞亚群的时候，则必然从更低表达量的基因的入手，而这进一步要求更高的实验技术水平的支持。这一逻辑本身也是合理的。</p><h1 data-tool="mdnice编辑器"><span>4 更加“优雅”的解决方案</span></h1><p data-tool="mdnice编辑器">虽然计算速度、特异性的问题仿佛得到了解决，但是总是通过打补丁的方式：例如用Presto使用C++来对计算进行加速，这本身并不优雅，而是依赖于计算机的暴力、利用三个补充方程，不仅没有简化流程，反而让计算过程变得更加复杂。其实曾经在初学单细胞测序的时候，Jimmy老师的博客里面有一篇文章对于FindAllMarkers函数的log2FC的解释让我记忆犹新。于是我去翻阅了FindAllMarkers的源码 （当时是我第一次尝试去解读R包的源代码，感谢知乎大佬们的铺垫），对此进行了佐证。我发现其实不论是Seurat，还是Scanpy、Monocle 3，大家都在使用的一个思想是：</p><p data-tool="mdnice编辑器"><strong>对任意的基因，在计算的过程中，软件将会将其放进某一个细胞类型，再与其他的所有的细胞类型的总和的进行差异比较。</strong></p><p data-tool="mdnice编辑器">而我不赞同使用这个思想来寻找标志基因，因为使用这个方法得到的结果，在条件比较“艰难”的时候，效果很差。具体的弊端体现在如下几个方面：</p><h2 data-tool="mdnice编辑器"><span>4.1 现有方案的弊端1: Dilution Issue</span></h2><p data-tool="mdnice编辑器">FindAllMarkers的计算逻辑是循环调用FindMarkers，在找marker的时候，我们用了FindAllMarkers；在后续找差异基因，我们用的是FindMarkers。在这里，大家不知是否已经产生了疑问：这里我们是否搞混淆了一个概念/或者是遗漏去辨析了两个概念：marker基因和DEG是不一样的：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050625" data-ratio="0.3138888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2iam7Qiav3ibhsFt9a1Wic53UJpl6E0qfasoRNJXoQicMQ3CVCJPpWACF0AA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="720" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2iam7Qiav3ibhsFt9a1Wic53UJpl6E0qfasoRNJXoQicMQ3CVCJPpWACF0AA/640?wx_fmt=png&amp;from=appmsg"><figcaption>图，左：理想的marker基因的寻找鉴定逻辑：一个细胞亚群的标志基因，应该由其与剩余的细胞亚群逐个对比获得参数，并综合考虑参数而确定。右：DEG，由相同的细胞亚群跨越condition互相比较而确定。</figcaption></figure><p data-tool="mdnice编辑器">在理清了这个观点后，我们不难发现，上述的三个“补丁”方程，其实都是把某一个亚群逐个地与剩余所有亚群比较，并考虑总体结果来进一步地衡量基因在一个亚群的特异性程度。有意思的是，如果我们去查看上述的“补丁”1、2的原文，我们会发现，作者们的字里行间都透露了一个信息：Binary Expression. （不清楚翻译是否正确，含义大概是：二分类似的表达——即，在一个亚群高表达，而在别的亚群都是低表达）。这不是一个废话，因为FindAllMarkers的计算逻辑里面，其他的所有的亚群都被平均了，这将会导致一个很严重的“稀释”问题——即原文里所描述的dilution issue（感谢QBI赵老师帮助总结了这个清晰易懂的概念）。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050624" data-ratio="0.36944444444444446" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz28F3P80UG6QHRzF2EVAcBib9smmsGFF29do41prnibKQqQ6KWRKsgXwPw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="720" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz28F3P80UG6QHRzF2EVAcBib9smmsGFF29do41prnibKQqQ6KWRKsgXwPw/640?wx_fmt=png&amp;from=appmsg"><figcaption>图：Dilution Issue图解，即一个细胞亚群（clusterF）在平均化过程中，表达水平被其他表达更低的亚群拉低了。导致log2FC呈现出很大的值，而实际上该基因由于其在F当中存在中等程度的表达，并不能够作为ClusterA的标志基因/或者是在排序上需要往后稍稍，把top的位置留给更好、特异性更高的基因。</figcaption></figure><h2 data-tool="mdnice编辑器"><span>4.2 现有方案的弊端2: 冗余计算</span></h2><p data-tool="mdnice编辑器">不知道大家是否在FindAllMarkers的时候遇到过一个问题：假设20个细胞亚群，在按照pvalue过滤和log2FC排序后，如果直接按照cluster分组，再分别选取前20个基因的方案(<code>df %&gt;% group_by(cluster) %&gt;% slice_head(n = 20)</code>)来找每个亚群的top10 marker，为什么得到的dataframe的数量有时候却少于20 * 10 = 200 个？</p><p data-tool="mdnice编辑器">这是因为FindAllMarkers有时候将一个基因鉴定成为了多个cluster的marker基因（并且他们还都是显著的、log2FC很高的）——为了解决这个问题，我们需要首先去选择log2FC最高的那一个，把其作为这个marker的真实的cluster。</p><p data-tool="mdnice编辑器">这种“打补丁”一样的去除多余信息的操作，暗示这实际上是源自于FindAllMarkers产生了大量冗余的计算：对于一个基因A，FindAllMarkers将会分别把它放到1～N每一个cluster里面，再和其他的细胞亚群的平均进行计算。虽然实际的运算流程并非一个个的基因去计算，但是针对每一个基因，仍然产生了多余的<code>N-1</code>次运算——因为任何一个基因A（在我们不考虑其客观事实上是否是标志基因的情况下）它只有可能在其表达水平最高的那个细胞类型中成为标志基因（这个想法和上面的“选择log2FC最高的那一个”其实是一致的）。既然如此，那我们为什么不在进行复杂的参数运算之前，就告诉软件：“这个你不用算了，基因A不可能是细胞B的marker基因，因为基因A的最高表达在细胞C当中，除此之外的其他细胞亚群，你都不需要计算。”</p><h2 data-tool="mdnice编辑器"><span>4.3 对于补丁3的完善：限制表达水平</span></h2><p data-tool="mdnice编辑器">补丁3的结果大家可以看到，marker基因的表达水平实在是有点低。为什么太低的表达量不好？这有诸多方面的原因：</p><ol data-tool="mdnice编辑器"><li><section>由于10x genomics的测序方案限制（每个beads里面捕获到的RNA fragment的数量远小于bulk RNA-seq），在细胞数量太少的时候，基因的表达水平会出现偏差。为了解决特异性程度太高导致的表达水平降低的问题，我们需要在寻找标志基因的时候提供一个参数，来限制表达水平，以便于有时候让我们能够牺牲特意度来获取更高的表达量。当然如果你是使用的smart-seq这种测序，我认为受到的影响可能会相比10x genomics的影响更小。</section></li><li><section>10x genomics的测序，不论是单细胞核测序还是单细胞质测序，低表达量的基因，有可能是系统误差产生的（个人猜想，未经验证）。</section></li></ol><h2 data-tool="mdnice编辑器"><span>4.4 思路小结</span></h2><p data-tool="mdnice编辑器">综上所述：我们的<span><strong>设计思路便是</strong></span></p><ol data-tool="mdnice编辑器"><li><section><span><strong>对基因表达进行二分类定义</strong></span></section></li><li><section><span><strong>提前将基因分配到其唯一“有可能”成为marker基因的cluster当中</strong></span></section></li><li><section><span><strong>在计算时，允许研究人员以牺牲特异度的方式来获取表达量</strong></span></section></li></ol><p data-tool="mdnice编辑器">对于设计的总体逻辑，我们在<em>Supplementary Figure 1</em> 中作出了详细的图解，整个计算逻辑的核心都是基于初等代数。对于设计的细节部分，大家可以参考<em>Methods</em>部分，在此我们不再展开。</p><h1 data-tool="mdnice编辑器"><span>5 结果呈现</span></h1><p data-tool="mdnice编辑器">详细的结果，仍然请大家移步原文。在这里我们仅对结果作部分的解释：这里我们将一个具有60万细胞的数据进行了拆分，按照10%～100%的数据量，分别计算了默认参数下的Seurat的FindAllMarkers的计算时间和starTracer的searchMarker（searchMarker将会是你在使用starTracer这个包的时候，具体使用的函数，具体信息请看文末）的计算时间。我们可以看到starTracer的计算时间随样本量的扩大而增加的斜率是明显小于Seurat的。在60万个细胞的时候，在我们的服务器上，Seurat甚至需要花费6小时来得到结果，而starTracer只需要30余秒。我们将整个计算速度提高了数百倍。</p><p data-tool="mdnice编辑器"><img data-imgfileid="100050622" data-ratio="1.0680529300567108" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2DTvKKOmFL4ULeljT4AmbDmlU66xG5MKc8aYpYcxaZTTWAI0gMtaScQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="529" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2DTvKKOmFL4ULeljT4AmbDmlU66xG5MKc8aYpYcxaZTTWAI0gMtaScQ/640?wx_fmt=png&amp;from=appmsg">我们也与C++选手Presto进行了比赛，在使用Seurta原装Average Expression函数的时候，我们的计算速度实际上没有超越Presto。<strong>后来，参考了Zachary DeBruine教授在社区慷慨贡献自己的Average Expression函数 ，让我们的计算速度超越了Presto。对此深表感谢。如果还有高手可以将starTracer装上C++发动机，我想我们会跑的更快。</strong></p><p data-tool="mdnice编辑器">当然，starTracer的计算的结果也是相当的不错：</p><p data-tool="mdnice编辑器"><img data-imgfileid="100050623" data-ratio="1.6885714285714286" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2p5LAMPLAujv1TQ61CqiaJy90usV0eHicOfRDx6rF2qwMsh4bT3ATcQjA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="350" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2p5LAMPLAujv1TQ61CqiaJy90usV0eHicOfRDx6rF2qwMsh4bT3ATcQjA/640?wx_fmt=png&amp;from=appmsg">从计算结果上来看，提升最明显的是针对神经元当中的抑制性神经元的标志基因。我们纳入了所有的基因进行标志基因的寻找，<strong>发现starTracer在抑制性中间神经元的提升相当明确（当然，我们已经知道这些神经元的标志基因了），例如SST作为SST中间神经元的标志基因，PVALB作为PVALB中间神经元的标志基因，VIP作为VIP中间神经元的标志基因，NDNF作为NDNF中间神经元的标志基因。</strong></p><p data-tool="mdnice编辑器"><img data-imgfileid="100050626" data-ratio="0.6027777777777777" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2FaKpRZTDnxYicqYOmX6tCbLJzicyQBiakLKzHfCesLM8omSUYbibxXAXWQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="720" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwCEk96K14lQfnz9TCoRhz2FaKpRZTDnxYicqYOmX6tCbLJzicyQBiakLKzHfCesLM8omSUYbibxXAXWQ/640?wx_fmt=png&amp;from=appmsg">当然，<span><strong>我们随后也是用Simulated Data来对FPR进行了系统性的评估。评估了starTracer在低数量细胞上的稳定性以及复杂注释下的表现能力。</strong></span>其他的内容，请大家移步原文。</p><h1 data-tool="mdnice编辑器"><span>6 使用方法</span></h1><p data-tool="mdnice编辑器">具体的使用方案请参考github主页：<span>starTracer</span><span>[3]</span> 下载：</p><pre data-tool="mdnice编辑器"><code><span>if</span> (!requireNamespace(<span>"devtools"</span>, quietly = TRUE)){<br>install.packages(<span>"devtools"</span>)}<br><br>devtools::install_github(<span>"JerryZhang-1222/starTracer"</span>)<br></code></pre><p data-tool="mdnice编辑器">在这里也作一个简单的介绍：你可以输入一个Seurat对象、一个dgCMatrix或者是一个Average Expression Matrix。返回的结果是一个list（目前没有使用<code>S4</code>类，只是简单地用了一个list）。</p><p data-tool="mdnice编辑器">list里面包含：</p><p data-tool="mdnice编辑器"><code>para_frame</code>：包含所有中间参数的data frame，其中<code>max.X</code>列说明了该marker在何种细胞中被认为是marker基因。<code>n</code>是衡量程度的一个指标，为1的是最佳。在相同的<code>n</code>中，<code>MI</code>大，其作为marker基因的能力越好。<code>rest_clust</code>说明了当n不等于1时，其他有可能对marker的特异性构成影响的其他细胞类型。</p><p data-tool="mdnice编辑器"><code>genes.markers</code>：marker基因</p><p data-tool="mdnice编辑器"><code>expr</code>：Average Expression Matrix</p><pre data-tool="mdnice编辑器"><code>res &lt;- searchMarker(<br>  x = x, <span># 输入一个Seurat对象、一个dgCMatrix或者是一个Average Expression Matrix</span><br>  thresh.1 = 0.5, <span># 建议使用默认值</span><br>  thresh.2 = 0.3, <span># thresh2越高，表达水平越高，特异性越低。请设置在0-1范围内</span><br>  method = <span>"pos"</span>, <span># 我们提供了寻找negative的方案，当然这目前只是一个alpha版本，如果需要，请设置为"all"</span><br>  num = 2, <span># 输出的top N marker基因数量</span><br>  gene.use = NULL, <span>#留空使用所有基因，设置为“HVG”则使用HVG</span><br>  meta.data = NULL,<br>  ident.use = NULL<br>)<br><br><span>#您可以使用以下代码来获取marker基因的pseudo-bulk表达矩阵</span><br>res<span>$expr</span>[res<span>$genes</span>.markers,]<br><br><span>#您可以使用以下代码来获取marker基因记忆其对应的cluster</span><br>res<span>$para_frame</span>[res<span>$genes</span>.markers,c(<span>"max.X"</span>,<span>"gene"</span>)]<br></code></pre><h1 data-tool="mdnice编辑器"><span>其他下一步可以改进的方向</span></h1><p data-tool="mdnice编辑器"><strong>输出部分比较简陋，代码没有封装非常完善</strong></p><p data-tool="mdnice编辑器"><strong>针对一个cluster内部的基因表达抑制性没有作过多的阐述</strong></p><p data-tool="mdnice编辑器"><strong>缺乏python等其他平台版本</strong></p><p data-tool="mdnice编辑器"><strong>可能会有不少bug</strong></p><h3 data-tool="mdnice编辑器"><span>一些想法</span></h3><p data-tool="mdnice编辑器">再次向生信技能树团队、Jimmy老师表达谢意。不论是这个idea的产生还是实现，你们的无私的奉献都给予了我很大的帮助。<strong>这个软件实际上所有的内容几乎都是初等代数的东西，也很有可能有更多的改进的空间。由于作者本身不是数学和计算机专业出身，所以在代码的规范性上或许还有很多值得改进的地方，希望大家能够给予意见。</strong></p><p data-tool="mdnice编辑器"><strong>另外如果有帮助到读者您，请考虑引用我们的工具。谢谢！</strong></p><p data-tool="mdnice编辑器">Zhang, F., Huang, K., Chen, R. et al. starTracer is an accelerated approach for precise marker gene identification in single-cell RNA-Seq analysis. Commun Biol 7, 1128 (2024). https://doi.org/10.1038/s42003-024-06790-6</p><section data-tool="mdnice编辑器"><span>参考资料</span></section><section data-tool="mdnice编辑器"><span><span>[1]</span><p>原文链接：starTracer is an accelerated approach for precise marker gene identification in single-cell RNA-Seq analysis: <em>https://www.nature.com/articles/s42003-024-06790-6</em></p><span>[2]</span><p>Presto: <em>https://doi.org/10.1101/653253</em></p><span>[3]</span><p>starTracer: <em>https://github.com/JerryZhang-1222/starTracer</em></p></span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/7GkGUIq5hB-fS27AyGjnrA",target="_blank" rel="noopener noreferrer">原文链接</a>
