---
title: "ggalign-瀑布图"
date: 2024-10-25T00:22:36Z
draft: ["false"]
tags: [
  "fetched",
  "生信协作组"
]
categories: ["Acdemic"]
---
ggalign-瀑布图 by 生信协作组
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span><span>安装</span></span></h1><p data-tool="mdnice编辑器">你可以使用以下命令从 <code>CRAN</code> 安装 <code>ggalign</code>：</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages("ggalign")<br></code></pre><p data-tool="mdnice编辑器">或者，从 <span>r-universe</span><sup>[1]</sup> 安装开发版本（目前开发版本添加了大量新功能，因为CRAN通常需要1-2个月的更新间隔，暂不能推送到CRAN）：</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages("ggalign",<br>    repos = c("https://yunuuuu.r-universe.dev", "https://cloud.r-project.org")<br>)<br></code></pre><p data-tool="mdnice编辑器">或者从<span>GitHub</span><sup>[2]</sup></p><pre data-tool="mdnice编辑器"><span></span><code># install.packages("remotes")<br>remotes::install_github("Yunuuuu/ggalign")<br></code></pre><p data-tool="mdnice编辑器">如果您在使用ggalign后觉得它对您的工作有所帮助，欢迎在 <code>https://github.com/Yunuuuu/ggalign</code>上为此项目添加星星。</p><h2 data-tool="mdnice编辑器"><span></span><span>输入数据</span><span></span></h2><p data-tool="mdnice编辑器"><code>ggoncoplot</code>接受一个字符矩阵，用于编码突变类型，您可以使用<code>;:,|</code> 来分隔多个突变，或者任何定义了<code>fortify_heatmap()</code>方法的对象。目前能直接接受<code>maftools</code>的对象。</p><pre data-tool="mdnice编辑器"><span></span><code>mat &lt;- read.table(textConnection(<br>    <span>"s1,s2,s3<br>g1,snv; indel,snv,indel<br>g2,,snv;indel,snv<br>g3,snv,,indel;snv"</span><br>), row.names = <span>1</span>, header = <span>TRUE</span>, sep = <span>","</span>, stringsAsFactors = <span>FALSE</span>)<br></code></pre><p data-tool="mdnice编辑器">所有操作跟<code>ggheatmap()</code>一摸一样，想要更多文档？请参考：<code>https://yunuuuu.github.io/ggalign/dev/</code></p><pre data-tool="mdnice编辑器"><span></span><code>ggoncoplot(mat, map_width = c(snv = <span>0.5</span>), map_height = c(indel = <span>0.9</span>)) +<br>    <span># Note that guide legends from `geom_tile` and `geom_bar` are different.</span><br>    <span># Although they appear similar, the internal mechanisms won't collapse</span><br>    <span># the guide legends. Therefore, we remove the guide legends from</span><br>    <span># `geom_tile`.</span><br>    guides(fill = <span>"none"</span>) +<br>    hmanno(<span>"t"</span>, size = <span>0.5</span>) +<br>    ggalign() +<br>    geom_bar(aes(fill = value), data = <span>function</span>(x) {<br>        subset(x, !is.na(value))<br>    }) +<br>    hmanno(<span>"r"</span>, size = <span>0.5</span>) +<br>    ggalign() +<br>    geom_bar(aes(fill = value), orientation = <span>"y"</span>, data = <span>function</span>(x) {<br>        subset(x, !is.na(value))<br>    }) &amp;<br>    scale_fill_brewer(palette = <span>"Dark2"</span>, na.translate = <span>FALSE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100011761" data-ratio="0.7203703703703703" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJw0qZHuW57sK0cOKTobju70HXILqM3oc0pHdWibe3NAZY9XWZJmXqkXCbD3bx4cg9updj3HyPuOxmQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJw0qZHuW57sK0cOKTobju70HXILqM3oc0pHdWibe3NAZY9XWZJmXqkXCbD3bx4cg9updj3HyPuOxmQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><code>maftools</code>对象可直接输入。</p><pre data-tool="mdnice编辑器"><span></span><code>laml.maf &lt;- system.file(<span>"extdata"</span>, <span>"tcga_laml.maf.gz"</span>, package = <span>"maftools"</span>)<br>laml.clin &lt;- system.file(<span>"extdata"</span>, <span>"tcga_laml_annot.tsv"</span>, package = <span>"maftools"</span>)<br>laml &lt;- maftools::read.maf(maf = laml.maf, clinicalData = laml.clin)<br>ggoncoplot(laml, n_top = <span>20L</span>, collapse_vars = <span>TRUE</span>) +<br>    <span># 去掉x轴 labels</span><br>    scale_x_discrete(breaks = <span>NULL</span>) +<br>    hmanno(<span>"r"</span>, size = unit(<span>1</span>, <span>"cm"</span>)) +<br>    ggalign(<br>        data = <span>function</span>(x) {<br>            <span># by default, `fortify_heatmap` will attach the gene summary</span><br>            <span># into the `gene_anno` attribute</span><br>            data &lt;- ggalign_attr(x, <span>"gene_anno"</span>)<br>            cols &lt;- setdiff(<br>                names(data),<br>                c(<br>                    <span>"Tumor_Sample_Barcode"</span>, <span>"Hugo_Symbol"</span>, <span>"total"</span>,<br>                    <span>"MutatedSamples"</span>, <span>"AlteredSamples"</span><br>                )<br>            )<br>            ans &lt;- as.matrix(data[, ..cols])<br>            rownames(ans) &lt;- data$Hugo_Symbol<br>            ans<br>        }<br>    ) +<br>    geom_bar(aes(x = value, .row_names, fill = .column_names),<br>        stat = <span>"identity"</span><br>    ) +<br>    guides(fill = <span>"none"</span>) +<br>    hmanno(<span>"t"</span>, size = unit(<span>1</span>, <span>"cm"</span>)) +<br>    ggalign(<br>        data = <span>function</span>(x) {<br>            <span># by default, `fortify_heatmap` will attach the sample summary</span><br>            <span># into the `sample_anno` attribute</span><br>            data &lt;- ggalign_attr(x, <span>"sample_anno"</span>)<br>            cols &lt;- setdiff(names(data), c(<span>"Tumor_Sample_Barcode"</span>, <span>"total"</span>))<br>            ans &lt;- as.matrix(data[, ..cols])<br>            rownames(ans) &lt;- data$Tumor_Sample_Barcode<br>            ans<br>        }<br>    ) +<br>    geom_bar(aes(y = value, fill = .column_names),<br>        stat = <span>"identity"</span><br>    ) +<br>    guides(fill = <span>"none"</span>) &amp;<br>    scale_fill_brewer(palette = <span>"Set3"</span>, na.translate = <span>FALSE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100011762" data-ratio="0.7268518518518519" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJw0qZHuW57sK0cOKTobju706DDo8CjoNrvIQcH4QCFON65FvMQQKIgkibPrsNaNziaNddtKN4NDsBicQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/mPqFmhtlSJw0qZHuW57sK0cOKTobju706DDo8CjoNrvIQcH4QCFON65FvMQQKIgkibPrsNaNziaNddtKN4NDsBicQ/640?wx_fmt=png&amp;from=appmsg"></figure><section data-tool="mdnice编辑器"><span>参考资料</span></section><section data-tool="mdnice编辑器"><span><span>[1]</span><p>r-universe: <em>https://yunuuuu.r-universe.dev/ggalign</em></p></span><span><span>[2]</span><p>GitHub: <em>https://github.com/Yunuuuu/ggalign</em></p></span></section></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/y5M36Ve84zUptEsJeSPv5A",target="_blank" rel="noopener noreferrer">原文链接</a>
