---
title: "单细胞亚群细胞数量不一致，如何实现抽样？"
date: 2024-10-27T23:45:55Z
draft: ["false"]
tags: [
  "fetched",
  "Investigator进修录"
]
categories: ["Acdemic"]
---
单细胞亚群细胞数量不一致，如何实现抽样？ by Investigator进修录
------
<div><section data-style-type="5" data-tools="新媒体排版" data-id="2430070"><section data-style-type="5" data-tools="新媒体排版" data-id="2390348"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section><br></section><section><section><section><section><p>分享是一种态度</p></section></section></section></section></section></section></section><section><section powered-by="xiumi.us"><section><section><img data-ratio="0.8738095238095238" data-type="gif" data-w="420" width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/siaia0BDGJdjSnnb9ibXpFagGPWQ0JjSSTNVBZthROEhicfINuLcxX2Ro3Zb600LJhrzeYIb120tLjSVXEtLn14DwA/640?wx_fmt=gif"></section></section></section></section></section></section></section></section></section><section data-width="100%"><section><br></section></section><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">有人提问，他自己做单细胞的gsva, 细胞通讯，转录因子，拟时序, inferCNV这些分析，发现特别的消耗计算资源，因为项目很多，每个细胞亚群都是过万的细胞。希望可以将这些单细胞亚群进行抽样，使得其细胞数量一致。</p><p data-tool="mdnice编辑器">我们以 seurat 官方教程为例：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(Seurat)<br><span># devtools::install_github('satijalab/seurat-data')</span><br><span>library</span>(SeuratData)<br><span>library</span>(ggplot2)<br><span>library</span>(patchwork)<br><span>library</span>(dplyr)<br>load(file = <span>'basic.sce.pbmc.Rdata'</span>)<br><br>DimPlot(pbmc, reduction = <span>'umap'</span>, <br>        label = <span>TRUE</span>, pt.size = <span>0.5</span>) + NoLegend()<br><br>sce=pbmc<br></code></pre><p data-tool="mdnice编辑器">如果你不知道 <strong>basic.sce.pbmc.Rdata</strong> 这个文件如何得到的，麻烦自己去跑一下 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247500816&amp;idx=1&amp;sn=25568540a54d63225def0804c05025f8&amp;scene=21#wechat_redirect" data-linktype="2">可视化单细胞亚群的标记基因的5个方法</a>，自己 save(pbmc,file = 'basic.sce.pbmc.Rdata') ，我们后面的教程都是依赖于这个 文件哦！</p><h3 data-tool="mdnice编辑器"><span></span><span>比如subset函数就有downsample参数</span><span></span></h3><p data-tool="mdnice编辑器">使用起来超级方便，subset(sce, downsample = 15) 即可，全部的 代码如下：</p><pre data-tool="mdnice编辑器"><span></span><code>features= c(<span>'IL7R'</span>, <span>'CCR7'</span>,<span>'CD14'</span>, <span>'LYZ'</span>,  <span>'IL7R'</span>, <span>'S100A4'</span>,<span>"MS4A1"</span>, <span>"CD8A"</span>,<span>'FOXP3'</span>,<br>            <span>'FCGR3A'</span>, <span>'MS4A7'</span>, <span>'GNLY'</span>, <span>'NKG7'</span>,<br>            <span>'FCER1A'</span>, <span>'CST3'</span>,<span>'PPBP'</span>)<br><br>DoHeatmap(subset(sce ), <br>          features = features, <br>          size = <span>3</span><br>          )<br>table(Idents(sce))<br>DoHeatmap(subset(sce, downsample = <span>15</span>), <br>          features = features, size = <span>3</span>)<br></code></pre><p data-tool="mdnice编辑器">抽样前后很容易看出来：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5342592592592592" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRVIvFmI5xQnWLF2LKicDZxY9VAnkdnWKicftJkJJWiafFmI1o2wG6ibUWoz0icPlzh3W4PUduicRt7UvtA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRVIvFmI5xQnWLF2LKicDZxY9VAnkdnWKicftJkJJWiafFmI1o2wG6ibUWoz0icPlzh3W4PUduicRt7UvtA/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">可以看到：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5277777777777778" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRVIvFmI5xQnWLF2LKicDZxYYY1ib1RfJKAjW5xxLZOvGfOUjsZW7ibUZicBFf6jPpDIMo3ReAicc1LsWQ/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjRVIvFmI5xQnWLF2LKicDZxYYY1ib1RfJKAjW5xxLZOvGfOUjsZW7ibUZicBFf6jPpDIMo3ReAicc1LsWQ/640?wx_fmt=png"></figure><h3 data-tool="mdnice编辑器"><span></span><span>自己写函数进行抽样</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><br><span># 每个细胞亚群抽10 </span><br>allCells=names(Idents(sce))<br>allType = levels(Idents(sce))<br><br>choose_Cells = unlist(lapply(allType, <span>function</span>(x){<br>  cgCells = allCells[Idents(sce)== x ]<br>  cg=sample(cgCells,<span>10</span>)<br>  cg<br>}))<br><br>cg_sce = sce[, allCells %<span>in</span>% choose_Cells]<br>cg_sce<br>table(Idents(cg_sce))<br></code></pre><p data-tool="mdnice编辑器">可以看到抽样很成功：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; as.data.frame(table(Idents(cg_sce)))<br>          Var1 Freq<br>1  Naive CD4 T   10<br>2   CD14+ Mono   10<br>3 Memory CD4 T   10<br>4            B   10<br>5        CD8 T   10<br>6 FCGR3A+ Mono   10<br>7           NK   10<br>8           DC   10<br>9     Platelet   10<br></code></pre><hr data-tool="mdnice编辑器"><blockquote data-tool="mdnice编辑器"><p>注：如果想要获取文中代码。后台回复<strong>单细胞亚群</strong>即可！</p></blockquote></section><section><section data-style-type="5" data-tools="新媒体排版" data-id="2440476"><section><section><section><section><img data-ratio="0.9495798319327731" data-type="other" data-w="119" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=other" src="https://mmbiz.qpic.cn/mmbiz_gif/09gp6SvPE04j3m2v7Hr889icHUyibTOHs8YuUibicl7ibRD0ZwG5pDTjBluRreZvuib1o3BibvLkicYhnA4YW7dQsjn0cA/640?wx_fmt=other"></section><section data-brushtype="text">往期回顾</section><section><br></section></section></section></section><section><section data-autoskip="1"><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247494611&amp;idx=1&amp;sn=902e6153c2b1435f4f093363b1560fde&amp;chksm=ea1ced51dd6b6447f8ae762d064f8ff95c07dd044b736a2526a518a0f6819956c23d9fa6c4fa&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>提取单细胞亚群进行后续再分析</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247494594&amp;idx=1&amp;sn=15ca41455c90e029d00ce6270e158e8a&amp;chksm=ea1ced40dd6b64562157a14247e3d44a22978c3245b29660cff55e5a818b3c332d43a56142ea&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>不知道你的单细胞分多少群合适，clustree帮助你</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247494592&amp;idx=1&amp;sn=0cba309239bdc9107d08c94991f4acf2&amp;chksm=ea1ced42dd6b6454270b152218ca3ca742473f016dee2926fd0ce4c2f4dd18a9f6a7c7072d1f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>多个单细胞亚群合并</span></a><br></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247494542&amp;idx=1&amp;sn=d0bec660b2f803cfbce24b9a3ca9aa8e&amp;chksm=ea1ced0cdd6b641a3bc9ecea512d06c8e8b87262fa17273a9bf1a4008d332ace90ab792284b3&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2"><span>公开课-单细胞数据基础分析</span></a><br></p></section></section><hr><p><br></p></section><section data-style-type="5" data-tools="新媒体排版" data-id="2440475"><hr><p><br></p><hr><section><p>如果你对单细胞转录组研究感兴趣，但又不知道如何入门，也许你可以关注一下下面的课程<span></span></p><p><br></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247501633&amp;idx=3&amp;sn=85a34d84f29434f9ae8833cc2d7a0880&amp;chksm=9b4b87faac3c0eecf3333f80fb60b685bdeed6dd85f06ba929a55f1d760b846be21784dfd0a0&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1">生信爆款入门-2021第3期</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247494544&amp;idx=1&amp;sn=d41f9d4306feb1f90179d3c54e518bee&amp;chksm=ea1ced12dd6b64041aeb428a0dfce167cb5aaba36351cb8df3c47e08c2fbc76924ca646777e7&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1">数据挖掘线下重启(成都站)(五月15和16的周六日)</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247501667&amp;idx=2&amp;sn=b05cb7181f632a557f0d78c6f31160d3&amp;chksm=9b4b87d8ac3c0ece42e259d2c39948dd6a1227b6c392213cb4564ae6a9926a6735f871da941b&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1">明码标价之共享96线程384G内存服务器</a></p></li></ul><p><img data-ratio="1" data-type="gif" data-w="240" data-src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif" src="https://mmbiz.qpic.cn/mmbiz_gif/4TKeL1ZejtlKxOib5kmKX6ic6eX0w0WK5jvhtz9yBRsO3OI4yr6S5iaLNM7AbAeuPDHXMvDdur2DRz9wyiax4lEviag/640?wx_fmt=gif"><br></p><p><img data-ratio="0.05278592375366569" data-type="jpeg" data-w="341" data-src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz/4TKeL1Zejtlq03ZOSZiaTlic1MxgdKiaxTbOZ7ZSe0Xx1Ca8xF3L6Nyj1FYUajtYrSmRIHyZVSsAve0EAvEicZONpg/640?wx_fmt=jpeg"></p><p><strong><span>看完记得顺手点个</span></strong><span><strong><span>“在看”</span></strong></span><strong><span>哦！</span></strong></p></section><section><section data-tools="135编辑器" data-id="93668"><section><section data-width="95%"><section><section data-width="61.8%"><section><section><section><p><br></p><span><strong data-burshtype="text"><img data-copyright="0" data-cropselx1="0" data-cropselx2="109" data-cropsely1="0" data-cropsely2="109" data-ratio="1" data-type="jpeg" data-w="258" title="qrcode_for_gh_5a3c482ed99f_1280.jpg" data-src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz/siaia0BDGJdjRMGrkqo64BGKecYk4akuHpGHVQs7FeOpY7eWbIPGC1tRw5Tw0oEPmx053mR9FTVerWvhuZchIpZw/640?wx_fmt=jpeg"><strong data-burshtype="text">生物</strong><strong data-burshtype="text"> | 单细胞 | 转录组丨资料</strong></strong></span></section><section><span><strong data-burshtype="text">每天都精彩</strong></span></section></section></section><section><section><section><section><p><span>长按扫码可关注</span></p></section></section></section></section></section></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ITxS5DzOk7uSodaIwTHZbA",target="_blank" rel="noopener noreferrer">原文链接</a>
