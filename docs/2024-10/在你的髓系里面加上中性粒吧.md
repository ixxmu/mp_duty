---
title: "在你的髓系里面加上中性粒吧"
date: 2024-10-12T07:14:32Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
在你的髓系里面加上中性粒吧 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>最近肿瘤单细胞数据分析里面中性粒细胞亚群比较火爆，不过绝大部分10x技术产出的单细胞转录组数据里面其实很难区分出来中性粒细胞亚群，具体原因大家很容易去10x的官网看到。不过，我回顾了一下不久前的一个学徒汇报的公共数据挖掘，恰好里面的髓系免疫细胞里面就有这个中性粒细胞亚群。</p></blockquote><p data-tool="mdnice编辑器">通常我们拿到了肿瘤相关的单细胞转录组的表达量矩阵后的第一层次降维聚类分群通常是：</p><ul data-tool="mdnice编辑器"><li><section>immune (CD45+,PTPRC),</section></li><li><section>epithelial/cancer (EpCAM+,EPCAM),</section></li><li><section>stromal (CD10+,MME,fibo or CD31+,PECAM1,endo)</section></li></ul><p data-tool="mdnice编辑器">参考我前面介绍过 <a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247488940&amp;idx=1&amp;sn=1cc8a8a74715087939b9721c0881775d&amp;scene=21#wechat_redirect" data-linktype="2">CNS图表复现08—肿瘤单细胞数据第一次分群通用规则</a>，这3大单细胞亚群构成了肿瘤免疫微环境的复杂。绝大部分文章都是抓住免疫细胞亚群进行细分，包括淋巴系（T,B,NK细胞）和髓系（单核，树突，巨噬，粒细胞）的两大类作为第二次细分亚群。但是也有不少文章是抓住stromal 里面的fibo 和endo进行细分，并且编造生物学故事的。</p><p data-tool="mdnice编辑器">我们前面已经对免疫细胞里面的髓系和B细胞细分亚群进行了简单的介绍：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247506948&amp;idx=1&amp;sn=025d7f91abfa1b68d7910c86cf709e43&amp;scene=21#wechat_redirect" data-linktype="2">B细胞细分亚群</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247506971&amp;idx=1&amp;sn=f0242285e2c827d922f938d9858d4ffe&amp;scene=21#wechat_redirect" data-linktype="2">髓系免疫细胞细分亚群</a></section></li></ul><p data-tool="mdnice编辑器">但是之前的髓系免疫细胞细分的时候其实并没有中性粒细胞亚群，它也一直不在我们分享的单细胞数据处理代码里面。是时候补充起来了，首先我对单细胞转录组表达量矩阵进行了标准的降维聚类分群，然后提取了里面的髓系免疫细胞后继续进行标准的降维聚类分群，如下所示：</p><p><img data-galleryid="" data-ratio="0.5200984413453651" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwguheVy4aFp8aM8bQdYDp0zAht6EGgicZU2lhvbDnhrMtVXFxx91qsgCoicYRgbFk1bybSn2icpzobQ/640?wx_fmt=png" data-type="png" data-w="2438" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwguheVy4aFp8aM8bQdYDp0zAht6EGgicZU2lhvbDnhrMtVXFxx91qsgCoicYRgbFk1bybSn2icpzobQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>标准的降维聚类分群</figcaption></figure><p data-tool="mdnice编辑器">根据我的生物学背景，以及对它们的每个单细胞亚群的理解，我给出来了如下所示的细胞亚群名字：</p><pre data-tool="mdnice编辑器"><span></span><code>celltype=data.frame(ClusterID=<span>0</span>:<span>13</span>,<br>                    celltype=<span>0</span>:<span>13</span> )   <br><br><span>#celltype[celltype$ClusterID %in% c( 9,18 ),2]='mast'  </span><br>celltype[celltype$ClusterID %<span>in</span>% c(  <span>11</span>  ),<span>2</span>]=<span>'pDC'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>12</span>  ),<span>2</span>]=<span>'DC1'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>3</span> ),<span>2</span>]=<span>'DC2'</span>   <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>13</span> ),<span>2</span>]=<span>'DC3'</span>   <br><br>celltype[celltype$ClusterID %<span>in</span>% c( <span>1</span>,<span>2</span>,<span>4</span>,<span>5</span>,<span>7</span> ),<span>2</span>]=<span>'Mac'</span>     <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>0</span>),<span>2</span>]=<span>'mono'</span>  <br>celltype[celltype$ClusterID %<span>in</span>% c( <span>6</span> ),<span>2</span>]=<span>'neutrophils'</span>  <br><br></code></pre><p data-tool="mdnice编辑器">非常的漂亮，最后得到的髓系免疫细胞各个单细胞亚群及其数量如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; as.data.frame(sort(table(Idents(sce.all))))<br>         Var1 Freq<br>1         DC3   17<br>2         DC1   27<br>3         pDC   38<br>4 neutrophils  176<br>5         DC2  237<br>6        mono  533<br>7         Mac 1218<br></code></pre><p data-tool="mdnice编辑器">可以看到，主要是巨噬细胞和单核细胞，因为第一层次降维聚类分群里面的肥大细胞非常清晰的跟髓系其它单细胞亚群区分开来，所以第二层次并没有考虑肥大细胞。</p><p data-tool="mdnice编辑器">分配好群之后，可以看到每个单细胞亚群各自的高表达量基因非常清晰：</p><p><img data-galleryid="" data-ratio="0.8309859154929577" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwguheVy4aFp8aM8bQdYDp0Trj39LHwEYTE9OI7AzMtptjynjk4Y6x7nnKFDMkKiazoCicYryqt0b1A/640?wx_fmt=png" data-type="png" data-w="2272" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwguheVy4aFp8aM8bQdYDp0Trj39LHwEYTE9OI7AzMtptjynjk4Y6x7nnKFDMkKiazoCicYryqt0b1A/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>各自的高表达量基因非常清晰</figcaption></figure><p data-tool="mdnice编辑器">其中DC2这个亚群的异质性稍微有一点点大，这个我做了六百多个肿瘤单细胞转录组数据集发现绝大部分都是这样，就先忽略它。</p><p data-tool="mdnice编辑器">值得注意的是这个时候中性粒细胞亚群已经是非常清晰可见啦，而且确实细胞质量堪忧：</p><p><img data-galleryid="" data-ratio="0.5468895078922934" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwguheVy4aFp8aM8bQdYDp0rpiahuibGt6Sxwzhhk1pTICTa6IrYX7c5V4WbJmkKZMBiaS8bgtWZozSQ/640?wx_fmt=png" data-type="png" data-w="2154" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwguheVy4aFp8aM8bQdYDp0rpiahuibGt6Sxwzhhk1pTICTa6IrYX7c5V4WbJmkKZMBiaS8bgtWZozSQ/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>细胞质量堪忧</figcaption></figure><p data-tool="mdnice编辑器">而且我把这些髓系单细胞亚群的基因也提取出来了，做成为了代码给大家：</p><pre data-tool="mdnice编辑器"><span></span><code>th=theme(axis.text.x = element_text(angle = <span>45</span>, <br>                                    vjust = <span>0.5</span>, hjust=<span>0.5</span>))  <br>myeloids = list(<br>  Mac=c(<span>"C1QA"</span>,<span>"C1QB"</span>,<span>"C1QC"</span>,<span>"SELENOP"</span>,<span>"RNASE1"</span>,<span>"DAB2"</span>,<span>"LGMN"</span>,<span>"PLTP"</span>,<span>"MAF"</span>,<span>"SLCO2B1"</span>),<br>  mono=c(<span>"VCAN"</span>,<span>"FCN1"</span>,<span>"CD300E"</span>,<span>"S100A12"</span>,<span>"EREG"</span>,<span>"APOBEC3A"</span>,<span>"STXBP2"</span>,<span>"ASGR1"</span>,<span>"CCR2"</span>,<span>"NRG1"</span>),<br>  neutrophils =  c(<span>"FCGR3B"</span>,<span>"CXCR2"</span>,<span>"SLC25A37"</span>,<span>"G0S2"</span>,<span>"CXCR1"</span>,<span>"ADGRG3"</span>,<span>"PROK2"</span>,<span>"STEAP4"</span>,<span>"CMTM2"</span> ),<br>  pDC = c(<span>"GZMB"</span>,<span>"SCT"</span>,<span>"CLIC3"</span>,<span>"LRRC26"</span>,<span>"LILRA4"</span>,<span>"PACSIN1"</span>,<span>"CLEC4C"</span>,<span>"MAP1A"</span>,<span>"PTCRA"</span>,<span>"C12orf75"</span>),<br>  DC1 = c(<span>"CLEC9A"</span>,<span>"XCR1"</span>,<span>"CLNK"</span>,<span>"CADM1"</span>,<span>"ENPP1"</span>,<span>"SNX22"</span>,<span>"NCALD"</span>,<span>"DBN1"</span>,<span>"HLA-DOB"</span>,<span>"PPY"</span>),<br>  DC2=c( <span>"CD1C"</span>,<span>"FCER1A"</span>,<span>"CD1E"</span>,<span>"AL138899.1"</span>,<span>"CD2"</span>,<span>"GPAT3"</span>,<span>"CCND2"</span>,<span>"ENHO"</span>,<span>"PKIB"</span>,<span>"CD1B"</span>),<br>  DC3 =  c(<span>"HMSD"</span>,<span>"ANKRD33B"</span>,<span>"LAD1"</span>,<span>"CCR7"</span>,<span>"LAMP3"</span>,<span>"CCL19"</span>,<span>"CCL22"</span>,<span>"INSM1"</span>,<span>"TNNT2"</span>,<span>"TUBB2B"</span>)<br>)<br>p &lt;- DotPlot(sce.all, features = myeloids,<br>             assay=<span>'RNA'</span> ,group.by = <span>'celltype'</span> )  +th<br><br>p<br>ggsave(plot=p, filename=<span>"check_myeloids_marker_by_celltype.pdf"</span>) <br></code></pre><p data-tool="mdnice编辑器">蛮方便的，大家可以复制粘贴我的代码去自己的单细胞项目里面的髓系免疫细胞里面赶快看看哦。</p><p data-tool="mdnice编辑器">值得注意的是，因为这个数据集的特殊性，我这里并没有把单核细胞区分成为经典的CD14单核和 非经典的CD16单核哦。</p><p data-tool="mdnice编辑器">当然了，这个数据集还可以被制作成为了singleR的数据库：</p><pre data-tool="mdnice编辑器"><span></span><code>av_myeloids &lt;-AverageExpression(sce.all,<br>                       group.by =c( <span>"celltype"</span>),<br>                       assays = <span>"RNA"</span>)[[<span>1</span>]]<br>head(av_myeloids)  <br>ref_sce=SingleCellExperiment::SingleCellExperiment(assays=list(counts=av_myeloids))<br><span>library</span>(scater)<br>ref_sce=scater::logNormCounts(ref_sce)<br><span>library</span>(SingleCellExperiment)<br>logcounts(ref_sce)[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>colData(ref_sce)$Type=colnames(av_myeloids) <br>ref_sce_myeloids = ref_sce <br>save(av_myeloids, ref_sce_myeloids,file = <span>'av_myeloids_for_singleR.Rdata'</span>)<br><br></code></pre><p data-tool="mdnice编辑器">只要你拿到了我的av_myeloids_for_singleR.Rdata 文件，以后遇到了髓系免疫细胞就可以很容易去注释啦。</p><pre data-tool="mdnice编辑器"><span></span><code>testdata &lt;- GetAssayData(sce.all, slot=<span>"data"</span>)<br>testdata[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br>dim(testdata)<br><span>library</span>(SingleR)<br>load(file = <span>'av_myeloids_for_singleR.Rdata'</span>)<br>pred &lt;- SingleR(test=testdata, ref=ref_sce, <br>                labels=ref_sce$Type<br>) <br>sce.all$singleR=pred$labels<br>DimPlot(sce.all, reduction = <span>"umap"</span>,repel = <span>T</span>,<br>        group.by = <span>"singleR"</span>,label = <span>T</span>)<br>ggsave(<span>'umap-singleR.pdf'</span>,width = <span>12</span>,height = <span>6</span>)<br>gplots::balloonplot(table(Idents(sce.all),pred$labels))<br></code></pre><p data-tool="mdnice编辑器">不过，让我诧异的是，如果是使用SingleR针对每个细胞进行相关性注释，会有一些模糊地带，如下所示：</p><p><img data-galleryid="" data-ratio="0.38488372093023254" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwguheVy4aFp8aM8bQdYDp0M0letNtyiaKrz2Jm6Hu9xXTKic51ml01XZeOKW9SgriatwJfOFI0CFfsA/640?wx_fmt=png" data-type="png" data-w="1720" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwguheVy4aFp8aM8bQdYDp0M0letNtyiaKrz2Jm6Hu9xXTKic51ml01XZeOKW9SgriatwJfOFI0CFfsA/640?wx_fmt=png"></p><figure data-tool="mdnice编辑器"><figcaption>有一些模糊地带</figcaption></figure><p data-tool="mdnice编辑器">这就需要对SingleR软件有所理解啦，如果是按照亚群来注释虽然会很准确，但是仁者见仁智者见智啦。</p><p data-tool="mdnice编辑器">另外，如果你需要我的av_myeloids_for_singleR.Rdata 文件，可以发邮件找我申请哈，来信需要注明身份，你遇到的困难，另外我也不保证时效性哈。</p></section><h3 data-tool="mdnice编辑器"><span>文末友情推荐：毛遂自荐成为你的单细胞顾问</span></h3><p data-tool="mdnice编辑器">联系方式详见：<a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514132&amp;idx=1&amp;sn=e39aafaee9f88325c9f02a929f7f6c8d&amp;chksm=9b4bf8afac3c71b988dc9921811dd17bc0f09f94f0c69bfed9fd997fc7a84ac80972ccd48af4&amp;scene=21#wechat_redirect" data-linktype="2">毛遂自荐成为你的单细胞顾问</a></p><p data-tool="mdnice编辑器">单细胞数据标准分析我们做的很多，但是无穷无尽的个性化分析，我们只能做到模仿，很难创新。而且我不是汤富酬张泽民这样的单细胞旗手，仅仅是带领学徒做了一下单细胞文献图表复现，只能做到模仿。文献有的我才会，不能凭空创造概念，只能说把自己看过的几百篇单细胞文献的共性整理，基于它们来对你进行指导哦。</p><p data-tool="mdnice编辑器">作为单细胞顾问，我可以提供的服务仅限于：</p><ul data-tool="mdnice编辑器"><li><section>你可以发5~10篇相关领域文献给我，预计耗时3小时我简单读一下，认识你的课题背景，收费3000块钱</section></li><li><section>你把自己的单细胞转录组数据分析做一个ppt给我，开腾讯会议我听你的讲解，互动一个小时，讨论一个小时，合计收费 2000元。</section></li><li><section>单细胞数据分析流程检查（降维聚类分群，亚群比例差异，表达量差异），耗时半个小时，收费2000块钱</section></li><li><section>其它高级分析的debug，单项收费1600</section></li></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/lUZeQEPUSaoDumMnpspMQg",target="_blank" rel="noopener noreferrer">原文链接</a>
