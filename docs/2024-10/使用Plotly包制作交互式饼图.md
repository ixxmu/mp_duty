---
title: "使用Plotly包制作交互式饼图"
date: 2024-10-27T01:08:12Z
draft: ["false"]
tags: [
  "fetched",
  "R 学习践行者"
]
categories: ["Acdemic"]
---
使用Plotly包制作交互式饼图 by R 学习践行者
------
<div><p>    plotly R 包是一个功能强大且灵活的交互式图表工具。无论是简单的散点图，还是复杂的 3D 可视化，plotly 都能提供优雅且高效的解决方案。通过与 ggplot2 的无缝集成，以及与 Shiny 应用程序的兼容性，plotly 成为 R 语言用户进行数据可视化的理想选择。其主要特点有，</p><p>1）互动式图表：与静态图表不同，plotly 支持图表的互动性，用户可以在图表中进行缩放、悬停、选择数据等操作。</p><p>2）轻松与 ggplot2 集成：plotly 能将 ggplot2 图形轻松转换为交互式的 Plotly 图表，只需使用 ggplotly() 函数即可。</p><p>3）跨平台：生成的图表可以轻松嵌入到 R Markdown、Shiny 应用、HTML 网页中，支持跨平台的展示。</p><p>4）多种图表类型：plotly 支持广泛的图表类型，包括：折线图、柱状图、散点图、气泡图、3D 图表、地理图表（地图）、矩阵热图等</p><pre><code><span>library</span>(plotly)</code></pre><p>    今天主要介绍的内容是使用其绘制饼图：</p><p>1.基本饼图</p><pre><code><span>#加载数据</span><br>USPersonalExpenditure &lt;- data.frame(<span>"Categorie"</span>=rownames(USPersonalExpenditure), USPersonalExpenditure)<br>data &lt;- USPersonalExpenditure[,c(<span>'Categorie'</span>, <span>'X1960'</span>)]<br><br>data</code></pre><pre><code>                                Categorie X1960<br>  Food and Tobacco       Food and Tobacco 86.80<br>  Household Operation Household Operation 46.20<br>  Medical and Health   Medical and Health 21.10<br>  Personal Care             Personal Care  5.40<br>  Private Education     Private Education  3.64</code></pre><pre><code>fig &lt;- plot_ly(data, labels = ~Categorie, values = ~X1960, type = <span>'pie'</span>)<br>fig &lt;- fig %&gt;% layout(title = <span>'United States Personal Expenditures by Categories in 1960'</span>,<br>         xaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>),<br>         yaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>))<br><br>fig</code></pre><p><img data-galleryid="" data-imgfileid="100003022" data-ratio="0.72" data-s="300,640" data-type="png" data-w="925" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmicziaPOslcibeeuAV47y6L1rvJzE0DRuumJDEFpiceNtUNqNyaAU12bibxfA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmicziaPOslcibeeuAV47y6L1rvJzE0DRuumJDEFpiceNtUNqNyaAU12bibxfA/640?wx_fmt=png&amp;from=appmsg"></p><p>这图片是截图，自己运行代码可获得交互式图片<br></p><p>2.样式饼图</p><pre><code><span>#使用 RGB 格式来指定每个饼图扇区的颜色</span><br>colors &lt;- c(<span>'rgb(211,94,96)'</span>, <span>'rgb(128,133,133)'</span>, <span>'rgb(144,103,167)'</span>, <br>            <span>'rgb(171,104,87)'</span>, <span>'rgb(114,147,203)'</span>)<br><br>fig &lt;- plot_ly(data, labels = ~Categorie, values = ~X1960, type = <span>'pie'</span>,<br>        textposition = <span>'inside'</span>, <span>#标签将显示在饼图扇区内部</span><br>        textinfo = <span>'label+percent'</span>,<span>#扇区内显示标签和百分比</span><br>        insidetextfont = list(color = <span>'#FFFFFF'</span>),<span>#饼图内标签的文本颜色设为白色</span><br>        hoverinfo = <span>'text'</span>,<span>#鼠标悬停在扇区上时显示自定义文本</span><br>        text = ~paste(<span>'$'</span>, X1960, <span>' billions'</span>),<span>#悬停时显示的文本格式</span><br>        marker = list(colors = colors, <span>#指定扇区的颜色和扇区之间的白色边框，宽度为 1</span><br>                      line = list(color = <span>'#FFFFFF'</span>, width = <span>1</span>)),<br>        showlegend = <span>FALSE</span>) <span>#隐藏图例</span><br><br><span>#使用 layout() 函数对图表的布局进行调整，隐藏 X 轴和 Y 轴的网格线、零线和刻度标签，因为饼图不需要坐标轴显示</span><br>fig &lt;- fig %&gt;% layout(title = <span>'United States Personal Expenditures by Categories in 1960'</span>,<br>         xaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>),<br>         yaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>))<br><br>fig</code></pre><p><img data-galleryid="" data-imgfileid="100003023" data-ratio="0.7619047619047619" data-s="300,640" data-type="png" data-w="882" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmiclK6Yib59D5xdkAXOgL9lpFMdb9up9Bex2JEM1zkwjhJtD7jD2D39YpQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmiclK6Yib59D5xdkAXOgL9lpFMdb9up9Bex2JEM1zkwjhJtD7jD2D39YpQ/640?wx_fmt=png&amp;from=appmsg"></p><p>3.创建饼图子图</p><p>为了创建饼图子图（subplot），需要使用 domain 属性，X 数组设置水平位置，而 Y 数组设置垂直位置。例如，x=[0,0.5], y=[0,0.5] 表示图表在左下角的位置。</p><pre><code><span>library</span>(plotly)<br><span>library</span>(dplyr)<br>data = count(diamonds, cut);data</code></pre><pre><code>  # A tibble: 5 × 2<br>    cut           n<br>    &lt;ord&gt;     &lt;int&gt;<br>  1 Fair       1610<br>  2 Good       4906<br>  3 Very Good 12082<br>  4 Premium   13791<br>  5 Ideal     21551</code></pre><pre><code>fig &lt;- plot_ly()<br><br>fig &lt;- fig %&gt;% add_pie(data = data, labels = ~cut, values = ~n,<br>          name = <span>"Cut"</span>, domain = list(x = c(<span>0</span>, <span>0.4</span>), y = c(<span>0.4</span>, <span>1</span>)))<span>#设置图表的位置</span><br><br>fig &lt;- fig %&gt;% add_pie(data = count(diamonds, color), labels = ~color, values = ~n,<br>          name = <span>"Color"</span>, domain = list(x = c(<span>0.6</span>, <span>1</span>), y = c(<span>0.4</span>, <span>1</span>)))<br><br>fig &lt;- fig %&gt;% add_pie(data = count(diamonds, clarity), labels = ~clarity, values = ~n,<br>          name = <span>"Clarity"</span>, domain = list(x = c(<span>0.25</span>, <span>0.75</span>), y = c(<span>0</span>, <span>0.6</span>)))<br><br>fig &lt;- fig %&gt;% layout(title = <span>"Pie Charts with Subplots"</span>, showlegend = <span>F</span>,<br>         xaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>),<br>         yaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>))<br><br>fig</code></pre><p><img data-galleryid="" data-imgfileid="100003024" data-ratio="0.7387978142076502" data-s="300,640" data-type="png" data-w="915" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmiczwpR1UJ7vcqrP3mAAnvJzhXtA7thXYe6H6tSOqDOeQXH7bVjiaiciaAQA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmiczwpR1UJ7vcqrP3mAAnvJzhXtA7thXYe6H6tSOqDOeQXH7bVjiaiciaAQA/640?wx_fmt=png&amp;from=appmsg"></p><p>4.使用网格子图</p><pre><code>fig &lt;- plot_ly() %&gt;% <br>  add_pie(data = count(diamonds, cut), labels = ~cut, values = ~n,<br>                         name = <span>"Cut"</span>, domain = list(row = <span>0</span>, column = <span>0</span>)) %&gt;% <br>  add_pie(data = count(diamonds, color), labels = ~color, values = ~n,<br>                       name = <span>"Color"</span>, domain = list(row = <span>0</span>, column = <span>1</span>)) %&gt;% <br>  add_pie(data = count(diamonds, clarity), labels = ~clarity, values = ~n,<br>                       name = <span>"Clarity"</span>, domain = list(row = <span>1</span>, column = <span>0</span>)) %&gt;% <br>  add_pie(data = count(diamonds, cut), labels = ~cut, values = ~n,<br>                       name = <span>"Clarity"</span>, domain = list(row = <span>1</span>, column = <span>1</span>)) %&gt;% <br>  layout(title = <span>"Pie Charts with Subplots"</span>, showlegend = <span>F</span>,<br>                      grid=list(rows=<span>2</span>, columns=<span>2</span>),<br>                      xaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>),<br>                      yaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>))<br><br>fig</code></pre><p><img data-galleryid="" data-imgfileid="100003025" data-ratio="0.7910271546635183" data-s="300,640" data-type="png" data-w="847" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmicsDQlklQquDByibwlhgjayuXtjoQkoHrMbxK4yrBQ0XnVJicULicq3pOpg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmicsDQlklQquDByibwlhgjayuXtjoQkoHrMbxK4yrBQ0XnVJicULicq3pOpg/640?wx_fmt=png&amp;from=appmsg"></p><p>5.控制扇区内的文本方向</p><p>insidetextorientation 属性控制饼图扇区内文本的方向。使用 “auto” 时，文本可能会自动旋转以适应扇区内的最大空间；使用 “horizontal”（或 “radial”、“tangential”）可以强制文本保持水平（或径向、切向）。Plotly 可能会缩小字体大小，以便文本符合所要求的方向。</p><pre><code>labels = c(<span>'Oxygen'</span>,<span>'Hydrogen'</span>,<span>'Carbon_Dioxide'</span>,<span>'Nitrogen'</span>)<br>values = c(<span>4500</span>, <span>2500</span>, <span>1053</span>, <span>500</span>)<br><br>fig &lt;- plot_ly(type=<span>'pie'</span>, labels=labels, values=values, <br>               textinfo=<span>'label+percent'</span>,<br>               insidetextorientation=<span>'radial'</span>)<br>fig</code></pre><p><img data-galleryid="" data-imgfileid="100003026" data-ratio="0.7413213885778276" data-s="300,640" data-type="png" data-w="893" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmicVq9iahpibfwmYzl6YQiauic315iay7FeoZSA6OUhYu8MnbexaZibaAU5quNA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmicVq9iahpibfwmYzl6YQiauic315iay7FeoZSA6OUhYu8MnbexaZibaAU5quNA/640?wx_fmt=png&amp;from=appmsg"></p><p>6.圆环图</p><pre><code>df &lt;- mtcars %&gt;% <br>  mutate(manuf=sapply(strsplit(rownames(.), <span>" "</span>), <span>"[["</span>, <span>1</span>)) %&gt;%<br>  group_by(manuf) %&gt;% <br>  summarize(count = n())<br><br>df</code></pre><pre><code>  # A tibble: 22 × 2<br>     manuf    count<br>     &lt;chr&gt;    &lt;int&gt;<br>   1 AMC          1<br>   2 Cadillac     1<br>   3 Camaro       1<br>   4 Chrysler     1<br>   5 Datsun       1<br>   6 Dodge        1<br>   7 Duster       1<br>   8 Ferrari      1<br>   9 Fiat         2<br>  10 Ford         1<br>  # ℹ 12 more rows</code></pre><pre><code>fig &lt;- df %&gt;% <br>  plot_ly(labels = ~manuf, values = ~count) %&gt;% <br>  add_pie(hole = <span>0.6</span>) %&gt;% <br>  layout(title = <span>"Donut charts using Plotly"</span>,  showlegend = <span>F</span>,<br>                      xaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>),<br>                      yaxis = list(showgrid = <span>FALSE</span>, zeroline = <span>FALSE</span>, showticklabels = <span>FALSE</span>))<br><br>fig</code></pre><p><img data-galleryid="" data-imgfileid="100003027" data-ratio="0.8650385604113111" data-s="300,640" data-type="png" data-w="778" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmicrF2OmFxNRjOuAprpn3crL1ZhicvV2NT22mkXbYJWwaCiaL5BTiciaAhoCA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50ky9g9pTnnLEVYX513HdtmicrF2OmFxNRjOuAprpn3crL1ZhicvV2NT22mkXbYJWwaCiaL5BTiciaAhoCA/640?wx_fmt=png&amp;from=appmsg"></p><p><span>参考资料：</span>https://plot.ly/r/pie-charts/</p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/-qjo7lBrjuAkjpN9YwR5sg",target="_blank" rel="noopener noreferrer">原文链接</a>
