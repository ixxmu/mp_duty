---
title: "数据整合|单细胞转录组多样本/不同测序手段整合"
date: 2024-10-03T01:02:47Z
draft: ["false"]
tags: [
  "fetched",
  "朴素的科研打工仔"
]
categories: ["Acdemic"]
---
数据整合|单细胞转录组多样本/不同测序手段整合 by 朴素的科研打工仔
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p><strong><span>写在前面的话</span></strong></p><p><strong><span>  单细胞测序的价格逐渐逼近万元下，更有国产平台有着更低的价格！但这就对多平台多样本数据整合有着一定的考验，锚点方式容易过拟合，其余批次矫正手段偏弱等问题！</span></strong></p><p><strong><span>  总而言之，秉着解释生物学意义的原则出发吧！</span></strong></p><p data-tool="mdnice编辑器"><span><strong>文献：Single-Cell, Single-Nucleus, andSpatial RNA Sequencing of the HumanLiver Identifies Cholangiocyte andMesenchymal Heterogeneity 《Hepatology CommuniCations》</strong></span></p><p data-tool="mdnice编辑器"><span><strong>肝脏样本的单细胞转录组测序和单细胞核转录组测序<br></strong></span><span><img data-imgfileid="100001461" data-ratio="1.3575129533678756" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJLVJbzXELuHCXsvD3KdgBP1uBkkNnQlbxLY9BvakfUgZRzhk0rCsQAg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="386" src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJLVJbzXELuHCXsvD3KdgBP1uBkkNnQlbxLY9BvakfUgZRzhk0rCsQAg/640?wx_fmt=png&amp;from=appmsg"></span><span><strong><span>图片描述：（C）</span><span>scRNA- seq 和 snRNA- seq 得到的细胞的 UMAP 合并(i)，然后在合并前单独Scale(ii)。(D) scRNA- seq和 snRNA- seq细胞的 UMAP 合并前单独Scale，然后使用Harmony进行整合。</span></strong></span><strong><span>   </span></strong></p><p data-tool="mdnice编辑器"><strong><span>确实整合效果不同！！！</span></strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100001459" data-ratio="0.23465703971119134" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJ5Rx3gj79LowTwqAWySMyia93tKpIPiajsPuFWDQY4zGJlj2r7M0IF8VQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="554" src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJ5Rx3gj79LowTwqAWySMyia93tKpIPiajsPuFWDQY4zGJlj2r7M0IF8VQ/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><br></figure><p><strong><span>融合了大量数据（包括这篇文献） 常规流程进行整合</span></strong></p><pre data-tool="mdnice编辑器"><span><br></span><code>scRNA &lt;- NormalizeData(scRNA, normalization.method = <span>"LogNormalize"</span>, scale.factor = <span>10000</span>)<br>scRNA &lt;- FindVariableFeatures(scRNA, selection.method = <span>"vst"</span>, nfeatures = <span>5000</span>)<br>g2m_genes = cc.genes$g2m.genes<br>g2m_genes = CaseMatch(search = g2m_genes, match = rownames(scRNA))<br>s_genes = cc.genes$s.genes<br>s_genes = CaseMatch(search = s_genes, match = rownames(scRNA))<br>scRNA &lt;- CellCycleScoring(object=scRNA, g2m.features=g2m_genes, s.features=s_genes)<br>scRNA$CC.Difference &lt;- scRNA$S.Score - scRNA$G2M.Score<br>scRNA &lt;- ScaleData(scRNA, vars.to.regress = c(<span>"CC.Difference"</span>,<span>"percent.ribo"</span>,<span>"percent.mt"</span>, <span>"nCount_RNA"</span>), verbose = T)<br>scRNA &lt;- RunPCA(scRNA, features = VariableFeatures(object = scRNA))<br>scRNA &lt;- RunHarmony(scRNA, group.by.vars=<span>"orig.ident"</span>, max.iter.harmony = <span>10</span>) <br>scRNA &lt;- RunUMAP(scRNA,reduction = <span>"harmony"</span>, dims = <span>1</span>:<span>20</span>, verbose = FALSE)<br>DimPlot(scRNA,group.by = <span>"tech"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><strong><img data-imgfileid="100001463" data-ratio="0.9842592592592593" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJGnMA6yc03HNO05gfLykGicYEzprFwmlAZxqFqg5XxINhUrojZZ84NuQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJGnMA6yc03HNO05gfLykGicYEzprFwmlAZxqFqg5XxINhUrojZZ84NuQ/640?wx_fmt=png&amp;from=appmsg"><span>单细胞/核转录组存在明显差异</span></strong><strong><span>学习作者源代码发现，作者是将每一个样本的Seruat对象分别进行全基因的scale并且取每个样本基因的交集后变成merge后seruat对象的scale矩阵，并且取每个样本高变基因的交集进行后续的降维。</span></strong></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100001460" data-ratio="0.6264916467780429" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJL2zLQukLIdhXD2q2n3JDxPbfF61lx1u1qmy5MtyRhriaA8KB552icib0A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="838" src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJL2zLQukLIdhXD2q2n3JDxPbfF61lx1u1qmy5MtyRhriaA8KB552icib0A/640?wx_fmt=png&amp;from=appmsg"></figure><p><strong><span>因整合的数据过多，作者这方法太耗费资源，借鉴采用了将单细胞/核分开取交集高变基因后分别进行scale后赋予merge对象的scale矩阵</span></strong><br></p><pre data-tool="mdnice编辑器"><code>scRNA_sc &lt;- subset(scRNA,idents=<span>"SC"</span>)<br>scRNA_sn &lt;- subset(scRNA,idents=<span>"SN"</span>)<br>scRNA_sc &lt;- NormalizeData(scRNA_sc, normalization.method = <span>"LogNormalize"</span>, scale.factor = <span>10000</span>)<br>scRNA_sc &lt;- FindVariableFeatures(scRNA_sc, selection.method = <span>"vst"</span>, nfeatures = <span>5000</span>)<br>scRNA_sn &lt;- NormalizeData(scRNA_sn, normalization.method = <span>"LogNormalize"</span>, scale.factor = <span>10000</span>)<br>scRNA_sn &lt;- FindVariableFeatures(scRNA_sn, selection.method = <span>"vst"</span>, nfeatures = <span>5000</span>)<br>hvgs &lt;- c(VariableFeatures(scRNA_sc),VariableFeatures(scRNA_sn))<br>hvgs &lt;- unique(hvgs[duplicated(hvgs)])<br>hvgs &lt;- hvgs[!grepl(<span>"^MT-"</span>, hvgs)]<br>scRNA_sc &lt;- ScaleData(scRNA_sc,features=hvgs, vars.to.regress = c(<span>"percent.ribo"</span>,<span>"percent.mt"</span>, <span>"nCount_RNA"</span>), verbose = T)<br>scRNA_sn &lt;- ScaleData(scRNA_sn,features=hvgs, vars.to.regress = c(<span>"percent.ribo"</span>,<span>"percent.mt"</span>, <span>"nCount_RNA"</span>), verbose = T)<br>scale_sc &lt;- scRNA_sc<span>@assays</span>$RNA<span>@scale</span>.data<br>scale_sn &lt;- scRNA_sn<span>@assays</span>$RNA<span>@scale</span>.data<br>scale &lt;- cbind(scale_sc,scale_sn)<br>scRNA<span>@assays</span>$RNA<span>@scale</span>.data &lt;- scale<br>scRNA &lt;- RunPCA(scRNA, features = hvgs)<br>scRNA &lt;- RunHarmony(scRNA, group.by.vars=<span>"orig.ident"</span>, max.iter.harmony = <span>10</span>) <br>scRNA &lt;- RunUMAP(scRNA,reduction = <span>"harmony"</span>, dims = <span>1</span>:<span>15</span>, verbose = FALSE)<br>DimPlot(scRNA,group.by = <span>"tech"</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100001468" data-ratio="0.7303262955854126" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJAYtN8X1fd6t3zZKPzGoIggMgMaukkc27yRIHuICA4RhJSxDe6iardrQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1042" src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJAYtN8X1fd6t3zZKPzGoIggMgMaukkc27yRIHuICA4RhJSxDe6iardrQ/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><strong><span>好像效果是好了些！</span></strong></p><p data-tool="mdnice编辑器"><span><span><strong>用什么方法进行数据整合，因个人而异，刚好看到和审稿人argue scVI和Harmony比较的文章，特意补充note来解释scVI和Harmony对于解释数据的生物学意义差异！！！！</strong></span></span></p><p data-tool="mdnice编辑器"><span><strong>Human skeletal muscle aging atlas 《Nature Aging》</strong></span></p><p data-tool="mdnice编辑器"><span><span><img data-imgfileid="100001466" data-ratio="0.7064814814814815" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJBiaBhicB118iaOd9QF8ItKTibYicIMC3nhUibicyzK1szGxb2XPX0ibkLdpicYQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJBiaBhicB118iaOd9QF8ItKTibYicIMC3nhUibicyzK1szGxb2XPX0ibkLdpicYQ/640?wx_fmt=png&amp;from=appmsg"></span></span></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100001467" data-ratio="1.2490566037735849" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJlRSXFEicicOdMRb1jc7DpQY0uBATJcFDONTjbBh8cNcqYcHlyK6VAGlg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="795" src="https://mmbiz.qpic.cn/mmbiz_png/Ze2f5C6nc67EAYcaLEL9NdMMaNibxfcKJlRSXFEicicOdMRb1jc7DpQY0uBATJcFDONTjbBh8cNcqYcHlyK6VAGlg/640?wx_fmt=png&amp;from=appmsg"></figure></section><p><br></p><p><br></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/XK9Jte3ocPvvxTQPIkkz7g",target="_blank" rel="noopener noreferrer">原文链接</a>
