---
title: "æ–‡çŒ®å¤ç°-å•ç»†èƒæ­ç¤ºæ–°è¾…åŠ©æ²»ç–—åNSCLCçš„å…ç–«å¾®ç¯å¢ƒå˜åŒ–"
date: 2023-09-17T14:08:58Z
draft: ["false"]
tags: [
  "fetched",
  "ç”Ÿä¿¡èœé¸Ÿå›¢"
]
categories: ["Acdemic"]
---
æ–‡çŒ®å¤ç°-å•ç»†èƒæ­ç¤ºæ–°è¾…åŠ©æ²»ç–—åNSCLCçš„å…ç–«å¾®ç¯å¢ƒå˜åŒ– by ç”Ÿä¿¡èœé¸Ÿå›¢
------
<div><section><blockquote><p>å¥½ä¹…æ²¡åšæ–‡çŒ®å¤ç°äº†â€¦</p><p>ä¸Šä¸€æ¬¡å¥½åƒè¿˜æ˜¯åœ¨å»å¹´çš„3æœˆä»½å·¦å³ï¼Œè¯¦è§ï¼š<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247501381&amp;idx=1&amp;sn=4d66c995b9f7d18cbb89e6b5e8cd0214&amp;chksm=fa450378cd328a6ef2333cea3fe1ff0fe0083150d3a463953014f70a0242a84089e9cc9cb5ab&amp;scene=21#wechat_redirect" textvalue="ã€ç”Ÿä¿¡æ–‡çŒ®200ç¯‡ã€‘ä¸“æ ä¹Ÿè½ä¸‹å¸·å¹•ï¼Œç”Ÿä¿¡èœé¸Ÿå›¢çš„å‘å±•éœ€è¦ä½ " linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">ã€ç”Ÿä¿¡æ–‡çŒ®200ç¯‡ã€‘ä¸“æ ä¹Ÿè½ä¸‹å¸·å¹•ï¼Œç”Ÿä¿¡èœé¸Ÿå›¢çš„å‘å±•éœ€è¦ä½ </a>Â  ã€‚ã€‚ã€‚ã€‚</p><p>æ‰€ä»¥è·ç¦»è¿™ä¸ªé¢†åŸŸæˆ‘å·²ç»è„±èŠ‚ä¸€å¹´äº†â€¦.åˆ«éª‚äº†åˆ«éª‚äº†åœ¨å­¦äº†åœ¨å­¦äº†ğŸ˜§ã€‚</p><p>å¦‚æœ‰ä¸å¯¹ï¼Œè¯·æŒ‡å‡ºï¼Œä¸‹æ¬¡ä¸€å®šæ›´æ­£ï¼ï¼ï¼</p></blockquote><p>æ–‡ç« åœ¨è¿™ï¼šTumor microenvironment remodeling after neoadjuvant immunotherapy in non-small cell lung cancer revealed by single-cell RNA sequencing<br><strong>æ–¹æ³•ï¼š</strong>æ¥è‡ª3åæ²»ç–—å‰å’Œ12åæ¥å—æ–°è¾…åŠ©PD-1é˜»æ–­è”åˆåŒ–ç–—çš„éå°ç»†èƒè‚ºç™Œï¼ˆNSCLCï¼‰æ‚£è€…çš„~92,000ä¸ªå•ç»†èƒçš„è½¬å½•ç»„ã€‚<span><strong>æ ¹æ®ç—…ç†ååº”å°†12ä¸ªæ²»ç–—åæ ·æœ¬åˆ†ä¸ºä¸¤ç»„ï¼šMPRï¼ˆn = 4ï¼‰å’ŒéMPRï¼ˆn = 8ï¼‰ã€‚</strong></span></p><blockquote><p>ä¸»è¦ç—…ç†ååº”(<strong>MPR)</strong>è¢«å®šä¹‰ä¸ºæ²»ç–—åè‹æœ¨ç²¾å’Œä¼Šçº¢ï¼ˆH&amp;Eï¼‰æŸ“è‰²çš„æ®‹ä½™æ´»è‚¿ç˜¤ç»†èƒä¸è¶…è¿‡10%</p></blockquote><p><strong>ç»“æœå’Œç»“è®ºï¼š</strong>ä¸åŒçš„æ²»ç–—è¯±å¯¼çš„ç™Œç»†èƒè½¬å½•ç»„ä¸ä¸´åºŠååº”æœ‰å…³ã€‚MPRæ‚£è€…ä¸­ï¼šç™Œç»†èƒé€šè¿‡MHC-IIè¡¨ç°å‡ºæ´»åŒ–æŠ—åŸå‘ˆé€’çš„ç‰¹å¾ã€‚aged CCL3+ä¸­æ€§ç²’ç»†èƒå‡å°‘ï¼ŒFCRL4+FCRL5+è®°å¿†Bç»†èƒå’ŒCD16+CX3CR1+å•æ ¸ç»†èƒå¯Œé›†ï¼Œå¹¶ä¸”æ˜¯å…ç–«æ²»ç–—ååº”çš„é¢„æµ‹å› å­ã€‚NMPRæ‚£è€…ä¸­ï¼šç™Œç»†èƒè¡¨ç°å‡ºé›Œæ¿€ç´ ä»£è°¢é…¶çš„è¿‡è¡¨è¾¾å’Œè¡€æ¸…é›ŒäºŒé†‡å‡é«˜ã€‚åœ¨æ‰€æœ‰æ‚£è€…ä¸­ï¼Œæ²»ç–—ä¿ƒè¿›äº†ç»†èƒæ¯’æ€§Tç»†èƒå’ŒCD16+NKç»†èƒçš„æ‰©å¢å’Œæ´»åŒ–ï¼Œå‡å°‘äº†å…ç–«æŠ‘åˆ¶æ€§Tregï¼Œå¹¶å°†è®°å¿†CD8+Tç»†èƒæ¿€æ´»ä¸ºæ•ˆåº”è¡¨å‹ã€‚ç»„ç»‡é©»ç•™å·¨å™¬ç»†èƒåœ¨æ²»ç–—åæ‰©å¢ï¼Œè‚¿ç˜¤ç›¸å…³å·¨å™¬ç»†èƒï¼ˆTAMï¼‰è¢«é‡å¡‘ä¸ºä¸­æ€§ã€‚</p><p><span><strong>æ¥ä¸‹æ¥æ˜¯å¯¹æ–‡ä¸­çš„å›¾è¿›è¡Œçš„å¤ç°â€¦</strong></span></p><p><span><strong>çº¯æ‰‹å·¥ï¼Œè‡ªå·±å†™ä»£ç ï¼Œå¹¶ä¸æ˜¯æ–‡ç« çš„ä»£ç å“¦ã€‚ã€‚ã€‚ã€‚</strong></span></p><h2><span>1.æ€»åˆ†ç¾¤</span></h2><p>æ–‡ç« åŸå›¾<br></p><figure><img data-ratio="0.9027777777777778" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqv7C4JcSlNx4ObhOtR62KZNMicfc4L5Axib8CHjRxJa7CM6gQOic1dfaicw/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqv7C4JcSlNx4ObhOtR62KZNMicfc4L5Axib8CHjRxJa7CM6gQOic1dfaicw/640?wx_fmt=png"></figure><pre><code>rm(list=ls())<br>options(stringsAsFactorsÂ =Â F)Â <br><span>source</span>(<span>'scrip/lib.R'</span>)<br>library(readxl)<br><br><span>######Â step1:å¯¼å…¥æ•°æ®Â ######Â Â Â </span><br>ct=fread(Â <span>'GSE207422_RAW/GSE207422_NSCLC_scRNAseq_UMI_matrix.txt.gz'</span>,data.tableÂ =Â F)<br>ct[1:4,1:4]<br>ct[nrow(ct),1:4]<br>rownames(ct)=ct[,1]<br>ct=ct[,-1]<br>ct[1:4,1:4]<br>ct1Â =Â ct<br>sÂ &lt;-Â colnames(ct1)<br>s[1:10]<br>s1Â =Â substr(s,Â 1,Â 11)<br>s1[1:10]<br>table(s1)<br>colnames(ct1)Â =Â s1<br>metaÂ &lt;-Â read_excel(<span>"GSE207422_RAW/GSE207422_NSCLC_scRNAseq_metadata.xlsx"</span>)<br><br>sce.allÂ =Â CreateSeuratObject(countsÂ =Â Â ct1Â ,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â min.cellsÂ =Â 5,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â min.featuresÂ =Â 500)<br>as.data.frame(sce.all@assays<span>$RNA</span>@counts[1:10,Â 1:2])<br>head(sce.all@meta.data,Â 10)<br>table(sce.all@meta.data<span>$orig</span>.ident)Â <br><br>sÂ =Â colnames(sce.all)<br>s1Â =Â substr(s,Â 1,Â 11)<br>s1[1:10]<br>table(s1)<br>s1Â =Â gsub(c(<span>'BD_immune01|BD_immune05|BD_immune08'</span>),<span>"Pre-treatment"</span>,s1)<br>s2Â =Â gsub(<span>"BD_immune.*$"</span>,Â <span>"Post-treatment"</span>,Â s1)Â <span>#ç¬¬ä¸€ä¸ªç©ºæ ¼ç›´è¾¾ç»“å°¾æ›¿æ¢æˆb</span><br>table(s2)<br><br>phe=str_split(Â Â colnames(sce.all)Â ,<span>'_'</span>,simplifyÂ =Â T)<br>head(phe)<br>table(phe[,1])<br>table(phe[,2])Â Â <br>table(phe[,2],phe[,1])Â Â <br>sce.all<span>$orig</span>.identÂ =Â s2<br>table(sce.all<span>$orig</span>.identÂ )<br>sce.all<span>$group</span>=sce.all<span>$orig</span>.ident<br>sce.all<span>$orig</span>.ident=paste(phe[,2],phe[,1])Â Â <br>head(sce.all@meta.data)Â <br>table(sce.all@meta.data<span>$group</span>)<br>table(sce.all@meta.data<span>$orig</span>.ident)<br><br><span>######Â step2:QCè´¨æ§Â ######</span><br>dir.create(<span>"./1-QC"</span>)<br>setwd(<span>"./1-QC"</span>)<br><span>source</span>(<span>'../scrip/qc.R'</span>)<br>sce.all.filtÂ =Â basic_qc(sce.all)<br><span>print</span>(dim(sce.all))<br><span>print</span>(dim(sce.all.filt))<br>setwd(<span>'../'</span>)<br>sp=<span>'human'</span><br><br><span>######Â step3:Â harmonyæ•´åˆå¤šä¸ªå•ç»†èƒæ ·å“Â ######</span><br>dir.create(<span>"2-harmony"</span>)<br>getwd()<br>setwd(<span>"2-harmony"</span>)<br><span>source</span>(<span>'../scrip/harmony.R'</span>)<br><span>#Â é»˜è®¤Â ScaleDataÂ æ²¡æœ‰æ·»åŠ "nCount_RNA",Â "nFeature_RNA"</span><br><span>#Â é»˜è®¤çš„</span><br>sce.all.intÂ =Â run_harmony(sce.all.filt)<br>setwd(<span>'../'</span>)<br><br><span>#######step4:Â æ£€æŸ¥å¸¸è§åˆ†ç¾¤æƒ…å†µ</span><br>rm(list=ls())<br>library(ggplot2)<br>dir.create(<span>"3-cell"</span>)<br>setwd(<span>"3-cell"</span>)Â Â <br>getwd()<br>sce.all.int=readRDS(<span>"../2-harmony/sce.all_int.rds"</span>)<br>table(Idents(sce.all.int))<br>table(sce.all.int<span>$seurat_clusters</span>)<br>table(sce.all.int<span>$RNA_snn_res</span>.0.1)Â <br>table(sce.all.int<span>$RNA_snn_res</span>.0.3)Â <br><br>sel.clustÂ =Â <span>"RNA_snn_res.0.3"</span><br>sce.allÂ &lt;-Â SetIdent(sce.all.int,Â valueÂ =Â sel.clust)<br>table(sce.all@active.ident)Â <br><br>metaÂ &lt;-Â read_excel(<span>"../GSE207422_RAW/GSE207422_NSCLC_scRNAseq_metadata.xlsx"</span>)<br>sÂ =Â colnames(sce.all)<br>s[1:10]<br>s1Â =Â substr(s,Â 1,Â 11)<br>s1[1:10]<br>table(s1)<br>s2Â =Â gsub(<span>"BD_immune"</span>,Â <span>"P"</span>,Â s1)Â <br>table(s2)<br><br>sce.all<span>$patient</span>Â =Â s2<br>table(sce.all<span>$patient</span>Â )<br><br><span>##RECIST</span><br>colnames(meta)<br>meta<span>$RECIST</span><br>s_RECISTÂ =Â gsub(c(<span>'BD_immune01|BD_immune07|BD_immune08|BD_immune11|BD_immune12|BD_immune15'</span>),<span>"PR"</span>,s1)<br>s_RECISTÂ =Â gsub(<span>"BD_immune.*$"</span>,Â <span>"SD"</span>,Â s_RECIST)Â <br>table(s_RECIST)<br>sce.all<span>$RECIST</span>Â =Â s_RECIST<br><br><span>##ç—…ç†ååº”</span><br><span>##åé¢æ˜¯æŒ‰ç…§TNå’Œæ²»ç–—åæ‰‹æœ¯æ ·æœ¬æ¥åˆ†ç±»çš„</span><br>colnames(meta)<br>meta$`PathologicÂ Response`<br>s_PathologicÂ =Â gsub(c(<span>'BD_immune03|BD_immune06|BD_immune11|BD_immune14'</span>),<span>"MPR"</span>,s1)<br>s_PathologicÂ =Â gsub(<span>"BD_immune.*$"</span>,Â <span>"NMPR"</span>,Â s_Pathologic)Â <br>table(s_Pathologic)<br>sce.all<span>$Pathologic</span>Â =Â s_Pathologic<br>pheÂ =Â sce.all@meta.data<br><br>phe[phe<span>$orig</span>.identÂ ==Â <span>'Pre-treatment'</span>,Â <span>"Pathologic"</span>]Â =Â <span>'TN'</span><br>table(phe<span>$Pathologic</span>)<br>sce.all@meta.dataÂ =Â phe<br>table(sce.all<span>$Pathologic</span>)<br><br><span>##è¯ç‰©æ²»ç–—</span><br>colnames(meta)<br>metaÂ =Â meta[1:15,]<br>meta<span>$medicine</span>Â =Â paste(meta$`PD1Â Antibody`,meta<span>$Chemotherapy</span>,sep=<span>"+"</span>)<br>s1<br>table(meta<span>$medicine</span>)<br>match_vecÂ &lt;-Â match(s1,Â unique(s1))<br>s_medicineÂ &lt;-Â meta<span>$medicine</span>[match_vec]<br><span>##æ£€éªŒä¸€ä¸‹æ˜¯ä¸æ˜¯å¯¹çš„...</span><br>s1[23456]<br>s_medicine[23456]<br><br>s1[45678]<br>s_medicine[45678]<br><br>table(s_medicine)<br>sce.all<span>$medicine</span>Â =Â s_medicine<br><br>saveRDS(sce.all,Â <span>"sce.all_meta.rds"</span>)<br><br><span>#marker</span><br>genes_to_checkÂ =Â c(<span>'PTPRC'</span>,Â <span>'CD3D'</span>,Â <span>'CD3E'</span>,Â <span>'CD4'</span>,<span>'CD8A'</span>,Â Â <span>##Â TÂ </span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'CD19'</span>,Â <span>'CD79A'</span>,Â <span>'MS4A1'</span>Â ,Â Â <span>##Â BÂ </span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'IGHG1'</span>,Â <span>'MZB1'</span>,Â <span>'SDC1'</span>,Â <span>##Â PlasmaÂ </span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'CD68'</span>,Â <span>'CD163'</span>,Â <span>'CD14'</span>,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'VCAN'</span>,Â <span>'FCN1'</span>,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'TPSAB1'</span>Â ,Â <span>'TPSB2'</span>,Â Â <span>#Â mastÂ cells,</span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'RCVRN'</span>,<span>'FPR1'</span>Â ,Â <span>'ITGAM'</span>Â ,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'C1QA'</span>,Â Â <span>'C1QB'</span>,Â Â <span>#Â mac</span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'S100A9'</span>,Â <span>'S100A8'</span>,Â <span>'MMP19'</span>,<span>#Â monocyte</span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'MKI67'</span>Â ,Â <span>'TOP2A'</span>,<span>'LYZ'</span>,Â <span>##myloid</span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'LAMP3'</span>,Â <span>'IDO1'</span>,<span>'IDO2'</span>,<span>##Â DC3Â </span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'CD1E'</span>,<span>'CD1C'</span>,Â <span>#Â DC2</span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'CLEC10A'</span>,Â <span>'CLEC12A'</span>,<span>'LILRA4'</span>,Â <span>##pDC</span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'FGFBP2'</span>,<span>'NCR1'</span>,<span>'KLRK1'</span>,<span>'KLRC1'</span>,<span>'NCAM1'</span>,<span>'FCGR3A'</span>,Â <span>#Â NKÂ </span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'KIT'</span>,Â <span>##MAST</span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'CSF3R'</span>,<span>'ITGAM'</span>,<span>'ITGB2'</span>,<span>'FUT4'</span>,<span>'FCGR3B'</span>,<span>'FCGR2A'</span>,Â <span>##Neutrophil</span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'FGF7'</span>,<span>'MME'</span>,Â <span>'ACTA2'</span>,<span>'VWF'</span>,<span>'COL1A1'</span>,Â <span>##Â humanÂ Â fiboÂ </span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'DCN'</span>,Â <span>'LUM'</span>,Â Â <span>'GSN'</span>Â ,Â <span>##Â mouseÂ PDACÂ fiboÂ </span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'PECAM1'</span>,Â <span>'VWF'</span>,Â Â <span>##Â endoÂ </span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'EPCAM'</span>Â ,Â <span>'KRT19'</span>,<span>'KRT7'</span>Â <span>#Â epiÂ </span><br>)<br><br><br>library(stringr)Â Â <br>genes_to_check=str_to_upper(genes_to_check)<br>genes_to_check<br>pÂ &lt;-Â DotPlot(sce.all,Â featuresÂ =Â unique(genes_to_check),<br>Â Â Â Â Â Â Â Â Â Â Â Â Â assay=<span>'RNA'</span>Â Â )Â Â +Â coord_flip()<br><br>pÂ <br><br>mycolorsÂ &lt;-c(<span>'#E5D2DD'</span>,Â <span>'#53A85F'</span>,Â <span>'#F1BB72'</span>,Â <span>'#F3B1A0'</span>,Â <span>'#D6E7A3'</span>,Â <span>'#57C3F3'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#E95C59'</span>,Â <span>'#E59CC4'</span>,Â <span>'#AB3282'</span>,Â Â <span>'#BD956A'</span>,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#9FA3A8'</span>,Â <span>'#E0D4CA'</span>,Â Â <span>'#C5DEBA'</span>,Â <span>'#F7F398'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#C1E6F3'</span>,Â <span>'#6778AE'</span>,Â <span>'#91D0BE'</span>,Â <span>'#B53E2B'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#712820'</span>,Â <span>'#DCC1DD'</span>,Â <span>'#CCE0F5'</span>,Â Â <span>'#CCC9E6'</span>,Â <span>'#625D9E'</span>,Â <span>'#68A180'</span>,Â <span>'#3A6963'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#968175'</span>)<br><br>colÂ =c(<span>"#3176B7"</span>,<span>"#F78000"</span>,<span>"#3FA116"</span>,<span>"#CE2820"</span>,<span>"#9265C1"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>"#885649"</span>,<span>"#DD76C5"</span>,<span>"#7F7F7F"</span>,<span>"#BBBE00"</span>,<span>"#41BED1"</span>)<br><br><br>p_umap=DimPlot(sce.all,Â reductionÂ =Â <span>"umap"</span>,colsÂ =Â mycolors,pt.sizeÂ =Â 0.4,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â group.byÂ =Â <span>"RNA_snn_res.0.3"</span>,labelÂ =Â T,label.boxÂ =Â T)Â <br>p_umap<br>library(patchwork)<br>p+p_umap<br>ggsave(<span>'markers_umap_2.pdf'</span>,widthÂ =Â 13,heightÂ =Â 8)<br><br><span>#####step5:Â ç»†èƒç”Ÿç‰©å­¦å‘½å</span><br>rm(list=ls())<br>options(stringsAsFactorsÂ =Â F)<br>library(Seurat)<br>library(ggplot2)<br>library(clustree)<br>library(cowplot)<br>library(dplyr)<br>getwd()<br>sce.all=readRDS(Â <span>"../3-cell/sce.all_meta.rds"</span>)<br>sce.all<br><br>celltype=data.frame(ClusterID=0:17,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â celltype=Â 0:17)Â <br><br><span>#å®šä¹‰ç»†èƒäºšç¾¤Â </span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(0Â ,12Â ),2]=<span>'Tcells'</span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(Â 4Â ),2]=<span>'Bcells'</span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(Â 5),2]=<span>'plasma'</span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(Â 13Â ),2]=<span>'mast'</span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(Â 14Â ),2]=<span>'pDC'</span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(Â Â 11Â ),2]=<span>'fibroblast'</span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(Â 1,2,15Â Â ),2]=<span>'myeloids'</span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(Â 6,8,9,10,17Â ),2]=<span>'epithelium'</span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(Â 3,16Â ),2]=<span>'neutrophil'</span><br>celltype[celltype<span>$ClusterID</span>Â %<span>in</span>%Â c(Â 7Â ),2]=<span>'NK'</span><br><br><br>head(celltype)<br>celltype<br>table(celltype<span>$celltype</span>)<br><br>sce.all@meta.data<span>$celltype</span>Â =Â <span>"NA"</span><br><span>for</span>(iÂ <span>in</span>Â 1:nrow(celltype)){<br>Â Â sce.all@meta.data[<span>which</span>(sce.all@meta.data<span>$RNA_snn_res</span>.0.3Â ==Â celltype<span>$ClusterID</span>[i]),<span>'celltype'</span>]Â &lt;-Â celltype<span>$celltype</span>[i]}<br>table(sce.all@meta.data<span>$celltype</span>)<br><br><br>th=theme(axis.text.xÂ =Â element_text(angleÂ =Â 45,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â vjustÂ =Â 0.5,Â hjust=0.5))Â <br>library(patchwork)<br>p_umap=DimPlot(sce.all,Â reductionÂ =Â <span>"umap"</span>,colsÂ =Â col,pt.sizeÂ =Â 0.4,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â group.byÂ =Â <span>"celltype"</span>,labelÂ =Â T)Â <br>p+p_umap<br>ggsave(<span>'markers_umap_by_celltype_2.pdf'</span>,widthÂ =Â 15,heightÂ =Â 7)<br>saveRDS(sce.all,Â <span>"sce.all_celltype.rds"</span>)<br>phe=sce.all@meta.data<br>save(phe,fileÂ =Â <span>'phe-by-markers.Rdata'</span>)<br><br>colnames(phe)<br>table(sce.all<span>$Pathologic</span>)<br><br>pÂ =Â DimPlot(sce.all,Â reductionÂ =Â <span>"umap"</span>,split.byÂ =Â <span>'Pathologic'</span>,<br>Â Â Â Â Â Â Â Â group.byÂ =Â <span>"celltype"</span>,labelÂ =Â T)Â <br>install.packages(<span>'tidydr'</span>)<br>library(ggplot2)<br>library(tidydr)<br><br>pÂ &lt;-Â pÂ +Â theme_dr()<br>p<br><br>pÂ &lt;-Â pÂ +Â theme(panel.grid=element_blank())<br>p<br><br><br>load(<span>'sce-by-celltype.Rdata'</span>)<br>featuresÂ =Â c(<span>'PTPRC'</span>,<span>'KRT19'</span>,<span>'COL1A1'</span>,<span>'VWF'</span>,<span>'CD3E'</span>,<span>'CD79A'</span>,<span>'MS4A1'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'IGHG1'</span>,<span>'CSF3R'</span>,<span>'LYZ'</span>,<span>'FGFBP2'</span>,<span>'KIT'</span>,<span>'LILRA4'</span>,<span>'MKI67'</span>)<br>FeaturePlot(sce.all,featuresÂ =Â features,ncolÂ =Â 5Â )<br></code></pre><figure><img data-ratio="0.5462962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqicqrKt01qLibZe2Y2u3ibOPliciaPAiaNBN6ibZndXRK2Gia3oD8z94LRickBxQ/640?wx_fmt=png" data-type="png" data-w="1080" title="b06eab46ab71781192b811b09881c01.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqicqrKt01qLibZe2Y2u3ibOPliciaPAiaNBN6ibZndXRK2Gia3oD8z94LRickBxQ/640?wx_fmt=png"><figcaption>ä¸Šé¢çš„ä»£ç é‡Œé¢çš„æœ‰ä¸€äº›sourceæ­¥éª¤ï¼Œæ˜¯ä¾èµ–äºå¤–éƒ¨çš„scriptæ–‡ä»¶å¤¹é‡Œé¢çš„å‡ ä¸ªRä»£ç æ–‡ä»¶ã€‚ã€‚ã€‚è¯¦è§ï¼š<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247522953&amp;idx=1&amp;sn=9e86346a6de21d02bc0c770f3d2734a6&amp;chksm=9b4bda32ac3c5324d83bfc9f1601648626ad90c84eba1df8c782735c7a648351b03fddb69845&amp;scene=21#wechat_redirect" textvalue="å°é¼ çš„5ä¸ªæ ·å“çš„10xæŠ€æœ¯å•ç»†èƒè½¬å½•ç»„ä¸Šæ¸¸å®šé‡ï¼ˆæ–‡æœ«èµ é€å…¨å¥—ä»£ç ï¼‰" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">å°é¼ çš„5ä¸ªæ ·å“çš„10xæŠ€æœ¯å•ç»†èƒè½¬å½•ç»„ä¸Šæ¸¸å®šé‡ï¼ˆæ–‡æœ«èµ é€å…¨å¥—ä»£ç ï¼‰</a><br></figcaption><figcaption><br></figcaption></figure><pre><code><span>######Â step6:Â å•ç»†èƒäºšç¾¤æ¯”ä¾‹å·®å¼‚Â Â ######</span><br><span>##Â æ¯ç§ç»†èƒç±»å‹ä¸­ï¼Œåˆ†ç»„æ‰€å æ¯”ä¾‹Â ----</span><br>rm(list=ls())<br>options(stringsAsFactorsÂ =Â <span>F</span>)<br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br>getwd()<br>sce.all=readRDS(Â <span>"3-cell/sce.all_celltype.rds"</span>)<br>sce.all<br>phe=sce.all@meta.data<br><span>library</span>(tidyr)<span>#Â ä½¿ç”¨çš„gatherÂ &amp;Â spread</span><br><span>library</span>(reshape2)Â <span>#Â ä½¿ç”¨çš„å‡½æ•°Â meltÂ &amp;Â dcastÂ </span><br><br>colnames(phe)<br>tb=table(phe$celltype,<br>Â Â Â Â Â Â Â Â Â phe$patient)<br>head(tb)<br><span>library</span>Â (gplots)Â <br>balloonplot(tb)<br>bar_dataÂ &lt;-Â as.data.frame(tb)<br><br>bar_perÂ &lt;-Â bar_dataÂ %&gt;%Â <br>Â Â group_by(Var2)Â %&gt;%<br>Â Â mutate(sum(Freq))Â %&gt;%<br>Â Â mutate(percentÂ =Â FreqÂ /Â `sum(Freq)`)<br>head(bar_per)Â <br>write.csv(bar_per,fileÂ =Â <span>"celltype_by_group_percent.csv"</span>)<br>colÂ =c(<span>"#3176B7"</span>,<span>"#F78000"</span>,<span>"#3FA116"</span>,<span>"#CE2820"</span>,<span>"#9265C1"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>"#885649"</span>,<span>"#DD76C5"</span>,<span>"#7F7F7F"</span>,<span>"#BBBE00"</span>,<span>"#41BED1"</span>)<br>ggplot(bar_per,Â aes(xÂ =Â percent,Â yÂ =Â Var2))Â +<br>Â Â geom_bar(aes(fillÂ =Â Var1)Â ,Â statÂ =Â <span>"identity"</span>)Â +Â coord_flip()Â +<br>Â Â theme(axis.ticksÂ =Â element_line(linetypeÂ =Â <span>"blank"</span>),<br>Â Â Â Â Â Â Â Â legend.positionÂ =Â <span>"top"</span>,<br>Â Â Â Â Â Â Â Â panel.grid.minorÂ =Â element_line(colourÂ =Â <span>NA</span>,linetypeÂ =Â <span>"blank"</span>),Â <br>Â Â Â Â Â Â Â Â panel.backgroundÂ =Â element_rect(fillÂ =Â <span>NA</span>),<br>Â Â Â Â Â Â Â Â plot.backgroundÂ =Â element_rect(colourÂ =Â <span>NA</span>))Â +<br>Â Â labs(yÂ =Â <span>"%Â RelativeÂ cellÂ source"</span>,Â fillÂ =Â <span>NULL</span>)+labs(xÂ =Â <span>NULL</span>)+<br>Â Â scale_fill_manual(values=col)<br><br>ggsave(<span>"celltype_by_group_percent.pdf"</span>,<br>Â Â Â Â Â Â Â widthÂ =Â <span>8</span>,heightÂ =Â <span>4</span>)<br></code></pre><figure><img data-ratio="0.5509259259259259" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq7jqOF8hwca16uiafvsB0YkdjWrEG0xkV7ZGjUkhtbQNAs1npFsKK7gA/640?wx_fmt=png" data-type="png" data-w="1080" title="bdf88210b1d876a3906bd9e1c39f793.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq7jqOF8hwca16uiafvsB0YkdjWrEG0xkV7ZGjUkhtbQNAs1npFsKK7gA/640?wx_fmt=png"></figure><br>å†å°±æ˜¯ä¸åŒç—…ç†ç»“å±€ä¸­ç»†èƒäºšç¾¤çš„æ¯”ä¾‹<p><br></p><pre><code><span>###Figure1DÂ åˆ†ä¸ºæœªæ²»ç–—ç»„TNï¼Œå’Œæ²»ç–—ç»„ï¼ˆæ²»ç–—ç»„åˆåˆ†ä¸ºMPRå’ŒNMPRï¼‰</span><br>table(phe$celltype)<br>table(phe$patient)<br>phe$patientoutconeÂ =Â Â paste(phe$patient,phe$Pathologic,sepÂ =Â <span>'_'</span>)<br><br>phe_immuneÂ =Â phe[phe$celltypeÂ %in%Â c(<span>'Bcells'</span>,<span>'myeloids'</span>,<span>'neutrophil'</span>,<span>'NK'</span>,<span>'Tcells'</span>),]<br><br>tb=table(phe_immune$celltype,<br>Â Â Â Â Â Â Â Â Â phe_immune$patientoutcone)<br><br>head(tb)<br>balloonplot(tb)<br>bar_dataÂ &lt;-Â as.data.frame(tb)<br><br><br>bar_perÂ &lt;-Â bar_dataÂ %&gt;%Â <br>Â Â group_by(Var2)Â %&gt;%<br>Â Â mutate(sum(Freq))Â %&gt;%<br>Â Â mutate(percentÂ =Â FreqÂ /Â <span>`sum(Freq)`</span>)<br>head(bar_per)Â <br>bar_per$Var2<br>groupÂ =Â ifelse(str_detect(bar_per$Var2,<span>"TN"</span>),<span>"TN"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(bar_per$Var2,<span>"NMPR"</span>),<span>"NMPR"</span>,<span>"MPR"</span>))<br>bar_per$groupÂ =Â group<br><br>bar_per$groupÂ =Â factor(bar_per$group,levelsÂ =c(<span>"TN"</span>,<span>"MPR"</span>,<span>"NMPR"</span>))<br>table(bar_per$Var1)<br>bar_per$Var1Â =Â factor(bar_per$Var1,levelsÂ =c(<span>"Tcells"</span>,<span>"Bcells"</span>,<span>"NK"</span>,<span>'myeloids'</span>,<span>'neutrophil'</span>))<br><br><span>###æ‹¼æ¥äº”ä¸ªç®±çº¿å›¾</span><br>library(gridExtra)<br>pÂ &lt;-Â list()<br><br><span>for</span>(iÂ inÂ <span>1</span>:<span>5</span>){<br>Â Â <span>#Â é€‰æ‹©å½“å‰ç»†èƒç±»å‹çš„æ•°æ®</span><br>Â Â cellÂ &lt;-Â bar_per[bar_per$Var1Â ==Â unique(bar_per$Var1)[i],]<br><br>Â Â p[[i]]Â &lt;-Â ggplot(cell,Â aes(<span>x</span>Â =Â group,Â <span>y</span>Â =Â percent,Â fillÂ =Â group))Â +<br>Â Â Â Â geom_boxplot(sizeÂ =Â <span>0</span>.<span>5</span>,Â fillÂ =Â <span>"white"</span>,Â outlier.fillÂ =Â <span>"white"</span>,Â outlier.colorÂ =Â <span>"white"</span>,Â colorÂ =Â col)Â +<br>Â Â Â Â geom_jitter(aes(fillÂ =Â group),Â widthÂ =Â <span>0</span>.<span>2</span>,Â shapeÂ =Â <span>21</span>,Â sizeÂ =Â <span>2</span>)Â +<br>Â Â Â Â scale_fill_manual(<span>values</span>Â =Â col)Â +<br>Â Â Â Â ggtitle(paste<span>0</span>(unique(bar_per$Var1)[i],Â <span>"Â "</span>))Â +<br>Â Â Â Â theme_bw()Â +<br>Â Â Â Â theme(legend.positionÂ =Â <span>"none"</span>,<br>Â Â Â Â Â Â Â Â Â Â axis.text.xÂ =Â element_text(colourÂ =Â <span>"black"</span>,Â familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>),<br>Â Â Â Â Â Â Â Â Â Â axis.text.yÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>,Â faceÂ =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â Â Â axis.title.yÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>,Â faceÂ =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â Â Â axis.title.xÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>,Â faceÂ =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â Â Â plot.titleÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>15</span>,Â faceÂ =Â <span>"bold"</span>,Â hjustÂ =Â <span>0</span>.<span>5</span>),<br>Â Â Â Â Â Â Â Â Â Â panel.grid.majorÂ =Â element_blank(),<br>Â Â Â Â Â Â Â Â Â Â panel.grid.minorÂ =Â element_blank())Â +<br>Â Â Â Â ylab(<span>"FractionÂ (%)Â ofÂ immuneÂ cells"</span>)Â +Â xlab(<span>"Â "</span>)<br>Â Â <span>#Â ç§»é™¤yè½´æ ‡é¢˜å’Œåˆ»åº¦æ ‡ç­¾</span><br>Â Â p[[i]]Â &lt;-Â p[[i]]Â +Â theme(axis.title.yÂ =Â element_blank())<br>}<br><br>combined_plotÂ &lt;-Â grid.arrange(grobsÂ =Â p,Â ncolÂ =Â <span>5</span>,Â leftÂ =Â <span>"FractionÂ (%)Â ofÂ immuneÂ cells"</span>)Â <span>#Â è®¾ç½®å…±åŒçš„çºµè½´æ ‡é¢˜å’Œæ‹¼å›¾åˆ—æ•°</span><br><br><span>print</span>(combined_plot)<br></code></pre><figure><img data-ratio="0.3907407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqiaKibwy0hicbvD0QicZQICKMbFwGSBs4vg6xV40Vy7sg0oOCzCGTmlOn8w/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqiaKibwy0hicbvD0QicZQICKMbFwGSBs4vg6xV40Vy7sg0oOCzCGTmlOn8w/640?wx_fmt=png"></figure><br>å’Œæ–‡ä¸­æ¯”ä¾‹å˜åŒ–å¤§å¤šæ˜¯ä¸€è‡´çš„ï¼Œè¯ç‰©æ²»ç–—åMPRä¸­Tç»†èƒå’ŒBç»†èƒæ¯”ä¾‹å¢åŠ ï¼ˆæ–‡ä¸­è¿˜æœ‰NKç»†èƒï¼‰ï¼Œä¸­æ€§ç²’ç»†èƒå’Œé«“ç³»é™ä½ã€‚<p><br></p><h2><span>2.ä¸Šçš®ç»†èƒ</span></h2><figure><img data-ratio="0.8425925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq3wTQM5iaO5IDib2OL5aH1jACOqy4ich26rrRxhbhhZhn5GFwXn7l9Erog/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq3wTQM5iaO5IDib2OL5aH1jACOqy4ich26rrRxhbhhZhn5GFwXn7l9Erog/640?wx_fmt=png"></figure><pre><code><span>####EpithelialÂ cellé‡èšç±»####</span><br>rm(list=ls())<br>options(stringsAsFactorsÂ =Â F)<br>library(Seurat)<br>library(ggplot2)<br>library(clustree)<br>library(cowplot)<br>library(dplyr)<br>dir.create(<span>"4-subEpi"</span>)<br>setwd(<span>"4-subEpi"</span>)Â <br>getwd()<br>sce.all=readRDS(Â <span>"../3-cell/sce.all_celltype.rds"</span>)<br>sceÂ =Â sce.all<br>DefaultAssay(sce)Â &lt;-Â <span>"RNA"</span><br>table(sce$orig.ident)<br><br>table(sce$celltype)<br>sce2Â =Â sce[,Â sce$celltypeÂ %<span>in</span>%Â c(Â <span>'epithelium'</span>Â )]<br>table(sce2$celltype)<br>sceÂ =Â sce2<br>table(sce$patient,sce$celltype)<br>table(sce$medicine,sce$celltype)<br>table(sce$orig.ident)<br>Idents(sce)Â =Â sce$patient<br>sce=CreateSeuratObject(countsÂ =Â sce@assays$RNA@counts,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â meta.dataÂ =Â sce@meta.data)Â <br><br><br>sceÂ &lt;-Â NormalizeData(sce,Â normalization.methodÂ =Â Â <span>"LogNormalize"</span>,Â Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â scale.factorÂ =Â <span>1</span>e4)<br>GetAssay(sce,assayÂ =Â <span>"RNA"</span>)<br>sceÂ &lt;-Â FindVariableFeatures(sce,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â selection.methodÂ =Â <span>"vst"</span>,Â nfeaturesÂ =Â <span>2000</span>)Â Â <br>sceÂ &lt;-Â ScaleData(sce)Â <br>sceÂ &lt;-Â RunPCA(objectÂ =Â sce,Â pc.genesÂ =Â VariableFeatures(sce))Â <br>DimHeatmap(sce,Â dimsÂ =Â <span>1</span><span>:</span><span>12</span>,Â cellsÂ =Â <span>100</span>,Â balancedÂ =Â TRUE)<br>ElbowPlot(sce)Â <br><br>sceÂ &lt;-Â FindNeighbors(sce,Â dimsÂ =Â <span>1</span><span>:</span><span>15</span>)<br>sceÂ &lt;-Â FindClusters(sce,Â resolutionÂ =Â <span>0</span>.<span>1</span>)<br>table(sce@meta.data$RNA_snn_res.<span>0</span>.<span>1</span>)Â Â <br><br>set.seed(<span>123</span>)<br>sceÂ &lt;-Â RunTSNE(objectÂ =Â sce,Â dimsÂ =Â <span>1</span><span>:</span><span>15</span>,Â <span>do</span>.fastÂ =Â TRUE)<br>saveRDS(sce,sce.all,Â <span>"sce_epi.rds"</span>)<br><br><br>sceÂ &lt;-Â RunUMAP(objectÂ =Â sce,Â dimsÂ =Â <span>1</span><span>:</span><span>5</span>,Â <span>do</span>.fastÂ =Â TRUE)<br>DimPlot(sce,reductionÂ =Â <span>"umap"</span>,label=T)Â <br>head(sce@meta.data)<br>DimPlot(sce,reductionÂ =Â <span>"umap"</span>,label=T,group.byÂ =Â <span>'orig.ident'</span>)<br><br>mycolorsÂ &lt;-c(<span>'#E5D2DD'</span>,Â <span>'#53A85F'</span>,Â <span>'#F1BB72'</span>,Â <span>'#F3B1A0'</span>,Â <span>'#D6E7A3'</span>,Â <span>'#57C3F3'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#E95C59'</span>,Â <span>'#E59CC4'</span>,Â <span>'#AB3282'</span>,Â Â <span>'#BD956A'</span>,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#9FA3A8'</span>,Â <span>'#E0D4CA'</span>,Â Â <span>'#C5DEBA'</span>,Â <span>'#F7F398'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#C1E6F3'</span>,Â <span>'#6778AE'</span>,Â <span>'#91D0BE'</span>,Â <span>'#B53E2B'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#712820'</span>,Â <span>'#DCC1DD'</span>,Â <span>'#CCE0F5'</span>,Â Â <span>'#CCC9E6'</span>,Â <span>'#625D9E'</span>,Â <span>'#68A180'</span>,Â <span>'#3A6963'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#968175'</span>)<br>library(harmony)<br>table(sce$orig.ident)<br>seuratObjÂ &lt;-Â RunHarmony(sce,Â <span>"orig.ident"</span>)<br>names(seuratObj@reductions)<br>seuratObjÂ &lt;-Â RunUMAP(seuratObj,Â Â dimsÂ =Â <span>1</span><span>:</span><span>8</span>,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â reductionÂ =Â <span>"harmony"</span>)<br>DimPlot(seuratObj,reductionÂ =Â <span>"umap"</span>,label=TÂ )Â Â <br>library(patchwork)<br>library(RColorBrewer)<br>library(scales)<br>col4&lt;-colorRampPalette(brewer.pal(<span>8</span>,<span>'Set2'</span>))(<span>12</span>)<br>DimPlot(seuratObj,Â reductionÂ =Â <span>'umap'</span>,pt.sizeÂ =Â <span>2</span>,colsÂ =Â mycolors,labelÂ =Â T,group.byÂ =Â <span>"RNA_snn_res.0.1"</span>,label.sizeÂ =Â <span>6</span>,raster=FALSE)Â <br><br><br>sce=seuratObj<br>sceÂ &lt;-Â FindNeighbors(sce,Â reductionÂ =Â <span>"harmony"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dimsÂ =Â <span>1</span><span>:</span><span>5</span>)<br>sceÂ &lt;-Â FindClusters(sce,Â resolutionÂ =Â <span>0</span>.<span>5</span>)<br>table(sce@meta.data$seurat_clusters)<br>DimPlot(sce,reductionÂ =Â <span>"umap"</span>,label=T)Â <br><span>##å±…ç„¶å‘ç°è¿˜æ˜¯åŸå§‹é…è‰²å¥½çœ‹ç‚¹ï¼Œæˆ‘å“­æ­»</span><br>DimPlot(sce,Â reductionÂ =Â <span>'umap'</span>,pt.sizeÂ =Â <span>1</span>,labelÂ =Â T,group.byÂ =Â <span>"RNA_snn_res.0.5"</span>,label.sizeÂ =Â <span>6</span>,raster=FALSE)Â <br>ggsave(filenameÂ =Â <span>'harmony_umap_recluster_by_0.5.pdf'</span>,widthÂ =Â <span>7</span>,heightÂ =Â <span>7</span>)Â <br><br>col4&lt;-colorRampPalette(brewer.pal(<span>8</span>,<span>'Set2'</span>))(<span>15</span>)<br>sce$orig.ident<br>DimPlot(sce,Â reductionÂ =Â <span>'umap'</span>,pt.sizeÂ =Â <span>1</span>,colsÂ =Â col4,labelÂ =Â T,group.byÂ =Â <span>"patient"</span>,label.sizeÂ =Â <span>6</span>,raster=FALSE)Â <br>ggsave(filenameÂ =Â <span>'harmony_umap_sce_recluster_by_patient.pdf'</span>,widthÂ =Â <span>7</span>,heightÂ =Â <span>7</span>)Â <br><br><span>#####æ‚£è€…ä¹‹é—´çš„å·®å¼‚</span><br>DimPlot(sce,Â reductionÂ =Â <span>'umap'</span>,pt.sizeÂ =Â <span>1</span>,colsÂ =Â col4,labelÂ =Â T,split.byÂ =Â <span>'orig.ident'</span>,label.sizeÂ =Â <span>6</span>,raster=FALSE)Â <br>ggsave(filenameÂ =Â <span>'umap_sce_recluster_treatment.pdf'</span>,widthÂ =Â <span>10</span>,heightÂ =Â <span>6.5</span>)Â <br><br><span>###é…è‰²ä»€ä¹ˆçš„ï¼Œä¸é‡è¦å•¦ï¼Œå–œæ¬¢ä»€ä¹ˆé¢œè‰²å°±æ”¾ä»€ä¹ˆé¢œè‰²</span><br>saveRDS(sce,fileÂ =Â <span>"sce_epi.rds"</span>)<br><br><br><br><span>###copykatåŒºåˆ†è‚¿ç˜¤ç»†èƒå’Œæ­£å¸¸ç»†èƒ</span><br>devtools::install_github(<span>"navinlabcode/copykat"</span>)<br>library(<span>"copykat"</span>)Â <br><br>library(Seurat)<br>library(copykat)<br>library(tidyverse)<br>scRNAÂ &lt;-Â sce<br>countsÂ &lt;-Â as.matrix(scRNA@assays$RNA@counts)<br>table(scRNA$celltype)<br>cnvÂ &lt;-Â copykat(rawmat=counts,Â ngene.chr=<span>5</span>,Â sam.name=<span>"test"</span>,Â n.cores=<span>8</span>)<br><span># ngene.chrå‚æ•°æ˜¯è¿‡æ»¤ç»†èƒçš„ä¸€ä¸ªæ ‡å‡†ï¼Œå®ƒè¦æ±‚è¢«ç”¨æ¥åšCNVé¢„æµ‹çš„ç»†èƒï¼Œä¸€ä¸ªæŸ“è‰²ä½“ä¸Šè‡³å°‘æœ‰5ä¸ªåŸºå› ã€‚</span><br><span>#Â sam.nameå®šä¹‰æ ·æœ¬åç§°Â (sampleÂ name)ï¼Œä¼šç»™å‡ºæ¥çš„æ–‡ä»¶åŠ å‰ç¼€</span><br>saveRDS(cnv,Â <span>"cnv.rds"</span>)<br>table(rownames(cnv$CNAmat))<br>aÂ =Â cnv$prediction$copykat.pred<br>table(a)<br>scRNA$CopyKATÂ =Â a<br>p1Â &lt;-Â DimPlot(scRNA,Â group.byÂ =Â <span>"celltype"</span>,Â labelÂ =Â T)<br>p2Â &lt;-Â DimPlot(scRNA,Â group.byÂ =Â <span>"CopyKAT"</span>)Â +Â scale_color_manual(valuesÂ =Â c(<span>"#F8766D"</span>,<span>'#02BFC4'</span>,Â <span>"gray"</span>))<br>pcÂ &lt;-Â p1Â +Â p2<br>pc<br>ggsave(<span>"pred_mallignant.pdf"</span>,Â pc,Â widthÂ =Â <span>12</span>,Â heightÂ =Â <span>5</span>)<br><span>###è™½ç„¶è¿™é‡Œå¾—åˆ°ç»“æœäº†ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä¸Šé¢é€‰5æ•°å€¼å¤ªå¤§äº†ï¼Œä¹Ÿä¸æƒ³é‡æ–°è·‘ä¸€éå‡ å°æ—¶äº†....</span><br><br><br>colsÂ =Â c(<span>"gray"</span>,Â <span>"coral2"</span>)<br>plotÂ &lt;-Â FeaturePlot(scRNA,Â featuresÂ =Â c(<span>'AGER'</span>,<span>'SFTPA2'</span>,<span>'SCGB1A1'</span>,<span>'TPPP3'</span>,<span>'KRT17'</span>),colsÂ =Â cols,Â pt.sizeÂ =Â <span>1</span>)+Â Â <br>Â Â theme(panel.borderÂ =Â element_rect(fill=NA,color=<span>"black"</span>,Â size=<span>1</span>,Â linetype=<span>"solid"</span>))<span>#åŠ è¾¹æ¡†Â </span><br>plot_grid(p2,plot)<br><br><br><span>#####æ³¨é‡Šäºšç¾¤</span><br><span>#marker</span><br><span>#1. DSTï¼šå‚ä¸ç»†èƒéª¨æ¶çš„å½¢æˆå’Œç»´æŠ¤ï¼Œç»†èƒé™„ç€å’Œè¿ç§»çš„è°ƒèŠ‚ï¼Œè‚Œè‚‰æˆç†Ÿå’Œç¥ç»å…ƒå‘è‚²ç­‰è¿‡ç¨‹ã€‚</span><br><span>#2. KRT17ï¼šç¼–ç è§’è´¨å½¢æˆç»†èƒä¸­çš„ä¸€ç§è§’è›‹ç™½ï¼Œå‚ä¸ç»†èƒéª¨æ¶çš„å½¢æˆå’Œè§’è´¨å½¢æˆã€‚</span><br><span>#3. S100Pï¼šä¸é’™ç¦»å­ç»“åˆçš„è›‹ç™½è´¨ï¼Œå‚ä¸ç»†èƒå¢æ®–ã€è¿ç§»å’Œä¾µè¢­ç­‰ç”Ÿç‰©å­¦è¿‡ç¨‹ï¼Œä¹Ÿå¯èƒ½ä¸å¤šç§ç™Œç—‡çš„å‘ç”Ÿå’Œå‘å±•æœ‰å…³ã€‚</span><br><span>#4. PCNAï¼šæ˜¯ç»†èƒå‘¨æœŸä¸­SæœŸçš„ç»†èƒæ ¸è›‹ç™½ï¼Œåœ¨DNAå¤åˆ¶å’Œç»†èƒå¢æ®–è¿‡ç¨‹ä¸­èµ·é‡è¦ä½œç”¨ã€‚</span><br><span>#5. TOP2Aï¼šç¼–ç ä¸€ç§DNAæ‹“æ‰‘å¼‚æ„é…¶ï¼Œå‚ä¸DNAçš„è¶…èºæ—‹æ¾å¼›å’Œé‡è¿ï¼Œå½±å“DNAå¤åˆ¶å’Œç»†èƒåˆ†è£‚ã€‚</span><br><span>#6. SFTPA2ï¼šç¼–ç ä¸€ç§è‚ºè¡¨é¢æ´»æ€§ç‰©è´¨è›‹ç™½ï¼Œå‚ä¸è‚ºæ³¡çš„é˜²å¾¡å’Œå…ç–«åŠŸèƒ½ã€‚</span><br><span>#7. SPARCL1ï¼šç¼–ç ä¸€ç§åˆ†æ³Œè›‹ç™½ï¼Œå‚ä¸è‚¿ç˜¤æŠ‘åˆ¶ã€ç»†èƒè¿ç§»å’ŒåŸºè´¨é‡å¡‘ç­‰è¿‡ç¨‹ã€‚</span><br><span>#8. SERPINB9ï¼šç¼–ç ä¸€ç§ä¸æ°¨é…¸è›‹ç™½é…¶æŠ‘åˆ¶å‰‚ï¼Œå‚ä¸ç‚ç—‡è°ƒèŠ‚å’Œç»†èƒå‡‹äº¡ç­‰è¿‡ç¨‹ã€‚</span><br><span>#9. SCGB3A1ï¼šç¼–ç ä¸€ç§åˆ†æ³Œè›‹ç™½ï¼Œå¯èƒ½ä¸è‚ºéƒ¨åŸºåº•ç»†èƒçš„åˆ†åŒ–å’Œè‚ºå…ç–«åŠŸèƒ½æœ‰å…³ã€‚</span><br><span>#10. TPPP3ï¼šç¼–ç ä¸€ç§è°ƒèŠ‚å¾®ç®¡åŠ¨åŠ›å­¦çš„è›‹ç™½ï¼Œå¯èƒ½å‚ä¸ç»†èƒéª¨æ¶çš„é‡å¡‘å’Œç»†èƒè¿åŠ¨ç­‰ç”Ÿç‰©å­¦è¿‡ç¨‹ã€‚</span><br>genes_to_checkÂ =Â c(<span>'DST'</span>,Â <span>'AKR1B10'</span>,Â <span>'NDUFA4L2'</span>,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'KRT17'</span>Â ,Â <span>'CEACAM5'</span>,Â <span>'LY6G6C'</span>,Â <span>'KLK10'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'S100P'</span>,Â <span>'S100A9'</span>,Â <span>'MT2A'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'PCNA'</span>,Â <span>'TYMS'</span>,Â <span>'HIST1H2BJ'</span>,Â <span>'RRM2'</span>,<span>'DUT'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'TOP2A'</span>,Â <span>'TPX2'</span>,Â <span>'CENPF'</span>,<span>'ARL6IP1'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'SFTPA2'</span>,Â <span>'SFTPA1'</span>,Â <span>'SFTPB'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'SPARCL1'</span>Â ,<span>'IGKC'</span>,<span>'AL365357.1'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'SERPINB9'</span>,Â <span>'MYH11'</span>Â ,<span>'GJB6'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'SCGB3A1'</span>,<span>'MSMB'</span>,Â <span>'SCGB1A1'</span>,Â <span>'SLPI'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'TPPP3'</span>,<span>'CAPS'</span>,Â <span>'C9orf24'</span>,Â <span>'RSPH1'</span>)<br><br>library(stringr)Â Â <br>genes_to_check=str_to_upper(genes_to_check)<br>genes_to_check<br>pÂ &lt;-Â DotPlot(scRNA,Â featuresÂ =Â unique(genes_to_check),<br>Â Â Â Â Â Â Â Â Â Â Â Â Â assay=<span>'RNA'</span>Â Â )Â Â +Â coord_flip()<br><br>mycolorsÂ &lt;-c(<span>'#E5D2DD'</span>,Â <span>'#53A85F'</span>,Â <span>'#F1BB72'</span>,Â <span>'#F3B1A0'</span>,Â <span>'#D6E7A3'</span>,Â <span>'#57C3F3'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#E95C59'</span>,Â <span>'#E59CC4'</span>,Â <span>'#AB3282'</span>,Â Â <span>'#BD956A'</span>,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#9FA3A8'</span>,Â <span>'#E0D4CA'</span>,Â Â <span>'#C5DEBA'</span>,Â <span>'#F7F398'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#C1E6F3'</span>,Â <span>'#6778AE'</span>,Â <span>'#91D0BE'</span>,Â <span>'#B53E2B'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#712820'</span>,Â <span>'#DCC1DD'</span>,Â <span>'#CCE0F5'</span>,Â Â <span>'#CCC9E6'</span>,Â <span>'#625D9E'</span>,Â <span>'#68A180'</span>,Â <span>'#3A6963'</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>'#968175'</span>)<br><br>p_umap=DimPlot(scRNA,Â reductionÂ =Â <span>"umap"</span>,colsÂ =Â mycolors,pt.sizeÂ =Â <span>0</span>.<span>4</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â group.byÂ =Â <span>"RNA_snn_res.0.5"</span>,labelÂ =Â T,label.boxÂ =Â T)Â <br>p_umap<br>library(patchwork)<br>p+p_umap<br>ggsave(<span>'markers_umap_2.pdf'</span>,widthÂ =Â <span>13</span>,heightÂ =Â <span>8</span>)<br><br><span>#####ç»†èƒç”Ÿç‰©å­¦å‘½å</span><br>celltype=data.frame(ClusterID=<span>0</span><span>:</span><span>13</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â celltype=Â <span>0</span><span>:</span><span>13</span>)Â <br><br><span>#å®šä¹‰ç»†èƒäºšç¾¤Â </span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(Â <span>0</span>Â ),<span>2</span>]=<span>'E0_DST'</span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(Â <span>9</span>Â ),<span>2</span>]=<span>'E1_KRT17'</span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(<span>4</span>,<span>6</span>,<span>10</span>,<span>13</span>Â ),<span>2</span>]=<span>'E2_S100P'</span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(<span>2</span>Â Â ),<span>2</span>]=<span>'E3_PCNA'</span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(Â <span>7</span>Â ),<span>2</span>]=<span>'E4_TOP2A'</span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(Â <span>5</span>,<span>12</span>Â ),<span>2</span>]=<span>'E5_SFTPA2'</span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(Â <span>3</span>Â ),<span>2</span>]=<span>'E6_SPARCL1'</span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(Â <span>8</span>Â ),<span>2</span>]=<span>'E7_SERPINB9'</span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(<span>1</span>Â ),<span>2</span>]=<span>'E8_SCGB3A1'</span><br>celltype[celltype$ClusterIDÂ %<span>in</span>%Â c(Â <span>11</span>),<span>2</span>]=<span>'E9_TPPP3'</span><br><br><br>head(celltype)<br>celltype<br>table(celltype$celltype)<br><br>scRNA@meta.data$celltypeÂ =Â <span>"NA"</span><br><span>for</span>(iÂ <span>in</span>Â <span>1</span><span>:nrow</span>(celltype)){<br>Â Â scRNA@meta.data[which(scRNA@meta.data$RNA_snn_res.<span>0</span>.<span>5</span>Â ==Â celltype$ClusterID[i]),<span>'celltype'</span>]Â &lt;-Â celltype$celltype[i]}<br>table(scRNA@meta.data$celltype)<br><br><br>th=theme(axis.text.xÂ =Â element_text(angleÂ =Â <span>45</span>,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â vjustÂ =Â <span>0</span>.<span>5</span>,Â hjust=<span>0</span>.<span>5</span>))Â <br>library(patchwork)<br>p_umap=DimPlot(scRNA,Â reductionÂ =Â <span>"umap"</span>,colsÂ =Â mycolors,pt.sizeÂ =Â <span>0</span>.<span>4</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â group.byÂ =Â <span>"celltype"</span>,labelÂ =Â T)Â <br>p+p_umap<br>ggsave(<span>'markers_umap_by_celltype_2.pdf'</span>,widthÂ =Â <span>15</span>,heightÂ =Â <span>7</span>)<br>saveRDS(scRNA,Â <span>"sce.epi_celltype.rds"</span>)<br></code></pre><figure><img data-ratio="0.46111111111111114" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqxEVMMrKOBsMeANu6jsZSJ2bLfGoATiam1icnqWMgXKibnlXK4wqzmSkAQ/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqxEVMMrKOBsMeANu6jsZSJ2bLfGoATiam1icnqWMgXKibnlXK4wqzmSkAQ/640?wx_fmt=png"></figure><br>å¯ä»¥çœ‹å‡ºE2ï¼Œ5ï¼Œ8ï¼Œ9äºšç¾¤æ¶æ€§ç»†èƒç¾¤è¾ƒå°‘æˆ–æ²¡æœ‰<br><figure><img data-ratio="0.5351851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqHfdUcugmqQYRE30zibL8zxRv5prw9Jeg28hjfAC3WsIdQMSNkzhcxKw/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqHfdUcugmqQYRE30zibL8zxRv5prw9Jeg28hjfAC3WsIdQMSNkzhcxKw/640?wx_fmt=png"></figure><pre><code><span>######åŸºå› åœ¨ä¸åŒç—…ç†ç»“å±€çš„æ‚£è€…ä¸­è¡¨è¾¾æƒ…å†µ</span><br>rm(<span>list</span>=ls())<br>scRNA=readRDS(Â <span>"sce.epi_celltype.rds"</span>)<br>scRNA<br>table(scRNA$CopyKAT)<br><span>##åœ¨è¿™é‡Œæˆ‘æŸ¥çœ‹äº†åŠ å…¥æ— æ³•åˆ†ç±»çš„ç»†èƒå’ŒæœªåŠ å…¥æ— æ³•åˆ†ç±»çš„ç»†èƒï¼Œå·®åˆ«è¿˜æŒºå¤§çš„</span><br><span>#åŠ å…¥ï¼šCX3CL1è¶‹åŠ¿ä¸å¯¹ï¼ŒAKR1C3è¶‹åŠ¿æ­£ç¡®</span><br><span>#ä¸åŠ å…¥ï¼šCX3CL1è¶‹åŠ¿æ­£ç¡®ï¼ŒAKR1C3è¶‹åŠ¿ä¸å¯¹</span><br><br><br>sce_objÂ =Â scRNA[,Â scRNA$CopyKATÂ %in%Â c(Â <span>'aneuploid'</span>)]<br>sce_obj$patientoutconeÂ =Â Â paste(sce_obj$patient,sce_obj$Pathologic,sepÂ =Â <span>'_'</span>)<br><br><br><span>#Â é€šè¿‡Seuratçš„AverageExpressionå‡½æ•°è®¡ç®—æ¯ä¸ªæ‚£è€…åŸºå› çš„å¹³å‡è¡¨è¾¾é‡</span><br>avgÂ &lt;-Â AverageExpression(objectÂ =Â sce_obj,Â assayÂ =Â <span>"RNA"</span>,Â group.byÂ =Â <span>"patientoutcone"</span>)<br>aÂ =Â avg$RNA<br><br><br>C1Â =Â c(<span>'CX3CL1'</span>,<span>'CD74'</span>,<span>'HLA-DRA'</span>)<br>D1Â =Â c(<span>'AKR1C1'</span>,<span>'AKR1C2'</span>,<span>'AKR1C3'</span>)<br><span>#è¿™å…­ä¸ªåŸºå› çš„ç”Ÿç‰©å­¦æ„ä¹‰å¦‚ä¸‹ï¼š</span><br><span>#1. CX3CL1æ˜¯ä¸€ç§ç»†èƒå› å­ï¼Œä¹Ÿè¢«ç§°ä¸ºç¥ç»å†…çš®ç‚æ€§å› å­1ï¼ˆN-TACï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§è¶‹åŒ–å› å­ï¼Œåœ¨ç‚ç—‡å’Œå…ç–«ååº”ä¸­èµ·ç€é‡è¦ä½œç”¨ã€‚å®ƒä¸å…ç–«ç»†èƒçš„è¿ç§»å’Œç‚ç—‡ååº”ç›¸å…³ï¼ŒåŒæ—¶ä¹Ÿå‚ä¸ç¥ç»å‘è‚²å’Œç¥ç»ä¿æŠ¤ã€‚</span><br><span>#2. CD74æ˜¯ä¸€ç§ç»†èƒè†œè›‹ç™½ï¼Œä¹Ÿè¢«ç§°ä¸ºç±»åˆ«IIè½¬è¿åˆ†å­ç»†èƒè†œå…³è”è›‹ç™½ã€‚CD74ä¸æŠ—åŸå‘ˆé€’ã€å…ç–«è°ƒèŠ‚å’Œç»†èƒä¿¡å·ä¼ å¯¼ç­‰å…ç–«åŠŸèƒ½å¯†åˆ‡ç›¸å…³ã€‚å®ƒåœ¨æŠ—åŸå¤„ç†å’Œé€’å‘ˆçš„è¿‡ç¨‹ä¸­èµ·é‡è¦ä½œç”¨ï¼Œå¹¶åœ¨å…ç–«ç»†èƒè¯†åˆ«ã€ç‚ç—‡å’Œå…ç–«ååº”ä¸­å‘æŒ¥å…³é”®ä½œç”¨ã€‚</span><br><span>#3. HLA-DRAï¼ˆHuman Leukocyte Antigen-DR Î± chainï¼‰ï¼šHLA-DRAæ˜¯äººç™½ç»†èƒæŠ—åŸ-DRï¼ˆHLA-DRï¼‰çš„Î±é“¾ã€‚HLA-DRæ˜¯ä¸€ç§MHCç±»IIå¤åˆç‰©ï¼Œè´Ÿè´£å‘ˆé€’å¤–æºæ€§æŠ—åŸç»™Tç»†èƒï¼Œä»è€Œè§¦å‘å…ç–«ååº”ã€‚HLA-DRAä¸å…ç–«ç³»ç»Ÿçš„æŠ—åŸé€’å‘ˆã€Tç»†èƒçš„æ¿€æ´»å’Œè°ƒèŠ‚å¯†åˆ‡ç›¸å…³ï¼Œåœ¨å…ç–«é€”å¾„ä¸­å‘æŒ¥é‡è¦ä½œç”¨ã€‚</span><br><span>#4. AKR1C1å±äºé†›é…®è¿˜åŸé…¶å®¶æ—çš„ä¸€å‘˜ã€‚å®ƒæ˜¯ä¸€ç§è„±æ°¢é…¶ï¼Œå¯¹å¤šç§å†…æºæ€§å’Œå¤–æºæ€§åŒ–åˆç‰©å…·æœ‰è¿˜åŸæ´»æ€§ã€‚AKR1C1å‚ä¸ç¾é…®ã€å­•é…®ç­‰æ¿€ç´ çš„ä»£è°¢è½¬åŒ–ï¼ŒåŒæ—¶è¿˜å‚ä¸æŠ—æ°§åŒ–å’ŒæŠ—ç‚è¿‡ç¨‹ã€‚</span><br><span>#5. AKR1C2ä¹Ÿæ˜¯é†›é…®è¿˜åŸé…¶å®¶æ—çš„æˆå‘˜ï¼Œä¸AKR1C1å…·æœ‰ç›¸ä¼¼çš„é…¶æ´»æ€§ã€‚å®ƒåœ¨å¤šç§ç”Ÿç‰©å­¦è¿‡ç¨‹ä¸­å‘æŒ¥é‡è¦ä½œç”¨ï¼ŒåŒ…æ‹¬æ¿€ç´ ä»£è°¢ã€æŠ—æ°§åŒ–ã€æŠ—ç‚å’Œç¥ç»ä¿æŠ¤ã€‚</span><br><span>#6. AKR1C3æ˜¯é†›é…®è¿˜åŸé…¶å®¶æ—çš„ä¸€å‘˜ï¼Œä¸AKR1C1å’ŒAKR1C2å…·æœ‰ç›¸ä¼¼çš„é…¶æ´»æ€§ã€‚å®ƒå‚ä¸ç¾é…®ã€é›„æ¿€ç´ å’Œå­•æ¿€ç´ çš„ä»£è°¢è½¬åŒ–ï¼ŒåŒæ—¶è¿˜å…·æœ‰æŠ—æ°§åŒ–å’ŒæŠ—ç‚æ´»æ€§ã€‚åœ¨æŸäº›ç™Œç—‡ä¸­ï¼ŒAKR1C3çš„è¿‡åº¦è¡¨è¾¾ä¸æŠ—è¯æ€§å’Œè‚¿ç˜¤çš„æ¶æ€§è¿›å±•æœ‰å…³ã€‚</span><br>gene_boxplotÂ &lt;-Â <span><span>function</span><span>(gene)</span></span>{<br>Â Â bÂ =Â <span>as</span>.data.frame(a[gene,])<br>Â Â colnames(b)Â =Â gene<br>Â Â pheÂ =Â b<br>Â Â groupÂ =Â ifelse(str_detect(rownames(phe),<span>"TN"</span>),<span>"TN"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(rownames(phe),<span>"NMPR"</span>),<span>"NMPR"</span>,<span>"MPR"</span>))<br>Â Â phe$groupÂ =Â group<br><br>Â Â phe$groupÂ =Â factor(phe$group,levelsÂ =c(<span>"TN"</span>,<span>"MPR"</span>,<span>"NMPR"</span>))<br>Â Â table(phe$group)<br>Â Â colnames(phe)<br><br>Â Â colÂ =Â c(<span>"#508E42"</span>,Â <span>"#DF5E38"</span>,<span>"#7B7DC4"</span>)<br>Â Â P_TÂ &lt;-Â ggplot(phe,aes(x=group,y=!!rlang::sym(gene),fill=group))Â +<br>Â Â Â Â geom_boxplot(size=<span>0.5</span>,fill=<span>"white"</span>,outlier.fill=<span>"white"</span>,outlier.color=<span>"white"</span>,color=col)Â +<br>Â Â Â Â geom_jitter(aes(fill=group),widthÂ =<span>0.2</span>,shapeÂ =Â <span>21</span>,size=<span>2</span>)Â +<br>Â Â Â Â scale_fill_manual(valuesÂ =Â col)+<br>Â Â Â Â ggtitle(gene)Â +<br>Â Â Â Â theme_bw()Â +<br>Â Â Â Â theme(panel.gridÂ =Â element_blank(),Â panel.backgroundÂ =Â element_blank(),<br>Â Â Â Â Â Â Â Â Â Â axis.lineÂ =Â element_line(colorÂ =Â <span>'black'</span>))Â +<br>Â Â Â Â ylab(<span>"AverageÂ signatureÂ score"</span>)Â +xlab(<span>"Â "</span>)+<br>Â Â Â Â theme(legend.positionÂ =Â <span>"none"</span>,<br>Â Â Â Â Â Â Â Â Â Â axis.text.xÂ =Â element_text(colourÂ =Â <span>"black"</span>,Â familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>),<br>Â Â Â Â Â Â Â Â Â Â axis.text.yÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>,Â faceÂ =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â Â Â axis.title.yÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>,Â faceÂ =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â Â Â axis.title.xÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>,Â faceÂ =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â Â Â plot.titleÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>17</span>,Â faceÂ =Â <span>"bold"</span>,Â hjustÂ =Â <span>0.5</span>),<br>Â Â Â Â Â Â Â Â Â Â panel.grid.majorÂ =Â element_blank(),<br>Â Â Â Â Â Â Â Â Â Â panel.grid.minorÂ =Â element_blank(),<br>Â Â Â Â Â Â Â Â Â Â panel.borderÂ =Â element_blank())<br><br>Â Â P_T<br>Â Â compairedÂ =Â <span>list</span>(c(<span>"TN"</span>,Â <span>"MPR"</span>),<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â c(<span>"TN"</span>,Â <span>"NMPR"</span>))<br>Â Â P_TÂ =Â P_T+geom_signif(comparisonsÂ =Â compaired,step_increaseÂ =Â <span>0.1</span>,map_signif_levelÂ =Â T,testÂ =Â t.test,tip_lengthÂ =Â <span>0</span>)<br>Â Â P_T<br><br>}<br><br>P_C1Â =Â gene_boxplot(C1[<span>1</span>])+gene_boxplot(C1[<span>2</span>])+gene_boxplot(C1[<span>3</span>])<br>P_D1Â =Â gene_boxplot(D1[<span>1</span>])+gene_boxplot(D1[<span>2</span>])+gene_boxplot(D1[<span>3</span>])<br><br>P_C1/P_D1<br><span>###æ–‡ä¸­ä¸»è¦æ˜¯çœ‹äº†ä¸¤ä¸ªåŸºå› çš„å˜åŒ–ï¼ŒCX3CL1åœ¨MPRçš„æ‚£è€…ä¸­ä¸Šè°ƒï¼ŒAKR1C3åœ¨NMPRçš„æ‚£è€…ä¸­ä¸Šè°ƒ</span><br>ggsave(<span>'gene_outcome.pdf'</span>,widthÂ =Â <span>13</span>,heightÂ =Â <span>8</span>)<br>saveRDS(sce_obj,Â <span>"sce.cancer_celltype.rds"</span>)<br></code></pre><figure><img data-ratio="0.5925925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqlGS79MRljibcr2VDMpAdDmmicCKq9XemLmVCpic0RZ0ELtPdlogZPLEqA/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqlGS79MRljibcr2VDMpAdDmmicCKq9XemLmVCpic0RZ0ELtPdlogZPLEqA/640?wx_fmt=png"></figure><pre><code><span>###GSVAåˆ†æ<br>rm(list=ls())<br>sce.all=readRDS(Â "sce.cancer_celltype.rds")<br><br>scRNAÂ <span>&lt;<span>-</span>Â <span>sce.all</span><br><span>library</span>(<span>msigdbr</span>)<br><span>library</span>(<span>GSVA</span>)<br><span>library</span>(<span>Seurat</span>)<br>#é€‰æ‹©åŸºå› é›†<br><span>Idents</span>(<span>scRNA</span>)Â =Â <span>scRNA$patientoutcone</span><br>#<span>Idents</span>è®¾ç½®æŒ‰ä»€ä¹ˆæ¥å–ç»„çš„è¡¨è¾¾å‡å€¼ï¼ˆè®¡ç®—<span>case</span>Â <span>control</span>ä¹‹é—´çš„å‡å€¼ä¹Ÿå¯ä»¥ï¼‰<br><span>expr</span>Â &lt;<span>-</span>Â <span>AverageExpression</span>(<span>scRNA</span>,Â <span>assays</span>Â =Â <span>"RNA"</span>,Â <span>slot</span>Â =Â <span>"data"</span>)[[<span>1</span>]]<br><span>expr</span>Â &lt;<span>-</span>Â <span>expr</span>[<span>rowSums</span>(<span>expr</span>)&gt;</span>0,]Â Â #é€‰å–éé›¶åŸºå› <br>exprÂ <span>&lt;<span>-</span>Â <span>as.matrix</span>(<span>expr</span>)<br><span>library</span>(<span>GSEABase</span>)<br><br><span>gmt</span>Â &lt;<span>-</span>Â '<span>msigdb_v2023.1.Hs_files_to_download_locally</span>/<span>msigdb_v2023.1.Hs_files_to_download_locally</span>/<span>msigdb_v2023.1.Hs_GMTs</span>/<span>h.all.v2023.1.Hs.symbols.gmt</span>'<br><span>geneSet</span>Â &lt;<span>-</span>Â <span>getGmt</span>(<span>gmt</span>)<br>#Â <span>gsva</span>(è‹¥ä¸º<span>count</span>çŸ©é˜µï¼Œ<span>kcdf</span>Â =Â <span>'Poisson'</span>ï¼Œè‹¥ä¸ºå…¶ä»–æ ‡å‡†åŒ–åçš„æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤å‚æ•°å³å¯)<br><span>gsva_scores</span>Â &lt;<span>-</span>Â <span>gsva</span>(<span>expr</span>,<span>geneSet</span>,<span>method</span>Â =Â <span>'gsva'</span>,<span>min.sz</span>=<span>5,max.sz</span>=<span>500,kcdf</span>Â =Â <span>'Poisson'</span>)<br><span>head</span>(<span>gsva_scores</span>)<br><span>gsva_scores</span>Â =Â <span>as.data.frame(gsva_scores)</span><br><br><span>library</span>(<span>stringr</span>)<br><span>library</span>(<span>ggplot2</span>)<br><span>library</span>(<span>ggsignif</span>)<br><span>b</span>Â =Â <span>as.data.frame(t(gsva_scores[</span>'<span>HALLMARK_ESTROGEN_RESPONSE_LATE</span>',]))<br><span>colnames</span>(<span>b</span>)Â =Â <span>'EstrogenÂ responseÂ late'</span><br><span>phe</span>Â =Â <span>b</span><br><span>group</span>Â =Â <span>ifelse(str_detect(rownames(phe),</span>"<span>TN</span>"),"<span>TN</span>",<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>ifelse</span>(<span>str_detect</span>(<span>rownames</span>(<span>phe</span>),"<span>NMPR</span>"),"<span>NMPR</span>","<span>MPR</span>"))<br><span>phe</span>$<span>group</span>Â =Â <span>group</span><br><br><span>phe</span>$<span>group</span>Â =Â <span>factor(phe$group,levels</span>Â =<span>c(</span>"<span>TN</span>","<span>MPR</span>","<span>NMPR</span>"))<br><span>table</span>(<span>phe</span>$<span>group</span>)<br><span>colnames</span>(<span>phe</span>)<br><br><span>col</span>Â =Â <span>c(</span>"#<span>508E42</span>",Â "#<span>DF5E38</span>","#<span>7B7DC4</span>")<br><span>pathway</span>Â =Â <span>'EstrogenÂ responseÂ late'</span><br><span>P_T</span>Â &lt;<span>-</span>Â <span>ggplot</span>(<span>phe</span>,<span>aes</span>(<span>x</span>=<span>group,y</span>=<span>!!rlang::sym(pathway),fill</span>=<span>group))</span>Â +<br>Â Â <span>geom_boxplot</span>(<span>size</span>=<span>0.5,fill</span>=<span>"white"</span>,<span>outlier.fill</span>=<span>"white"</span>,<span>outlier.color</span>=<span>"white"</span>,<span>color</span>=<span>col)</span>Â +<br>Â Â <span>geom_jitter</span>(<span>aes</span>(<span>fill</span>=<span>group),width</span>Â =<span>0.2,shape</span>Â =Â <span>21,size</span>=<span>2)</span>Â +<br>Â Â <span>scale_fill_manual</span>(<span>values</span>Â =Â <span>col)+</span><br>Â Â <span>ggtitle</span>(<span>pathway</span>)Â +<br>Â Â <span>theme_bw</span>()Â +<br>Â Â <span>theme</span>(<span>panel.grid</span>Â =Â <span>element_blank(),</span>Â <span>panel.background</span>Â =Â <span>element_blank(),</span><br>Â Â Â Â Â Â Â Â <span>axis.line</span>Â =Â <span>element_line(color</span>Â =Â <span>'black'</span>))Â +<br>Â Â <span>ylab</span>("<span>Average</span>Â <span>signature</span>Â <span>score</span>")Â +<span>xlab</span>("Â ")+<br>Â Â <span>theme</span>(<span>legend.position</span>Â =Â <span>"none"</span>,<br>Â Â Â Â Â Â Â Â <span>axis.text.x</span>Â =Â <span>element_text(colour</span>Â =Â <span>"black"</span>,Â <span>family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14),</span><br>Â Â Â Â Â Â Â Â <span>axis.text.y</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14,</span>Â <span>face</span>Â =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â <span>axis.title.y</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14,</span>Â <span>face</span>Â =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â <span>axis.title.x</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14,</span>Â <span>face</span>Â =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â <span>plot.title</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>17,</span>Â <span>face</span>Â =Â <span>"bold"</span>,Â <span>hjust</span>Â =Â <span>0.5),</span><br>Â Â Â Â Â Â Â Â <span>panel.grid.major</span>Â =Â <span>element_blank(),</span><br>Â Â Â Â Â Â Â Â <span>panel.grid.minor</span>Â =Â <span>element_blank(),</span><br>Â Â Â Â Â Â Â Â <span>panel.border</span>Â =Â <span>element_blank())</span><br><br><span>P_T</span><br><span>compaired</span>Â =Â <span>list(c(</span>"<span>TN</span>",Â "<span>MPR</span>"),<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>c</span>("<span>TN</span>",Â "<span>NMPR</span>"))<br><span>P_T</span>Â =Â <span>P_T+geom_signif(comparisons</span>Â =Â <span>compaired,step_increase</span>Â =Â <span>0.1,map_signif_level</span>Â =Â <span>T,test</span>Â =Â <span>t.test,tip_length</span>Â =Â <span>0)</span><br><span>P_T</span><br><br><br><span>gmt</span>Â &lt;<span>-</span>Â '<span>msigdb_v2023.1.Hs_GMTs</span>/<span>c5.go.bp.v2023.1.Hs.symbols.gmt</span>'<br><span>geneSet</span>Â &lt;<span>-</span>Â <span>getGmt</span>(<span>gmt</span>)<br>#Â <span>gsva</span>(è‹¥ä¸º<span>count</span>çŸ©é˜µï¼Œ<span>kcdf</span>Â =Â <span>'Poisson'</span>ï¼Œè‹¥ä¸ºå…¶ä»–æ ‡å‡†åŒ–åçš„æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤å‚æ•°å³å¯)<br><span>gsva_scores</span>Â &lt;<span>-</span>Â <span>gsva</span>(<span>expr</span>,<span>geneSet</span>,<span>method</span>Â =Â <span>'gsva'</span>,<span>min.sz</span>=<span>5,max.sz</span>=<span>500,kcdf</span>Â =Â <span>'Poisson'</span>)<br><span>head</span>(<span>gsva_scores</span>)<br><span>gsva_scores</span>Â =Â <span>as.data.frame(gsva_scores)</span><br><br><br><span>library</span>(<span>stringr</span>)<br><span>library</span>(<span>ggplot2</span>)<br><span>library</span>(<span>ggsignif</span>)<br><span>b</span>Â =Â <span>as.data.frame(t(gsva_scores[</span>'<span>GOBP_ANTIGEN_PROCESSING_AND_PRESENTATION_OF_PEPTIDE_OR_POLYSACCHARIDE_ANTIGEN_VIA_MHC_CLASS_II</span>',]))<br><span>colnames</span>(<span>b</span>)Â =Â <span>'AntigenÂ presentationÂ viaÂ MHC-II'</span><br><span>phe</span>Â =Â <span>b</span><br><span>group</span>Â =Â <span>ifelse(str_detect(rownames(phe),</span>"<span>TN</span>"),"<span>TN</span>",<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>ifelse</span>(<span>str_detect</span>(<span>rownames</span>(<span>phe</span>),"<span>NMPR</span>"),"<span>NMPR</span>","<span>MPR</span>"))<br><span>phe</span>$<span>group</span>Â =Â <span>group</span><br><br><span>phe</span>$<span>group</span>Â =Â <span>factor(phe$group,levels</span>Â =<span>c(</span>"<span>TN</span>","<span>MPR</span>","<span>NMPR</span>"))<br><span>table</span>(<span>phe</span>$<span>group</span>)<br><span>colnames</span>(<span>phe</span>)<br><br><span>col</span>Â =Â <span>c(</span>"#<span>508E42</span>",Â "#<span>DF5E38</span>","#<span>7B7DC4</span>")<br><span>pathway</span>Â =Â <span>'AntigenÂ presentationÂ viaÂ MHC-II'</span><br><span>P_T</span>Â &lt;<span>-</span>Â <span>ggplot</span>(<span>phe</span>,<span>aes</span>(<span>x</span>=<span>group,y</span>=<span>!!rlang::sym(pathway),fill</span>=<span>group))</span>Â +<br>Â Â <span>geom_boxplot</span>(<span>size</span>=<span>0.5,fill</span>=<span>"white"</span>,<span>outlier.fill</span>=<span>"white"</span>,<span>outlier.color</span>=<span>"white"</span>,<span>color</span>=<span>col)</span>Â +<br>Â Â <span>geom_jitter</span>(<span>aes</span>(<span>fill</span>=<span>group),width</span>Â =<span>0.2,shape</span>Â =Â <span>21,size</span>=<span>2)</span>Â +<br>Â Â <span>scale_fill_manual</span>(<span>values</span>Â =Â <span>col)+</span><br>Â Â <span>ggtitle</span>(<span>pathway</span>)Â +<br>Â Â <span>theme_bw</span>()Â +<br>Â Â <span>theme</span>(<span>panel.grid</span>Â =Â <span>element_blank(),</span>Â <span>panel.background</span>Â =Â <span>element_blank(),</span><br>Â Â Â Â Â Â Â Â <span>axis.line</span>Â =Â <span>element_line(color</span>Â =Â <span>'black'</span>))Â +<br>Â Â <span>ylab</span>("<span>Average</span>Â <span>signature</span>Â <span>score</span>")Â +<span>xlab</span>("Â ")+<br>Â Â <span>theme</span>(<span>legend.position</span>Â =Â <span>"none"</span>,<br>Â Â Â Â Â Â Â Â <span>axis.text.x</span>Â =Â <span>element_text(colour</span>Â =Â <span>"black"</span>,Â <span>family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14),</span><br>Â Â Â Â Â Â Â Â <span>axis.text.y</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14,</span>Â <span>face</span>Â =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â <span>axis.title.y</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14,</span>Â <span>face</span>Â =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â <span>axis.title.x</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14,</span>Â <span>face</span>Â =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â <span>plot.title</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>17,</span>Â <span>face</span>Â =Â <span>"bold"</span>,Â <span>hjust</span>Â =Â <span>0.5),</span><br>Â Â Â Â Â Â Â Â <span>panel.grid.major</span>Â =Â <span>element_blank(),</span><br>Â Â Â Â Â Â Â Â <span>panel.grid.minor</span>Â =Â <span>element_blank(),</span><br>Â Â Â Â Â Â Â Â <span>panel.border</span>Â =Â <span>element_blank())</span><br><br><span>P_T</span><br><span>compaired</span>Â =Â <span>list(c(</span>"<span>TN</span>",Â "<span>MPR</span>"),<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>c</span>("<span>TN</span>",Â "<span>NMPR</span>"))<br><span>P_T</span>Â =Â <span>P_T+geom_signif(comparisons</span>Â =Â <span>compaired,step_increase</span>Â =Â <span>0.1,map_signif_level</span>Â =Â <span>T,test</span>Â =Â <span>t.test,tip_length</span>Â =Â <span>0)</span><br><span>P_T</span><br></span></span></code></pre><p>MHC-IIç¡®å®æ˜¯åœ¨MPRçš„æ‚£è€…ä¸­ä¸Šè°ƒäº†ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ç« ç«‹è¶³ä¹‹æ ¹æœ¬çš„é›Œæ¿€ç´ ååº”å¯¹ä¸ä¸Šï¼Œå®åœ¨æ˜¯å¯¹ä¸ä¸Šå•Šã€‚<br><span><strong>ï¼ˆPS: åŸ‹å¤´è‹¦å¹²ä¸‰ä¸ªå°æ—¶äº†ï¼Œæ­¤æ—¶æˆ‘æ­£åœ¨çœ‹ç€æ¥¼ä¸‹çš„äººåœ¨å°æ¹–è¾¹é’“é±¼ï¼Œå¥½æƒ³å»çœ‹ğŸ˜¶â€ğŸŒ«ï¸ï¼‰</strong></span><br></p><figure><img data-ratio="0.47685185185185186" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqdkDEC74059LxOqeYpVP0zRIAMR1gu8VqTXXqNBknAx0bMyf7ibs0Hfg/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqdkDEC74059LxOqeYpVP0zRIAMR1gu8VqTXXqNBknAx0bMyf7ibs0Hfg/640?wx_fmt=png"></figure><h2><span>3.NK_Tç»†èƒ</span></h2><figure><img data-ratio="1.2814814814814814" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq1R8S7OYXice6ahu6Ip3TK5chILKvqbpFrEoSPiatDyFV2G8U6ILvaBZg/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq1R8S7OYXice6ahu6Ip3TK5chILKvqbpFrEoSPiatDyFV2G8U6ILvaBZg/640?wx_fmt=png"></figure><br>ç”±äºå›¾å½¢å’Œä¸Šè¿°éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå°±åªæ”¾ç»“æœå›¾äº†ï¼Œè¯·çœ‹ï¼šï¼šï¼š<br><figure><img data-ratio="0.5462962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqibNEP8UXiaLamySHKHEicicVuW0ywjEjicjs2ojo91Xl9xHsEicA1duytIsA/640?wx_fmt=png" data-type="png" data-w="1080" title="967ac51f2459bf3a07641b203a53951.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqibNEP8UXiaLamySHKHEicicVuW0ywjEjicjs2ojo91Xl9xHsEicA1duytIsA/640?wx_fmt=png"><figcaption><br></figcaption></figure><pre><code>rm(list=ls())<br>sce.all=readRDS(Â <span>"sce.NKT_celltype.rds"</span>)<br><br>seuratObjÂ &lt;-Â sce.all<br>avgÂ &lt;-Â AverageExpression(objectÂ =Â seuratObj,Â assayÂ =Â <span>"RNA"</span>,Â group.byÂ =Â <span>"celltype"</span>)<br>aÂ =Â avg$RNA<br>bÂ =Â as.data.frame(a)<br>str(b)<br>genesÂ &lt;-Â c()<br><br><span>for</span>Â (iÂ <span>in</span>Â seq_along(genes_to_check))Â {<br>Â Â genesÂ &lt;-Â c(genes,Â unlist(genes_to_check<span>[[i]]</span>))<br>}<br>gene_heatmapÂ =Â b[genes,]<br><br>column_haÂ =Â HeatmapAnnotation(<span>'CellÂ type'</span>Â =Â ifelse(str_detect(colnames(gene_heatmap),<span>"NK"</span>),<span>"NK"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(colnames(gene_heatmap),<span>"CD8"</span>),<span>"CD8"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(colnames(gene_heatmap),<span>"CD4"</span>),<span>"CD4"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(colnames(gene_heatmap),<span>"Treg"</span>),<span>"Treg"</span>,<span>"T"</span>))))Â )<br><br>row_haÂ &lt;-Â rowAnnotation(<br>Â Â <span>'Marker'</span>Â =Â row)<br><br>col_funÂ =Â colorRamp2(c(<span>0</span>,Â <span>2</span>,Â <span>7</span>),Â c(<span>"#4EC0DB"</span>,Â <span>"white"</span>,Â <span>"#E63946"</span>))<br><br>gene_listÂ =Â genes_to_check<br>rowÂ &lt;-Â character()<br><span>for</span>Â (iÂ <span>in</span>Â <span>1</span>:length(gene_list))Â {<br>Â Â rowÂ &lt;-Â c(row,Â <span>rep</span>(names(gene_list)[i],Â length(gene_list<span>[[i]]</span>)))<br>}<br><br>columnÂ =Â ifelse(str_detect(colnames(gene_heatmap),<span>"NK"</span>),<span>"NK"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(colnames(gene_heatmap),<span>"CD8"</span>),<span>"CD8"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(colnames(gene_heatmap),<span>"CD4"</span>),<span>"CD4"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(colnames(gene_heatmap),<span>"Treg"</span>),<span>"Treg"</span>,<span>"T"</span>))))<br><br>Heatmap(gene_heatmap,Â <br>Â Â Â Â Â Â Â Â column_splitÂ =Â column,<br>Â Â Â Â Â Â Â Â row_splitÂ =Â c(<span>'Marker'</span>Â =Â row),<br>Â Â Â Â Â Â Â Â row_titleÂ =Â NULL,<br>Â Â Â Â Â Â Â Â heatmap_legend_paramÂ =Â list(<br>Â Â Â Â Â Â Â Â Â Â titleÂ =Â <span>"ScoreÂ geneÂ expression"</span>,<br>Â Â Â Â Â Â Â Â Â Â legend_heightÂ =Â unit(<span>4</span>,Â <span>"cm"</span>),<br>Â Â Â Â Â Â Â Â Â Â title_positionÂ =Â <span>"lefttop-rot"</span><br>Â Â Â Â Â Â Â Â ),<br>Â Â Â Â Â Â Â Â top_annotationÂ =Â column_ha,<br>Â Â Â Â Â Â Â Â left_annotationÂ =Â row_ha,<br>Â Â Â Â Â Â Â Â colÂ =Â col_fun,<br>Â Â Â Â Â Â Â Â cluster_rowsÂ =Â FALSE,Â cluster_columnsÂ =Â FALSE,column_titleÂ =Â NULL,<br>Â Â Â Â Â Â Â Â show_row_namesÂ =Â T,show_column_namesÂ Â =Â T<br>)<br></code></pre><p>æ€»è§‰å¾—é…è‰²å¾ˆæ‰çœ¼ã€‚<br></p><figure><img data-ratio="0.5444444444444444" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq3PiciaFNSjsbSP5Sr6Zib2t9icB1fibibn7z6wGS7MlibodzEqOyoTKqo1wGA/640?wx_fmt=png" data-type="png" data-w="1080" title="a83e7beb9ccdbc0fe659350186808fb.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq3PiciaFNSjsbSP5Sr6Zib2t9icB1fibibn7z6wGS7MlibodzEqOyoTKqo1wGA/640?wx_fmt=png"><figcaption><br></figcaption></figure><pre><code><span>###åº”è¯¥æ˜¯åŸºå› çš„å¹³å‡è¡¨è¾¾é‡</span><br><span>#å–å‡ºCD8T</span><br><span>####NKå’ŒTç»†èƒ</span><br>table(seuratObj$celltype)<br>sce_CD8TÂ =Â seuratObj[,Â seuratObj$celltypeÂ %in%Â c(Â <span>'CD8_GZMB'</span>,<span>'CD8_GZMK'</span>,<span>'CD8_HAVCR2'</span>,<span>'CD8_IL7R'</span>,<span>'CD8_STMN1'</span>Â )]<br>avgÂ &lt;-Â AverageExpression(objectÂ =Â sce_CD8T,Â assayÂ =Â <span>"RNA"</span>,Â group.byÂ =Â <span>"patientoutcone"</span>)<br>aÂ =Â avg$RNA<br>bÂ =Â <span>as</span>.data.frame(a)<br>str(b)<br><br>gene_boxplotÂ &lt;-Â <span><span>function</span><span>(gene)</span></span>{<br>Â Â average_expressionÂ &lt;-Â colMeans(submatrix)<br>Â Â average_expressionÂ =Â <span>as</span>.data.frame(average_expression)<br>Â Â colnames(average_expression)Â =Â gene<br>Â Â pheÂ =Â average_expression<br>Â Â groupÂ =Â ifelse(str_detect(rownames(phe),<span>"TN"</span>),<span>"TN"</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(rownames(phe),<span>"NMPR"</span>),<span>"NMPR"</span>,<span>"MPR"</span>))<br>Â Â phe$groupÂ =Â group<br><br>Â Â phe$groupÂ =Â factor(phe$group,levelsÂ =c(<span>"TN"</span>,<span>"MPR"</span>,<span>"NMPR"</span>))<br>Â Â table(phe$group)<br>Â Â colnames(phe)<br><br>Â Â colÂ =Â c(<span>"#508E42"</span>,Â <span>"#DF5E38"</span>,<span>"#7B7DC4"</span>)<br>Â Â P_TÂ &lt;-Â ggplot(phe,aes(x=group,y=!!rlang::sym(gene),fill=group))Â +<br>Â Â Â Â geom_boxplot(size=<span>0.5</span>,fill=<span>"white"</span>,outlier.fill=<span>"white"</span>,outlier.color=<span>"white"</span>,color=col)Â +<br>Â Â Â Â geom_jitter(aes(fill=group),widthÂ =<span>0.2</span>,shapeÂ =Â <span>21</span>,size=<span>2</span>)Â +<br>Â Â Â Â scale_fill_manual(valuesÂ =Â col)+<br>Â Â Â Â ggtitle(gene)Â +<br>Â Â Â Â theme_bw()Â +<br>Â Â Â Â theme(panel.gridÂ =Â element_blank(),Â panel.backgroundÂ =Â element_blank(),<br>Â Â Â Â Â Â Â Â Â Â axis.lineÂ =Â element_line(colorÂ =Â <span>'black'</span>))Â +<br>Â Â Â Â ylab(<span>"AverageÂ signatureÂ score"</span>)Â +xlab(<span>"Â "</span>)+<br>Â Â Â Â theme(legend.positionÂ =Â <span>"none"</span>,<br>Â Â Â Â Â Â Â Â Â Â axis.text.xÂ =Â element_text(colourÂ =Â <span>"black"</span>,Â familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>),<br>Â Â Â Â Â Â Â Â Â Â axis.text.yÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>,Â faceÂ =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â Â Â axis.title.yÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>,Â faceÂ =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â Â Â axis.title.xÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>14</span>,Â faceÂ =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â Â Â plot.titleÂ =Â element_text(familyÂ =Â <span>"Times"</span>,Â sizeÂ =Â <span>17</span>,Â faceÂ =Â <span>"bold"</span>,Â hjustÂ =Â <span>0.5</span>),<br>Â Â Â Â Â Â Â Â Â Â panel.grid.majorÂ =Â element_blank(),<br>Â Â Â Â Â Â Â Â Â Â panel.grid.minorÂ =Â element_blank(),<br>Â Â Â Â Â Â Â Â Â Â panel.borderÂ =Â element_blank())<br><br>Â Â P_T<br>Â Â compairedÂ =Â <span>list</span>(c(<span>"TN"</span>,Â <span>"MPR"</span>),<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â c(<span>"TN"</span>,Â <span>"NMPR"</span>))<br>Â Â P_TÂ =Â P_T+geom_signif(comparisonsÂ =Â compaired,step_increaseÂ =Â <span>0.1</span>,map_signif_levelÂ =Â T,testÂ =Â t.test,tip_lengthÂ =Â <span>0</span>)<br>Â Â P_T<br><br>}<br><br><span>#Â CytotoxicåŸºå› åç§°åˆ—è¡¨</span><br>Cytotoxic_geneÂ &lt;-Â c(<span>"GZMA"</span>,Â <span>"GZMB"</span>,Â <span>"GZMK"</span>Â ,<span>"GNLY"</span>,Â <span>"IFNG"</span>Â ,<span>"PRF1"</span>Â ,<span>"NKG7"</span>)<br><br>submatrixÂ &lt;-Â b[Cytotoxic_gene,Â ]<br>gene_boxplot(<span>'CytotoxicÂ signature'</span>)<br><br><span>#Â ExhaustedåŸºå› åç§°åˆ—è¡¨</span><br><span>##çœ‹ï¼Œç¡®å®æœ‰CD39ï¼Œæœç„¶æ˜¯é«˜è€—ç«­åŸºå› å•Š</span><br>gene_list<br>Exhausted_geneÂ &lt;-Â c(<span>"LAG3"</span>Â ,Â Â <span>"TIGIT"</span>Â ,Â <span>"PDCD1"</span>Â ,Â <span>"HAVCR2"</span>,Â <span>"CTLA4"</span>Â ,Â <span>"LAYN"</span>Â Â ,Â <span>"ENTPD1"</span>)<br><br>submatrixÂ &lt;-Â b[Exhausted_gene,Â ]<br>gene_boxplot(<span>'ExhaustedÂ signature'</span>)<br><br><br><span>#####ä¸‹é¢æ˜¯NK</span><br>table(seuratObj$celltype)<br>sce_NKÂ =Â seuratObj[,Â seuratObj$celltypeÂ %in%Â c(Â <span>'NK_FCGR3A'</span>,<span>'NK_KLRD1'</span>Â )]<br><br>avgÂ &lt;-Â AverageExpression(objectÂ =Â sce_NK,Â assayÂ =Â <span>"RNA"</span>,Â group.byÂ =Â <span>"patientoutcone"</span>)<br>aÂ =Â avg$RNA<br>bÂ =Â <span>as</span>.data.frame(a)<br>str(b)<br><br><span>#Â CytotoxicåŸºå› åç§°åˆ—è¡¨</span><br>submatrixÂ &lt;-Â b[Cytotoxic_gene,Â ]<br>gene_boxplot(<span>'CytotoxicÂ signature'</span>)<br><br><br><span>#Â ExhaustedåŸºå› åç§°åˆ—è¡¨</span><br>submatrixÂ &lt;-Â b[Exhausted_gene,Â ]<br>gene_boxplot(<span>'ExhaustedÂ signature'</span>)<br><br><br><br><span>#####ä¸‹é¢æ˜¯Treg</span><br>table(seuratObj$celltype)<br>sce_TregÂ =Â seuratObj[,Â seuratObj$celltypeÂ %in%Â c(Â <span>'Treg_CTLA4'</span>,<span>'Treg_SELL'</span>Â )]<br>avgÂ &lt;-Â AverageExpression(objectÂ =Â sce_Treg,Â assayÂ =Â <span>"RNA"</span>,Â group.byÂ =Â <span>"patientoutcone"</span>)<br>aÂ =Â avg$RNA<br>bÂ =Â <span>as</span>.data.frame(a)<br>str(b)<br><br><br><span>#Â ExhaustedåŸºå› åç§°åˆ—è¡¨</span><br>submatrixÂ &lt;-Â b[Exhausted_gene,Â ]<br>gene_boxplot(<span>'ExhaustedÂ signature'</span>)<br><span>###åœ¨æœªæ²»ç–—ç»„Tregè¿™ä¹ˆé«˜ï¼Ÿï¼ŒMPRç»„æŠ‘åˆ¶æ€§Tregä¸‹é™äº†</span><br></code></pre><p>è¿™æ˜¯CD8Tç»†èƒçš„ç»†èƒæ¯’æ€§åŸºå› å’Œè€—ç«­åŸºå› é›†çš„è¯„åˆ†ï¼Œå½“æ—¶å¿˜äº†æ‹¼åœ¨ä¸€èµ·ç»™å®ƒä»¬åŠ ä¸ŠCD8Tçš„æ ‡ç­¾äº†â€¦<br></p><figure><img data-ratio="0.38055555555555554" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqM9kAxhdTv94mp6rRcIeg9lgvFjDibt03wvwBrLuwRfvTGQmHlSdnQPQ/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqM9kAxhdTv94mp6rRcIeg9lgvFjDibt03wvwBrLuwRfvTGQmHlSdnQPQ/640?wx_fmt=png"></figure><br>ä¸‹é¢æ˜¯NKç»†èƒï¼Œè¿™ä¸ªNKç»†èƒç¡®å®æœ‰ç‚¹ä¸å¤ªå¯¹åŠ²ï¼Œå’Œç¬¬ä¸€èŠ‚é‡Œçš„NKç›¸äº’å°è¯äº†ã€‚<br><figure><img data-ratio="0.37222222222222223" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqYdN4Ysmz7U9L2nmUtUgw24rKmSzhUKdKdNrrX37gOtpXxPNKegn46Q/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqYdN4Ysmz7U9L2nmUtUgw24rKmSzhUKdKdNrrX37gOtpXxPNKegn46Q/640?wx_fmt=png"><figcaption><br></figcaption></figure><pre><code><span>#####ç®±çº¿å›¾æ˜¾ç¤ºTN ( n = 3)ã€MPR ( n = 4)å’ŒNMPR ( n = 8)æ‚£è€…å„T/NKç»†èƒç¾¤çš„ç»†èƒæ¯”ä¾‹ã€‚<br>####ä¸åŒç»†èƒç¾¤é‡Œäºšç»„æ¯”ä¾‹<br>pheÂ =Â seuratObj@meta.data<br>table(phe$celltype)<br>table(phe$patient)<br>phe$patientoutcomeÂ =Â Â paste(phe$patient,phe$Pathologic,sepÂ =Â '_')<br><br>tb=table(phe$celltype,<br>Â Â Â Â Â Â Â Â Â phe$patientoutcome)<br><br>head(tb)<br>libraryÂ (gplots)Â <br>balloonplot(tb)<br>bar_dataÂ <span>&lt;<span>-</span>Â <span>as.data.frame</span>(<span>tb</span>)<br><br><span>bar_per</span>Â &lt;<span>-</span>Â <span>bar_data</span>Â %&gt;</span>%Â <br>Â Â group_by(Var2)Â %&gt;%<br>Â Â mutate(sum(Freq))Â %&gt;%<br>Â Â mutate(percentÂ =Â FreqÂ /Â `sum(Freq)`)<br>head(bar_per)Â <br>#write.csv(bar_per,fileÂ =Â "celltype_by_group_percent.csv")<br>library(ggplot2)<br>library(stringr)<br>bar_per$Var2<br>groupÂ =Â ifelse(str_detect(bar_per$Var2,"TN"),"TN",<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifelse(str_detect(bar_per$Var2,"NMPR"),"NMPR","MPR"))<br>bar_per$groupÂ =Â group<br><br>bar_per$groupÂ =Â factor(bar_per$group,levelsÂ =c("TN","MPR","NMPR"))<br>table(bar_per$Var1)<br>bar_per$Var1Â =Â factor(bar_per$Var1,levelsÂ =c("B3_IGHD","B0_MS4A1","B1_IGHM",'B2_HSPA1A','B4_FCRL4','B5_CD83','B6_RGS13'))<br><br>colÂ =Â c("#508E42",Â "#DF5E38","#7B7DC4")<br>PÂ <span>&lt;<span>-</span>Â <span>ggplot</span>(<span>bar_per</span>,Â <span>aes</span>(<span>x</span>Â =Â <span>Var1,</span>Â <span>y</span>Â =Â <span>percent,</span>Â <span>fill</span>Â =Â <span>group,</span>Â <span>color</span>Â =Â <span>group))</span>Â +<br>Â Â <span>geom_boxplot</span>(<span>width</span>Â =Â <span>0.6,</span>Â <span>outlier.shape</span>Â =Â <span>NA)</span>Â +<br>Â Â <span>geom_jitter</span>(<span>shape</span>Â =Â <span>21,</span>Â <span>size</span>Â =Â <span>2,</span>Â <span>position</span>Â =Â <span>position_jitterdodge(0.2))</span>Â +<br>Â Â <span>scale_fill_manual</span>(<span>values</span>Â =Â <span>c(</span>"<span>white</span>",Â "<span>white</span>",Â "<span>white</span>"))Â +<br>Â Â <span>scale_color_manual</span>(<span>values</span>Â =Â <span>col,</span><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>labels</span>Â =Â <span>c(</span>"<span>TN</span>(<span>n</span>=<span>3)</span>",Â "<span>MPR</span>(<span>n</span>=<span>4)</span>",Â "<span>NMPR</span>(<span>n</span>=<span>8)</span>"),<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>name</span>Â =Â <span>"Group"</span>)Â +<br>Â Â <span>theme_bw</span>()Â +<br>Â Â <span>theme</span>(<span>legend.position</span>Â =Â <span>"bottom"</span>,<br>Â Â Â Â Â Â Â Â <span>legend.direction</span>Â =Â <span>'horizontal'</span>,<br>Â Â Â Â Â Â Â Â <span>legend.justification</span>Â =Â <span>"left"</span>,<br>Â Â Â Â Â Â Â Â <span>legend.box.just</span>Â =Â <span>"left"</span>,<br>Â Â Â Â Â Â Â Â <span>legend.title</span>Â =Â <span>element_blank(),</span><br>Â Â Â Â Â Â Â Â <span>axis.text.x</span>Â =Â <span>element_text(colour</span>Â =Â <span>"black"</span>,<span>angle</span>=<span>45,</span>Â Â <span>hjust</span>Â =Â <span>1,</span>Â <span>family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>12),</span><br>Â Â Â Â Â Â Â Â <span>axis.text.y</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14,</span>Â <span>face</span>Â =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â <span>axis.title.y</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14,</span>Â <span>face</span>Â =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â <span>axis.title.x</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>14,</span>Â <span>face</span>Â =Â <span>"plain"</span>),<br>Â Â Â Â Â Â Â Â <span>plot.title</span>Â =Â <span>element_text(family</span>Â =Â <span>"Times"</span>,Â <span>size</span>Â =Â <span>15,</span>Â <span>face</span>Â =Â <span>"bold"</span>,Â <span>hjust</span>Â =Â <span>0.5),</span><br>Â Â Â Â Â Â Â Â <span>panel.grid.major</span>Â =Â <span>element_blank(),</span><br>Â Â Â Â Â Â Â Â <span>panel.grid.minor</span>Â =Â <span>element_blank())</span>Â +<br>Â Â <span>labs</span>(<span>y</span>Â =Â <span>"FractionÂ (%)Â ofÂ immuneÂ cells"</span>,<br>Â Â Â Â Â Â Â <span>x</span>Â =Â <span>""</span>)+<br>Â Â <span>guides</span>(<span>fill</span>Â =Â <span>FALSE)</span><br><br><span>P</span><br><br><span>p</span>Â =Â <span>P+</span><br>Â Â <span>coord_cartesian</span>(<span>clip</span>Â =Â <span>'off'</span>,<span>ylim</span>Â =Â <span>c(0,1))+</span>Â #åœ¨éå›¾å½¢åŒºåŸŸç»˜å›¾,ä¸”è¦å®šå¥½<span>y</span>è½´èŒƒå›´<br>Â Â <span>theme</span>(<span>plot.margin</span>Â =Â <span>margin(2.2,0.5,1.5,0.5,</span>'<span>cm</span>'))+Â #è‡ªå®šä¹‰å›¾ç‰‡ä¸Šå·¦ä¸‹å³çš„è¾¹æ¡†å®½åº¦<br>Â Â <span>annotate</span>('<span>text</span>',<span>x</span>=<span>2.6,y</span>=<span>1.13,label</span>=<span>'CD4Â Tconv'</span>,<span>size</span>=<span>7,family</span>=<span>'serif'</span>,<span>color</span>=<span>'red'</span>)+Â <br>Â Â <span>annotate</span>('<span>segment</span>',<span>x</span>=<span>0.55,xend</span>=<span>4.2,y</span>=<span>1.1,yend</span>=<span>1.1,color</span>=<span>'red'</span>,<span>cex</span>=<span>.8)+</span><br>Â Â <span>annotate</span>('<span>text</span>',<span>x</span>=<span>6.8,y</span>=<span>1.13,label</span>=<span>'CD8Â T'</span>,<span>size</span>=<span>7,family</span>=<span>'serif'</span>,<span>color</span>=<span>'red'</span>)+Â <br>Â Â <span>annotate</span>('<span>segment</span>',<span>x</span>=<span>4.7,xend</span>=<span>8.9,y</span>=<span>1.1,yend</span>=<span>1.1,color</span>=<span>'red'</span>,<span>cex</span>=<span>.8)+</span><br>Â Â <span>annotate</span>('<span>text</span>',<span>x</span>=<span>10.5,y</span>=<span>1.13,label</span>=<span>'NK'</span>,<span>size</span>=<span>7,family</span>=<span>'serif'</span>,<span>color</span>=<span>'red'</span>)+<br>Â Â <span>annotate</span>('<span>segment</span>',<span>x</span>=<span>9.5,xend</span>=<span>11.5,y</span>=<span>1.1,yend</span>=<span>1.1,color</span>=<span>'red'</span>,<span>cex</span>=<span>.8)+</span><br>Â Â <span>annotate</span>('<span>text</span>',<span>x</span>=<span>13.6,y</span>=<span>1.13,label</span>=<span>'CD4Â Treg'</span>,<span>size</span>=<span>7,family</span>=<span>'serif'</span>,<span>color</span>=<span>'red'</span>)+<br>Â Â <span>annotate</span>('<span>segment</span>',<span>x</span>=<span>12.8,xend</span>=<span>14.3,y</span>=<span>1.1,yend</span>=<span>1.1,color</span>=<span>'red'</span>,<span>cex</span>=<span>.8)</span><br><br><span>p</span><br><span>ggsave</span>('<span>NK_T_por.pdf</span>',<span>width</span>Â =Â <span>14.5,height</span>Â =Â <span>7.5)</span><br></span></span><span>####æ´»åŒ–çš„Tregsæ¯”naÃ¯veÂ Tregså…·æœ‰æ›´å¼ºçš„å…ç–«æŠ‘åˆ¶åŠŸèƒ½ï¼Œä¸”ä¸é¢„åä¸è‰¯ç›¸å…³ã€‚<br>#æŒç»­æ¿€æ´»Tregsï¼ˆTreg_CTLA4ï¼Œè¡¨è¾¾TNFRSF4å’ŒTNFRSF9ï¼‰ä»…åœ¨MPRæ‚£è€…ä¸­é™ä½ã€‚<br>#ç›¸å¯¹äºTNæ‚£è€…ï¼ŒMPRå’ŒNMPRæ‚£è€…ä¸­naÃ¯veÂ TregsÂ (Treg_SELLï¼Œè¡¨è¾¾SELLå’ŒLEF1)çš„æ¯”ä¾‹å‡ä¸‹é™ã€‚<br>#MPRæ‚£è€…çš„Tregè€—ç«­ç‰¹å¾å§‹ç»ˆä½äºNMPRæ‚£è€…ã€‚</span></code></pre><figure><img data-ratio="0.4583333333333333" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqZmAThHicbb22ADBmzvFOpx9DKlTJey3hmrBPrZTl2ia05icyxBMQcycFA/640?wx_fmt=png" data-type="png" data-w="1080" title="60a6b745dc1841f955fbb379ebe7b9c.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqZmAThHicbb22ADBmzvFOpx9DKlTJey3hmrBPrZTl2ia05icyxBMQcycFA/640?wx_fmt=png"><figcaption><br></figcaption></figure><pre><code><span>#æ–‡ç« ä¸­ç”¨çš„monocle2ï¼Œè¿™é‡Œä¹Ÿç”¨2</span><br><span>######Â æ‹Ÿæ—¶åºåˆ†æÂ ######</span><br>sce_4CD8TÂ =Â seuratObj[,Â seuratObj$celltypeÂ %<span>in</span>%Â c(Â <span>'CD8_GZMB'</span>Â ,<span>'CD8_GZMK'</span>,<span>'CD8_HAVCR2'</span>,<span>'CD8_IL7R'</span>)]<br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br><span>library</span>(monocle)<br>packageVersion(<span>"monocle"</span>)<br><span>#monocleæ„å»ºCDSéœ€è¦3ä¸ªçŸ©é˜µï¼šexpr.matrixã€pdã€fd</span><br><span>#Â å°†Seuratä¸­çš„å¯¹è±¡è½¬æ¢ä¸ºmonocleè¯†åˆ«çš„å¯¹è±¡</span><br><span>#cdsÂ &lt;-Â importCDS(GetAssayData(seurat.object))</span><br><span>#é€‰æ‹©åšæ‹Ÿæ—¶åºçš„äºšç¾¤</span><br>Mono_tj&lt;-sce_4CD8T<br><br>Mono_matrix&lt;-as(as.matrix(GetAssayData(Mono_tj,slotÂ =Â <span>"counts"</span>)),Â <span>'sparseMatrix'</span>)<br><span>#æ„å»ºfeaturedataï¼Œä¸€èˆ¬featuredataéœ€è¦ä¸¤ä¸ªcolï¼Œä¸€ä¸ªæ˜¯gene_id,ä¸€ä¸ªæ˜¯gene_short_name,rowå¯¹åº”countsçš„rownames</span><br>feature_ann&lt;-data.frame(gene_id=rownames(Mono_matrix),gene_short_name=rownames(Mono_matrix))<br>rownames(feature_ann)&lt;-rownames(Mono_matrix)<br>Mono_fd&lt;-new(<span>"AnnotatedDataFrame"</span>,Â dataÂ =Â feature_ann)<br><br><span>#SeuratÂ objectä¸­çš„@meta.dataä¸€èˆ¬ä¼šå­˜æ”¾è¡¨å‹ç›¸å…³çš„ä¿¡æ¯å¦‚clusterã€sampleçš„æ¥æºã€groupç­‰ï¼Œæ‰€ä»¥é€‰æ‹©å°†metadataè½¬æ¢ä¸ºphenodata</span><br>sample_ann&lt;-Mono_tj@meta.data<br><span>#rownames(sample_ann)&lt;-colnames(Mono_matrix)</span><br><br>Mono_pd&lt;-new(<span>"AnnotatedDataFrame"</span>,Â dataÂ =sample_ann)<br><span>#buildÂ newÂ cellÂ dataÂ set</span><br>Mono.cds&lt;-newCellDataSet(Mono_matrix,phenoDataÂ =Mono_pd,featureDataÂ =Mono_fd,expressionFamily=negbinomial.size())<br><br><br><span>#é¢„å¤„ç†</span><br>Mono.cdsÂ &lt;-Â estimateSizeFactors(Mono.cds)<br>Mono.cdsÂ &lt;-Â estimateDispersions(Mono.cds)<br><span>#ç­›é€‰åŸºå› ,è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ç­›é€‰ç‰¹å®šçš„åŸºå› </span><br>disp_tableÂ &lt;-Â dispersionTable(Mono.cds)<br><span>#unsup_clustering_genesÂ &lt;-Â subset(disp_table,Â mean_expressionÂ &gt;=Â 0.1)</span><br>unsup_clustering_genesÂ &lt;-Â subset(disp_table,Â mean_expressionÂ &gt;=Â <span>0.1</span>)<br><br>Mono.cdsÂ &lt;-Â setOrderingFilter(Mono.cds,Â unsup_clustering_genes$gene_id)<br><span>#ç”¨DDRtreeÂ è¿›è¡Œé™ç»´åˆ†æ</span><br>Mono.cdsÂ &lt;-Â reduceDimension(<br>Â Â Mono.cds,<br>Â Â max_componentsÂ =Â <span>2</span>,<br>Â Â methodÂ =Â <span>'DDRTree'</span>)<br><span>#è®¡ç®—psudotimeå€¼</span><br>Mono.cdsÂ &lt;-Â orderCells(Mono.cds)<br>head(pData(Mono.cds))<br><br>plot_cell_trajectory(Mono.cds,color_by=<span>"celltype"</span>,Â size=<span>1</span>,show_backbone=<span>TRUE</span>)<br>ggsave(<span>"æ‹Ÿæ—¶åº.pdf"</span>,widthÂ =Â <span>7</span>,heightÂ =Â <span>6</span>)<br>plot_cell_trajectory(Mono.cds,color_by=<span>"patient"</span>,Â size=<span>1</span>,show_backbone=<span>TRUE</span>)<br>plot_cell_trajectory(Mono.cds,color_by=<span>"Pathologic"</span>,Â size=<span>1</span>,show_backbone=<span>TRUE</span>)<br><br>p1Â &lt;-Â plot_cell_trajectory(Mono.cds,Â xÂ =Â <span>1</span>,Â yÂ =Â <span>2</span>,Â color_byÂ =Â <span>"celltype"</span>)Â +Â <br>Â Â theme(legend.position=<span>'none'</span>,panel.borderÂ =Â element_blank())Â +Â <span>#å»æ‰ç¬¬ä¸€ä¸ªçš„legend</span><br>Â Â scale_color_manual(valuesÂ =Â mycolors)Â <br>p2Â &lt;-Â plot_complex_cell_trajectory(Mono.cds,Â xÂ =Â <span>1</span>,Â yÂ =Â <span>2</span>,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â color_byÂ =Â <span>"celltype"</span>)+<br>Â Â scale_color_manual(valuesÂ =Â mycolors)Â +<br>Â Â theme(legend.titleÂ =Â element_blank())Â <br>p1|p2<br><br>trace(<span>'project2MST'</span>,Â editÂ =Â <span>T</span>,Â whereÂ =Â asNamespace(<span>"monocle"</span>))<br></code></pre><p>è®©æˆ‘è§£é‡Šçš„è¯é‚£åªèƒ½ä¸€éƒ¨åˆ†è€—ç«­äº†ï¼Œå¦ä¸€éƒ¨åˆ†è€—ç«­çš„è¢«é€†è½¬äº†<br>CD8_IL7Rå’ŒCD8_GZMK â†’ CD8_GZMB â†’ CD8_HAVCR2<br></p><figure><img data-ratio="0.600925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqSnSTIscibqLIvMG7JibdPTgcKnrHKBp2rBDjJXkbZmINTrEC8NcD3WYA/640?wx_fmt=png" data-type="png" data-w="1080" title="0022d88cef18ff4146e835b17537391.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqSnSTIscibqLIvMG7JibdPTgcKnrHKBp2rBDjJXkbZmINTrEC8NcD3WYA/640?wx_fmt=png"></figure><h2><span>4.B</span></h2><figure><img data-ratio="0.6268518518518519" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqMicM55qCUerSoAzUbNMxJImDmLOebONs6sGfI9p5GaOX8KNf2WT7hXg/640?wx_fmt=png" data-type="png" data-w="1080" title="image.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqMicM55qCUerSoAzUbNMxJImDmLOebONs6sGfI9p5GaOX8KNf2WT7hXg/640?wx_fmt=png"></figure><br>æµç¨‹åŸºæœ¬å’Œä¸Šé¢ä¸€æ ·ï¼Œå¤ç°å›¾ï¼š</section><section><br><figure><img data-ratio="0.5453703703703704" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqV54o2ha05ydiaWPXp7k3F6yMOFVA0rfvSKibYEMMheaTgzhLrSypgxbg/640?wx_fmt=png" data-type="png" data-w="1080" title="674bc156a7ea9fe0a0574cff976f046.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqV54o2ha05ydiaWPXp7k3F6yMOFVA0rfvSKibYEMMheaTgzhLrSypgxbg/640?wx_fmt=png"></figure><br><figure><img data-ratio="0.5416666666666666" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq2qLkJZ98zpiarHltGwqXTACb5icloNTiakaKluPI8q1auqkXibuFn52joQ/640?wx_fmt=png" data-type="png" data-w="1080" title="659ec38f381fabcf6f28258c8950ee7.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJq2qLkJZ98zpiarHltGwqXTACb5icloNTiakaKluPI8q1auqkXibuFn52joQ/640?wx_fmt=png"></figure><br>è¶‹åŠ¿å’Œæ–‡ä¸­æ˜¯ä¸€æ ·çš„..<br><figure><img data-ratio="0.5814814814814815" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqAZQ1avqcFSvYDKZ2K29Zw8YpjrGDHGhFLnTzzFHwial156GJA3L0IiaQ/640?wx_fmt=png" data-type="png" data-w="1080" title="f541185bf567efce6483dd8ae84a2e9.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqAZQ1avqcFSvYDKZ2K29Zw8YpjrGDHGhFLnTzzFHwial156GJA3L0IiaQ/640?wx_fmt=png"></figure><h2><span>5.é«“ç³»</span></h2><figure><img data-ratio="0.5435185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqPlvJlXPpPB8WEYyO8H3161PZXaz8GLrvsspSA7NIPJeNG6icAjRwfHw/640?wx_fmt=png" data-type="png" data-w="1080" title="a7e220e10709fd0228647fef374c047.png" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Losic8CbFua7EfN6e5ibP2AcGJqPlvJlXPpPB8WEYyO8H3161PZXaz8GLrvsspSA7NIPJeNG6icAjRwfHw/640?wx_fmt=png"></figure><h1><span>ç•ªå¤–</span></h1><p>ä»å¤ç°ä¸­å­¦åˆ°æœ€å¤šçš„å°±æ˜¯çœ¼ç†Ÿå„ç§ç»†èƒäºšç¾¤å§ï¼Œè¿˜æœ‰ï¼Œ<strong>æ–‡çŒ®ä¸­ç¨€å¥‡å¤æ€ªçš„å›¾å¤ªå¤šäº†ï¼Œè™½ç„¶ä¸çŸ¥é“åˆ«äººæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼ç”»å‡ºæ¥çš„ï¼Œ</strong>ä½†æ˜¯åªæ±‚å½¢ä¼¼ä¹Ÿæƒ³å¤ç°å‡ºæ¥å“ˆå“ˆå“ˆã€‚è¯è¯´ä¸ºä»€ä¹ˆæ–‡ä¸­ä¸å¯¹è¯ç‰©æ²»ç–—ä¸­çš„è¯ç‰©è¿›è¡Œåˆ†æå‘¢ï¼Ÿä¿¡è¿ªåˆ©ç‰¹ç‘æ™®åˆ©ã€‚å¦‚æœå¤§å®¶å¯¹æˆ‘çº¯æ‰‹å·¥ä»£ç ä¸æ»¡æ„ï¼Œä¹Ÿå¯ä»¥å»çœ‹å…¶å®ƒæ–‡ç« çš„å®˜æ–¹ä»£ç ï¼Œæ¯”å¦‚</p><blockquote data-tool="mdniceç¼–è¾‘å™¨"><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†æ–°é²œå‡ºç‚‰çš„ä¸€ç¯‡NCå•ç»†èƒæ–‡ç« å›¾è¡¨å¤ç°çš„7ä¸ªç¬”è®°ï¼š</p></blockquote><ul data-tool="mdniceç¼–è¾‘å™¨"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513533&amp;idx=1&amp;sn=13418c254b58092398874d151489193e&amp;chksm=ea1cb33fdd6b3a29089900ae32a70d72e8d563518c84fe0334b256d19e137e555a9ce023d9fd&amp;scene=21#wechat_redirect" data-linktype="2">æ‰‹æŠŠæ‰‹å¸¦ä½ å¤ç°NCå›¾è¡¨ä¹‹Figure6</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513446&amp;idx=1&amp;sn=88fbdfe38b95cb851a4c36af199a4302&amp;chksm=ea1cb3e4dd6b3af2bdf1458af9bd3f62950202411d4c770aaec5010737434e34f360697c6083&amp;scene=21#wechat_redirect" data-linktype="2">æ‰‹æŠŠæ‰‹å¸¦ä½ å¤ç°NCå›¾è¡¨ä¹‹Figure5</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513381&amp;idx=1&amp;sn=b95f12df59b2eef3f85cbf829cf29cab&amp;chksm=ea1cb3a7dd6b3ab18ca6484d5db6f5222625012966d708a82ff89d135519e4284f60e1c6910c&amp;scene=21#wechat_redirect" data-linktype="2">æ‰‹æŠŠæ‰‹å¸¦ä½ å¤ç°NCå›¾è¡¨ä¹‹Figure 4</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513310&amp;idx=1&amp;sn=5aa8db2bdc7c6ca1b1bdb6d1a9863130&amp;chksm=ea1cb25cdd6b3b4a2edf5a6c816f9e5ac46f6667dabe4adc2995a3db7a98e065c044004487d0&amp;scene=21#wechat_redirect" data-linktype="2">æ‰‹æŠŠæ‰‹å¸¦ä½ å¤ç°NCå›¾è¡¨ä¹‹Figure 3</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513202&amp;idx=1&amp;sn=3f8a4947cce8596f454fb82090f599e0&amp;chksm=ea1cb2f0dd6b3be68237d48393e535a8399b9e0e8a091dcc225b3bce2100c6fc4d31a0fd027b&amp;scene=21#wechat_redirect" data-linktype="2">æ‰‹æŠŠæ‰‹å¸¦ä½ å¤ç°NCå›¾è¡¨ä¹‹Figure 2</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247513057&amp;idx=1&amp;sn=6f737f0a5ae7795645a42894897f7b87&amp;chksm=ea1cb563dd6b3c7567db78011efb52823c1f6bc94a760cc11ef8a07d3d5d6c779e4813c4d523&amp;scene=21#wechat_redirect" data-linktype="2">æ‰‹æŠŠæ‰‹å¸¦ä½ å¤ç°NCå›¾è¡¨ä¹‹Figure 1</a></section></li></ul><p data-tool="mdniceç¼–è¾‘å™¨">åŒ…æ‹¬ä½†ä¸é™äºé™ç»´èšç±»åˆ†ç¾¤å’Œç”Ÿç‰©å­¦å‘½åï¼Œå•ç»†èƒæ¯”ä¾‹å·®å¼‚å’Œè¡¨è¾¾é‡å·®å¼‚ä»¥åŠç”Ÿç‰©å­¦åŠŸèƒ½æ³¨é‡Šï¼Œæˆçº¤ç»´ç­‰ç»†èƒäºšç¾¤çš„ç»†åˆ†ï¼Œå•ç»†èƒé«˜çº§åˆ†æç­‰ç­‰ã€‚å…¶å®ƒé«˜çº§åˆ†æï¼Œæ¯”å¦‚è½¬å½•å› å­åˆ†æ ï¼Œä¸»è¦æ˜¯å¯¹è®¡ç®—æœºèµ„æºæ¶ˆè€—ä¼šæ¯”è¾ƒå¤§ï¼Œæˆ‘ä¹Ÿå¤šæ¬¡åˆ†äº«è¿‡ç»†èŠ‚æ•™ç¨‹ï¼š</p><ul data-tool="mdniceç¼–è¾‘å™¨"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497441&amp;idx=1&amp;sn=7a53e6aa00c84b57104a61787f2beb03&amp;scene=21#wechat_redirect" data-linktype="2">å¼ æ³½æ°‘å›¢é˜Ÿçš„å•ç»†èƒç ”ç©¶æŠŠTç»†èƒåˆ†çš„å¦‚æ­¤æ¸…æ¥š</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497617&amp;idx=2&amp;sn=fe47078075a3b9994079761f96870aa3&amp;scene=21#wechat_redirect" data-linktype="2">ç»†èƒé€šè®¯åˆ†æçš„èƒŒæ™¯çŸ¥è¯†</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497617&amp;idx=1&amp;sn=0e63223347afbb0795aa94d339d72214&amp;scene=21#wechat_redirect" data-linktype="2">æ„å»ºå•ç»†èƒäºšç¾¤ç½‘ç»œï¼ˆç±»ä¼¼äºç»†èƒé€šè®¯åˆ†æï¼‰</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497653&amp;idx=2&amp;sn=320d26cad3d8141bb081d6ff798ae778&amp;scene=21#wechat_redirect" data-linktype="2">ç»†èƒé€šè®¯åˆ†æç»“æœçš„è§£è¯»</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497665&amp;idx=1&amp;sn=74ac0e87b9689d5df7c0208e1c1dc0ac&amp;scene=21#wechat_redirect" data-linktype="2">SCENICè½¬å½•å› å­åˆ†æç»“æœçš„è§£è¯»</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497956&amp;idx=1&amp;sn=5d4deb7cf7b7848b3e2273cbd663bb6a&amp;scene=21#wechat_redirect" data-linktype="2">äººäººéƒ½èƒ½å­¦ä¼šçš„å•ç»†èƒèšç±»åˆ†ç¾¤æ³¨é‡Š</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247498040&amp;idx=1&amp;sn=3a39699ab10fb71b966adb5e7e640270&amp;scene=21#wechat_redirect" data-linktype="2">å¯¹å•ç»†èƒè¡¨è¾¾çŸ©é˜µåšgseaåˆ†æ</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247498091&amp;idx=1&amp;sn=5c157da6e889f2134ef9342cee560197&amp;scene=21#wechat_redirect" data-linktype="2">å•ç»†èƒè½¬å½•å› å­åˆ†æä¹‹SCENICæµç¨‹</a></section></li></ul><p data-tool="mdniceç¼–è¾‘å™¨">å•ç»†èƒè½¬å½•ç»„æ•°æ®åˆ†æçš„æ ‡å‡†é™ç»´èšç±»åˆ†ç¾¤ï¼Œå¹¶ä¸”è¿›è¡Œç”Ÿç‰©å­¦æ³¨é‡Šåçš„ç»“æœã€‚å¯ä»¥å‚è€ƒå‰é¢çš„ä¾‹å­ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247497956&amp;idx=1&amp;sn=5d4deb7cf7b7848b3e2273cbd663bb6a&amp;scene=21#wechat_redirect" data-linktype="2">äººäººéƒ½èƒ½å­¦ä¼šçš„å•ç»†èƒèšç±»åˆ†ç¾¤æ³¨é‡Š</a>Â ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†ç¬¬ä¸€å±‚æ¬¡çš„åˆ†ç¾¤ã€‚</p><p data-tool="mdniceç¼–è¾‘å™¨">å¦‚æœä½ å¯¹å•ç»†èƒæ•°æ®åˆ†æè¿˜æ²¡æœ‰åŸºç¡€è®¤çŸ¥ï¼Œå¯ä»¥çœ‹åŸºç¡€10è®²ï¼š</p><ul data-tool="mdniceç¼–è¾‘å™¨"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486076&amp;idx=1&amp;sn=52bb851d7dc23461233a2cf458736151&amp;scene=21#wechat_redirect" data-linktype="2">01. ä¸Šæ¸¸åˆ†ææµç¨‹</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486082&amp;idx=1&amp;sn=03cadceffb2c14ba95d97fe5caf38d94&amp;scene=21#wechat_redirect" data-linktype="2">02.è¯¾é¢˜å¤šå°‘ä¸ªæ ·å“ï¼Œæµ‹åºæ•°æ®é‡å¦‚ä½•</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486088&amp;idx=1&amp;sn=3a115338ee4937d20caab78627237553&amp;scene=21#wechat_redirect" data-linktype="2">03. è¿‡æ»¤ä¸åˆæ ¼ç»†èƒå’ŒåŸºå› ï¼ˆæ•°æ®è´¨æ§å¾ˆé‡è¦ï¼‰</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486096&amp;idx=1&amp;sn=1a99c4c5800b7e0287db3e8ef369fab8&amp;scene=21#wechat_redirect" data-linktype="2">04. è¿‡æ»¤çº¿ç²’ä½“æ ¸ç³–ä½“åŸºå› </a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486098&amp;idx=1&amp;sn=bf9a71df848d74fe665ce7d5e283d5ff&amp;scene=21#wechat_redirect" data-linktype="2">05. å»é™¤ç»†èƒæ•ˆåº”å’ŒåŸºå› æ•ˆåº”</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486260&amp;idx=1&amp;sn=c6abf658de73594d1d77d8e1ffa7d153&amp;scene=21#wechat_redirect" data-linktype="2">06.å•ç»†èƒè½¬å½•ç»„æ•°æ®çš„é™ç»´èšç±»åˆ†ç¾¤</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486271&amp;idx=1&amp;sn=638b434b6deee63206af1c0eeda175ab&amp;scene=21#wechat_redirect" data-linktype="2">07.å•ç»†èƒè½¬å½•ç»„æ•°æ®å¤„ç†ä¹‹ç»†èƒäºšç¾¤æ³¨é‡Š</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486278&amp;idx=1&amp;sn=91250ef733833ff00371818b215dc124&amp;scene=21#wechat_redirect" data-linktype="2">08.æŠŠæ‹¿åˆ°çš„äºšç¾¤è¿›è¡Œæ›´ç»†è‡´çš„åˆ†ç¾¤</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247486287&amp;idx=1&amp;sn=49627c638ff9c04418282c53518aa7c7&amp;scene=21#wechat_redirect" data-linktype="2">09.å•ç»†èƒè½¬å½•ç»„æ•°æ®å¤„ç†ä¹‹ç»†èƒäºšç¾¤æ¯”ä¾‹æ¯”è¾ƒ</a></section></li></ul></section><p>å¦‚æœæ˜¯æ–‡ç« å¹¶æ²¡æœ‰æä¾›è¡¨è¾¾é‡çŸ©é˜µï¼Œæˆ–è€…è¯´ä½ å¯¹ä½œè€…çš„çŸ©é˜µä¸æ»¡æ„ï¼Œ å°±æœ‰å¯èƒ½éœ€è¦ä»fastqæ–‡ä»¶å¼€å§‹å•¦ã€‚</p><blockquote data-tool="mdniceç¼–è¾‘å™¨"><p>æ­£å¸¸èµ°cellrangerçš„å®šé‡æµç¨‹å³å¯ï¼Œä»£ç æˆ‘å·²ç»æ˜¯å¤šæ¬¡åˆ†äº«äº†ã€‚å‚è€ƒï¼š</p></blockquote><ul data-tool="mdniceç¼–è¾‘å™¨"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247512340&amp;idx=3&amp;sn=1b9609a8870a0209dd27ffdcbc3cac87&amp;chksm=9b4bf1afac3c78b90674678fcec66365b9faaa275ff4b0a2255e0a05fa8b905e15222a643bea&amp;scene=21#wechat_redirect" data-linktype="2">10Xå•ç»†èƒè½¬å½•ç»„åŸå§‹æµ‹åºæ•°æ®çš„Cell Rangeræµç¨‹ï¼ˆä»…éœ€800å…ƒï¼‰</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247496813&amp;idx=1&amp;sn=4151bf2265618eff4e0123722c50e569&amp;scene=21#wechat_redirect" data-linktype="2">10Xçš„å•ç»†èƒè½¬å½•ç»„åŸå§‹æ•°æ®ä¹Ÿå¯ä»¥åœ¨EBIä¸‹è½½</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247510920&amp;idx=1&amp;sn=c4561d34e984406693c014cdfe236c0f&amp;chksm=9b4beb33ac3c622542d894344c323ff7cca52f69119d02fc7aa4636af0cbe7df4b6c63dd5ba9&amp;scene=21#wechat_redirect" data-linktype="2">ä¸€ä¸ª10xå•ç»†èƒè½¬å½•ç»„é¡¹ç›®ä»fastqåˆ°ç»†èƒäºšç¾¤</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513565&amp;idx=1&amp;sn=092e637017d176c43f00a295d3210592&amp;scene=21#wechat_redirect" data-linktype="2">ä¸€æ–‡æ‰“é€šå•ç»†èƒä¸Šæ¸¸ï¼šä»è½¯ä»¶éƒ¨ç½²åˆ°ä¸Šæ¸¸åˆ†æ</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513605&amp;idx=1&amp;sn=e86a329c887745c6d00d3ededa39dcda&amp;chksm=9b4bf6beac3c7fa8523cef4e7189fb20b914460ddb61e6cd1dd520b5928e1b59a8b7827ce783&amp;scene=21#wechat_redirect" data-linktype="2">PRJNA713302è¿™ä¸ª10xå•ç»†èƒfastqå®æˆ˜</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513968&amp;idx=1&amp;sn=f5a44a7bea0bdacd8af1a20c177763e5&amp;scene=21#wechat_redirect" data-linktype="2">ä¸€æ¬¡æ›²æŠ˜ä¸”æ˜‚è´µçš„å•ç»†èƒå…¬å…±æ•°æ®è·å–ä¸ä¸Šæ¸¸å¤„ç†</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514146&amp;idx=1&amp;sn=b9721433d49a2d963eeaab1ad47fc91b&amp;scene=21#wechat_redirect" data-linktype="2">åªèƒ½ä¸‹è½½bamæ–‡ä»¶çš„10xå•ç»†èƒè½¬å½•ç»„é¡¹ç›®æ•°æ®å¤„ç†</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247511452&amp;idx=2&amp;sn=83ec97cbc3334a6095e6d63e05e9fd6e&amp;scene=21#wechat_redirect" data-linktype="2">ä¸çŸ¥é“10xå•ç»†èƒè½¬å½•ç»„æ ·å“å’Œfastqæ–‡ä»¶çš„å¯¹åº”å…³ç³»</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247508521&amp;idx=2&amp;sn=2cf3158e74d37b3a741908d8bfc8f02f&amp;scene=21#wechat_redirect" data-linktype="2">10Xå•ç»†èƒè½¬å½•ç»„æµ‹åºæ•°æ®çš„ SRAè½¬fastqè¸©å‘é‚£äº›äº‹</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247514395&amp;idx=2&amp;sn=96c505b76ae87dd0efa737c4c44e2270&amp;scene=21#wechat_redirect" data-linktype="2">10xçš„å•ç»†èƒè½¬å½•ç»„fastqæ–‡ä»¶çš„R1å’ŒR2ä¸èƒ½å¼„æ··å“¦</a></section></li></ul><p data-tool="mdniceç¼–è¾‘å™¨">å·®ä¸å¤šå‡ ä¸ªå°æ—¶å°±å¯ä»¥å®Œæˆå…¨éƒ¨çš„æ ·å“çš„cellrangerçš„å®šé‡æµç¨‹ã€‚åŸºç¡€çŸ¥è¯†éå¸¸é‡è¦ï¼Œæˆ‘ä»¬åœ¨å•ç»†èƒå¤©åœ°å¤šæ¬¡åˆ†äº«è¿‡<strong>cellranger</strong>æµç¨‹çš„ç¬”è®°ï¼ˆ2019å¹´5æœˆï¼‰ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå‰å¾€å­¦ä¹ ï¼Œå¦‚ä¸‹ï¼š</p><ul data-tool="mdniceç¼–è¾‘å™¨"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484146&amp;idx=1&amp;sn=16e09b82d048eed1ff6100b22970abd5&amp;scene=21#wechat_redirect" data-linktype="2">å•ç»†èƒå®æˆ˜(ä¸€)æ•°æ®ä¸‹è½½</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484179&amp;idx=1&amp;sn=fe84f5243a6021fe6afea128e3ac273a&amp;scene=21#wechat_redirect" data-linktype="2">å•ç»†èƒå®æˆ˜(äºŒ) cell rangerä½¿ç”¨å‰æ³¨æ„äº‹é¡¹</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484206&amp;idx=1&amp;sn=edeebbdd092f79361aee87e9ce086d80&amp;scene=21#wechat_redirect" data-linktype="2">å•ç»†èƒå®æˆ˜(ä¸‰) Cell Rangerä½¿ç”¨åˆæ¢</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484355&amp;idx=1&amp;sn=7860fe0c46073a55d2d3700822c3103b&amp;scene=21#wechat_redirect" data-linktype="2">å•ç»†èƒå®æˆ˜(å››) Cell Rangeræµç¨‹æ¦‚è§ˆ</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247484402&amp;idx=1&amp;sn=95c2be0dc6499e4b1eb9a91d79e584d1&amp;scene=21#wechat_redirect" data-linktype="2">å•ç»†èƒå®æˆ˜(äº”) ç†è§£cellranger countçš„ç»“æœ</a></section></li></ul><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/D3DnZPYdWfls4-5UXh1gJw",target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a>
