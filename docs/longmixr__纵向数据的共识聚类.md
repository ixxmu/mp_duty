---
title: "longmixrâ€”â€”çºµå‘æ•°æ®çš„å…±è¯†èšç±»"
date: 2022-09-12T14:08:29Z
draft: ["false"]
tags: [
  "fetched",
  "åŒ»å­¦åƒ§çš„ç§‘ç ”æ—¥è®°"
]
categories: ["Acdemic"]
---
longmixrâ€”â€”çºµå‘æ•°æ®çš„å…±è¯†èšç±» by åŒ»å­¦åƒ§çš„ç§‘ç ”æ—¥è®°
------
<div><p>ConsensusClusterPlusåŒ…å„ä½éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œè¿™æ˜¯æœ€ç®€å•çš„åŒ…ä¹‹ä¸€ï¼ŒåŒåå‡½æ•°åªéœ€è¦ä¸€æ­¥å°±å¯ä»¥å¯¹çŸ©é˜µè¿›è¡Œèšç±»ï¼Œå‚æ•°æ˜“è°ƒï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚ä½†æ˜¯å®ƒå´å¯¹çºµå‘æ•°æ®æ— èƒ½ä¸ºåŠ›ï¼Œè¿™æ—¶å€™longmixrå°±ç«™äº†å‡ºæ¥ï¼Œlongmixrä¸å…¶åŠŸèƒ½ç±»åŒï¼Œä½†æ˜¯å®ƒå¯é€‚ç”¨äºçºµå‘æ•°æ®å’Œæ··åˆæ•°æ®ï¼Œå¹¶ä¸”å‡½æ•°ç”¨æ³•ã€å‚æ•°åŠç¡®å®šæœ€ä½³èšç±»æ•°kæ–¹æ³•ç›¸ä¼¼ï¼Œä½•ä¸æ‰“åŒ…ä¸€å—å­¦èµ°ï¼Ÿï¼ˆçºµå‘æ•°æ®ï¼šä¸€åƒä¸ªåŸºå› çš„è¡¨è¾¾çŸ©é˜µæ˜¯ç¬æ—¶çš„ï¼Œå¦‚æœæ¯ä¸ªåŸºå› æµ‹4æ¬¡ï¼ŒçŸ©é˜µå°±æœ‰å››åƒè¡Œï¼Œå°±å˜æˆäº†çºµå‘æ•°æ®ï¼‰</p><section><iframe data-vidtype="2" data-mpvid="wxv_2573213668297981954" data-cover="http%3A%2F%2Fmmbiz.qpic.cn%2Fmmbiz_jpg%2FeBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbODaZ5k3Z81w49j4mBbw4OL7kzdbcibnPNicf3fYxfDKU5chY4PkBrJDg%2F0%3Fwx_fmt%3Djpeg" allowfullscreen="" frameborder="0" data-ratio="1.7777777777777777" data-w="1920" data-src="https://mp.weixin.qq.com/mp/readtemplate?t=pages/video_player_tmpl&amp;action=mpvideo&amp;auto=0&amp;vid=wxv_2573213668297981954"></iframe></section><p><img data-ratio="0.7453608247422681" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbic4FVSNibziafv74LG7A9Zsibfib7KBib80I9OXjl1jC7aK9ABDRao2MiamMA/640?wx_fmt=png" data-type="png" data-w="970" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbic4FVSNibziafv74LG7A9Zsibfib7KBib80I9OXjl1jC7aK9ABDRao2MiamMA/640?wx_fmt=png"></p><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#åŠ è½½åŒ…</span></span></code><code><span><span>library</span>(longmixr)</span></code><code><span><span>library</span>(dplyr)</span></code><code><span><span>library</span>(tidyr)</span></code><code><span><span>library</span>(ggplot2)</span></code><code><span><span>library</span>(ggalluvial)</span></code><code><span><span>library</span>(FactoMineR)</span></code><code><span><span>library</span>(factoextra)</span></code><code><span><span>library</span>(lme4)</span></code><code><span><span>library</span>(purrr)</span></code></pre></section><section><ul><li><li></ul><pre data-lang="apache"><code><span><span>#åŠ è½½å†…åµŒç¤ºä¾‹æ•°æ®</span></span></code><code><span><span>data</span>(<span>"fake_questionnaire_data"</span>)</span></code></pre></section><p><br></p><p>è¯¥æ•°æ®é›†åŒ…å«100 åå—è¯•è€…åœ¨å››ä¸ªä¸åŒæ—¶é—´ç‚¹çš„è§‚å¯Ÿç»“æœï¼Œæ•°æ®åˆ†ä¸ºä¸¤ç»„ã€‚å¯¹äºæ¯ä¸ªäººï¼Œä¿¡æ¯åŒ…æ‹¬ï¼š</p><p>ç¬¬ä¸€ä¸ªæ—¶é—´ç‚¹çš„å¹´é¾„</p><p>é—®å·A åŒ…å«äº”ä¸ªé¡¹ç›®ï¼ˆæˆ–æ¢è¨€ä¹‹å˜é‡ï¼‰ï¼Œåˆ†ç±»çº§åˆ«ä¸º1 - 5</p><p>é—®å·B åŒ…å«äº”ä¸ªé¡¹ç›®ï¼ˆæˆ–æ¢è¨€ä¹‹å˜é‡ï¼‰ï¼Œåˆ†ç±»çº§åˆ«ä¸º1 - 5</p><p>é—®å·C åŒ…å«äº”ä¸ªè¿ç»­å˜é‡</p><p>è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„è¿ç»­å˜é‡</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#é™ç»´ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæœ‰å¾ˆå¤šå˜é‡ï¼Œåˆ™é™ä½åˆ†æçš„ç»´æ•°å¯èƒ½å¾ˆæœ‰æ„ä¹‰</span></span></code><code><span><span>#ä½¿ç”¨FactoMineRåŒ…ä¸­çš„å‡½æ•°FAMDï¼Œå®ƒä¸PCAç±»ä¼¼ã€‚ä¸ºäº†æ›´å¥½çš„å¯è§£é‡Šæ€§ï¼Œå¯¹æ¯ä¸ªé—®å·è¿›è¡Œé™ç»´</span></span></code><code><span><span>quest_A_dim</span> &lt;- fake_questionnaire_data %&gt;% </span></code><code><span>  <span>select</span>(starts_with(<span>"questionnaire_A"</span>)) %&gt;% </span></code><code><span>  <span>FAMD</span>(ncp = 5, graph = FALSE)</span></code><code><span><br></span></code><code><span><span>quest_B_dim</span> &lt;- fake_questionnaire_data %&gt;% </span></code><code><span>  <span>select</span>(starts_with(<span>"questionnaire_B"</span>)) %&gt;% </span></code><code><span>  <span>FAMD</span>(ncp = 5, graph = FALSE)</span></code><code><span><br></span></code><code><span><span>quest_C_dim</span> &lt;- fake_questionnaire_data %&gt;% </span></code><code><span>  <span>select</span>(starts_with(<span>"questionnaire_C"</span>)) %&gt;% </span></code><code><span>  <span>prcomp</span>(scale = TRUE)</span></code></pre></section><section><ul><li><li></ul><pre data-lang="apache"><code><span><span>#å¯ä»¥ä½¿ç”¨æ‰‹è‚˜å›¾ç›´è§‚åœ°ç¡®å®šè¦åŒ…å«åœ¨åˆ†æä¸­çš„ç»„ä»¶æ•°é‡</span></span></code><code><span><span>fviz_screeplot</span>(quest_A_dim,Â mainÂ =Â <span>"QuestionnaireÂ A"</span>)</span></code></pre></section><p><img data-ratio="0.7209677419354839" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb9S2wI3X8E8IFibkkib7kSx1Lb6Pj4AhlztP5cv2v7JI1wicaCrXSiaP5gw/640?wx_fmt=png" data-type="png" data-w="620" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb9S2wI3X8E8IFibkkib7kSx1Lb6Pj4AhlztP5cv2v7JI1wicaCrXSiaP5gw/640?wx_fmt=png"></p><p><span>å¯¹äºé—®å·Aï¼Œåªé€‰æ‹©å‰ä¸‰ä¸ªç»„åˆ†ï¼Œå› ä¸ºå…¶ä»–ç»„åˆ†åªè§£é‡Šäº†å°‘é‡çš„æ–¹å·®ã€‚</span></p><section><ul><li></ul><pre data-lang="javascript"><code><span>fviz_screeplot(quest_B_dim, main = <span>"Questionnaire B"</span>)</span></code></pre></section><p><img data-ratio="0.7115072933549432" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbiapXEP8tTwiblgwnibzXTfESDXQC1VnhBFfE3kDpqvzVOmnbZOUtnwPBw/640?wx_fmt=png" data-type="png" data-w="617" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbiapXEP8tTwiblgwnibzXTfESDXQC1VnhBFfE3kDpqvzVOmnbZOUtnwPBw/640?wx_fmt=png"></p><p>å¯¹äºé—®å·Bï¼ŒåªåŒ…å«ç¬¬ä¸€ä¸ªç»„åˆ†ã€‚</p><section><ul><li></ul><pre data-lang="javascript"><code><span>fviz_screeplot(quest_C_dim, main = <span>"Questionnaire C"</span>)</span></code></pre></section><p><img data-ratio="0.7188552188552189" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbJn08ou7UxPdl48ZhlGq7FOCAsbj2Q5l3LIuZLUf2LulSzp8ibaruhqw/640?wx_fmt=png" data-type="png" data-w="594" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbJn08ou7UxPdl48ZhlGq7FOCAsbj2Q5l3LIuZLUf2LulSzp8ibaruhqw/640?wx_fmt=png"></p><p><span>å¯¹äº</span><span>é—®å·</span><span>Cï¼ŒåªåŒ…</span><span>å«ç¬¬ä¸€ä¸ªç»„åˆ†ã€‚</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#å°†è¢«é€‰æ‹©çš„ç»„åˆ†æ±‡æ€»</span></span></code><code><span><span>quest_A_comp</span> &lt;- as.data.frame(quest_A_dim$ind$coord[, 1:3])</span></code><code><span><span>colnames</span>(quest_A_comp) &lt;- paste0(<span>"quest_A_"</span>, 1:3)</span></code><code><span><span>quest_B_comp</span> &lt;- as.data.frame(quest_B_dim$ind$coord[, 1])</span></code><code><span><span>colnames</span>(quest_B_comp) &lt;- paste0(<span>"quest_B_"</span>, 1)</span></code><code><span><span>quest_C_comp</span> &lt;- as.data.frame(quest_C_dim$x[, 1])</span></code><code><span><span>colnames</span>(quest_C_comp) &lt;- paste0(<span>"quest_C_"</span>, 1)</span></code><code><span><br></span></code><code><span><span>cluster_data</span> &lt;- bind_cols(</span></code><code><span>  <span>data</span>.frame(</span></code><code><span>    <span>ID</span> = fake_questionnaire_data$ID,</span></code><code><span>    <span>visit</span> = fake_questionnaire_data$visit,</span></code><code><span>    <span>age</span> = fake_questionnaire_data$age_visit_1</span></code><code><span>  ),</span></code><code><span>  <span>quest_A_comp</span>,</span></code><code><span>  <span>quest_B_comp</span>,</span></code><code><span>  <span>quest_C_comp</span></span></code><code><span>)</span></code></pre></section><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span><span>#æ··æ‚å› ç´ ï¼šå¯èƒ½å­˜åœ¨å¯¹ä¸æƒ³åˆ†æçš„ç»“æœæœ‰å·²çŸ¥å½±å“çš„æ··æ‚å› ç´ ã€‚</span></span></code><code><span><span>#ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯é¦–å…ˆåœ¨çº¿æ€§æ¨¡å‹ä¸­â€œå°†å®ƒä»¬å›å½’â€ï¼Œå¹¶ä¸”åªä½¿ç”¨ç”Ÿæˆçš„æ®‹å·®ã€‚</span></span></code><code><span><span>#æ¯”å¦‚é—®å·A</span></span></code><code><span>ggplot(cluster_data, aes(x = age, y = quest_A_1)) +</span></code><code><span>  geom_point() +</span></code><code><span>  geom_smooth(method = <span>"lm"</span>) +</span></code><code><span>  ylab(<span>"Questionnaire A dimension 1"</span>) +</span></code><code><span>  theme_bw()</span></code></pre></section><p><img data-ratio="0.71900826446281" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbXIIjNq0P2sXqKRGbibC0ibqNGUHW0sic5MxWexvFpic63VBOpnz4BIun2g/640?wx_fmt=png" data-type="png" data-w="605" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbXIIjNq0P2sXqKRGbibC0ibqNGUHW0sic5MxWexvFpic63VBOpnz4BIun2g/640?wx_fmt=png"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#ä½¿ç”¨çº¿æ€§æ··åˆæ¨¡å‹æ¥å›å½’ç”¨äºèšç±»çš„æ‰€æœ‰ç»„åˆ†ä¸­çš„å¹´é¾„æ•ˆåº”ï¼š</span></span></code><code><span><span>generate_residuals</span> &lt;- function(x, age, ID) {</span></code><code><span>  <span>data</span> &lt;- data.frame(</span></code><code><span>    <span>x</span> = x,</span></code><code><span>    <span>age</span> = age,</span></code><code><span>    <span>ID</span> = ID)</span></code><code><span>  <span>model</span> &lt;- lmer(x ~ age + (1 | ID), data = data)</span></code><code><span>  <span>resid</span> &lt;- residuals(model, type = <span>"response"</span>)</span></code><code><span>  <span>names</span>(resid) &lt;- NULL</span></code><code><span>  <span>resid</span></span></code><code><span>}</span></code><code><span><br></span></code><code><span><span>cluster_data_resid</span>Â &lt;-Â cluster_dataÂ %&gt;%Â </span></code><code><span>  <span>mutate</span>(across(matches(<span>"[1-9]$"</span>),</span></code><code><span>                ~<span>generate_residuals</span>(x = .x, age = age, ID = ID),</span></code><code><span>                .<span>names</span> = <span>"{.col}_resid"</span>)) %&gt;% </span></code><code><span>  <span>select</span>(ID, visit, ends_with(<span>"resid"</span>), age)</span></code></pre></section><section><ul><li><li><li><li><li><li></ul><pre data-lang="javascript"><code><span>#å›å½’åï¼Œæ®‹å·®ä¸­ä¸å†åŒ…å«å¹´é¾„çš„çº¿æ€§æ•ˆåº”ã€‚</span></code><code><span>ggplot(cluster_data_resid, aes(x = age, y = quest_A_1_resid)) +</span></code><code><span>  geom_point() +</span></code><code><span>  geom_smooth(method = <span>"lm"</span>) +</span></code><code><span>  ylab(<span>"Residuals of questionnaire A dimension 1"</span>) +</span></code><code><span>  theme_bw()</span></code></pre></section><p><img data-ratio="0.7200674536256324" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb7s7bEeSDq3ibFIbcrYt90owkS4ULKV1dlToYupcTiazuOffX4wpwmMTQ/640?wx_fmt=png" data-type="png" data-w="593" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb7s7bEeSDq3ibFIbcrYt90owkS4ULKV1dlToYupcTiazuOffX4wpwmMTQ/640?wx_fmt=png"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#èšç±»ï¼Œå¯¹äºæ¯ä¸ªå˜é‡ï¼Œéœ€è¦æ„å»ºä¸€ä¸ªæ¨¡å‹ï¼ˆä¸å…±è¯†èšç±»çš„æœ€å¤§ä¸åŒä¹‹å¤„ï¼‰</span></span></code><code><span><span>response_names</span> &lt;- c(paste0(<span>"quest_A_"</span>, 1:3, <span>"_resid"</span>),</span></code><code><span>                    <span>paste0</span>(<span>"quest_B_"</span>, 1, <span>"_resid"</span>),</span></code><code><span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span>paste0</span>(<span>"quest_C_"</span>,Â 1,Â <span>"_resid"</span>))</span></code><code><span><span>list_models</span> &lt;- lapply(response_names, function(x) {</span></code><code><span>  <span>flexmix</span>::FLXMRmgcv(as.formula(paste0(x, <span>" ~ ."</span>)))</span></code><code><span>})</span></code><code><span><span>set</span>.seed(2378)</span></code><code><span><span>cluster_model</span> &lt;- longitudinal_consensus_cluster(data = cluster_data_resid,</span></code><code><span>                                                <span>id_column</span> = <span>"ID"</span>,</span></code><code><span>                                                <span>max_k</span> = 3,</span></code><code><span>                                                <span>reps</span> = 5,</span></code><code><span>                                                <span>p_item</span> = 0.8,</span></code><code><span>                                                <span>model_list</span> = list_models,</span></code><code><span>                                                <span>flexmix_formula</span> = as.formula(<span>"~s(visit, k = 4) | ID"</span>),</span></code><code><span>                                                <span>final_linkage</span> = <span>"ward.D2"</span>)</span></code></pre></section><section><ul><li><li></ul><pre data-lang="apache"><code><span><span>#åˆ†æèšç±»ï¼Œç¡®å®šæœ€ä½³èšç±»æ•°</span></span></code><code><span><span>plot</span>(cluster_model)</span></code></pre></section><p><img data-ratio="0.8940886699507389" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbjH2psGn2UQyZP2ib8LdaricKa7MHGicFl3blLnM2chUbXTGHF5ncqdIew/640?wx_fmt=png" data-type="png" data-w="406" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbjH2psGn2UQyZP2ib8LdaricKa7MHGicFl3blLnM2chUbXTGHF5ncqdIew/640?wx_fmt=png"></p><p><img data-ratio="0.6934931506849316" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbb3GQib22xWxxYEDtQOP8cXbKU54MaW0csVJ0hBYje9BCvINqSUYZXtg/640?wx_fmt=png" data-type="png" data-w="584" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbb3GQib22xWxxYEDtQOP8cXbKU54MaW0csVJ0hBYje9BCvINqSUYZXtg/640?wx_fmt=png"></p><p><img data-ratio="0.6650717703349283" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb03rmdymISMO2DsddvcJ9iaRQEQy4Khdjykiag6hqtB7wYjapb6YavM1A/640?wx_fmt=png" data-type="png" data-w="627" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb03rmdymISMO2DsddvcJ9iaRQEQy4Khdjykiag6hqtB7wYjapb6YavM1A/640?wx_fmt=png"></p><p><img data-ratio="0.6716171617161716" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbchUbOHfgmxkpHiaZ6MD6kU8AY8LHtmChq2ibzM7MyHNMltj8yaicM9BiaQ/640?wx_fmt=png" data-type="png" data-w="606" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbchUbOHfgmxkpHiaZ6MD6kU8AY8LHtmChq2ibzM7MyHNMltj8yaicM9BiaQ/640?wx_fmt=png"></p><p><img data-ratio="0.6672212978369384" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbmn9wQhr8DCl2Q1MRgLKUj8xibmicYIvSTpch35Ajv8DJJalibDeibVsYVg/640?wx_fmt=png" data-type="png" data-w="601" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbmn9wQhr8DCl2Q1MRgLKUj8xibmicYIvSTpch35Ajv8DJJalibDeibVsYVg/640?wx_fmt=png"></p><section><ul><li></ul><pre data-lang="apache"><code><span><span>#å¯è§†åŒ–</span></span></code></pre></section><section><ul><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#é€‰æ‹©k=2ä½œä¸ºæœ€ä½³èšç±»æ•°ï¼Œæå–èšç±»ä¿¡æ¯</span></span></code><code><span><span>cluster_assignments</span> &lt;- get_clusters(cluster_model, number_clusters = 2)</span></code><code><span><span>original_data</span> &lt;- fake_questionnaire_data %&gt;% </span></code><code><span>  <span>left_join</span>(cluster_assignments, by = <span>"ID"</span>)</span></code><code><span><span>cluster_data_resid</span>Â &lt;-Â cluster_data_residÂ %&gt;%Â </span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#å®šä¹‰ç»˜å›¾å‡½æ•°ï¼ˆæ„å¤§åˆ©é¢å›¾ï¼‰</span></span></code><code><span><span>plot_spaghetti</span> &lt;- function(data = cluster_data_resid,</span></code><code><span>                           <span>num_clus</span> = 2,</span></code><code><span>                           <span>var_type</span> = c(<span>"quest_A"</span>, <span>"quest_B"</span>, <span>"quest_C"</span>),</span></code><code><span>                           <span>var_nums</span> = 1:3,</span></code><code><span>                           <span>scale_arg</span> = <span>"fixed"</span>) {</span></code><code><span>  <span>var_type</span> &lt;- match.arg(var_type)</span></code><code><span>  <span>clus_assign</span> &lt;- paste0(<span>"assignment_num_clus_"</span>, num_clus)</span></code><code><span>  </span></code><code><span>  <span>plot_data</span> &lt;- data %&gt;% </span></code><code><span>    <span>pivot_longer</span>(</span></code><code><span>      <span>cols</span> = paste0(var_type, <span>"_"</span>, var_nums, <span>"_resid"</span>),</span></code><code><span>      <span>names_to</span> = <span>"variable"</span></span></code><code><span>    ) %&gt;% </span></code><code><span>    <span># this step to create a patient_idID per variable is needed, otherwise</span></span></code><code><span>    <span># ggplot can't differentiate between the different variables</span></span></code><code><span>    <span>mutate</span>(ID = paste0(ID, <span>"_"</span>, variable),</span></code><code><span>           <span>across</span>(c(visit, variable, ID), as.factor))</span></code><code><span>  </span></code><code><span>  <span>additional_data</span> &lt;- plot_data %&gt;% </span></code><code><span>    <span>select</span>(visit, value, variable, .data[[clus_assign]]) %&gt;% </span></code><code><span>    <span>group_by</span>(visit, variable, .data[[clus_assign]]) %&gt;% </span></code><code><span>    <span>summarise</span>(mean = mean(value),</span></code><code><span>              <span>sd</span> = sd(value)) %&gt;% </span></code><code><span>    <span>mutate</span>(ID = 1)</span></code><code><span>  </span></code><code><span>  <span>ggplot</span>(data = plot_data) +</span></code><code><span>    <span>geom_line</span>(mapping = aes(x = visit, y = value, col = variable, group = ID),</span></code><code><span>              <span>alpha</span> = 0.4) +</span></code><code><span>    <span>geom_ribbon</span>(data = additional_data,</span></code><code><span>                <span>mapping</span> = aes(x = visit, y = mean, ymin = mean - sd, ymax = mean + sd,</span></code><code><span>                              <span>fill</span> = variable, group = variable), alpha = 0.3) +</span></code><code><span>    <span>geom_line</span>(data = additional_data,</span></code><code><span>              <span>mapping</span> = aes(x = visit, y = mean, col = variable, group = variable),</span></code><code><span>              <span>size</span> = 2) +</span></code><code><span>    <span>facet_wrap</span>(~as.factor(.data[[clus_assign]]), scales = scale_arg) +</span></code><code><span>    <span>theme_bw</span>()</span></code><code><span>}</span></code></pre></section><section><ul><li><li></ul><pre data-lang="apache"><code><span><span>#é—®å·A</span></span></code><code><span><span>plot_spaghetti</span>(num_clus = 2, var_type = <span>"quest_A"</span>, var_nums = 1:3)</span></code></pre></section><p><img data-ratio="0.7559322033898305" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbXV7A4I70kZDHUFpcaXcG8a5tXWR1QYicWG0W3OhkmImQicpBE2Yj7keg/640?wx_fmt=png" data-type="png" data-w="590" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbXV7A4I70kZDHUFpcaXcG8a5tXWR1QYicWG0W3OhkmImQicpBE2Yj7keg/640?wx_fmt=png"></p><section><ul><li><li></ul><pre data-lang="apache"><code><span><span>#é—®å·B</span></span></code><code><span><span>plot_spaghetti</span>(num_clus = 2, var_type = <span>"quest_B"</span>, var_nums = 1)</span></code></pre></section><p><img data-ratio="0.7478849407783418" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb218YucvnUghQySYRj9qI2XEGJa6dXfSiaiagGZMqLibsZPBaoUw1jjA1A/640?wx_fmt=png" data-type="png" data-w="591" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb218YucvnUghQySYRj9qI2XEGJa6dXfSiaiagGZMqLibsZPBaoUw1jjA1A/640?wx_fmt=png"></p><section><ul><li><li></ul><pre data-lang="apache"><code><span><span>#é—®å·C</span></span></code><code><span><span>plot_spaghetti</span>(num_clus = 2, var_type = <span>"quest_C"</span>, var_nums = 1)</span></code></pre></section><p><img data-ratio="0.7491408934707904" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbMJ9437frp2PoyJ7V9OPjhUkYswHCFSzGe16HQic9HbWA4D8301TiaUxA/640?wx_fmt=png" data-type="png" data-w="582" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbMJ9437frp2PoyJ7V9OPjhUkYswHCFSzGe16HQic9HbWA4D8301TiaUxA/640?wx_fmt=png"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#ä½¿ç”¨æ¡‘åŸºå›¾æ¥å¯è§†åŒ–æ¯ç»„æ¯ä¸ªå˜é‡éšæ—¶é—´å˜åŒ–çš„è¶‹åŠ¿</span></span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>#å®šä¹‰ç»˜å›¾å‡½æ•°</span></span></code><code><span><span>plot_alluvial</span> &lt;- function(data = original_data,</span></code><code><span>                          <span>num_clus</span> = 2,</span></code><code><span>                          <span>var_name</span>) {</span></code><code><span>  <span>clus_assign</span> &lt;- paste0(<span>"assignment_num_clus_"</span>, num_clus)</span></code><code><span>  </span></code><code><span>  <span>p</span> &lt;- data %&gt;% </span></code><code><span>    <span>ggplot</span>(aes(x = visit,</span></code><code><span>               <span>stratum</span> = .data[[var_name]],</span></code><code><span>               <span>alluvium</span> = ID,</span></code><code><span>               <span>fill</span> = .data[[var_name]],</span></code><code><span>               <span>label</span> = .data[[var_name]])) +</span></code><code><span>    <span>scale_fill_brewer</span>(type = <span>"qual"</span>, palette = <span>"Set2"</span>) +</span></code><code><span>    <span>geom_flow</span>(stat = <span>"alluvium"</span>, lode.guidance = <span>"frontback"</span>,</span></code><code><span>              <span>color</span> = <span>"darkgray"</span>) +geom_stratum() +</span></code><code><span>    <span>facet_wrap</span>(~as.factor(.data[[clus_assign]])) +</span></code><code><span>    <span>theme_bw</span>() +</span></code><code><span>    <span>theme</span>(legend.position = <span>"bottom"</span>) +</span></code><code><span>    <span>ylab</span>(<span>"number of subjects"</span>) +</span></code><code><span>    <span>ggtitle</span>(paste0(<span>"Distribution of "</span>, var_name, <span>" across clusters"</span>))</span></code><code><span>  </span></code><code><span>  <span>print</span>(p)</span></code><code><span>}</span></code></pre></section><section><ul><li><li><li></ul><pre data-lang="apache"><code><span><span>#ä»¥é—®å·Aä¸ºä¾‹</span></span></code><code><span><span>colnames</span>(original_data)[grepl(<span>"^questionnaire_A"</span>, colnames(original_data))] %&gt;% </span></code><code><span>  <span>walk</span>(~plot_alluvial(num_clus = 2, var_name = .x))</span></code></pre></section><p><img data-ratio="0.7306967984934086" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbfXjI1JZQLv4hgJSVicQgjScGJ5anZUMobdaEgrxGCtKmMIyErzx25WQ/640?wx_fmt=png" data-type="png" data-w="531" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbfXjI1JZQLv4hgJSVicQgjScGJ5anZUMobdaEgrxGCtKmMIyErzx25WQ/640?wx_fmt=png"></p><p><img data-ratio="0.7078853046594982" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb1wibt2MCt6ncWF4HicU5z8yib2Y9ia7uESuW9jKFYMMOzZriaq8P3ic86JbA/640?wx_fmt=png" data-type="png" data-w="558" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVb1wibt2MCt6ncWF4HicU5z8yib2Y9ia7uESuW9jKFYMMOzZriaq8P3ic86JbA/640?wx_fmt=png"></p><p><img data-ratio="0.7343453510436433" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbEwJlqIc1LIdQOOFu0Ih1FcR4TCSeqFmFElvrD3ibEvwrQZzUyjh3gzA/640?wx_fmt=png" data-type="png" data-w="527" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbEwJlqIc1LIdQOOFu0Ih1FcR4TCSeqFmFElvrD3ibEvwrQZzUyjh3gzA/640?wx_fmt=png"></p><p><img data-ratio="0.7332089552238806" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbWIdQtqc9K0pKoCic2Ft8amSkLkstdbxIqCeFicqLBkYrEmcuA0c5Czicw/640?wx_fmt=png" data-type="png" data-w="536" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbWIdQtqc9K0pKoCic2Ft8amSkLkstdbxIqCeFicqLBkYrEmcuA0c5Czicw/640?wx_fmt=png"></p><p><img data-ratio="0.7419962335216572" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVboPTxsuSHL0z5iaK2NQn6oibsMaSnDa856FR9QDCvibFepNh7BiaRhicWdhg/640?wx_fmt=png" data-type="png" data-w="531" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVboPTxsuSHL0z5iaK2NQn6oibsMaSnDa856FR9QDCvibFepNh7BiaRhicWdhg/640?wx_fmt=png"></p><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span>#ç»„é—´æ¯”è¾ƒ</span></span></code><code><span><span>#è¿˜è®°å¾—æ²¡ä½¿ç”¨è¿‡çš„å•ä¸ªè¿ç»­å˜é‡å—ï¼Ÿ</span></span></code><code><span><span>original_data</span> %&gt;% </span></code><code><span>  <span>filter</span>(visit == 1) %&gt;% </span></code><code><span>  <span>mutate</span>(cluster = as.factor(assignment_num_clus_2)) %&gt;% </span></code><code><span>  <span>ggplot</span>(aes(x = cluster, y = single_continuous_variable,</span></code><code><span>             <span>fill</span> = cluster)) +</span></code><code><span>  <span>geom_boxplot</span>() +</span></code><code><span>  <span>theme_bw</span>()</span></code></pre></section><p><img data-ratio="0.7412199630314233" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbXeTPNa7ytJT24W0nJZenEBRPqQvugtFV35XiaiaQYOLsK4rHnIcKYXHA/640?wx_fmt=png" data-type="png" data-w="541" src="https://mmbiz.qpic.cn/mmbiz_png/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbXeTPNa7ytJT24W0nJZenEBRPqQvugtFV35XiaiaQYOLsK4rHnIcKYXHA/640?wx_fmt=png"></p><p>æ€ä¹ˆæ ·ï¼Œè¿™ä¹ˆå®ç”¨çš„åŒ…å’Œå‡½æ•°è¿˜ä¸èµ¶å¿«å­¦èµ·æ¥~</p><p><img data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbyXLjrV4X8qCDU47s5RVyqjjHk2n9GzRyiaBXQ7XpmP6SpIQFibicEcgTg/640?wx_fmt=jpeg" data-type="jpeg" data-w="960" src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8dfg21QWSuibJV7mP0QfRPVbyXLjrV4X8qCDU47s5RVyqjjHk2n9GzRyiaBXQ7XpmP6SpIQFibicEcgTg/640?wx_fmt=jpeg"></p><section>å†™åœ¨åé¢<br></section><section>åŒ»å­¦åƒ§çš„å¿ƒæ„¿æ˜¯ä¸ºåŒ»å­¦åƒ§çš„æ”¯æŒè€…å’Œç§‘ç ”çˆ±å¥½è€…è¥é€ ä¸€ä¸ªå‹¤å­¦å¥½é—®ã€äº’å¸®äº’åŠ©ã€å…±åŒè¿›æ­¥çš„ä¼˜è‰¯ç¯å¢ƒã€‚ä½†æ˜¯äººå¤šäº†éš¾å…é±¼é¾™æ··æ‚ï¼Œè‰¯è ä¸é½ï¼Œç¾¤é‡Œä¸ä¹æœ‰çœŸå¿ƒå®æ„ã€è„šè¸å®åœ°çš„ç§‘ç ”äººï¼Œæˆ‘ä»¬å¾ˆå°Šé‡å¹¶æ¬¢è¿ä»–ä»¬ï¼Œå› æ­¤ä¸å¸Œæœ›è¢«å°‘æ•°æ¥å‘å¹¿å‘Šçš„ã€åˆ’æ°´çš„ã€çœ‹çƒ­é—¹çš„ã€å ä¸ªå‘çš„æ‰€æ‰“æ‰°ï¼Œæœ€ç»ˆæˆ‘ä»¬çš„å¿ƒæ„ä»˜ä¹‹ä¸œæµï¼Œå¤§å®¶çš„çƒ­æƒ…æ¶ˆç£¨æ®†å°½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å†³å®šæé«˜å…¥ç¾¤çš„é—¨æ§›â€”â€”æ”¶è´¹è¿›ç¾¤ï¼Œè¿™æ ·ï¼Œæ„¿æ„è¿›ç¾¤çš„åŒå¿—ç›¸ä¿¡ä¹Ÿæ˜¯ä¸ªåœˆå†…æ´»è·ƒç”¨æˆ·ï¼Œåœˆå†…äººç›¸äº’äº¤æµï¼Œå²‚ä¸å¿«å“‰ï¼</section><section><span>å› </span><span>æ­¤</span><span>ï¼Œä¸ºäº†æå‡å¤§å®¶çš„æ•ˆç‡ï¼Œè°ƒåŠ¨å¤§å®¶çš„ç§¯ææ€§ï¼Œå¸æ”¶çœŸæ­£çš„ç§‘ç ”çˆ±å¥½è€…ï¼Œå½¢æˆä¸€ä¸ªè‰¯å¥½çš„å­¦ä¹ äº¤æµæ°›å›´ï¼Œæˆ‘ä»¬å†³å®šå¢åŠ ç¾¤çš„æ•°é‡ï¼Œå¹¶ç»†åŒ–ç¾¤çš„åŠŸèƒ½ï¼Œæš‚æ—¶å¢åŠ ä»¥ä¸‹å‡ ä¸ªä¸»é¢˜ç¾¤ï¼š</span></section><ul><li><p>æ–‡çŒ®ä¸‹è½½-åŒ»å­¦åƒ§</p></li><li><p>æœºå™¨å­¦ä¹ ï¼ˆåˆ†ç±»ï¼‰-åŒ»å­¦åƒ§</p></li><li><p>ggplotå¯è§†åŒ–-åŒ»å­¦åƒ§</p></li><li><p>çƒ­å›¾å¯è§†åŒ–-åŒ»å­¦åƒ§</p></li><li><p>TCGAæŒ–æ˜-åŒ»å­¦åƒ§</p></li><li><p>GEOæŒ–æ˜-åŒ»å­¦åƒ§</p></li><li><p>è‚¿ç˜¤é¢„åæ¨¡å‹-åŒ»å­¦åƒ§</p></li><li><p>è‚¿ç˜¤åˆ†å­äºšå‹-åŒ»å­¦åƒ§</p></li></ul><p>æ¬¢è¿å°ä¼™ä¼´ä»¬è¿›ç¾¤ğŸ‘ğŸ‘ğŸ‘ï¼Œæ¯ä¸ªç¾¤æ”¶è´¹15å…ƒã€‚è¯·è”ç³»å°ç¼–å¾®ä¿¡yixuesengkyrjæˆ–æ‰«æä¸‹é¢äºŒç»´ç ï¼š</p><p><img data-ratio="0.8407407407407408" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8enibib3UJd6iaLibROb1ibWJtZn0fyA9Bu9szdIkibpzWVzjw0LIVrQKeHfPS7h1gI8bicaaYlcOnMIyQAQ/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/eBfvI7Ryx8enibib3UJd6iaLibROb1ibWJtZn0fyA9Bu9szdIkibpzWVzjw0LIVrQKeHfPS7h1gI8bicaaYlcOnMIyQAQ/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/8SJ07zPmpF0XoUX_7q6VlQ",target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a>
