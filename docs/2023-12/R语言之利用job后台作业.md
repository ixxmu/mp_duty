---
title: "Rè¯­è¨€ä¹‹åˆ©ç”¨jobåå°ä½œä¸š"
date: 2023-12-28T01:52:35Z
draft: ["false"]
tags: [
  "fetched",
  "å­¦Ræ—¶ä¹ ä¹‹"
]
categories: ["Acdemic"]
---
Rè¯­è¨€ä¹‹åˆ©ç”¨jobåå°ä½œä¸š by å­¦Ræ—¶ä¹ ä¹‹
------
<div><p><span>ç”¨Råˆ†ææ•°æ®æ—¶ï¼Œæœ‰äº›ä»£ç è·‘çš„æ—¶é—´æ¯”è¾ƒä¹…ï¼Œé•¿æ—¶é—´å ç”¨æ§åˆ¶å°ï¼Œå¸¸è§„æƒ…å†µä¸‹å¯ä»¥å‡‘è¿™ä¸ªæ—¶é—´æ‘¸æ‘¸é±¼å•¥çš„â€¦â€¦</span><ne-clipboard source="https%3A%2F%2Fwww.yuque.com%2Fgaodashitou%2Ffra44d%2Ftlchb4ch1wa3ve17"></ne-clipboard></p><p><span>ä½†æ˜¯å…‰è¿™æ ·ç­‰ç€ä¹Ÿä¸æ˜¯äº‹å§ï¼Œæ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆæ–¹æ³•æŠŠè¿™ä¸ªä»»åŠ¡æ”¾åˆ°åå°ï¼ˆLinuxæœ‰</span><code><span><strong><span>nohup [command] &amp;</span></strong></span></code><span>ã€‚æ˜¯å¦Ré‡Œé¢ä¹Ÿæœ‰å‘¢ï¼Ÿ</span></p><p><code><span><strong><span>nohup</span></strong></span></code><span>: no hang upçš„ç¼©å†™, ä¸æŒ‚æ–­çš„è¿è¡Œå‘½ä»¤ã€‚</span></p><p><code><span><strong><span>&amp;</span></strong></span></code><span>: åœ¨åå°è¿è¡Œï¼Œå½“ç”¨æˆ·é€€å‡ºï¼ˆæŒ‚èµ·ï¼‰çš„æ—¶å€™ï¼Œå‘½ä»¤è‡ªåŠ¨è·Ÿç€ç»“æŸã€‚</span></p><p><span>é€šå¸¸</span><code><span><strong><span>nohup</span></strong></span></code><span>å’Œ</span><code><span><strong><span>&amp;</span></strong></span></code><span>ç»“åˆä½¿ç”¨ï¼Œè®©å‘½ä»¤åœ¨åå°é•¿æœŸè¿è¡Œã€‚</span></p><p><span>TLDR: å­¦ä¹ ä¸‹</span><code><span>job::job({&lt;your code&gt;})</span></code><span>ç¥ä»™å‡½æ•°ã€‚</span></p><h2><span>jobåŒ…ç®€ä»‹</span></h2><h1></h1><p>å…ˆæ¥çœ‹çœ‹<code>job</code>åŒ…çš„åŠŸèƒ½ğŸ‘‰ğŸ»è§£æ”¾ä½ çš„Rstudioæ§åˆ¶å°ã€‚</p><p>é€šè¿‡<code>job::job()</code>åœ¨Rstudioçš„<code>Background Jobs</code>è¿è¡Œä»£ç å—ï¼Œå³åœ¨åå°è¿è¡Œä»£ç å—ï¼Œä»è€Œè§£æ”¾æ§åˆ¶å°ã€‚</p><p><img data-imgfileid="100002567" data-ratio="0.2759259259259259" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrMGRp3j8icdgMzor42AjCBsd53dACAgicTFsc7MiaoYdJOeMz2e86S7OGw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="870" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrMGRp3j8icdgMzor42AjCBsd53dACAgicTFsc7MiaoYdJOeMz2e86S7OGw/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100002563" data-ratio="0.35" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrYibJtibIXcWXGcZLlwnf23UT7AZQ29FuGHupvfmAyY1IXxdc82NPe0lQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="800" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrYibJtibIXcWXGcZLlwnf23UT7AZQ29FuGHupvfmAyY1IXxdc82NPe0lQ/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>Minimal example</span></h2><p><code>job::job()</code>çš„æ ¼å¼æ˜¯<code>job::job({your code})</code>ï¼Œæ‰€ä»¥å’±ä»¬åªéœ€è¦æŠŠä»£ç ç”¨<code>job::job({})</code>åŒ…è£…ä¸‹å³å¯ã€‚</p><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com"><pre data-tool="mdniceç¼–è¾‘å™¨"><span></span><code>job::job({<br>Â Â fooÂ =Â 10<br>Â Â barÂ =Â rnorm(5)<br>})<span></span></code></pre></section><p><img data-imgfileid="100002564" data-ratio="0.20462962962962963" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrtLWiaeDvWnc3ibjibzziaFdqvGqczub7VnWtLpnxeM9LgCOdUVIlABkeAA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1384" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrtLWiaeDvWnc3ibjibzziaFdqvGqczub7VnWtLpnxeM9LgCOdUVIlABkeAA/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100002565" data-ratio="0.2111111111111111" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrzJO1vjyBNr5J0obqBaQ9NnF4sEZgDSG4KicyxlicicOicfnDUyQtVM8gLw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1355" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrzJO1vjyBNr5J0obqBaQ9NnF4sEZgDSG4KicyxlicicOicfnDUyQtVM8gLw/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>Typical usuage</span></h2><p>ä¸‹é¢å±•ç¤º<code>job::job()</code>çš„ç»å…¸ç”¨æ³•ï¼Œä»¥<code>brms</code>ä¸ºä¾‹ã€‚</p><p>brms: Bayesian Regression Models using 'Stan', ä½¿ç”¨stanå®ç°è´å¶æ–¯å¤šçº§æ¨¡å‹ã€‚</p><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com"><pre data-tool="mdniceç¼–è¾‘å™¨"><span></span><code>rm(listÂ =Â ls())<br>librarian::shelf(brms)<br><br>dataÂ =Â mtcars[mtcars<span>$hp</span>Â &gt;Â 100,Â ]<br>model1Â =Â mpgÂ ~Â hpÂ *Â wt<br>model2Â =Â mpgÂ ~Â hpÂ +Â wt<br><br>job::job({<br>Â Â fit1Â =Â brm(model1,Â data)<br>})<br>job::job({<br>Â Â fit2Â =Â brm(model2,Â data)<br>})<span></span></code></pre></section><p><img data-imgfileid="100002566" data-ratio="0.26944444444444443" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrGrmupbhhtxXAFKjiclx3QszKRo6NkosicHYOJXOKNibfWH1iajz51lDQeQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1268" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrGrmupbhhtxXAFKjiclx3QszKRo6NkosicHYOJXOKNibfWH1iajz51lDQeQ/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>Tweak your jobs</span></h2><p>ä¸Šé¢æ˜¯ç»å…¸çš„ç”¨æ³•ï¼Œä¸‹é¢ç»™è¦è¿è¡Œçš„ä»£ç å—èµ·ä¸ªåå­—ã€‚</p><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com"><pre data-tool="mdniceç¼–è¾‘å™¨"><span></span><code><span>#Â NameÂ theÂ codeÂ blockÂ toÂ returnÂ asÂ environment</span><br>job::job(brm_resultÂ =Â {<br>Â Â <span>#Â Job-specificÂ settings</span><br>Â Â options(mc.coresÂ =Â 3)<br>Â Â <br>Â Â <span>#Â ComputeÂ stuff</span><br>Â Â fitÂ =Â brm(model1,Â data)<br>Â Â fitÂ =Â add_criterion(fit,Â <span>"loo"</span>)<br>Â Â the_testÂ =Â hypothesis(fit,Â <span>"hpÂ &gt;Â 0"</span>)<br>Â Â <br>Â Â <span>#Â PrintÂ stuffÂ insideÂ theÂ job</span><br>Â Â <span>print</span>(summary(fit))<br>Â Â <br>Â Â <span>#Â ControlÂ whatÂ isÂ returnedÂ toÂ theÂ mainÂ session</span><br>Â Â job::<span>export</span>(c(fit,Â the_test))<br>},Â importÂ =Â c(data,Â model1))<br><span></span><br></code></pre></section><pre data-language="r"><img data-imgfileid="100002570" data-ratio="0.3972222222222222" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrosSOWPZmOXwSNUlxZicFNiasgkIQp3VDpfM4s6MibAhjcDwqaBKbe2Aicg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1172" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrosSOWPZmOXwSNUlxZicFNiasgkIQp3VDpfM4s6MibAhjcDwqaBKbe2Aicg/640?wx_fmt=png&amp;from=appmsg"><br></pre><p><br></p><p>ç”Ÿæˆçš„<code>brm_results</code>æ˜¯<code>Environment</code>å¯¹è±¡ï¼Œç¥å¥‡çš„æ˜¯é‡Œé¢ç«Ÿç„¶åŒ…å«å½“æ—¶è¿è¡Œçš„ä»£ç ï¼Œå¤§çˆ±ã€‚</p><p><img data-imgfileid="100002568" data-ratio="0.48148148148148145" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrbBpB7lbC6gG2eKc1QZNn43Tt4aalEUTbAAZoewic4Qia1tzjNib2RwuQw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="972" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrbBpB7lbC6gG2eKc1QZNn43Tt4aalEUTbAAZoewic4Qia1tzjNib2RwuQw/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>å®ä¾‹1_Cibersortå…ç–«ç»†èƒæµ¸æ¶¦</span></h2><p>ä¸‹é¢å…·ä½“å±•ç¤ºä¸‹å¦‚ä½•ç”¨åˆ°å…·ä½“åˆ†æä¸­ï¼Œä»¥<code>IOBR</code>çš„åç¤ºä¾‹æ•°æ®ä¸ºä¾‹ã€‚<code>eset_stad</code>å…±10ä¸ªæ ·æœ¬ï¼Œå°±è¦è·‘å¥½ä¹…ã€‚</p><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com"><pre data-tool="mdniceç¼–è¾‘å™¨"><span></span><code>rm(listÂ =Â ls())<br>librarian::shelf(tidyverse,Â IOBR)<br><br>esetÂ &lt;-Â count2tpm(countMatÂ =Â eset_stad,Â <span>source</span>Â =Â <span>"local"</span>,Â idTypeÂ =Â <span>"ensembl"</span>)<br><br>job::job(cibersort_result={cibersort_result&lt;-deconvo_cibersort(esetÂ =Â eset,<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â projectÂ =Â <span>"TCGA-STAD"</span>,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â arraysÂ =Â FALSE,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â absoluteÂ =Â FALSE,Â <br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â permÂ =Â 500)})<span></span></code></pre></section><p><img data-imgfileid="100002571" data-ratio="0.3472222222222222" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxr5OB5P2ibq4zqnpSfA40dYGzTibXx7Wiaylia0UCm66Ib09KSQ5tAKgfsXg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1363" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxr5OB5P2ibq4zqnpSfA40dYGzTibXx7Wiaylia0UCm66Ib09KSQ5tAKgfsXg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p>ç”Ÿæˆçš„ç»“æœï¼š<code>cibersort_results</code>æ˜¯ä¸€ä¸ª<code>Environment</code>ï¼ŒåŒ…å«ä»»åŠ¡çš„ç›¸å…³ä¿¡æ¯åŠç»“æœã€‚å…±10ä¸ªæ ·æœ¬ï¼Œç”¨æ—¶20minï¼Œå¦‚æœæœ‰500ä¸ªæ ·æœ¬ï¼Œ50*20=1000minï¼Œ1000/60=16.67hï¼Œè¿˜æ˜¯æ¯”è¾ƒè€—æ—¶çš„ã€‚</p><p><img data-imgfileid="100002572" data-ratio="0.3138888888888889" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrKIkI8pibSmv5lrtMmLn5UMU660XxDHqXl8JzoXKgqt0P3J1x8wbjMtQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1349" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrKIkI8pibSmv5lrtMmLn5UMU660XxDHqXl8JzoXKgqt0P3J1x8wbjMtQ/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100002569" data-ratio="0.41944444444444445" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrBY5SsEgzI0LEouBkPicy4KCyzSPgR6zBqZdezJ8ucNtzJtV4z6iapgzQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="839" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrBY5SsEgzI0LEouBkPicy4KCyzSPgR6zBqZdezJ8ucNtzJtV4z6iapgzQ/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>å®ä¾‹2_SVMç­›é€‰ç‰¹å¾å˜é‡</span></h2><p>è¾“å…¥æ•°æ®</p><p><img data-imgfileid="100002573" data-ratio="0.2935185185185185" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrVErPCqMNSGVvHPyQBFRlbFcmr84n4v7hfApd0duH787aicYXFiabQTicA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="542" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrVErPCqMNSGVvHPyQBFRlbFcmr84n4v7hfApd0duH787aicYXFiabQTicA/640?wx_fmt=png&amp;from=appmsg"></p><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com"><pre data-tool="mdniceç¼–è¾‘å™¨"><span></span><code><span>source</span>(<span>"msvmRFE.R"</span>)<br><br><span>#æ„å»ºæœºå™¨å­¦ä¹ -æ”¯æŒå‘é‡æœºé€’å½’ç‰¹å¾æ¶ˆé™¤ç®—æ³•(SVM-RFE)ï¼Œ10æŠ˜äº¤å‰éªŒè¯</span><br>svmRFE(data,Â k=10,Â halve.above=50)<br>nfold=10<br>geneNum=nrow(data)<br>folds=rep(1:nfold,Â len=geneNum)[sample(geneNum)]<br>folds=lapply(1:nfold,Â <span>function</span>(x)Â <span>which</span>(foldsÂ ==Â x))<br>results=lapply(folds,Â svmRFE.wrap,Â data,Â k=10,Â halve.above=50)<br><br><span>#åŸºå› çš„é‡è¦æ€§è¿›è¡Œæ’åº</span><br>top.features=WriteFeatures(results,Â data,Â save=F)<br><span>#è¾“å‡ºåŸºå› é‡è¦æ€§æ’åºçš„ç»“æœ</span><br>write.table(top.features,Â file=<span>"feature_svm.txt"</span>,Â sep=<span>"\t"</span>,Â quote=F,row.names=F)<br><br>job::job({featsweep=lapply(1:30,Â FeatSweep.wrap,Â results,Â data)<br>Â Â Â Â Â Â Â Â Â Â no.info=min(prop.table(table(data[,1])))<br>Â Â Â Â Â Â Â Â Â Â errors=sapply(featsweep,Â <span>function</span>(x)Â ifelse(is.null(x),Â NA,Â x<span>$error</span>))<br>})<br>Â Â <br>Â Â <br>Â Â <span>#ç»˜åˆ¶äº¤å‰éªŒè¯è¯¯å·®çš„å›¾å½¢</span><br>Â Â pdf(file=<span>"errors.pdf"</span>,Â width=5,Â height=5)<br>Â Â PlotErrors(errors,Â no.info=no.info)<br>Â Â dev.off()<br>Â Â <br>Â Â <span>#ç»˜åˆ¶äº¤å‰éªŒè¯å‡†ç¡®æ€§çš„å›¾å½¢</span><br>Â Â pdf(file=<span>"accuracy.pdf"</span>,Â width=5,Â height=5)<br>Â Â Plotaccuracy(1-errors,Â no.info=no.info)<br>Â Â dev.off()<br>Â Â <br>Â Â <span>#è¾“å‡ºSVMæœºå™¨å­¦ä¹ æ–¹æ³•å¾—åˆ°çš„ç–¾ç—…ç‰¹å¾åŸºå› </span><br>Â Â featureGenes=top.features[1:which.min(errors),1,drop=F]<br>Â Â write.table(file=<span>"SVM-RFE.gene.txt"</span>,Â featureGenes,Â sep=<span>"\t"</span>,Â quote=F,Â row.names=F,Â col.names=F)<br></code></pre></section><p><img data-imgfileid="100002574" data-ratio="0.2638888888888889" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrZjm0asOpA2OEOWJ53SUUcoDXjRFMeSs67OR3yJicfrnQh0NJFGHqNGQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" width="1330" src="https://mmbiz.qpic.cn/sz_mmbiz_png/C0nicuvoMeDExTarXbXyibDLP7O5fVbIxrZjm0asOpA2OEOWJ53SUUcoDXjRFMeSs67OR3yJicfrnQh0NJFGHqNGQ/640?wx_fmt=png&amp;from=appmsg"><span></span></p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg4MTczODE5NQ==&amp;mid=2247483904&amp;idx=1&amp;sn=19d258b3735857a71821b64a7bbb13a7&amp;scene=21#wechat_redirect" data-href="https://mp.weixin.qq.com/s?__biz=Mzg4MTczODE5NQ==&amp;mid=2247483904&amp;idx=1&amp;sn=19d258b3735857a71821b64a7bbb13a7&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">Rè¯­è¨€ä¹‹åˆ©ç”¨SVM-RFEæœºå™¨å­¦ä¹ ç®—æ³•ç­›é€‰å…³é”®å› å­</a></p><p>Zeng D, Fang Y et al(2023) IOBR2: Decoding Tumor Microenvironment for Clinical Translation in Immuno-Oncology. bioRxiv.</p><p><span>å£°æ˜ï¼šæœ¬æ–‡ä»…ä¾›å­¦ä¹ äº¤æµç”¨ï¼Œç¦æ­¢ç”¨äºå•†ä¸šç”¨é€”ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚</span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/yrPJrJ8B17WNU3tD4QFIvg",target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a>
