---
title: "单细胞RNA-seq生信分析全流程——第三十篇：表面蛋白（标准化）"
date: 2024-12-27T14:18:49Z
draft: ["false"]
tags: [
  "fetched",
  "小鱼生物信息"
]
categories: ["Acdemic"]
---
单细胞RNA-seq生信分析全流程——第三十篇：表面蛋白（标准化） by 小鱼生物信息
------
<div><section><span><span leaf="">30.1 前言</span></span></section><p><span leaf="">与UMI计数的负二项分布相反，ADT数据不那么稀疏，非特异性抗体结合的峰值为负，而特定细胞表面蛋白富集的峰值为正。由于生物物理特性的差异，捕获效率因细胞而异。由于CITE-seq实验针对先验选择的特征进行富集，因此成分偏差更为严重。与scRNA-seq数据类似，存在许多标准化方法。我们介绍了两种最广泛使用的方法，它们需要不同的输入数据和起点。</span></p><p><span leaf="">可以使用中心对数比 (CLR) 变换对ADT数据进行标准化。尽管如此，现在存在一种新的低级标准化方法，专门用于应对这种模式带来的挑战：DSB（去噪和按背景缩放）。DSB标准化可以消除两种噪音。首先，它使用空液滴来估计背景噪声并消除环境噪声。其次，它使用背景群体平均值和同种型（与细胞非特异性结合的抗体）来定义和消除细胞间的技术噪声。</span></p><section><span><span leaf="" data-pm-slice='1 1 ["para",null,"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;  background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>30.2 环境设置</span></span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span leaf=""><span>import</span><span> muon </span><span>as</span><span> mu</span></span></code><code><span leaf=""><span>import</span><span> pandas </span><span>as</span><span> pd</span></span></code><code><span leaf=""><span>import</span><span> pooch</span></span></code><code><span leaf=""><span>import</span><span> scanpy </span><span>as</span><span> sc</span></span></code><code><span leaf=""><span>import</span><span> warnings</span></span></code><code><span leaf=""><span>warnings.filterwarnings(</span><span>"ignore"</span><span>)</span></span></code><code><span leaf=""><span>sc.settings.verbosity = </span><span>0</span></span></code><code><span leaf=""><span>sc.settings.set_figure_params(</span></span></code><code><span leaf=""><span>    dpi=</span><span>80</span><span>,</span></span></code><code><span leaf=""><span>    facecolor=</span><span>"white"</span><span>,</span></span></code><code><span leaf=""><span>    frameon=</span><span>False</span><span>,</span></span></code><code><span leaf=""><span>)</span></span></code></pre></section><section><span><span leaf="" data-pm-slice='1 1 ["para",null,"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>30.3 加载数据</span></span></section><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span leaf=""><span>cite_quality_control = pooch.retrieve(</span></span></code><code><span leaf=""><span>    url=</span><span>"https://figshare.com/ndownloader/files/41452449"</span><span>,</span></span></code><code><span leaf=""><span>    fname=</span><span>"cite_quality_control.h5mu"</span><span>,</span></span></code><code><span leaf=""><span>    path=</span><span>"."</span><span>,</span></span></code><code><span leaf=""><span>    known_hash=</span><span>None</span><span>,</span></span></code><code><span leaf=""><span>    progressbar=</span><span>True</span><span>,</span></span></code><code><span leaf=""><span>)</span></span></code></pre></section><section><span leaf="">我们只是从质量控制章节重新加载已保存的MuData对象。</span></section><section><ul><li><li></ul><pre data-lang="javascript"><code><span leaf=""><span>mdata = mu.</span><span>read</span><span>(</span><span>"cite_quality_control.h5mu"</span><span>)</span></span></code><code><span leaf=""><span>mdata</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span leaf=""><span>MuData </span><span>object</span><span> </span><span>with</span><span> n_obs × n_vars = </span><span>118563</span><span> × </span><span>36741</span></span></code><code><span leaf=""><span>  </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>  </span><span>2</span><span> modalities</span></span></code><code><span leaf=""><span>    rna:	</span><span>118563</span><span> x </span><span>36601</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>    prot:	</span><span>118563</span><span> x </span><span>140</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span><span>, </span><span>'n_genes_by_counts'</span><span>, </span><span>'log1p_n_genes_by_counts'</span><span>, </span><span>'total_counts'</span><span>, </span><span>'log1p_total_counts'</span><span>, </span><span>'n_counts'</span><span>, </span><span>'outliers'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span><span>, </span><span>'n_cells_by_counts'</span><span>, </span><span>'mean_counts'</span><span>, </span><span>'log1p_mean_counts'</span><span>, </span><span>'pct_dropout_by_counts'</span><span>, </span><span>'total_counts'</span><span>, </span><span>'log1p_total_counts'</span></span></code></pre></section><section><ul><li><li></ul><pre data-lang="javascript"><code><span leaf=""><span>mdata_raw = mu.</span><span>read</span><span>(</span><span>"cite_raw.h5mu"</span><span>)</span></span></code><code><span leaf=""><span>mdata_raw</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span leaf=""><span>MuData </span><span>object</span><span> </span><span>with</span><span> n_obs × n_vars = </span><span>24807643</span><span> × </span><span>36741</span></span></code><code><span leaf=""><span>  </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>  </span><span>2</span><span> modalities</span></span></code><code><span leaf=""><span>    rna:	</span><span>24807643</span><span> x </span><span>36601</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>    prot:	</span><span>24807643</span><span> x </span><span>140</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code></pre></section><section><span><span leaf="" data-pm-slice='1 1 ["para",null,"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>30.4 DSB标准化</span></span></section><p><span leaf="">我们已准备好标准化数据。在这种情况下，我们可以使用原始数据的分布作为背景。我们还有同型对照来定义和消除细胞间技术差异。</span></p><p><span leaf="">同型对照是非特异性结合本研究中存在的细胞的抗体，这意味着您不会期望细胞之间有显著的丰度差异。因此，我们可以使用同型对照的值来标准化技术差异。</span></p><p><span leaf="">我们正在使用过滤后的原始mudata对象以及同型对照的名称调用标准化函数`mu.prot.pp.dsb`。</span></p><section><ul><li><li><li><li></ul><pre data-lang="javascript"><code><span leaf=""><span>isotype_controls = [</span><span>"Mouse-IgG1"</span><span>, </span><span>"Mouse-IgG2a"</span><span>, </span><span>"Mouse-IgG2b"</span><span>, </span><span>"Rat-IgG2b"</span><span>]</span></span></code><code><span leaf=""><span>mdata[</span><span>"prot"</span><span>].</span><span>layers</span><span>[</span><span>"counts"</span><span>] = mdata[</span><span>"prot"</span><span>].</span><span>X</span></span></code><code><span leaf=""><span>mdata[</span><span>"prot"</span><span>].</span><span>X</span><span> = mdata[</span><span>"prot"</span><span>].</span><span>layers</span><span>[</span><span>"counts"</span><span>]</span></span></code><code><span leaf=""><span>mu.</span><span>prot</span><span>.</span><span>pp</span><span>.</span><span>dsb</span><span>(mdata, mdata_raw, isotype_controls=isotype_controls)</span></span></code></pre></section><section><span leaf="">让我们看一下去噪和标准化之前的计数。</span></section><section><ul><li></ul><pre data-lang="css"><code><span leaf=""><span>pd</span><span>.Series</span><span>(mdata</span><span><span>[</span></span><span><span>"prot"</span></span><span><span>]</span></span><span>.layers</span><span><span>[</span></span><span><span>"counts"</span></span><span><span>]</span></span><span>[:100, :100]</span><span>.A.flatten</span><span>())</span><span>.value_counts</span><span>()</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="go"><code><span leaf=""><span>1.0</span><span>      </span><span>1090</span></span></code><code><span leaf=""><span>0.0</span><span>      </span><span>1045</span></span></code><code><span leaf=""><span>2.0</span><span>       </span><span>918</span></span></code><code><span leaf=""><span>3.0</span><span>       </span><span>691</span></span></code><code><span leaf=""><span>4.0</span><span>       </span><span>581</span></span></code><code><span leaf=""><span>         ... </span></span></code><code><span leaf=""><span>350.0</span><span>       </span><span>1</span></span></code><code><span leaf=""><span>706.0</span><span>       </span><span>1</span></span></code><code><span leaf=""><span>296.0</span><span>       </span><span>1</span></span></code><code><span leaf=""><span>970.0</span><span>       </span><span>1</span></span></code><code><span leaf=""><span>763.0</span><span>       </span><span>1</span></span></code><code><span leaf=""><span>Name: count, Length: </span><span>524</span><span>, dtype: </span><span>int64</span></span></code></pre></section><section><span leaf="">查看去噪和标准化之后范围的变化。</span></section><section><ul><li></ul><pre data-lang="css"><code><span leaf=""><span>pd</span><span>.Series</span><span>(mdata</span><span><span>[</span></span><span><span>"prot"</span></span><span><span>]</span></span><span>.X</span><span>[:100, :100]</span><span>.flatten</span><span>())</span><span>.value_counts</span><span>()</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="go"><code><span leaf=""><span>0.311677</span><span>    </span><span>2</span></span></code><code><span leaf=""><span>-1.002554</span><span>    </span><span>1</span></span></code><code><span leaf=""><span> </span><span>2.573147</span><span>    </span><span>1</span></span></code><code><span leaf=""><span> </span><span>1.804169</span><span>    </span><span>1</span></span></code><code><span leaf=""><span>-0.403206</span><span>    </span><span>1</span></span></code><code><span leaf=""><span>            ..</span></span></code><code><span leaf=""><span> </span><span>0.142890</span><span>    </span><span>1</span></span></code><code><span leaf=""><span> </span><span>0.268634</span><span>    </span><span>1</span></span></code><code><span leaf=""><span>-0.078150</span><span>    </span><span>1</span></span></code><code><span leaf=""><span> </span><span>0.258447</span><span>    </span><span>1</span></span></code><code><span leaf=""><span>-0.271008</span><span>    </span><span>1</span></span></code><code><span leaf=""><span>Name: count, Length: </span><span>9999</span><span>, dtype: </span><span>int64</span></span></code></pre></section><section><span><span leaf="" data-pm-slice='1 1 ["para",null,"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>30.5 中心对数比归一化</span></span></section><p><span leaf="">如果您没有可用的未过滤数据，您还可以使用`mu.prot.pp.clr`对ADT数据进行归一化，从而实现中心对数比归一化。这种类型的归一化没有去噪。相反，我们假设几何平均值是一个很好的参考，可以计算其他值的相对值。事实上，我们取的是每个细胞中每种蛋白质相对于其他蛋白质或其他细胞的自然对数比，具体取决于实现方式。起初，它是跨蛋白质进行的，但后来改为跨细胞。这一变化使归一化不再依赖于抗体组。</span></p><section><ul><li></ul><pre data-lang=""><code><span leaf=""><span>mdata</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span leaf=""><span>MuData </span><span>object</span><span> </span><span>with</span><span> n_obs × n_vars = </span><span>118563</span><span> × </span><span>36741</span></span></code><code><span leaf=""><span>  </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>  </span><span>2</span><span> modalities</span></span></code><code><span leaf=""><span>    rna:	</span><span>118563</span><span> x </span><span>36601</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>    prot:	</span><span>118563</span><span> x </span><span>140</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span><span>, </span><span>'n_genes_by_counts'</span><span>, </span><span>'log1p_n_genes_by_counts'</span><span>, </span><span>'total_counts'</span><span>, </span><span>'log1p_total_counts'</span><span>, </span><span>'n_counts'</span><span>, </span><span>'outliers'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span><span>, </span><span>'n_cells_by_counts'</span><span>, </span><span>'mean_counts'</span><span>, </span><span>'log1p_mean_counts'</span><span>, </span><span>'pct_dropout_by_counts'</span><span>, </span><span>'total_counts'</span><span>, </span><span>'log1p_total_counts'</span></span></code><code><span leaf=""><span>      layers:	</span><span>'counts'</span></span></code></pre></section><section><ul><li></ul><pre data-lang="javascript"><code><span leaf=""><span>mdata.</span><span>write</span><span>(</span><span>"cite_normalization.h5mu"</span><span>)</span></span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/1hvrKYHM9QRuijoa_8_b7A",target="_blank" rel="noopener noreferrer">原文链接</a>
