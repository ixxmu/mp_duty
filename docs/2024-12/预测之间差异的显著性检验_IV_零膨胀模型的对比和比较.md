---
title: "预测之间差异的显著性检验 IV：零膨胀模型的对比和比较"
date: 2024-12-07T00:36:40Z
draft: ["false"]
tags: [
  "fetched",
  "R 学习践行者"
]
categories: ["Acdemic"]
---
预测之间差异的显著性检验 IV：零膨胀模型的对比和比较 by R 学习践行者
------
<div><p>文章要点：</p><p>模型组成： 零膨胀模型有两个部分（零膨胀成分和计数成分）；可以分别计算两部分的调整预测值，并进行对比或比较。</p><p>简便计算方法： 使用 predict_response() 的结果直接传递给 test_predictions() 来计算对比或成对比较，通过 type 参数选择相应的模型成分来计算预测值和对比。</p><p><br></p><p>1.什么是零膨胀模型？</p><p>    零膨胀模型是用来分析 “零值特别多”的数据的一种方法。比如，你在统计一天中商店的顾客数量时，有很多天顾客数量是零。这种“零值”有两种可能来源：</p><p>    真正的零：比如店铺那天根本没开门；</p><p>    计数零：店铺虽然开门，但没有顾客进来，可能是偶然情况。</p><p> 零膨胀模型会区分这两种情况，用两个部分来预测数据：</p><p>    零膨胀部分：预测一个“零值”是“真正的零”还是“计数零”；</p><p>    计数部分：预测非零天的顾客数量。</p><p><br></p><p>2.如何选择零膨胀模型的预测变量？</p><p>    两部分模型不需要使用相同的预测变量，因此，为零膨胀模型选择合适的变量并不总是简单的。需要考虑数据中过多零值的原因：是真正的零值（本质上没有计数）还是受限的零值？选择能解释某些数据点为何为零的变量，即使在某些情况下可能产生计数；例如，如果模型预测的是顾客投诉次数，那么一个偏远地区的商店可能因为顾客稀少而没有投诉。</p><p><br></p><p>3.使用 glmmTMB 包的零膨胀模型</p><p>    示例使用 glmmTMB 包中的 Salamanders 数据集，对数据拟合零膨胀泊松回归模型，以 mined 为预测变量。</p><p>    使用 predict_response() 的调整预测值，可为不同的模型成分计算调整预测值：</p><p>1）条件成分（计数部分）：</p><p>    预测火蜥蜴的平均数量，这是默认选项，使用 type = “fixed”，返回仅考虑计数成分的条件均值（“计数零值”的响应均值），不考虑“真正零值”的概率。</p><p>2）完整模型：</p><p>    包括零膨胀成分，预测响应的平均计数；返回一个平均观测值的预期响应值，可能是“真正零值”或“计数零值”，使用 type = “zero_inflation”计算，同时考虑零膨胀成分。</p><p>3）零膨胀概率：</p><p>    预测观测值是否为“真正零值”的概率，使用 type = “zi_prob”，仅与模型的零膨胀成分相关。</p><pre><code><span>library</span>(ggeffects)<br><span>library</span>(glmmTMB)<br><br>data(Salamanders)<br><br><span># 拟合零膨胀泊松模型</span><br>m &lt;- glmmTMB(count ~ mined + (<span>1</span> | site), <span>#计数部分（条件部分）</span><br>  ziformula = ~mined,<span>#零膨胀部分的公式，用变量 mined 来预测观测结果中“真正的零”</span><br>  family = poisson(),<br>  data = Salamanders<br>)</code></pre><p>3.1 条件模型的对比和比较：</p><p>    我们将从条件均值开始，使用 margin =“empirical”，因为我们想在随机效应上平均预测。</p><p>    计算对比或成对比较的最简单方法是将 predict_response() 的结果直接传递给 test_predictions()，正确的观察项和模型成分会自动被检测到。</p><p>    对于零膨胀模型，预测的默认类型是”fixed”，即预测条件均值，这是响应的平均计数，不包括零膨胀成分。</p><p>    条件均值是只考虑“计数零”情况下的预测，忽略“真正零”；通过代码计算每种情况下的条件均值，并进行对比，了解不同变量对结果的影响</p><pre><code><span># 预测条件均值</span><br>p &lt;- predict_response(m, <span>"mined"</span>, margin = <span>"empirical"</span>)<br>p</code></pre><pre><code>  # Average predicted (conditional) counts of count<br>  <br>  mined | Predicted |     95% CI<br>  ------------------------------<br>  yes   |      1.12 | 0.61, 1.63<br>  no    |      3.51 | 2.89, 4.14</code></pre><pre><code>plot(p)</code></pre><p><img data-imgfileid="100003684" data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50n966icLuAVOoAeAsy621Eu0iaVIeIYrtAAZSQJjqxj84LmMDqOeatAib3Cy0QLYO4syN8uIJcQSsULA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1344" width="672" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50n966icLuAVOoAeAsy621Eu0iaVIeIYrtAAZSQJjqxj84LmMDqOeatAib3Cy0QLYO4syN8uIJcQSsULA/640?wx_fmt=png&amp;from=appmsg"></p><pre><code><span># 计算对比</span><br>test_predictions(p)</code></pre><pre><code>  # Pairwise comparisons<br>  <br>  mined  | Contrast |       95% CI |      p<br>  -----------------------------------------<br>  yes-no |    -2.39 | -3.18, -1.60 | &lt; .001</code></pre><p>3.2 完整模型的对比和比较</p><p>    如果 type = “zero_inflated”，则返回完整模型的调整预测，即响应的平均期望计数，包括零膨胀成分。</p><p>    完整模型考虑了所有零值，包括“真正零”和“计数零”，这部分展示如何计算期望值，预测总体情况，比如一周内商店的顾客总数。</p><pre><code><span># 预测响应的期望值</span><br>p &lt;- predict_response(m, <span>"mined"</span>, type = <span>"zero_inflated"</span>, margin = <span>"empirical"</span>)<br>p</code></pre><pre><code>  # Average expected counts of count<br>  <br>  mined | Predicted |     95% CI<br>  ------------------------------<br>  yes   |      0.27 | 0.15, 0.40<br>  no    |      2.27 | 1.86, 2.67</code></pre><pre><code>plot(p)</code></pre><p><img data-imgfileid="100003682" data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50n966icLuAVOoAeAsy621Eu0tHCM2mxEuQejAltdko1k1icQOO3KviaZfKno1pVBslrAT1qESlXvIIbQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1344" width="672" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50n966icLuAVOoAeAsy621Eu0tHCM2mxEuQejAltdko1k1icQOO3KviaZfKno1pVBslrAT1qESlXvIIbQ/640?wx_fmt=png&amp;from=appmsg"></p><pre><code><span># 计算对比</span><br>test_predictions(p)</code></pre><pre><code>  # Pairwise comparisons<br>  <br>  mined  | Contrast |       95% CI |      p<br>  -----------------------------------------<br>  yes-no |    -1.99 | -2.41, -1.58 | &lt; .001</code></pre><p>3.3 零膨胀概率的对比和比较</p><p>    如果你对是否为“真正零值”的概率感兴趣，可以使用 type = “zi_prob”。请注意，此时 margin 不应为 “empirical”，因为这不会包括调整预测的置信区间。</p><p>    这里预测的是“真正零”的概率，也就是某天“商店不开门”的可能性；可以用这个方法找出导致“真正零”的因素，比如天气、假期等。</p><pre><code><span># 预测零膨胀概率</span><br>p &lt;- predict_response(m, <span>"mined"</span>, type = <span>"zi_prob"</span>)<br>p</code></pre><pre><code>  # Predicted zero-inflation probabilities of count<br>  <br>  mined | Predicted |     95% CI<br>  ------------------------------<br>  yes   |      0.76 | 0.66, 0.83<br>  no    |      0.36 | 0.30, 0.41<br>  <br>  Adjusted for:<br>  * site = NA (population-level)</code></pre><pre><code>plot(p)</code></pre><p><img data-imgfileid="100003683" data-ratio="0.7142857142857143" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50n966icLuAVOoAeAsy621Eu09UVBNObtibmCxDgpfONo6672ibDeRRDg7b6E53C5mrpVBR2E2l0QvIhA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1344" width="672" src="https://mmbiz.qpic.cn/sz_mmbiz_png/IGjxEGEQ50n966icLuAVOoAeAsy621Eu09UVBNObtibmCxDgpfONo6672ibDeRRDg7b6E53C5mrpVBR2E2l0QvIhA/640?wx_fmt=png&amp;from=appmsg"></p><pre><code><span># 计算对比</span><br>test_predictions(p)</code></pre><pre><code>  # Pairwise comparisons<br>  <br>  mined  | Contrast |     95% CI |      p<br>  ---------------------------------------<br>  yes-no |     0.40 | 0.30, 0.50 | &lt; .001</code></pre><p>参考资料：https://strengejacke.github.io/ggeffects/articles/introduction_comparisons_4.html</p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3WOgvEfnMSZAE88fwWpAOA",target="_blank" rel="noopener noreferrer">原文链接</a>
