---
title: "GTF文件有什么用啊？别的不谈，最起码能提lncRNA"
date: 2024-12-03T08:28:40Z
draft: ["false"]
tags: [
  "fetched",
  "果子学生信"
]
categories: ["Acdemic"]
---
GTF文件有什么用啊？别的不谈，最起码能提lncRNA by 果子学生信
------
<div><p><span>我们直接去下载他， http://asia.ensembl.org/index.html</span></p><p><img data-copyright="0" data-ratio="0.33406352683461116" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OW9I86v6eEMWelCUia9G4mjmu2kzUNXpsQYqMZx5KoAHwZQ00yEIFIHRQ/640?wx_fmt=png" data-type="png" data-w="913" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OW9I86v6eEMWelCUia9G4mjmu2kzUNXpsQYqMZx5KoAHwZQ00yEIFIHRQ/640?wx_fmt=png"></p><p><img data-copyright="0" data-ratio="0.49948927477017363" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OWsEexq8Aibfs78PrZWcGj68lnaR4iaibtgqFWaHn9OhD0ibogc06xEBuOUw/640?wx_fmt=png" data-type="png" data-w="979" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OWsEexq8Aibfs78PrZWcGj68lnaR4iaibtgqFWaHn9OhD0ibogc06xEBuOUw/640?wx_fmt=png"></p><p><img data-copyright="0" data-ratio="0.22230595327807084" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OWtZgcExpK4OVKfreiap2znlIuVKFvgBa4V50DI4OWs2dTmpVQkqdYOsA/640?wx_fmt=png" data-type="png" data-w="1327" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OWtZgcExpK4OVKfreiap2znlIuVKFvgBa4V50DI4OWs2dTmpVQkqdYOsA/640?wx_fmt=png"></p><p><br></p><p><img data-copyright="0" data-ratio="0.39375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OW4EjHegpgAlXmx1ksGWIVMyvEhR7VrT9HXlklqavzEKPA5KHHic2LicMg/640?wx_fmt=png" data-type="png" data-w="960" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OW4EjHegpgAlXmx1ksGWIVMyvEhR7VrT9HXlklqavzEKPA5KHHic2LicMg/640?wx_fmt=png"></p><p><span>解压缩后，使用R语言可以读取，有多中方案，最终我选择的是rtracklayer::import，而且我认为这是最好的方法。</span></p><p><span>首先我们来安装rtracklayer这个包</span></p><pre><ol><li><p><code><span><span>if</span><span>(length(getOption(</span><span>"CRAN"</span><span>))==</span><span>0</span><span>) options(CRAN=</span><span>"https://mirrors.tuna.tsinghua.edu.cn/CRAN/"</span><span>)</span></span></code></p></li><li><p><code><span><span>if</span><span>(!</span><span>require</span><span>(</span><span>"rtracklayer"</span><span>)) </span><span>BiocManager</span><span>::install(</span><span>"rtracklayer"</span><span>)</span></span></code></p></li></ol></pre><p><span>直接读取，大概要2分钟，然后转换成data.frame格式</span></p><pre><ol><li><p><code><span><span>gtf1 &lt;- rtracklayer::</span><span>import</span><span>(</span><span>'Homo_sapiens.GRCh38.94.chr.gtf'</span><span>)</span></span></code></p></li><li><p><code><span><span>gtf_df &lt;- </span><span>as</span><span>.data.frame(gtf1)</span></span></code></p></li></ol></pre><p><span>这是一行270万行，27列的文件,可能是普通人接触到的最大数据，里面记录了基因的构成信息，每个基因有在基因组上的位置，有多少转录本，是否编码。</span></p><pre><ol><li><p><code><span>dim(gtf_df)</span></code></p></li><li><p><code><span><span>[</span><span>1</span><span>] </span><span>2736845</span><span>      </span><span>27</span></span></code></p></li></ol></pre><p><span>我们把这个数据保存成Rdata格式，这就是课堂上抽取lncRNA，mRNA以及名称转换需要的gtf文件，使用的时候load即可</span></p><pre><ol><li><p><code><span><span>save(gtf_df,file = </span><span>"gtf_df.Rda"</span><span>)</span></span></code></p></li></ol></pre><p><span>我们通过行名来了解一下他,有27个。</span></p><pre><ol><li><p><code><span>colnames &lt;- data.frame(colnames=colnames(gtf_df))</span></code></p></li><li><p><code><span>colnames</span></code></p></li><li><p><code><span><span>1</span><span> seqnames</span></span></code></p></li><li><p><code><span><span>2</span><span> start</span></span></code></p></li><li><p><code><span><span>3</span><span> </span><span>end</span></span></code></p></li><li><p><code><span><span>4</span><span> width</span></span></code></p></li><li><p><code><span><span>5</span><span> strand</span></span></code></p></li><li><p><code><span><span>6</span><span> source</span></span></code></p></li><li><p><code><span><span>7</span><span> type</span></span></code></p></li><li><p><code><span><span>8</span><span> score</span></span></code></p></li><li><p><code><span><span>9</span><span> phase</span></span></code></p></li><li><p><code><span><span>10</span><span> gene_id</span></span></code></p></li><li><p><code><span><span>11</span><span> gene_version</span></span></code></p></li><li><p><code><span><span>12</span><span> gene_name</span></span></code></p></li><li><p><code><span><span>13</span><span> gene_source</span></span></code></p></li><li><p><code><span><span>14</span><span> gene_biotype</span></span></code></p></li><li><p><code><span><span>15</span><span> transcript_id</span></span></code></p></li><li><p><code><span><span>16</span><span> transcript_version</span></span></code></p></li><li><p><code><span><span>17</span><span> transcript_name</span></span></code></p></li><li><p><code><span><span>18</span><span> transcript_source</span></span></code></p></li><li><p><code><span><span>19</span><span> transcript_biotype</span></span></code></p></li><li><p><code><span><span>20</span><span> tag</span></span></code></p></li><li><p><code><span><span>21</span><span> transcript_support_level</span></span></code></p></li><li><p><code><span><span>22</span><span> exon_number</span></span></code></p></li><li><p><code><span><span>23</span><span> exon_id</span></span></code></p></li><li><p><code><span><span>24</span><span> exon_version</span></span></code></p></li><li><p><code><span><span>25</span><span> protein_id</span></span></code></p></li><li><p><code><span><span>26</span><span> protein_version</span></span></code></p></li><li><p><code><span><span>27</span><span> ccds_id</span></span></code></p></li></ol></pre><p><span>然后我们就可以利用这个文件结合读取好的TCGA counts文件，抽离出mRNA和lncRNA 其中expr<em>df</em>nopoint就是去掉ensemble id后面小数点的表达文件，ensemble id是第一列，每个样本是一列。大概是这样的：</span></p><p><img data-copyright="0" data-ratio="0.48801128349788436" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OW0HNkE0XwlQic6wZT2dD31Dxl6rpicB8LAxzxtvPlIictQkjmzId18dTdg/640?wx_fmt=png" data-type="png" data-w="709" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OW0HNkE0XwlQic6wZT2dD31Dxl6rpicB8LAxzxtvPlIictQkjmzId18dTdg/640?wx_fmt=png"></p><p><strong><span>获取mRNA</span></strong></p><pre><ol><li><p><code><span>library(dplyr)</span></code></p></li><li><p><code><span>library(tidyr)</span></code></p></li><li><p><code><span>## mRNA</span></code></p></li><li><p><code><span>mRNA_exprSet &lt;- gtf_df %&gt;% </span></code></p></li><li><p><code><span><span>  dplyr::filter(type==</span><span>"gene"</span><span>,gene_biotype==</span><span>"protein_coding"</span><span>) %&gt;% </span><span>#筛选gene,和编码指标</span></span></code></p></li><li><p><code><span><span>  dplyr::</span><span>select</span><span>(c(gene_name,gene_id,gene_biotype)) %&gt;% </span></span></code></p></li><li><p><code><span><span>  dplyr::inner_join(expr_df_nopoint,</span><span>by</span><span> =</span><span>"gene_id"</span><span>) %&gt;% </span></span></code></p></li><li><p><code><span><span>  tidyr::unite(gene_id,gene_name,gene_id,gene_biotype,sep = </span><span>" | "</span><span>)</span></span></code></p></li></ol></pre><p><strong><span>获取lncRNA</span></strong></p><pre><ol><li><p><code><span>library(dplyr)</span></code></p></li><li><p><code><span>library(tidyr)</span></code></p></li><li><p><code><span># lncRNA</span></code></p></li><li><p><code><span><span>ncRNA &lt;- c(</span><span>"sense_overlapping"</span><span>,</span><span>"lincRNA"</span><span>,</span><span>"3prime_overlapping_ncRNA"</span><span>,</span></span></code></p></li><li><p><code><span><span>           </span><span>"processed_transcript"</span><span>,</span><span>"sense_intronic"</span><span>,</span></span></code></p></li><li><p><code><span><span>           </span><span>"bidirectional_promoter_lncRNA"</span><span>,</span><span>"non_coding"</span><span>,</span></span></code></p></li><li><p><code><span><span>           </span><span>"antisense_RNA"</span><span>)</span></span></code></p></li><li><p><code><span><span>LncRNA_exprSet</span><span> &lt;- gtf_df %&gt;% </span></span></code></p></li><li><p><code><span><span>  dplyr::filter(type==</span><span>"transcript"</span><span>,transcript_biotype %</span><span>in</span><span>% ncRNA) %&gt;% </span><span>#注意这里是transcript_biotype</span></span></code></p></li><li><p><code><span><span>  dplyr::</span><span>select</span><span>(c(gene_name,gene_id,transcript_biotype)) %&gt;% </span></span></code></p></li><li><p><code><span><span>  dplyr::distinct() %&gt;% </span><span>#删除多余行</span></span></code></p></li><li><p><code><span><span>  dplyr::inner_join(expr_df_nopoint,</span><span>by</span><span> =</span><span>"gene_id"</span><span>) %&gt;% </span></span></code></p></li><li><p><code><span><span>  tidyr::unite(gene_id,gene_name,gene_id,transcript_biotype,sep = </span><span>" | "</span><span>)</span></span></code></p></li></ol></pre><p><span>除此以外，还能干什么呢？ 比如我想知道21号染色体上有多少个基因？可以的</span></p><pre><ol><li><p><code><span>## 21号染色体上的编码基因</span></code></p></li><li><p><code><span>gene21 &lt;- gtf_df %&gt;% </span></code></p></li><li><p><code><span><span>  dplyr::filter(seqnames==</span><span>"21"</span><span>,type==</span><span>"gene"</span><span>,gene_biotype==</span><span>"protein_coding"</span><span>) %&gt;%</span></span></code></p></li><li><p><code><span><span>  dplyr::</span><span>select</span><span>(c(gene_name,gene_id)) </span></span></code></p></li></ol></pre><p><span>我们发现有231个编码基因</span></p><p><span>人类基因组上每个染色体上有多少个基因，知道么？可以的。</span></p><pre><ol><li><p><code><span>## 每个染色体上有多少个基因</span></code></p></li><li><p><code><span>gene_chr &lt;- gtf_df %&gt;% </span></code></p></li><li><p><code><span><span>  dplyr::filter(type==</span><span>"gene"</span><span>)</span></span></code></p></li><li><p><code><span>data &lt;- table(gene_chr$seqnames)</span></code></p></li><li><p><code><span>barplot(data,col = data)</span></code></p></li></ol></pre><p><img data-copyright="0" data-ratio="0.6471025260029718" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OWmMap6qvQ1vYXOxFK1YqxsJvUwP62oj1OnozYsiaSiaI8BaZicDR3xwsPA/640?wx_fmt=png" data-type="png" data-w="1346" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX11VgPIIxiacia72jkvJch4OWmMap6qvQ1vYXOxFK1YqxsJvUwP62oj1OnozYsiaSiaI8BaZicDR3xwsPA/640?wx_fmt=png"></p><p><strong><span>好了，明天见。</span></strong></p><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/v8HCQgewWq9VKN8xwfrGjg",target="_blank" rel="noopener noreferrer">原文链接</a>
