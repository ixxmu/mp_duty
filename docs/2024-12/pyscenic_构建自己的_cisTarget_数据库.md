---
title: "pyscenic 构建自己的 cisTarget 数据库"
date: 2024-12-27T04:17:56Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
pyscenic 构建自己的 cisTarget 数据库 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0" data-service_type="1"></mp-common-profile></section></section><section><mp-common-clmusic data-pluginname="insertaudio" type="1" music_name="长镜头 (Live)" albumurl="http://wx.y.gtimg.cn/music/photo_new/T002R500x500M000001ATvzv1ipUtk_2.jpg" singer="杨宗纬" duration="278000" username="" music_source="1" is_vip="1" listenid="78223233727907520" count="0" avatar=""></mp-common-clmusic></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>pyscenic</strong> 分析除了需要我们自己的表达矩阵文件，此外还需要 <strong>转录因子名称</strong>，<strong>转录因子到 motif 的注释文件</strong> 和 <strong>基因的 motif 富集信息</strong> 三个文件。官网只提供了 <strong>人，小鼠，果蝇</strong> 这三个物种的信息文件。对于其它物种，我们进行 <strong>pyscenic</strong> 分析仍然是一个挑战。官网提供了一个如何构建 <strong>cisTarget databases</strong> 的教程，我们分享一下如何构建上面提到的三个文件。</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100032749" data-ratio="0.30092592592592593" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibiaG03ylKwEIGZumZIUZAmMQMFGrV5Xwsmiac9moAuIMib57XZg5whJy5Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibiaG03ylKwEIGZumZIUZAmMQMFGrV5Xwsmiac9moAuIMib57XZg5whJy5Q/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>需要 fasta 和 motif 文件：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032747" data-ratio="0.3296296296296296" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ib4C4g8p4WQlUkMFfHaxTlVdlwODd612WDJLrZ1UWdwgj560DUDeAia6w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ib4C4g8p4WQlUkMFfHaxTlVdlwODd612WDJLrZ1UWdwgj560DUDeAia6w/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>一次性构建需要三个文件：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032748" data-ratio="0.4721153846153846" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibGRN6uOwQ1fiaLpeMeuH2DKexPHHaCN22cp1oibXpiaicy31OQxSmMYy2tQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1040" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibGRN6uOwQ1fiaLpeMeuH2DKexPHHaCN22cp1oibXpiaicy31OQxSmMYy2tQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>参数解释：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032746" data-ratio="0.48455598455598453" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibMweQIjoPJsHtGibaibojvotibKlbLDTpwJ6lcTV4icaJ2Kk1IxMd1bnXqw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1036" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibMweQIjoPJsHtGibaibojvotibKlbLDTpwJ6lcTV4icaJ2Kk1IxMd1bnXqw/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>安装 create_cisTarget_databases</span><span></span></h2><p data-tool="mdnice编辑器"><strong>github：https://github.com/aertslab/create_cisTarget_databases</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032750" data-ratio="0.525" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibBaEhaGtlpicClVMr4tlFqm7UXGiaDaNBmB5IkxwCIe06wxWqW6VPALDg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibBaEhaGtlpicClVMr4tlFqm7UXGiaDaNBmB5IkxwCIe06wxWqW6VPALDg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">克隆到本地，创建环境：</p><pre data-tool="mdnice编辑器"><span></span><code>git clone https://github.com/aertslab/create_cisTarget_databases<br><span><br>#</span><span> Create conda environment.</span><br>conda create -n create_cistarget_databases \<br>    'python=3.10' \<br>    'numpy=1.21' \<br>    'pandas&gt;=1.4.1' \<br>    'pyarrow&gt;=7.0.0' \<br>    'numba&gt;=0.55.1' \<br>    'python-flatbuffers'<br><span><br>#</span><span> install Cluster-Buster precompiled binary</span><br><span>#</span><span> Activate conda environment.</span><br>conda activate create_cistarget_databases<br><br>pip install numpy==1.22.4<br></code></pre><p data-tool="mdnice编辑器">安装 <strong>Cluster-Buster</strong>：</p><pre data-tool="mdnice编辑器"><span></span><code>cd "${CONDA_PREFIX}/bin"<br><span><br>#</span><span> Download precompiled Cluster-Buster binary.</span><br>wget https://resources.aertslab.org/cistarget/programs/cbust<br><span><br>#</span><span> Make downloaded binary executable.</span><br>chmod a+x cbust<br></code></pre><p data-tool="mdnice编辑器">安装 <strong>UCSC</strong> 的 <strong>liftOver</strong>，<strong>bigWigAverageOverBed</strong>：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span> Install some UCSC tools</span><br>cd "${CONDA_PREFIX}/bin"<br><span><br>#</span><span> Download liftOver.</span><br>wget http://hgdownload.soe.ucsc.edu/admin/exe/linux.x86_64/liftOver<br><span><br>#</span><span> Download bigWigAverageOverBed.</span><br>wget http://hgdownload.soe.ucsc.edu/admin/exe/linux.x86_64/bigWigAverageOverBed<br><span><br>#</span><span> Make downloaded binaries executable.</span><br>chmod a+x liftOver bigWigAverageOverBed<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>下载转录因子-motif 信息</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>JASPAR</strong> 是一个<strong>收集了转录因子结合位点 motif 的数据库</strong>。motif，即转录因子结合位点结合的序列特征，转录因子通常通过识别 motif，与基因的调控区域结合，发挥转录调控作用。该数据库包含了<strong>6 大类物种</strong>的信息，分别是<strong>Fungi（真菌）、Insecta（昆虫）、Nematoda（线虫）、Plantae（植物）、Urochordata（尾索动物）和 Vertebrata（脊椎动物）。</strong> <strong>网址：https://jaspar.elixir.no/</strong></p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100032754" data-ratio="0.4388888888888889" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibClQvg0xPLPoHgj51agYFsyYXEN6ggUEu7DQLjcdJNNrQ6tzQ08oYpg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibClQvg0xPLPoHgj51agYFsyYXEN6ggUEu7DQLjcdJNNrQ6tzQ08oYpg/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>如果是做植物的，可以使用 <strong>PlantTFDB</strong> 数据库下载相关信息。<strong>地址：https://planttfdb.gao-lab.org/</strong></p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100032753" data-ratio="0.6527777777777778" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibh9p4A8ltPutgA1hZ9ibQU3n7e1aw0NNqogJv0jgOHlnxiadCxlLuDMWQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibh9p4A8ltPutgA1hZ9ibQU3n7e1aw0NNqogJv0jgOHlnxiadCxlLuDMWQ/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>首先确定你研究的物种属于<strong>哪个大的种属里面</strong>，再去下载 <strong>非冗余的 meme 格式</strong> 的文件，左侧的 <strong>Individual PFMs</strong> 则是每个 motif 为单个文件，这里我们下载<strong>脊椎动物</strong>的：</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100032755" data-ratio="0.5675925925925925" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibKribUU0L02McDkneh3u9pex6mWSoHB8jibJh3W532QQXPWtvh3qLtWxg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibKribUU0L02McDkneh3u9pex6mWSoHB8jibJh3W532QQXPWtvh3qLtWxg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">文件内容就是 <strong>每个 motif 及对应的转录因子及 PFM 矩阵</strong>：</p><pre data-tool="mdnice编辑器"><span></span><code>wget https://jaspar.elixir.no/download/data/<span>2024</span>/CORE/JASPAR2024_CORE_vertebrates_non-redundant_pfms_meme.txt<br><br>less -S JASPAR2024_CORE_vertebrates_non-redundant_pfms_meme.txt<br><br><span># MEME version 4</span><br><span>#</span><br><span># ALPHABET= ACGT</span><br><span>#</span><br><span># strands: + -</span><br><span>#</span><br><span># Background letter frequencies</span><br><span># A 0.25 C 0.25 G 0.25 T 0.25</span><br><span>#</span><br><span># MOTIF MA0004.1 Arnt</span><br><span># letter-probability matrix: alength= 4 w= 6 nsites= 20 E= 0</span><br><span>#  0.200000  0.800000  0.000000  0.000000</span><br><span>#  0.950000  0.000000  0.050000  0.000000</span><br><span>#  0.000000  1.000000  0.000000  0.000000</span><br><span>#  0.000000  0.000000  1.000000  0.000000</span><br><span>#  0.000000  0.000000  0.000000  1.000000</span><br><span>#  0.000000  0.000000  1.000000  0.000000</span><br><span># URL http://jaspar.genereg.net/matrix/MA0004.1</span><br><span>#</span><br><span># MOTIF MA0069.1 PAX6</span><br><span># letter-probability matrix: alength= 4 w= 14 nsites= 43 E= 0</span><br><span>#  0.046512  0.093023  0.093023  0.767442</span><br><span>#  0.046512  0.046512  0.000000  0.906977</span><br><span>#  0.093023  0.604651  0.023256  0.279070</span><br><span>#  0.906977  0.046512  0.023256  0.023256</span><br><span>#  0.069767  0.790698  0.023256  0.116279</span><br><span>#  0.023256  0.000000  0.953488  0.023256</span><br><span>#  0.023256  0.860465  0.093023  0.023256</span><br><span>#  0.488372  0.046512  0.046512  0.418605</span><br><span>#  0.023256  0.093023  0.023256  0.860465</span><br><span>#  0.046512  0.325581  0.581395  0.046512</span><br><span>#  0.837209  0.000000  0.139535  0.023256</span><br><span>#  0.255814  0.255814  0.302326  0.186047</span><br><span>#  0.023256  0.116279  0.069767  0.790698</span><br><span>#  0.023256  0.000000  0.395349  0.581395</span><br><span># URL http://jaspar.genereg.net/matrix/MA0069.1</span><br><span># ...</span><br></code></pre><blockquote data-tool="mdnice编辑器"><span>❝</span><p>我们需要对下载的数据进行处理，<strong>得到每个 motif 对应一个矩阵文件，需要以.cb 结尾，文件名和 motif 保持一致</strong>：</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code><span># 提取motif及矩阵</span><br>grep -E <span>"MOTIF|^[[:space:]]*[0-9]"</span> JASPAR2024_CORE_vertebrates_non-redundant_pfms_meme.txt | sed <span>'s/MOTIF /&gt;/g'</span> |sed <span>'s/^[[:space:]]*//g'</span> &gt; tf_motif_pfm_maxtrix.txt<br><br><span># 替换空格</span><br>sed -i <span>'s/&gt;MA\([0-9.]*\) /&gt;MA\1_/'</span> tf_motif_pfm_maxtrix.txt<br><br><span># check</span><br>less tf_motif_pfm_maxtrix.txt<br><span># &gt;MA0004.1_Arnt</span><br><span># 0.200000  0.800000  0.000000  0.000000</span><br><span># 0.950000  0.000000  0.050000  0.000000</span><br><span># 0.000000  1.000000  0.000000  0.000000</span><br><span># 0.000000  0.000000  1.000000  0.000000</span><br><span># 0.000000  0.000000  0.000000  1.000000</span><br><span># 0.000000  0.000000  1.000000  0.000000</span><br><span># &gt;MA0069.1_PAX6</span><br><span># 0.046512  0.093023  0.093023  0.767442</span><br><span># 0.046512  0.046512  0.000000  0.906977</span><br><span># 0.093023  0.604651  0.023256  0.279070</span><br><span># 0.906977  0.046512  0.023256  0.023256</span><br><span># 0.069767  0.790698  0.023256  0.116279</span><br><span># 0.023256  0.000000  0.953488  0.023256</span><br><span># 0.023256  0.860465  0.093023  0.023256</span><br><span># 0.488372  0.046512  0.046512  0.418605</span><br><span># 0.023256  0.093023  0.023256  0.860465</span><br><span># 0.046512  0.325581  0.581395  0.046512</span><br><span># 0.837209  0.000000  0.139535  0.023256</span><br><span># 0.255814  0.255814  0.302326  0.186047</span><br><span># 0.023256  0.116279  0.069767  0.790698</span><br><span># 0.023256  0.000000  0.395349  0.581395</span><br></code></pre><p data-tool="mdnice编辑器">保存每个文件：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 输出保存到每个文件</span><br>mkdir motif_dir<br>cd motif_dir<br>awk <span>'/^&gt;/{if(file) close(file); filename=substr($0,2)".cb"; print $0 &gt; filename; file=filename; next} {print &gt;&gt; file}'</span> ../tf_motif_pfm_maxtrix.txt<br><br>ls<br><span># MA0002.3_Runx1.cb         MA0515.1_Sox6.cb            MA0755.2_CUX2.cb     MA1116.2_RBPJ.cb         MA1623.2_Stat2.cb</span><br><span># MA0003.5_TFAP2A.cb        MA0516.3_SP2.cb             MA0756.3_ONECUT2.cb  MA1117.2_RELB.cb         MA1624.2_Stat5a.cb</span><br><span># MA0004.1_Arnt.cb          MA0517.2_STAT1::STAT2.cb    MA0757.2_ONECUT3.cb  MA1118.2_SIX1.cb         MA1625.2_Stat5b.cb</span><br><span># MA0006.2_Ahr::Arnt.cb     MA0518.2_Stat4.cb           MA0758.1_E2F7.cb     MA1119.2_SIX2.cb         MA1627.2_Wt1.cb</span><br><span># MA0007.4_Ar.cb            MA0519.2_Stat5a::Stat5b.cb  MA0759.3_ELK3.cb     MA1120.2_SOX13.cb        MA1628.2_Zic1::Zic2.cb</span><br><span># MA0009.2_TBXT.cb          MA0520.2_Stat6.cb           MA0760.2_ERF.cb      MA1121.2_TEAD2.cb        MA1629.2_Zic2.cb</span><br></code></pre><blockquote data-tool="mdnice编辑器"><span>❝</span><p>准备每个 motif id 文件：</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>grep <span>"&gt;"</span> tf_motif_pfm_maxtrix.txt|sed <span>'s/&gt;//g'</span> &gt; motifs_id.txt<br><br>head motifs_id.txt<br><span># MA0004.1_Arnt</span><br><span># MA0069.1_PAX6</span><br><span># MA0071.1_RORA</span><br><span># MA0074.1_RXRA::VDR</span><br><span># MA0101.1_REL</span><br><span># MA0107.1_RELA</span><br><span># MA0115.1_NR1H2::RXRA</span><br><span># MA0116.1_Znf423</span><br><span># MA0119.1_NFIC::TLX1</span><br><span># MA0130.1_ZNF354C</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>准备启动子序列文件</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p>前面提到需要的fasta序列（<strong>regions/genes</strong>），<strong>可以是转录因子结合区域的序列，也可以自己提取每个基因上游的启动子区域的序列，这里我们手动去提取基因转录上游3K的序列。</strong></p></blockquote><p data-tool="mdnice编辑器"><strong>下载猪的基因组和注释文件（https://www.ensembl.org/Sus_scrofa/Info/Index）：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032752" data-ratio="0.3388888888888889" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibdFvS2TrYUAmnUP9EHcemUJGnahLXEibMXmxdrQ3MdMYhPCSR7wg6libw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibdFvS2TrYUAmnUP9EHcemUJGnahLXEibMXmxdrQ3MdMYhPCSR7wg6libw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># download genome and gtf</span><br>wget https://ftp.ensembl.org/pub/release-<span>113</span>/gtf/sus_scrofa/Sus_scrofa.Sscrofa11.1.113.gtf.gz<br><br>wget https://ftp.ensembl.org/pub/release-<span>113</span>/fasta/sus_scrofa/dna/Sus_scrofa.Sscrofa11.1.dna.toplevel.fa.gz<br></code></pre><p data-tool="mdnice编辑器"><strong>计算正负链基因上游3000bp的位置：</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(rtracklayer)<br><span>library</span>(tidyverse)<br><span>library</span>(Biostrings)<br><br>gtf &lt;- import(<span>"Sus_scrofa.Sscrofa11.1.113.gtf.gz"</span>,format = <span>"gtf"</span>) %&gt;% <br>  as.data.frame()<br><br><span># get gene promoters regions</span><br>genes &lt;- gtf %&gt;% <br>  dplyr::filter(type == <span>"gene"</span> &amp; gene_name != <span>"NA"</span>) %&gt;% <br>  dplyr::select(seqnames, start, end, strand, gene_name) %&gt;% <br>  dplyr::mutate(start2 = ifelse(strand == <span>"+"</span>,start - <span>3000</span>,end + <span>1</span>),<br>                end2 = ifelse(strand == <span>"+"</span>,start - <span>1</span>,end + <span>3000</span>))<br><br><span># check</span><br>head(genes)<br><span>#   seqnames     start       end strand gene_name    start2      end2</span><br><span># 1        1 226161299 226217308      -   ALDH1A1 226217309 226220308</span><br><span># 2        1 226414306 226432279      +     ANXA1 226411306 226414305</span><br><span># 3        1 227574648 227772671      +      RORB 227571648 227574647</span><br><span># 4        1 227811204 227963309      -     TRPM6 227963310 227966309</span><br><span># 5        1 228033996 228045013      -   C9orf40 228045014 228048013</span><br><span># 6        1 228054915 228092263      -   CARNMT1 228092264 228095263</span><br></code></pre><p data-tool="mdnice编辑器"><strong>对基因组染色体重新命名：</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span># load genome file</span><br>gemome &lt;- readDNAStringSet(filepath = <span>"Sus_scrofa.Sscrofa11.1.dna.toplevel.fa.gz"</span>)<br>gemome<br><span># DNAStringSet object of length 613:</span><br><span>#         width seq                                                                       names               </span><br><span># [1] 274330532 GCTTAATTTTTGTCATTTCTCACCCCTGCTCTTGA...CTTTCTTTTTTCTTGAGACTTACGTTCATTGGGGA 1 dna:primary_ass...</span><br><span># [2] 151935994 GAAGTGCCCTGCCAAGTGGCCTAAGTCTTTCTCTC...GGTTGGTTAGGGTTAGGGTTAGATCTTCTCTCTTT 2 dna:primary_ass...</span><br><span># [3] 132848913 AGAAATGTAGAAGAAATGGGTGATTTGTAATAAAA...GGTTAGGTAGGGTTAGGGTTAGGGTTAGGGTTAGG 3 dna:primary_ass...</span><br><span># [4] 130910915 CTCCTTTGACTCTTGGTCTAAATTAGCTCACCTGA...TAGGGCTGCTTCCTGTGGCCTATATCTCTCTTCTT 4 dna:primary_ass...</span><br><span># [5] 104526007 ACACGGCTCGGGGATGGGTGCGGCGGCTCCGCGTC...TGATGGTACGAACGTCGTGAAGGTACAAGGAACTA 5 dna:primary_ass...</span><br><span># ...       ... ...</span><br><span># [609]     15496 TCTACTTTTCTCCCTCAATACTATGAGTAAAGGTA...AGATGTGGTACATATACACAATGGAATATTACTCG AEMK02000270.1 dn...</span><br><span># [610]     15455 GTAAGTACTAATCTCTAGACTCCCTGGTGCATGTG...GAAGTTGTTTACGAAAGACAAGGGAGAATACACAA AEMK02000323.1 dn...</span><br><span># [611]     15107 GAGGTTTAAACTTAACAAATAACTTCAGAATGTGT...ACACACAAAAAATAAACAGAAAAAGTACACGCTTC AEMK02000417.1 dn...</span><br><span># [612]     15107 GACGGCCCGTGGGGTCGACCATATGTCCCGGGCGA...CCTGGGTGTCGAACAGCTGTCCCAGAGGACTCACA AEMK02000654.1 dn...</span><br><span># [613]     15096 CCCTCTGAACACTCACTGCCAGCCTTTTTTTTTTT...TTGTGGATTTAAATGGTGAATTCATGGCATTTAAA AEMK02000519.1 dn...</span><br><br><span># rename seqnames</span><br>names(gemome) &lt;- sapply(strsplit(names(gemome),split = <span>" "</span>),<span>"["</span>,<span>1</span>)<br><br><span># head</span><br>head(names(gemome),<span>25</span>)<br><span># [1] "1"              "2"              "3"              "4"              "5"              "6"             </span><br><span># [7] "7"              "8"              "9"              "10"             "11"             "12"            </span><br><span># [13] "13"             "14"             "15"             "16"             "17"             "18"            </span><br><span># [19] "X"              "Y"              "MT"             "AEMK02000452.1" "AEMK02000698.1" "AEMK02000361.1"</span><br><span># [25] "AEMK02000598.1"</span><br></code></pre><p data-tool="mdnice编辑器"><strong>循环提取启动子序列:</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span># extract promter sequences</span><br><span># x = 1</span><br>lapply(<span>1</span>:nrow(genes),<span>function</span>(x){<br>  print(x)<br>  tmp &lt;- genes[x,]<br>  <br>  <span># try extract seq</span><br>  out &lt;- <span>tryCatch</span>(<br>    seq &lt;- gemome[[tmp$seqnames]][tmp$start2:tmp$end2],<br>    error = <span>function</span>(e){ <span>return</span>(<span>NULL</span>) }<br>  )<br><br>  <span># check</span><br>  <span>if</span>(!is.null(out)){<br>    <span># strand</span><br>    <span>if</span>(tmp$strand == <span>"-"</span>){<br>      out &lt;- reverseComplement(out)<br>    }<span>else</span>{<br>      out<br>    }<br>    <br>  }<span>else</span>{<br>    DNAString()<br>  }<br>  <br>}) %&gt;% DNAStringSet() -&gt; seq_list<br><br><span># assign names and process unique gene name</span><br>names(seq_list) &lt;- make.unique(genes$gene_name)<br><br>seq_list<br><span># DNAStringSet object of length 17633:</span><br><span>#     width seq                                                                         names               </span><br><span># [1]  3000 AGTGATCAGAAGCAAAGGGATATGTCCATTGCTGGG...CATGCACATAAAAAGGAACAAATAAAGCTAAGTGCT ALDH1A1</span><br><span># [2]  3000 TAATAATAACTATTACTCAAATATTTTTATGCAATG...AAACTCTATAAAATGAGAAGCCCAAGGCTCCACTTC ANXA1</span><br><span># [3]  3000 GACATTAAGAGTTCTTATATTTTTCTGGCTTTCCCA...CGGGGCGATGATTGGCGGCGACGCTGACAGGAGGCG RORB</span><br><span># [4]  3000 CATCCAACTAAGTTTTTAATGAATGCTCGTTATGTT...AACAAGAACAATAAAATATGTCTGTGGTTATGATGA TRPM6</span><br><span># [5]  3000 GCAAAAGAATCAAACTGGACTACTTTCTCATACCAC...TATCGGTGCTCGGCCTCCCGCGCCGGGCGGGCTCCG C9orf40</span><br><span># ...   ... ...</span><br><span># [17629]  3000 CAGTATCCCTATTTTGAAAAGAAAGAAAAGGTGTGG...TGTGTGTATAAATACATGAATGAAAATAAAATAGTC U6</span><br><span># [17630]  3000 CACCTACTGACAAATATATCAGAACTAGCAAGCATA...TTTTTCACAGAACTAGAACAAAAATTTTAAAATTTG U6</span><br><span># [17631]  3000 TACGAATGAACTCGGAAGTATTTTGTGGTATCCTTT...AGGTAGCACACACCCAGGCGATCTTGCAAGTAAGAG ssc-mir-9785</span><br><span># [17632]  3000 GTTTCGGGTTTTCTCCACCCCCTCTCCCTCCTGTTT...TCATTCTGTCGCGGGCCCCTCGCTGCTCCTCCCCCA ssc-mir-6782</span><br><span># [17633]  3000 ACGTCTGCCCTATCAACTTTCGATGGTAGTCGCCGT...AGTGTGCCGTGCCGCCATTCCAAACCAAGCACGTAC 5_8S_rRNA</span><br><br><span># filter seq length</span><br>fasta_filtered &lt;- seq_list[width(seq_list) &gt; <span>1</span>]<br><br><span># output fasta format</span><br>writeXStringSet(fasta_filtered,filepath = <span>"Sus_scrofa_3kpromoter.fasta"</span>,format=<span>"fasta"</span>)<br></code></pre><p data-tool="mdnice编辑器"><strong>IGV检查负链基因ALDH1A1启动子序列前后各一部分位置：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032751" data-ratio="0.6111771700356718" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibkMr7tfjkiahzxGMLicicKTY093PQkDdxnt17icaCIe8nzlhEOLE3FYZ8rQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="841" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibkMr7tfjkiahzxGMLicicKTY093PQkDdxnt17icaCIe8nzlhEOLE3FYZ8rQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>IGV检查正链基因ANXA1启动子序列前后各一部分位置：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032757" data-ratio="0.35" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibOAYwKfQy6gnF2ECRuHDGOBTFcichusletA9Zm8y42jVFFGdPOW3TxjQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibOAYwKfQy6gnF2ECRuHDGOBTFcichusletA9Zm8y42jVFFGdPOW3TxjQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>以上结果表明我们提取的启动子序列没有问题。</strong></p><h2 data-tool="mdnice编辑器"><span></span><span>构建 cisTarget databases</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p>前面准备好了文件可以开始运行 <strong>create_cistarget_motif_databases.py</strong> 了。</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>python create_cisTarget_databases/create_cistarget_motif_databases.py 、<br>    -f Sus_scrofa_3kpromoter.fasta 、<br>    -M motif_dir/ -m motifs_id.txt 、<br>    -t <span>15</span> -o Sus_scrofa<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100032758" data-ratio="0.26666666666666666" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibyjGzZLKF5O014NMqdJ7xJve9Yn1ibHu5NdNicnmg5b7mFB1Uft4G17AQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibyjGzZLKF5O014NMqdJ7xJve9Yn1ibHu5NdNicnmg5b7mFB1Uft4G17AQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">最终生成了 <strong>Sus_scrofa.motifs_vs_regions.scores.feather， Sus_scrofa.regions_vs_motifs.rankings.feather， Sus_scrofa.regions_vs_motifs.scores.feather</strong> 三个文件：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032756" data-ratio="0.06881720430107527" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibN4SLfeTTgPic4TU4MPQSArKJZdwHZA04oET6zsRYUeCTDQsYtSoB3xA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="930" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibN4SLfeTTgPic4TU4MPQSArKJZdwHZA04oET6zsRYUeCTDQsYtSoB3xA/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>其它两个文件</span><span></span></h2><figure data-tool="mdnice编辑器"><img data-imgfileid="100032759" data-ratio="0.575925925925926" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibwr2ehF7nMWEPCSm6oIuNibFIHZ4d69SUkbkEiaiaU8hdlkXic7u3PmtyGQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibwr2ehF7nMWEPCSm6oIuNibFIHZ4d69SUkbkEiaiaU8hdlkXic7u3PmtyGQ/640?wx_fmt=png&amp;from=appmsg"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>转录因子到 motif 的注释文件</strong> 如何准备官网并没有说明，github上也有人提了这个问题，<strong>作者建议使用同源基因去替换官网的示例文件里面的内容，如果没用就删除那一行</strong>。比如你可以使用 <strong>OrthiFinder</strong> 软件去找自己物种和人的同源基因，再处理官网的示例文件。<strong>感觉对于其它物种的支持确实不太好，建议作者出一个手把手教程去做这么一个分析还是很必要的。</strong></p></blockquote><p data-tool="mdnice编辑器"><strong>官网motif2TF文件示例：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032760" data-ratio="0.2638888888888889" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibhjSgNAHb10MdMbqpeT2o0zHT5CRXHpxevrIDSAyia9of19EV9YgtyVg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ibhjSgNAHb10MdMbqpeT2o0zHT5CRXHpxevrIDSAyia9of19EV9YgtyVg/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100032765" data-ratio="0.6675925925925926" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6iboFQic6wKK4pPzG3bnTH2ic5tLTQpKEicXDuWDxFjWdqneJITlcAwjaxpQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6iboFQic6wKK4pPzG3bnTH2ic5tLTQpKEicXDuWDxFjWdqneJITlcAwjaxpQ/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032764" data-ratio="0.6083707025411061" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ib6nvzc3Wp3MHYmfw3OFY0QFKpibYTs8xSkaojbHkZXC2Hn7tGPLKnvvA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="669" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezKrxo42Ij88iaS4gv91sS6ib6nvzc3Wp3MHYmfw3OFY0QFKpibYTs8xSkaojbHkZXC2Hn7tGPLKnvvA/640?wx_fmt=png&amp;from=appmsg"></figure><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录</strong></center><p data-tool="mdnice编辑器"><br></p><blockquote data-tool="mdnice编辑器"><span>❝</span><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516393&amp;idx=1&amp;sn=34a9932b10a215b53e2517604ac8d9a6&amp;token=1818336094&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">加速服务器数据的下载与上传</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516370&amp;idx=1&amp;sn=0acc8657ede5d4878c10c307c009d68b&amp;token=1606055947&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">单细胞去噪工具一览</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516317&amp;idx=1&amp;sn=393d73fb463838b7370f756b27803301&amp;token=1606055947&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">pySCENIC 转录因子调控网络分析教程</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516265&amp;idx=1&amp;sn=496e85346f555db9b64c516953876a24&amp;token=1606055947&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">想做单细胞分析，你需要什么电脑配置？</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516236&amp;idx=1&amp;sn=54add6f74f348f63e36944f4fa4051f3&amp;token=941065474&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">scATAC 上游数据分析之 Cell Ranger ATAC</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516196&amp;idx=1&amp;sn=9fe1e9f00ab977aa1f39fdd8b19675bc&amp;token=941065474&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">单细胞上游处理 cellranger 定量</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516165&amp;idx=1&amp;sn=338f0ac0dc903a1c8d5be3ae6227ebb3&amp;token=941065474&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">scATAC 多样本整合</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516132&amp;idx=1&amp;sn=ce65838712aa2e5e4c3c5b7dcfdb71b4&amp;token=1001473693&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">单细胞亚群注释相关工具</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516072&amp;idx=1&amp;sn=f82a27c6936f38c3a078ea259178216d&amp;token=1001473693&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">听说你想美化 signac 的 track 图？</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247516054&amp;idx=1&amp;sn=4315e02f23804d9578464dac4c9d5646&amp;token=291087746&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">scanpy 处理单细胞数据</a></center></strong><p><br></p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/7-vKrLiFS4Tlkt-rHxEGeQ",target="_blank" rel="noopener noreferrer">原文链接</a>
