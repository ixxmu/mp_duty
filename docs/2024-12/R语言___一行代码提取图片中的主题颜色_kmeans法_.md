---
title: "R语言 | 一行代码提取图片中的主题颜色（kmeans法）"
date: 2024-12-07T15:58:45Z
draft: ["false"]
tags: [
  "fetched",
  "生物慕课"
]
categories: ["Acdemic"]
---
R语言 | 一行代码提取图片中的主题颜色（kmeans法） by 生物慕课
------
<div><section><span leaf="">单细胞总是缺少合适的颜色组合。太浅了、太深了不好区分，太浓艳了看着扎眼。除了直接照搬别人sci中的优秀配色外，大自然鬼斧神工的照片也可提供很好的配色灵感，如果能自动化提取出关键颜色，做成大色块展示效果，供我们挑选，那就好极了！</span></section><section><span leaf="">本文尝试给出R语言实现。无需借助其他工具，一行R函数即可制作美图主题色卡。本工作适合在windows上操作。</span></section><section><span leaf=""><span textstyle="">只需记住前两个参数：图片路径和提取k个颜色。</span></span></section><section><span leaf=""><span textstyle="">1. 示例1：提取大自然美景中的色彩</span></span></section><section><ul><li><li></ul><pre data-lang="swift"><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"D:</span></span><span><span>\\</span></span><span><span>Program Files (x86)</span></span><span><span>\\</span></span><span><span>EyeDefender</span></span><span><span>\\</span></span><span><span>scenery-46.jpg"</span></span><span>, k</span><span>=</span><span>10</span><span>)</span></span></code><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"D:</span></span><span><span>\\</span></span><span><span>Program Files (x86)</span></span><span><span>\\</span></span><span><span>EyeDefender</span></span><span><span>\\</span></span><span><span>scenery-56.jpg"</span></span><span>, k</span><span>=</span><span>8</span><span>)</span></span></code></pre></section><section nodeleaf=""><img data-imgfileid="100000525" data-ratio="0.48514851485148514" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAmkQg8iaSiaiaTqJYibdsa4RWeQfdwAksOR5QMt0uoq5AdJNBokrPN43rlzZrpelLl8C3K0SAEFHDHadQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="707" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAmkQg8iaSiaiaTqJYibdsa4RWeQfdwAksOR5QMt0uoq5AdJNBokrPN43rlzZrpelLl8C3K0SAEFHDHadQ/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf=""><br></span></section><h3><span leaf="">2. 示例2：从手绘示意图中获取颜色灵感</span></h3><section><ul><li></ul><pre data-lang="swift"><code><span leaf=""><span> getColorsFromPicture(</span><span><span>"C:</span></span><span><span>\\</span></span><span><span>Users</span></span><span><span>\\</span></span><span><span>DELL</span></span><span><span>\\</span></span><span><span>Pictures</span></span><span><span>\\</span></span><span><span>Biology</span></span><span><span>\\</span></span><span><span>Bone-marrow-stem-cell-differentiation.png"</span></span><span>, k</span><span>=</span><span>30</span><span>)</span></span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAmkQg8iaSiaiaTqJYibdsa4RWeQWJgczqCxgaHEoE1hVGC9VGfR84oiam2PibnsegrFnzE88wEh55ew2mHA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.4372670807453416" data-s="300,640" data-type="png" data-w="805" type="block" data-imgfileid="100000526" src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAmkQg8iaSiaiaTqJYibdsa4RWeQWJgczqCxgaHEoE1hVGC9VGfR84oiam2PibnsegrFnzE88wEh55ew2mHA/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">3. 示例3：从sci图片中获取颜色灵感</span></span></section><section><ul><li></ul><pre data-lang="swift"><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"C:</span></span><span><span>\\</span></span><span><span>Users</span></span><span><span>\\</span></span><span><span>DELL</span></span><span><span>\\</span></span><span><span>Pictures</span></span><span><span>\\</span></span><span><span>scRNA-seq</span></span><span><span>\\</span></span><span><span>Heatmap_cluster.png"</span></span><span>, k</span><span>=</span><span>40</span><span>)</span></span></code></pre></section><section nodeleaf=""><img data-imgfileid="100000527" data-ratio="0.7202729044834308" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAmkQg8iaSiaiaTqJYibdsa4RWeQXWQLiczJ7icMNafomOOjicrbnuPTpbfAjSRH4sKiaIeLBQvcAU6ceUP1eg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1026" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAmkQg8iaSiaiaTqJYibdsa4RWeQXWQLiczJ7icMNafomOOjicrbnuPTpbfAjSRH4sKiaIeLBQvcAU6ceUP1eg/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf="">输出是按照颜色的频率排序的，大块的颜色优先输出。比如上图第一列是白色。</span></section><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">4. 炫技：3d展示 kmeans 颜色聚类效果</span></span></section><section><span leaf=""><span textstyle="">感觉这个功能是鸡肋，基本用不上。需要依赖第三方包。</span></span></section><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="swift"><code><span leaf=""><span># test 3d</span></span></code><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"D:</span></span><span><span>\\</span></span><span><span>Program Files (x86)</span></span><span><span>\\</span></span><span><span>EyeDefender</span></span><span><span>\\</span></span><span><span>scenery-30.jpg"</span></span><span>, k</span><span>=</span><span>8</span><span>)</span></span></code><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"D:</span></span><span><span>\\</span></span><span><span>Program Files (x86)</span></span><span><span>\\</span></span><span><span>EyeDefender</span></span><span><span>\\</span></span><span><span>scenery-30.jpg"</span></span><span>, k</span><span>=</span><span>8</span><span>, show</span><span>=</span><span>"none"</span><span>)</span></span></code><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"D:</span></span><span><span>\\</span></span><span><span>Program Files (x86)</span></span><span><span>\\</span></span><span><span>EyeDefender</span></span><span><span>\\</span></span><span><span>scenery-30.jpg"</span></span><span>, k</span><span>=</span><span>8</span><span>, show</span><span>=</span><span>"3d"</span><span>)</span></span></code><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"D:</span></span><span><span>\\</span></span><span><span>Program Files (x86)</span></span><span><span>\\</span></span><span><span>EyeDefender</span></span><span><span>\\</span></span><span><span>scenery-30.jpg"</span></span><span>, k</span><span>=</span><span>8</span><span>, show</span><span>=</span><span>"3d"</span><span>, angle.3d</span><span>=</span><span>80</span><span>)</span></span></code><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"D:</span></span><span><span>\\</span></span><span><span>Program Files (x86)</span></span><span><span>\\</span></span><span><span>EyeDefender</span></span><span><span>\\</span></span><span><span>scenery-30.jpg"</span></span><span>, k</span><span>=</span><span>8</span><span>, show</span><span>=</span><span>"3dR"</span><span>, angle.3d</span><span>=</span><span>80</span><span>)</span></span></code><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"D:</span></span><span><span>\\</span></span><span><span>Program Files (x86)</span></span><span><span>\\</span></span><span><span>EyeDefender</span></span><span><span>\\</span></span><span><span>scenery-30.jpg"</span></span><span>, k</span><span>=</span><span>8</span><span>, show</span><span>=</span><span>"3di"</span><span>)</span></span></code><code><span leaf=""><span>getColorsFromPicture(</span><span><span>"D:</span></span><span><span>\\</span></span><span><span>Program Files (x86)</span></span><span><span>\\</span></span><span><span>EyeDefender</span></span><span><span>\\</span></span><span><span>scenery-30.jpg"</span></span><span>, k</span><span>=</span><span>8</span><span>, show</span><span>=</span><span>"3diR"</span><span>)</span></span></code></pre></section><section nodeleaf=""><img data-imgfileid="100000528" data-ratio="0.6638141809290954" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAmkQg8iaSiaiaTqJYibdsa4RWeQ9icwMibgNiawwQUUzjiaulxRv4GF2icoSeS8GzR9YQ49F1ZtnLfZERW4Xog/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="818" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAmkQg8iaSiaiaTqJYibdsa4RWeQ9icwMibgNiawwQUUzjiaulxRv4GF2icoSeS8GzR9YQ49F1ZtnLfZERW4Xog/640?wx_fmt=png&amp;from=appmsg"></section><section><ul><li><li><li><li><li></ul><pre data-lang="sql"><code><span leaf=""><span>show</span><span>参数： </span></span></code><code><span leaf=""><span>-</span><span> 支持几个固定值：默认"static", 还可以是"3d", "3dR", "3di", "3dR”, "</span><span>3</span><span>diR";</span></span></code><code><span leaf=""><span>- 3d开头的是3d效果，</span></span></code><code><span leaf=""><span>- 带i的是交互式的，可鼠标拖动</span></span></code><code><span leaf=""><span>- 带R的展示的是真实色彩，否则展示的是kmeans聚类的代表色</span></span></code></pre></section><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">5. 函数实现与思路</span></span></section><section><span leaf="">思路：输入硬盘图片，按像素读取RGB值，做kmeans聚类，给出最代表性的颜色。</span></section><section><span leaf="">函数执行后会自动返回颜色的16进制，如：</span></section><pre tabindex="0" aria-label="Console Output" role="document"><span tabindex="-1" role="document"><span><span leaf="">"#49A0D4","#9CBACF","#6A9BBD","#6DADD7","#88AABD","#BBC8CC","#0E1409","#4C8EBA","#2F3118","#4A5228","#D88151","#BD623D","#874631","#767F3D","#55877B"</span></span></span></pre><section><span leaf=""><br></span></section><p><span leaf="">函数源代码如下：</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="kotlin"><code><span leaf=""><span>#</span><span>' 给出图片的代表颜色卡：kmeans法</span></span></code><code><span leaf=""><span>#' </span></span></code><code><span leaf=""><span>#</span><span>' @version v1.2 给出聚类效果的3d展示</span></span></code><code><span leaf=""><span>#' </span><span>@version</span><span> v1</span><span>.3</span><span> static 左侧不留空间，右侧多些，方便显示颜色</span></span></code><code><span leaf=""><span>#</span><span>'</span></span></code><code><span leaf=""><span>#' </span><span>@param</span><span> filename jpg or png filename</span></span></code><code><span leaf=""><span>#</span><span>' @param k k-means聚类个数，默认5</span></span></code><code><span leaf=""><span>#' </span><span>@param</span><span> show 是否展示颜色效果，默认</span><span>"static"</span><span>, 可选包括: </span><span>"none"</span><span>(不显示图片), </span><span>"3d"</span><span>, </span><span>"3dR"</span><span>, </span><span>"3di"</span><span>, </span><span>"3dR”, "</span><span>3diR</span><span>"; </span></span></code><code><span leaf=""><span>#' 区别是i是交互式的</span></span></code><code><span leaf=""><span>#' 不加R显示聚类后的代表颜色，加R是真实颜色（参考意义不大）</span></span></code><code><span leaf=""><span>#' @param angle.3d 当且仅当show == "</span><span>3d</span><span>"，设置角度有效，默认45，范围 [0, 360]。</span></span></code><code><span leaf=""><span>#'</span></span></code><code><span leaf=""><span>#' @return</span></span></code><code><span leaf=""><span>#' @export</span></span></code><code><span leaf=""><span>#'</span></span></code><code><span leaf=""><span>#' @examples</span></span></code><code><span leaf=""><span>getColorsFromPicture=function(filename, k=5, show="static</span><span>", angle.3d=45){</span></span></code><code><span leaf=""><span>  # step1</span></span></code><code><span leaf=""><span>  #filename = "D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>50.</span><span>jpg</span><span>"</span></span></code><code><span leaf=""><span>  #filename = "D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>30.</span><span>jpg</span><span>"</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>  # step2</span></span></code><code><span leaf=""><span>  # 读取图片</span></span></code><code><span leaf=""><span>  if( endsWith(filename, "jpg</span><span>") || endsWith(filename, "</span><span>JPG</span><span>") ){</span></span></code><code><span leaf=""><span>    library(jpeg)</span></span></code><code><span leaf=""><span>    img &lt;- readJPEG(filename) </span></span></code><code><span leaf=""><span>  }else if( endsWith(filename, "png</span><span>") || endsWith(filename, "</span><span>PNG</span><span>") ){</span></span></code><code><span leaf=""><span>    library(png)</span></span></code><code><span leaf=""><span>    img &lt;- readPNG(filename)</span></span></code><code><span leaf=""><span>  }</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>  # 获取图片的维度</span></span></code><code><span leaf=""><span>  dim_img &lt;- dim(img)</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>  # 将图片转换为数据框，包含每个像素的 RGB 值</span></span></code><code><span leaf=""><span>  pixels &lt;- as.data.frame(matrix(img, nrow = dim_img[1] * dim_img[2], ncol = 3))</span></span></code><code><span leaf=""><span>  colnames(pixels) &lt;- c("R</span><span>", "</span><span>G</span><span>", "</span><span>B</span><span>")</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>  # step3</span></span></code><code><span leaf=""><span>  # 设置聚类数量</span></span></code><code><span leaf=""><span>  k &lt;- k  # 你可以根据需要调整这个值</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>  # 进行 K-means 聚类</span></span></code><code><span leaf=""><span>  set.seed(42)  # 设置随机种子以确保结果可重复</span></span></code><code><span leaf=""><span>  kmeans_result &lt;- kmeans(pixels, centers = k)</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>  # 将聚类结果添加到数据框中</span></span></code><code><span leaf=""><span>  pixels</span><span>$cluster</span><span> &lt;- as.factor(kmeans_result</span><span>$cluster</span><span>)</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>  # step4</span></span></code><code><span leaf=""><span>  # 计算每个聚类的频率</span></span></code><code><span leaf=""><span>  library(dplyr)</span></span></code><code><span leaf=""><span>  color_summary &lt;- pixels %&gt;%</span></span></code><code><span leaf=""><span>    group_by(cluster) %&gt;%</span></span></code><code><span leaf=""><span>    summarise(</span></span></code><code><span leaf=""><span>      R = mean(R),</span></span></code><code><span leaf=""><span>      G = mean(G),</span></span></code><code><span leaf=""><span>      B = mean(B),</span></span></code><code><span leaf=""><span>      count = n()</span></span></code><code><span leaf=""><span>    ) %&gt;%</span></span></code><code><span leaf=""><span>    arrange(desc(count))  # 按频率降序排列</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>  # 提取代表颜色</span></span></code><code><span leaf=""><span>  representative_colors &lt;- color_summary %&gt;%</span></span></code><code><span leaf=""><span>    select(R, G, B) %&gt;%</span></span></code><code><span leaf=""><span>    as.matrix() %&gt;%</span></span></code><code><span leaf=""><span>    apply(1, function(x) rgb(x[1], x[2], x[3], maxColorValue = 1))</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>  ########################################</span></span></code><code><span leaf=""><span>  # 显示代表颜色：静态图 + 色卡</span></span></code><code><span leaf=""><span>  ########################################</span></span></code><code><span leaf=""><span>  if(show=="static</span><span>"){</span></span></code><code><span leaf=""><span>    oldPar=par(no.readonly = T)</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    # 创建一个窗口并设置布局</span></span></code><code><span leaf=""><span>    par(mfrow = c(2, 1))  # 设置 2 行 1 列的布局</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    # 显示颜色</span></span></code><code><span leaf=""><span>    par(mar = c(0, 0, 4, 1.5)) #bottom, left, top, right</span></span></code><code><span leaf=""><span>    posX=barplot(rep(1, nrow(color_summary)), col = representative_colors, border = NA, axes = F,</span></span></code><code><span leaf=""><span>                 #vp = viewport(layout.pos.row = 2, layout.pos.col = 1),</span></span></code><code><span leaf=""><span>                 main="</span><span>")</span></span></code><code><span leaf=""><span>    text(posX, par("usr</span><span>")[4]*1.04, labels=representative_colors, </span></span></code><code><span leaf=""><span>         srt=45, adj=0,</span></span></code><code><span leaf=""><span>         xpd=T,</span></span></code><code><span leaf=""><span>         col="black</span><span>", xpd=T)</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    # 显示图片</span></span></code><code><span leaf=""><span>    par(mar = c(0, 0, 0, 1.5))</span></span></code><code><span leaf=""><span>    plot(NA, NA, xlim=c(1,dim_img[2]), ylim=c(1,dim_img[1]), type="n</span><span>", xlab="", ylab="", axes=FALSE)</span></span></code><code><span leaf=""><span>    rasterImage(img, 1, 1, dim_img[2], dim_img[1])</span></span></code><code><span leaf=""><span>    par(oldPar)</span></span></code><code><span leaf=""><span>  }</span></span></code><code><span leaf=""><span>  #</span></span></code><code><span leaf=""><span>  ########################################</span></span></code><code><span leaf=""><span>  # 3d展示颜色</span></span></code><code><span leaf=""><span>  ########################################</span></span></code><code><span leaf=""><span>  else if( startsWith(show, "</span><span>3d</span><span>") ){</span></span></code><code><span leaf=""><span>    #head(pixels)</span></span></code><code><span leaf=""><span>    #         R         G         B cluster</span></span></code><code><span leaf=""><span>    #1 0.7686275 0.5490196 0.2549020       2</span></span></code><code><span leaf=""><span>    #2 0.8901961 0.6666667 0.3647059       2</span></span></code><code><span leaf=""><span>    table(pixels</span><span>$cluster</span><span>)</span></span></code><code><span leaf=""><span>    #     1      2      3      4      5      6      7      8 </span></span></code><code><span leaf=""><span>    # 295390 205034 321986 242952 239743 182654 323470 262371 </span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    x=pixels</span><span>$R</span></span></code><code><span leaf=""><span>    y=pixels</span><span>$G</span></span></code><code><span leaf=""><span>    z=pixels</span><span>$B</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    color_summary #k rows</span></span></code><code><span leaf=""><span>    #  cluster      R     G     B  count</span></span></code><code><span leaf=""><span>    #  &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;</span></span></code><code><span leaf=""><span>    #1 3       0.292  0.267 0.247 485072</span></span></code><code><span leaf=""><span>    #2 5       0.382  0.527 0.615 466379</span></span></code><code><span leaf=""><span>    #</span></span></code><code><span leaf=""><span>    #rgb(0.292,  0.267, 0.247, maxColorValue = 1)</span></span></code><code><span leaf=""><span>    #[1] "#4A443F</span><span>"</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    # head(representative_colors )</span></span></code><code><span leaf=""><span>    # "#4B443F</span><span>" "</span><span>#</span><span>61869D</span><span>" "</span><span>#A2B9C7</span><span>" "</span><span>#A5805D</span><span>" "</span><span>#</span><span>165576</span><span>"</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    #order color by cluster</span></span></code><code><span leaf=""><span>    representative_colors2=representative_colors[color_summary</span><span>$cluster</span><span>]</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    #color for each point</span></span></code><code><span leaf=""><span>    colors = factor( representative_colors2[match(pixels</span><span>$cluster</span><span>, color_summary</span><span>$cluster</span><span>)] ) #代表色</span></span></code><code><span leaf=""><span>    #全部颜色</span></span></code><code><span leaf=""><span>    colors.real = pixels  %&gt;% select(R, G, B) %&gt;%</span></span></code><code><span leaf=""><span>      as.matrix() %&gt;%</span></span></code><code><span leaf=""><span>      apply(1, function(x) rgb(x[1], x[2], x[3], maxColorValue = 1))</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    #length(colors)</span></span></code><code><span leaf=""><span>    #table(colors)</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    dat &lt;- data.frame(x, y, z, colors)#生成数据框</span></span></code><code><span leaf=""><span>    head(dat)</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>    # 3d 静态图像</span></span></code><code><span leaf=""><span>    if(show=="</span><span>3d</span><span>"){</span></span></code><code><span leaf=""><span>      # method1</span></span></code><code><span leaf=""><span>      library(scatterplot3d)</span></span></code><code><span leaf=""><span>      plot3d_A &lt;- with(dat, scatterplot3d(x, y, z, color = colors, </span></span></code><code><span leaf=""><span>                                          pch = 16, angle= angle.3d, </span></span></code><code><span leaf=""><span>                                          cex.symbols=0.1,</span></span></code><code><span leaf=""><span>                                          main=paste0("Representative colors | angle=</span><span>", angle.3d))</span></span></code><code><span leaf=""><span>      )</span></span></code><code><span leaf=""><span>      #legend(plot3d_A</span><span>$xyz</span><span>.convert(0.5, 0.7, 0.5), pch=16, yjust=0,</span></span></code><code><span leaf=""><span>      #       border = NA, </span></span></code><code><span leaf=""><span>      #       bg = NA,</span></span></code><code><span leaf=""><span>      #       legend=levels(dat</span><span>$colors</span><span>), </span></span></code><code><span leaf=""><span>      #       col = seq_along(levels(dat</span><span>$colors</span><span>)))</span></span></code><code><span leaf=""><span>    }else if(show=="3dR</span><span>"){</span></span></code><code><span leaf=""><span>      # use real colors</span></span></code><code><span leaf=""><span>      library(scatterplot3d)</span></span></code><code><span leaf=""><span>      plot3d_A &lt;- with(dat, scatterplot3d(x, y, z, color = colors.real, </span></span></code><code><span leaf=""><span>                                          pch = 16, angle= angle.3d, </span></span></code><code><span leaf=""><span>                                          cex.symbols=0.1,</span></span></code><code><span leaf=""><span>                                          main=paste0("Real Colors | angle=</span><span>", angle.3d))</span></span></code><code><span leaf=""><span>      )</span></span></code><code><span leaf=""><span>    }else if(show=="3di</span><span>"){</span></span></code><code><span leaf=""><span>      # method2</span></span></code><code><span leaf=""><span>      library(rgl)</span></span></code><code><span leaf=""><span>      plot3d_B &lt;- with(dat, plot3d(x, y, z, col = colors, pch = 16))</span></span></code><code><span leaf=""><span>    }else if(show=="3diR</span><span>"){</span></span></code><code><span leaf=""><span>      library(rgl)</span></span></code><code><span leaf=""><span>      plot3d_C &lt;- with(dat, plot3d(x, y, z, col = colors.real, pch = 16))</span></span></code><code><span leaf=""><span>    }</span></span></code><code><span leaf=""><span>  }</span></span></code><code><span leaf=""><span>  # 最后输出16进制代表颜色json</span></span></code><code><span leaf=""><span>  message('&gt;&gt; json hex colors: ', representative_colors |&gt; jsonlite::toJSON() )</span></span></code><code><span leaf=""><span>  return(representative_colors)</span></span></code><code><span leaf=""><span>}</span></span></code><code><span leaf=""><span>if(0){ #使用方法</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>49.</span><span>jpg</span><span>")</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>46.</span><span>jpg</span><span>", k=10)</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>56.</span><span>jpg</span><span>", k=8)</span></span></code><code><span leaf=""><span>  #</span></span></code><code><span leaf=""><span>  getColorsFromPicture("C:\\Users\\DELL\\Pictures\\Biology\\Bone-marrow-stem-cell-differentiation.png</span><span>", k=30)</span></span></code><code><span leaf=""><span>  #</span></span></code><code><span leaf=""><span>  getColorsFromPicture("C:\\Users\\DELL\\Pictures\\scRNA-seq\\Heatmap_cluster.png</span><span>", k=40)</span></span></code><code><span leaf=""><span>  #</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\animal-</span><span>7</span><span>-bee.jpg</span><span>", k=15)</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>32.</span><span>jpg</span><span>", k=15)</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>38.</span><span>jpg</span><span>", k=15)</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>48.</span><span>jpg</span><span>", k=15)</span></span></code><code><span leaf=""><span>  # test 3d</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>30.</span><span>jpg</span><span>", k=8)</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>30.</span><span>jpg</span><span>", k=8, show="</span><span>none</span><span>")</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>30.</span><span>jpg</span><span>", k=8, show="</span><span>3d</span><span>")</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>30.</span><span>jpg</span><span>", k=8, show="</span><span>3d</span><span>", angle.3d=80)</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>30.</span><span>jpg</span><span>", k=8, show="</span><span>3dR</span><span>", angle.3d=80)</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>30.</span><span>jpg</span><span>", k=8, show="</span><span>3di</span><span>")</span></span></code><code><span leaf=""><span>  getColorsFromPicture("D:\\Program Files (x86)\\EyeDefender\\scenery-</span><span>30.</span><span>jpg</span><span>", k=8, show="</span><span>3diR</span><span>")</span></span></code><code><span leaf=""><span>}</span></span></code></pre></section><p><span leaf=""><br></span></p><p><span leaf="">使用该函数，你也可以制作自己的美图颜色卡片了！</span></p><p><span leaf="">秋天美景主题颜色卡、游戏皮肤主题颜色、热播剧主角服饰主题颜色卡等....期待你的大作！</span></p><p><span leaf=""><br></span></p><p><span><span leaf="">-- End --</span></span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAnHXEickJsNHxveZ0tddRnUkOriad8jptJ3WWAF2Ra3wWB7ia0OPmAcHxCz6pMuJ62W6GJUvuyglSjWw/640?wx_fmt=png" data-ratio="0.37777777777777777" data-s="300,640" data-type="png" data-w="1080" data-imgfileid="100000465" src="https://mmbiz.qpic.cn/mmbiz_png/iaF1T4nQ8WAnHXEickJsNHxveZ0tddRnUkOriad8jptJ3WWAF2Ra3wWB7ia0OPmAcHxCz6pMuJ62W6GJUvuyglSjWw/640?wx_fmt=png"></section><p><span leaf=""><br></span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/38D52sRzgGk_ZdwRvJs8_A",target="_blank" rel="noopener noreferrer">原文链接</a>
