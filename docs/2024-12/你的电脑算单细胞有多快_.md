---
title: "你的电脑算单细胞有多快？"
date: 2024-12-13T05:31:06Z
draft: ["false"]
tags: [
  "fetched",
  "Biomamba 生信基地"
]
categories: ["Acdemic"]
---
你的电脑算单细胞有多快？ by Biomamba 生信基地
------
<div><section data-support="96编辑器" data-style-id="39922"><section><section><section><section><p><strong>写在前面</strong></p></section></section></section></section></section><section data-support="96编辑器" data-style-id="40285"><section><section><img data-ratio="0.42857142857142855" data-w="49" data-src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040545" src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><p><span></span></p><p><span>我们一致致力于给大家提提供高性价比的计算设备：</span><span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247511780&amp;idx=1&amp;sn=3acc0874f7d2fa75f1abbe7a9a9b4069&amp;scene=21#wechat_redirect" textvalue="足够支持你完成硕博生涯的生信环境" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">足够支持你完成硕博生涯的生信环境</a></span><span>。考虑到我们的用户群体还是做单细胞测序数据分析较多，因此我用手里拥有的所有计算资源(<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247522266&amp;idx=1&amp;sn=3ea8087e380f0cdee0d9632afb6b7582&amp;scene=21#wechat_redirect" textvalue="Biomamba独享服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">Biomamba独享服务器</a>、<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247519707&amp;idx=1&amp;sn=73dcab26f9b2ed75a954327317d07112&amp;scene=21#wechat_redirect" textvalue="本地工作站" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">本地工作站</a>、<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247511780&amp;idx=1&amp;sn=3acc0874f7d2fa75f1abbe7a9a9b4069&amp;scene=21#wechat_redirect" textvalue="共享服务器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">共享服务器</a>)进行了一个常见单细胞数据的分析(参考：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247500010&amp;idx=2&amp;sn=2f9fd1b0101d579bcd250fdc24e98bfc&amp;scene=21#wechat_redirect" textvalue="手把手教你做单细胞测序数据分析|3.单样本分析(2023年重置)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">单样本分析</a>)流程的计算时间测序。它们的配置分别是：</span></p><p><span>独享服务器(整机价格：<strong><span>2.5w￥</span></strong>；</span><span>CPU</span><span>：<span>独享(Intel(R) Xeon(R) CPU E5-2695 v2 @ 2.40GHz)</span>；内存：<span><strong>384GB</strong></span>)</span></p><p><span></span><span>本地工作站(整机价格<span><strong>2.3w￥</strong></span>；CPU：<span>Intel(R) Core(TM) i7-14700KF；内存：<span><strong>192GB</strong></span></span>)</span></p><p><span>共享服务器特惠版( 租赁价格：最低<span><strong>699￥</strong></span>；CPU：<span>Intel(R) Xeon(R) CPU E5-4657L v2 @ 2.40GHz；内存：<span><strong>256GB</strong></span></span>)</span></p><p>共享服务器专业版(租赁价格：最低<span><strong>1999￥</strong></span>；CPU：<span>Intel(R) Xeon(R) CPU E5-2696 v4 @ 2.20GHz；内存：<span><strong>512GB</strong></span></span>)<span><br></span></p><p><br></p><section><span>如果你对下面的教程比较迷茫，那么你可以先行学习编程<span>教程：</span></span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247505777&amp;idx=1&amp;sn=f3efae390566b838a445ab9f832323c8&amp;chksm=9b3cae21ac4b2737f5923b246470d699474c041bb78de50d2b71b99d537f9f44ca2938002cda&amp;scene=21#wechat_redirect" textvalue="十小时学会Linux" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>十小时学会Linux</span></a><br></section><section><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAwMzIzOTk5OQ==&amp;action=getalbum&amp;album_id=2980604042328702978#wechat_redirect" textvalue="生信Linux及服务器使用技巧" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span>生信Linux及服务器使用技巧</span></a></section><section><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506720&amp;idx=1&amp;sn=fe897ba3c33a8e63bf6a4e35aeac1896&amp;scene=21#wechat_redirect" textvalue="R语言基础学习手册" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">R语言基础学习手册</a><br></section><section><br></section><section><span>如果你的计算机不足以支持下面流程的计算，可按需选用适合自己的计算资源：</span></section><section><span>共享(经济实惠)：</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247503869&amp;idx=1&amp;sn=142f8c7ba8620815a8770773df077f12&amp;chksm=9b3cb6adac4b3fbb1acdf7593df06af5ac77d1fe9c0144c999de7109bd063b76080a33c50e0d&amp;scene=21#wechat_redirect" textvalue="有root权限的共享服务器,报我名字立减200￥" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>有root权限的共享服务器,报我名字立减200￥</span></a></section><section><span>独享(省电省心)：</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247508226&amp;idx=1&amp;sn=69e0eea720ac6aecc0362bcb9ac339ba&amp;chksm=9b3cd852ac4b51445651a091be0fb6f638bd8cf5eb399af1c54804631fe3047706cf1d4044de&amp;scene=21#wechat_redirect" textvalue="生信分析不求人" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>生信分析不求人</span></a></section><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247508226&amp;idx=1&amp;sn=69e0eea720ac6aecc0362bcb9ac339ba&amp;chksm=9b3cd852ac4b51445651a091be0fb6f638bd8cf5eb399af1c54804631fe3047706cf1d4044de&amp;scene=21#wechat_redirect" textvalue="生信分析不求人" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"></a><span>实体(<span>稳定高效</span>)：</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506028&amp;idx=2&amp;sn=3b479a92f0c6119c4584efbc23b8c32a&amp;chksm=9b3ca13cac4b282a9ffe1fc4f4ab1a50b14688c6490f859ef714b84a755c286cb8a585054486&amp;scene=21#wechat_redirect" textvalue="为实验室准备一份生物信息学不动产" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>为实验室准备一份生物信息学不动产</span></a></p><p><span>访问链接：</span><span>https://biomamba.xiyoucloud.net/</span></p><p><span><span>更多内容可咨询客服微信[</span><strong><span>Biomamba_yunying</span></strong><span>]</span></span></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247503869&amp;idx=1&amp;sn=142f8c7ba8620815a8770773df077f12&amp;chksm=9b3cb6adac4b3fbb1acdf7593df06af5ac77d1fe9c0144c999de7109bd063b76080a33c50e0d&amp;scene=21#wechat_redirect" textvalue="有root权限的共享服务器,报我名字立减200￥" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span></span></a></p><p><span></span></p></section></section></section><section><p><br></p></section><section data-support="96编辑器" data-style-id="39922"><section><section><section><section><p><strong>顺序计算结果</strong></p></section></section></section></section></section><section data-support="96编辑器" data-style-id="40285"><section><section><img data-imgfileid="100040546" data-ratio="0.42857142857142855" data-src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="49" src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><p><br></p><p>Seurat的默认计算策略为"sequential"顺序计算，也就是说，任务会按顺序依次在当前的R会话中执行，而不会使用并行或分布式计算。说人话就是，顺序计算比并行计算策略慢，但是省内存，让我们看看以下几台机器的表现。时间信息由system.time()函数回收，返回结果解读可参考：</p><section><span>1、<strong>user time（用户时间）</strong>：</span></section><p><span>这是代码在 用户空间（即程序执行的实际代码中）消耗的时间。换句话说，这是 CPU 执行你代码中的指令所花费的时间。</span></p><p><span>单位是秒（s）。</span></p><p><span>例如，如果返回值是 user = 1.234，表示代码在用户空间执行时花费了 1.234 秒。</span></p><p><span><br></span></p><section><span>2、<strong>system time（系统时间）</strong>：</span></section><p><span>这是代码执行过程中，操作系统花费在 内核空间（操作系统管理和硬件交互的部分）上的时间。比如磁盘读写、内存分配等操作都会计入系统时间。</span></p><p><span>单位是秒（s）。</span></p><p><span>例如，如果返回值是 system = 0.567，表示操作系统为执行代码所花费的时间为 0.567 秒。</span></p><p><span><br></span></p><section><span>3、<strong>elapsed time（</strong>总耗时，也叫壁钟时间）：</span></section><p><span>这是从代码开始执行到执行完成的总时间，实际体验中的时间，即从开始到结束的时间，包括等待时间、I/O 等其他资源消耗。</span></p><p><span>单位是秒（s）。</span></p><p><span>例如，如果返回值是 elapsed = 1.801，表示从代码开始执行到结束的时间为 1.801 秒，其中可能包括了 CPU 之外的等待时间（如磁盘 I/O 或网络延迟）。</span></p><p><br></p><section><strong>独享</strong>：</section><section><img data-galleryid="" data-imgfileid="100040548" data-ratio="0.192" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpxqCKhXpSouxgGMwCbIrrxepXg05Rtp7zaeZXcEEZldI2VTPYT5dpCjr2ajiaGoibnN2sQYgDL3bQnA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="375" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpxqCKhXpSouxgGMwCbIrrxepXg05Rtp7zaeZXcEEZldI2VTPYT5dpCjr2ajiaGoibnN2sQYgDL3bQnA/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section><strong>本地工作站</strong>：<br></section><section><img data-galleryid="" data-imgfileid="100040549" data-ratio="0.1792452830188679" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNLbdamsqcrziaQSmibhI1LbJAiaeKZBW37nic3BezkcCRMCvcxWsJ0Ns0Og/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="318" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNLbdamsqcrziaQSmibhI1LbJAiaeKZBW37nic3BezkcCRMCvcxWsJ0Ns0Og/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section><strong>特惠版</strong>：</section><section><img data-galleryid="" data-imgfileid="100040550" data-ratio="0.12653061224489795" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNJyLcVNSFwR0OlrTx9DuFAk4bys4bRvY47tLDyAfVtaRXqliaiat1wHpQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="245" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNJyLcVNSFwR0OlrTx9DuFAk4bys4bRvY47tLDyAfVtaRXqliaiat1wHpQ/640?wx_fmt=png&amp;from=appmsg"></section><section><br></section><section><strong>专业版</strong>：<br></section><p><img data-galleryid="" data-imgfileid="100040547" data-ratio="0.13636363636363635" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNkmQbaWEOthFrEqvJq73Ts40jEicB7315JM34JzdhGeOaibuzKBBnBCmw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="330" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNkmQbaWEOthFrEqvJq73Ts40jEicB7315JM34JzdhGeOaibuzKBBnBCmw/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p></section></section></section><section><p><br></p><section data-support="96编辑器" data-style-id="39922"><section><section><section><section><p><strong>并行计算结果</strong></p></section></section></section></section></section><section data-support="96编辑器" data-style-id="40285"><section><section><img data-ratio="0.42857142857142855" data-w="49" data-src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040553" src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><p><br></p><p>plan("multisession", workers = workcore)是future包中的并行计算策略，用于在R中设置并行任务的执行方式。这意味着每个任务会在不同的进程中执行，而每个进程是独立的，不共享内存，这就会导致<span><strong>内存消耗更大</strong></span>。并行计算适用于适用于CPU密集型任务的加速运算。</p><p><strong>独享</strong>：</p><p><img data-galleryid="" data-imgfileid="100040554" data-ratio="0.142433234421365" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNKfTIvdRY7Jkaob2Yk8GbHeotqlDVYIFmvoribpy302ibaPicugaicSwewA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="337" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNKfTIvdRY7Jkaob2Yk8GbHeotqlDVYIFmvoribpy302ibaPicugaicSwewA/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong>本地工作站</strong>：</p><p>内存炸了，无法参与测试(这就是为什么我有工作站以后还要配备服务器。。。。。)<br></p><p><br></p><p><strong>特惠版</strong>：<br></p><p><img data-galleryid="" data-imgfileid="100040555" data-ratio="0.15" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNajicXGYCYW7Ljdaq3G9Wsbs0lYzpKQT2HwDgED5K04n4JexhmcCPiarQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="240" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNajicXGYCYW7Ljdaq3G9Wsbs0lYzpKQT2HwDgED5K04n4JexhmcCPiarQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p><strong>专业版</strong>：</p><p><img data-galleryid="" data-imgfileid="100040556" data-ratio="0.15172413793103448" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNDs5ia0Nu7pHiaEn69ImoTWCS1obVkLA9M3rcsSlX6jmFuZhcficwBEVXQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="290" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNDs5ia0Nu7pHiaEn69ImoTWCS1obVkLA9M3rcsSlX6jmFuZhcficwBEVXQ/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><p>需要注意，并行计算并不一定会带来计算时间的降低：</p><p><strong><span>数据复制开销</span></strong><span>：由于每个进程都是独立的，数据需要复制到每个进程中，可能会导致一定的性能开销。</span></p><p><br></p><p><strong><span>进程间通信开销</span></strong><span>：进程间通信相对较慢，如果任务之间需要频繁交换数据，性能可能受到影响。</span></p><p><br></p></section></section></section><p><br></p></section><section><section data-support="96编辑器" data-style-id="39922"><section><section><section><section><p><strong>汇总对比</strong></p></section></section></section></section></section><section data-support="96编辑器" data-style-id="40285"><section><section><img data-ratio="0.42857142857142855" data-w="49" data-src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040557" src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><section><img data-galleryid="" data-imgfileid="100040561" data-ratio="0.17314814814814813" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNgYaS8k4DIUpo99UI9rC6hZ0IliaVfM4o6YngvmLOImqpTNmMe8csHow/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwSzibb4ktHEok22O7ibyI0XNgYaS8k4DIUpo99UI9rC6hZ0IliaVfM4o6YngvmLOImqpTNmMe8csHow/640?wx_fmt=png&amp;from=appmsg"></section><section><span>注：特惠版与专业版服务器会受到到节点内其它用户计算任务的调度情况影响计算速度</span><br></section></section></section></section><p><br></p></section><section data-support="96编辑器" data-style-id="39922"><section><section><section><section><p><strong>测试代码与数据</strong></p></section></section></section></section></section><section data-support="96编辑器" data-style-id="40285"><section><section><img data-ratio="0.42857142857142855" data-w="49" data-src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-imgfileid="100040564" src="https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn5RYeZyo5amnOAgOiaRia5pTmJkLwBXH0J3icajPObPVuj8C5TeYLc8fI9KZickXDnsa1EvhSibltJv7VQ/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section><p><span></span></p><p>顺序计算<span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span><span># 测试代码</span></span></code><code><span><span>system</span>.time({</span></code><code><span>  <span>library</span>(Seurat)</span></code><code><span>  <span>iri</span> &lt;- readRDS('./iri.intergrate.rds')</span></code><code><span>  <span>iri</span>[[<span>"percent.mt"</span>]] &lt;- PercentageFeatureSet(iri, pattern = <span>"^MT-"</span>) #通过线粒体的序列数来对数据进行计算</span></code><code><span>  <span>head</span>(iri@meta.data, 5)  #QC的数据存在meta.data里，可以用这个来查看前5行</span></code><code><span>  <span>VlnPlot</span>(iri, features = c(<span>"nFeature_RNA"</span>, <span>"nCount_RNA"</span>, <span>"percent.mt"</span>), ncol = 3) </span></code><code><span>  <span>#用小提琴图来展示QC的结果，展示了每个barcode中基因的数目、UMI数目以及线粒体基因含量的分布情况</span></span></code><code><span>  <span>plot1</span> &lt;- FeatureScatter(iri, feature1 = <span>"nCount_RNA"</span>, feature2 = <span>"percent.mt"</span>)</span></code><code><span>  <span>plot2</span> &lt;- FeatureScatter(iri, feature1 = <span>"nCount_RNA"</span>, feature2 = <span>"nFeature_RNA"</span>)</span></code><code><span>  <span>CombinePlots</span>(plots = list(plot1, plot2)) #高变基因，判断趋势及占比</span></code><code><span>  <span>#质控，选子集，RNA数量在200与2500之间的，多的可能是低质量细胞或空drouplets，gene count多的可能是doublets or multiplets</span></span></code><code><span>  <span>iri</span> &lt;- NormalizeData(iri, normalization.method = <span>"LogNormalize"</span>, scale.factor = 10000)      </span></code><code><span>  <span>#用LogNormalize法对数据进行标准化（乘10000再取对数）数据存在iri[["RNA"]]@data.里</span></span></code><code><span>  <span>#默认的方法也完成了log1p的操作，得到的结果就类似于TPM的对数</span></span></code><code><span>  <span>iri</span> &lt;- FindVariableFeatures(iri, selection.method = <span>"vst"</span>, nfeatures = 2000)</span></code><code><span>  <span># 筛选高变基因（输出2000个），用于下游的PCA及分群</span></span></code><code><span>  <span>top10</span> &lt;- head(VariableFeatures(iri), 10) #输出差异最大的十个基因</span></code><code><span>  <span>plot1</span> &lt;- VariableFeaturePlot(iri)</span></code><code><span>  <span>plot2</span> &lt;- LabelPoints(plot = plot1, points = top10, repel = TRUE)</span></code><code><span>  <span>CombinePlots</span>(plots = list(plot1, plot2))  #输出差异基因散点图（有无标签）</span></code><code><span>  <span>iri</span> &lt;- ScaleData(iri, features =  rownames(iri)) #将数据进行标准化，为后续的PCA分析做准备，数据存在iri[[<span>"RNA"</span>]]@scale.data</span></code><code><span>  <span>##for PCA DoHeatmap </span></span></code><code><span>  <span>#iri &lt;- ScaleData(iri)#only4VariableFeatures</span></span></code><code><span>  <span>iri</span> &lt;- ScaleData(iri, vars.to.regress = <span>"percent.mt"</span>) #剔除不想要的变量（如线粒体的比例）</span></code><code><span>  <span>#iri[["RNA"]]@scale.data</span></span></code><code><span>  <span>iri</span> &lt;- RunPCA(iri, features = VariableFeatures(object = iri)) #PCA降维分析</span></code><code><span>  <span>print</span>(iri[[<span>"pca"</span>]], dims = 1:5, nfeatures = 5) #打印PCA部分结果</span></code><code><span>  <span>VizDimLoadings</span>(iri, dims = 1:2, reduction = <span>"pca"</span>) </span></code><code><span>  <span>DimHeatmap</span>(iri, dims = 1, cells = 500, balanced = TRUE) #三种PCA展示方式</span></code><code><span>  <span>DimHeatmap</span>(iri, dims = 1:15, cells = 500, balanced = TRUE) #展示15种PCA</span></code><code><span>  <span>#筛选合适的维度：</span></span></code><code><span>  <span>iri</span> &lt;- JackStraw(iri, num.replicate = 100) #重复计算次数</span></code><code><span>  <span>iri</span> &lt;- ScoreJackStraw(iri, dims = 1:20) #计算维度这一步花的时间比较久</span></code><code><span>  <span>JackStrawPlot</span>(iri, dims = 1:15) #画出1到15个维度</span></code><code><span>  <span>#JackStrawPlot相当于高级PCA，为挑选合适维度进行下游可视化提供依据</span></span></code><code><span>  <span>ElbowPlot</span>(iri) #利用ElbowPlot来评价PC，PCA切记为了结果好看而降低PC数</span></code><code><span>  <span>iri</span> &lt;- FindNeighbors(iri, dims = 1:10)</span></code><code><span>  <span>iri</span> &lt;- FindClusters(iri, resolution = 0.5) </span></code><code><span>  <span>#细胞分群，resolution分辨率在细胞数在3000附近时一般设为0.4-1.2，resolution越大得到的类群越多</span></span></code><code><span>  <span>head</span>(Idents(iri), 5) #看前五个分类群ID</span></code><code><span>  <span>#非线性降维方法：UMAP、tSNE</span></span></code><code><span>  <span>iri</span> &lt;- RunUMAP(iri, dims = 1:10) #运行UMAP算法</span></code><code><span>  <span>#sce.all &lt;- RunUMAP(sce.all, dims = 1:30, min.dist = 0.01, n.neighbors = 4L)</span></span></code><code><span>  <span>#可以调整亚群之间的距离</span></span></code><code><span>  <span>iri</span> &lt;- RunTSNE(iri, dims = 1:10) #运行TSNE算法，TSNE算法运行时间较UMAP更久</span></code><code><span>  <span>DimPlot</span>(iri, reduction = <span>"umap"</span>, label = TRUE)</span></code><code><span>  </span></code><code><span>  <span>iri</span>.markers &lt;- FindAllMarkers(iri, only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25) </span></code><code><span>  </span></code><code><span>})</span></code></pre></section><p><br></p><section><section><section><section><section data-support="96编辑器" data-style-id="36531"><section><section><br></section><section><span>设置并行计算在上面的实际计算代码前设置如下命令：</span></section></section><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span>makecore &lt;- <span><span>function</span><span>(workcore,memory)</span></span>{</span></code><code><span>  <span>if</span>(!<span>require</span>(Seurat))install.packages(<span>'Seurat'</span>)</span></code><code><span>  <span>if</span>(!<span>require</span>(future))install.packages(<span>'future'</span>)</span></code><code><span>  plan(<span>"multisession"</span>, workers = workcore)</span></code><code><span>  options(future.globals.maxSize= memory*<span>1024</span>*<span>1024</span>**<span>2</span>)</span></code><code><span>}</span></code><code><span>makecore(<span>4</span>,<span>10</span>)<span>#这里以四线程,10GB为例</span></span></code></pre></section></section></section></section></section></section><p>测试文件：</p><p>通过网盘分享的文件：</p><section>iri.intergrate.rds</section><p>链接: </p><section><span>https://pan.baidu.com/s/1rFCgY-N-dKIFEBmbdC7tKw?pwd=bav8</span> 提取码: bav8 </section><p><img data-galleryid="" data-imgfileid="100040656" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwX66NS5qOQWPsd55y5LbynD9FbeiarUJYaqZAA6dNe5ptulTudeGQ90gq785sOeNRcic1yPZ0ibE9Hg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="280" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpwX66NS5qOQWPsd55y5LbynD9FbeiarUJYaqZAA6dNe5ptulTudeGQ90gq785sOeNRcic1yPZ0ibE9Hg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p></section></section></section><section><section><section><section><section data-support="96编辑器" data-style-id="36531"><section data-align="title"><section><section><br></section><section><br></section><section><img data-imgfileid="100040540" data-ratio="0.5106382978723404" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWiaFyWDMZJ2713X3DwiaQicG5O8mjlC4kPOluxibs4oDot7AXe0RgoXgMeiaB3KYViadIQqXRoRicyian7KUg/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-w="47" data-width="100%" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWiaFyWDMZJ2713X3DwiaQicG5O8mjlC4kPOluxibs4oDot7AXe0RgoXgMeiaB3KYViadIQqXRoRicyian7KUg/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section><section><section data-lazy-bgimg="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWiaFyWDMZJ2713X3DwiaQicG5Ohviaxjsp3ZhRgjJ0mLNVEwpbT2fzdQMNt832icGGUt1ib9G2DMiazWDahA/640?wx_fmt=png" data-fail="0"><section><p><strong>如何联系我们</strong><br></p></section></section><section><img data-imgfileid="100040542" data-ratio="1.163265306122449" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWiaFyWDMZJ2713X3DwiaQicG5OSxqKNRib39TuLic5NT2iaJaI0mIicuvjMZlRPvlqPfgjzg001qlRJTBDRA/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-w="49" data-width="100%" src="https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWiaFyWDMZJ2713X3DwiaQicG5OSxqKNRib39TuLic5NT2iaJaI0mIicuvjMZlRPvlqPfgjzg001qlRJTBDRA/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section></section></section></section></section><section data-support="96编辑器" data-style-id="34624"><section><section><section><img data-imgfileid="100040543" data-ratio="0.2463768115942029" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaC0oer2QpXIolHVU3Xibtm9BNWiav660mHaB5qEd1dibMibUicNYmAzBBiadQP2s7HArdUxoWL5cDkTEbQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" data-w="138" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaC0oer2QpXIolHVU3Xibtm9BNWiav660mHaB5qEd1dibMibUicNYmAzBBiadQP2s7HArdUxoWL5cDkTEbQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp"></section><section><section>公众号后台消息回复不便，这里给大家留一下领取资料及免费服务器(<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247507693&amp;idx=1&amp;sn=d9517a0803ad75cb7be430806834e7b8&amp;chksm=9b3ca7bdac4b2eaba1ad01ed04ab1fbcbafcf4f6ddfe9e4f76ed9229707f545fe7d9c9ffd6ae&amp;scene=21#wechat_redirect" textvalue="足够支持你完成硕博生涯的生信环境" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>足够支持你完成硕博生涯的生信环境</span></a>)的<span><strong>微信号</strong></span>，方便各位随时交流、提建议（别问在么，添加时直接说来意）。此外呼声一直很高的<strong><span>交流群</span></strong>也建好了，欢迎大家入群讨论：</section><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247505868&amp;idx=2&amp;sn=20c81313eaef9a7031a84ef3a691d1b5&amp;chksm=9b3cae9cac4b278a42c8de97e864c7664a37e9a4adb5973625fe3f8dd1093e55aeda88d443aa&amp;scene=21#wechat_redirect" textvalue="永久免费的生信、科研交流群" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>永久免费的生信、科研交流群</span></a><br></p><section><span>大家可以阅读完这几篇之后添加</span></section><section><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247493329&amp;idx=1&amp;sn=597870b7f7ce10346da3561e7c281627&amp;chksm=9b3c9f81ac4b169794088ce9abbcacb5f18e9fd174fc0d7e28da62d78facadf3100ef38aaf22&amp;scene=21#wechat_redirect" textvalue="给生信入门初学者的小贴士" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">给生信入门初学者的小贴士</a><br></span></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAwMzIzOTk5OQ==&amp;mid=2247506266&amp;idx=2&amp;sn=22b1164bc9602c25620d058847785422&amp;chksm=9b3ca00aac4b291c16d738271746ffb90149282a728f484e8a1952463c46a8e7dc4f883ab928&amp;scene=21#wechat_redirect" textvalue="如何搜索公众号过往发布内容(内含集锦)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>如何搜索公众号过往发布内容</span></a><br></section><p><img data-imgfileid="100040541" data-ratio="0.46111111111111114" data-src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpyZBGOXDqRYHpgiczxr9PX8gliblp8giaPGsr7w6IeoU6lExTAeEjx48Ke4LEJQfbdiarzXwUGvoRFvyA/640?wx_fmt=other&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/ImlBFVOwwpyZBGOXDqRYHpgiczxr9PX8gliblp8giaPGsr7w6IeoU6lExTAeEjx48Ke4LEJQfbdiarzXwUGvoRFvyA/640?wx_fmt=other&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></p></section></section></section></section></section></section></section></section><section><section><section><img data-imgfileid="100040544" data-ratio="0.7619047619047619" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWhFTIP7DCMLPwWh8Yhjs079f1vMqlYdExqbWaZVJyiawKkr21EDSNW740b4yMzkeHxFJULTpZGzYwQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" data-w="84" data-width="80%" src="https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWhFTIP7DCMLPwWh8Yhjs079f1vMqlYdExqbWaZVJyiawKkr21EDSNW740b4yMzkeHxFJULTpZGzYwQ/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp"></section><section><span>您点的每个赞和在看，我都认真当成了喜欢</span></section></section></section><section><br></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/uOqNUpD5vK8josMZStwunA",target="_blank" rel="noopener noreferrer">原文链接</a>
