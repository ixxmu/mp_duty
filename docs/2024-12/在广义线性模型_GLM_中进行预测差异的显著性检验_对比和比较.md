---
title: "在广义线性模型（GLM）中进行预测差异的显著性检验：对比和比较"
date: 2024-12-07T00:36:31Z
draft: ["false"]
tags: [
  "fetched",
  "R 学习践行者"
]
categories: ["Acdemic"]
---
在广义线性模型（GLM）中进行预测差异的显著性检验：对比和比较 by R 学习践行者
------
<div><p>文章要点：</p><p>1）响应尺度上的预测：对于 GLM 和其他回归模型，predict_response() 通常返回响应尺度上的预测值，例如，逻辑回归的预测值表示为概率，泊松回归则返回事件的平均计数。</p><p>2）响应尺度上的对比与比较：默认情况下，test_predictions() 返回的是响应尺度上的对比和比较，便于理解；例如，对于逻辑回归模型，对比结果以概率差异（百分比点）表示。</p><p>3）支持其他尺度：如果需要，可以返回其他尺度上的对比结果，例如转化为对数优势比（odds ratios）；但在大多数情况下，响应尺度是更直观的选择。</p><p>    广义线性模型（GLM）适用于非高斯分布的因变量，并使用非线性链接函数。在此类模型中，predict_response() 函数通常返回的是响应尺度上的预测值。例如，对于逻辑回归模型，预测值以概率表示；对于泊松回归模型，返回的是事件的平均发生次数。</p><p>让我们看一个简单的例子：</p><pre><code><span># 数据准备</span><br>set.seed(<span>1234</span>)<br>dat &lt;- data.frame(<br>  outcome = rbinom(n = <span>100</span>, size = <span>1</span>, prob = <span>0.35</span>),<br>  x1 = as.factor(sample(<span>1</span>:<span>3</span>, size = <span>100</span>, <span>TRUE</span>, prob = c(<span>0.5</span>, <span>0.2</span>, <span>0.3</span>))),<br>  x2 = rnorm(n = <span>100</span>, mean = <span>10</span>, sd = <span>7</span>),<br>  x3 = as.factor(sample(<span>1</span>:<span>4</span>, size = <span>100</span>, <span>TRUE</span>, prob = c(<span>0.1</span>, <span>0.4</span>, <span>0.2</span>, <span>0.3</span>)))<br>)<br><br><span># 构建逻辑回归模型</span><br>m &lt;- glm(outcome ~ x1 + x2 + x3, data = dat, family = binomial())<br><br><span># 预测 x1 的响应尺度值</span><br><span>library</span>(ggeffects)<br>predict_response(m, <span>"x1"</span>)</code></pre><pre><code>  # Predicted probabilities of outcome<br>  <br>  x1 | Predicted |     95% CI<br>  ---------------------------<br>  1  |      0.15 | 0.03, 0.49<br>  2  |      0.09 | 0.02, 0.40<br>  3  |      0.22 | 0.05, 0.63<br>  <br>  Adjusted for:<br>  * x2 = 10.29<br>  * x3 =     1</code></pre><p>1.分类变量的对比与比较</p><p>    接下来，对 x1 的每个类别进行成对比较，分析预测概率的显著性差异。</p><pre><code>p &lt;- predict_response(m, <span>"x1"</span>)<br>test_predictions(p)</code></pre><pre><code>  # Pairwise comparisons<br>  <br>  x1  | Contrast |      95% CI |     p<br>  ------------------------------------<br>  1-2 |     0.05 | -0.09, 0.19 | 0.469<br>  1-3 |    -0.07 | -0.25, 0.10 | 0.414<br>  2-3 |    -0.13 | -0.35, 0.09 | 0.257</code></pre><p>    x1 = 1（14.6%）与 x1 = 2（9.3%）之间的概率差异为 5.3%，但不显著（p = 0.469）;其他比较的差异也不显著。</p><p>切换到其他尺度:</p><p>    test_predictions() 函数中的 scale 参数可以用于在不同的尺度上返回对比或比较结果。例如，若要将对比值转换为优势比（odds ratios），可以使用 scale = “exp”。</p><pre><code>test_predictions(p, scale = <span>"exp"</span>)<span>#优势比（odds ratios）</span></code></pre><pre><code>  # Pairwise comparisons<br>  <br>  x1  | Contrast |     95% CI |     p<br>  -----------------------------------<br>  1-2 |     1.05 | 0.91, 1.22 | 0.469<br>  1-3 |     0.93 | 0.78, 1.11 | 0.414<br>  2-3 |     0.88 | 0.71, 1.10 | 0.257</code></pre><p>    对比或比较结果也可以表示在链接尺度（link-scale）上，此时结果为对数优势比（log-odds）。为此，可以使用 scale = “link” 参数。</p><pre><code>test_predictions(p, scale = <span>"link"</span>)<span>#对数优势比，log-odds</span></code></pre><pre><code>  # Pairwise comparisons<br>  <br>  x1  | Contrast |      95% CI |     p<br>  ------------------------------------<br>  1-2 |     0.51 | -0.79, 1.80 | 0.443<br>  1-3 |    -0.50 | -1.55, 0.54 | 0.345<br>  2-3 |    -1.01 | -2.38, 0.36 | 0.147</code></pre><ol start="2"><li><p>数值变量的对比与斜率分析</p></li></ol><p>    对于数值变量（如斜率分析），scale = “link”可返回链接尺度上的未转换对比值;对于数值变量，转换尺度（如 scale = “exp”）目前不被支持。</p><pre><code>test_predictions(m, <span>"x2"</span>, scale = <span>"link"</span>)</code></pre><pre><code>  # (Average) Linear trend for x2<br>  <br>  Slope |      95% CI |     p<br>  ---------------------------<br>  -0.07 | -0.14, 0.00 | 0.065</code></pre><p>    斜率值（-0.07）表示 x2 与结果变量之间的平均线性趋势;在链接尺度上，斜率通常以 log-odds 表示。</p><p>    注意：不同的回退转换（back-transformation）可能影响 p 值;应根据具体需求选择适当的转换方式。</p><p>3.针对不同边际(margin)选项的对比和比较</p><p>    与 predict_response() 类似，test_predictions() 中的 margin 参数可用于定义如何对非核心预测变量（即未在 terms 中指定的变量）进行边际化。这对于某些回归模型而言至关重要，因为它会影响对比或比较的准确性，这些结果反映了预测值之间的差异。</p><p>    对于线性模型，预测值的差异通常在不同的边际选项下是一致的。然而，对于非高斯模型，预测值的差异可能会因边际选项的不同而有所变化。</p><pre><code><span>#使用非核心预测变量的均值/众数</span><br>p1 &lt;- predict_response(m, <span>"x1"</span>);p1</code></pre><pre><code>  # Predicted probabilities of outcome<br>  <br>  x1 | Predicted |     95% CI<br>  ---------------------------<br>  1  |      0.15 | 0.03, 0.49<br>  2  |      0.09 | 0.02, 0.40<br>  3  |      0.22 | 0.05, 0.63<br>  <br>  Adjusted for:<br>  * x2 = 10.29<br>  * x3 =     1</code></pre><pre><code><span>#对非核心预测变量取均值后边际化</span><br>p2 &lt;- predict_response(m, <span>"x1"</span>, margin = <span>"empirical"</span>);p2</code></pre><pre><code>  # Average predicted probabilities of outcome<br>  <br>  x1 | Predicted |     95% CI<br>  ---------------------------<br>  1  |      0.24 | 0.13, 0.38<br>  2  |      0.16 | 0.06, 0.36<br>  3  |      0.34 | 0.18, 0.53</code></pre><pre><code><span>#预测值之间的差异：</span><br>diff(p1$predicted)</code></pre><pre><code>  [1] -0.05258416  0.12700886</code></pre><pre><code>diff(p2$predicted)</code></pre><pre><code>  [1] -0.07906904  0.18124204</code></pre><p>    因此， test_predictions()要么需要在提供 model和terms参数时指定margin参数，要么需要由predict_response()返回的相关ggeffects对象。</p><pre><code><span>#test_predictions() 的应用基于均值/众数的对比</span><br>test_predictions(m, <span>"x1"</span>)</code></pre><pre><code>  # Pairwise comparisons<br>  <br>  x1  | Contrast |      95% CI |     p<br>  ------------------------------------<br>  1-2 |     0.05 | -0.09, 0.19 | 0.469<br>  1-3 |    -0.07 | -0.25, 0.10 | 0.414<br>  2-3 |    -0.13 | -0.35, 0.09 | 0.257</code></pre><pre><code><span>#基于取均值边际化的对比</span><br>test_predictions(m, <span>"x1"</span>, margin = <span>"empirical"</span>)</code></pre><pre><code>  # Pairwise comparisons<br>  <br>  x1  | Contrast |      95% CI |     p<br>  ------------------------------------<br>  1-2 |     0.08 | -0.11, 0.27 | 0.417<br>  1-3 |    -0.10 | -0.31, 0.11 | 0.353<br>  2-3 |    -0.18 | -0.41, 0.05 | 0.125</code></pre><p>    也可以直接对从 predict_response() 返回的对象进行测试：</p><pre><code>test_predictions(p2)</code></pre><pre><code>  # Pairwise comparisons<br>  <br>  x1  | Contrast |      95% CI |     p<br>  ------------------------------------<br>  1-2 |     0.08 | -0.11, 0.27 | 0.417<br>  1-3 |    -0.10 | -0.31, 0.11 | 0.353<br>  2-3 |    -0.18 | -0.41, 0.05 | 0.125</code></pre><p>对 GLM 的对比与比较总结</p><p>    响应尺度直观易懂：对于非高斯分布模型（如逻辑回归、泊松回归），预测和对比值默认在响应尺度上表示，便于理解。</p><p>    支持灵活转换：可以根据需求将结果切换到其他尺度（如对数优势比），增强分析的灵活性。</p><p>    适合复杂模型分析：test_predictions() 和 predict_response() 在 GLM 中提供了丰富的功能，可以轻松比较预测值差异并检验显著性。</p><p>参考资料：https://strengejacke.github.io/ggeffects/articles/introduction_comparisons_3.html</p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Pv5DTPhJ72B7DaLzS9TLlQ",target="_blank" rel="noopener noreferrer">原文链接</a>
