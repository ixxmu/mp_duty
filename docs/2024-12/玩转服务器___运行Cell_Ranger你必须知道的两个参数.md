---
title: "玩转服务器 — 运行Cell Ranger你必须知道的两个参数"
date: 2024-12-03T23:29:24Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
玩转服务器 — 运行Cell Ranger你必须知道的两个参数 by 生信菜鸟团
------
<div><section data-md5="d93a6" act="xmy"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><section data-md5="d93a6"><p data-md5="d93a6"><strong data-md5="d93a6">滴水穿石 非一日之功</strong></p></section></section></section></section></section></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>Cell Ranger</span><span></span></h2><p data-tool="mdnice编辑器">Cell Ranger 是由 10x Genomics 开发的一款高效数据分析软件，用于处理单细胞和空间转录组测序数据。它集成了从测序数据预处理、比对、基因表达定量到细胞聚类分析的一站式流程，能够生成基因表达矩阵、细胞聚类结果及可视化图表。Cell Ranger 支持单细胞转录组（scRNA-seq）和免疫组库（TCR/BCR）等多种分析，广泛应用于生命科学研究中，是单细胞测序数据分析的核心工具。</p><p data-tool="mdnice编辑器">关于cellranger的定量流程，前面已经多次分享了。参考：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247516508&amp;idx=8&amp;sn=19e51014d81d0119afec56c881e958a8&amp;scene=21#wechat_redirect" data-linktype="2">cellranger的定量流程合辑</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247529796&amp;idx=1&amp;sn=d7ec6101da42f3742a370b3ef12c2fa3&amp;scene=21#wechat_redirect" data-linktype="2">非模式生物构建10x单细胞转录组CellRanger参考文件</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247525047&amp;idx=1&amp;sn=bb85ac8c669cec1ed3db5e56b241b690&amp;chksm=fa45a78acd322e9cdd59be78084f016f7bc5e695dadf5917058e3e50eb2f4d27bf2c77d03588&amp;scene=21&amp;cur_album_id=3193938380984877061#wechat_redirect" data-linktype="2">CellRanger ARC—单细胞RNAseq和ATAC联合分析套件</a></section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span>在共享服务器运行会遇到的问题</span><span></span></h2><p data-tool="mdnice编辑器">由于我们之前都是在自己的服务器上运行，早期我们教程分享的代码是：</p><pre data-tool="mdnice编辑器"><span></span><code><span>$</span><span> cat run-cellranger.sh</span><br>bin=/home/data/bylin/cellranger-6.1.2/bin/cellranger<br>db=/home/data/bylin/refdata-gex-GRCh38-2020-A<br>ls $bin; ls $db<br><br>fq_dir=/home/x9/raw<br><span>$</span><span>bin count --id=<span>$1</span> \</span><br>--localcores=4 \<br>--transcriptome=$db \<br>--fastqs=$fq_dir \<br>--sample=$1   \<br>--expect-cells=5000<br><br></code></pre><p data-tool="mdnice编辑器">这个只设置了线程的调用，代码本身没有错，但是由于没有限制内存，往往会占用过多的内存。</p><p data-tool="mdnice编辑器">更有甚者，提交cellranger定量任务的时候，<strong>线程和内存均不做限制，任务一提交就会占满服务器线程</strong>。如果是在共享服务器使用【共享服务器日常使用限不超过48线程200G内存，资源查看】，很容易影响到别人的使用，从而被系统监控kill掉任务。</p><h2 data-tool="mdnice编辑器"><span></span><span>如何避免占用过多资源</span><span></span></h2><p data-tool="mdnice编辑器">要想避免cellranger占用过多公共资源，那么首先我们来要来看一下问题的原因：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100045926" data-ratio="0.25833333333333336" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los835K1uHj3hlCkZBqxJrnLtbM9rXwwzNucAC8WSY5KPr84Pibz7DbALdSaUGFGC6r3McxSShzzFaLQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los835K1uHj3hlCkZBqxJrnLtbM9rXwwzNucAC8WSY5KPr84Pibz7DbALdSaUGFGC6r3McxSShzzFaLQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>https://www.10xgenomics.com/support/software/cell-ranger/latest/analysis/running-pipelines/cr-gex-count</figcaption></figure><figure data-tool="mdnice编辑器"><img data-imgfileid="100045927" data-ratio="0.2740740740740741" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los835K1uHj3hlCkZBqxJrnLtbdv0fSotCYaZOSXXUpoRIZSXq3OEhwNIDKAt0dFRgzEIfzuXFCNGpg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los835K1uHj3hlCkZBqxJrnLtbdv0fSotCYaZOSXXUpoRIZSXq3OEhwNIDKAt0dFRgzEIfzuXFCNGpg/640?wx_fmt=png&amp;from=appmsg"><figcaption>https://www.10xgenomics.com/support/software/cell-ranger/latest/getting-started/cr-choosing-how-to-run</figcaption></figure><p data-tool="mdnice编辑器">从官方文档，我们可以看到，<strong>默认情况下，Cell Ranger 会使用所有可用的系统核心和系统90%的内存</strong>。这意味着如果不进行特定设置，即便仅提交了一个样本的运行任务，Cell Ranger 也会自动占用服务器中大部分资源，导致资源浪费。所以，如果在共享服务器中运行，必须要设置线程和内存这两个参数：</p><pre data-tool="mdnice编辑器"><span></span><code>--localcores &lt;NUM&gt;    <span>#设置管道一次可以调用的最大核心数。</span><br>--localmem &lt;NUM&gt;  <span>#设置管道一次可以调用的最大内存                         </span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>建议的代码：</span><span></span></h3><p data-tool="mdnice编辑器">明白了原因，通常我们建议一个样本仅需<strong>设置4个线程，内存50G</strong>，即可满足绝大部分样本的定量需求。</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span>! /bin/bash -xe</span><br><span>#</span><br>bin=/home/data/username/biosoft/cellranger-8.0.0/bin/cellranger<br>db=/home/data/username/ref/homo/refdata-gex-GRCh38-2020-A<br>ls $bin; ls $db<br><br>fq_dir=${2}<br>/usr/bin/time -v $bin count --id=$1 \<br>--localcores=4 \<br>--localmem=50 \<br>--transcriptome=$db \<br>--fastqs=$fq_dir \<br>--sample=$1   \<br>--create-bam=false \<br>--expect-cells=5000<br></code></pre><hr data-tool="mdnice编辑器"><blockquote data-tool="mdnice编辑器"><span></span><p>如果你也需要共享服务器，详见：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247520503&amp;idx=2&amp;sn=375db3093ce4345b66739a37993458ff&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a> 福利抢购方式：</p><figure><img data-imgfileid="100045928" data-ratio="1.7777777777777777" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los835K1uHj3hlCkZBqxJrnLtVgqhadTetLSTTH4SSbC1kGcpTcPEiauUJTiafJRY5z7hCvKyPok9EKDQ/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2Los835K1uHj3hlCkZBqxJrnLtVgqhadTetLSTTH4SSbC1kGcpTcPEiauUJTiafJRY5z7hCvKyPok9EKDQ/640?wx_fmt=jpeg&amp;from=appmsg"><figcaption>还等什么呢，赶快扫描下面二维码添加微信抢购吧！</figcaption></figure></blockquote></section><p><br></p><section><section act="xmy"><section data-id="123409" data-type="lspecial02,lspecial04" powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section><section powered-by="xmyeditor.com" data-md5="8b46d"><img data-imgfileid="100045910" data-ratio="0.6940298507462687" data-type="gif" data-w="134" data-src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" src="https://mmbiz.qpic.cn/mmbiz_gif/iaRJcrq2LosibrvQnXTV3PMktpwwmDsjia2JG4e3ibpLQ1G6M4nktW4PiaiaKfnpiaRmNbTT6St7QLfzAMAomKgWxQ4kA/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp"></section><section powered-by="xmyeditor.com" data-md5="8b46d"><br></section></section></section></section></section></section><p><span></span><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247518292&amp;idx=2&amp;sn=d0eff4f2b425b3623e0cd88007072225&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课12月班" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2"><strong>生信入门&amp;数据挖掘线上直播课12月班</strong></a><strong>，你的生物信息学入门课</strong></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><strong>时隔5年，我们的生信技能树VIP学徒继续招生啦</strong></a><br></section></li><li><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;chksm=9b4b2f10ac3ca606c1c4bac8cf112bb9b0f18e3c4262f5f2b8c0dba3bfedf2ba201507247005&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><strong>2024的共享服务器交个朋友福利价仍然是800</strong></a></section></li><li><p><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247535452&amp;idx=1&amp;sn=2da733a67e6511e9210753c65e8a73b1&amp;scene=21#wechat_redirect" textvalue="掌握Python，解锁单细胞数据的无限可能" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>掌握Python，解锁单细胞数据的无限可能</strong></a></p></li></ul></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zf0MrWp5R6TPoHd72fZMzg",target="_blank" rel="noopener noreferrer">原文链接</a>
