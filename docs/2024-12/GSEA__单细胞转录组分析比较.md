---
title: "GSEA--单细胞转录组分析比较"
date: 2024-12-06T16:08:38Z
draft: ["false"]
tags: [
  "fetched",
  "东林的扯淡小屋"
]
categories: ["Acdemic"]
---
GSEA--单细胞转录组分析比较 by 东林的扯淡小屋
------
<div><section><section><ul><li><li><li><li><li></ul><pre data-lang="sql"><code><span>Sys.setenv(LANGUAGE = "en") <span>#显示英文报错信息</span></span></code><code><span>gc()</span></code><code><span>memory.limit(9999999999)</span></code><code><span>set.seed(<span>123</span>)</span></code><code><span>rm(<span>list</span> = ls())  </span></code><code><span>options(stringsAsFactors = F)</span></code><code><span><span>library</span>(Seurat)</span></code><code><span><span>library</span>(tidyverse)</span></code><code><span><span>library</span>(patchwork)</span></code><code><span><span>library</span>(SCENIC)</span></code><code><span><span>library</span>(plyr)</span></code><code><span><span>library</span>(permute)</span></code><code><span><span>library</span>(data.table)</span></code><code><span><span>library</span>(SCopeLoomR)</span></code><code><span>setwd(<span>"/data/yudonglin/singlecell_terminalE/shiny/"</span>)</span></code><code><span>YDL&lt;-readRDS(<span>"terminalE.rds"</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>##R语言准备gsea输入文件</span></span></code><code><span><span>library</span>(Seurat)</span></code><code><span><span>library</span>(tidyverse)</span></code><code><span>dir.create(<span>"GSEA"</span>)   </span></code><code><span>dir.create(<span>"GSEA/input"</span>)</span></code><code><span>dir.create(<span>"GSEA/output"</span>)</span></code><code><span>scRNA &lt;- YDL</span></code><code><span><span>#提取细胞做富集分析</span></span></code><code><span>tmp &lt;- scRNA@meta.data</span></code><code><span>tmp &lt;- subset(tmp, subset = (tmp$celltype==<span>'PRO'</span>|tmp$celltype==<span>'RETI'</span>))</span></code><code><span>sub.cells &lt;- rownames(tmp)</span></code><code><span>scRNAsub &lt;-subset(YDL,idents = c(<span>'PRO'</span>,<span>'RETI'</span>))</span></code><code><span>scRNAsub$celltype&lt;-Idents(YDL)</span></code><code><span>expr &lt;- GetAssayData(scRNAsub, slot = <span>'data'</span>)</span></code><code><span><span>library</span>(Hmisc)</span></code><code><span>expr &lt;- data.frame(<span>NAME</span>=toupper(rownames(expr)), Description=rep(<span>'na'</span>, nrow(expr)), expr, stringsAsFactors=F)</span></code><code><span>write(<span>'#1.2'</span>, <span>"GSEA/input/expr.gct"</span>, ncolumns=<span>1</span>)</span></code><code><span>write(c(nrow(expr),(ncol(expr)<span>-2</span>)), <span>"GSEA/input/expr.gct"</span>, ncolumns=<span>2</span>, append=T, sep=<span>'\t'</span>)</span></code><code><span>write.table(expr, <span>"GSEA/input/expr.gct"</span>, row.names=F, sep=<span>'\t'</span>, append=T, quote=F)</span></code><code><span>line<span>.1</span> &lt;- c((ncol(expr)<span>-2</span>), <span>2</span>, <span>1</span>)</span></code><code><span>tmp &lt;- <span>table</span>(as.character(scRNAsub@meta.data$celltype))</span></code><code><span>line<span>.2</span> &lt;- c(<span>"#"</span>, <span>names</span>(tmp))</span></code><code><span>line<span>.3</span> &lt;- c(rep(<span>names</span>(tmp)[<span>1</span>],tmp[<span>1</span>]), rep(<span>names</span>(tmp)[<span>2</span>],tmp[<span>2</span>]))</span></code><code><span>write(line<span>.1</span>, <span>'GSEA/input/group.cls'</span>, ncolumns=<span>length</span>(line<span>.1</span>), append=T, sep=<span>'\t'</span>)</span></code><code><span>write(line<span>.2</span>, <span>'GSEA/input/group.cls'</span>, ncolumns=<span>length</span>(line<span>.2</span>), append=T, sep=<span>'\t'</span>)</span></code><code><span>write(line<span>.3</span>, <span>'GSEA/input/group.cls'</span>, ncolumns=<span>length</span>(line<span>.3</span>), append=T, sep=<span>'\t'</span>)</span></code><code><span><br></span></code><code><span><br></span></code><code><span><span>##安装官方R包GSEA</span></span></code><code><span><span>library</span>(devtools)</span></code><code><span>install_github(<span>"GSEA-MSigDB/GSEA_R"</span>)</span></code><code><span><span>library</span>(GSEA)</span></code><code><span><span>#gs.db参数对应的是基因集数据文件，这里只对kegg收录的基因集做了分析</span></span></code><code><span>GSEA::GSEA(<span>"GSEA/input/expr.gct"</span>, <span>"GSEA/input/group.cls"</span>, </span></code><code><span>           gs.db=<span>"~/database/GSEA/c2.cp.kegg.v7.1.symbols.gmt"</span>, output.directory=<span>"GSEA/output/"</span>)</span></code><code><span><br></span></code><code><span><br></span></code></pre></section></section><p><img data-galleryid="" data-ratio="0.7583333333333333" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVPib3BZtsrCB2USHHrX6BCHibOlkPoXaJHgciauvxYk8QNLMQKZHwXEfTA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVPib3BZtsrCB2USHHrX6BCHibOlkPoXaJHgciauvxYk8QNLMQKZHwXEfTA/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.5898148148148148" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVBEXfXnJgZ6bhzpGnUDICUEq3H1UVwThHfXaf2rs98C1raaeMHGIPMw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVBEXfXnJgZ6bhzpGnUDICUEq3H1UVwThHfXaf2rs98C1raaeMHGIPMw/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="1" data-s="300,640" data-type="png" data-w="500" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVkgwgzIZ1MEibaS82HiaAIhcPhb3ooThGiaqI9AglYX5fGjLkDxeYenPOg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVkgwgzIZ1MEibaS82HiaAIhcPhb3ooThGiaqI9AglYX5fGjLkDxeYenPOg/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.7564814814814815" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVGD6U32GUV3ABMcTHjmfhFy8euCUUY2hs83n7aibQB0eyQlleKQqUmbw/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVGD6U32GUV3ABMcTHjmfhFy8euCUUY2hs83n7aibQB0eyQlleKQqUmbw/640?wx_fmt=png"></p><p><img data-galleryid="" data-ratio="0.7657407407407407" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVpwTW8CBV8TFhSZHlRMknA0gtqA9Q0D7Jlqhjjx3S08lC1CeZSMyEVA/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/kZ1wdgAscBpjGfAqSIarz6d7s4fz86OVpwTW8CBV8TFhSZHlRMknA0gtqA9Q0D7Jlqhjjx3S08lC1CeZSMyEVA/640?wx_fmt=png"></p><p>参考资料：<br></p><p>https://mp.weixin.qq.com/s/5ARLJqhCDxLpPMJ2LFcyZA</p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/c_IieE-pvQtPMY4ykkZ-Wg",target="_blank" rel="noopener noreferrer">原文链接</a>
