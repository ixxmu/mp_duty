---
title: "这个预印本终于发表在Nat Genetics了，首篇Visium HD空间组学数据结果，这个技术还很具有发文优势，晚了又被卷没了"
date: 2025-06-05T16:14:42Z
draft: ["false"]
tags: [
  "fetched",
  "生信钱同学"
]
categories: ["Acdemic"]
---
这个预印本终于发表在Nat Genetics了，首篇Visium HD空间组学数据结果，这个技术还很具有发文优势，晚了又被卷没了 by 生信钱同学
------
<div><p data-pm-slice="0 0 []"><span leaf=""><span textstyle="">这个文章就是</span></span><span data-token-index="1"><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"p","attributes":{"style":"margin-bottom: 0px;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"node",{"tagName":"span","attributes":{"data-token-index":"1","class":"notion-enable-hover","style":"outline: 0px; box-sizing: border-box; isolation: auto; font-weight: 600; background: rgb(253, 235, 236);"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'><span textstyle="">10x G</span></span></span><span data-token-index="1"><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"p","attributes":{"style":"margin-bottom: 0px;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"node",{"tagName":"span","attributes":{"data-token-index":"1","class":"notion-enable-hover","style":"outline: 0px; box-sizing: border-box; isolation: auto; font-weight: 600; background: rgb(253, 235, 236);"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'><span textstyle="">enomics 出的亚细胞分辨率的空间转录组技术，想必各个公司的销售也都找过大家推销过<img data-ratio="1" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/assets/newemoji/Yellowdog.png" data-w="20" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/assets/newemoji/Yellowdog.png">，啥都好，就是贵，不过听说，现在好像降下来了。数据分析有一定难度，大家处理空间组学数据，学习下他们的代码，还是很有必要的。</span></span></span></p><section nodeleaf=""><img data-imgfileid="100010115" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7PPaaEYXJUY2K9Y7tG8JRk8wia8nzjibQ8vCPLCmTia1nl2YiavRbliaicXKA/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7PPaaEYXJUY2K9Y7tG8JRk8wia8nzjibQ8vCPLCmTia1nl2YiavRbliaicXKA/640?wx_fmt=jpeg&amp;from=appmsg"></section><p data-pm-slice="0 0 []"><span data-token-index="0"><span leaf=""><span textstyle="">不知道为啥，代码挺大的，下了好久，需要的话后台回复即可：25</span><span textstyle="">0606</span></span></span></p><p data-pm-slice="0 0 []"><span data-token-index="0"><span leaf=""><span textstyle="">高分辨率空间转录组技术揭示结直肠癌免疫细胞互作新机制</span></span></span></p><p><span leaf=""><span textstyle="">2025 年 4 月 15 日，《自然 - 遗传学》杂志发表了一项由 </span></span><span data-token-index="1"><span leaf=""><span textstyle="">10x Genomics 科研团队主导的重要研究。该研究首次运用高分辨率 Visium HD 空间转录组技术</span></span></span><span leaf=""><span textstyle="">，对结直肠癌（CRC）肿瘤微环境（TME）中的免疫细胞群体进行了全景式分析，在单细胞尺度上揭示了肿瘤免疫细胞的空间分布规律及功能异质性。</span></span></p><section nodeleaf=""><img data-imgfileid="100010104" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7MMBecdgZN8JvVUiaViaKh0W7TxPEshib4iaRMO1U8OS3cGDapRqChYBOBQ/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7MMBecdgZN8JvVUiaViaKh0W7TxPEshib4iaRMO1U8OS3cGDapRqChYBOBQ/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span data-token-index="0"><span leaf=""><span textstyle="">技术突破：高分辨率解析肿瘤微环境</span></span></span></p><p><span leaf=""><span textstyle="">结直肠癌是全球发病率和死亡率均位居前列的恶性肿瘤。2020 年，全球约有 90 万人死于结直肠癌，占癌症相关死亡的 9.4%，且预计到 2035 年其发病率将翻倍。传统的组织病理学和基因突变分析方法难以全面刻画肿瘤微环境的复杂异质性，而单细胞转录组技术虽能解析细胞类型，却缺乏空间位置信息。</span></span></p><p><span data-token-index="0"><span leaf=""><span textstyle="">Visium HD 技术在 6.5×6.5 毫米的捕获区域内集成了约 1100 万个 2 微米的连续条形码特征，相比传统 Visium v2 技术 55 微米的捕获点，分辨率提升了 27 倍。</span></span></span><span data-token-index="1"><span leaf=""><span textstyle="">研究人员对 5 例结直肠癌患者的福尔马林固定石蜡包埋（FFPE）样本进行分析，发现 Visium HD 不仅保持了与 Visium v2 相当的检测灵敏度（基因表达相关性 R²=0.82），还将非特异性结合率从 4.13% 降至 0.70%，实现了 mRNA 分子 98.3%-99% 的精准定位。</span></span></span></p><section nodeleaf=""><img data-imgfileid="100010106" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7FOxkRKF0nlDPTqBzLqB1wQFbTj161cIpAndkl5icIibPhzbibHeRGiaUGg/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7FOxkRKF0nlDPTqBzLqB1wQFbTj161cIpAndkl5icIibPhzbibHeRGiaUGg/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span data-token-index="0"><span leaf=""><span textstyle="">关键发现：巨噬细胞亚群的双重角色</span></span></span></p><p><span leaf=""><span textstyle="">通过对肿瘤边界 50 微米范围内的细胞进行深度分析，研究团队发现巨噬细胞是肿瘤周边最丰富的免疫细胞类型。进一步研究揭示，这些巨噬细胞可分为两种具有独特转录组特征的亚群：</span></span><span data-token-index="1"><span leaf=""><span textstyle="">SELENOP + 巨噬细胞和 SPP1 + 巨噬细胞，它们在肿瘤微环境中占据不同的空间生态位。</span></span></span></p><section nodeleaf=""><img data-imgfileid="100010107" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7jcm5aiaiajCIicOxs2lZpo2WsKCSGseHusTwUvBwoot5QtKwZnbW7Uqgw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7jcm5aiaiajCIicOxs2lZpo2WsKCSGseHusTwUvBwoot5QtKwZnbW7Uqgw/640?wx_fmt=jpeg&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100010100" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU76wqjVQjSmRbV2snRwHJbiaqBg8YRBWl81rbUkk8s0qkch5HMZgeswNw/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU76wqjVQjSmRbV2snRwHJbiaqBg8YRBWl81rbUkk8s0qkch5HMZgeswNw/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100010108" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7m9icad9uL25uTN09iaYY2iaB5CXdnzJBBlP2QtOMFgzeicFxW1A2jmJOQQ/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7m9icad9uL25uTN09iaYY2iaB5CXdnzJBBlP2QtOMFgzeicFxW1A2jmJOQQ/640?wx_fmt=jpeg&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100010101" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7mUzNzXF2gk5F89oojh5HRLNLMHrWjbHfo7ibzFrcyuKL5xKN4TBcQog/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7mUzNzXF2gk5F89oojh5HRLNLMHrWjbHfo7ibzFrcyuKL5xKN4TBcQog/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100010109" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7mbw6bg99G15sUHoFKvytZXxAia8swbuh2Y0U7EIme52lYhaCuic41GzQ/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7mbw6bg99G15sUHoFKvytZXxAia8swbuh2Y0U7EIme52lYhaCuic41GzQ/640?wx_fmt=jpeg&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100010102" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7UNibmUhw41YGTEsmOUZRZCrsXALjWJOjYwd5ZcL8mq2aVqB0w0RFl2w/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7UNibmUhw41YGTEsmOUZRZCrsXALjWJOjYwd5ZcL8mq2aVqB0w0RFl2w/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100010110" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7ErGAyls4STBoys2eDOxNibvjo5Pe3Iw55xWVXl7cXDFhCkqQI7k1Pyw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7ErGAyls4STBoys2eDOxNibvjo5Pe3Iw55xWVXl7cXDFhCkqQI7k1Pyw/640?wx_fmt=jpeg&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100010103" data-ratio="0.3232662192393736" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7Ln74v5DL5Mn510EgNmQiaoZHZoSaZs5hrKYk3ScUHrXOlzxiaIyibIROQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1788" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7Ln74v5DL5Mn510EgNmQiaoZHZoSaZs5hrKYk3ScUHrXOlzxiaIyibIROQ/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100010112" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7mmsjfKAhtVUPr4z2p5ZfLJgpqPEx7sUj4E9sbojPWytY9QLVm7stcw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7mmsjfKAhtVUPr4z2p5ZfLJgpqPEx7sUj4E9sbojPWytY9QLVm7stcw/640?wx_fmt=jpeg&amp;from=appmsg"></section><section data-pm-slice="0 0 []"><span leaf=""><span textstyle="">如下图片均由我们800/年的独享生信云服务器画出，带有root权限（预装2万个包+SCP单细胞生信环境，后续有啥好用的环境，我们会继续装），需要画图试试的可以免</span></span><span data-pm-slice="0 0 []"><span leaf=""><span textstyle="">💰领测试号：</span></span></span></section><section><span data-pm-slice="0 0 []"><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247493682&amp;idx=1&amp;sn=b3a6a9bc2bc6dd8a028c81a0fb593852&amp;scene=21#wechat_redirect" textvalue="当前服务器不好用，咱就自己造，我们一定要让大家生信学习的门槛降到最低" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">当前服务器不好用，咱就自己造，我们一定要让大家生信学习的门槛降到最低</span></a></span></span></section><section><a href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247493704&amp;idx=1&amp;sn=2a5dd7a5135e43618590bf1343f58915&amp;scene=21#wechat_redirect" imgurl="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFuMytQquQl3vTaLfchic6cQibTqGymQSuDCTIxcibMLRZFYA94CYV0p4oyVIgJQx5YZIfkEjVY8RzibJw/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" linktype="image" tab="innerlink" data-itemshowtype="0" target="_blank" data-linktype="1"><span><img alt="图片" data-imgfileid="100010053" data-ratio="0.39351851851851855" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFuMytQquQl3vTaLfchic6cQibTqGymQSuDCTIxcibMLRZFYA94CYV0p4oyVIgJQx5YZIfkEjVY8RzibJw/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFuMytQquQl3vTaLfchic6cQibTqGymQSuDCTIxcibMLRZFYA94CYV0p4oyVIgJQx5YZIfkEjVY8RzibJw/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp"></span></a></section><section><span leaf=""><span textstyle="">对服务器或生信交流群感兴趣的可以联系小助手:</span><span textstyle="">sx_qtx01</span></span></section><section nodeleaf=""><img data-imgfileid="100010116" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7ibicyiaMTRh6paPcRibIM3Z8TZRt3qicdfobrnBJMicSF6YJCCdF5UQlma4g/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvZPDJHQBTdUk9gcJ9bwKU7ibicyiaMTRh6paPcRibIM3Z8TZRt3qicdfobrnBJMicSF6YJCCdF5UQlma4g/640?wx_fmt=jpeg&amp;from=appmsg"></section><section data-pm-slice="0 0 []"><span leaf=""><span textstyle="">我们上游数据分析交付的结果还有一个长的细化的结果文件结构目录解读(太长了，这里就不展示了)，想了解的可以联系小助手vx，发给大家，有分析需求的可以了解下方分析内容</span></span></section><section data-pm-slice="0 0 []"><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzk0MjcyMDk3Mg==&amp;mid=2247484782&amp;idx=1&amp;sn=52ea346598a0021cf991e2ad95e8c8f9&amp;scene=21#wechat_redirect" textvalue="没有服务器，单细胞数据搞不定？看看我们做出来的结果包含啥？我们目前做好了这些pipeline，可以帮你做" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">没有服务器，单细胞数据搞不定？看看我们做出来的结果包含啥？我们目前做好了这些pipeline，可以帮你做</span></a></span></section><section nodeleaf=""><img alt="图片" data-imgfileid="100009996" data-ratio="1.1962962962962962" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFu8pxJcmw3iaXQXEC4KDC3EoYtPLHicI4rcMuiaDpTqVsbuJtft0wMYbwnud5ZLwOCbicJkW2fkLg19Zw/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFu8pxJcmw3iaXQXEC4KDC3EoYtPLHicI4rcMuiaDpTqVsbuJtft0wMYbwnud5ZLwOCbicJkW2fkLg19Zw/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp"></section><section nodeleaf=""><img alt="图片" data-imgfileid="100009997" data-ratio="0.40370370370370373" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFu8pxJcmw3iaXQXEC4KDC3EoDz2HB75iab1mygibwWUgonqMicIdg7qvlwu8YmL9JTdJbTxEQmicGRO73A/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFu8pxJcmw3iaXQXEC4KDC3EoDz2HB75iab1mygibwWUgonqMicIdg7qvlwu8YmL9JTdJbTxEQmicGRO73A/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=webp"></section><section nodeleaf=""><img alt="图片" data-imgfileid="100001128" data-ratio="0.5824074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZfw9RDKh2ZJoDhQur5WHY3CdSxovEs3Yvnhvjr4N82KksAqM2DPjZdv8nKqxhmvzsg6ibGrAICRaIA/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;watermark=1&amp;tp=webp" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZfw9RDKh2ZJoDhQur5WHY3CdSxovEs3Yvnhvjr4N82KksAqM2DPjZdv8nKqxhmvzsg6ibGrAICRaIA/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;watermark=1&amp;tp=webp"></section><section data-role="outer" label="Powered by 135editor.com onekey" data-pm-slice="0 0 []"><section><section data-bdopacity="20%"><section data-bdopacity="40%"><section data-bdopacity="60%"><section data-bdopacity="80%"><section data-bgopacity="90%"><p data-brushtype="text"><strong><strong><span data-pm-slice="0 0 []"><span leaf=""><span textstyle="">Oliveira, M.F.d., Romero, J.P., Chung, M. et al. High-definition spatial transcriptomic profiling of immune cell populations in colorectal cancer. Nat Genet (2025).</span></span></span></strong></strong></p><p data-brushtype="text" data-pm-slice="0 0 []"><strong><strong><strong><span leaf="">后苔↩️之前贴子的岸号即可霍得之前的</span></strong></strong></strong></p><p data-brushtype="text"><strong><strong><strong><strong data-pm-slice="0 0 []"><span leaf="">代码，今日关键词：250606</span></strong></strong></strong></strong></p></section></section></section></section></section></section></section><section data-pm-slice="0 0 []"><section><strong><strong><strong><span leaf=""><span textstyle="">基础、单细胞、空间各专题班，想系统性学习可以看下这个👇</span></span></strong></strong></strong><span><span leaf=""><br></span></span></section><section><span leaf=""><br></span></section><section><span><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzk0MjcyMDk3Mg==&amp;mid=2247484123&amp;idx=1&amp;sn=a6cce80b4de771525c511d4bbceb0952&amp;scene=21#wechat_redirect" textvalue="不吹不黑，你想知道生信需要掌握哪些，光看这个大纲就会有不少收获" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">不吹不黑，你想知道生信需要掌握哪些，光看这个大纲就会有不少收获</span></a></span><strong><span><span leaf=""><br></span><a href="https://mp.weixin.qq.com/s?__biz=Mzk0MjcyMDk3Mg==&amp;mid=2247484123&amp;idx=1&amp;sn=a6cce80b4de771525c511d4bbceb0952&amp;scene=21#wechat_redirect" imgurl="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2bvYMoCQeZd3cBr0oJmbLRP3hro4cE7hU3SBHytR7jQJz1YsVTvUPLgr6Tlot0ZfRePIBTZcvv86JzYO2tNSTg/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" linktype="image" tab="innerlink" data-itemshowtype="0" target="_blank" data-linktype="1"><span><img alt="图片" data-ratio="0.5990740740740741" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2bvYMoCQeZd3cBr0oJmbLRP3hro4cE7hU3SBHytR7jQJz1YsVTvUPLgr6Tlot0ZfRePIBTZcvv86JzYO2tNSTg/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2bvYMoCQeZd3cBr0oJmbLRP3hro4cE7hU3SBHytR7jQJz1YsVTvUPLgr6Tlot0ZfRePIBTZcvv86JzYO2tNSTg/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></span></a></span></strong></span></section></section><p><span><strong><span><span leaf=""><span textstyle="">有单细胞数据分析需求的可以看</span></span><strong><strong><span leaf=""><span textstyle="">👇这个文章</span></span></strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><strong><span><strong><strong></strong></strong></span></strong><strong><strong><strong><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247490275&amp;idx=1&amp;sn=200ccc0a415860f9d73b9068657096ff&amp;scene=21#wechat_redirect" textvalue="没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做</span></a><span textstyle="">（近期又添加了21 年发表在了 Cell上面的单细胞转录组分析代谢的分析——compass）</span></span></strong></strong></strong></strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><strong><span leaf=""><br></span></strong></strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><strong><span leaf=""><span textstyle="">我们目前主要的分析内容看👇（这次的是对上次内容的补充 scBCR和 sc-TCR了）</span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247492253&amp;idx=1&amp;sn=da8477aa80c485e7cfd12862047cd30b&amp;scene=21#wechat_redirect" textvalue="顶刊用啥分析，咱们就用啥，完全按照他们的做" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">顶刊用啥分析，咱们就用啥，完全按照他们的做</span></a></span></strong></strong></strong></span></strong></span></p><section><span leaf=""><span textstyle="">Figure3代码</span></span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span># -----------------------------------------------------------------------------</span></span></code><code><span leaf=""><span># Visium HD 空间转录组数据分析与Figure 3可视化</span></span></code><code><span leaf=""><span># 功能：整合多样本Visium HD数据，进行细胞类型注释与空间可视化</span></span></code><code><span leaf=""><span># -----------------------------------------------------------------------------</span></span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 1. 环境准备与数据加载</span></span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span>library</span>(Seurat)             <span># 单细胞数据分析核心包，用于创建和分析Seurat对象</span></span></code><code><span leaf=""><span>library</span>(scattermore)        <span># 高效绘制大规模散点图，优化可视化性能</span></span></code><code><span leaf=""><span>library</span>(tidyverse)          <span># 包含dplyr、ggplot2等工具，用于数据处理和绘图</span></span></code><code><span leaf=""><span>library</span>(data.table)         <span># 高效处理大数据集，支持快速数据操作</span></span></code><code><span leaf=""><span>library</span>(wesanderson)        <span># 提供电影主题配色方案，用于美观的可视化</span></span></code><code><span leaf=""><span>library</span>(patchwork)          <span># 拼接多个ggplot图形，生成复合图表</span></span></code><code><span leaf=""><span>library</span>(RColorBrewer)       <span># 提供丰富的颜色方案，支持自定义配色</span></span></code><code><span leaf=""><span>library</span>(furrr)              <span># 实现并行计算，加速循环操作</span></span></code><code><span leaf=""><span>library</span>(paletteer)          <span># 管理和调用各种调色板，统一可视化风格</span></span></code><code><span leaf=""><span>library</span>(arrow)              <span># 高效处理大数据文件，支持快速读取HDF5等格式</span></span></code><code><span leaf=""><span>library</span>(pheatmap)           <span># 绘制热图，用于基因表达模式展示</span></span></code><code><span leaf=""><span>library</span>(distances)          <span># 计算细胞间距离，支持聚类和降维分析</span></span></code><code><span leaf=""><span># 设置未来对象的最大内存（1000GB），避免大数据处理时内存不足</span></span></code><code><span leaf=""><span>options</span>(future.globals.maxSize = <span>1000</span> * <span>1024</span>^<span>2</span>)</span></code><code><span leaf=""><span># 加载自定义辅助函数，包含项目特定的数据处理和可视化函数</span></span></code><code><span leaf=""><span>source</span>(<span>"~/Methods/AuxFunctions.R"</span>)</span></code><code><span leaf=""><span># 定义样本信息表：包含样本名称、H5数据路径和反卷积结果路径</span></span></code><code><span leaf="">SampleInfo &lt;- data.<span>frame</span>(</span></code><code><span leaf="">  Sample = <span>c</span>(<span>"P1CRC"</span>, <span>"P2CRC"</span>, <span>"P5CRC"</span>),</span></code><code><span leaf="">  H5 = <span>c</span>(</span></code><code><span leaf="">    <span>"~/VisiumHD/PatientCRC1/outs/binned_outputs/square_008um/filtered_feature_bc_matrix.h5"</span>,</span></code><code><span leaf="">    <span>"~/VisiumHD/PatientCRC2/outs/binned_outputs/square_008um/filtered_feature_bc_matrix.h5"</span>,</span></code><code><span leaf="">    <span>"~/VisiumHD/PatientCRC5/outs/binned_outputs/square_008um/filtered_feature_bc_matrix.h5"</span></span></code><code><span leaf="">  ),</span></code><code><span leaf="">  Deconv = <span>c</span>(</span></code><code><span leaf="">    <span>"~/MetaData/DeconvolutionResults_P1CRC.csv.gz"</span>,</span></code><code><span leaf="">    <span>"~/MetaData/DeconvolutionResults_P2CRC.csv.gz"</span>,</span></code><code><span leaf="">    <span>"~/MetaData/DeconvolutionResults_P5CRC.csv.gz"</span></span></code><code><span leaf="">  )</span></code><code><span leaf="">)</span></code><code><span leaf=""><span># 初始化元数据和表达矩阵列表，用于存储多个样本的数据</span></span></code><code><span leaf="">MetaData &lt;- <span>vector</span>(<span>"list"</span>, length = <span>nrow</span>(SampleInfo))</span></code><code><span leaf="">Matrices &lt;- <span>vector</span>(<span>"list"</span>, length = <span>nrow</span>(SampleInfo))</span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 2. 多样本数据读取与合并</span></span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span>for</span>(jj in <span>1</span>:<span>nrow</span>(SampleInfo)) {</span></code><code><span leaf="">  <span># 读取10x Genomics格式的H5表达矩阵</span></span></code><code><span leaf="">  MatData &lt;- <span>open_matrix_10x_hdf5</span>(path = SampleInfo<span>$H5</span>[jj])</span></code><code><span leaf="">  <span># 将矩阵写入当前目录，便于后续处理</span></span></code><code><span leaf="">  <span>write_matrix_dir</span>(mat = MatData, dir = <span>getwd</span>(), overwrite = <span>TRUE</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 重新打开矩阵数据，确保格式统一</span></span></code><code><span leaf="">  mat &lt;- <span>open_matrix_dir</span>(dir = PathX)</span></code><code><span leaf="">  <span># 为列名添加样本后缀，避免多样本合并时条形码重复</span></span></code><code><span leaf="">  <span>colnames</span>(mat) &lt;- <span>paste0</span>(<span>colnames</span>(mat), <span>"_"</span>, SampleInfo<span>$Sample</span>[jj])</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 读取基因注释信息（特征表）</span></span></code><code><span leaf="">  Genes &lt;- read.<span>delim</span>(</span></code><code><span leaf="">    file = <span>"~/VisiumHD/PatientCRC1/outs/binned_outputs/square_008um/filtered_feature_bc_matrix/features.tsv.gz"</span>,</span></code><code><span leaf="">    sep = <span>"\t"</span>, header = <span>FALSE</span></span></code><code><span leaf="">  )</span></code><code><span leaf="">  <span># 设置基因名为唯一标识（处理可能的重复基因名）</span></span></code><code><span leaf="">  <span>rownames</span>(mat) &lt;- make.<span>unique</span>(Genes<span>$V2</span>[<span>match</span>(<span>rownames</span>(mat), Genes<span>$V1</span>)])</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 将当前样本的矩阵存入列表</span></span></code><code><span leaf="">  Matrices[[jj]] &lt;- mat</span></code><code><span leaf="">}</span></code><code><span leaf=""><span># 命名矩阵列表，便于后续引用</span></span></code><code><span leaf=""><span>names</span>(Matrices) &lt;- <span>c</span>(<span>"P1CRC"</span>, <span>"P2CRC"</span>, <span>"P5CRC"</span>)</span></code><code><span leaf=""><span># 创建Seurat对象并合并多样本表达矩阵</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>CreateSeuratObject</span>(counts = Matrices, meta.data = MetaData)</span></code><code><span leaf=""><span># 合并不同层的表达数据，确保数据一致性</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>JoinLayers</span>(merged.<span>object</span>)</span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 3. 反卷积结果整合与细胞类型注释</span></span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 加载每个样本的反卷积结果（细胞类型注释）</span></span></code><code><span leaf="">AllDeconvolution &lt;- <span>vector</span>(<span>"list"</span>, length = <span>nrow</span>(SampleInfo))</span></code><code><span leaf=""><span>for</span>(jj in <span>1</span>:<span>nrow</span>(SampleInfo)) {</span></code><code><span leaf="">  DecTmp &lt;- read.<span>delim</span>(SampleInfo<span>$Deconv</span>[jj], sep = <span>","</span>, na.omit = <span>TRUE</span>)</span></code><code><span leaf="">  <span># 为条形码添加样本后缀，与Seurat对象的列名匹配</span></span></code><code><span leaf="">  DecTmp<span>$barcode</span> &lt;- <span>paste0</span>(DecTmp<span>$barcode</span>, <span>"_"</span>, SampleInfo<span>$Sample</span>[jj])</span></code><code><span leaf="">  AllDeconvolution[[jj]] &lt;- DecTmp</span></code><code><span leaf="">}</span></code><code><span leaf=""><span># 合并所有样本的反卷积结果，形成统一的注释表</span></span></code><code><span leaf="">AllDeconvolution &lt;- <span>Reduce</span>(rbind, AllDeconvolution)</span></code><code><span leaf=""><span># 将反卷积结果映射到Seurat对象的元数据中</span></span></code><code><span leaf="">merged.<span>object</span><span>$DeconvolutionClass</span> &lt;- AllDeconvolution<span>$DeconvolutionClass</span>[</span></code><code><span leaf="">  <span>match</span>(<span>colnames</span>(merged.<span>object</span>), AllDeconvolution<span>$barcode</span>)</span></code><code><span leaf="">]</span></code><code><span leaf="">merged.<span>object</span><span>$DeconvolutionLabel1</span> &lt;- AllDeconvolution<span>$DeconvolutionLabel1</span>[</span></code><code><span leaf="">  <span>match</span>(<span>colnames</span>(merged.<span>object</span>), AllDeconvolution<span>$barcode</span>)</span></code><code><span leaf="">]</span></code><code><span leaf="">merged.<span>object</span><span>$DeconvolutionLabel2</span> &lt;- AllDeconvolution<span>$DeconvolutionLabel2</span>[</span></code><code><span leaf="">  <span>match</span>(<span>colnames</span>(merged.<span>object</span>), AllDeconvolution<span>$barcode</span>)</span></code><code><span leaf="">]</span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 4. 数据降维与聚类分析（Sketch方法）</span></span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 标准化数据，为后续分析做准备</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>NormalizeData</span>(merged.<span>object</span>)</span></code><code><span leaf=""><span># 识别高变基因（HVGs），减少后续分析维度</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>FindVariableFeatures</span>(merged.<span>object</span>)</span></code><code><span leaf=""><span># 使用Sketch方法降维，减少计算量（适用于大规模数据）</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>SketchData</span>(</span></code><code><span leaf="">  <span>object</span> = merged.<span>object</span>,</span></code><code><span leaf="">  ncells = <span>240000</span>,</span></code><code><span leaf="">  method = <span>"LeverageScore"</span>,</span></code><code><span leaf="">  sketched.assay = <span>"sketch"</span></span></code><code><span leaf="">)</span></code><code><span leaf=""><span># 设置默认分析对象为Sketch数据，专注于降维子集</span></span></code><code><span leaf=""><span>DefaultAssay</span>(merged.<span>object</span>) &lt;- <span>"sketch"</span></span></code><code><span leaf=""><span># 在Sketch数据上再次识别高变基因，优化特征选择</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>FindVariableFeatures</span>(merged.<span>object</span>)</span></code><code><span leaf=""><span># 标准化和缩放数据，确保特征可比性</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>ScaleData</span>(merged.<span>object</span>)</span></code><code><span leaf=""><span># 主成分分析（PCA），提取主要变异维度</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>RunPCA</span>(merged.<span>object</span>)</span></code><code><span leaf=""><span># 基于PCA结果寻找邻居细胞，构建细胞间关系图</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>FindNeighbors</span>(merged.<span>object</span>, dims = <span>1</span>:<span>20</span>)</span></code><code><span leaf=""><span># 图聚类分析，识别细胞群（分辨率0.8）</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>FindClusters</span>(merged.<span>object</span>, resolution = <span>0.8</span>)</span></code><code><span leaf=""><span># 执行UMAP降维，用于可视化高维数据（返回模型用于投影）</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>RunUMAP</span>(merged.<span>object</span>, dims = <span>1</span>:<span>20</span>, <span>return</span>.model = <span>TRUE</span>)</span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 5. 细胞类型注释（Level 1：主要细胞类型）</span></span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 手动定义Level 1的细胞类型标签，对应聚类结果</span></span></code><code><span leaf="">IdentsLvl1 &lt;- <span>c</span>(</span></code><code><span leaf="">  <span>"Tumor"</span>, <span>"Intestinal Epithelial"</span>, <span>"Endothelial"</span>, <span>"Smooth Muscle"</span>, <span>"Tumor"</span>, <span>"Tumor"</span>, <span>"T cells"</span>,</span></code><code><span leaf="">  <span>"Fibroblast"</span>, <span>"B cells"</span>, <span>"Myeloid"</span>, <span>"Fibroblast"</span>, <span>"Tumor"</span>, <span>"Unknown"</span>, <span>"Intestinal Epithelial"</span>, <span>"Fibroblast"</span>,</span></code><code><span leaf="">  <span>"Unknown"</span>, <span>"Myeloid"</span>, <span>"B cells"</span>, <span>"Tumor"</span>, <span>"Tumor"</span>, <span>"Neuronal"</span>, <span>"Tumor"</span>, <span>"Unknown"</span></span></code><code><span leaf="">)</span></code><code><span leaf=""><span># 将聚类结果映射到Level 1标签（+1是因为R索引从1开始）</span></span></code><code><span leaf="">merged.<span>object</span><span>$Level1</span> &lt;- IdentsLvl1[<span>as</span>.<span>numeric</span>(<span>as</span>.<span>vector</span>(merged.<span>object</span><span>$seurat_clusters</span>)) + <span>1</span>]</span></code><code><span leaf=""><span># 转换为因子类型并排序，确保可视化顺序一致</span></span></code><code><span leaf="">merged.<span>object</span><span>$Level1</span> &lt;- <span>factor</span>(merged.<span>object</span><span>$Level1</span>, levels = <span>sort</span>(<span>unique</span>(merged.<span>object</span><span>$Level1</span>)))</span></code><code><span leaf=""><span># 设置当前标识为Level 1标签，便于后续分析</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>SetIdent</span>(merged.<span>object</span>, value = <span>"Level1"</span>)</span></code><code><span leaf=""><span># 寻找所有Level 1细胞类型的标记基因（只保留上调基因）</span></span></code><code><span leaf="">Mks &lt;- <span>FindAllMarkers</span>(</span></code><code><span leaf="">  merged.<span>object</span>,</span></code><code><span leaf="">  logfc.threshold = <span>0.2</span>,</span></code><code><span leaf="">  min.diff.pct = <span>0.2</span>,</span></code><code><span leaf="">  only.pos = <span>TRUE</span></span></code><code><span leaf="">)</span></code><code><span leaf=""><span># 筛选显著差异基因（FDR校正后p值&lt;0.05）</span></span></code><code><span leaf="">Mks &lt;- Mks[Mks<span>$p_val_adj</span> &lt; <span>0.05</span>, ]</span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 6. 细胞类型细分（Level 2：细胞亚型）</span></span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 初始化Level 2标记基因和元数据列表</span></span></code><code><span leaf="">MarkersSubcluster &lt;- <span>vector</span>(<span>"list"</span>, length = <span>length</span>(IdentsLvl1))</span></code><code><span leaf=""><span>names</span>(MarkersSubcluster) &lt;- IdentsLvl1</span></code><code><span leaf="">MetaDataSubClusters &lt;- <span>vector</span>(<span>"list"</span>, length = <span>length</span>(IdentsLvl1))</span></code><code><span leaf=""><span>names</span>(MetaDataSubClusters) &lt;- IdentsLvl1</span></code><code><span leaf=""><span># 对每个Level 1细胞类型进行细分聚类</span></span></code><code><span leaf=""><span>for</span>(ClusterID in <span>levels</span>(merged.<span>object</span><span>$Level1</span>)) {</span></code><code><span leaf="">  <span>message</span>(ClusterID)  <span># 输出当前处理的细胞类型，便于追踪进度</span></span></code><code><span leaf="">  <span># 子集当前Level 1细胞类型，专注于细分分析</span></span></code><code><span leaf="">  Subset &lt;- <span>subset</span>(merged.<span>object</span>, idents = ClusterID)</span></code><code><span leaf="">  <span># 识别高变基因，为细分聚类做准备</span></span></code><code><span leaf="">  Subset &lt;- <span>FindVariableFeatures</span>(Subset)</span></code><code><span leaf="">  <span># 标准化和缩放数据</span></span></code><code><span leaf="">  Subset &lt;- <span>ScaleData</span>(Subset)</span></code><code><span leaf="">  <span># 主成分分析，提取细分维度</span></span></code><code><span leaf="">  Subset &lt;- <span>RunPCA</span>(Subset)</span></code><code><span leaf="">  <span># 寻找邻居细胞（使用25个主成分，高于Level 1分析）</span></span></code><code><span leaf="">  Subset &lt;- <span>FindNeighbors</span>(Subset, dims = <span>1</span>:<span>25</span>)</span></code><code><span leaf="">  <span># 细分聚类（分辨率0.1，低于Level 1，获得更细的亚型）</span></span></code><code><span leaf="">  Subset &lt;- <span>FindClusters</span>(Subset, resolution = <span>0.1</span>)</span></code><code><span leaf="">  <span># 生成Level 2标签（格式：Level1名称_聚类编号）</span></span></code><code><span leaf="">  Subset<span>$Level2</span> &lt;- <span>paste0</span>(<span>gsub</span>(<span>" "</span>, <span>""</span>, ClusterID), <span>"_"</span>, Subset<span>$seurat_clusters</span>)</span></code><code><span leaf="">  <span># 设置当前标识为Level 2标签，便于后续标记基因分析</span></span></code><code><span leaf="">  Subset &lt;- <span>SetIdent</span>(Subset, value = <span>"Level2"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 存储当前细胞类型的元数据</span></span></code><code><span leaf="">  MetaDataSubClusters[[ClusterID]] &lt;- Subset@meta.data</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 寻找Level 2细分群的标记基因（放宽阈值，捕捉细微差异）</span></span></code><code><span leaf="">  SubMks &lt;- <span>FindAllMarkers</span>(</span></code><code><span leaf="">    Subset,</span></code><code><span leaf="">    min.diff.pct = <span>0.1</span>,</span></code><code><span leaf="">    logfc.threshold = <span>0.1</span>,</span></code><code><span leaf="">    only.pos = <span>TRUE</span></span></code><code><span leaf="">  )</span></code><code><span leaf="">  <span># 筛选显著差异基因</span></span></code><code><span leaf="">  SubMks &lt;- SubMks[SubMks<span>$p_val_adj</span> &lt; <span>0.05</span>, ]</span></code><code><span leaf="">  MarkersSubcluster[[ClusterID]] &lt;- SubMks</span></code><code><span leaf="">}</span></code><code><span leaf=""><span># 合并所有Level 2标记基因和元数据，形成统一数据集</span></span></code><code><span leaf="">MarkersSubcluster &lt;- <span>do</span>.<span>call</span>(rbind, MarkersSubcluster)</span></code><code><span leaf="">MetaDataSubClusters &lt;- <span>do</span>.<span>call</span>(rbind, MetaDataSubClusters)</span></code><code><span leaf=""><span># 从条形码中提取样本信息，便于后续映射</span></span></code><code><span leaf="">MetaDataSubClusters<span>$Barcode</span> &lt;- <span>sapply</span>(</span></code><code><span leaf="">  <span>strsplit</span>(<span>rownames</span>(MetaDataSubClusters), <span>"[.]"</span>),</span></code><code><span leaf="">  function(X) { <span>return</span>(X[<span>2</span>]) }</span></code><code><span leaf="">)</span></code><code><span leaf=""><span># 定义Level 2的细胞类型标签（按生物学意义排序）</span></span></code><code><span leaf="">IdentsLevel2 &lt;- <span>c</span>(</span></code><code><span leaf="">  <span>"Bcells_0"</span>, <span>"Bcells_1"</span>, <span>"Bcells_2"</span>, <span>"Bcells_3"</span>, <span>"Bcells_4"</span>,</span></code><code><span leaf="">  <span>"Endothelial_0"</span>, <span>"Endothelial_1"</span>, <span>"Endothelial_2"</span>, <span>"Endothelial_3"</span>,</span></code><code><span leaf="">  <span>"Fibroblast_0"</span>, <span>"Fibroblast_1"</span>, <span>"Fibroblast_2"</span>,</span></code><code><span leaf="">  <span>"IntestinalEpithelial_0"</span>, <span>"IntestinalEpithelial_1"</span>, <span>"IntestinalEpithelial_2"</span>, <span>"IntestinalEpithelial_3"</span>, <span>"IntestinalEpithelial_4"</span>, <span>"IntestinalEpithelial_5"</span>,</span></code><code><span leaf="">  <span>"Myeloid_0"</span>, <span>"Myeloid_1"</span>, <span>"Myeloid_2"</span>,</span></code><code><span leaf="">  <span>"Neuronal_0"</span>, <span>"Neuronal_1"</span>,</span></code><code><span leaf="">  <span>"SmoothMuscle_0"</span>, <span>"SmoothMuscle_1"</span>, <span>"SmoothMuscle_2"</span>, <span>"SmoothMuscle_3"</span>, <span>"SmoothMuscle_4"</span>,</span></code><code><span leaf="">  <span>"Tcells_0"</span>, <span>"Tcells_1"</span>, <span>"Tcells_2"</span>, <span>"Tcells_3"</span>,</span></code><code><span leaf="">  <span>"Tumor_0"</span>, <span>"Tumor_1"</span>, <span>"Tumor_2"</span>, <span>"Tumor_3"</span>,</span></code><code><span leaf="">  <span>"Unknown_0"</span>, <span>"Unknown_1"</span>, <span>"Unknown_2"</span>, <span>"Unknown_3"</span>, <span>"Unknown_4"</span>, <span>"Unknown_5"</span>, <span>"Unknown_6"</span></span></code><code><span leaf="">)</span></code><code><span leaf=""><span># 转换为因子类型并排序，确保可视化一致性</span></span></code><code><span leaf="">MetaDataSubClusters<span>$Level2</span> &lt;- <span>factor</span>(MetaDataSubClusters<span>$Level2</span>, levels = IdentsLevel2)</span></code><code><span leaf="">MarkersSubcluster<span>$cluster</span> &lt;- <span>factor</span>(MarkersSubcluster<span>$cluster</span>, levels = IdentsLevel2)</span></code><code><span leaf=""><span># 将Level 2标签映射到Seurat对象的元数据中</span></span></code><code><span leaf="">merged.<span>object</span><span>$Level2</span> &lt;- MetaDataSubClusters<span>$Level2</span>[</span></code><code><span leaf="">  <span>match</span>(<span>colnames</span>(merged.<span>object</span>), MetaDataSubClusters<span>$Barcode</span>)</span></code><code><span leaf="">]</span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 7. 数据投影与可视化准备</span></span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 将Sketch数据的降维结果投影到全数据集，实现高效分析</span></span></code><code><span leaf="">merged.<span>object</span> &lt;- <span>Seurat</span>:::<span>ProjectData</span>(</span></code><code><span leaf="">  <span>object</span> = merged.<span>object</span>,</span></code><code><span leaf="">  assay = <span>"RNA"</span>,</span></code><code><span leaf="">  full.reduction = <span>"pca.full"</span>,</span></code><code><span leaf="">  sketched.assay = <span>"sketch"</span>,</span></code><code><span leaf="">  sketched.reduction = <span>"pca"</span>,</span></code><code><span leaf="">  umap.model = <span>"umap"</span>,</span></code><code><span leaf="">  dims = <span>1</span>:<span>50</span>,</span></code><code><span leaf="">  refdata = <span>list</span>(L1 = <span>"Level1"</span>, L2 = <span>"Level2"</span>)</span></code><code><span leaf="">)</span></code><code><span leaf=""><span># 计算Level 2和Level 1标签的UMAP坐标中位数，用于标签定位</span></span></code><code><span leaf="">LabelsL2 &lt;- MetaData.merged %&gt;% <span>group_by</span>(L2) %&gt;% <span>summarise</span>(X = <span>median</span>(fullumap_1), Y = <span>median</span>(fullumap_2))</span></code><code><span leaf="">LabelsL1 &lt;- MetaData.merged %&gt;% <span>group_by</span>(L1) %&gt;% <span>summarise</span>(X = <span>median</span>(fullumap_1), Y = <span>median</span>(fullumap_2))</span></code><code><span leaf=""><span># 创建Level 1细胞类型的颜色调色板（基于ggsci包）</span></span></code><code><span leaf="">MetaData.merged<span>$L1</span> &lt;- <span>factor</span>(MetaData.merged<span>$L1</span>, levels = <span>sort</span>(<span>unique</span>(MetaData.merged<span>$L1</span>)))</span></code><code><span leaf="">ColsL1 &lt;- paletteer::<span>paletteer_d</span>(<span>"ggsci::category10_d3"</span>)[<span>1</span>:<span>length</span>(<span>levels</span>(MetaData.merged<span>$L1</span>))]</span></code><code><span leaf=""><span>names</span>(ColsL1) &lt;- <span>levels</span>(MetaData.merged<span>$L1</span>)</span></code><code><span leaf=""><span># 自定义部分细胞类型颜色，增强可视化辨识度</span></span></code><code><span leaf="">ColsL1[<span>"T cells"</span>] &lt;- <span>"#8C564BFF"</span></span></code><code><span leaf="">ColsL1[<span>"Neuronal"</span>] &lt;- <span>"#7F7F7FFF"</span></span></code><code><span leaf=""><span># 创建Level 2细胞亚型的颜色调色板</span></span></code><code><span leaf="">MetaData.merged<span>$L2</span> &lt;- <span>factor</span>(MetaData.merged<span>$L2</span>, levels = <span>sort</span>(<span>unique</span>(MetaData.merged<span>$L2</span>)))</span></code><code><span leaf="">ColsL2 &lt;- paletteer::<span>paletteer_d</span>(<span>"ggsci::default_igv"</span>)[<span>1</span>:<span>length</span>(<span>levels</span>(MetaData.merged<span>$L2</span>))]</span></code><code><span leaf=""><span>names</span>(ColsL2) &lt;- <span>levels</span>(MetaData.merged<span>$L2</span>)</span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 8. 空间可视化（Figure 3A-B）</span></span></code><code><span leaf=""><span># ---------------------------</span></span></code><code><span leaf=""><span># 以P1CRC样本为例进行空间绘图</span></span></code><code><span leaf="">Patient &lt;- <span>"P1CRC"</span></span></code><code><span leaf=""><span># 按样本分割元数据</span></span></code><code><span leaf="">BarcodeData &lt;- <span>split</span>(MetaData.merged, MetaData.merged<span>$Patient</span>)</span></code><code><span leaf="">BarcodeData &lt;- BarcodeData[[Patient]]</span></code><code><span leaf=""><span># 生成样本数据框（包含空间坐标和细胞类型）</span></span></code><code><span leaf="">DF &lt;- <span>GenerateSampleData</span>(<span>"~/VisiumHD/PatientCRC1/outs/"</span>)<span>$bcs</span></span></code><code><span leaf=""><span># 将细胞类型标签映射到空间数据</span></span></code><code><span leaf="">DF<span>$Level1</span> &lt;- BarcodeData<span>$L1</span>[</span></code><code><span leaf="">  <span>match</span>(<span>paste0</span>(DF<span>$barcode</span>, <span>paste0</span>(<span>"_"</span>, Patient)), <span>rownames</span>(BarcodeData))</span></code><code><span leaf="">]</span></code><code><span leaf="">DF<span>$Level1</span> &lt;- <span>factor</span>(DF<span>$Level1</span>, levels = <span>sort</span>(<span>unique</span>(DF<span>$Level1</span>)))</span></code><code><span leaf="">DF<span>$Level2</span> &lt;- BarcodeData<span>$L2</span>[</span></code><code><span leaf="">  <span>match</span>(<span>paste0</span>(DF<span>$barcode</span>, <span>paste0</span>(<span>"_"</span>, Patient)), <span>rownames</span>(BarcodeData))</span></code><code><span leaf="">]</span></code><code><span leaf="">DF<span>$Level2</span> &lt;- <span>factor</span>(DF<span>$Level2</span>, levels = <span>sort</span>(<span>unique</span>(DF<span>$Level2</span>)))</span></code><code><span leaf="">DF<span>$DeconvolutionClass</span> &lt;- BarcodeData<span>$DeconvolutionClass</span>[</span></code><code><span leaf="">  <span>match</span>(<span>paste0</span>(DF<span>$barcode</span>, <span>paste0</span>(<span>"_"</span>, Patient)), <span>rownames</span>(BarcodeData))</span></code><code><span leaf="">]</span></code><code><span leaf="">DF<span>$DeconvolutionL1</span> &lt;- BarcodeData<span>$DeconvolutionLabel1</span>[</span></code><code><span leaf="">  <span>match</span>(<span>paste0</span>(DF<span>$barcode</span>, <span>paste0</span>(<span>"_"</span>, Patient)), <span>rownames</span>(Bar</span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/dRtKfcX4NZ8Ks6SgEh6ozA",target="_blank" rel="noopener noreferrer">原文链接</a>
