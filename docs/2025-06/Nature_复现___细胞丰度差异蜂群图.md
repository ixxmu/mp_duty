---
title: "Nature 复现 | 细胞丰度差异蜂群图"
date: 2025-06-19T07:23:54Z
draft: ["false"]
tags: [
  "fetched",
  "MsTt笔记"
]
categories: ["Acdemic"]
---
Nature 复现 | 细胞丰度差异蜂群图 by MsTt笔记
------
<div><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="0 0 []"><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="MsTt笔记" data-from="1" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKJLwvM2QW48QKCicY8yHrEfwZA1qzJqmnSDuICrXOZEk6YYntc7QSLbdwg12uibFOEziaEVEXhEJQ4vQ/0?wx_fmt=png" data-signature="SCI绘图，Python/R，生物信息，数理统计，多组学原理" data-id="MzkxNDcwNzY2NQ==" data-is_biz_ban="0"></mp-common-profile></section><p data-tool="mdnice编辑器"><strong><span leaf=""><br></span></strong></p><p data-tool="mdnice编辑器" data-pm-slice="0 0 []"><span leaf="">请尊重原创劳动成果🙏</span></p><p><span><span leaf="">未经允许，不得转载，不可抄袭！</span></span></p><p data-tool="mdnice编辑器"><strong><span leaf="">细胞丰度</span><strong><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{"data-tool":"markdown2wechat编辑器","data-website":"https://aizhuanqian.com","style":"font-size: 16px;word-spacing: 0px;word-break: break-word;word-wrap: break-word;text-align: left;color: #3f3f3f;font-family: ptima-Regular;letter-spacing: 1px;line-height: 1.75;padding: 0px;","data-pm-slice":"0 0 []"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"p","attributes":{"data-tool":"mdnice编辑器","style":"padding-top: 8px;padding-bottom: 8px;color: #3f3f3f;font-family: ptima-Regular;letter-spacing: 1px;line-height: 1.75;font-size: 15px;margin: 12px 4px;text-align: justify;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"node",{"tagName":"strong","attributes":{"style":"color: #3f3f3f;font-weight: bold;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>差异</span></strong><span leaf="">分析</span></strong><span leaf="">是单细胞研究的核心环节，其目标是在复杂细胞群体中识别因实验条件、发育阶段或疾病状态而发生比例变化的细胞亚群。</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">MILO</span></strong><span leaf="">是专为单细胞数据设计的丰度差异分析方法，其核心优势在于通过</span><em><span leaf="">混合效应模型</span></em><span leaf="">校正样本间异质性，并利用</span><em><span leaf="">KNN邻域平滑</span></em><span leaf="">增强对小规模细胞群体的检测灵敏度。其通过以下步骤实现精准推断：</span></p><ul><li><section><strong><span leaf="">构建细胞邻域图</span></strong><span leaf="">：基于KNN网络定义局部细胞群落（Nhoods），避免依赖主观聚类边界。</span></section></li><li><section><strong><span leaf="">混合效应建模</span></strong><span leaf="">：在广义线性模型（GLM）中引入随机效应项，校正样本批次或个体差异。</span></section></li><li><section><strong><span leaf="">假设检验</span></strong><span leaf="">：通过 Wald 检验或 LRT 评估各邻域的丰度变化显著性。</span></section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">R语言实现（miloR包）</span></span><span></span></h3><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 加载包</span></span></code><code><span leaf=""><span>library</span>(miloR)  </span></code><code><span leaf=""><span># 从Seurat对象转换  </span></span></code><code><span leaf=""><span>milo_obj</span> &lt;- Milo(seurat_obj)  </span></code><code><span leaf=""><span># 构建KNN图（k=30，需要根据数据调整）  </span></span></code><code><span leaf=""><span>milo_obj</span> &lt;- buildGraph(milo_obj, k = <span>30</span>, d = <span>30</span>)  </span></code><code><span leaf=""><span># 定义邻域并建模  </span></span></code><code><span leaf=""><span>milo_obj</span> &lt;- makeNhoods(milo_obj, prop = <span>0</span>.<span>1</span>)  </span></code><code><span leaf=""><span>da_res</span> &lt;- testNhoods(milo_obj, design = ~group)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 筛选显著邻域（FDR &lt; 5%）  </span></span></code><code><span leaf=""><span>sig_nhoods</span> &lt;- da_res[da_res$FDR &lt; <span>0</span>.<span>05</span>, ]  </span></code><code><span leaf=""><span># 关联邻域与细胞类型注释  </span></span></code><code><span leaf=""><span>sig_nhoods</span> &lt;- annotateNhoods(milo_obj, sig_nhoods, coldata_col = <span>"cell_type"</span>)  </span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">今天将基于从上述miloR分析中<span textstyle="">提取的丰度差异结果</span>，来复现 2 个 </span><strong><span leaf="">Nature </span></strong><span leaf="">期刊中的蜂群图。</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRZFQCSRBqFIO4mPtbb6EXpsIw24GwVvFzibu6ps5Zt6AvYf2buloZgAw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.4546296296296296" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001393" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRZFQCSRBqFIO4mPtbb6EXpsIw24GwVvFzibu6ps5Zt6AvYf2buloZgAw/640?wx_fmt=png&amp;from=appmsg"></section><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现1</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">第一篇是 </span><strong><span leaf="">Nature</span></strong><span leaf=""> 文章中 (To, K., Fei, L., Pett, J.P. et al. A multi-omic atlas of human embryonic skeletal development. Nature 635, 657–667 (2024). https://doi.org/10.1038/s41586-024-08189-z) 的 Extended Data Fig.4</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">原图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xR80j5zwz4cw1zU73ibn6trUEA4AxWDaUBbDIuugPHN5PBPVf3X6XibB7w/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.2862254025044724" data-type="png" data-w="559" data-imgfileid="100001394" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xR80j5zwz4cw1zU73ibn6trUEA4AxWDaUBbDIuugPHN5PBPVf3X6XibB7w/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf="">这个组合图揭示了发育时间和空间位置如何动态调控骨骼系统的细胞分化，分为四个子图模块：</span></p><ul><li><section><span leaf="">（上半部分）左侧 vs 右侧：分别比较了不同区域（如肢体、颅面）或胚胎发育周（PCW）对骨/软骨生成细胞丰度的影响。</span></section></li><li><section><span leaf="">（下半部分）左侧 vs 右侧：结构与上半部分类似，但聚焦于颅骨特异的细胞亚群。</span></section></li><li><section><span leaf="">图中每个点代表一个邻域的 logFC 值；虚线（logFC=0）为基线，偏离虚线的点提示发育时间依赖的丰度变化。</span></section></li><li><section><span leaf="">该图有效传达了复杂的<span textstyle="">多组比较信息</span>，方便<span textstyle="">快速定位</span>显著变化的细胞类型。</span></section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRqr1E1KfQMykLImrZq22OuT2potB0158ibMibZVGSnrrI6RH7tYo8sOVQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.3054545454545454" data-type="png" data-w="550" data-imgfileid="100001395" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRqr1E1KfQMykLImrZq22OuT2potB0158ibMibZVGSnrrI6RH7tYo8sOVQ/640?wx_fmt=png&amp;from=appmsg"></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载包，读入数据</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span leaf=""><span># 加载必要的包</span></span></code><code><span leaf="">library(tidyverse)</span></code><code><span leaf="">library(readxl)</span></code><code><span leaf="">library(ggbeeswarm)</span></code><code><span leaf="">library(grid)</span></code><code><span leaf="">library(patchwork)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 读入数据</span></span></code><code><span leaf="">df1 &lt;- read_excel(<span>"data1.xlsx"</span>)</span></code><code><span leaf="">df2 &lt;- read_excel(<span>"data2.xlsx"</span>)</span></code><code><span leaf="">df3 &lt;- read_excel(<span>"data3.xlsx"</span>)</span></code><code><span leaf="">df4 &lt;- read_excel(<span>"data4.xlsx"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义cell type的顺序</span></span></code><code><span leaf="">cell_types1 &lt;- c(<span>"InterzoneChon"</span>, <span>"ChondroPro1"</span>, <span>"ChondroPro2"</span>, <span>"CyclingChon"</span>, </span></code><code><span leaf="">                 <span>"DLK1⁺Chon"</span>, <span>"PAX7⁺Chon"</span>, <span>"ArticularChon1"</span>, <span>"ArticularChon2"</span>,</span></code><code><span leaf="">                 <span>"FacialChon"</span>, <span>"HypertrophicChon"</span>, <span>"MandibularChon"</span>, <span>"RestingChon"</span>,</span></code><code><span leaf="">                 <span>"LimbMes"</span>, <span>"LEPR⁺Mes"</span>, <span>"CranialMes"</span>, <span>"PArchMes"</span>, <span>"FacialMes"</span>,</span></code><code><span leaf="">                 <span>"SutureMes1"</span>, <span>"SutureMes2"</span>, <span>"Preosteoblast"</span>, <span>"HHIP⁺PreOB"</span>,</span></code><code><span leaf="">                 <span>"Osteoblast"</span>, <span>"Osteocyte"</span>, <span>"MatureOsteocyte"</span>, <span>"Mixed"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf="">cell_types2 &lt;- c(<span>"CraniaIMes"</span>, <span>"FaciaMes"</span>, <span>"PArchMes"</span>, <span>"LEPR Mes"</span>, </span></code><code><span leaf="">                 <span>"SutureMes1"</span>, <span>"SutureMes2"</span>, <span>"Preostoblast"</span>, <span>"HHIP PreOB"</span>,</span></code><code><span leaf="">                 <span>"Osteoblast"</span>, <span>"Osteocyte"</span>, <span>"MatureOsteocyte"</span>, <span>"Mixed"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf="">df1<span>$cell_type</span> &lt;- <span>factor</span>(df1<span>$cell_type</span>, levels = rev(cell_types1))</span></code><code><span leaf="">df2<span>$cell_type</span> &lt;- <span>factor</span>(df2<span>$cell_type</span>, levels = rev(cell_types1))</span></code><code><span leaf="">df3<span>$cell_type</span> &lt;- <span>factor</span>(df3<span>$cell_type</span>, levels = rev(cell_types2))</span></code><code><span leaf="">df4<span>$cell_type</span> &lt;- <span>factor</span>(df4<span>$cell_type</span>, levels = rev(cell_types2))</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">读入数据，定义好不同类型细胞的展示顺序。</span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">此绘图数据为模拟数据，无实际意义，如需可以自助获取。</span></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图-上左图</span></span></h2><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>ggplot</span>(df1, aes(y = cell_type, x = logFC)) +</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = <span>0</span>, linetype = <span>"dashed"</span>, color = <span>"#000000"</span>, linewidth = <span>2</span>) +</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = c(-<span>5</span>, <span>5</span>), linetype = <span>"solid"</span>, color = <span>"gray50"</span>) +</span></code><code><span leaf="">  <span>geom_beeswarm</span>(size = <span>0</span>.<span>1</span>, color = <span>"#f33131"</span>, cex = <span>0</span>.<span>26</span>) +</span></code><code><span leaf="">  <span>scale_x_continuous</span>(breaks = c(-<span>5</span>, <span>0</span>, <span>5</span>)) +</span></code><code><span leaf="">  <span>labs</span>(x = <span>"logFC"</span>, y = NULL) +</span></code><code><span leaf="">  <span>theme_test</span>()</span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRlvMQVQd32d9wfG2zUQ6Zr68IwyJVVXliaxjLhNoZ4CfVPPpOFJlnqjg/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.3309037900874636" data-s="300,640" data-type="png" data-w="686" type="block" data-imgfileid="100001396" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRlvMQVQd32d9wfG2zUQ6Zr68IwyJVVXliaxjLhNoZ4CfVPPpOFJlnqjg/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图-上右图</span></span></h2><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>ounter</span>(lineounter(lineounter(lineounter(lineounter(lineounter(lineounter(line</span></code><code><span leaf=""><span>ggplot</span>(df2, aes(y = cell_type, x = logFC)) +</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = <span>0</span>, linetype = <span>"dashed"</span>, color = <span>"#000000"</span>, linewidth = <span>2</span>) +</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = c(-<span>1</span>, -<span>0</span>.<span>5</span>, <span>0</span>.<span>5</span>, <span>1</span>), linetype = <span>"solid"</span>, color = <span>"gray50"</span>) +</span></code><code><span leaf="">  <span>geom_beeswarm</span>(size = <span>0</span>.<span>1</span>, color = <span>"#4658a5"</span>, cex = <span>0</span>.<span>27</span>) +</span></code><code><span leaf="">  <span>labs</span>(x = NULL, y = NULL) +</span></code><code><span leaf="">  <span>scale_x_continuous</span>(breaks = seq(-<span>1</span>, <span>1</span>, <span>0</span>.<span>5</span>)) +</span></code><code><span leaf="">  <span>theme_test</span>()</span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRdqSPW8ibuIa39znP188neSCwDMpNPECiboa8ofYh3sKCfmHBb9ibYgCgA/640?wx_fmt=png&amp;from=appmsg" data-ratio="2.067757009345794" data-s="300,640" data-type="png" data-w="428" type="block" data-imgfileid="100001397" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRdqSPW8ibuIa39znP188neSCwDMpNPECiboa8ofYh3sKCfmHBb9ibYgCgA/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">组合图形-上半部分</span></span></h2><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRLWfKdKOlzdxTzYajSkKuluqHBfJaiaMsCwpiagZJcQYZeLxE4PMfGPYw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8240740740740741" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001398" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRLWfKdKOlzdxTzYajSkKuluqHBfJaiaMsCwpiagZJcQYZeLxE4PMfGPYw/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图-下左图</span></span></h2><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>ounter</span>(lineounter(lineounter(lineounter(lineounter(lineounter(lineounter(line</span></code><code><span leaf=""><span>ggplot</span>(df3, aes(y = cell_type, x = logFC)) +</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = <span>0</span>, linetype = <span>"dashed"</span>, color = <span>"#000000"</span>, linewidth = <span>2</span>)+</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = c(-<span>5</span>, <span>5</span>), linetype = <span>"solid"</span>, color = <span>"gray50"</span>) +</span></code><code><span leaf="">  <span>geom_beeswarm</span>(size = <span>0</span>.<span>1</span>, color = <span>"#864093"</span>, cex = <span>0</span>.<span>3</span>) +</span></code><code><span leaf="">  <span>labs</span>(x = <span>"logFC"</span>, y = NULL) +</span></code><code><span leaf="">  <span>scale_x_continuous</span>(breaks = c(-<span>5</span>, <span>0</span>, <span>5</span>))+</span></code><code><span leaf="">  <span>theme_test</span>()</span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRJicS0tueZkpkr5CoVeFYmmdbGsXmfIY0ZZPkSDJZazlaXNbtPKDGwkw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7846820809248555" data-s="300,640" data-type="png" data-w="692" type="block" data-imgfileid="100001399" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRJicS0tueZkpkr5CoVeFYmmdbGsXmfIY0ZZPkSDJZazlaXNbtPKDGwkw/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图-下右图</span></span></h2><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>ounter</span>(lineounter(lineounter(lineounter(lineounter(lineounter(lineounter(line</span></code><code><span leaf=""><span>ggplot</span>(df4, aes(y = cell_type, x = logFC)) +</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = <span>0</span>, linetype = <span>"dashed"</span>, color = <span>"#000000"</span>, linewidth = <span>2</span>)+</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = c(-<span>4</span>, -<span>2</span>, <span>2</span>), linetype = <span>"solid"</span>, color = <span>"gray50"</span>) +</span></code><code><span leaf="">  <span>geom_beeswarm</span>(size = <span>0</span>.<span>1</span>, color = <span>"#4658a5"</span>, cex = <span>0</span>.<span>3</span>) +</span></code><code><span leaf="">  <span>labs</span>(x = NULL, y = NULL) +</span></code><code><span leaf="">  <span>scale_x_continuous</span>(breaks = seq(-<span>4</span>, <span>2</span>, <span>2</span>))+</span></code><code><span leaf="">  <span>theme_test</span>()</span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xREAwkfBtlK22UEwOMY7xn63gKp12SZqmHCLdBNRy0BQHFQsHlPg6F4Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.2004662004662006" data-s="300,640" data-type="png" data-w="429" type="block" data-imgfileid="100001400" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xREAwkfBtlK22UEwOMY7xn63gKp12SZqmHCLdBNRy0BQHFQsHlPg6F4Q/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">组合图形</span></span></h2><section><ul><li></ul><pre data-lang=""><code><span leaf="">(p1 + p2) / (p3 + p4)</span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRiaLfeXOoicWvqhzfa74x4MlibSUvFRzgO36ic32ib2vtHhsbYOFRYpoVsMA/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.3148148148148149" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001401" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRiaLfeXOoicWvqhzfa74x4MlibSUvFRzgO36ic32ib2vtHhsbYOFRYpoVsMA/640?wx_fmt=png&amp;from=appmsg"></section><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现2</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">第二篇是 </span><strong><span leaf="">Nature</span></strong><span leaf=""> 文章中 (Gopee, N.H., Winheim, E., Olabi, B. et al. A prenatal skin atlas reveals immune regulation of human skin morphogenesis. Nature 635, 679–689 (2024). https://doi.org/10.1038/s41586-024-08002-x) 的 Fig.1c</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">原图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRUQfHEZgIibxxLFWjMibnWyAKCUDu6d4cmfJjSKibZDZaJO1FYUwU2TlGA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8905817174515236" data-type="png" data-w="722" data-imgfileid="100001402" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRUQfHEZgIibxxLFWjMibnWyAKCUDu6d4cmfJjSKibZDZaJO1FYUwU2TlGA/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf="">这个图展示了妊娠早期 vs 晚期的细胞丰度变化：</span></p><ul><li><section><span leaf="">红色：显著富集于妊娠早期（Early gestation）</span></section></li><li><section><span leaf="">蓝色：显著富集于妊娠晚期（Late gestation）</span></section></li></ul><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现图</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRYRuiaPictYOeibFtw8JkicX3css9cOkHgdHibNicibqDWEiaibxWYyXeib3LRcRQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8947368421052632" data-type="png" data-w="722" data-imgfileid="100001403" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRYRuiaPictYOeibFtw8JkicX3css9cOkHgdHibNicibqDWEiaibxWYyXeib3LRcRQ/640?wx_fmt=png&amp;from=appmsg"></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载包，读入数据</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span leaf=""><span># 加载必要的包</span></span></code><code><span leaf="">library(tidyverse)</span></code><code><span leaf="">library(readxl)</span></code><code><span leaf="">library(ggbeeswarm)</span></code><code><span leaf="">library(grid)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 读入数据</span></span></code><code><span leaf=""><span>df</span> &lt;- read_excel(<span>"data.xlsx"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义细胞类型的顺序</span></span></code><code><span leaf="">cell_types &lt;- c(<span>"Neural cell"</span>, <span>"Megakaryocyte"</span>, <span>"FIbroblast"</span>, <span>"Macrophage"</span>, </span></code><code><span leaf="">                <span>"Neutophil"</span>, <span>"Haem progenitor"</span>, <span>"DC"</span>, <span>"Melanocyte"</span>,</span></code><code><span leaf="">                <span>"ILC"</span>, <span>"Skeletal muscle"</span>, <span>"Mural cell"</span>, <span>"Vascular endothelium"</span>,</span></code><code><span leaf="">                <span>"Monocyte"</span>, <span>"Schwann cell"</span>, <span>"Adipocyte"</span>, <span>"Mast cell"</span>, <span>"Erythroid"</span>,</span></code><code><span leaf="">                <span>"Lymphatic endothelium"</span>, <span>"Keratinocyte"</span>, <span>"T cell"</span>, <span>"B cell"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义颜色</span></span></code><code><span leaf="">color &lt;- c(<span>"#d7b5bb"</span>,<span>"#b7bace"</span>,<span>"#c7e2df"</span>,<span>"#079e39"</span>,<span>"#ea7389"</span>,<span>"#adb5da"</span>,<span>"#f3ad85"</span>,</span></code><code><span leaf="">           <span>"#eb8701"</span>,<span>"#446aad"</span>,<span>"#e22b69"</span>,<span>"#74b985"</span>,<span>"#b7d7c0"</span>,<span>"#7a82b4"</span>,<span>"#81c5c5"</span>,</span></code><code><span leaf="">           <span>"#c57180"</span>,<span>"#004892"</span>,<span>"#7e8ec5"</span>,<span>"#9c1543"</span>,<span>"#eccdc1"</span>,<span>"#eda4b0"</span>,<span>"#00aba7"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 确保因子顺序正确</span></span></code><code><span leaf=""><span>df</span><span>$cell_type</span> &lt;- <span>factor</span>(<span>df</span><span>$cell_type</span>, levels = rev(cell_types))</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">读入数据，定义好不同类型细胞的展示顺序。</span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">此绘图数据为模拟数据，无实际意义，如需可以自助获取。</span></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图</span></span></h2><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>ggplot</span>(df, aes(y = cell_type, x = logFC, color = logFC)) +</span></code><code><span leaf="">  <span>geom_quasirandom</span>(alpha = <span>1</span>, size = <span>0</span>.<span>1</span>) +</span></code><code><span leaf="">  <span>geom_vline</span>(xintercept = <span>0</span>, linetype = <span>"dashed"</span>, color = <span>"gray50"</span>, linewidth = <span>0</span>.<span>3</span>) +</span></code><code><span leaf="">  <span>scale_color_gradient2</span>() +</span></code><code><span leaf="">  <span>scale_x_continuous</span>(limits = c(-<span>1</span>.<span>1</span>, <span>1</span>.<span>1</span>), expand = c(<span>0</span>, <span>0</span>), breaks = c(-<span>1</span>, <span>0</span>, <span>1</span>)) +</span></code><code><span leaf="">  <span>labs</span>(x = <span>"log(fold change)"</span>, y = NULL)+</span></code><code><span leaf="">  <span>theme_classic</span>()</span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRCBfYdEazDKmEB7E24KMwfSvCHlJSXH5Aib6ibE5IFrsTabhThAuZcT0Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8703703703703703" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001406" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xRCBfYdEazDKmEB7E24KMwfSvCHlJSXH5Aib6ibE5IFrsTabhThAuZcT0Q/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">添加色块及箭头注释</span></span></h2><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xR6V1YvwnsbLZW3VYoQ2ajlJrAgwJsdCbzQ8rN8ibDic5YY9HPVWo8lkFw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8740740740740741" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001405" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKKePuKVCyRdUJqOaPibaA1xR6V1YvwnsbLZW3VYoQ2ajlJrAgwJsdCbzQ8rN8ibDic5YY9HPVWo8lkFw/640?wx_fmt=png&amp;from=appmsg"></section><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">获取以 RProject 形式保存的</span></span><strong><span leaf=""><span textstyle="">绘图代码+注释+数据模板</span></span></strong><span leaf=""><span textstyle="">，后台回复关键词: </span></span><strong><em><span leaf=""><span textstyle="">250619_logFC_beeswarm</span></span></em></strong></p></section><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><section nodeleaf=""><mp-common-cpsad data-pluginname="mpcps" data-templateid="list" data-cpsversion="v120" data-goodssouce="1" data-traceid="8f1e4bcf-5451-4c60-9818-99935126a053" data-pid="101_14835066"></mp-common-cpsad></section><p data-tool="mdnice编辑器"><span leaf=""><br></span></p></section><section nodeleaf=""><mp-common-cpsad data-pluginname="mpcps" data-templateid="list" data-cpsversion="v120" data-goodssouce="1" data-traceid="8f1e4bcf-5451-4c60-9818-99935126a053" data-pid="101_14324026"></mp-common-cpsad></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/5tsdXXahgEDeuvKA6C0SBA",target="_blank" rel="noopener noreferrer">原文链接</a>
