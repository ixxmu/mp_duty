---
title: "UCSCXena 数据库"
date: 2025-06-02T14:45:41Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
UCSCXena 数据库 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf="">有这么一个数据库把多种的数据都整合在了一起，并且进行了相应的整合。那就是：UCSC Xena： https://xena.ucsc.edu/</span></p><p data-tool="mdnice编辑器"><span leaf="">提到 UCSC Xena 数据库，就必须先说一下 TCGA 数据和 GTEx 数据。TCGA 收录了大量的癌症数据，但正常样本很少，有些组织甚至一个样本都没有。但是 GTEx 数据弥补了这一点，包含约来自 1000 名健康成年个体 54 个非病变组织部位的全基因信息。但是一个个数据库去下载太麻烦，USCS Xena 数据库就整合了多个数据库，其中就包括这两个数据。</span></p><p data-tool="mdnice编辑器"><span leaf="">官网也贴心的给了介绍。</span></p><p data-tool="mdnice编辑器"><span leaf="">https://ucsc-xena.gitbook.io/project</span></p><p data-tool="mdnice编辑器"><span leaf="">最好的教程是官网，我觉得这个网站的帮助页面（https://ucsc-xena.gitbook.io/project）是我看到的最清晰的。完全不用我再画蛇添足。我只简单说一下数据结构吧。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">数据集</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">截至目前，UCSC Xena 数据库有 256 个 队列，2315 个数据集。这些数据来组于不同的数据中心和平台。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicmPUnrJQOj4vCzBBHaZiaibg4xDroj62OxusVZM5rQLldzcpqXZvrOM0fuEl55rdmI5yX3y5yibVwjg/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.3064066852367688" data-type="png" data-w="359" data-imgfileid="100051177" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicmPUnrJQOj4vCzBBHaZiaibg4xDroj62OxusVZM5rQLldzcpqXZvrOM0fuEl55rdmI5yX3y5yibVwjg/640?wx_fmt=png&amp;from=appmsg"></span></figure><ol><li><section><strong><font><span leaf="">Active Data Hubs</span></font></strong><font><span leaf="">: 这是一个总称，指的是当前可用的数据中心或平台。</span></font></section></li><li><section><strong><font><span leaf="">My computer hub</span></font></strong><font><span leaf="">: 这是一个本地数据中心，通常用于存储和管理用户在自己计算机上的数据。</span></font></section></li><li><section><strong><font><span leaf="">UCSC Public Hub</span></font></strong><font><span leaf="">: 由加州大学圣克鲁兹分校提供的公共数据中心，提供各种基因组数据集。</span></font></section></li><li><section><strong><font><span leaf="">TCGA Hub</span></font></strong><font><span leaf="">: 代表癌症基因组图谱（The Cancer Genome Atlas）项目的数据，包含大量癌症基因组数据。</span></font></section></li><li><section><strong><font><span leaf="">Pan-Cancer Atlas Hub</span></font></strong><font><span leaf="">: 提供跨多种癌症类型的综合基因组数据分析。</span></font></section></li><li><section><strong><font><span leaf="">ICGC Hub</span></font></strong><font><span leaf="">: 国际癌症基因组联盟（International Cancer Genome Consortium）的数据中心，提供全球范围内的癌症基因组数据。</span></font></section></li><li><section><strong><font><span leaf="">PCAWG Hub</span></font></strong><font><span leaf="">: 泛癌分析工作组（Pan-Cancer Analysis of Whole Genomes）的数据中心，专注于全基因组的癌症分析。</span></font></section></li><li><section><strong><font><span leaf="">UCSC Toil RNA-seq Recompute</span></font></strong><font><span leaf="">: 提供使用UCSC Toil平台重新计算的RNA-seq数据。</span></font></section></li><li><section><strong><font><span leaf="">Treehouse Hub</span></font></strong><font><span leaf="">: 专注于儿童癌症的基因组数据分析平台。</span></font></section></li><li><section><strong><font><span leaf="">GDC Hub</span></font></strong><font><span leaf="">: 癌症基因组数据共享中心（Genomic Data Commons）的数据中心，提供癌症相关的基因组数据。</span></font></section></li><li><section><strong><font><span leaf="">ATAC-seq Hub</span></font></strong><font><span leaf="">: 提供ATAC-seq数据，这是一种用于分析染色质可及性的技术。</span></font></section></li><li><section><strong><font><span leaf="">Kids First Hub</span></font></strong><font><span leaf="">: 专注于儿童健康和疾病的基因组数据中心。</span></font></section></li><li><section><strong><font><span leaf="">Jupyter Notebook</span></font></strong><font><span leaf="">: 一种交互式计算环境，常用于数据分析和可视化。</span></font></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">比如我想下载 GTEX 的数据：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicmPUnrJQOj4vCzBBHaZiaibgSHet9horGsFdsyqHo1Q5Jc73Ah6FsrmLSWa6LXfjp9VLd9Kpj0dsFw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.41388888888888886" data-type="png" data-w="1080" data-imgfileid="100051180" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicmPUnrJQOj4vCzBBHaZiaibgSHet9horGsFdsyqHo1Q5Jc73Ah6FsrmLSWa6LXfjp9VLd9Kpj0dsFw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">接着我们看 TPM 表达</span><code><span leaf=""><br></span></code></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicmPUnrJQOj4vCzBBHaZiaibgmoaL92GgIjmP22NCvwGLN7BBlOuyLmFia7z442WLw4AAv4codXOMsHw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.38425925925925924" data-type="png" data-w="1080" data-imgfileid="100051179" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicmPUnrJQOj4vCzBBHaZiaibgmoaL92GgIjmP22NCvwGLN7BBlOuyLmFia7z442WLw4AAv4codXOMsHw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">有数据的下载链接可以自己下载。直接在网页下载也很方便的。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">UCSCXenaTools 基本使用</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">UCSCXenaTools 是一个 R 包，可以在 R 中直接下载 UCSCXena 数据。主要 包含 generate 、 filter 、 query 、 download 和 prepare 五个步骤，分别由 XenaGenerate 、 XenaFilter 、 XenaQuery 、 XenaDownload 和 XenaPrepare 函数实现。</span></p><p data-tool="mdnice编辑器"><span leaf="">比如下载 GTEX 数据：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(tidyverse)  </span><span><span leaf=""># 加载 tidyverse 包，用于数据处理</span></span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(UCSCXenaTools)  </span><span><span leaf=""># 加载 UCSCXenaTools 包，用于访问 UCSC Xena 数据集</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">data(XenaData)  </span><span><span leaf=""># 加载内置的 XenaData 数据集</span></span><span leaf=""><br></span><span leaf="">head(XenaData)  </span><span><span leaf=""># 查看 XenaData 数据集的前几行</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">xe &lt;- XenaData %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(XenaCohorts == </span><span><span leaf="">"GTEX"</span></span><span leaf="">)  </span><span><span leaf=""># 筛选出 GTEX 队列的数据集</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">cli &lt;- XenaGenerate(xe) %&gt;%  </span><span><span leaf=""># 生成 XenaHub 对象</span></span><span leaf=""><br></span><span leaf="">  XenaFilter(filterDatasets = </span><span><span leaf="">"GTEX_phenotype"</span></span><span leaf="">) %&gt;%  </span><span><span leaf=""># 过滤出 GTEX 表型数据集</span></span><span leaf=""><br></span><span leaf="">  XenaQuery() %&gt;%  </span><span><span leaf=""># 查询符合条件的数据集</span></span><span leaf=""><br></span><span leaf="">  XenaDownload(destdir = </span><span><span leaf="">"./"</span></span><span leaf="">) %&gt;%  </span><span><span leaf=""># 下载数据到当前目录</span></span><span leaf=""><br></span><span leaf="">  XenaPrepare()  </span><span><span leaf=""># 准备下载的数据以便在 R 中使用</span></span><span leaf=""><br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">生存分析</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">也可以使用这个包下载 TCGA 表达数据和临床数据，然后进行生存分析。</span></p><p data-tool="mdnice编辑器"><font><span leaf="">比如生存分析，官方提供了完整代码，我这里只做一些实用优化。</span></font><font><span leaf="">https://shixiangwang.github.io/home/en/post/ucscxenatools-201908/</span></font></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载包</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(tidyverse)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(UCSCXenaTools)</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">下载数据</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data(XenaData)  </span><span><span leaf=""># 加载 XenaData 数据集</span></span><span leaf=""><br></span><span leaf="">head(XenaData)  </span><span><span leaf=""># 显示 XenaData 数据集的前几行</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">project &lt;- </span><span><span leaf="">"PAAD"</span></span><span leaf="">  </span><span><span leaf=""># 设置项目变量为 "PAAD 🌟🌟</span></span><span leaf=""><br></span><span leaf="">cohort &lt;- XenaData %&gt;% </span><span leaf=""><br></span><span leaf="">  filter(XenaHostNames == </span><span><span leaf="">"tcgaHub"</span></span><span leaf="">) %&gt;%  </span><span><span leaf=""># 过滤出来自 TCGA Hub 的数据</span></span><span leaf=""><br></span><span leaf="">  XenaScan(project)  </span><span><span leaf=""># 扫描并选择与项目 "PAAD" 相关的队列</span></span><span leaf=""><br></span></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">下载临床数据集</span></span><span></span></h4><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">cli_query &lt;- cohort %&gt;% </span><span leaf=""><br></span><span leaf="">  filter(DataSubtype == </span><span><span leaf="">"phenotype"</span></span><span leaf="">) %&gt;%  </span><span><span leaf=""># 选择临床数据集</span></span><span leaf=""><br></span><span leaf="">  XenaGenerate() %&gt;%  </span><span><span leaf=""># 生成一个 XenaHub 对象</span></span><span leaf=""><br></span><span leaf="">  XenaQuery() %&gt;% </span><span leaf=""><br></span><span leaf="">  XenaDownload()  </span><span><span leaf=""># 下载查询的数据</span></span><span leaf=""><br></span><span leaf="">cli &lt;- XenaPrepare(cli_query)  </span><span><span leaf=""># 准备下载的数据</span></span><span leaf=""><br></span><span leaf="">cli &lt;- cli$PAAD_survival.txt  </span><span><span leaf=""># 提取 PAAD 生存数据集</span></span><span leaf=""><br></span><span leaf="">head(cli)  </span><span><span leaf=""># 显示生存数据集的前几行</span></span><span leaf=""><br></span></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">下载基因表达数据</span></span><span></span></h4><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">SYMBOL &lt;- </span><span><span leaf="">"TP53"</span></span><span leaf="">  </span><span><span leaf=""># 设置基因符号为 "TP53"</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">ge &lt;- cohort %&gt;% </span><span leaf=""><br></span><span leaf="">  filter(DataSubtype == </span><span><span leaf="">"gene expression RNAseq"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">         Label == </span><span><span leaf="">"IlluminaHiSeq"</span></span><span leaf="">)  </span><span><span leaf=""># 选择基因表达 RNAseq 数据集，使用 IlluminaHiSeq 平台</span></span><span leaf=""><br></span><span leaf="">ge</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">gene &lt;- fetch_dense_values(host = ge$XenaHosts, </span><span leaf=""><br></span><span leaf="">                           dataset = ge$XenaDatasets, </span><span leaf=""><br></span><span leaf="">                           identifiers = SYMBOL, </span><span leaf=""><br></span><span leaf="">                           use_probeMap = </span><span><span leaf="">TRUE</span></span><span leaf="">) %&gt;% </span><span leaf=""><br></span><span leaf="">  .[</span><span><span leaf="">1</span></span><span leaf="">, ]  </span><span><span leaf=""># 获取 TP53 基因的表达值，并提取第一行数据</span></span><span leaf=""><br></span><span leaf="">head(gene)  </span><span><span leaf=""># 显示基因表达数据的前几行</span></span><span leaf=""><br></span></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">合并数据与生存信息</span></span><span></span></h4><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">merged_data &lt;- tibble(sample = names(gene), </span><span leaf=""><br></span><span leaf="">                      gene_expression = as.numeric(gene)) %&gt;% </span><span leaf=""><br></span><span leaf="">  left_join(cli, by = </span><span><span leaf="">"sample"</span></span><span leaf="">) %&gt;%  </span><span><span leaf=""># 将基因表达数据与临床数据合并</span></span><span leaf=""><br></span><span leaf="">  filter(substr(sample, </span><span><span leaf="">14</span></span><span leaf="">, </span><span><span leaf="">15</span></span><span leaf="">) == </span><span><span leaf="">"01"</span></span><span leaf="">) %&gt;%  </span><span><span leaf=""># 仅保留 'Primary Tumor' 样本,也可以都保留（算筛选步骤吧）</span></span><span leaf=""><br></span><span leaf="">  dplyr::select(sample, gene_expression, OS.time, OS) %&gt;%  </span><span><span leaf=""># 选择相关列</span></span><span leaf=""><br></span><span leaf="">  rename(time = OS.time, </span><span leaf=""><br></span><span leaf="">         status = OS)  </span><span><span leaf=""># 重命名生存时间和状态列</span></span><span leaf=""><br></span><span leaf="">head(merged_data)  </span><span><span leaf=""># 显示合并数据的前几行</span></span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">生存分析</span></span><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">Cox比例风险模型</span></span><span></span></h4><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">fit &lt;- coxph(Surv(time, status) ~ gene_expression, data = merged_data)  </span><span><span leaf=""># 使用 Cox 比例风险模型拟合基因表达与生存数据</span></span><span leaf=""><br></span><span leaf="">fit  </span><span><span leaf=""># 输出模型结果</span></span><span leaf=""><br></span></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">生存曲线</span></span><span></span></h4><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">merged_data &lt;- merged_data %&gt;% </span><span leaf=""><br></span><span leaf="">  mutate(group = case_when(</span><span leaf=""><br></span><span leaf="">    gene_expression &gt; quantile(gene_expression, </span><span><span leaf="">0.5</span></span><span leaf="">) ~ paste0(SYMBOL, </span><span><span leaf="">"_High"</span></span><span leaf="">),  </span><span><span leaf=""># 基因表达值高于中位数的样本分为 "TP53_High" 组</span></span><span leaf=""><br></span><span leaf="">    gene_expression &lt; quantile(gene_expression, </span><span><span leaf="">0.5</span></span><span leaf="">) ~ paste0(SYMBOL, </span><span><span leaf="">"_Low"</span></span><span leaf="">),   </span><span><span leaf=""># 基因表达值低于中位数的样本分为 "TP53_Low" 组</span></span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">TRUE</span></span><span leaf=""> ~ </span><span><span leaf="">NA_character_</span></span><span leaf=""><br></span><span leaf="">  ))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">fit &lt;- survfit(Surv(time, status) ~ group, data = merged_data)  </span><span><span leaf=""># 使用生存分析拟合分组数据</span></span><span leaf=""><br></span><span leaf="">ggsurvplot(fit, pval = </span><span><span leaf="">TRUE</span></span><span leaf="">)  </span><span><span leaf=""># 绘制生存曲线并显示 p 值</span></span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicmPUnrJQOj4vCzBBHaZiaibgOlwupbV0VgL2Yy30LiaAWTG632SlQAIZI1qRGUaVKvpyFWb1m1kKF7A/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6759259259259259" data-type="png" data-w="1080" data-imgfileid="100051178" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicmPUnrJQOj4vCzBBHaZiaibgOlwupbV0VgL2Yy30LiaAWTG632SlQAIZI1qRGUaVKvpyFWb1m1kKF7A/640?wx_fmt=png&amp;from=appmsg"></span></figure></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/TbCSJB5rgy2MUbSznOg_QA",target="_blank" rel="noopener noreferrer">原文链接</a>
