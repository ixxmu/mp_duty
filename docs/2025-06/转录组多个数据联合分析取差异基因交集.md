---
title: "转录组多个数据联合分析取差异基因交集"
date: 2025-06-15T03:19:50Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
转录组多个数据联合分析取差异基因交集 by 生信星球
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="3 5 []"><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="0 0 []"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-ratio="1" data-type="png" data-w="64" width="20px" data-imgfileid="100013059" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-ratio="1" data-type="png" data-w="64" width="20px" data-imgfileid="100013061" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"></span><span><span leaf=""> 今天是生信星球陪你的</span><span><strong><span leaf="">第1048天</span></strong></span></span><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-ratio="1" data-type="png" data-w="64" width="20px" data-imgfileid="100013060" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png">   </span></section><section><blockquote><section><span><span leaf="">公众号里的文章大多数需要编程基础，如果因为代码看不懂，而跟不上正文的节奏，可以来找我学习，相当于给自己一个新手保护期。</span></span><span><span leaf="">我的课程都是循环开课，</span></span><span><span leaf="">点进去咨询微信，随时可以报名↓</span></span><span leaf=""><br></span></section><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247496614&amp;idx=1&amp;sn=4177354e87d394a022c3d410f482546a&amp;scene=21#wechat_redirect" textvalue="生信分‍析直播课程" data-itemshowtype="11" linktype="text" data-linktype="2">生信分析直播课程</a>(每月初开一期)</span></section><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247497024&amp;idx=2&amp;sn=8c8b240b5df1d3b2c2e29b17f407ee75&amp;scene=21#wechat_redirect" textvalue="生信新手保护学习小组长期报名中" data-itemshowtype="0" linktype="text" data-linktype="2">生信新手保护学习小组长期报名中</a>（每月一期）</span></section><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247497024&amp;idx=1&amp;sn=6bd813f1722c4d6e6ca6eb0b1ce60848&amp;scene=21#wechat_redirect" textvalue="单细胞陪伴学习小组" data-itemshowtype="0" linktype="text" data-linktype="2">单细胞陪伴学习小组</a>（每月一期）</span></section></blockquote></section></section><p data-tool="mdnice编辑器"><span leaf="">表达矩阵文件都下载自GEO数据库中每个GSE数据页面的补充文件里。</span></p><p data-tool="mdnice编辑器"><span leaf="">这里使用的是转录组count数据，校正之后的数据可以用于差异分析。</span></p><p data-tool="mdnice编辑器"><span leaf="">两个数据的实验设计相同，且都应能获取到count数据。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">1.整理第一个数据</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">表达矩阵</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">dat = read.csv(</span><span><span leaf="">"GSE295540_raw_counts_All_samples.csv.gz"</span></span><span leaf="">,row.names = </span><span><span leaf="">1</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">exp1 = as.matrix(round(dat))</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">分组信息</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">colnames(exp1)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">##  [1] "NL1"  "NL2"  "NL3"  "NL4"  "NL5"  "NL6"  "PSO1" "PSO2" "PSO3" "PSO4" "PSO5" "PSO6" "PSO7"</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(stringr)</span><span leaf=""><br></span><span leaf="">Group1 = str_remove_all(colnames(exp1),</span><span><span leaf="">"\\d"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Group1 = factor(Group1,levels = c(</span><span><span leaf="">"NL"</span></span><span leaf="">,</span><span><span leaf="">"PSO"</span></span><span leaf="">))</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">2.整理第二个数据</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">表达矩阵</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">dat2 = read.delim(</span><span><span leaf="">"GSE121212_readcount.txt.gz"</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(stringr)</span><span leaf=""><br></span><span leaf="">q = dat2[str_starts(dat2$X,</span><span><span leaf="">"\\d"</span></span><span leaf="">),]</span><span leaf=""><br></span><span leaf="">q2 = dat2[!str_starts(dat2$X,</span><span><span leaf="">"\\d"</span></span><span leaf="">),]</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">发现基因名称有问题，是因为数据提交者在excel中打开编辑过这个文件，被excel坑了，可以用HGNChelper解决它。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpcDL7pEQx2UBfYOGvzuHZvEIYyQm0YSH1w6BPJzXfzRaOS2Iu5Qt8IkVRlCbvWd0s73HiaenJTMvw/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.62" data-type="png" data-w="300" data-imgfileid="100013378" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpcDL7pEQx2UBfYOGvzuHZvEIYyQm0YSH1w6BPJzXfzRaOS2Iu5Qt8IkVRlCbvWd0s73HiaenJTMvw/640?wx_fmt=png&amp;from=appmsg"></span></figure><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(HGNChelper)</span><span leaf=""><br></span><span leaf="">f1 = checkGeneSymbols(q$X);f1</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">##          x Approved    Suggested.Symbol</span><span leaf=""><br></span><span leaf="">## 1  5S_rRNA    FALSE                &lt;NA&gt;</span><span leaf=""><br></span><span leaf="">## 2      7SK    FALSE               RN7SK</span><span leaf=""><br></span><span leaf="">## 3    1-Dec    FALSE  BHLHE40 /// DELEC1</span><span leaf=""><br></span><span leaf="">## 4    1-Mar    FALSE  MARCHF1 /// MTARC1</span><span leaf=""><br></span><span leaf="">## 5    2-Mar    FALSE  MARCHF2 /// MTARC2</span><span leaf=""><br></span><span leaf="">## 6    1-Mar    FALSE  MARCHF1 /// MTARC1</span><span leaf=""><br></span><span leaf="">## 7   10-Mar    FALSE            MARCHF10</span><span leaf=""><br></span><span leaf="">## 8    2-Mar    FALSE  MARCHF2 /// MTARC2</span><span leaf=""><br></span><span leaf="">## 9    3-Mar    FALSE             MARCHF3</span><span leaf=""><br></span><span leaf="">## 10   4-Mar    FALSE             MARCHF4</span><span leaf=""><br></span><span leaf="">## 11   5-Mar    FALSE             MARCHF5</span><span leaf=""><br></span><span leaf="">## 12   6-Mar    FALSE             MARCHF6</span><span leaf=""><br></span><span leaf="">## 13   7-Mar    FALSE             MARCHF7</span><span leaf=""><br></span><span leaf="">## 14   8-Mar    FALSE             MARCHF8</span><span leaf=""><br></span><span leaf="">## 15   9-Mar    FALSE             MARCHF9</span><span leaf=""><br></span><span leaf="">## 16  15-Sep    FALSE             SELENOF</span><span leaf=""><br></span><span leaf="">## 17   1-Sep    FALSE             SEPTIN1</span><span leaf=""><br></span><span leaf="">## 18  10-Sep    FALSE            SEPTIN10</span><span leaf=""><br></span><span leaf="">## 19  11-Sep    FALSE            SEPTIN11</span><span leaf=""><br></span><span leaf="">## 20   2-Sep    FALSE SEPTIN2 /// SEPTIN6</span><span leaf=""><br></span><span leaf="">## 21   3-Sep    FALSE             SEPTIN3</span><span leaf=""><br></span><span leaf="">## 22   4-Sep    FALSE             SEPTIN4</span><span leaf=""><br></span><span leaf="">## 23   5-Sep    FALSE             SEPTIN5</span><span leaf=""><br></span><span leaf="">## 24   6-Sep    FALSE             SEPTIN6</span><span leaf=""><br></span><span leaf="">## 25   7-Sep    FALSE             SEPTIN7</span><span leaf=""><br></span><span leaf="">## 26   8-Sep    FALSE             SEPTIN8</span><span leaf=""><br></span><span leaf="">## 27   9-Sep    FALSE             SEPTIN9</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">f1$Suggested.Symbol = str_split_i(f1$Suggested.Symbol,</span><span><span leaf="">" /// "</span></span><span leaf="">,i=</span><span><span leaf="">1</span></span><span leaf="">) </span><span><span leaf="">#保留一个基因名即可</span></span><span leaf=""><br></span><span leaf="">f1</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">##          x Approved Suggested.Symbol</span><span leaf=""><br></span><span leaf="">## 1  5S_rRNA    FALSE             &lt;NA&gt;</span><span leaf=""><br></span><span leaf="">## 2      7SK    FALSE            RN7SK</span><span leaf=""><br></span><span leaf="">## 3    1-Dec    FALSE          BHLHE40</span><span leaf=""><br></span><span leaf="">## 4    1-Mar    FALSE          MARCHF1</span><span leaf=""><br></span><span leaf="">## 5    2-Mar    FALSE          MARCHF2</span><span leaf=""><br></span><span leaf="">## 6    1-Mar    FALSE          MARCHF1</span><span leaf=""><br></span><span leaf="">## 7   10-Mar    FALSE         MARCHF10</span><span leaf=""><br></span><span leaf="">## 8    2-Mar    FALSE          MARCHF2</span><span leaf=""><br></span><span leaf="">## 9    3-Mar    FALSE          MARCHF3</span><span leaf=""><br></span><span leaf="">## 10   4-Mar    FALSE          MARCHF4</span><span leaf=""><br></span><span leaf="">## 11   5-Mar    FALSE          MARCHF5</span><span leaf=""><br></span><span leaf="">## 12   6-Mar    FALSE          MARCHF6</span><span leaf=""><br></span><span leaf="">## 13   7-Mar    FALSE          MARCHF7</span><span leaf=""><br></span><span leaf="">## 14   8-Mar    FALSE          MARCHF8</span><span leaf=""><br></span><span leaf="">## 15   9-Mar    FALSE          MARCHF9</span><span leaf=""><br></span><span leaf="">## 16  15-Sep    FALSE          SELENOF</span><span leaf=""><br></span><span leaf="">## 17   1-Sep    FALSE          SEPTIN1</span><span leaf=""><br></span><span leaf="">## 18  10-Sep    FALSE         SEPTIN10</span><span leaf=""><br></span><span leaf="">## 19  11-Sep    FALSE         SEPTIN11</span><span leaf=""><br></span><span leaf="">## 20   2-Sep    FALSE          SEPTIN2</span><span leaf=""><br></span><span leaf="">## 21   3-Sep    FALSE          SEPTIN3</span><span leaf=""><br></span><span leaf="">## 22   4-Sep    FALSE          SEPTIN4</span><span leaf=""><br></span><span leaf="">## 23   5-Sep    FALSE          SEPTIN5</span><span leaf=""><br></span><span leaf="">## 24   6-Sep    FALSE          SEPTIN6</span><span leaf=""><br></span><span leaf="">## 25   7-Sep    FALSE          SEPTIN7</span><span leaf=""><br></span><span leaf="">## 26   8-Sep    FALSE          SEPTIN8</span><span leaf=""><br></span><span leaf="">## 27   9-Sep    FALSE          SEPTIN9</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">#发现第三列的值是NA</span></span><span leaf=""><br></span><span><span leaf="">#改回去，NA的不动</span></span><span leaf=""><br></span><span leaf="">k = !is.na(f1$Suggested.Symbol);table(k)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">## k</span><span leaf=""><br></span><span leaf="">## FALSE  TRUE </span><span leaf=""><br></span><span leaf="">##     1    26</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">q$X[k] = f1$Suggested.Symbol[k]</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">exp2 = rbind(q,q2)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(dplyr)</span><span leaf=""><br></span><span leaf="">exp2 = distinct(exp2,X,.keep_all = </span><span><span leaf="">T</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">exp2 = tibble::column_to_rownames(exp2,</span><span><span leaf="">"X"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">筛选需要的列,为了和另一个数据使用相同的样本，选择健康对照和银屑病病变组织。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">colnames(exp2)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">##   [1] "AD_004_lesional"       "AD_004_non.lesional"   "AD_005_lesional"      </span><span leaf=""><br></span><span leaf="">##   [4] "AD_005_non.lesional"   "AD_006_lesional"       "AD_006_non.lesional"  </span><span leaf=""><br></span><span leaf="">##   [7] "AD_007_lesional"       "AD_007_non.lesional"   "AD_009_lesional"      </span><span leaf=""><br></span><span leaf="">##  [10] "AD_009_non.lesional"   "AD_011_lesional"       "AD_011_non.lesional"  </span><span leaf=""><br></span><span leaf="">##  [13] "AD_014_lesional"       "AD_014_non.lesional"   "AD_016_lesional"      </span><span leaf=""><br></span><span leaf="">##  [16] "AD_016_non.lesional"   "AD_017_lesional"       "AD_017_non.lesional"  </span><span leaf=""><br></span><span leaf="">##  [19] "AD_019_lesional"       "AD_019_non.lesional"   "AD_020_lesional"      </span><span leaf=""><br></span><span leaf="">##  [22] "AD_020_non.lesional"   "AD_021_lesional"       "AD_021_non.lesional"  </span><span leaf=""><br></span><span leaf="">##  [25] "AD_023_lesional"       "AD_023_non.lesional"   "AD_024_lesional"      </span><span leaf=""><br></span><span leaf="">##  [28] "AD_024_non.lesional"   "AD_025_lesional"       "AD_025_non.lesional"  </span><span leaf=""><br></span><span leaf="">##  [31] "AD_026_lesional"       "AD_026_non.lesional"   "AD_027_lesional"      </span><span leaf=""><br></span><span leaf="">##  [34] "AD_027_non.lesional"   "AD_028_lesional"       "AD_028_non.lesional"  </span><span leaf=""><br></span><span leaf="">##  [37] "AD_029_lesional"       "AD_029_non.lesional"   "AD_030_lesional"      </span><span leaf=""><br></span><span leaf="">##  [40] "AD_030_non.lesional"   "AD_031_lesional"       "AD_031_non.lesional"  </span><span leaf=""><br></span><span leaf="">##  [43] "AD_032_non.lesional"   "CTRL_002_healthy"      "CTRL_003_healthy"     </span><span leaf=""><br></span><span leaf="">##  [46] "CTRL_004_healthy"      "CTRL_006_healthy"      "CTRL_008_healthy"     </span><span leaf=""><br></span><span leaf="">##  [49] "CTRL_009_healthy"      "CTRL_010_healthy"      "CTRL_011_healthy"     </span><span leaf=""><br></span><span leaf="">##  [52] "CTRL_013_healthy"      "CTRL_014_healthy"      "CTRL_015_healthy"     </span><span leaf=""><br></span><span leaf="">##  [55] "CTRL_016_healthy"      "CTRL_017_healthy"      "CTRL_018_healthy"     </span><span leaf=""><br></span><span leaf="">##  [58] "CTRL_019_healthy"      "CTRL_020_healthy"      "CTRL_022_healthy"     </span><span leaf=""><br></span><span leaf="">##  [61] "CTRL_024_healthy"      "CTRL_025_healthy"      "CTRL_026_healthy"     </span><span leaf=""><br></span><span leaf="">##  [64] "CTRL_029_healthy"      "CTRL_030_healthy"      "CTRL_031_healthy"     </span><span leaf=""><br></span><span leaf="">##  [67] "CTRL_032_healthy"      "CTRL_033_healthy"      "CTRL_034_healthy"     </span><span leaf=""><br></span><span leaf="">##  [70] "CTRL_035_healthy"      "CTRL_036_healthy"      "CTRL_037_healthy"     </span><span leaf=""><br></span><span leaf="">##  [73] "CTRL_038_healthy"      "CTRL_039_healthy"      "CTRL_040_healthy"     </span><span leaf=""><br></span><span leaf="">##  [76] "CTRL_041_healthy"      "CTRL_042_healthy"      "CTRL_043_healthy"     </span><span leaf=""><br></span><span leaf="">##  [79] "CTRL_044_healthy"      "CTRL_045_healthy"      "CTRL_046_healthy"     </span><span leaf=""><br></span><span leaf="">##  [82] "PSO_001_lesional"      "PSO_001_non.lesional"  "PSO_002_lesional"     </span><span leaf=""><br></span><span leaf="">##  [85] "PSO_002_non.lesional"  "PSO_003_lesional"      "PSO_003_non.lesional" </span><span leaf=""><br></span><span leaf="">##  [88] "PSO_005_lesional"      "PSO_005_non.lesional"  "PSO_006_lesional"     </span><span leaf=""><br></span><span leaf="">##  [91] "PSO_006_non.lesional"  "PSO_007_lesional"      "PSO_007_non.lesional" </span><span leaf=""><br></span><span leaf="">##  [94] "PSO_008_lesional"      "PSO_008_non.lesional"  "PSO_009_lesional"     </span><span leaf=""><br></span><span leaf="">##  [97] "PSO_009_non.lesional"  "PSO_011_lesional"      "PSO_011_non.lesional" </span><span leaf=""><br></span><span leaf="">## [100] "PSO_012_lesional"      "PSO_012_non.lesional"  "PSO_014_lesional"     </span><span leaf=""><br></span><span leaf="">## [103] "PSO_014_non.lesional"  "PSO_015_lesional"      "PSO_015_non.lesional" </span><span leaf=""><br></span><span leaf="">## [106] "PSO_016_lesional"      "PSO_016_non.lesional"  "PSO_017_lesional"     </span><span leaf=""><br></span><span leaf="">## [109] "PSO_017_non.lesional"  "PSO_018_lesional"      "PSO_018_non.lesional" </span><span leaf=""><br></span><span leaf="">## [112] "PSO_020_lesional"      "PSO_020_non.lesional"  "PSO_023_lesional"     </span><span leaf=""><br></span><span leaf="">## [115] "PSO_023_non.lesional"  "PSO_024_lesional"      "PSO_024_non.lesional" </span><span leaf=""><br></span><span leaf="">## [118] "PSO_027_lesional"      "PSO_027_non.lesional"  "PSO_028_lesional"     </span><span leaf=""><br></span><span leaf="">## [121] "PSO_028_non.lesional"  "PSO_029_lesional"      "PSO_029_non.lesional" </span><span leaf=""><br></span><span leaf="">## [124] "PSO_030_lesional"      "PSO_030_non.lesional"  "PSO_031_lesional"     </span><span leaf=""><br></span><span leaf="">## [127] "PSO_031_non.lesional"  "PSO_033_lesional"      "PSO_033_non.lesional" </span><span leaf=""><br></span><span leaf="">## [130] "PSO_034_lesional"      "PSO_035_lesional"      "PSO_035_non.lesional" </span><span leaf=""><br></span><span leaf="">## [133] "PSO_036_lesional"      "PSO_036_non.lesional"  "PSO_037_lesional"     </span><span leaf=""><br></span><span leaf="">## [136] "PSO_037_non.lesional"  "AD_033_non.lesional"   "AD_033_chronic_lesion"</span><span leaf=""><br></span><span leaf="">## [139] "AD_034_non.lesional"   "AD_034_chronic_lesion" "AD_032_chronic_lesion"</span><span leaf=""><br></span><span leaf="">## [142] "AD_035_non.lesional"   "AD_035_chronic_lesion" "AD_036_non.lesional"  </span><span leaf=""><br></span><span leaf="">## [145] "AD_036_chronic_lesion" "AD_037_non.lesional"   "AD_037_chronic_lesion"</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">k1 = str_starts(colnames(exp2),</span><span><span leaf="">"CTRL"</span></span><span leaf="">);table(k1)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">## k1</span><span leaf=""><br></span><span leaf="">## FALSE  TRUE </span><span leaf=""><br></span><span leaf="">##   109    38</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">k2 = str_starts(colnames(exp2),</span><span><span leaf="">"PSO"</span></span><span leaf="">) &amp; !str_detect(colnames(exp2),</span><span><span leaf="">"non"</span></span><span leaf="">);table(k2)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">## k2</span><span leaf=""><br></span><span leaf="">## FALSE  TRUE </span><span leaf=""><br></span><span leaf="">##   119    28</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">exp2 = exp2[,k1|k2];ncol(exp2)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">## [1] 66</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">分组信息</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Group2 = str_split_i(colnames(exp2),</span><span><span leaf="">"_"</span></span><span leaf="">,</span><span><span leaf="">1</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Group2 = factor(Group2,levels = c(</span><span><span leaf="">"CTRL"</span></span><span leaf="">,</span><span><span leaf="">"PSO"</span></span><span leaf="">))</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.写个函数获取差异基因</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">这个函数的目的是提供表达矩阵和分组信息就直接得到差异分析结果，省掉两次或多次运行大段、一样的代码。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">diff =  </span><span><span leaf="">function</span></span><span leaf="">(exp,Group,logFC_t=</span><span><span leaf="">2</span></span><span leaf="">,p_t=</span><span><span leaf="">0.05</span></span><span leaf="">){</span><span leaf=""><br></span><span leaf="">  coldata = data.frame(row.names = colnames(exp),</span><span leaf=""><br></span><span leaf="">                     condition = Group)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(DESeq2)</span><span leaf=""><br></span><span leaf="">  dds &lt;- DESeqDataSetFromMatrix(</span><span leaf=""><br></span><span leaf="">    countData = exp,</span><span leaf=""><br></span><span leaf="">    colData = coldata,</span><span leaf=""><br></span><span leaf="">    design= ~ condition)</span><span leaf=""><br></span><span leaf="">  dds &lt;- DESeq(dds)</span><span leaf=""><br></span><span leaf="">  res = results(dds, contrast = c(</span><span><span leaf="">"condition"</span></span><span leaf="">,rev(levels(Group))))</span><span leaf=""><br></span><span leaf="">  deg = as.data.frame(res)</span><span leaf=""><br></span><span leaf="">  deg = na.omit(deg)</span><span leaf=""><br></span><span leaf="">  k1 = (deg$padj &lt; p_t)&amp;(deg$log2FoldChange &lt; -logFC_t)</span><span leaf=""><br></span><span leaf="">  k2 = (deg$padj &lt; p_t)&amp;(deg$log2FoldChange &gt; logFC_t)</span><span leaf=""><br></span><span leaf="">  deg = mutate(deg,change = ifelse(k1,</span><span><span leaf="">"DOWN"</span></span><span leaf="">,ifelse(k2,</span><span><span leaf="">"UP"</span></span><span leaf="">,</span><span><span leaf="">"NOT"</span></span><span leaf="">)))</span><span leaf=""><br></span><span leaf="">}</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">4.分别差异分析，取交集</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">deg1 = diff(exp1,Group1)</span><span leaf=""><br></span><span leaf="">deg2 = diff(exp2,Group2)</span><span leaf=""><br></span><span leaf="">cg1 = rownames(deg1)[deg1$change != </span><span><span leaf="">"NOT"</span></span><span leaf="">];length(cg1)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">## [1] 841</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">cg2 = rownames(deg2)[deg2$change != </span><span><span leaf="">"NOT"</span></span><span leaf="">];length(cg2)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">## [1] 2315</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">g = intersect(cg1,cg2);length(g)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">## [1] 465</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">5.差异分析结果的可视化</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">画火山图</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(tinyarray)</span><span leaf=""><br></span><span leaf="">v1 = draw_volcano(deg1,pkg = </span><span><span leaf="">1</span></span><span leaf="">,logFC_cutoff = </span><span><span leaf="">2</span></span><span leaf="">,adjust = </span><span><span leaf="">T</span></span><span leaf="">,symmetry = </span><span><span leaf="">T</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">v2 = draw_volcano(deg2,pkg = </span><span><span leaf="">1</span></span><span leaf="">,logFC_cutoff = </span><span><span leaf="">2</span></span><span leaf="">,adjust = </span><span><span leaf="">T</span></span><span leaf="">,symmetry = </span><span><span leaf="">T</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">画热图</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">dat1 = log2(edgeR::cpm(exp1)+</span><span><span leaf="">1</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">dat2 = log2(edgeR::cpm(exp2)+</span><span><span leaf="">1</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">h1 = draw_heatmap(dat1[g,],Group1,cluster_cols = </span><span><span leaf="">F</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">h2 = draw_heatmap(dat2[g,],Group2,cluster_cols = </span><span><span leaf="">F</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">v1+v2+h1+h2</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpcDL7pEQx2UBfYOGvzuHZvRMiaCnvaA78nPSNOAicngjHxB0rPJ65N1GwLGZbLpublra5QEuym8GAQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="1" data-type="png" data-w="504" data-imgfileid="100013380" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpcDL7pEQx2UBfYOGvzuHZvRMiaCnvaA78nPSNOAicngjHxB0rPJ65N1GwLGZbLpublra5QEuym8GAQ/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf="">画pca图</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pca.plot1 = draw_pca(dat1,Group1)</span><span leaf=""><br></span><span leaf="">pca.plot2 = draw_pca(dat2,Group2)</span><span leaf=""><br></span><span leaf="">pca.plot1 + pca.plot2</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpcDL7pEQx2UBfYOGvzuHZvFwBsTWuiao3BEdXS5OMeSY4BCWjNBkicAVficwibiaRlicvGwkllC8zK8BDg/640?wx_fmt=png&amp;from=appmsg" data-ratio="1" data-type="png" data-w="504" data-imgfileid="100013379" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpcDL7pEQx2UBfYOGvzuHZvFwBsTWuiao3BEdXS5OMeSY4BCWjNBkicAVficwibiaRlicvGwkllC8zK8BDg/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf="">画venn图</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">gs = list(cg1 = cg1,cg2 = cg2)</span><span leaf=""><br></span><span leaf="">draw_venn(gs,</span><span><span leaf="">""</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpcDL7pEQx2UBfYOGvzuHZvdPE0vhdBfqblkjj5QXU99Hs6icktUibmmuUqp10y6RHQVAD3U8BicV2YA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5135135135135135" data-type="png" data-w="1406" data-imgfileid="100013381" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpcDL7pEQx2UBfYOGvzuHZvdPE0vhdBfqblkjj5QXU99Hs6icktUibmmuUqp10y6RHQVAD3U8BicV2YA/640?wx_fmt=png&amp;from=appmsg"></span></figure></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/5RnsVgHSm-gfqaWlyddTcw",target="_blank" rel="noopener noreferrer">原文链接</a>
