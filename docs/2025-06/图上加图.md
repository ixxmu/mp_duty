---
title: "图上加图"
date: 2025-06-15T14:26:19Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
图上加图 by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-from="0" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-id="MzkyMTI1MTYxNA==" data-is_biz_ban="0" data-service_type="1" data-verify_status="1"></mp-common-profile></section><section nodeleaf=""><mp-common-clmusic data-pluginname="insertaudio" type="1" music_name="心爱" albumurl="http://wx.y.gtimg.cn/music/photo_new/T002R500x500M000004Iy2Rz2Zzz0q_2.jpg" singer="金学峰" count="0" is_vip="0" duration="299000" music_source="1" listenid="78221634005914624"></mp-common-clmusic></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">引言</span></span><span></span></h2><blockquote><span></span><p><span leaf="">分享一下 </span><strong><span leaf="">cowplot</span></strong><span leaf=""> R 包的其中在图上绘制图形的功能。</span></p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">安装</span></span><span></span></h2><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">install.packages(</span><span><span leaf="">"cowplot"</span></span><span leaf="">)</span><br><br><span leaf="">remotes::install_github(</span><span><span leaf="">"wilkelab/cowplot"</span></span><span leaf="">)</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">示例</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">绘制基础图形：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><br><span><span leaf="">library</span></span><span leaf="">(cowplot)</span><br><br><span leaf="">p &lt;- ggplot(mpg, aes(displ, cty)) +</span><br><span leaf="">  geom_point() +</span><br><span leaf="">  theme_minimal_grid(</span><span><span leaf="">12</span></span><span leaf="">)</span><br><br><span leaf="">p</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><p data-tool="mdnice编辑器"><span leaf="">添加文字于上层：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">ggdraw(p) +</span><br><span leaf="">  draw_label(</span><span><span leaf="">"Draft"</span></span><span leaf="">, color = </span><span><span leaf="">"#C0A0A0"</span></span><span leaf="">, size = </span><span><span leaf="">100</span></span><span leaf="">, angle = </span><span><span leaf="">45</span></span><span leaf="">)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><p data-tool="mdnice编辑器"><span leaf="">使用图层添加：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">ggdraw(p) +</span><br><span leaf="">  geom_text(</span><br><span leaf="">    data = data.frame(x = </span><span><span leaf="">0.5</span></span><span leaf="">, y = </span><span><span leaf="">0.5</span></span><span leaf="">, label = </span><span><span leaf="">"Draft"</span></span><span leaf="">),</span><br><span leaf="">    aes(x, y, label = label),</span><br><span leaf="">    hjust = </span><span><span leaf="">0.5</span></span><span leaf="">, vjust = </span><span><span leaf="">0.5</span></span><span leaf="">, angle = </span><span><span leaf="">45</span></span><span leaf="">, size = </span><span><span leaf="">100</span></span><span leaf="">/.pt,</span><br><span leaf="">    color = </span><span><span leaf="">"#C0A0A0"</span></span><span leaf="">,</span><br><span leaf="">    inherit.aes = </span><span><span leaf="">FALSE</span></span><br><span leaf="">  )</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><p data-tool="mdnice编辑器"><span leaf="">修改背景：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">ggdraw(p) +</span><br><span leaf="">  draw_label(</span><span><span leaf="">"Draft"</span></span><span leaf="">, color = </span><span><span leaf="">"#C0A0A0"</span></span><span leaf="">, size = </span><span><span leaf="">100</span></span><span leaf="">, angle = </span><span><span leaf="">45</span></span><span leaf="">) +</span><br><span leaf="">  theme(</span><br><span leaf="">    plot.background = element_rect(fill = </span><span><span leaf="">"cornsilk"</span></span><span leaf="">, color = </span><span><span leaf="">NA</span></span><span leaf="">)</span><br><span leaf="">  )</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><p data-tool="mdnice编辑器"><span leaf="">根据顺序绘制在底层：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">ggdraw() +</span><br><span leaf="">  draw_label(</span><span><span leaf="">"Draft"</span></span><span leaf="">, color = </span><span><span leaf="">"#C0A0A0"</span></span><span leaf="">, size = </span><span><span leaf="">100</span></span><span leaf="">, angle = </span><span><span leaf="">45</span></span><span leaf="">) +</span><br><span leaf="">  draw_plot(p)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><p data-tool="mdnice编辑器"><span leaf="">插入图形：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">inset &lt;- ggplot(mpg, aes(drv)) +</span><br><span leaf="">  geom_bar(fill = </span><span><span leaf="">"skyblue2"</span></span><span leaf="">, alpha = </span><span><span leaf="">0.7</span></span><span leaf="">) +</span><br><span leaf="">  scale_y_continuous(expand = expansion(mult = c(</span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">0.05</span></span><span leaf="">))) +</span><br><span leaf="">  theme_minimal_hgrid(</span><span><span leaf="">11</span></span><span leaf="">)</span><br><br><span leaf="">ggdraw(p + theme_half_open(</span><span><span leaf="">12</span></span><span leaf="">)) +</span><br><span leaf="">  draw_plot(inset, </span><span><span leaf="">.45</span></span><span leaf="">, </span><span><span leaf="">.45</span></span><span leaf="">, </span><span><span leaf="">.5</span></span><span leaf="">, </span><span><span leaf="">.5</span></span><span leaf="">) +</span><br><span leaf="">  draw_plot_label(</span><br><span leaf="">    c(</span><span><span leaf="">"A"</span></span><span leaf="">, </span><span><span leaf="">"B"</span></span><span leaf="">),</span><br><span leaf="">    c(</span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">0.45</span></span><span leaf="">),</span><br><span leaf="">    c(</span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">0.95</span></span><span leaf="">),</span><br><span leaf="">    size = </span><span><span leaf="">12</span></span><br><span leaf="">  )</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><p data-tool="mdnice编辑器"><span leaf="">基础图形也适用：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">inset &lt;- ~{</span><br><span leaf="">  counts &lt;- table(mpg$drv)</span><br><span leaf="">  par(</span><br><span leaf="">    cex = </span><span><span leaf="">0.8</span></span><span leaf="">,</span><br><span leaf="">    mar = c(</span><span><span leaf="">3</span></span><span leaf="">, </span><span><span leaf="">3</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">),</span><br><span leaf="">    mgp = c(</span><span><span leaf="">2</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">0</span></span><span leaf="">)</span><br><span leaf="">  )</span><br><span leaf="">  barplot(counts, xlab = </span><span><span leaf="">"drv"</span></span><span leaf="">, ylab = </span><span><span leaf="">"count"</span></span><span leaf="">)</span><br><span leaf="">}</span><br><br><span leaf="">ggdraw(p + theme_half_open(</span><span><span leaf="">12</span></span><span leaf="">)) +</span><br><span leaf="">  draw_plot(inset, </span><span><span leaf="">.45</span></span><span leaf="">, </span><span><span leaf="">.45</span></span><span leaf="">, </span><span><span leaf="">.5</span></span><span leaf="">, </span><span><span leaf="">.5</span></span><span leaf="">) +</span><br><span leaf="">  draw_plot_label(</span><br><span leaf="">    c(</span><span><span leaf="">"A"</span></span><span leaf="">, </span><span><span leaf="">"B"</span></span><span leaf="">),</span><br><span leaf="">    c(</span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">0.45</span></span><span leaf="">),</span><br><span leaf="">    c(</span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">0.95</span></span><span leaf="">),</span><br><span leaf="">    size = </span><span><span leaf="">12</span></span><br><span leaf="">  )</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><p data-tool="mdnice编辑器"><span leaf="">添加图片作为背景：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(magick)</span><br><span><span leaf="">library</span></span><span leaf="">(dplyr)</span><br><span><span leaf="">library</span></span><span leaf="">(forcats)</span><br><br><span leaf="">img &lt;- system.file(</span><span><span leaf="">"extdata"</span></span><span leaf="">, </span><span><span leaf="">"cow.jpg"</span></span><span leaf="">, package = </span><span><span leaf="">"cowplot"</span></span><span leaf="">) %&gt;%</span><br><span leaf="">  image_read() %&gt;%</span><br><span leaf="">  image_resize(</span><span><span leaf="">"570x380"</span></span><span leaf="">) %&gt;%</span><br><span leaf="">  image_colorize(</span><span><span leaf="">35</span></span><span leaf="">, </span><span><span leaf="">"white"</span></span><span leaf="">)</span><br><br><span leaf="">p &lt;- PASWR::Cows %&gt;%</span><br><span leaf="">  filter(breed != </span><span><span leaf="">"Canadian"</span></span><span leaf="">) %&gt;%</span><br><span leaf="">  mutate(breed = fct_reorder(breed, butterfat)) %&gt;%</span><br><span leaf="">  ggplot(aes(butterfat, fill = breed)) +</span><br><span leaf="">  geom_density(alpha = </span><span><span leaf="">0.7</span></span><span leaf="">) +</span><br><span leaf="">  scale_fill_grey() +</span><br><span leaf="">  coord_cartesian(expand = </span><span><span leaf="">FALSE</span></span><span leaf="">) +</span><br><span leaf="">  theme_minimal_hgrid(</span><span><span leaf="">11</span></span><span leaf="">, color = </span><span><span leaf="">"grey30"</span></span><span leaf="">)</span><br><br><span leaf="">ggdraw() +</span><br><span leaf="">  draw_image(img) +</span><br><span leaf="">  draw_plot(p)</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><p data-tool="mdnice编辑器"><span leaf="">添加 logo：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">logo_file &lt;- system.file(</span><span><span leaf="">"extdata"</span></span><span leaf="">, </span><span><span leaf="">"logo.png"</span></span><span leaf="">, package = </span><span><span leaf="">"cowplot"</span></span><span leaf="">)</span><br><br><span leaf="">ggdraw() +</span><br><span leaf="">  draw_plot(p) +</span><br><span leaf="">  draw_image(</span><br><span leaf="">    logo_file, x = </span><span><span leaf="">1</span></span><span leaf="">, y = </span><span><span leaf="">1</span></span><span leaf="">, hjust = </span><span><span leaf="">1</span></span><span leaf="">, vjust = </span><span><span leaf="">1</span></span><span leaf="">, halign = </span><span><span leaf="">1</span></span><span leaf="">, valign = </span><span><span leaf="">1</span></span><span leaf="">,</span><br><span leaf="">    width = </span><span><span leaf="">0.15</span></span><br><span leaf="">  )</span><br></code></pre><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">结尾</span></span><span></span></h2><blockquote><span></span><p><strong><span leaf="">路漫漫其修远兮,吾将上下而求索。</span></strong></p></blockquote><hr><p data-tool="mdnice编辑器"><span leaf="">欢迎加入生信交流群。加我微信我也拉你进 </span><strong><span leaf="">微信群聊</span></strong><strong><span leaf="">老俊俊生信交流群</span></strong><strong><span leaf="">(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</span></strong><span leaf=""> 。</span></p><figure data-tool="mdnice编辑器"><span leaf=""></span></figure><hr><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong><span leaf=""> 往期回顾目录 </span></strong></center><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><blockquote><span></span><ul><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518838&amp;idx=1&amp;sn=be64bfbc98c1ae642caa33325a5da271&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">FunFEA：一种用于真菌功能富集分析的 R 包</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518815&amp;idx=1&amp;sn=0cf0144a650120a03143d443d7737be5&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">Nature 复现酶切位点偏好性检测</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518804&amp;idx=1&amp;sn=6a409918dc62c53eff0683ab389aadcc&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">Cell 文献复现累积分布曲线</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518756&amp;idx=1&amp;sn=d72ecacaa49f55c9d1414aac4807a389&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">ggtreebar 绘制条形树图</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518742&amp;idx=1&amp;sn=08d2a845f564a7af26c18195b40283e1&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">deepWki：用 AI 迅速掌握 Github 开源代码库结构</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518727&amp;idx=1&amp;sn=7f3731774a8b6bc59db45975209601d4&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">R 语言 S3 系统</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518708&amp;idx=1&amp;sn=e0350434ff7b0141c89c812b4f50a9f9&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">gghexsize：绘制六边形热图</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518688&amp;idx=1&amp;sn=c7e121e8fb326224c0df652541f28898&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">mlr3 数据和基本建模</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518551&amp;idx=1&amp;sn=680d416f8fa1d9216207478b5248ba00&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">《使用 mlr3 在 R 中进行应用机器学习》</a></span></left></strong></section></li><li><section><strong><left><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247518534&amp;idx=1&amp;sn=ffb7614a85bb13de036ded06fb37e823&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">分位数秩得分 (QRscore)鉴定差异变化基因</a></span></left></strong></section></li></ul></blockquote></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/9Ps5F_zjwQtkfg2CNn-P4A",target="_blank" rel="noopener noreferrer">原文链接</a>
