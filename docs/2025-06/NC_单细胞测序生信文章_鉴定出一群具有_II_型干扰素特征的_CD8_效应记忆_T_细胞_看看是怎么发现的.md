---
title: "NC｜单细胞测序生信文章，鉴定出一群具有 II 型干扰素特征的 CD8⁺效应记忆 T 细胞，看看是怎么发现的"
date: 2025-06-25T01:45:11Z
draft: ["false"]
tags: [
  "fetched",
  "生信钱同学"
]
categories: ["Acdemic"]
---
NC｜单细胞测序生信文章，鉴定出一群具有 II 型干扰素特征的 CD8⁺效应记忆 T 细胞，看看是怎么发现的 by 生信钱同学
------
<div><section nodeleaf="" data-pm-slice="0 0 []"><mp-common-profile data-pluginname="mpprofile" data-nickname="生信钱同学" data-alias="sx_qtx" data-from="2" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFtcpBwtWKuVVVOibic8Mf7DibowIaY4jHoZ0RZUroB06EPAYGCf2SEthicyl7ATbtCRjCWJ7NoHYLG2oQ/0?wx_fmt=png" data-signature="北京大学在读博士生，记录自己的学习日常🌞分享生信知识：如单细胞和空间测序、多组学分析、宏基因组、病理组学、影像组学等生物信息学、机器学习和深度学习内容🌬" data-id="MzkwMzY2NjkwNg==" data-is_biz_ban="0" data-service_type="1" data-verify_status="0"></mp-common-profile></section><section nodeleaf=""><img data-imgfileid="100000054" data-ratio="0.8304597701149425" data-s="300,640" data-src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSDYiclWHXzARYMrQrK37WboobakSHx4iab0Nbv0YzhsyJsR52ZbZD9eWw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="696" type="block" src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSDYiclWHXzARYMrQrK37WboobakSHx4iab0Nbv0YzhsyJsR52ZbZD9eWw/640?wx_fmt=jpeg&amp;from=appmsg"></section><h2 spellcheck="true" placeholder="标题 1" data-content-editable-leaf="true" data-pm-slice="0 0 []"><span data-token-index="0"><span leaf=""><span textstyle="">代码部分👆</span></span></span></h2><h2 spellcheck="true" placeholder="标题 1" data-content-editable-leaf="true" data-pm-slice="0 0 []"><span data-token-index="0"><span leaf=""><span textstyle="">日本研究团队揭示系统性硬化症临床异质性背后的免疫细胞异常</span></span></span></h2><p><span leaf=""><span textstyle="">近日，来自日本大阪大学等机构的研究团队在《自然・通讯》（</span></span><span data-token-index="1"><span leaf=""><span textstyle="">Nature Communications</span></span></span><span leaf=""><span textstyle="">）杂志发表重要研究成果。他们通过单细胞分析，揭示了系统性硬化症（SSc）患者临床异质性背后的免疫细胞异常，为理解该疾病不同器官受累的机制及开发个体化治疗策略提供了思路。</span></span></p><section nodeleaf=""><img data-imgfileid="100000046" data-ratio="0.36574074074074076" data-s="300,640" data-src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSFR6ppyTekjf8fKBHgcRtAstEITnPNTk2K4cTQqaHwCtGDBCvacianMg/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" type="block" src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSFR6ppyTekjf8fKBHgcRtAstEITnPNTk2K4cTQqaHwCtGDBCvacianMg/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span data-token-index="0"><span leaf=""><span textstyle="">研究背景：系统性硬化症的临床挑战</span></span></span></p><p><span data-token-index="0"><span leaf=""><span textstyle="">系统性硬化症是一种复杂的自身免疫性疾病，全球约有 100 万患者。除了典型的雷诺现象和皮肤硬化外，患者常出现多种器官受累，包括间质性肺病（ILD）、指端溃疡，甚至危及生命的硬皮病肾危象（SRC）。</span></span></span><span leaf=""><span textstyle="">这些临床异质性给疾病管理带来巨大挑战，而免疫失调驱动的血管损伤和组织纤维化是其核心病理机制。尽管此前研究已从病变组织角度揭示了部分病理过程，但从单细胞转录组水平理解免疫细胞多样性与症状多样性的关联仍存在空白。</span></span></p><section nodeleaf=""><img data-src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSek4wdDVeFia8S4KooYrCryiaaQ6nicwE4MyQHxnv1c4IYQ6OhRicW5ia4Ng/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="1.0574074074074074" data-s="300,640" data-type="jpeg" data-w="1080" type="block" data-imgfileid="100000047" src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSek4wdDVeFia8S4KooYrCryiaaQ6nicwE4MyQHxnv1c4IYQ6OhRicW5ia4Ng/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span data-token-index="0"><span leaf=""><span textstyle="">研究方法：单细胞技术解析免疫景观</span></span></span></p><p><span leaf=""><span textstyle="">为探索 SSc 患者免疫细胞亚群的变化及其与临床异质性的联系</span></span><span data-token-index="1"><span leaf=""><span textstyle="">，研究团队对 21 名未接受过免疫抑制治疗的 SSc 患者及 6 名健康对照的外周血单个核细胞（PBMC）进行了单细胞 RNA 测序（scRNA-seq）和细胞表位测序（CITE-seq），同时结合空间转录组学分析了 SRC 患者的肾脏组织。该研究共处理了 238,924 个细胞，</span></span></span><span leaf=""><span textstyle="">通过无监督分析和差异丰度分析，鉴定出与特定器官并发症相关的免疫细胞亚群。</span></span></p><section nodeleaf=""><img data-src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJS0rJ9DAqQKnuluFJtCpqNoTUicicXIyqHkCTGQlXX2Vk5EFqDh93Bz53A/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="0.7694444444444445" data-s="300,640" data-type="jpeg" data-w="1080" type="block" data-imgfileid="100000048" src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJS0rJ9DAqQKnuluFJtCpqNoTUicicXIyqHkCTGQlXX2Vk5EFqDh93Bz53A/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span data-token-index="0"><span leaf=""><span textstyle="">关键发现一：硬皮病肾危象中的单核细胞异常</span></span></span></p><p><span data-token-index="0"><span leaf=""><span textstyle="">研究发现，SRC 患者外周血中存在一群特异性富集的 EGR1⁺ CD14⁺单核细胞。这类细胞激活了 NF-κB 信号通路，并可分化为损伤组织的巨噬细胞，在肾脏损伤部位积聚。进一步分析显示，EGR1⁺ CD14⁺单核细胞的比例在 SRC 患者中显著升高，且其表达的 EGR1 基因水平与 SRC 的临床指标（如改良 Rodnan 皮肤评分、收缩压）呈正相关。</span></span></span><span leaf=""><span textstyle="">在疾病进程中，SRC 发作时单核细胞 EGR1 表达显著上调，治疗改善后降低，提示其可能作为 SRC 进展的预测生物标志物。</span></span></p><section nodeleaf=""><img data-imgfileid="100000049" data-ratio="1.0777777777777777" data-s="300,640" data-src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSVe3VGvibVx7EPVthepYmJctlIseyv60VNfNnxA1jAyoyXl7k2tfQhicA/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" type="block" src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSVe3VGvibVx7EPVthepYmJctlIseyv60VNfNnxA1jAyoyXl7k2tfQhicA/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span leaf=""><span textstyle="">空间转录组学分析发现，SRC 患者肾脏组织中 THBS1⁺巨噬细胞与受损的近端小管细胞紧密相邻，这些巨噬细胞高表达与血管损伤和纤维化相关的基因，如 THBS1、IL1B 和 LRG1。轨迹分析表明，外周血中的 EGR1⁺ CD14⁺单核细胞可分化为肾脏中的 THBS1⁺巨噬细胞，通过激活 NF-κB 通路参与肾组织纤维化和损伤。</span></span></p><section nodeleaf=""><img data-src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSpibKfYIc22z17p0oZzKBX1kb4dwY6z6nk0scR1J48O01CtUd1sOm5NA/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="1.15" data-s="300,640" data-type="jpeg" data-w="1080" type="block" data-imgfileid="100000050" src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSpibKfYIc22z17p0oZzKBX1kb4dwY6z6nk0scR1J48O01CtUd1sOm5NA/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span data-token-index="0"><span leaf=""><span textstyle="">关键发现二：间质性肺病中的 T 细胞异常</span></span></span></p><p><span data-token-index="0"><span leaf=""><span textstyle="">对于进展性 ILD 患者，研究团队在其外周血和肺组织中鉴定出一群具有</span></span></span><span data-token-index="1"><span leaf=""><span textstyle=""> II 型干扰素特征的 CD8⁺效应记忆 T 细胞（CD8⁺ TEM_T2ISG）。这类细胞高表达 CXCR3 和 CCR5 等趋化因子受体，提示其通过趋化因子驱动的迁移参与 ILD 进展。</span></span></span><span data-token-index="2"><span leaf=""><span textstyle="">在肺组织中，类似的 CD8⁺ T 细胞亚群（CD8⁺ T_T2ISG）也显著富集，且其基因表达特征与外周血中的 CD8⁺ TEM_T2ISG 高度相似。</span></span></span></p><section nodeleaf=""><img data-imgfileid="100000051" data-ratio="0.8583333333333333" data-s="300,640" data-src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSc3xx3OaFicSIibH0YJYEAOPh4FOnvPDPiaOVWYR0eVqIr2pUTIhoCPYRw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" type="block" src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSc3xx3OaFicSIibH0YJYEAOPh4FOnvPDPiaOVWYR0eVqIr2pUTIhoCPYRw/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span data-token-index="0"><span leaf=""><span textstyle="">进一步研究显示，抗拓扑异构酶 I 抗体（ATA）或抗 RNA 聚合酶 III 抗体（ARA）阳性的 ILD 患者中，CD8⁺ TEM_T2ISG 亚群比例更高，而这类患者的 ILD 进展风险通常更高。这表明 CD8⁺ T 细胞介导的免疫反应可能通过 IFN-γ 相关通路促进肺组织损伤，为理解 ILD 的进展机制提供了新线索。</span></span></span></p><section nodeleaf=""><img data-src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSLCcYibOxNickhvNEBYpuyqj3Of0vs308K1nofVicyYic2VQjWuMCsqpiaQA/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="1.2074074074074075" data-s="300,640" data-type="jpeg" data-w="1080" type="block" data-imgfileid="100000052" src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJSLCcYibOxNickhvNEBYpuyqj3Of0vs308K1nofVicyYic2VQjWuMCsqpiaQA/640?wx_fmt=jpeg&amp;from=appmsg"></section><section nodeleaf=""><img data-src="https://mmecoa.qpic.cn/mmecoa_png/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJS1c7ibERBwxtdrKxXtqq2MkJ2vRRia0WUX6COQf4gzCEcu6uwsdBzw3Vg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.4601851851851852" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100000045" src="https://mmecoa.qpic.cn/mmecoa_png/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJS1c7ibERBwxtdrKxXtqq2MkJ2vRRia0WUX6COQf4gzCEcu6uwsdBzw3Vg/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100000053" data-ratio="0.5518518518518518" data-s="300,640" data-src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJS41o8R3JgicE3wAfWmdN2GxRdvbGaMxzxnDicLR9zt95UxsB9Ao9jNtxw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" type="block" src="https://mmecoa.qpic.cn/mmecoa_jpg/WSicobplxKJmfGUD9wdJKkoEqDPNOtNJS41o8R3JgicE3wAfWmdN2GxRdvbGaMxzxnDicLR9zt95UxsB9Ao9jNtxw/640?wx_fmt=jpeg&amp;from=appmsg"></section><section><code><span leaf=""><br></span></code></section><section data-role="outer" label="Powered by 135editor.com onekey" data-pm-slice="0 0 []"><section><section data-bdopacity="20%"><section data-bdopacity="40%"><section data-bdopacity="60%"><section data-bdopacity="80%"><section data-bgopacity="90%"><p><span leaf=""><span textstyle="">Shimagami, H., Nishimura, K., Matsushita, H. et al. Single-cell analysis reveals immune cell abnormalities underlying the clinical heterogeneity of patients with systemic sclerosis. Nat Commun 16, 4949 (2025).</span></span><span leaf=""><br></span></p><p data-brushtype="text" data-pm-slice="0 0 []"><strong><strong><strong><span leaf="">后苔↩️之前贴子的岸号即可霍得之前的</span></strong></strong></strong></p><p data-brushtype="text"><strong><strong><strong><strong data-pm-slice="0 0 []"><span leaf="">代码，今日关键词：250625</span></strong></strong></strong></strong></p></section></section></section></section></section></section></section><section><span data-pm-slice="0 0 []"><span leaf="">CosMX spatial transcriptomic 分析代码</span></span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="ruby"><code><span leaf=""><span># 加载所需的R包</span></span></code><code><span leaf="">library(<span>Seurat</span>)          <span># 单细胞数据分析的核心包</span></span></code><code><span leaf="">library(cowplot)         <span># 用于组合多个图形</span></span></code><code><span leaf="">library(dplyr)           <span># 数据处理和操作</span></span></code><code><span leaf="">library(ggplot2)         <span># 数据可视化</span></span></code><code><span leaf="">library(<span>Polychrome</span>)      <span># 提供更多颜色选择</span></span></code><code><span leaf="">library(patchwork)       <span># 图形拼接</span></span></code><code><span leaf="">library(<span>BiocManager</span>)     <span># 安装Bioconductor包</span></span></code><code><span leaf="">library(sctransform)     <span># 单细胞数据标准化</span></span></code><code><span leaf="">library(tidyverse)       <span># 数据科学工具集合</span></span></code><code><span leaf="">library(hdf5r)           <span># 处理HDF5格式文件</span></span></code><code><span leaf="">library(glmGamPoi)       <span># 广义线性模型分析</span></span></code><code><span leaf="">library(<span>SeuratDisk</span>)      <span># Seurat对象格式转换</span></span></code><code><span leaf="">library(scran)           <span># 单细胞RNA-seq分析</span></span></code><code><span leaf="">library(future)          <span># 并行计算</span></span></code><code><span leaf="">library(data.table)      <span># 高效数据处理</span></span></code><code><span leaf="">library(tidyr)           <span># 数据整理</span></span></code><code><span leaf="">library(gplots)          <span># 图形绘制</span></span></code><code><span leaf="">library(dbscan)          <span># 密度聚类分析</span></span></code><code><span leaf="">library(scclusteval)     <span># 单细胞聚类评估</span></span></code><code><span leaf="">library(<span>ComplexHeatmap</span>)  <span># 复杂热图绘制</span></span></code><code><span leaf=""><span># --------------------------- 数据读取与Seurat对象创建 ---------------------------</span></span></code><code><span leaf=""><span># 读取SSc1表达矩阵数据</span></span></code><code><span leaf="">expr_data &lt;- read.csv(<span>"SSc1_exprMat_data.csv"</span>, header = <span>TRUE</span>)</span></code><code><span leaf=""><span># 设置行名为第一列</span></span></code><code><span leaf="">rownames(expr_data) &lt;- expr_data[, <span>1</span>]</span></code><code><span leaf=""><span># 提取第4列到1003列作为表达矩阵</span></span></code><code><span leaf="">expr_matrix &lt;- expr_data[, <span>4</span><span>:</span><span>1003</span>]</span></code><code><span leaf=""><span># 创建Seurat对象，转置表达矩阵作为计数数据</span></span></code><code><span leaf="">s1 &lt;- <span>CreateSeuratObject</span>(counts = t(expr_matrix), assay = <span>"RNA"</span>)</span></code><code><span leaf=""><span># 读取元数据</span></span></code><code><span leaf="">metadata &lt;- read.csv(<span>"SSc1_metadata_data.csv"</span>, row.names = <span>1</span>)</span></code><code><span leaf=""><span># 匹配Seurat对象中的细胞与元数据</span></span></code><code><span leaf="">matching_metadata &lt;- metadata[match(<span>Cells</span>(s1), rownames(metadata)), ]</span></code><code><span leaf=""><span># 向Seurat对象添加元数据</span></span></code><code><span leaf="">s1 &lt;- <span>AddMetaData</span>(s1, metadata = matching_metadata)</span></code><code><span leaf=""><span># 提取元数据</span></span></code><code><span leaf="">metadata &lt;- s1<span>@meta</span>.data</span></code><code><span leaf=""><span># 重复上述步骤，处理SSc2、SSc3、HD1、HD2、HD3数据</span></span></code><code><span leaf="">expr_data &lt;- read.csv(<span>"SSc2_exprMat_data.csv"</span>, header = <span>TRUE</span>)</span></code><code><span leaf="">rownames(expr_data) &lt;- expr_data[, <span>1</span>]</span></code><code><span leaf="">expr_matrix &lt;- expr_data[, <span>4</span><span>:</span><span>1003</span>]</span></code><code><span leaf="">s2 &lt;- <span>CreateSeuratObject</span>(counts = t(expr_matrix), assay = <span>"RNA"</span>)</span></code><code><span leaf="">metadata &lt;- read.csv(<span>"SSc2_metadata_data.csv"</span>, row.names = <span>1</span>)</span></code><code><span leaf="">matching_metadata &lt;- metadata[match(<span>Cells</span>(s2), rownames(metadata)), ]</span></code><code><span leaf="">s2 &lt;- <span>AddMetaData</span>(s2, metadata = matching_metadata)</span></code><code><span leaf="">metadata &lt;- s2<span>@meta</span>.data</span></code><code><span leaf="">expr_data &lt;- read.csv(<span>"SSc3_exprMat_data.csv"</span>, header = <span>TRUE</span>)</span></code><code><span leaf="">rownames(expr_data) &lt;- expr_data[, <span>1</span>]</span></code><code><span leaf="">expr_matrix &lt;- expr_data[, <span>4</span><span>:</span><span>1003</span>]</span></code><code><span leaf="">s3 &lt;- <span>CreateSeuratObject</span>(counts = t(expr_matrix), assay = <span>"RNA"</span>)</span></code><code><span leaf="">metadata &lt;- read.csv(<span>"SSc3_metadata_data.csv"</span>, row.names = <span>1</span>)</span></code><code><span leaf="">matching_metadata &lt;- metadata[match(<span>Cells</span>(s3), rownames(metadata)), ]</span></code><code><span leaf="">s3 &lt;- <span>AddMetaData</span>(s3, metadata = matching_metadata)</span></code><code><span leaf="">metadata &lt;- s3<span>@meta</span>.data</span></code><code><span leaf="">expr_data &lt;- read.csv(<span>"HD1_exprMat_data.csv"</span>, header = <span>TRUE</span>)</span></code><code><span leaf="">rownames(expr_data) &lt;- expr_data[, <span>1</span>]</span></code><code><span leaf="">expr_matrix &lt;- expr_data[, <span>4</span><span>:</span><span>1003</span>]</span></code><code><span leaf="">s4 &lt;- <span>CreateSeuratObject</span>(counts = t(expr_matrix), assay = <span>"RNA"</span>)</span></code><code><span leaf="">metadata &lt;- read.csv(<span>"HD1_metadata_data.csv"</span>, row.names = <span>1</span>)</span></code><code><span leaf="">matching_metadata &lt;- metadata[match(<span>Cells</span>(s4), rownames(metadata)), ]</span></code><code><span leaf="">s4 &lt;- <span>AddMetaData</span>(s4, metadata = matching_metadata)</span></code><code><span leaf="">metadata &lt;- s4<span>@meta</span>.data</span></code><code><span leaf="">expr_data &lt;- read.csv(<span>"HD2_exprMat_data.csv"</span>, header = <span>TRUE</span>)</span></code><code><span leaf="">rownames(expr_data) &lt;- expr_data[, <span>1</span>]</span></code><code><span leaf="">expr_matrix &lt;- expr_data[, <span>4</span><span>:</span><span>1003</span>]</span></code><code><span leaf="">s5 &lt;- <span>CreateSeuratObject</span>(counts = t(expr_matrix), assay = <span>"RNA"</span>)</span></code><code><span leaf="">metadata &lt;- read.csv(<span>"HD2_metadata_data.csv"</span>, row.names = <span>1</span>)</span></code><code><span leaf="">matching_metadata &lt;- metadata[match(<span>Cells</span>(s5), rownames(metadata)), ]</span></code><code><span leaf="">s5 &lt;- <span>AddMetaData</span>(s5, metadata = matching_metadata)</span></code><code><span leaf="">metadata &lt;- s5<span>@meta</span>.data</span></code><code><span leaf="">expr_data &lt;- read.csv(<span>"HD3_exprMat_data.csv"</span>, header = <span>TRUE</span>)</span></code><code><span leaf="">rownames(expr_data) &lt;- expr_data[, <span>1</span>]</span></code><code><span leaf="">expr_matrix &lt;- expr_data[, <span>4</span><span>:</span><span>1003</span>]</span></code><code><span leaf="">s6 &lt;- <span>CreateSeuratObject</span>(counts = t(expr_matrix), assay = <span>"RNA"</span>)</span></code><code><span leaf="">metadata &lt;- read.csv(<span>"HD3_metadata_data.csv"</span>, row.names = <span>1</span>)</span></code><code><span leaf="">matching_metadata &lt;- metadata[match(<span>Cells</span>(s6), rownames(metadata)), ]</span></code><code><span leaf="">s6 &lt;- <span>AddMetaData</span>(s6, metadata = matching_metadata)</span></code><code><span leaf="">metadata &lt;- s6<span>@meta</span>.data</span></code><code><span leaf=""><span># --------------------------- 为样本添加标签 ---------------------------</span></span></code><code><span leaf=""><span># 为每个Seurat对象添加样本标签</span></span></code><code><span leaf="">s1<span>@meta</span>.data<span>$sample</span> &lt;- <span>"SSc1"</span></span></code><code><span leaf="">s2<span>@meta</span>.data<span>$sample</span> &lt;- <span>"SSc2"</span></span></code><code><span leaf="">s3<span>@meta</span>.data<span>$sample</span> &lt;- <span>"SSc3"</span></span></code><code><span leaf="">s4<span>@meta</span>.data<span>$sample</span> &lt;- <span>"HD1"</span></span></code><code><span leaf="">s5<span>@meta</span>.data<span>$sample</span> &lt;- <span>"HD2"</span></span></code><code><span leaf="">s6<span>@meta</span>.data<span>$sample</span> &lt;- <span>"HD3"</span></span></code><code><span leaf=""><span># 为每个Seurat对象添加疾病标签（SRC或HD）</span></span></code><code><span leaf="">s1<span>@meta</span>.data<span>$disease</span> &lt;- <span>"SRC"</span></span></code><code><span leaf="">s2<span>@meta</span>.data<span>$disease</span> &lt;- <span>"SRC"</span></span></code><code><span leaf="">s3<span>@meta</span>.data<span>$disease</span> &lt;- <span>"SRC"</span></span></code><code><span leaf="">s4<span>@meta</span>.data<span>$disease</span> &lt;- <span>"HD"</span></span></code><code><span leaf="">s5<span>@meta</span>.data<span>$disease</span> &lt;- <span>"HD"</span></span></code><code><span leaf="">s6<span>@meta</span>.data<span>$disease</span> &lt;- <span>"HD"</span></span></code><code><span leaf=""><span># 为每个Seurat对象添加编号</span></span></code><code><span leaf="">s1<span>@meta</span>.data<span>$number</span> &lt;- <span>1</span></span></code><code><span leaf="">s2<span>@meta</span>.data<span>$number</span> &lt;- <span>2</span></span></code><code><span leaf="">s3<span>@meta</span>.data<span>$number</span> &lt;- <span>3</span></span></code><code><span leaf="">s4<span>@meta</span>.data<span>$number</span> &lt;- <span>4</span></span></code><code><span leaf="">s5<span>@meta</span>.data<span>$number</span> &lt;- <span>5</span></span></code><code><span leaf="">s6<span>@meta</span>.data<span>$number</span> &lt;- <span>6</span></span></code><code><span leaf=""><span># --------------------------- 调整细胞坐标以区分不同样本 ---------------------------</span></span></code><code><span leaf=""><span># 为避免不同样本的细胞在邻近分析中被识别为邻居，</span></span></code><code><span leaf=""><span># 给每个样本的细胞x和y坐标加上number*1000（足够大的数）</span></span></code><code><span leaf="">s1<span>@meta</span>.data<span>$x_slide_mm</span> &lt;- s1<span>@meta</span>.data<span>$x_slide_mm</span> + (s1<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s1<span>@meta</span>.data<span>$y_slide_mm</span> &lt;- s1<span>@meta</span>.data<span>$y_slide_mm</span> + (s1<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s2<span>@meta</span>.data<span>$x_slide_mm</span> &lt;- s2<span>@meta</span>.data<span>$x_slide_mm</span> + (s2<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s2<span>@meta</span>.data<span>$y_slide_mm</span> &lt;- s2<span>@meta</span>.data<span>$y_slide_mm</span> + (s2<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s3<span>@meta</span>.data<span>$x_slide_mm</span> &lt;- s3<span>@meta</span>.data<span>$x_slide_mm</span> + (s3<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s3<span>@meta</span>.data<span>$y_slide_mm</span> &lt;- s3<span>@meta</span>.data<span>$y_slide_mm</span> + (s3<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s4<span>@meta</span>.data<span>$x_slide_mm</span> &lt;- s4<span>@meta</span>.data<span>$x_slide_mm</span> + (s4<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s4<span>@meta</span>.data<span>$y_slide_mm</span> &lt;- s4<span>@meta</span>.data<span>$y_slide_mm</span> + (s4<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s5<span>@meta</span>.data<span>$x_slide_mm</span> &lt;- s5<span>@meta</span>.data<span>$x_slide_mm</span> + (s5<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s5<span>@meta</span>.data<span>$y_slide_mm</span> &lt;- s5<span>@meta</span>.data<span>$y_slide_mm</span> + (s5<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s6<span>@meta</span>.data<span>$x_slide_mm</span> &lt;- s6<span>@meta</span>.data<span>$x_slide_mm</span> + (s6<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf="">s6<span>@meta</span>.data<span>$y_slide_mm</span> &lt;- s6<span>@meta</span>.data<span>$y_slide_mm</span> + (s6<span>@meta</span>.data<span>$number</span> * <span>1000</span>)</span></code><code><span leaf=""><span># --------------------------- 质量控制 ---------------------------</span></span></code><code><span leaf=""><span># 筛选掉质量控制标记为不合格的细胞</span></span></code><code><span leaf="">s1 &lt;- subset(s1, subset = qcCellsFlagged == <span>FALSE</span>)</span></code><code><span leaf="">s2 &lt;- subset(s2, subset = qcCellsFlagged == <span>FALSE</span>)</span></code><code><span leaf="">s3 &lt;- subset(s3, subset = qcCellsFlagged == <span>FALSE</span>)</span></code><code><span leaf="">s4 &lt;- subset(s4, subset = qcCellsFlagged == <span>FALSE</span>)</span></code><code><span leaf="">s5 &lt;- subset(s5, subset = qcCellsFlagged == <span>FALSE</span>)</span></code><code><span leaf="">s6 &lt;- subset(s6, subset = qcCellsFlagged == <span>FALSE</span>)</span></code><code><span leaf=""><span># --------------------------- 基于细胞面积的数据标准化 ---------------------------</span></span></code><code><span leaf=""><span># 计算每个样本细胞面积的中位数</span></span></code><code><span leaf="">median_value &lt;- median(s1<span>@meta</span>.data<span>$Area</span>.um2, na.rm = <span>TRUE</span>)</span></code><code><span leaf=""><span># 计算面积因子（细胞面积/中位数）</span></span></code><code><span leaf="">s1<span>$Area</span>.um2_factor &lt;- s1<span>@meta</span>.data<span>$Area</span>.um2 / median_value</span></code><code><span leaf=""><span># 获取原始计数矩阵</span></span></code><code><span leaf="">counts_matrix &lt;- <span>GetAssayData</span>(s1, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)</span></code><code><span leaf=""><span># 用面积因子标准化计数矩阵</span></span></code><code><span leaf="">new_counts_matrix &lt;- counts_matrix / s1<span>$Area</span>.um2_factor</span></code><code><span leaf=""><span># 将标准化后的计数矩阵设置为Seurat对象的计数数据</span></span></code><code><span leaf="">s1 &lt;- <span>SetAssayData</span>(object = s1, assay = <span>"RNA"</span>, layer = <span>"counts"</span>, new.data = new_counts_matrix)</span></code><code><span leaf=""><span># 重复上述标准化步骤，处理s2到s6</span></span></code><code><span leaf="">median_value &lt;- median(s2<span>@meta</span>.data<span>$Area</span>.um2, na.rm = <span>TRUE</span>)</span></code><code><span leaf="">s2<span>$Area</span>.um2_factor &lt;- s2<span>@meta</span>.data<span>$Area</span>.um2 / median_value</span></code><code><span leaf="">counts_matrix &lt;- <span>GetAssayData</span>(s2, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)</span></code><code><span leaf="">new_counts_matrix &lt;- counts_matrix / s2<span>$Area</span>.um2_factor</span></code><code><span leaf="">s2 &lt;- <span>SetAssayData</span>(object = s2, assay = <span>"RNA"</span>, layer = <span>"counts"</span>, new.data = new_counts_matrix)</span></code><code><span leaf="">median_value &lt;- median(s3<span>@meta</span>.data<span>$Area</span>.um2, na.rm = <span>TRUE</span>)</span></code><code><span leaf="">s3<span>$Area</span>.um2_factor &lt;- s3<span>@meta</span>.data<span>$Area</span>.um2 / median_value</span></code><code><span leaf="">counts_matrix &lt;- <span>GetAssayData</span>(s3, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)</span></code><code><span leaf="">new_counts_matrix &lt;- counts_matrix / s3<span>$Area</span>.um2_factor</span></code><code><span leaf="">s3 &lt;- <span>SetAssayData</span>(object = s3, assay = <span>"RNA"</span>, layer = <span>"counts"</span>, new.data = new_counts_matrix)</span></code><code><span leaf="">median_value &lt;- median(s4<span>@meta</span>.data<span>$Area</span>.um2, na.rm = <span>TRUE</span>)</span></code><code><span leaf="">s4<span>$Area</span>.um2_factor &lt;- s4<span>@meta</span>.data<span>$Area</span>.um2 / median_value</span></code><code><span leaf="">counts_matrix &lt;- <span>GetAssayData</span>(s4, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)</span></code><code><span leaf="">new_counts_matrix &lt;- counts_matrix / s4<span>$Area</span>.um2_factor</span></code><code><span leaf="">s4 &lt;- <span>SetAssayData</span>(object = s4, assay = <span>"RNA"</span>, layer = <span>"counts"</span>, new.data = new_counts_matrix)</span></code><code><span leaf="">median_value &lt;- median(s5<span>@meta</span>.data<span>$Area</span>.um2, na.rm = <span>TRUE</span>)</span></code><code><span leaf="">s5<span>$Area</span>.um2_factor &lt;- s5<span>@meta</span>.data<span>$Area</span>.um2 / median_value</span></code><code><span leaf="">counts_matrix &lt;- <span>GetAssayData</span>(s5, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)</span></code><code><span leaf="">new_counts_matrix &lt;- counts_matrix / s5<span>$Area</span>.um2_factor</span></code><code><span leaf="">s5 &lt;- <span>SetAssayData</span>(object = s5, assay = <span>"RNA"</span>, layer = <span>"counts"</span>, new.data = new_counts_matrix)</span></code><code><span leaf="">median_value &lt;- median(s6<span>@meta</span>.data<span>$Area</span>.um2, na.rm = <span>TRUE</span>)</span></code><code><span leaf="">s6<span>$Area</span>.um2_factor &lt;- s6<span>@meta</span>.data<span>$Area</span>.um2 / median_value</span></code><code><span leaf="">counts_matrix &lt;- <span>GetAssayData</span>(s6, assay = <span>"RNA"</span>, layer = <span>"counts"</span>)</span></code><code><span leaf="">new_counts_matrix &lt;- counts_matrix / s6<span>$Area</span>.um2_factor</span></code><code><span leaf="">s6 &lt;- <span>SetAssayData</span>(object = s6, assay = <span>"RNA"</span>, layer = <span>"counts"</span>, new.data = new_counts_matrix)</span></code><code><span leaf=""><span># --------------------------- 数据整合与分析 ---------------------------</span></span></code><code><span leaf=""><span># 合并所有Seurat对象</span></span></code><code><span leaf="">s.int_layer &lt;- merge(s1, y = c(s2, s3, s4, s5, s6))</span></code><code><span leaf=""><span># 数据标准化</span></span></code><code><span leaf="">s.int_layer &lt;- <span>NormalizeData</span>(s.int_layer)</span></code><code><span leaf=""><span># 获取所有基因名称</span></span></code><code><span leaf="">all.genes &lt;- rownames(s.int_layer)</span></code><code><span leaf=""><span># 数据缩放</span></span></code><code><span leaf="">s.int_layer &lt;- <span>ScaleData</span>(s.int_layer, features = all.genes)</span></code><code><span leaf=""><span># 运行主成分分析（PCA），使用30个主成分</span></span></code><code><span leaf="">s.int_layer &lt;- <span>Run</span>PCA(s.int_layer, npcs = <span>30</span>, features = all.genes)</span></code><code><span leaf=""><span># 设置未来计算的全局最大内存（15GB）</span></span></code><code><span leaf="">options(future.globals.maxSize = <span>15</span> * <span>1024</span>^<span>3</span>)</span></code><code><span leaf=""><span># 垃圾回收</span></span></code><code><span leaf="">gc()</span></code><code><span leaf=""><span># 使用CCA方法整合数据层</span></span></code><code><span leaf="">s.int_layer &lt;- <span>IntegrateLayers</span>(</span></code><code><span leaf="">  object = s.int_layer, method = <span>CCAIntegration</span>,</span></code><code><span leaf="">  orig.reduction = <span>"pca"</span>, features = all.genes, new.reduction = <span>"integrated.CCA"</span>,</span></code><code><span leaf="">  verbose = <span>FALSE</span></span></code><code><span leaf="">)</span></code><code><span leaf=""><span># 查找邻居细胞，基于整合后的降维结果</span></span></code><code><span leaf="">s.int_layer &lt;- <span>FindNeighbors</span>(s.int_layer, reduction = <span>"integrated.CCA"</span>, dims = <span>1</span><span>:</span><span>30</span>)</span></code><code><span leaf=""><span># 细胞聚类，分辨率设为0.9</span></span></code><code><span leaf="">s.int_layer &lt;- <span>FindClusters</span>(s.int_layer, resolution = <span>0.9</span>)</span></code><code><span leaf=""><span># 运行UMAP降维，基于整合后的主成分</span></span></code><code><span leaf="">s.int_layer &lt;- <span>Run</span>UMAP(s.int_layer, reduction = <span>"integrated.CCA"</span>, dims = <span>1</span><span>:</span><span>30</span>, reduction.name = <span>"umap.CCA"</span>)</span></code><code><span leaf=""><span># --------------------------- 髓系细胞亚群分析 ---------------------------</span></span></code><code><span leaf=""><span># 筛选出髓系细胞群（簇8）</span></span></code><code><span leaf=""><span>Mo</span> &lt;- subset(s.int_layer, ident = c(<span>"8"</span>))</span></code><code><span leaf=""><span># 数据缩放</span></span></code><code><span leaf=""><span>Mo</span> &lt;- <span>ScaleData</span>(<span>Mo</span>, features = all.genes)</span></code><code><span leaf=""><span># 运行PCA</span></span></code><code><span leaf=""><span>Mo</span> &lt;- <span>Run</span>PCA(<span>Mo</span>, npcs = <span>30</span>, features = all.genes)</span></code><code><span leaf=""><span># 运行UMAP降维</span></span></code><code><span leaf=""><span>Mo</span> &lt;- <span>Run</span>UMAP(<span>Mo</span>, reduction = <span>"pca"</span>, dims = <span>1</span><span>:</span><span>30</span>)</span></code><code><span leaf=""><span># 查找邻居细胞</span></span></code><code><span leaf=""><span>Mo</span> &lt;- <span>FindNeighbors</span>(<span>Mo</span>, reduction = <span>"pca"</span>, dims = <span>1</span><span>:</span><span>30</span>)</span></code><code><span leaf=""><span># 细胞聚类，分辨率设为0.2</span></span></code><code><span leaf=""><span>Mo</span> &lt;- <span>FindClusters</span>(<span>Mo</span>, resolution = <span>0.2</span>)</span></code><code><span leaf=""><span># --------------------------- 细胞邻近分析 ---------------------------</span></span></code><code><span leaf=""><span># 将每个细胞的注释信息存储为"seurat_clusters2"元数据</span></span></code><code><span leaf="">s.int_layer2 &lt;- subset(s.int_layer, subset = disease == <span>"SRC"</span>)</span></code><code><span leaf=""><span># 获取细胞的x和y坐标（第88和89列）</span></span></code><code><span leaf="">mat &lt;- s.int_layer2<span>@meta</span>.data[, <span>88</span><span>:</span><span>89</span>]</span></code><code><span leaf=""><span># 转换为矩阵</span></span></code><code><span leaf="">mat &lt;- as.matrix(mat)</span></code><code><span leaf=""><span># 设置邻域半径</span></span></code><code><span leaf="">eps &lt;- <span>0.03</span></span></code><code><span leaf=""><span># 使用frNN函数查找每个细胞的邻居</span></span></code><code><span leaf="">nn &lt;- frNN(x = mat, eps = eps)</span></code><code><span leaf=""><span># 查看前3个细胞的邻居ID</span></span></code><code><span leaf="">nn<span>$id</span> %&gt;% head(n = <span>3</span>)</span></code><code><span leaf=""><span># 将邻居ID转换为数据框</span></span></code><code><span leaf="">nn_df &lt;- nn<span>$id</span> %&gt;% stack()</span></code><code><span leaf=""><span># 获取每个细胞的簇ID</span></span></code><code><span leaf="">cluster_ids &lt;- s.int_layer2<span>$seurat_clusters2</span> %&gt;% unname()</span></code><code><span leaf=""><span># 为邻居数据框添加簇ID</span></span></code><code><span leaf="">nn_df<span>$cluster_id</span> &lt;- cluster_ids[nn_df<span>$values</span>]</span></code><code><span leaf=""><span># 转换簇ID为因子</span></span></code><code><span leaf="">nn_df<span>$cluster_id</span> &lt;- factor(nn_df<span>$cluster_id</span>)</span></code><code><span leaf=""><span># 转换为数据框</span></span></code><code><span leaf="">nn_df &lt;- as.data.frame(nn_df)</span></code><code><span leaf=""><span># 转换簇ID和索引为向量</span></span></code><code><span leaf="">nn_df<span>$cluster_id</span> &lt;- unlist(nn_df<span>$cluster_id</span>)</span></code><code><span leaf="">nn_df<span>$ind</span> &lt;- unlist(nn_df<span>$ind</span>)</span></code><code><span leaf="">nn_df<span>$values</span> &lt;- unlist(nn_df<span>$values</span>)</span></code><code><span leaf="">nn_df<span>$cluster_id</span> &lt;- as.vector(unlist(nn_df<span>$cluster_id</span>))</span></code><code><span leaf="">nn_df<span>$ind</span> &lt;- as.vector(unlist(nn_df<span>$ind</span>))</span></code><code><span leaf="">nn_df &lt;- as.data.frame(nn_df)</span></code><code><span leaf=""><span># 按细胞和簇分组，计算每个簇中邻居的数量</span></span></code><code><span leaf="">nn_count &lt;- nn_df %&gt;%</span></code><code><span leaf="">  group_by(ind, cluster_id) %&gt;%</span></code><code><span leaf="">  summarize(n = n(), .groups = <span>"drop"</span>)</span></code><code><span leaf=""><span># 转换为宽格式</span></span></code><code><span leaf="">nn_count &lt;- nn_count %&gt;%</span></code><code><span leaf="">  tidyr::pivot_wider(names_from = cluster_id, values_from = n)</span></code><code><span leaf=""><span># 提取邻居数量矩阵</span></span></code><code><span leaf="">nn_mat &lt;- nn_count[,-<span>1</span>] %&gt;% as.matrix()</span></code><code><span leaf=""><span># 设置矩阵行名</span></span></code><code><span leaf="">rownames(nn_mat) &lt;- nn_count<span>$ind</span></span></code><code><span leaf=""><span># 将NA值设为0</span></span></code><code><span leaf="">nn_mat[is.na(nn_mat)] &lt;- <span>0</span></span></code><code><span leaf=""><span># 运行k-means聚类，分为9个中心</span></span></code><code><span leaf="">k_means_res &lt;- kmeans(nn_mat, centers = <span>9</span>)</span></code><code><span leaf=""><span># 将聚类结果转换为数据框</span></span></code><code><span leaf="">k_means_id &lt;- k_means_res<span>$cluster</span> %&gt;%</span></code><code><span leaf="">  tibble::enframe(name = <span>"cell_id"</span>, value = <span>"kmeans_cluster"</span>)</span></code><code><span leaf=""><span># 查看前几行</span></span></code><code><span leaf="">head(k_means_id)</span></code><code><span leaf="">k_means_df &lt;- as.data.frame(k_means_id)</span></code><code><span leaf="">rownames(k_means_df) &lt;- k_means_id<span>$cell_id</span></span></code><code><span leaf=""><span># 创建Seurat对象用于邻近分析</span></span></code><code><span leaf="">nn_obj &lt;- <span>CreateSeuratObject</span>(counts = t(nn_mat),  min.features = <span>5</span>)</span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/f0R1-79ovnqfS9kcwuDG6Q",target="_blank" rel="noopener noreferrer">原文链接</a>
