---
title: "å¤æ‚å¤šæ ·æœ¬10Xå•ç»†èƒæ•°æ®æ•´ç†åŠè¯»å–æµç¨‹(Python)"
date: 2025-06-13T00:27:07Z
draft: ["false"]
tags: [
  "fetched",
  "ç”Ÿä¿¡æ–¹èˆŸ"
]
categories: ["Acdemic"]
---
å¤æ‚å¤šæ ·æœ¬10Xå•ç»†èƒæ•°æ®æ•´ç†åŠè¯»å–æµç¨‹(Python) by ç”Ÿä¿¡æ–¹èˆŸ
------
<div><section><span leaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="ç”Ÿä¿¡æ–¹èˆŸ" data-alias="shengxinfangzhou" data-from="0" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGfe15Xm0WHdoAMNGvE93bmxaF9iabfPiaO9ic6Tmd8XW1PMiaeuqicSFhCLQJibAUhHsamS1LbaJMFiaZXA/0?wx_fmt=png" data-signature="çƒ­çˆ±åŒ»å­¦å’Œæ•°æ®ç§‘å­¦ï¼Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œå­¦ä¹ å’Œæ•´ç†ç›¸å…³çš„çŸ¥è¯†ã€‚" data-id="MzkwMjYyMDA1OA==" data-service_type="1" data-verify_status="0"></mp-common-profile></span></section><p><span leaf=""><br></span></p><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">å…¶å®ï¼Œå¦‚æœæ•°æ®å¾ˆå°‘çš„è¯å¯ä»¥é€‰æ‹©æ‰‹åŠ¨æ•´ç†ã€‚</span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">æ—¢å¾€æ•´ç†è¿‡Rè¯­è¨€ç‰ˆæœ¬çš„</span><span leaf="" data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;data-tool&quot;:&quot;mdniceç¼–è¾‘å™¨&quot;,&quot;data-website&quot;:&quot;https://www.mdnice.com&quot;,&quot;style&quot;:&quot;margin-top: 0px;margin-bottom: 0px;margin-left: 0px;margin-right: 0px;padding-top: 0px;padding-bottom: 0px;padding-left: 10px;padding-right: 10px;background-attachment: scroll;background-clip: border-box;background-color: rgba(0, 0, 0, 0);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;font-family: Optima, 'Microsoft YaHei', PingFangSC-regular, serif;font-size: 16px;color: rgb(0, 0, 0);line-height: 1.5em;word-spacing: 0em;letter-spacing: 0em;word-break: break-word;overflow-wrap: break-word;text-align: left;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;data-tool&quot;:&quot;mdniceç¼–è¾‘å™¨&quot;,&quot;style&quot;:&quot;color: rgb(0, 0, 0);font-size: 16px;line-height: 1.8em;letter-spacing: 0em;text-align: left;text-indent: 0em;margin-top: 0px;margin-bottom: 0px;margin-left: 0px;margin-right: 0px;padding-top: 8px;padding-bottom: 8px;padding-left: 0px;padding-right: 0px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">æ•´ç†åŠè¯»å–</span><span leaf="">æµç¨‹ï¼š<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247485292&amp;idx=1&amp;sn=fa7234c2443934387c26a54e1bbf4120&amp;scene=21#wechat_redirect" textvalue="å¸¸è§ä¸åŒå•ç»†èƒæ•°æ®ç±»å‹çš„è¯»å–åŠSeuratå¯¹è±¡åˆ›å»ºæ–¹æ³•æ•´ç†(å•å¤šæ ·æœ¬/10X/h5/txt/csv/tsv)" data-itemshowtype="0" linktype="text" data-linktype="2">å¸¸è§ä¸åŒå•ç»†èƒæ•°æ®ç±»å‹çš„è¯»å–åŠSeuratå¯¹è±¡åˆ›å»ºæ–¹æ³•æ•´ç†(å•å¤šæ ·æœ¬/10X/h5/txt/csv/tsv)</a></span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">æ­¤å¤–ä¹Ÿæ•´ç†è¿‡ç®€å•çš„å¤šæ ·æœ¬10Xå•ç»†èƒæ•°æ®æ•´ç†åŠè¯»å–æµç¨‹ï¼š<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247488261&amp;idx=1&amp;sn=55b4227de0258642840c5da3159cb5b3&amp;scene=21#wechat_redirect" textvalue="Seuratå’Œh5adæ•°æ®ç›¸äº’è½¬åŒ–ä»¥åŠ10Xå¤šæ ·æœ¬æ•°æ®æ•´ç†å’Œè¯»å–(Python)" data-itemshowtype="11" linktype="text" data-linktype="2">Seuratå’Œh5adæ•°æ®ç›¸äº’è½¬åŒ–ä»¥åŠ10Xå¤šæ ·æœ¬æ•°æ®æ•´ç†å’Œè¯»å–(Python)</a></span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">é€‰æ‹©äº†GSE259229æ•°æ®é›†~<img data-imgfileid="100004801" data-ratio="0.9114799446749654" data-type="png" data-w="723" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrvuWuAJtTS464sphnY3hfwyGX7JOVicHtgCLLK4mst1kCFLdYDkJQia1A/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrvuWuAJtTS464sphnY3hfwyGX7JOVicHtgCLLK4mst1kCFLdYDkJQia1A/640?wx_fmt=png&amp;from=appmsg"></span></p><h4 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">æ•´ç†åŠè¯»å–æµç¨‹</span></span><span></span></h4><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">1.å¯¼å…¥</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">import os</span><span leaf=""><br></span><span leaf="">import scanpy as sc</span><span leaf=""><br></span><span leaf="">import pandas as pd</span><span leaf=""><br></span><span leaf="">import tarfileÂ </span><span><span leaf=""># è§£å‹ç¼©æ–‡ä»¶çš„åº“</span></span><span leaf=""><br></span></code></pre><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">2.è·å–å½“å‰æ–‡ä»¶è·¯å¾„</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">path = os.getcwd()</span><span leaf=""><br></span><span leaf="">path</span><span leaf=""><br></span></code></pre><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">3.è§£å‹ç¼©</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># è§£å‹ç¼©</span></span><span leaf=""><br></span><span leaf="">tar_path =Â </span><span><span leaf="">"GSE259229_RAW.tar"</span></span><span leaf=""><br></span><span leaf="">exreact_path =Â </span><span><span leaf="">"GSE259229_RAW"</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># è§£å‹ç¼©</span></span><span leaf=""><br></span><span leaf="">with tarfile.open(tar_path,</span><span><span leaf="">"r"</span></span><span leaf="">) as tar:</span><span leaf=""><br></span><span leaf="">Â  Â  tar.extractall(path = extract_path)Â </span><span><span leaf=""># extractall(...): è¡¨ç¤ºå°† .tar æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹å…¨éƒ¨è§£å‹å‡ºæ¥</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># æŸ¥çœ‹è§£å‹åçš„æ–‡ä»¶åˆ—è¡¨</span></span><span leaf=""><br></span><span leaf="">files = os.listdir(exreact_path)</span><span leaf=""><br></span><span leaf="">print(files)</span><span leaf=""><br></span></code></pre><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">4.æå–æ ·æœ¬åç§°ï¼Œå¹¶é‡æ–°åˆ›å»ºæ–°çš„æ•°æ®æ–‡ä»¶å¤¹</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">folder =Â </span><span><span leaf="">"GSE259229_RAW"</span></span><span leaf=""><br></span><span leaf="">filenames = [fÂ </span><span><span leaf="">for</span></span><span leaf="">Â fÂ </span><span><span leaf="">in</span></span><span leaf="">Â os.listdir(folder)Â </span><span><span leaf="">if</span></span><span leaf="">Â not f.startswith(</span><span><span leaf="">"."</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># æå–ä¸‹åˆ’çº¿ _ å‰çš„æ ·æœ¬åï¼Œå¹¶å»é‡</span></span><span leaf=""><br></span><span leaf="">samples = list({f.split(</span><span><span leaf="">"_"</span></span><span leaf="">)[</span><span><span leaf="">0</span></span><span leaf="">]Â </span><span><span leaf="">for</span></span><span leaf="">Â fÂ </span><span><span leaf="">in</span></span><span leaf="">Â filenames})</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">print(samples)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 3. åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹</span></span><span leaf=""><br></span><span leaf="">base_dir =Â </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf="">Â sampleÂ </span><span><span leaf="">in</span></span><span leaf="">Â samples:</span><span leaf=""><br></span><span leaf="">Â  Â  dir_path = os.path.join(base_dir, sample)</span><span leaf=""><br></span><span leaf="">Â  Â  os.makedirs(dir_path, exist_ok=True)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># æŸ¥çœ‹åˆ›å»ºå¥½çš„å­æ–‡ä»¶å¤¹</span></span><span leaf=""><br></span><span leaf="">print(os.listdir(base_dir))</span><span leaf=""><br></span></code></pre><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">5.è·å–æ–‡ä»¶å¹¶ç§»åŠ¨ä½ç½®</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">import shutil</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 1.è·å–æ¯ä¸ªæ–‡ä»¶çš„è·¯å¾„</span></span><span leaf=""><br></span><span leaf="">folder =Â </span><span><span leaf="">"GSE259229_RAW"</span></span><span leaf=""><br></span><span leaf="">base_dir =Â </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">fs = [os.path.join(folder, f)Â </span><span><span leaf="">for</span></span><span leaf="">Â fÂ </span><span><span leaf="">in</span></span><span leaf="">Â os.listdir(folder)]</span><span leaf=""><br></span><span leaf="">print(fs)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 2. æå–åŸå§‹æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åç§°ï¼ŒæŒ‰ç…§è‡ªå·±çš„æ–‡ä»¶è¦æ±‚æå–æ ·æœ¬åç§°</span></span><span leaf=""><br></span><span leaf="">filenames = [fÂ </span><span><span leaf="">for</span></span><span leaf="">Â fÂ </span><span><span leaf="">in</span></span><span leaf="">Â os.listdir(folder)Â </span><span><span leaf="">if</span></span><span leaf="">Â not f.startswith(</span><span><span leaf="">"."</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf="">samples = list({f.split(</span><span><span leaf="">"_"</span></span><span leaf="">)[</span><span><span leaf="">0</span></span><span leaf="">]Â </span><span><span leaf="">for</span></span><span leaf="">Â fÂ </span><span><span leaf="">in</span></span><span leaf="">Â filenames})</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 3.ç„¶åæŠŠæ–‡ä»¶å¤¹ä¸­æ„æˆæ¯ä¸ªæ ·æœ¬çš„æ–‡ä»¶ç§»åŠ¨åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­å»</span></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf="">Â file_pathÂ </span><span><span leaf="">in</span></span><span leaf="">Â fs: Â </span><span><span leaf=""># ç¬¬ä¸€å±‚å¾ªç¯ï¼šéå†æ‰€æœ‰æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span></span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">for</span></span><span leaf="">Â sampleÂ </span><span><span leaf="">in</span></span><span leaf="">Â samples: Â </span><span><span leaf=""># ç¬¬äºŒå±‚å¾ªç¯ï¼šéå†æ¯ä¸ªæ ·æœ¬å</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â Â </span><span><span leaf="">if</span></span><span leaf="">Â sampleÂ </span><span><span leaf="">in</span></span><span leaf="">Â file_path: Â </span><span><span leaf=""># åˆ¤æ–­è¿™ä¸ªæ ·æœ¬åæ˜¯å¦å‡ºç°åœ¨æ–‡ä»¶è·¯å¾„ä¸­</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  dest_dir = os.path.join(base_dir, sample) Â </span><span><span leaf=""># æ‹¼æ¥å‡ºç›®æ ‡ç›®å½•è·¯å¾„</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  os.makedirs(dest_dir, exist_ok=True) Â </span><span><span leaf=""># å¦‚æœç›®æ ‡ç›®å½•ä¸å­˜åœ¨å°±åˆ›å»º</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  shutil.copy(file_path, dest_dir) Â </span><span><span leaf=""># å¤åˆ¶æ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â Â </span><span><span leaf="">break</span></span><span><span leaf=""># ä¸€æ—¦åŒ¹é…æˆåŠŸå°±è·³å‡ºå†…å±‚å¾ªç¯ï¼Œé˜²æ­¢é‡å¤å¤åˆ¶</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â Â </span><span leaf=""><br></span><span><span leaf=""># æŸ¥çœ‹æŸä¸ªæ ·æœ¬æ–‡ä»¶å¤¹çš„æ–‡ä»¶</span></span><span leaf=""><br></span><span leaf="">print(os.listdir(base_dir))</span><span leaf=""><br></span></code></pre><figure data-tool="mdniceç¼–è¾‘å™¨"><span leaf=""><img data-ratio="0.12037037037037036" data-type="png" data-w="1080" data-imgfileid="100004797" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsr25KhDgh0WCDebnVW0kF7KM5ob6M7uHWzVYmnicic6neia53Zeib1LRdBOg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsr25KhDgh0WCDebnVW0kF7KM5ob6M7uHWzVYmnicic6neia53Zeib1LRdBOg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">6.æ–‡ä»¶é‡å‘½å</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">import re</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># è·å–base_dirè·¯å¾„ä¸‹æ‰€æœ‰æ–‡ä»¶çš„åç§°</span></span><span leaf=""><br></span><span leaf="">base_dir =Â </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf="">Â root, dirs, filesÂ </span><span><span leaf="">in</span></span><span leaf="">Â os.walk(base_dir):</span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">for</span></span><span leaf="">Â fÂ </span><span><span leaf="">in</span></span><span leaf="">Â files:</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â Â </span><span><span leaf="">if</span></span><span leaf="">Â f.startswith(</span><span><span leaf="">"."</span></span><span leaf="">):</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  continue Â </span><span><span leaf=""># è·³è¿‡éšè—æ–‡ä»¶</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  old_path = os.path.join(root, f)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â Â </span><span><span leaf=""># æ­£åˆ™è¯´æ˜ï¼š</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â Â </span><span><span leaf=""># ^GSM\d+_ åŒ¹é…å¼€å¤´ GSM+æ•°å­—+ä¸‹åˆ’çº¿</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â Â </span><span><span leaf=""># [A-Z]{2}\d+ åŒ¹é…WT1ã€KO2ã€WT2ç­‰ï¼ˆä¸¤ä¸ªå¤§å†™å­—æ¯+æ•°å­—ï¼‰</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â Â </span><span><span leaf=""># æ›¿æ¢æˆç©ºå­—ç¬¦ä¸²ï¼Œå³å»é™¤è¿™éƒ¨åˆ†</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  new_fname = re.sub(r</span><span><span leaf="">'^GSM\d+_[A-Z]{2}\d+'</span></span><span leaf="">,Â </span><span><span leaf="">''</span></span><span leaf="">, f)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â Â </span><span><span leaf=""># å»æ‰å¯èƒ½å¤šä½™çš„ä¸‹åˆ’çº¿</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  new_fname = new_fname.lstrip(</span><span><span leaf="">'_'</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  new_path = os.path.join(root, new_fname)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  print(f</span><span><span leaf="">"Renaming:\n Â {old_path}\nâ†’ {new_path}\n"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  os.rename(old_path, new_path)</span><span leaf=""><br></span></code></pre><figure data-tool="mdniceç¼–è¾‘å™¨"><span leaf=""><img data-ratio="0.9653061224489796" data-type="png" data-w="490" data-imgfileid="100004800" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrK3oBnbB4MUFEIURgpR99JpvEPjKPcvS1lnbcMW6J5Xmmg4bQvosuYw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrK3oBnbB4MUFEIURgpR99JpvEPjKPcvS1lnbcMW6J5Xmmg4bQvosuYw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">7.å¯¹å¤šä½™æ–‡ä»¶è¿›è¡Œå¤„ç†</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># æŠŠåªæœ‰åŒ…å«expressionçš„æ–‡ä»¶è¿›è¡Œé¢å¤–å¤„ç†</span></span><span leaf=""><br></span><span leaf="">import os</span><span leaf=""><br></span><span leaf="">import shutil</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">base_dir =Â </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span leaf="">base_dir_abs = os.path.abspath(base_dir)Â </span><span><span leaf=""># è·å–ç»å¯¹è·¯å¾„</span></span><span leaf=""><br></span><span leaf="">parent_dir = os.path.dirname(base_dir_abs)Â </span><span><span leaf=""># è·å–ä¸Šæ¸¸è·¯å¾„</span></span><span leaf=""><br></span><span leaf="">new_dir = os.path.join(parent_dir,Â </span><span><span leaf="">"expression_GSE259229"</span></span><span leaf="">)Â </span><span><span leaf=""># åˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">if</span></span><span leaf="">Â not os.path.exists(new_dir):</span><span leaf=""><br></span><span leaf="">Â  Â  os.makedirs(new_dir)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># os.walk()æ˜¯é€’å½’éå†å·¥å…·ã€‚åœ¨æ¯ä¸€å±‚ç›®å½•ä¸­äº§ç”Ÿä¸€ä¸ªä¸‰å…ƒç»„ï¼š</span></span><span leaf=""><br></span><span><span leaf="">#root å½“å‰æ­£åœ¨éå†çš„ç›®å½•çš„è·¯å¾„</span></span><span leaf=""><br></span><span><span leaf="">#dirs å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•åï¼ˆåˆ—è¡¨ï¼‰</span></span><span leaf=""><br></span><span><span leaf="">#files å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åï¼ˆåˆ—è¡¨ï¼‰</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf="">Â root, dirs, filesÂ </span><span><span leaf="">in</span></span><span leaf="">Â os.walk(base_dir):</span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">for</span></span><span leaf="">Â fÂ </span><span><span leaf="">in</span></span><span leaf="">Â files:</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â Â </span><span><span leaf="">if</span></span><span leaf="">Â f ==Â </span><span><span leaf="">"expression.txt.gz"</span></span><span leaf="">: Â </span><span><span leaf="">#å¯¹expression.txt.gzæ–‡ä»¶é¢å¤–å¤„ç†</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  old_path = os.path.join(root, f)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â Â </span><span><span leaf=""># ä»è·¯å¾„é‡Œæ‹¿åˆ°GSMå·ï¼Œå‡è®¾GSMå·å°±æ˜¯å½“å‰ç›®å½•å</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  gsm_id = os.path.basename(root)Â </span><span><span leaf=""># os.path.basenameç”¨äºè·å–è·¯å¾„ä¸­çš„æœ€åä¸€éƒ¨åˆ†</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  new_fname = f</span><span><span leaf="">"{gsm_id}_{f}"</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  new_path = os.path.join(new_dir, new_fname)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  print(f</span><span><span leaf="">"Moving and renaming:\n Â {old_path}\nâ†’ {new_path}\n"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  shutil.move(old_path, new_path)</span><span leaf=""><br></span></code></pre><figure data-tool="mdniceç¼–è¾‘å™¨"><span leaf=""><img data-ratio="0.30734966592427615" data-type="png" data-w="898" data-imgfileid="100004799" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrLfSXSWY5HdYUlpGib9KNTohcbhh6M2to8soy5cqotyHZMRJ3Gh2HSFg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrLfSXSWY5HdYUlpGib9KNTohcbhh6M2to8soy5cqotyHZMRJ3Gh2HSFg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">8.å†æ¬¡è§£å‹ç¼©æ–‡ä»¶</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">import gzip</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># è§£å‹ç¼©</span></span><span leaf=""><br></span><span leaf="">base_dir =Â </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf="">Â root, dirs, filesÂ </span><span><span leaf="">in</span></span><span leaf="">Â os.walk(base_dir):</span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">for</span></span><span leaf="">Â fÂ </span><span><span leaf="">in</span></span><span leaf="">Â files:</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â Â </span><span><span leaf="">if</span></span><span leaf="">Â f.endswith(</span><span><span leaf="">".gz"</span></span><span leaf="">):</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  gz_path = os.path.join(root, f)</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  out_path = os.path.join(root, f[:-</span><span><span leaf="">3</span></span><span leaf="">]) Â </span><span><span leaf=""># å»æ‰ .gz åç¼€</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  print(f</span><span><span leaf="">"è§£å‹ {gz_path} åˆ° {out_path}"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  with gzip.open(gz_path,Â </span><span><span leaf="">'rb'</span></span><span leaf="">) as f_in:</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  with open(out_path,Â </span><span><span leaf="">'wb'</span></span><span leaf="">) as f_out:</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shutil.copyfileobj(f_in, f_out)</span><span leaf=""><br></span></code></pre><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">9.æå–æ ·æœ¬åç§°</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">dir_path =Â </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span leaf="">samples = [sÂ </span><span><span leaf="">for</span></span><span leaf="">Â sÂ </span><span><span leaf="">in</span></span><span leaf="">Â os.listdir(dir_path)Â </span><span><span leaf="">if</span></span><span leaf="">Â not s.startswith(</span><span><span leaf="">'.'</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">print(samples)</span><span leaf=""><br></span></code></pre><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">10.è¯»å–æ ·æœ¬</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">sce_list = []</span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf="">Â sampleÂ </span><span><span leaf="">in</span></span><span leaf="">Â samples:</span><span leaf=""><br></span><span leaf="">Â  Â  sample_path = os.path.join(dir_path, sample)</span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf=""># è¯»å–10Xæ ¼å¼æ•°æ®</span></span><span leaf=""><br></span><span leaf="">Â  Â  adata = sc.read_10x_mtx(sample_path, var_names=</span><span><span leaf="">'gene_symbols'</span></span><span leaf="">, cache=True)</span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf=""># è¿‡æ»¤ï¼šè‡³å°‘5ä¸ªç»†èƒçš„åŸºå› ï¼Œè‡³å°‘500ä¸ªåŸºå› çš„ç»†èƒ (å¯¹åº”min.cellså’Œmin.features)</span></span><span leaf=""><br></span><span leaf="">Â  Â  sc.pp.filter_genes(adata, min_cells=</span><span><span leaf="">5</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Â  Â  sc.pp.filter_cells(adata, min_genes=</span><span><span leaf="">500</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf=""># ç»™AnnDataæ·»åŠ é¡¹ç›®åç§°</span></span><span leaf=""><br></span><span leaf="">Â  Â  adata.obs[</span><span><span leaf="">'sample'</span></span><span leaf="">] = sample</span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf=""># ç»™ç»†èƒååŠ å‰ç¼€ï¼Œé˜²æ­¢é‡å¤</span></span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">#adata.obs_names = [f"{sample}_{cell}" for cell in adata.obs_names]</span></span><span leaf=""><br></span><span leaf="">Â  Â  sce_list.append(adata)</span><span leaf=""><br></span></code></pre><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">sce_list</span><span leaf=""><br></span></code></pre><figure data-tool="mdniceç¼–è¾‘å™¨"><span leaf=""><img data-ratio="0.5181598062953995" data-type="png" data-w="413" data-imgfileid="100004798" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsr4Utx2pTR6HEaIwiauTk4n3VFKM2l7UiciaibVkwCIoH6w3x4vTvthZk1YQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsr4Utx2pTR6HEaIwiauTk4n3VFKM2l7UiciaibVkwCIoH6w3x4vTvthZk1YQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">adata = sc.concat(sce_list)Â </span><span><span leaf="">#,label='sampleid',index_unique='_')</span></span><span leaf=""><br></span><span leaf="">adata.obs_names_make_unique()</span><span leaf=""><br></span><span leaf="">adata</span><span leaf=""><br></span></code></pre><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">adata.obs</span><span leaf=""><br></span></code></pre><figure data-tool="mdniceç¼–è¾‘å™¨"><span leaf=""><img data-ratio="1.1184971098265897" data-type="png" data-w="346" data-imgfileid="100004804" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrkk8ibxuXmicRgcqmxycfXxKpR16ibnDOe3lZLRNicOLjUOTfx1VibT29IAw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrkk8ibxuXmicRgcqmxycfXxKpR16ibnDOe3lZLRNicOLjUOTfx1VibT29IAw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span><span leaf="">11.ä¿å­˜æ ·æœ¬</span></span><span></span></h5><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">adata.write(</span><span><span leaf="">'./0_GSE259229/GSE259229.h5ad'</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdniceç¼–è¾‘å™¨"><strong><span leaf="">æ³¨</span></strong><span leaf="">ï¼šè‹¥å¯¹å†…å®¹æœ‰ç–‘æƒ‘æˆ–è€…æœ‰å‘ç°æ˜ç¡®é”™è¯¯çš„æœ‹å‹ï¼Œè¯·è”ç³»åå°(æ¬¢è¿äº¤æµ)ã€‚æ›´å¤šç›¸å…³å†…å®¹å¯å…³æ³¨å…¬ä¼—å·ï¼š</span><strong><span leaf="">ç”Ÿä¿¡æ–¹èˆŸ</span></strong><span leaf="">Â ã€‚</span></p><section><span></span></section></section><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com"><h2 data-tool="mdniceç¼–è¾‘å™¨"><span><span leaf="">ç»“å°¾</span></span><span></span><span></span></h2><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">æ¬¢è¿åŠ å…¥"ç”Ÿä¿¡&amp;ä¸´åºŠâ€œäº¤æµç¾¤ï¼Œè‹¥æœ‰æ„å‘è¿›ç¾¤çš„å°ä¼™ä¼´è¯·åŠ å¾®ä¿¡ï¼š</span><strong><span leaf="">couqiliugeziba321</span></strong><span leaf="">ï¼Œè¯·æ³¨æ˜â€œ</span><strong><span leaf="">å•ä½æˆ–å­¦æ ¡-ä¸“ä¸šæˆ–æ–¹å‘-å§“åæˆ–æ˜µç§°</span></strong><span leaf="">â€ã€‚å¸Œæœ›è¿›ç¾¤çš„ä½ æ”¶è·çŸ¥è¯†çš„åŒæ—¶ä¹Ÿèƒ½å¤Ÿæ”¶è·å¿«ä¹~ ğŸ¤—<img data-ratio="0.6166666666666667" data-type="png" data-w="1080" data-imgfileid="100004358" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyHhicvYGnNG4ykv8kpHtAFj11AWnpy95ONib1lQc42bTawwyRCYUqkTkuPRFfvYM65WZ8cFCiawuUYibA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyHhicvYGnNG4ykv8kpHtAFj11AWnpy95ONib1lQc42bTawwyRCYUqkTkuPRFfvYM65WZ8cFCiawuUYibA/640?wx_fmt=png&amp;from=appmsg"></span></p><section><span><span leaf="">- END -</span></span></section></section><p><span leaf=""><br></span></p><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/hPzkb5dEvaKMIx_8son5Sw",target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a>
