---
title: "复杂多样本10X单细胞数据整理及读取流程(Python)"
date: 2025-06-13T00:27:07Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
复杂多样本10X单细胞数据整理及读取流程(Python) by 生信方舟
------
<div><section><span leaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="生信方舟" data-alias="shengxinfangzhou" data-from="0" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGfe15Xm0WHdoAMNGvE93bmxaF9iabfPiaO9ic6Tmd8XW1PMiaeuqicSFhCLQJibAUhHsamS1LbaJMFiaZXA/0?wx_fmt=png" data-signature="热爱医学和数据科学，站在巨人的肩膀上，学习和整理相关的知识。" data-id="MzkwMjYyMDA1OA==" data-service_type="1" data-verify_status="0"></mp-common-profile></span></section><p><span leaf=""><br></span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf="">其实，如果数据很少的话可以选择手动整理。</span></p><p data-tool="mdnice编辑器"><span leaf="">既往整理过R语言版本的</span><span leaf="" data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;data-tool&quot;:&quot;mdnice编辑器&quot;,&quot;data-website&quot;:&quot;https://www.mdnice.com&quot;,&quot;style&quot;:&quot;margin-top: 0px;margin-bottom: 0px;margin-left: 0px;margin-right: 0px;padding-top: 0px;padding-bottom: 0px;padding-left: 10px;padding-right: 10px;background-attachment: scroll;background-clip: border-box;background-color: rgba(0, 0, 0, 0);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;font-family: Optima, 'Microsoft YaHei', PingFangSC-regular, serif;font-size: 16px;color: rgb(0, 0, 0);line-height: 1.5em;word-spacing: 0em;letter-spacing: 0em;word-break: break-word;overflow-wrap: break-word;text-align: left;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;data-tool&quot;:&quot;mdnice编辑器&quot;,&quot;style&quot;:&quot;color: rgb(0, 0, 0);font-size: 16px;line-height: 1.8em;letter-spacing: 0em;text-align: left;text-indent: 0em;margin-top: 0px;margin-bottom: 0px;margin-left: 0px;margin-right: 0px;padding-top: 8px;padding-bottom: 8px;padding-left: 0px;padding-right: 0px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">整理及读取</span><span leaf="">流程：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247485292&amp;idx=1&amp;sn=fa7234c2443934387c26a54e1bbf4120&amp;scene=21#wechat_redirect" textvalue="常见不同单细胞数据类型的读取及Seurat对象创建方法整理(单多样本/10X/h5/txt/csv/tsv)" data-itemshowtype="0" linktype="text" data-linktype="2">常见不同单细胞数据类型的读取及Seurat对象创建方法整理(单多样本/10X/h5/txt/csv/tsv)</a></span></p><p data-tool="mdnice编辑器"><span leaf="">此外也整理过简单的多样本10X单细胞数据整理及读取流程：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247488261&amp;idx=1&amp;sn=55b4227de0258642840c5da3159cb5b3&amp;scene=21#wechat_redirect" textvalue="Seurat和h5ad数据相互转化以及10X多样本数据整理和读取(Python)" data-itemshowtype="11" linktype="text" data-linktype="2">Seurat和h5ad数据相互转化以及10X多样本数据整理和读取(Python)</a></span></p><p data-tool="mdnice编辑器"><span leaf="">选择了GSE259229数据集~<img data-imgfileid="100004801" data-ratio="0.9114799446749654" data-type="png" data-w="723" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrvuWuAJtTS464sphnY3hfwyGX7JOVicHtgCLLK4mst1kCFLdYDkJQia1A/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrvuWuAJtTS464sphnY3hfwyGX7JOVicHtgCLLK4mst1kCFLdYDkJQia1A/640?wx_fmt=png&amp;from=appmsg"></span></p><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">整理及读取流程</span></span><span></span></h4><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">1.导入</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">import os</span><span leaf=""><br></span><span leaf="">import scanpy as sc</span><span leaf=""><br></span><span leaf="">import pandas as pd</span><span leaf=""><br></span><span leaf="">import tarfile </span><span><span leaf=""># 解压缩文件的库</span></span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">2.获取当前文件路径</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">path = os.getcwd()</span><span leaf=""><br></span><span leaf="">path</span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.解压缩</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 解压缩</span></span><span leaf=""><br></span><span leaf="">tar_path = </span><span><span leaf="">"GSE259229_RAW.tar"</span></span><span leaf=""><br></span><span leaf="">exreact_path = </span><span><span leaf="">"GSE259229_RAW"</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 解压缩</span></span><span leaf=""><br></span><span leaf="">with tarfile.open(tar_path,</span><span><span leaf="">"r"</span></span><span leaf="">) as tar:</span><span leaf=""><br></span><span leaf="">    tar.extractall(path = extract_path) </span><span><span leaf=""># extractall(...): 表示将 .tar 文件中的所有内容全部解压出来</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 查看解压后的文件列表</span></span><span leaf=""><br></span><span leaf="">files = os.listdir(exreact_path)</span><span leaf=""><br></span><span leaf="">print(files)</span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">4.提取样本名称，并重新创建新的数据文件夹</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">folder = </span><span><span leaf="">"GSE259229_RAW"</span></span><span leaf=""><br></span><span leaf="">filenames = [f </span><span><span leaf="">for</span></span><span leaf=""> f </span><span><span leaf="">in</span></span><span leaf=""> os.listdir(folder) </span><span><span leaf="">if</span></span><span leaf=""> not f.startswith(</span><span><span leaf="">"."</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 提取下划线 _ 前的样本名，并去重</span></span><span leaf=""><br></span><span leaf="">samples = list({f.split(</span><span><span leaf="">"_"</span></span><span leaf="">)[</span><span><span leaf="">0</span></span><span leaf="">] </span><span><span leaf="">for</span></span><span leaf=""> f </span><span><span leaf="">in</span></span><span leaf=""> filenames})</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">print(samples)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 3. 创建对应的文件夹</span></span><span leaf=""><br></span><span leaf="">base_dir = </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf=""> sample </span><span><span leaf="">in</span></span><span leaf=""> samples:</span><span leaf=""><br></span><span leaf="">    dir_path = os.path.join(base_dir, sample)</span><span leaf=""><br></span><span leaf="">    os.makedirs(dir_path, exist_ok=True)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 查看创建好的子文件夹</span></span><span leaf=""><br></span><span leaf="">print(os.listdir(base_dir))</span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">5.获取文件并移动位置</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">import shutil</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 1.获取每个文件的路径</span></span><span leaf=""><br></span><span leaf="">folder = </span><span><span leaf="">"GSE259229_RAW"</span></span><span leaf=""><br></span><span leaf="">base_dir = </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">fs = [os.path.join(folder, f) </span><span><span leaf="">for</span></span><span leaf=""> f </span><span><span leaf="">in</span></span><span leaf=""> os.listdir(folder)]</span><span leaf=""><br></span><span leaf="">print(fs)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 2. 提取原始文件夹中的文件名称，按照自己的文件要求提取样本名称</span></span><span leaf=""><br></span><span leaf="">filenames = [f </span><span><span leaf="">for</span></span><span leaf=""> f </span><span><span leaf="">in</span></span><span leaf=""> os.listdir(folder) </span><span><span leaf="">if</span></span><span leaf=""> not f.startswith(</span><span><span leaf="">"."</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf="">samples = list({f.split(</span><span><span leaf="">"_"</span></span><span leaf="">)[</span><span><span leaf="">0</span></span><span leaf="">] </span><span><span leaf="">for</span></span><span leaf=""> f </span><span><span leaf="">in</span></span><span leaf=""> filenames})</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 3.然后把文件夹中构成每个样本的文件移动到对应的文件夹中去</span></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf=""> file_path </span><span><span leaf="">in</span></span><span leaf=""> fs:  </span><span><span leaf=""># 第一层循环：遍历所有文件的完整路径</span></span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">for</span></span><span leaf=""> sample </span><span><span leaf="">in</span></span><span leaf=""> samples:  </span><span><span leaf=""># 第二层循环：遍历每个样本名</span></span><span leaf=""><br></span><span leaf="">        </span><span><span leaf="">if</span></span><span leaf=""> sample </span><span><span leaf="">in</span></span><span leaf=""> file_path:  </span><span><span leaf=""># 判断这个样本名是否出现在文件路径中</span></span><span leaf=""><br></span><span leaf="">            dest_dir = os.path.join(base_dir, sample)  </span><span><span leaf=""># 拼接出目标目录路径</span></span><span leaf=""><br></span><span leaf="">            os.makedirs(dest_dir, exist_ok=True)  </span><span><span leaf=""># 如果目标目录不存在就创建</span></span><span leaf=""><br></span><span leaf="">            shutil.copy(file_path, dest_dir)  </span><span><span leaf=""># 复制文件到目标目录</span></span><span leaf=""><br></span><span leaf="">            </span><span><span leaf="">break</span></span><span><span leaf=""># 一旦匹配成功就跳出内层循环，防止重复复制</span></span><span leaf=""><br></span><span leaf="">            </span><span leaf=""><br></span><span><span leaf=""># 查看某个样本文件夹的文件</span></span><span leaf=""><br></span><span leaf="">print(os.listdir(base_dir))</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-ratio="0.12037037037037036" data-type="png" data-w="1080" data-imgfileid="100004797" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsr25KhDgh0WCDebnVW0kF7KM5ob6M7uHWzVYmnicic6neia53Zeib1LRdBOg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsr25KhDgh0WCDebnVW0kF7KM5ob6M7uHWzVYmnicic6neia53Zeib1LRdBOg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">6.文件重命名</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">import re</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 获取base_dir路径下所有文件的名称</span></span><span leaf=""><br></span><span leaf="">base_dir = </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf=""> root, dirs, files </span><span><span leaf="">in</span></span><span leaf=""> os.walk(base_dir):</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">for</span></span><span leaf=""> f </span><span><span leaf="">in</span></span><span leaf=""> files:</span><span leaf=""><br></span><span leaf="">        </span><span><span leaf="">if</span></span><span leaf=""> f.startswith(</span><span><span leaf="">"."</span></span><span leaf="">):</span><span leaf=""><br></span><span leaf="">            continue  </span><span><span leaf=""># 跳过隐藏文件</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">        old_path = os.path.join(root, f)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># 正则说明：</span></span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># ^GSM\d+_ 匹配开头 GSM+数字+下划线</span></span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># [A-Z]{2}\d+ 匹配WT1、KO2、WT2等（两个大写字母+数字）</span></span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># 替换成空字符串，即去除这部分</span></span><span leaf=""><br></span><span leaf="">        new_fname = re.sub(r</span><span><span leaf="">'^GSM\d+_[A-Z]{2}\d+'</span></span><span leaf="">, </span><span><span leaf="">''</span></span><span leaf="">, f)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">        </span><span><span leaf=""># 去掉可能多余的下划线</span></span><span leaf=""><br></span><span leaf="">        new_fname = new_fname.lstrip(</span><span><span leaf="">'_'</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">        new_path = os.path.join(root, new_fname)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">        print(f</span><span><span leaf="">"Renaming:\n  {old_path}\n→ {new_path}\n"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">        os.rename(old_path, new_path)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-ratio="0.9653061224489796" data-type="png" data-w="490" data-imgfileid="100004800" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrK3oBnbB4MUFEIURgpR99JpvEPjKPcvS1lnbcMW6J5Xmmg4bQvosuYw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrK3oBnbB4MUFEIURgpR99JpvEPjKPcvS1lnbcMW6J5Xmmg4bQvosuYw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">7.对多余文件进行处理</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 把只有包含expression的文件进行额外处理</span></span><span leaf=""><br></span><span leaf="">import os</span><span leaf=""><br></span><span leaf="">import shutil</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">base_dir = </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span leaf="">base_dir_abs = os.path.abspath(base_dir) </span><span><span leaf=""># 获取绝对路径</span></span><span leaf=""><br></span><span leaf="">parent_dir = os.path.dirname(base_dir_abs) </span><span><span leaf=""># 获取上游路径</span></span><span leaf=""><br></span><span leaf="">new_dir = os.path.join(parent_dir, </span><span><span leaf="">"expression_GSE259229"</span></span><span leaf="">) </span><span><span leaf=""># 创建新的文件夹</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">if</span></span><span leaf=""> not os.path.exists(new_dir):</span><span leaf=""><br></span><span leaf="">    os.makedirs(new_dir)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># os.walk()是递归遍历工具。在每一层目录中产生一个三元组：</span></span><span leaf=""><br></span><span><span leaf="">#root 当前正在遍历的目录的路径</span></span><span leaf=""><br></span><span><span leaf="">#dirs 当前目录下的所有子目录名（列表）</span></span><span leaf=""><br></span><span><span leaf="">#files 当前目录下的所有文件名（列表）</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf=""> root, dirs, files </span><span><span leaf="">in</span></span><span leaf=""> os.walk(base_dir):</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">for</span></span><span leaf=""> f </span><span><span leaf="">in</span></span><span leaf=""> files:</span><span leaf=""><br></span><span leaf="">        </span><span><span leaf="">if</span></span><span leaf=""> f == </span><span><span leaf="">"expression.txt.gz"</span></span><span leaf="">:  </span><span><span leaf="">#对expression.txt.gz文件额外处理</span></span><span leaf=""><br></span><span leaf="">            old_path = os.path.join(root, f)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">            </span><span><span leaf=""># 从路径里拿到GSM号，假设GSM号就是当前目录名</span></span><span leaf=""><br></span><span leaf="">            gsm_id = os.path.basename(root) </span><span><span leaf=""># os.path.basename用于获取路径中的最后一部分</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">            new_fname = f</span><span><span leaf="">"{gsm_id}_{f}"</span></span><span leaf=""><br></span><span leaf="">            new_path = os.path.join(new_dir, new_fname)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">            print(f</span><span><span leaf="">"Moving and renaming:\n  {old_path}\n→ {new_path}\n"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">            shutil.move(old_path, new_path)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-ratio="0.30734966592427615" data-type="png" data-w="898" data-imgfileid="100004799" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrLfSXSWY5HdYUlpGib9KNTohcbhh6M2to8soy5cqotyHZMRJ3Gh2HSFg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrLfSXSWY5HdYUlpGib9KNTohcbhh6M2to8soy5cqotyHZMRJ3Gh2HSFg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">8.再次解压缩文件</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">import gzip</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 解压缩</span></span><span leaf=""><br></span><span leaf="">base_dir = </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf=""> root, dirs, files </span><span><span leaf="">in</span></span><span leaf=""> os.walk(base_dir):</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">for</span></span><span leaf=""> f </span><span><span leaf="">in</span></span><span leaf=""> files:</span><span leaf=""><br></span><span leaf="">        </span><span><span leaf="">if</span></span><span leaf=""> f.endswith(</span><span><span leaf="">".gz"</span></span><span leaf="">):</span><span leaf=""><br></span><span leaf="">            gz_path = os.path.join(root, f)</span><span leaf=""><br></span><span leaf="">            out_path = os.path.join(root, f[:-</span><span><span leaf="">3</span></span><span leaf="">])  </span><span><span leaf=""># 去掉 .gz 后缀</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">            print(f</span><span><span leaf="">"解压 {gz_path} 到 {out_path}"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">            with gzip.open(gz_path, </span><span><span leaf="">'rb'</span></span><span leaf="">) as f_in:</span><span leaf=""><br></span><span leaf="">                with open(out_path, </span><span><span leaf="">'wb'</span></span><span leaf="">) as f_out:</span><span leaf=""><br></span><span leaf="">                    shutil.copyfileobj(f_in, f_out)</span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">9.提取样本名称</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">dir_path = </span><span><span leaf="">"0_GSE259229"</span></span><span leaf=""><br></span><span leaf="">samples = [s </span><span><span leaf="">for</span></span><span leaf=""> s </span><span><span leaf="">in</span></span><span leaf=""> os.listdir(dir_path) </span><span><span leaf="">if</span></span><span leaf=""> not s.startswith(</span><span><span leaf="">'.'</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">print(samples)</span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">10.读取样本</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">sce_list = []</span><span leaf=""><br></span><span><span leaf="">for</span></span><span leaf=""> sample </span><span><span leaf="">in</span></span><span leaf=""> samples:</span><span leaf=""><br></span><span leaf="">    sample_path = os.path.join(dir_path, sample)</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf=""># 读取10X格式数据</span></span><span leaf=""><br></span><span leaf="">    adata = sc.read_10x_mtx(sample_path, var_names=</span><span><span leaf="">'gene_symbols'</span></span><span leaf="">, cache=True)</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf=""># 过滤：至少5个细胞的基因，至少500个基因的细胞 (对应min.cells和min.features)</span></span><span leaf=""><br></span><span leaf="">    sc.pp.filter_genes(adata, min_cells=</span><span><span leaf="">5</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">    sc.pp.filter_cells(adata, min_genes=</span><span><span leaf="">500</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf=""># 给AnnData添加项目名称</span></span><span leaf=""><br></span><span leaf="">    adata.obs[</span><span><span leaf="">'sample'</span></span><span leaf="">] = sample</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf=""># 给细胞名加前缀，防止重复</span></span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">#adata.obs_names = [f"{sample}_{cell}" for cell in adata.obs_names]</span></span><span leaf=""><br></span><span leaf="">    sce_list.append(adata)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">sce_list</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-ratio="0.5181598062953995" data-type="png" data-w="413" data-imgfileid="100004798" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsr4Utx2pTR6HEaIwiauTk4n3VFKM2l7UiciaibVkwCIoH6w3x4vTvthZk1YQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsr4Utx2pTR6HEaIwiauTk4n3VFKM2l7UiciaibVkwCIoH6w3x4vTvthZk1YQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">adata = sc.concat(sce_list) </span><span><span leaf="">#,label='sampleid',index_unique='_')</span></span><span leaf=""><br></span><span leaf="">adata.obs_names_make_unique()</span><span leaf=""><br></span><span leaf="">adata</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">adata.obs</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-ratio="1.1184971098265897" data-type="png" data-w="346" data-imgfileid="100004804" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrkk8ibxuXmicRgcqmxycfXxKpR16ibnDOe3lZLRNicOLjUOTfx1VibT29IAw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyH4PPd9WbYjYd4lBONyKSsrkk8ibxuXmicRgcqmxycfXxKpR16ibnDOe3lZLRNicOLjUOTfx1VibT29IAw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">11.保存样本</span></span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">adata.write(</span><span><span leaf="">'./0_GSE259229/GSE259229.h5ad'</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><strong><span leaf="">注</span></strong><span leaf="">：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。更多相关内容可关注公众号：</span><strong><span leaf="">生信方舟</span></strong><span leaf=""> 。</span></p><section><span></span></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span><span leaf="">结尾</span></span><span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">欢迎加入"生信&amp;临床“交流群，若有意向进群的小伙伴请加微信：</span><strong><span leaf="">couqiliugeziba321</span></strong><span leaf="">，请注明“</span><strong><span leaf="">单位或学校-专业或方向-姓名或昵称</span></strong><span leaf="">”。希望进群的你收获知识的同时也能够收获快乐~ 🤗<img data-ratio="0.6166666666666667" data-type="png" data-w="1080" data-imgfileid="100004358" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyHhicvYGnNG4ykv8kpHtAFj11AWnpy95ONib1lQc42bTawwyRCYUqkTkuPRFfvYM65WZ8cFCiawuUYibA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyHhicvYGnNG4ykv8kpHtAFj11AWnpy95ONib1lQc42bTawwyRCYUqkTkuPRFfvYM65WZ8cFCiawuUYibA/640?wx_fmt=png&amp;from=appmsg"></span></p><section><span><span leaf="">- END -</span></span></section></section><p><span leaf=""><br></span></p><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/hPzkb5dEvaKMIx_8son5Sw",target="_blank" rel="noopener noreferrer">原文链接</a>
