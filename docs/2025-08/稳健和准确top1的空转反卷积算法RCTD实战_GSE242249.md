---
title: "稳健和准确top1的空转反卷积算法RCTD实战：GSE242249"
date: 2025-08-25T03:21:26Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
稳健和准确top1的空转反卷积算法RCTD实战：GSE242249 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">前面我们分享了两篇空转反卷积的方法测评，其中RCTD位于推荐榜首</span>，今天就用这篇文献《Integrating spatial transcriptomics and single-cell RNA-sequencing reveals the alterations in epithelial cells during nodular formation in benign prostatic hyperplasia》中的数据试试看性能怎么样！</span></p><p data-tool="mdnice编辑器"><span leaf="">文献背景：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247544609&amp;idx=1&amp;sn=54978044335c716774864dfb82620bd8&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">一个样本的空间转录组数据分析：挖掘好思路（GSE242249）</a></span></p><p data-tool="mdnice编辑器"><span leaf="">测评解读：</span></p><ul><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247544052&amp;idx=1&amp;sn=598b1828eaeafa4a9419fdbd9f45987a&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">空间转录组细胞解卷积的实用指南：18种方法测评</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247543918&amp;idx=1&amp;sn=666028b572a688b5f38f1a7a5a8964b9&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">空转反卷积方法哪家好：来看看主流的10种算法大比拼</a></span></section></li></ul><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">数据背景</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">共84,835个细胞被注释为上皮细胞、间质细胞（内皮细胞、成纤维细胞和平滑肌细胞[SMC]）以及免疫细胞（T细胞、髓系细胞、浆细胞、肥大细胞和B细胞）。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7TWHnQC9PcEbW6yVvAKagqdlRWkqnuuyQO6JvIZGyjPuFWyne21qQoQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.3333333333333333" data-type="png" data-w="1080" data-imgfileid="100061037" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7TWHnQC9PcEbW6yVvAKagqdlRWkqnuuyQO6JvIZGyjPuFWyne21qQoQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">单细胞数据GEO编号为：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE172357，样本为其中的部分，选取的12个样本如下：</span></p><section data-tool="mdnice编辑器"><table><thead><tr><th><strong><span leaf="">Patients</span></strong></th><th><strong><span leaf="">Sample</span></strong></th><th><strong><span leaf="">Matrix ID</span></strong></th><th><strong><span leaf="">Group</span></strong></th><th><strong><span leaf="">Nodule</span></strong></th><th><strong><span leaf="">Detection</span></strong></th><th><strong><span leaf="">5ARIs treatment</span></strong></th><th><strong><span leaf="">Cells (spots) after filtering</span></strong></th></tr></thead><tbody><tr><td><section><span leaf="">P1</span></section></td><td><section><span leaf="">BPH283_GN</span></section></td><td><section><span leaf="">GSM5252126</span></section></td><td><section><span leaf="">BPH</span></section></td><td><section><span leaf="">Yes(GN)</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">No</span></section></td><td><section><span leaf="">4,483</span></section></td></tr><tr><td><section><span leaf=""><br></span></section></td><td><section><span leaf="">BPH283_SN</span></section></td><td><section><span leaf="">GSM5252127</span></section></td><td><section><span leaf="">BPH</span></section></td><td><section><span leaf="">Yes(SN)</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">No</span></section></td><td><section><span leaf="">2,964</span></section></td></tr><tr><td><section><span leaf="">P2</span></section></td><td><section><span leaf="">BPH327_GN</span></section></td><td><section><span leaf="">GSM5252128</span></section></td><td><section><span leaf="">BPH</span></section></td><td><section><span leaf="">Yes(GN)</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">No</span></section></td><td><section><span leaf="">5,389</span></section></td></tr><tr><td><section><span leaf=""><br></span></section></td><td><section><span leaf="">BPH327_SN</span></section></td><td><section><span leaf="">GSM5252129</span></section></td><td><section><span leaf="">BPH</span></section></td><td><section><span leaf="">Yes(SN)</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">No</span></section></td><td><section><span leaf="">8,744</span></section></td></tr><tr><td><section><span leaf="">P3</span></section></td><td><section><span leaf="">BPH340_GN</span></section></td><td><section><span leaf="">GSM5252130</span></section></td><td><section><span leaf="">BPH</span></section></td><td><section><span leaf="">Yes(GN)</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">No</span></section></td><td><section><span leaf="">7,364</span></section></td></tr><tr><td><section><span leaf=""><br></span></section></td><td><section><span leaf="">BPH340_SN</span></section></td><td><section><span leaf="">GSM5252131</span></section></td><td><section><span leaf="">BPH</span></section></td><td><section><span leaf="">Yes(SN)</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">No</span></section></td><td><section><span leaf="">7,523</span></section></td></tr><tr><td><section><span leaf="">P4</span></section></td><td><section><span leaf="">BPH389_GN</span></section></td><td><section><span leaf="">GSM5252132</span></section></td><td><section><span leaf="">BPH</span></section></td><td><section><span leaf="">Yes(GN)</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">No</span></section></td><td><section><span leaf="">6,000</span></section></td></tr><tr><td><section><span leaf=""><br></span></section></td><td><section><span leaf="">BPH389_SN</span></section></td><td><section><span leaf="">GSM5252133</span></section></td><td><section><span leaf="">BPH</span></section></td><td><section><span leaf="">Yes(SN)</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">No</span></section></td><td><section><span leaf="">13,596</span></section></td></tr><tr><td><section><span leaf="">P5</span></section></td><td><section><span leaf="">BPH511_GN</span></section></td><td><section><span leaf="">GSM5252134</span></section></td><td><section><span leaf="">BPH</span></section></td><td><section><span leaf="">Yes(GN)</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">No</span></section></td><td><section><span leaf="">9,993</span></section></td></tr><tr><td><section><span leaf="">D17</span></section></td><td><section><span leaf="">D17</span></section></td><td><section><span leaf="">GSM5252458</span></section></td><td><section><span leaf="">Normal</span></section></td><td><section><span leaf="">-</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">-</span></section></td><td><section><span leaf="">6,125</span></section></td></tr><tr><td><section><span leaf="">D27</span></section></td><td><section><span leaf="">D27</span></section></td><td><section><span leaf="">GSM5252460</span></section></td><td><section><span leaf="">Normal</span></section></td><td><section><span leaf="">-</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">-</span></section></td><td><section><span leaf="">7,612</span></section></td></tr><tr><td><section><span leaf="">D35</span></section></td><td><section><span leaf="">D35</span></section></td><td><section><span leaf="">GSM5252462</span></section></td><td><section><span leaf="">Normal</span></section></td><td><section><span leaf="">-</span></section></td><td><section><span leaf="">scRNA-seq</span></section></td><td><section><span leaf="">-</span></section></td><td><section><span leaf="">5,688</span></section></td></tr></tbody></table></section><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">数据读取</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">下载下来后进行数据读取，并创建seurat对象：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf="">###</span></span><span leaf=""><br></span><span><span leaf="">### Create: Jianming Zeng</span></span><span leaf=""><br></span><span><span leaf="">### Date:  2023-12-31  </span></span><span leaf=""><br></span><span><span leaf="">### Email: jmzeng1314@163.com</span></span><span leaf=""><br></span><span><span leaf="">### Blog: http://www.bio-info-trainee.com/</span></span><span leaf=""><br></span><span><span leaf="">### Forum:  http://www.biotrainee.com/thread-1376-1-1.html</span></span><span leaf=""><br></span><span><span leaf="">### CAFS/SUSTC/Eli Lilly/University of Macau</span></span><span leaf=""><br></span><span><span leaf="">### Update Log: 2023-12-31   First version </span></span><span leaf=""><br></span><span><span leaf="">### Update Log: 2024-12-09   by juan zhang (492482942@qq.com)</span></span><span leaf=""><br></span><span><span leaf="">### </span></span><span leaf=""><br></span><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span leaf="">library(ggsci)</span><span leaf=""><br></span><span leaf="">library(dplyr) </span><span leaf=""><br></span><span leaf="">library(future)</span><span leaf=""><br></span><span leaf="">library(Seurat)</span><span leaf=""><br></span><span leaf="">library(clustree)</span><span leaf=""><br></span><span leaf="">library(cowplot)</span><span leaf=""><br></span><span leaf="">library(data.table)</span><span leaf=""><br></span><span leaf="">library(ggplot2)</span><span leaf=""><br></span><span leaf="">library(patchwork)</span><span leaf=""><br></span><span leaf="">library(stringr)</span><span leaf=""><br></span><span leaf="">library(qs)</span><span leaf=""><br></span><span leaf="">library(Matrix)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 创建目录</span></span><span leaf=""><br></span><span leaf="">getwd()</span><span leaf=""><br></span><span leaf="">gse &lt;- </span><span><span leaf="">"GSE172357"</span></span><span leaf=""><br></span><span leaf="">dir.create(gse)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 方式一：标准文件夹</span></span><span leaf=""><br></span><span><span leaf="">###### step1: 导入数据 ######   </span></span><span leaf=""><br></span><span leaf="">samples &lt;- list.files(</span><span><span leaf="">"GSE172357/"</span></span><span leaf="">, pattern = </span><span><span leaf="">"h5$"</span></span><span leaf="">,recursive = F, full.names = F)</span><span leaf=""><br></span><span leaf="">samples</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 挑选文献中的12个</span></span><span leaf=""><br></span><span leaf="">files &lt;- c(samples[1:9],samples[15],samples[17],samples[19])</span><span leaf=""><br></span><span leaf="">files</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">scRNAlist &lt;- lapply(files, </span><span><span leaf="">function</span></span><span leaf="">(pro){</span><span leaf=""><br></span><span><span leaf="">#pro &lt;- files[1]</span></span><span leaf=""><br></span><span><span leaf="">print</span></span><span leaf="">(pro)</span><span leaf=""><br></span><span leaf="">  counts &lt;- Read10X_h5(paste0(</span><span><span leaf="">"GSE172357/"</span></span><span leaf="">,pro))</span><span leaf=""><br></span><span leaf="">  name &lt;- str_split(pro, pattern = </span><span><span leaf="">"_Via_|_Fcol_|_filtered"</span></span><span leaf="">,simplify = T,n = 2)[,1]</span><span leaf=""><br></span><span><span leaf="">print</span></span><span leaf="">(name)</span><span leaf=""><br></span><span leaf="">  sce &lt;- CreateSeuratObject(counts, project=name, min.cells = 3)</span><span leaf=""><br></span><span><span leaf="">return</span></span><span leaf="">(sce)</span><span leaf=""><br></span><span leaf="">})</span><span leaf=""><br></span><span leaf="">names(scRNAlist) &lt;-  str_split(files, pattern = </span><span><span leaf="">"_Via_|_Fcol_|_filtered"</span></span><span leaf="">,simplify = T,n = 2)[,1]</span><span leaf=""><br></span><span leaf="">scRNAlist</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># merge</span></span><span leaf=""><br></span><span leaf="">sce.all &lt;- merge(scRNAlist[[1]], y=scRNAlist[-1], add.cell.ids=names(scRNAlist))</span><span leaf=""><br></span><span leaf="">sce.all &lt;- JoinLayers(sce.all) </span><span><span leaf=""># seurat v5</span></span><span leaf=""><br></span><span leaf="">sce.all</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 查看特征</span></span><span leaf=""><br></span><span leaf="">as.data.frame(sce.all@assays</span><span><span leaf="">$RNA</span></span><span><span leaf="">$counts</span></span><span leaf="">[1:10, 1:2])</span><span leaf=""><br></span><span leaf="">head(sce.all@meta.data, 10)</span><span leaf=""><br></span><span leaf="">table(sce.all</span><span><span leaf="">$orig</span></span><span leaf="">.ident) </span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">library(qs)</span><span leaf=""><br></span><span leaf="">qsave(sce.all, file=</span><span><span leaf="">"GSE172357/sce.all.qs"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">挑选的12个样本如下：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7942A2PfDCSPwTI64BbibNXFB5ddYeqNqQlg3iaUsFQITudUJe0gIQEng/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.1175925925925926" data-type="png" data-w="1080" data-imgfileid="100061034" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7942A2PfDCSPwTI64BbibNXFB5ddYeqNqQlg3iaUsFQITudUJe0gIQEng/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">成功创建seurat对象：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7fvQDHSnfibGFuCKZ2y3vaGJkvmwZKnAdt9zm9wxjkA3k7Exru71uNQg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.2712962962962963" data-type="png" data-w="1080" data-imgfileid="100061036" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7fvQDHSnfibGFuCKZ2y3vaGJkvmwZKnAdt9zm9wxjkA3k7Exru71uNQg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">然后经过简单的质控降维聚类分群，注释如下：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb727vzGAWVwl7TQmBgTIk3SbfnUmKj45IGS5v9YdC9vfuyF9NA9HXLsg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8046296296296296" data-type="png" data-w="1080" data-imgfileid="100061038" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb727vzGAWVwl7TQmBgTIk3SbfnUmKj45IGS5v9YdC9vfuyF9NA9HXLsg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">运行RCTD反卷积</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">结合这篇推文：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247544661&amp;idx=1&amp;sn=cdf0c76ec6a6fcc156a2052e9b075a8f&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">空间转录组数据注释分析：RCTD反卷积(Nature Biotechnology IF: 33.1)</a>，来看看。</span></p><p data-tool="mdnice编辑器"><span leaf="">读取上次保存的空转数据：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247544609&amp;idx=1&amp;sn=54978044335c716774864dfb82620bd8&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">一个样本的空间转录组数据分析：挖掘好思路（GSE242249）</a></span></p><h3 data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><span></span><span><span leaf="">空转数据输入数据要求：</span></span><span></span></h3><ul><li><section><span leaf="">counts：矩阵的行名应为基因，列名应代表 barcode/pixel 名称。counts应为未经转换的原始counts数据。</span></section></li><li><section><span leaf="">coords：一个数值型数据框（或矩阵），用于表示空间像素的位置。行名是barcode/像素名称，且应包含两列，分别用于表示“x”坐标和“y”坐标。</span></section></li><li><section><span leaf="">nUMI：可选，每个空间位置的总umi数</span></section></li></ul><pre data-tool="mdnice编辑器"><code><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span leaf="">library(spacexr)</span><span leaf=""><br></span><span leaf="">library(Matrix)</span><span leaf=""><br></span><span leaf="">library(doParallel)</span><span leaf=""><br></span><span leaf="">library(ggplot2)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 输出文件夹，可以换成自己指定的</span></span><span leaf=""><br></span><span leaf="">savedir &lt;- </span><span><span leaf="">'RCTD_results_Run'</span></span><span leaf=""><br></span><span><span leaf="">if</span></span><span leaf="">(!dir.exists(savedir))</span><span leaf=""><br></span><span leaf="">  dir.create(savedir)</span><span leaf=""><br></span><span leaf="">knitr::opts_chunk</span><span><span leaf="">$set</span></span><span leaf="">(collapse = TRUE,comment = </span><span><span leaf="">"#&gt;"</span></span><span leaf="">,cache = TRUE,out.width = </span><span><span leaf="">"100%"</span></span><span leaf=""> )</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">load(</span><span><span leaf="">"../2024-GSE242249-空间单细胞-良性前列腺增生/spatial.Rdata"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">counts &lt;- as.matrix(spatial@assays</span><span><span leaf="">$Spatial</span></span><span><span leaf="">$counts</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">counts[1:10,1:5]</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7ic3dtRpbhZFv0va7JSibz4HEOnCh9EyiazA9g8ic7tVcTHEP50YWRMMJvg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.23148148148148148" data-type="png" data-w="1080" data-imgfileid="100061035" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7ic3dtRpbhZFv0va7JSibz4HEOnCh9EyiazA9g8ic7tVcTHEP50YWRMMJvg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">读取坐标：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf=""># 读取坐标</span></span><span leaf=""><br></span><span leaf="">centroids &lt;- spatial[[</span><span><span leaf="">"slice1"</span></span><span leaf="">]]@boundaries</span><span><span leaf="">$centroids</span></span><span leaf=""><br></span><span leaf="">coords &lt;- setNames(as.data.frame(centroids@coords), c(</span><span><span leaf="">"x"</span></span><span leaf="">, </span><span><span leaf="">"y"</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf="">rownames(coords) &lt;- centroids@cells</span><span leaf=""><br></span><span leaf="">head(coords)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7GDwDDJQGBxTkm86HEc1qf7ibPh1a3IU6aUHxIs3L3u5bw0Xp3iav55uw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.3727454909819639" data-type="png" data-w="499" data-imgfileid="100061041" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7GDwDDJQGBxTkm86HEc1qf7ibPh1a3IU6aUHxIs3L3u5bw0Xp3iav55uw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">计算umi并构建对象：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf=""># 计算每个位置的umi</span></span><span leaf=""><br></span><span leaf="">nUMI &lt;- colSums(counts) </span><span><span leaf=""># In this case, total counts per pixel is nUMI</span></span><span leaf=""><br></span><span leaf="">head(nUMI)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 构建一个对象</span></span><span leaf=""><br></span><span leaf="">puck &lt;- SpatialRNA(coords, counts, nUMI)</span><span leaf=""><br></span><span leaf="">puck</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">barcodes &lt;- colnames(puck@counts) </span><span><span leaf=""># pixels to be used (a list of barcode names). </span></span><span leaf=""><br></span><span leaf="">plot_puck_continuous(puck, barcodes, puck@nUMI, </span><span leaf=""><br></span><span leaf="">                     ylimit = c(0,round(quantile(puck@nUMI,0.9))), </span><span leaf=""><br></span><span leaf="">                     size = 2,</span><span leaf=""><br></span><span leaf="">                     title =</span><span><span leaf="">'plot of nUMI'</span></span><span leaf="">) </span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 看一下构建好的SpatialRNA对象</span></span><span leaf=""><br></span><span leaf="">str(puck)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7a3icDfmnNOfkZ4OBvABhhYNrLbYogeNWGL2YfScSicOOlXNOG2vB0kvA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8014440433212996" data-type="png" data-w="831" data-imgfileid="100061043" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb7a3icDfmnNOfkZ4OBvABhhYNrLbYogeNWGL2YfScSicOOlXNOG2vB0kvA/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><span></span><span><span leaf="">读取刚刚注释好的单细胞</span></span><span></span></h3><pre data-tool="mdnice编辑器"><code><span><span leaf=""># count值</span></span><span leaf=""><br></span><span leaf="">sce &lt;- readRDS(</span><span><span leaf="">"../../03-scRNA/2021-GSE172357-12-BPH/3-check-by-0.5/sce.all.int.rds"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">counts &lt;- as.matrix(sce@assays</span><span><span leaf="">$RNA</span></span><span><span leaf="">$counts</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">counts[1:5,1:5]</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 细胞类型：</span></span><span leaf=""><br></span><span leaf="">cell_types &lt;- sce</span><span><span leaf="">$celltype</span></span><span leaf=""><br></span><span leaf="">levels(cell_types)[-9]</span><span leaf=""><br></span><span leaf="">cell_types &lt;- factor(cell_types, levels = levels(cell_types)[-9])</span><span leaf=""><br></span><span leaf="">head(cell_types)</span><span leaf=""><br></span><span leaf="">table(cell_types)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># umi</span></span><span leaf=""><br></span><span leaf="">nUMI &lt;- sce</span><span><span leaf="">$nCount_RNA</span></span><span leaf=""><br></span><span leaf="">head(nUMI)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 构建对象</span></span><span leaf=""><br></span><span leaf="">reference &lt;- Reference(counts, cell_types, nUMI)</span><span leaf=""><br></span><span leaf="">str(reference)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb743TjJYiaYs5GScRqOibk4eBPlTKHcZNqH03hRUM3smUPZYsTtNvHEmRw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.556135770234987" data-type="png" data-w="766" data-imgfileid="100061042" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxDgFIFWCicPK1v7Ml3zSJb743TjJYiaYs5GScRqOibk4eBPlTKHcZNqH03hRUM3smUPZYsTtNvHEmRw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><span></span><span><span leaf="">运行RCTD</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">这里注意线程数 max_cores，我用的服务器，资源比较多：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf=""># 运行</span></span><span leaf=""><br></span><span leaf="">myRCTD &lt;- create.RCTD(puck, reference, max_cores = 60)</span><span leaf=""><br></span><span leaf="">myRCTD &lt;- run.RCTD(myRCTD, doublet_mode = </span><span><span leaf="">'full'</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">saveRDS(myRCTD,</span><span><span leaf="">'myRCTD_visium_full.rds'</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">这里细胞数比较多，实战不知道还会运行多久~</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">Begin: process_cell_type_info</span><span leaf=""><br></span><span leaf="">process_cell_type_info: number of cells </span><span><span leaf="">in</span></span><span leaf=""> reference: 64142</span><span leaf=""><br></span><span leaf="">process_cell_type_info: number of genes </span><span><span leaf="">in</span></span><span leaf=""> reference: 27508</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">做到这里突然还意识到一个问题：</span>我采用的是文献中类似的注释水平，但是单细胞的注释应该要再详细一点的，其中髓系细胞都没有分开呢，那结果解读很多不是没有办法展开吗？后面再做一个详细版本的吧~</span></p><p data-tool="mdnice编辑器"><span leaf="">本次分享到这，明天发可视化结果，与文献比较看看，感受一下RCTD结果怎么样~</span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><h4 data-tool="mdnice编辑器"><span leaf="">文末友情宣传</span></h4><p data-tool="mdnice编辑器"><span leaf="">强烈建议你推荐给身边的</span><strong><span leaf="">博士后以及年轻生物学PI</span></strong><span leaf="">，多一点数据认知，让他们的科研上一个台阶：</span></p><ul></ul></section><ul><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247544311&amp;idx=1&amp;sn=d41b5838e799f52280e78703135bb603&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课8月班" data-itemshowtype="0" linktype="text" data-linktype="2">生信入门&amp;数据挖掘线上直播课8月班</a><span textstyle="">，你的生物信息学入门课</span></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525079&amp;idx=1&amp;sn=0b997af16a58195b4192691373048fd5&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" textvalue="满足你生信分析计算需求的低价解决方案" data-itemshowtype="0" linktype="text" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=1679199708449144836&amp;scene=173&amp;subscene=207&amp;sessionid=1745492310&amp;enterid=1745492314&amp;from_msgid=2247541298&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信故事会" data-itemshowtype="0" linktype="text" data-linktype="2">生信故事会</a>，来看看他们的生信入门故事</span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=3690970204957147140&amp;scene=173&amp;subscene=207&amp;sessionid=1745066271&amp;enterid=1745066274&amp;from_msgid=2247540702&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信马拉松答疑专辑" data-itemshowtype="0" linktype="text" data-linktype="2">生信马拉松答疑专辑</a>，获取你的生信专属答疑</span></section></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/6CPVHC-FH-ucX9qFLALcOA",target="_blank" rel="noopener noreferrer">原文链接</a>
