---
title: "如何合并多个体细胞突变检测工具的输出结果"
date: 2025-08-07T14:56:19Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
如何合并多个体细胞突变检测工具的输出结果 by 生信菜鸟团
------
<div><h3 data-pm-slice="0 0 []"><span leaf="">简介</span></h3><p><span leaf="">在肿瘤基因组数据分析方法中，很多文章会使用多个软件 call 突变，然后进行合并，常用见的方法就是多个软件得到的结果中，一个突变在两个或两个以上的软件检测到即保留，认为其可信度较高。合并策略通常有两种：取交集（只保留两个工具都检测到的变异）或取并集（保留任一工具检测到的变异）。但是不同的突变检测工具，得到的 vcf 文件并不完全一致，因为不同工具定义的 format tag 不太一致。所以直接进行合并可能导致格式有问题。这里简单简介一种比较粗暴的vcf 取交集的方法。主要是针对体细胞突变检测工具 Mutect2 和 Strelka2 的结果。</span></p><h3><span leaf="">vcf 文件格式</span></h3><p><span leaf="">既然是要对 vcf 文件进行合并，就要深入了解 vcf 文件格式。vcf(Variant Call Format)：保存基因组变异数据的文本文件，分为头部区和主体区。</span></p><p><span leaf=""><span textstyle="">头部区</span>：以 ## 开头的注释信息，注明了vcf的版本，生成的命令，以及对主体区各部分信息的解释。</span></p><p><span leaf=""><span textstyle="">主体区</span>：除了列名之外，每一行即为一个突变信息。</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosicU8KPJXUFJcLqRI79R0IiadQ7zNvofaf0bEn4dkVuhzw0lk42U4cOQfuRSRibac2VHTLNaatic5u5tQ/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="1.1778290993071594" data-type="jpeg" data-w="433" data-imgfileid="100052479" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosicU8KPJXUFJcLqRI79R0IiadQ7zNvofaf0bEn4dkVuhzw0lk42U4cOQfuRSRibac2VHTLNaatic5u5tQ/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span leaf="">一个实际的 vcf 文件（体细胞突变）主体区的截图如下：</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosicU8KPJXUFJcLqRI79R0Iiade4QQHtvxRLcV3c6Wa5TfRPY3700tj79utGLXL7g4biaxhy6S1z3hO9Q/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="0.41574074074074074" data-type="jpeg" data-w="1080" data-imgfileid="100052483" src="https://mmbiz.qpic.cn/mmbiz_jpg/iaRJcrq2LosicU8KPJXUFJcLqRI79R0Iiade4QQHtvxRLcV3c6Wa5TfRPY3700tj79utGLXL7g4biaxhy6S1z3hO9Q/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span leaf="">对以上信息的每一列解释为：</span></p><table><thead><tr><th data-colwidth="98"><strong><span leaf="">列名</span></strong></th><th data-colwidth="111"><strong><span leaf="">内容</span></strong></th><th><strong><span leaf="">解释</span></strong></th></tr></thead><tbody><tr><td data-colwidth="98"><section><span leaf="">CHROM</span></section></td><td data-colwidth="111"><section><span leaf="">chr1</span></section></td><td><section><span leaf="">变异位点所在的contig，对于人类数据就是chr1/2…….</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">POS</span></section></td><td data-colwidth="111"><section><span leaf="">2400969</span></section></td><td><section><span leaf="">变异位点相对于参考基因组所在的位置</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">ID</span></section></td><td data-colwidth="111"><section><span leaf="">.</span></section></td><td><section><span leaf="">Variant位点对应 dbSNP数据库的ID，若没有，则用 . 表示</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">REF</span></section></td><td data-colwidth="111"><section><span leaf="">T</span></section></td><td><section><span leaf="">参考基因组中所对应的碱基</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">ALT</span></section></td><td data-colwidth="111"><section><span leaf="">G</span></section></td><td><section><span leaf="">样品中该位置突变后的碱基</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">QUAL</span></section></td><td data-colwidth="111"><section><span leaf="">.</span></section></td><td><section><span leaf="">质量值，当Q=20时，错误率就控制在了0.01（注：somatic不标注质量值）</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">FILTER</span></section></td><td data-colwidth="111"><section><span leaf="">PASS</span></section></td><td><section><span leaf="">通过某些标准过滤后的变异位点的FILTER一栏就会注释一个PASS，不通过的为‘.’</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">INFO</span></section></td><td data-colwidth="111"><section><span leaf="">DP=309;ROQ=39;TLOD=8.58</span></section></td><td><section><span leaf="">variant的详细信息，内容很多，可以在头部区找到对应的解释，每个软件这一列给出的tag不一定相同。</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">FORMAT</span></section></td><td data-colwidth="111"><section><span leaf="">GT:AD:AF:DP:F1R2:F2R1:SB</span></section></td><td><section><span leaf="">GT：样品的基因型；AD(Allele Depth)前者对应ref基因型，后者对应variant基因型； DP（Depth）为sample中该位点的覆盖度。</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">Normal</span></section></td><td data-colwidth="111"><section><span leaf="">0/0:161,0:0.055:161:70,0:87,0:77,84,0,0</span></section></td><td><section><span leaf="">第一个样本的format信息</span></section></td></tr><tr><td data-colwidth="98"><section><span leaf="">Tumor</span></section></td><td data-colwidth="111"><section><span leaf="">0/1:137,5:0.044:142:62,3:72,2:64,73,2,3</span></section></td><td><section><span leaf="">第二个样本的format信息</span></section></td></tr></tbody></table><p><span leaf="">如果想对vcf文件有一个更加深入的了解，可以查看官方帮助文档：https://samtools.github.io/hts-specs/VCFv4.2.pdf</span></p><h3><span leaf="">Mutect2 的 vcf 文件</span></h3><p><span leaf="">Mutect2 的体细胞突变检测方法在<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247499961&amp;idx=1&amp;sn=133aef62c2983b88a0a74aec1ff33333&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">GATK 的Somatic Mutation流程--肿瘤基因组测序数据分析专栏</a> 已经有详细介绍了。如果不看 vcf 的 header 的话，主要突变信息的内容是：</span></p><pre><ol><li><span><span><code><span><span leaf="">less </span></span><span><span leaf="">-</span></span><span><span leaf="">S </span></span><span><span leaf="">6.mutect</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf </span></span><span><span leaf="">|</span></span><span><span leaf="">grep </span></span><span><span leaf="">-</span></span><span><span leaf="">v </span></span><span><span leaf="">'##'</span></span><span></span><span><span leaf="">|</span></span><span><span leaf="">less </span></span><span><span leaf="">-</span></span><span><span leaf="">S</span></span></code></span></span></li></ol></pre><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicU8KPJXUFJcLqRI79R0IiadUxLUl2bjgw5hljhCq97J5YcMpRGLfkrFnUnSg3MeAoWrlibs0Zf8Qeg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7527777777777778" data-type="png" data-w="1080" data-imgfileid="100052481" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicU8KPJXUFJcLqRI79R0IiadUxLUl2bjgw5hljhCq97J5YcMpRGLfkrFnUnSg3MeAoWrlibs0Zf8Qeg/640?wx_fmt=png&amp;from=appmsg"></section><h3><span leaf="">Strelka2 的 vcf 文件</span></h3><p><span leaf="">Strelka2 的体细胞突变检测方法在<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247500600&amp;idx=1&amp;sn=cbd7d3fc0dfc13338124c613bbf4552a&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">Strelka2 call Somatic 流程--肿瘤基因组测序数据分析专栏</a> 已经有详细介绍了。其体细胞突变检测的结果分为 SNV 和 INDELs 两个 vcf 文件，需要先进行合并：</span></p><pre><ol><li><span><span><code><span><span leaf="">zcat </span></span><span><span leaf="">6.strelka</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B</span></span><span><span leaf="">/</span></span><span><span leaf="">results</span></span><span><span leaf="">/</span></span><span><span leaf="">variants</span></span><span><span leaf="">/</span></span><span><span leaf="">somatic</span></span><span><span leaf="">.</span></span><span><span leaf="">snvs</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span><span><span leaf="">.</span></span><span><span leaf="">gz </span></span><span><span leaf="">|</span></span><span><span leaf=""> \</span></span></code></span></span></li><li><span><span><code><span><span leaf="">grep </span></span><span><span leaf="">-</span></span><span><span leaf="">v </span></span><span><span leaf="">'^#'</span></span><span></span><span><span leaf="">&gt;</span></span><span><span leaf="">6.strelka</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span></code></span></span></li><li><span><span><code></code></span></span></li><li><span><span><code><span><span leaf="">zcat </span></span><span><span leaf="">6.strelka</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B</span></span><span><span leaf="">/</span></span><span><span leaf="">results</span></span><span><span leaf="">/</span></span><span><span leaf="">variants</span></span><span><span leaf="">/*gz | grep -v '^#' | \</span></span></code></span></span></li><li><span><span><code><span><span leaf="">grep 'PASS' |sort -V &gt;&gt;6.strelka/case1_biorep_B_filter.vcf</span></span></code></span></span></li><li><span><span><code></code></span></span></li><li><span><span><code><span><span leaf="">less -S  6.strelka/case1_biorep_B_filter.vcf |grep -v '##' |less -S</span></span></code></span></span></li></ol></pre><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicU8KPJXUFJcLqRI79R0Iiaddeh6ogibKNL0yDTFQEzuYJ2ibY9BHFicvkTDas2eicx1dJjBB02fAeOrDg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7083333333333334" data-type="png" data-w="1080" data-imgfileid="100052482" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicU8KPJXUFJcLqRI79R0Iiaddeh6ogibKNL0yDTFQEzuYJ2ibY9BHFicvkTDas2eicx1dJjBB02fAeOrDg/640?wx_fmt=png&amp;from=appmsg"></section><h3><span leaf="">合并两个 vcf 文件</span></h3><p><span leaf="">如果突变检测只用了 Mutect2 和 Strelka2 ，可以用下面代码进行合并。首先使用 bcftools index 对文件进行构建索引：</span></p><pre><ol><li><span><span><code><span><span leaf="">bgzip </span></span><span><span leaf="">-</span></span><span><span leaf="">c </span></span><span><span leaf="">6.mutect</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf \</span></span></code></span></span></li><li><span><span><code><span><span leaf="">&gt;</span></span><span></span><span><span leaf="">6.mutect</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span><span><span leaf="">.</span></span><span><span leaf="">gz</span></span></code></span></span></li><li><span><span><code></code></span></span></li><li><span><span><code><span><span leaf="">bcftools index </span></span><span><span leaf="">6.mutect</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span><span><span leaf="">.</span></span><span><span leaf="">gz</span></span></code></span></span></li><li><span><span><code></code></span></span></li><li><span><span><code><span><span leaf="">bgzip </span></span><span><span leaf="">-</span></span><span><span leaf="">c </span></span><span><span leaf="">6.strelka</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf \</span></span></code></span></span></li><li><span><span><code><span><span leaf="">&gt;</span></span><span></span><span><span leaf="">6.strelka</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span><span><span leaf="">.</span></span><span><span leaf="">gz</span></span></code></span></span></li><li><span><span><code></code></span></span></li><li><span><span><code><span><span leaf="">bcftools index </span></span><span><span leaf="">6.strelka</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span><span><span leaf="">.</span></span><span><span leaf="">gz</span></span></code></span></span></li></ol></pre><p><span leaf="">然后使用 bcftools isec 进行取交集：</span></p><pre><ol><li><span><span><code><span><span leaf="">bcftools isec </span></span><span><span leaf="">-</span></span><span><span leaf="">p </span></span><span><span leaf="">6.merge</span></span><span></span><span><span leaf="">-</span></span><span><span leaf="">n</span></span><span><span leaf="">=</span></span><span><span leaf="">2</span></span><span></span><span><span leaf="">-</span></span><span><span leaf="">w1      \</span></span></code></span></span></li><li><span><span><code><span><span leaf="">6.mutect</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span><span><span leaf="">.</span></span><span><span leaf="">gz  \</span></span></code></span></span></li><li><span><span><code><span><span leaf="">6.strelka</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span><span><span leaf="">.</span></span><span><span leaf="">gz</span></span></code></span></span></li><li><span><span><code></code></span></span></li><li><span><span><code><span><span leaf="">mv </span></span><span><span leaf="">6.merge</span></span><span><span leaf="">/</span></span><span><span leaf="">0000.vcf</span></span><span></span><span><span leaf="">6.merge</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span><span><span leaf="">.</span></span><span><span leaf="">gz</span></span></code></span></span></li></ol></pre><p><span leaf="">这样最后得到的 </span><code><span><span leaf="">6.merge</span></span><span><span leaf="">/</span></span><span><span leaf="">case1_biorep_B_filter</span></span><span><span leaf="">.</span></span><span><span leaf="">vcf</span></span></code><span leaf="">就是 Mutect2 和 Strelka2 的 overlap 了。可以看到合并后的 vcf 文件 header 部分有多出来 bcftools 的处理信息。</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicU8KPJXUFJcLqRI79R0IiadZEg50iaia03DWykU8nSloL3CLxxmnxiaic6tcMF6EwxLaJKIicSNq07jZjA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5953703703703703" data-type="png" data-w="1080" data-imgfileid="100052480" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosicU8KPJXUFJcLqRI79R0IiadZEg50iaia03DWykU8nSloL3CLxxmnxiaic6tcMF6EwxLaJKIicSNq07jZjA/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf="">这种方法比较简单粗暴，实际上也有其他工具可以实现，欢迎大家在评论区提出自己的方法。</span></p><section><span leaf=""><br></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/T2FA764QjVRRExkYzh0cNw",target="_blank" rel="noopener noreferrer">原文链接</a>
