---
title: "关于排序那点事"
date: 2025-08-06T00:34:05Z
draft: ["false"]
tags: [
  "fetched",
  "YuLabSMU"
]
categories: ["Acdemic"]
---
关于排序那点事 by YuLabSMU
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><code><span leaf="">fct_relevel</span></code></h2><p data-tool="mdnice编辑器"><span leaf="">这个函数可以让你</span><strong><span leaf="">手工</span></strong><span leaf="">设置排序。</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">penguins %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(species = fct_relevel(species, </span><span><span leaf="">"Chinstrap"</span></span><span leaf="">, </span><span><span leaf="">"Gentoo"</span></span><span leaf="">, </span><span><span leaf="">"Adelie"</span></span><span leaf="">)) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot(aes(y = species)) +</span><span leaf=""><br></span><span leaf="">  geom_bar()</span><span leaf=""><br></span></code></pre></section><section nodeleaf=""><img data-ratio="0.6172839506172839" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0AQEBFicwpPApnJDT2ZweMkRbuYABAByM6dngIunnCNOHflCo0PMtmSw/640?wx_fmt=png" data-type="png" data-w="486" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0AQEBFicwpPApnJDT2ZweMkRbuYABAByM6dngIunnCNOHflCo0PMtmSw/640?wx_fmt=png"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><code><span leaf="">fct_infreq</span></code></h2><p data-tool="mdnice编辑器"><span leaf="">这个函数可以让你按照频率来排序，这对于画柱状图太有用了。</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">penguins %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(species = fct_infreq(species)) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot(aes(y = species)) + geom_bar()</span><span leaf=""><br></span></code></pre></section><section nodeleaf=""><img data-ratio="0.5795677799607073" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0MWvf8u0QPYDOYl3icgW9GtCEVSn5ib72LTVGwYbVQKvtWQicrboRykibgA/640?wx_fmt=png" data-type="png" data-w="509" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0MWvf8u0QPYDOYl3icgW9GtCEVSn5ib72LTVGwYbVQKvtWQicrboRykibgA/640?wx_fmt=png"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><code><span leaf="">fct_rev</span></code></h2><p data-tool="mdnice编辑器"><span leaf="">这个函数可以排序反过来，所以像上一个例子，就可以反过来，让高频的在上面，低频的在下面。</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">penguins %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(species = fct_rev(fct_infreq(species))) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot(aes(y = species)) + geom_bar()</span><span leaf=""><br></span></code></pre></section><section nodeleaf=""><img data-ratio="0.5532319391634981" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0OwZgiaMd4tlyyfQnITkPUByGg1eIcpZZic2bvGB1fic0gT37rTrnwzeJw/640?wx_fmt=png" data-type="png" data-w="526" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0OwZgiaMd4tlyyfQnITkPUByGg1eIcpZZic2bvGB1fic0gT37rTrnwzeJw/640?wx_fmt=png"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><code><span leaf="">fct_reorder</span></code></h2><p data-tool="mdnice编辑器"><span leaf="">这个函数让排序按照一个数值变量来。</span><span><span leaf="">经常在网上看到别人教怎么用</span></span><code><span leaf="">ggplot2</span></code><span><span leaf="">画个柱状图或者点图可视化富集分析的结果，大多数的教程，大概率会出类似于下面这样的图。</span></span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><pre data-tool="mdnice编辑器"><code><span leaf="">gapminder %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(</span><span leaf=""><br></span><span leaf="">    year == 2007,</span><span leaf=""><br></span><span leaf="">    continent == </span><span><span leaf="">"Americas"</span></span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot(aes(lifeExp, country)) + </span><span leaf=""><br></span><span leaf="">  geom_point()</span><span leaf=""><br></span></code></pre></section><section nodeleaf=""><img data-ratio="0.853021978021978" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ07BHqJ1nFItPT1QfVoUWqJD6QLRGJA90DyicuI8zSRe55WJN0UNY8kNg/640?wx_fmt=png" data-type="png" data-w="728" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ07BHqJ1nFItPT1QfVoUWqJD6QLRGJA90DyicuI8zSRe55WJN0UNY8kNg/640?wx_fmt=png"></section><p data-tool="mdnice编辑器"><span leaf="">看完总想说一句，你倒是排个序啊。</span><span leaf=""><br></span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span leaf="">简单地使用</span><code><span leaf="">fct_reorder</span></code><span leaf="">，就能够让y轴的国家按照x轴的期望寿命进行排序：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">gapminder %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(</span><span leaf=""><br></span><span leaf="">    year == 2007,</span><span leaf=""><br></span><span leaf="">    continent == </span><span><span leaf="">"Americas"</span></span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(</span><span leaf=""><br></span><span leaf="">    country = fct_reorder(country, lifeExp)</span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot(aes(lifeExp, country)) + </span><span leaf=""><br></span><span leaf="">  geom_point()</span><span leaf=""><br></span></code></pre></section><section nodeleaf=""><img data-ratio="0.8012987012987013" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0n0dFHY7IhXaHsVmicUzk1ja3LxicvAOpDNt5bBoBhVmkItJmSOMeXFbA/640?wx_fmt=png" data-type="png" data-w="770" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0n0dFHY7IhXaHsVmicUzk1ja3LxicvAOpDNt5bBoBhVmkItJmSOMeXFbA/640?wx_fmt=png"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span leaf="">分面也能够这样来排序</span></h2><pre data-tool="mdnice编辑器"><code><span leaf="">gapminder %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(country %</span><span><span leaf="">in</span></span><span leaf="">% c(</span><span><span leaf="">"Norway"</span></span><span leaf="">, </span><span><span leaf="">"Portugal"</span></span><span leaf="">, </span><span><span leaf="">"Spain"</span></span><span leaf="">, </span><span><span leaf="">"Austria"</span></span><span leaf="">)) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot(aes(year, lifeExp)) + geom_line() +</span><span leaf=""><br></span><span leaf="">  facet_wrap(vars(country), nrow = 1)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">画出来下面的图，按照字母排序来。</span></p></section><section nodeleaf=""><img data-ratio="0.2490566037735849" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0WCWvO3LobK6naib2zOZEJrsBnRe3NL69E5ibPCXHva55dR1qobfA6EAQ/640?wx_fmt=png" data-type="png" data-w="795" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0WCWvO3LobK6naib2zOZEJrsBnRe3NL69E5ibPCXHva55dR1qobfA6EAQ/640?wx_fmt=png"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span leaf="">我们先来试试</span><code><span leaf="">fct_reorder</span></code><span leaf="">。</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">gapminder %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(country %</span><span><span leaf="">in</span></span><span leaf="">% c(</span><span><span leaf="">"Norway"</span></span><span leaf="">, </span><span><span leaf="">"Portugal"</span></span><span leaf="">, </span><span><span leaf="">"Spain"</span></span><span leaf="">, </span><span><span leaf="">"Austria"</span></span><span leaf="">)) %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(country = fct_reorder(country, lifeExp)) %&gt;% </span><span><span leaf=""># default: order by median</span></span><span leaf=""><br></span><span leaf="">  ggplot(aes(year, lifeExp)) + geom_line() +</span><span leaf=""><br></span><span leaf="">  facet_wrap(vars(country), nrow = 1)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">因为国家和</span><code><span leaf="">lifeExp</span></code><span leaf="">是一对多的关系，默认是按照中位数去排，所以出来下图：</span></p></section><section nodeleaf=""><img data-ratio="0.24567901234567902" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0trWw5ich8LXgdK4yOFZHF1qeUnUH1D7Ys7XpYPSacYMHjA2A9HhyrIQ/640?wx_fmt=png" data-type="png" data-w="810" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0trWw5ich8LXgdK4yOFZHF1qeUnUH1D7Ys7XpYPSacYMHjA2A9HhyrIQ/640?wx_fmt=png"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span leaf="">中位数这个默认操作，是可以换的，比如换成最低值：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">gapminder %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(country %</span><span><span leaf="">in</span></span><span leaf="">% c(</span><span><span leaf="">"Norway"</span></span><span leaf="">, </span><span><span leaf="">"Portugal"</span></span><span leaf="">, </span><span><span leaf="">"Spain"</span></span><span leaf="">, </span><span><span leaf="">"Austria"</span></span><span leaf="">)) %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(country = fct_reorder(country, lifeExp, min)) %&gt;% </span><span><span leaf=""># order by minimum</span></span><span leaf=""><br></span><span leaf="">  ggplot(aes(year, lifeExp)) + geom_line() +</span><span leaf=""><br></span><span leaf="">  facet_wrap(vars(country), nrow = 1)</span><span leaf=""><br></span></code></pre></section><section nodeleaf=""><img data-ratio="0.2628930817610063" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0hv4o4A4sjjTmSbn3xTUTKUcABRAfSAvJFsgZQOubWDaO4ZrqzJYeQw/640?wx_fmt=png" data-type="png" data-w="795" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0hv4o4A4sjjTmSbn3xTUTKUcABRAfSAvJFsgZQOubWDaO4ZrqzJYeQw/640?wx_fmt=png"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span leaf="">你可以换成</span><code><span leaf="">max</span></code><span leaf="">去试试。你还可以自定义函数，比如说最大值与最小值之差，也就是按照差值大小来排。</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">gapminder %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(country %</span><span><span leaf="">in</span></span><span leaf="">% c(</span><span><span leaf="">"Norway"</span></span><span leaf="">, </span><span><span leaf="">"Portugal"</span></span><span leaf="">, </span><span><span leaf="">"Spain"</span></span><span leaf="">, </span><span><span leaf="">"Austria"</span></span><span leaf="">)) %&gt;%</span><span leaf=""><br></span><span leaf="">  </span><span><span leaf=""># order by custom function: here, difference between max and min</span></span><span leaf=""><br></span><span leaf="">  mutate(country = fct_reorder(country, lifeExp, </span><span><span leaf="">function</span></span><span leaf="">(x) { max(x) - min(x) })) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot(aes(year, lifeExp)) + geom_line() +</span><span leaf=""><br></span><span leaf="">  facet_wrap(vars(country), nrow = 1)</span><span leaf=""><br></span></code></pre></section><section nodeleaf=""><img data-ratio="0.26034063260340634" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0O4gDhhicPHQLTEGqOQpIMQ7xicC5Xibia2oDib9DDyR5A2NbmsOKn387hAg/640?wx_fmt=png" data-type="png" data-w="822" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0O4gDhhicPHQLTEGqOQpIMQ7xicC5Xibia2oDib9DDyR5A2NbmsOKn387hAg/640?wx_fmt=png"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span leaf="">反过来排序，我想你应该是会的，把函数定义为最小值减最大值，就和上图反过来了。</span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><code><span leaf="">fct_lump</span></code></h2><p data-tool="mdnice编辑器"><span leaf="">最后这个函数，让你把想要呈现的分类给呈现出来，其它的，归为一类叫Other，这是不是一个非常刚的需求？</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">flight_data %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(</span><span leaf=""><br></span><span leaf="">    name = fct_lump(fct_infreq(name), 7)</span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot(aes(y = fct_rev(name))) + </span><span leaf=""><br></span><span leaf="">  geom_bar()</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">首先用</span><code><span leaf="">fct_infreq</span></code><span leaf="">按照频率排序，然后只保留前7个，其它的归为</span><code><span leaf="">Other</span></code><span leaf="">。画图如下：</span></p><section nodeleaf=""><img data-ratio="0.6990740740740741" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0uB7K8iarWEAuZZ23OK0TVFwIr9bJGcIU4sgzAjaTYyDh1hCf0Jic6TWg/640?wx_fmt=png" data-type="png" data-w="432" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0uB7K8iarWEAuZZ23OK0TVFwIr9bJGcIU4sgzAjaTYyDh1hCf0Jic6TWg/640?wx_fmt=png"></section><p data-tool="mdnice编辑器"><span leaf="">另一个刚需，这时候你想用不同颜色，把</span><code><span leaf="">Other</span></code><span leaf="">给区分开来怎么搞？</span></p><pre data-tool="mdnice编辑器"><code><span leaf=""><br></span><span leaf="">flight_data %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(</span><span leaf=""><br></span><span leaf="">    name = fct_lump(fct_infreq(name), 7),</span><span leaf=""><br></span><span leaf="">    highlight = fct_other(</span><span leaf=""><br></span><span leaf="">      name,</span><span leaf=""><br></span><span leaf="">      keep = </span><span><span leaf="">"Other"</span></span><span leaf="">, other_level = </span><span><span leaf="">"Named"</span></span><span leaf=""><br></span><span leaf="">    )</span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot() +</span><span leaf=""><br></span><span leaf="">  aes(</span><span leaf=""><br></span><span leaf="">    y = fct_rev(name),</span><span leaf=""><br></span><span leaf="">    fill = highlight</span><span leaf=""><br></span><span leaf="">  ) + </span><span leaf=""><br></span><span leaf="">  geom_bar()</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">这时候，我们可以用一个</span><code><span leaf="">fct_other</span></code><span leaf="">来把除了</span><code><span leaf="">Other</span></code><span leaf="">之外的</span><code><span leaf="">name</span></code><span leaf="">（</span><code><span leaf="">fct_lump</span></code><span leaf="">生成的这个）给一个另外的</span><code><span leaf="">level</span></code><span leaf="">，出图如下：</span></p><section nodeleaf=""><img data-ratio="0.7814070351758794" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ09kjdIomLLJyWzwnjFJBCVyqJQdFwMqHTMHyptgzqvp9H3P1A5KNjmg/640?wx_fmt=png" data-type="png" data-w="398" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ09kjdIomLLJyWzwnjFJBCVyqJQdFwMqHTMHyptgzqvp9H3P1A5KNjmg/640?wx_fmt=png"></section><p data-tool="mdnice编辑器"><span leaf="">美中不足的是图例中</span><code><span leaf="">Other</span></code><span leaf="">排在上面了。这有何难呢，</span><code><span leaf="">fct_rev</span></code><span leaf="">反转一下，就完事了。</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">flight_data %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(</span><span leaf=""><br></span><span leaf="">    name = fct_lump(fct_infreq(name), 7),</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf=""># Use `fct_other()` to manually lump all</span></span><span leaf=""><br></span><span leaf="">    </span><span><span leaf=""># levels not called "Other" into "Named"</span></span><span leaf=""><br></span><span leaf="">    highlight = fct_other(</span><span leaf=""><br></span><span leaf="">      name,</span><span leaf=""><br></span><span leaf="">      keep = </span><span><span leaf="">"Other"</span></span><span leaf="">, other_level = </span><span><span leaf="">"Named"</span></span><span leaf=""><br></span><span leaf="">    )</span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  ggplot() +</span><span leaf=""><br></span><span leaf="">  aes(</span><span leaf=""><br></span><span leaf="">    y = fct_rev(name),</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf=""># reverse fill aesthetic</span></span><span leaf=""><br></span><span leaf="">    fill = fct_rev(highlight)</span><span leaf=""><br></span><span leaf="">  ) + </span><span leaf=""><br></span><span leaf="">  geom_bar()</span><span leaf=""><br></span></code></pre><section nodeleaf=""><img data-ratio="0.7468030690537084" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0ywCg38ed8hSByCtkkqy4iaNbkanzL5ExuQraibCZ3M5gQfDy0KRnclcg/640?wx_fmt=png" data-type="png" data-w="391" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0ywCg38ed8hSByCtkkqy4iaNbkanzL5ExuQraibCZ3M5gQfDy0KRnclcg/640?wx_fmt=png"></section><p data-tool="mdnice编辑器"><span leaf="">最后我们可以用</span><code><span leaf="">scale_fill_manual</span></code><span leaf="">再改一下颜色，大概这样，也就OK了。</span><span leaf=""><br></span></p><section nodeleaf=""><img data-ratio="0.6828087167070218" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0VYF6fPQQqy0awiaicqjKbw4n3XF9UbaEMaia4DibwI70f4M2icKgHvLpczg/640?wx_fmt=png" data-type="png" data-w="413" src="https://mmbiz.qpic.cn/mmbiz_png/MPBFtnFrw4nKcZQMjWfV7dI0gl1w3PQ0VYF6fPQQqy0awiaicqjKbw4n3XF9UbaEMaia4DibwI70f4M2icKgHvLpczg/640?wx_fmt=png"></section><p><span leaf="">这些搞factor的函数，皆在forcats包。</span></p></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/N42HhSJ_vL_jh0Z3yQW9OA",target="_blank" rel="noopener noreferrer">原文链接</a>
