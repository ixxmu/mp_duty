---
title: "【代码更新】单细胞分析实录(20): 将多个样本的CNV定位到染色体臂，并画热图"
date: 2025-04-08T00:35:44Z
draft: ["false"]
tags: [
  "fetched",
  "TOP生物信息"
]
categories: ["Acdemic"]
---
【代码更新】单细胞分析实录(20): 将多个样本的CNV定位到染色体臂，并画热图 by TOP生物信息
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">之前写过三篇和CNV相关的帖子，如果你做肿瘤单细胞转录组，大概率看过：</p><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247484030&amp;idx=1&amp;sn=620434297cc987aa926b0d945464e6e5&amp;chksm=c2517969f526f07f5c10139beb391786b33236ace7e3d13a76c1cf5c1c6b277e292e8b52f298&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>单细胞分析实录(11): inferCNV的基本用法</span></a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247484128&amp;idx=1&amp;sn=38c945230f36042232dad7406b23a195&amp;chksm=c25179f7f526f0e1d4f2210681941606e811feeb0fc370f069e98f8548deb1004467baf5e2f3&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>单细胞分析实录(12): 如何推断肿瘤细胞</span></a><br></section><section><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzMzE5NTM4NA==&amp;mid=2247484187&amp;idx=1&amp;sn=f8b327f372ec686d7289a91d1615e10f&amp;chksm=c251780cf526f11a365391c3cb246ae75acaaab5f32eb848cfd99cc2fdc4219811640afbaa3a&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>单细胞分析实录(13): inferCNV结合UPhyloplot2分析肿瘤进化</span></a><br></section><p data-tool="mdnice编辑器">其中，第三篇帖子里面有两个注释代码，可以在基因和染色体长短臂两个层面对CNV做注释</p><figure data-tool="mdnice编辑器"><img data-fileid="100000828" data-ratio="0.5012919896640827" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bsgfHOTibgicib44Z2NicjRUgV5YWrLB63ibQDjQg9jViaHeyGxSMK6Wib3oOBkJXvkwTHV9Xn9b5W1LQTw/640?wx_fmt=png" data-type="png" data-w="774" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bsgfHOTibgicib44Z2NicjRUgV5YWrLB63ibQDjQg9jViaHeyGxSMK6Wib3oOBkJXvkwTHV9Xn9b5W1LQTw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">这次对<code>tree_anno.R</code>代码做了更新，简单来说就是对原始CNV region的长度做了限制，最后的结果会输出更少更明显的CNV</p><figure data-tool="mdnice编辑器"><img data-fileid="100000826" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bsgfHOTibgicib44Z2NicjRUgVhuaNg0uN9g2QZMDVicLF0l3pI1Rn06PT6F1MEZ4KXS8lzbINzMquxzw/640?wx_fmt=png" data-type="png" data-ratio="0.2914923291492329" data-w="717" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bsgfHOTibgicib44Z2NicjRUgVhuaNg0uN9g2QZMDVicLF0l3pI1Rn06PT6F1MEZ4KXS8lzbINzMquxzw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">之前在我这里拿过代码的读者如果需要，可以直接找我拿更新后的代码(<code>tree_anno.new.R</code>)，以及下面的代码(<code>cnv_heatmap.R</code>)。</p><blockquote data-tool="mdnice编辑器"><span>❝</span><p>另外，需要说明的是，距离我上次发布inferCNV帖子(2021年4月)已经半年了，前些天有读者跟我说，新版的inferCNV(读者给我看的是inferCNV v1.8.1)，在给肿瘤细胞分组时，默认的方法已经变了，cell_groupings文件中已经没有tree相关的信息了。如果仍然想得到肿瘤进化树，需要改<code>tumor_subcluster_partition_method</code>参数为<code>random_trees</code>，默认是<code>leiden</code>，后者速度快但没有tree信息。</p><span>❞</span></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">以下是这篇帖子的主要内容。</p><p data-tool="mdnice编辑器">参考的还是之前提到的两篇NC文章：</p><figure data-tool="mdnice编辑器"><img data-fileid="100000829" data-ratio="0.42052313883299797" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bsgfHOTibgicib44Z2NicjRUgVicAPqUupnlVnrstjyO4paARXYKqdAyzJauXGicWkSSJicLqp8sZpVuSEw/640?wx_fmt=png" data-type="png" data-w="994" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bsgfHOTibgicib44Z2NicjRUgVicAPqUupnlVnrstjyO4paARXYKqdAyzJauXGicWkSSJicLqp8sZpVuSEw/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><span>❝</span><p>ref1: Single-cell RNA landscape of intratumoral heterogeneity and immunosuppressive microenvironment in advanced osteosarcoma</p><span>❞</span></blockquote><blockquote data-tool="mdnice编辑器"><span>❝</span><p>ref2: Single-cell analysis reveals new evolutionary complexity in uveal melanoma</p><span>❞</span></blockquote><p data-tool="mdnice编辑器">inferCNV的热图可以反映单个样本的CNV情况，这个热图可以反映多个样本的CNV情况，而且简化到染色体长短臂。在样本比较多时，还是比较有用的。</p><p data-tool="mdnice编辑器">这次的代码仍然依赖inferCNV的输出信息，仍然是"subclusters"模式。（inferCNV相关的用法参考我之前的帖子，这里不多说）</p><p data-tool="mdnice编辑器">最终的效果图：</p><figure data-tool="mdnice编辑器"><img data-fileid="100000827" data-ratio="1.0326441784548421" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bsgfHOTibgicib44Z2NicjRUgVTm26pyJyicOpk7B2cmL8n429j73GU42o2ULANqZOITbUKjD5LqUmEnw/640?wx_fmt=png" data-type="png" data-w="919" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2bsgfHOTibgicib44Z2NicjRUgVTm26pyJyicOpk7B2cmL8n429j73GU42o2ULANqZOITbUKjD5LqUmEnw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">图中列是样本，行是CNV type (chr1p_loss这种)。每一个方块代表，该样本具有这种CNV的细胞在所有肿瘤细胞中的占比。</p></section><p><img data-fileid="100000661" data-ratio="0.3426666666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2axZjuhcBMEdia3TJv1r062wlx6iccn76qHGArtic86bicFB2rzGyGmBalQnmXobKOcmlq7KVf9ZLhtUg/640?wx_fmt=png" data-type="png" data-w="750" src="https://mmbiz.qpic.cn/mmbiz_png/WThoCmvVu2axZjuhcBMEdia3TJv1r062wlx6iccn76qHGArtic86bicFB2rzGyGmBalQnmXobKOcmlq7KVf9ZLhtUg/640?wx_fmt=png"></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/YZNuuAYX3-yMVKinfL-4dg",target="_blank" rel="noopener noreferrer">原文链接</a>
