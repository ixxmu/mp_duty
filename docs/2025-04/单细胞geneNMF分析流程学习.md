---
title: "单细胞geneNMF分析流程学习"
date: 2025-04-16T16:11:05Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
单细胞geneNMF分析流程学习 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100004258" data-ratio="0.7524390243902439" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvSs7Qich4vhPJicxMTibvOia3cIeGf9TdJeGibwj5XGmWtFdicalLe0cEQxHg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="820" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvSs7Qich4vhPJicxMTibvOia3cIeGf9TdJeGibwj5XGmWtFdicalLe0cEQxHg/640?wx_fmt=png&amp;from=appmsg">非负矩阵分解是一种用于分析高维数据的方法，它可以从一组非负数据向量中提取稀疏且有意义的特征。该方法非常适合分解单细胞RNA测序数据，有效地将大型的复杂矩阵(基因数量乘以细胞数量)分解为几个可解释的基因程序。</span></p><p data-tool="mdnice编辑器"><span leaf="">非负矩阵相关内容请参阅既往推文：</span></p><ol><li><section><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247485484&amp;idx=1&amp;sn=794abb11d3d5f13bd07057c3524b906a&amp;scene=21#wechat_redirect" textvalue="单细胞非负矩阵分解分析python版(cNMF)学习" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">单细胞非负矩阵分解分析python版(cNMF)学习</a></span></section></li><li><section><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247484725&amp;idx=1&amp;sn=ee5559c99177422b3fa549acbffa24c6&amp;scene=21#wechat_redirect" textvalue="转录组非负矩阵分解(NMF)/一致性聚类(ConsensusClusterPlus）" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">转录组非负矩阵分解(NMF)/一致性聚类(ConsensusClusterPlus）</a></span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">本次内容就直接跟着官方流程进行实操。</span></p><h4 data-tool="mdnice编辑器"><span></span><span leaf="">geneNMF分析流程</span><span></span></h4><h5 data-tool="mdnice编辑器"><span></span><span leaf="">1.导入</span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">rm(list = ls())</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(GeneNMF)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(Seurat)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(UCell)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(patchwork)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(Matrix)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(RcppML)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(viridis)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(qs)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">load(</span><span><span leaf="">"scRNA.Rdata"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">DimPlot(scRNA)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvemlLvaHIepvMibfBKUOAge4N9muMG6OJHBzZxdtrW4wn0YXj6sortAw/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.0562248995983936" data-type="png" data-w="996" data-imgfileid="100004256" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvemlLvaHIepvMibfBKUOAge4N9muMG6OJHBzZxdtrW4wn0YXj6sortAw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdnice编辑器"><span></span><span leaf="">2.数据预处理(NMF降维)</span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">NMF可以将数据从成千上万的基因维度降低到几个维度</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">seu &lt;- scRNA</span><span leaf=""><br></span><span leaf="">ndim &lt;- </span><span><span leaf="">15</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">seu &lt;- FindVariableFeatures(seu, nfeatures = length(rownames(scRNA))) </span><span><span leaf="">#官方是1000</span></span><span leaf=""><br></span><span leaf="">seu &lt;- runNMF(seu, k = ndim, assay=</span><span><span leaf="">"RNA"</span></span><span leaf="">) </span><span><span leaf=""># 官方是SCT</span></span><span leaf=""><br></span><span leaf="">seu@reductions$NMF</span><span leaf=""><br></span><span><span leaf=""># A dimensional reduction object with key NMF_ </span></span><span leaf=""><br></span><span><span leaf="">#  Number of dimensions: 15 </span></span><span leaf=""><br></span><span><span leaf="">#  Number of cells: 4031 </span></span><span leaf=""><br></span><span><span leaf="">#  Projected dimensional reduction calculated:  FALSE </span></span><span leaf=""><br></span><span><span leaf="">#  Jackstraw run: FALSE </span></span><span leaf=""><br></span><span><span leaf="">#  Computed using assay: RNA </span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdnice编辑器"><span></span><span leaf="">在二维空间展示NMF结果</span><span></span></h6><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">seu &lt;- RunUMAP(seu, </span><span leaf=""><br></span><span leaf="">               reduction = </span><span><span leaf="">"NMF"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">               dims=</span><span><span leaf="">1</span></span><span leaf="">:ndim, </span><span leaf=""><br></span><span leaf="">               reduction.name = </span><span><span leaf="">"NMF_UMAP"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">               reduction.key = </span><span><span leaf="">"nmfUMAP_"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">DimPlot(seu, reduction = </span><span><span leaf="">"NMF_UMAP"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">        group.by = </span><span><span leaf="">"celltype"</span></span><span leaf="">, label=</span><span><span leaf="">T</span></span><span leaf="">) + </span><span leaf=""><br></span><span leaf="">  theme(aspect.ratio = </span><span><span leaf="">1</span></span><span leaf="">,axis.text = element_blank(),</span><span leaf=""><br></span><span leaf="">    axis.title = element_blank(),</span><span leaf=""><br></span><span leaf="">    axis.ticks = element_blank()) +</span><span leaf=""><br></span><span leaf="">  ggtitle(</span><span><span leaf="">"NMF UMAP"</span></span><span leaf="">) + NoLegend()</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvPn5hfdxYCibEo7fAGxNS4fv0EdVbJ1RPgIjYKn0DdDjuJHI6feWOH9Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.0562248995983936" data-type="png" data-w="996" data-imgfileid="100004255" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvPn5hfdxYCibEo7fAGxNS4fv0EdVbJ1RPgIjYKn0DdDjuJHI6feWOH9Q/640?wx_fmt=png&amp;from=appmsg"></span></figure><h5 data-tool="mdnice编辑器"><span></span><span leaf="">3.多样本间一致的NMF程序</span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">识别稳健的基因programs需要跨样本检测它们，并考虑输入参数的变异性。对于NMF来说，最关键的参数可能是维度k，它对应于低维矩阵中的程序数量。为了确定稳健的程序，可以对多个k值运行NMF，并确定在这些运行中始终存在的程序。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">seu.list &lt;- SplitObject(seu, split.by = </span><span><span leaf="">"orig.ident"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">geneNMF.programs &lt;- multiNMF(seu.list, </span><span leaf=""><br></span><span leaf="">                             assay=</span><span><span leaf="">"RNA"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                             slot=</span><span><span leaf="">"data"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                             k=</span><span><span leaf="">4</span></span><span leaf="">:</span><span><span leaf="">9</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                             nfeatures = length(rownames(scRNA))) </span><span><span leaf=""># 官方是1000</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 可以将多个样本和数量k中识别出的基因程序组合成元程序（MPs），即在不同 NMF 运行中稳健识别的共识程序。在此，我们将定义10个 MPs</span></span><span leaf=""><br></span><span leaf="">geneNMF.metaprograms &lt;- getMetaPrograms(geneNMF.programs,</span><span leaf=""><br></span><span leaf="">                                        nMP=</span><span><span leaf="">10</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                                        weight.explained = </span><span><span leaf="">0.7</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                                        max.genes=</span><span><span leaf="">100</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span leaf="">4.可视化结果</span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">可视化组成元程序的各个基因程序之间的成对相似度(以余弦相似度或Jaccard指数表示)可能很有用。可以看到对应于数据集和k值中高度相似的基因程序的“块”。然后，可以将相似度树在给定高度处切割，以找到相似程序块并为每个块推导出共识基因特征。例如，这里将树切割到对应于10个程序簇(即10个MP)。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">ph &lt;- plotMetaPrograms(geneNMF.metaprograms)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvKDic6yTBBzOa5XCUxYqUrKFLnZOzibyhkicVtJSEEhQyibhibTKUyDiblDSg/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.0562248995983936" data-type="png" data-w="996" data-imgfileid="100004257" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvKDic6yTBBzOa5XCUxYqUrKFLnZOzibyhkicVtJSEEhQyibhibTKUyDiblDSg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h6 data-tool="mdnice编辑器"><span></span><span leaf="">数据提取</span><span></span></h6><p data-tool="mdnice编辑器"><span leaf="">还可以检查一些有用的统计数据，例如“样本覆盖率”(MP 在多少样本中被检测到）；或者轮廓系数(一个MP中的个体程序相对于其他MP中的程序有多相似——数值越高越好）。基于这些指标，使用者可以去决定删除一些程序，例如，如果仅针对少数样本(样本覆盖率低），或者内部一致性差(轮廓系数和平均相似度低）。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">geneNMF.metaprograms$metaprograms.metrics</span><span leaf=""><br></span><span><span leaf="">#      sampleCoverage   silhouette meanSimilarity numberGenes numberPrograms</span></span><span leaf=""><br></span><span><span leaf=""># MP1       0.8333333  0.694614167          0.760         100             27</span></span><span leaf=""><br></span><span><span leaf=""># MP2       0.8333333  0.688409044          0.743         100             17</span></span><span leaf=""><br></span><span><span leaf=""># MP3       0.8333333  0.547281711          0.618         100             20</span></span><span leaf=""><br></span><span><span leaf=""># MP4       0.8333333  0.512216201          0.574         100             27</span></span><span leaf=""><br></span><span><span leaf=""># MP5       0.8333333  0.467454460          0.577         100             24</span></span><span leaf=""><br></span><span><span leaf=""># MP6       0.8333333  0.132801311          0.323         100             21</span></span><span leaf=""><br></span><span><span leaf=""># MP7       0.8333333 -0.002536882          0.169          37             29</span></span><span leaf=""><br></span><span><span leaf=""># MP8       0.6666667  0.607938842          0.647         100             20</span></span><span leaf=""><br></span><span><span leaf=""># MP9       0.6666667  0.536177467          0.608         100             24</span></span><span leaf=""><br></span><span><span leaf=""># MP10      0.6666667  0.113884487          0.275         100             25</span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdnice编辑器"><span></span><span leaf="">查看MP中的驱动基因</span><span></span></h6><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">lapply(geneNMF.metaprograms$metaprograms.genes, head)</span><span leaf=""><br></span><span><span leaf=""># $MP1</span></span><span leaf=""><br></span><span><span leaf=""># [1] "S100A8" "S100A9" "G0S2"   "CXCL8"  "FPR1"   "CSF3R" </span></span><span leaf=""><br></span><span><span leaf=""># </span></span><span leaf=""><br></span><span><span leaf=""># $MP2</span></span><span leaf=""><br></span><span><span leaf=""># [1] "MS4A7" "C1QA"  "CD163" "C1QB"  "C1QC"  "F13A1"</span></span><span leaf=""><br></span><span><span leaf=""># </span></span><span leaf=""><br></span><span><span leaf=""># $MP3</span></span><span leaf=""><br></span><span><span leaf=""># [1] "FOSB"    "HSPA1B"  "DNAJB1"  "HSPA1A"  "JUN"     "SERTAD1"</span></span><span leaf=""><br></span><span><span leaf=""># </span></span><span leaf=""><br></span><span><span leaf=""># $MP4</span></span><span leaf=""><br></span><span><span leaf=""># [1] "FBLN1" "DPT"   "APOD"  "C1S"   "SFRP1" "C3"   </span></span><span leaf=""><br></span><span><span leaf=""># </span></span><span leaf=""><br></span><span><span leaf=""># $MP5</span></span><span leaf=""><br></span><span><span leaf=""># [1] "NKG7" "CCL5" "GZMA" "GZMH" "CTSW" "PRF1"</span></span><span leaf=""><br></span><span><span leaf=""># </span></span><span leaf=""><br></span><span><span leaf=""># $MP6</span></span><span leaf=""><br></span><span><span leaf=""># [1] "LINC00861" "DGKA"      "OXNAD1"    "TRAF3IP3"  "SLFN5"     "GIMAP7"   </span></span><span leaf=""><br></span><span><span leaf=""># </span></span><span leaf=""><br></span><span><span leaf=""># $MP7</span></span><span leaf=""><br></span><span><span leaf=""># [1] "TAGLN"  "SSR4"   "TPM2"   "MYL9"   "MYDGF"  "IGFBP5"</span></span><span leaf=""><br></span><span><span leaf=""># </span></span><span leaf=""><br></span><span><span leaf=""># $MP8</span></span><span leaf=""><br></span><span><span leaf=""># [1] "BANK1" "MS4A1" "IGHM"  "CD79A" "IGHD"  "CD22" </span></span><span leaf=""><br></span><span><span leaf=""># </span></span><span leaf=""><br></span><span><span leaf=""># $MP9</span></span><span leaf=""><br></span><span><span leaf=""># [1] "VWF"    "CLDN5"  "AQP1"   "PLVAP"  "CAVIN2" "ACKR1" </span></span><span leaf=""><br></span><span><span leaf=""># </span></span><span leaf=""><br></span><span><span leaf=""># $MP10</span></span><span leaf=""><br></span><span><span leaf=""># [1] "PGAP1"    "FAM177A1" "UBE2S"    "CREM"     "SC5D"     "CRYBG1" </span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdnice编辑器"><span></span><span leaf="">修改参数调整program</span><span></span></h6><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 比如调整weight.explained,min.confidence,nMP等参数</span></span><span leaf=""><br></span><span leaf="">geneNMF.metaprograms &lt;- getMetaPrograms(geneNMF.programs,</span><span leaf=""><br></span><span leaf="">                                        nMP=</span><span><span leaf="">8</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                                        </span><span><span leaf="">#min.confidence = 0.7,</span></span><span leaf=""><br></span><span leaf="">                                        weight.explained = </span><span><span leaf="">0.7</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                                        max.genes=</span><span><span leaf="">100</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span leaf="">5.对基因programs进行GSEA分析</span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(msigdbr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(fgsea)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">top_p &lt;- lapply(geneNMF.metaprograms$metaprograms.genes, </span><span><span leaf="">function</span></span><span leaf="">(program) {</span><span leaf=""><br></span><span leaf="">  runGSEA(program, universe=rownames(seu), category = </span><span><span leaf="">"H"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">})</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">head(top_p$MP4)</span><span leaf=""><br></span><span><span leaf="">#                                      pathway         pval         padj overlap  size</span></span><span leaf=""><br></span><span><span leaf="">#                                        &lt;char&gt;        &lt;num&gt;        &lt;num&gt;   &lt;int&gt; &lt;int&gt;</span></span><span leaf=""><br></span><span><span leaf=""># 1: HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION 7.297520e-43 3.648760e-41      32   197</span></span><span leaf=""><br></span><span><span leaf=""># 2:                       HALLMARK_COAGULATION 4.519321e-08 1.129830e-06       8   124</span></span><span leaf=""><br></span><span><span leaf=""># 3:                        HALLMARK_MYOGENESIS 9.133267e-08 1.522211e-06       9   190</span></span><span leaf=""><br></span><span><span leaf=""># 4:                    HALLMARK_UV_RESPONSE_DN 1.296139e-07 1.620173e-06       8   142</span></span><span leaf=""><br></span><span><span leaf=""># 5:                      HALLMARK_ANGIOGENESIS 1.269939e-05 1.269939e-04       4    35</span></span><span leaf=""><br></span><span><span leaf=""># 6:                         HALLMARK_APOPTOSIS 4.801798e-04 4.001499e-03       5   157</span></span><span leaf=""><br></span><span><span leaf="">#                                     overlapGenes</span></span><span leaf=""><br></span><span><span leaf="">#                                           &lt;list&gt;</span></span><span leaf=""><br></span><span><span leaf=""># 1: ABI3BP,CALD1,COL12A1,COL1A1,COL1A2,COL3A1,...</span></span><span leaf=""><br></span><span><span leaf=""># 2:                  C1R,C1S,C3,CTSK,F10,FBN1,...</span></span><span leaf=""><br></span><span><span leaf=""># 3:    AEBP1,APOD,COL1A1,COL3A1,COL6A2,COL6A3,...</span></span><span leaf=""><br></span><span><span leaf=""># 4:  COL1A1,COL1A2,COL3A1,COL5A2,EFEMP1,FBLN5,...</span></span><span leaf=""><br></span><span><span leaf=""># 5:                       COL3A1,COL5A2,FSTL1,LUM</span></span><span leaf=""><br></span><span><span leaf=""># 6:                      DCN,GPX3,IGFBP6,LUM,MMP2</span></span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span leaf="">6.基因program的siganture分数</span><span></span></h5><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(UCell)</span><span leaf=""><br></span><span leaf="">mp.genes &lt;- geneNMF.metaprograms$metaprograms.genes</span><span leaf=""><br></span><span leaf="">seu &lt;- AddModuleScore_UCell(seu, </span><span leaf=""><br></span><span leaf="">                            features = mp.genes, </span><span leaf=""><br></span><span leaf="">                            assay=</span><span><span leaf="">"RNA"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                            ncores=</span><span><span leaf="">4</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                            name = </span><span><span leaf="">""</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">VlnPlot(seu, features=names(mp.genes), </span><span leaf=""><br></span><span leaf="">        group.by = </span><span><span leaf="">"celltype"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">        pt.size = </span><span><span leaf="">0</span></span><span leaf="">, ncol=</span><span><span leaf="">5</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">对应MP4的GSEA富集结果，MP4主要富集与EMT等通路，其高表达于成纤维细胞。<img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvB8vcATNmqrMtia8ZXVnmDljofvzuBdFMDI5gbdcLD3fu6DDKN8icL4mA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.45092592592592595" data-type="png" data-w="1080" data-imgfileid="100004259" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvB8vcATNmqrMtia8ZXVnmDljofvzuBdFMDI5gbdcLD3fu6DDKN8icL4mA/640?wx_fmt=png&amp;from=appmsg"></span></p><h6 data-tool="mdnice编辑器"><span></span><span leaf="">映射到UMAP</span><span></span></h6><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">matrix &lt;- seu@meta.data[,names(mp.genes)]</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">#dimred &lt;- scale(matrix)</span></span><span leaf=""><br></span><span leaf="">dimred &lt;- as.matrix(matrix)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">colnames(dimred) &lt;- paste0(</span><span><span leaf="">"MP_"</span></span><span leaf="">,seq(</span><span><span leaf="">1</span></span><span leaf="">, ncol(dimred)))</span><span leaf=""><br></span><span><span leaf="">#New dim reduction</span></span><span leaf=""><br></span><span leaf="">seu@reductions[[</span><span><span leaf="">"MPsignatures"</span></span><span leaf="">]] &lt;- new(</span><span><span leaf="">"DimReduc"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                                         cell.embeddings = dimred,</span><span leaf=""><br></span><span leaf="">                                         assay.used = </span><span><span leaf="">"RNA"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                                         key = </span><span><span leaf="">"MP_"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                                         global = </span><span><span leaf="">FALSE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">set.seed(</span><span><span leaf="">123</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">seu &lt;- RunUMAP(seu, reduction=</span><span><span leaf="">"MPsignatures"</span></span><span leaf="">, dims=</span><span><span leaf="">1</span></span><span leaf="">:length(seu@reductions[[</span><span><span leaf="">"MPsignatures"</span></span><span leaf="">]]),</span><span leaf=""><br></span><span leaf="">               metric = </span><span><span leaf="">"euclidean"</span></span><span leaf="">, reduction.name = </span><span><span leaf="">"umap_MP"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(viridis)</span><span leaf=""><br></span><span leaf="">FeaturePlot(seu, features = names(mp.genes), reduction = </span><span><span leaf="">"umap_MP"</span></span><span leaf="">, ncol=</span><span><span leaf="">4</span></span><span leaf="">) &amp;</span><span leaf=""><br></span><span leaf="">  scale_color_viridis(option=</span><span><span leaf="">"B"</span></span><span leaf="">) &amp;</span><span leaf=""><br></span><span leaf="">   theme(aspect.ratio = </span><span><span leaf="">1</span></span><span leaf="">, axis.text=element_blank(), axis.ticks=element_blank())</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQv5LzmUcXmicfHibxicmLcaPxb552BRSztJ9zqEME61qWMp5l4ThYV84cKg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7277777777777777" data-type="png" data-w="1080" data-imgfileid="100004264" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQv5LzmUcXmicfHibxicmLcaPxb552BRSztJ9zqEME61qWMp5l4ThYV84cKg/640?wx_fmt=png&amp;from=appmsg"></span></figure><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">a &lt;- DimPlot(seu, </span><span leaf=""><br></span><span leaf="">             reduction = </span><span><span leaf="">"umap_MP"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">             group.by = </span><span><span leaf="">"celltype"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">             label=</span><span><span leaf="">T</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  theme(aspect.ratio = </span><span><span leaf="">1</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">        axis.text = element_blank(),</span><span leaf=""><br></span><span leaf="">        axis.title = element_blank(),</span><span leaf=""><br></span><span leaf="">        axis.ticks = element_blank()) + </span><span leaf=""><br></span><span leaf="">  ggtitle(</span><span><span leaf="">"Original cell types"</span></span><span leaf="">) + NoLegend()</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">b &lt;- DimPlot(seu, </span><span leaf=""><br></span><span leaf="">             reduction = </span><span><span leaf="">"umap_MP"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">             group.by = </span><span><span leaf="">"orig.ident"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">             label=</span><span><span leaf="">T</span></span><span leaf="">) + </span><span leaf=""><br></span><span leaf="">  theme(aspect.ratio = </span><span><span leaf="">1</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">        axis.text = element_blank(),</span><span leaf=""><br></span><span leaf="">        axis.title = element_blank(),</span><span leaf=""><br></span><span leaf="">        axis.ticks = element_blank()) + </span><span leaf=""><br></span><span leaf="">  ggtitle(</span><span><span leaf="">"Samples"</span></span><span leaf="">) + NoLegend()</span><span leaf=""><br></span><span leaf="">a | b</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100004263" data-ratio="0.7953703703703704" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvhdpjtVyE7ByH3n0PDUZ4nnEicq3kKRvyajnMpFt5dj2Fp4gHTHzZgJg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGdAUFOIlhsSGnMR1U7zDQvhdpjtVyE7ByH3n0PDUZ4nnEicq3kKRvyajnMpFt5dj2Fp4gHTHzZgJg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h4 data-tool="mdnice编辑器"><span></span><span leaf="">参考资料：</span><span></span></h4><ol><li><section><span leaf="">Wounding triggers invasive progression in human basal cell carcinoma. bioRxiv 2024 10.1101/2024.05.31.596823                  . </span></section></li><li><section><span leaf="">geneNMF：https://github.com/carmonalab/GeneNMF https://carmonalab.github.io/GeneNMF.demo/NMF_demo_PBMC.html</span></section></li><li><section><span leaf="">生信随笔：https://mp.weixin.qq.com/s/_rOv8pdze3FpQdstkMbIOA</span></section></li><li><section><span leaf="">生信益站：https://mp.weixin.qq.com/s/6qP0fv5oIpBCpnZhXOYujQ</span></section></li></ol><p data-tool="mdnice编辑器"><strong><span leaf="">注</span></strong><span leaf="">：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。更多相关内容可关注公众号：</span><strong><span leaf="">生信方舟</span></strong></p><span><span leaf="">- END -</span></span></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/CGvWHpyKectR3jxNfQziIg",target="_blank" rel="noopener noreferrer">原文链接</a>
