---
title: "斯坦福大学Nature ｜单细胞测序 神经领域类器官"
date: 2025-04-10T01:24:29Z
draft: ["false"]
tags: [
  "fetched",
  "生信钱同学"
]
categories: ["Acdemic"]
---
斯坦福大学Nature ｜单细胞测序 神经领域类器官 by 生信钱同学
------
<div><p data-pm-slice="0 0 []"><span data-token-index="0"><span data-token-index="0" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">构建人类上升神经感觉通路类组装体模型，为神经系统研究带来新突破</span></span></span></span></p><section nodeleaf=""><img data-imgfileid="100009328" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgapAYLF44N3xrGrIS8yuNrV0CSm8Akk1lcWL8QiacCWzekpLjTvsg7Jg/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgapAYLF44N3xrGrIS8yuNrV0CSm8Akk1lcWL8QiacCWzekpLjTvsg7Jg/640?wx_fmt=jpeg&amp;from=appmsg"></section><p data-pm-slice="0 0 []"><span data-token-index="0"><span leaf=""><span textstyle="">近日，一项来自斯坦福大学发表于《Nature》杂志的研究成功构建了人类上升体感类组装体（hASA），</span></span></span><span leaf=""><span textstyle="">这一创新模型为研究人类感觉通路的组装机制以及开发疼痛治疗方法提供了全新的视角和有力工具。</span></span></p><section nodeleaf=""><img data-imgfileid="100009322" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBg9IfJ2qmFdjlzAZ0QBZW19u7L38E9AwIseuWlVEOP0RJKE1YK5FRf8w/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBg9IfJ2qmFdjlzAZ0QBZW19u7L38E9AwIseuWlVEOP0RJKE1YK5FRf8w/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span leaf=""><span textstyle="">人体的体感通路负责将疼痛、触觉、瘙痒和身体部位运动等关键信息从外周器官传递到中枢神经系统。这一通路的正常运作对于人体感知外界环境和维持生理平衡至关重要。</span></span><span data-token-index="1"><span leaf=""><span textstyle="">然而，目前我们对这些通路在人类发育过程中的形成机制，以及在病理条件下功能缺陷的产生原因仍知之甚少。</span></span></span><span leaf=""><span textstyle="">同时，由于物种特异性特征以及缺乏体外多突触通路模型，疼痛和感觉研究的临床转化面临着重重挑战。此前，虽然在类器官和类组装体技术方面取得了一些进展，但能够模拟人类体感上升通路的多区域类组装体模型尚未成功构建。</span></span></p><section nodeleaf=""><img data-imgfileid="100009323" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgwy9NqyGu8fvrTWL8wauv0jiauRcgFGmqVM3JGDL5voxB6TPdaicpNa9g/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgwy9NqyGu8fvrTWL8wauv0jiauRcgFGmqVM3JGDL5voxB6TPdaicpNa9g/640?wx_fmt=jpeg&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100009318" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgkVxAOltLoDwiapLCjAI9IRK26jU57TJ0mcdd80jXiax4Eu5HypNyHoPg/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgkVxAOltLoDwiapLCjAI9IRK26jU57TJ0mcdd80jXiax4Eu5HypNyHoPg/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100009324" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgQLribC7Vq7PZLLp4VYyofUrAmNCRhabnxzzA6umMQvSJhtWmnrW132Q/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgQLribC7Vq7PZLLp4VYyofUrAmNCRhabnxzzA6umMQvSJhtWmnrW132Q/640?wx_fmt=jpeg&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100009319" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgCKhqPJL6AtseTvsgEndS7xlWjribjyWzmFIzMOrOlLe41RibRe2pib0Hg/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgCKhqPJL6AtseTvsgEndS7xlWjribjyWzmFIzMOrOlLe41RibRe2pib0Hg/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100009325" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgIvKo0x6jcKv5WrakqxnFQ7h6xH3JsYH41YRrmaL6nbYOibCZUJYtD1Q/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgIvKo0x6jcKv5WrakqxnFQ7h6xH3JsYH41YRrmaL6nbYOibCZUJYtD1Q/640?wx_fmt=jpeg&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100009320" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgdl0wDCg957dOteLUwy2REcfAQz2oicrLib9IXKkgdwS2n1uY6FcHTVHg/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgdl0wDCg957dOteLUwy2REcfAQz2oicrLib9IXKkgdwS2n1uY6FcHTVHg/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100009326" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgxpu2Yqolrw1t7O6icA3VInl3TmuDjzaeAQbiakfetFTnV3gds04tHgHw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgxpu2Yqolrw1t7O6icA3VInl3TmuDjzaeAQbiakfetFTnV3gds04tHgHw/640?wx_fmt=jpeg&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100009321" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgqIacrRBV3TLuQiaYjaeIW62vLDT1TzNz9S1Z6GZft344uxES0Pu2v6w/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgqIacrRBV3TLuQiaYjaeIW62vLDT1TzNz9S1Z6GZft344uxES0Pu2v6w/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-imgfileid="100009327" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgZznuQFkXgdIbJNBA19l3KcILwkVydZL7rcYwELibyXLae7ZRIXHQ4Hg/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFvrqpHdfguWbGJnWrmPPWBgZznuQFkXgdIbJNBA19l3KcILwkVydZL7rcYwELibyXLae7ZRIXHQ4Hg/640?wx_fmt=jpeg&amp;from=appmsg"></section><section data-role="outer" label="Powered by 135editor.com onekey" data-pm-slice="0 0 []"><section><section data-bdopacity="20%"><section data-bdopacity="40%"><section data-bdopacity="60%"><section data-bdopacity="80%"><section data-bgopacity="90%"><p data-brushtype="text"><strong><strong><strong><span data-pm-slice="0 0 []"><span leaf="">Kim, Ji., Imaizumi, K., Jurjuț, O. </span><i><span leaf="">et al.</span></i><span><span leaf=""> Human assembloid model of the ascending neural sensory pathway. </span></span><i><span leaf="">Nature</span></i><span><span leaf=""> (2025)</span></span></span></strong></strong></strong></p><p data-brushtype="text"><strong><strong><strong><span leaf="">后苔↩️之前贴子的岸号即可霍得之前的</span></strong></strong></strong></p><p data-brushtype="text"><strong><strong><strong><strong data-pm-slice="0 0 []"><span leaf="">代码，今日关键词：250410</span></strong></strong></strong></strong></p></section></section></section></section></section></section></section><section data-pm-slice="0 0 []"><strong><strong><strong><span leaf=""><span textstyle="">基础、单细胞、空间各专题班，想系统性学习可以看下这个👇</span></span></strong></strong></strong><span><span leaf=""><br></span></span><section><span leaf=""><br></span></section><span><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=Mzk0MjcyMDk3Mg==&amp;mid=2247484123&amp;idx=1&amp;sn=a6cce80b4de771525c511d4bbceb0952&amp;scene=21#wechat_redirect" textvalue="不吹不黑，你想知道生信需要掌握哪些，光看这个大纲就会有不少收获" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2"><span textstyle="">不吹不黑，你想知道生信需要掌握哪些，光看这个大纲就会有不少收获</span></a></span><strong><span><span leaf=""><br></span><a href="https://mp.weixin.qq.com/s?__biz=Mzk0MjcyMDk3Mg==&amp;mid=2247484123&amp;idx=1&amp;sn=a6cce80b4de771525c511d4bbceb0952&amp;scene=21#wechat_redirect" imgurl="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2bvYMoCQeZd3cBr0oJmbLRP3hro4cE7hU3SBHytR7jQJz1YsVTvUPLgr6Tlot0ZfRePIBTZcvv86JzYO2tNSTg/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" linktype="image" tab="innerlink" data-itemshowtype="0" target="_blank" data-linktype="1"><span><img alt="图片" data-ratio="0.5990740740740741" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2bvYMoCQeZd3cBr0oJmbLRP3hro4cE7hU3SBHytR7jQJz1YsVTvUPLgr6Tlot0ZfRePIBTZcvv86JzYO2tNSTg/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2bvYMoCQeZd3cBr0oJmbLRP3hro4cE7hU3SBHytR7jQJz1YsVTvUPLgr6Tlot0ZfRePIBTZcvv86JzYO2tNSTg/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></span></a></span></strong></span></section><p><span><strong><span><span leaf="">有单细胞数据分析需求的可以看</span><strong><strong><span leaf="">👇这个文章</span></strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><strong><span><strong><strong></strong></strong></span></strong><strong><strong><strong><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247490275&amp;idx=1&amp;sn=200ccc0a415860f9d73b9068657096ff&amp;scene=21#wechat_redirect" textvalue="没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">没有服务器，单细胞数据搞不定？我们目前做好了这些pipeline，可以帮你做</a>（近期又添加了21 年发表在了 Cell上面的单细胞转录组分析代谢的分析——compass）</span></strong></strong></strong></strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><strong><span leaf=""><br></span></strong></strong></strong></span></strong></span></p><p><span><strong><span><strong><strong><strong><span leaf="">我们目前主要的分析内容看👇（这次的是对上次内容的补充 scBCR和 sc-TCR了）<a href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247492253&amp;idx=1&amp;sn=da8477aa80c485e7cfd12862047cd30b&amp;scene=21#wechat_redirect" textvalue="顶刊用啥分析，咱们就用啥，完全按照他们的做" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">顶刊用啥分析，咱们就用啥，完全按照他们的做</a></span></strong></strong></strong></span></strong></span></p><section data-pm-slice="0 0 []"><span leaf=""><a href="https://mp.weixin.qq.com/s?__biz=MzkwMzY2NjkwNg==&amp;mid=2247492768&amp;idx=1&amp;sn=f2b180496f982a5f912df2b66c5229a3&amp;scene=21#wechat_redirect" textvalue="每天好文章太多了，公众号分享不完，打算建个学习群，相互交流生信" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2"><span textstyle="">每天好文章太多了，公众号分享不完，打算建个学习群，相互交流生信</span></a><span textstyle="">（在这你能每天学到有关生信的前沿文献，我们会把最好的文献实时分享给大家，以及群内小伙伴们能够相互协作，共同解决一些生信上的问题）</span></span></section><section nodeleaf=""><img alt="图片" data-imgfileid="100009235" data-ratio="0.7675925925925926" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFsibBaljqp0Dsw1tuk0Ruqt9sUhyQv0ah7cUU5IoQ54b6Sfxiag6uTcdLicRicicoFSz8JpEfxtVaBHHSg/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="jpeg" data-w="1080" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFsibBaljqp0Dsw1tuk0Ruqt9sUhyQv0ah7cUU5IoQ54b6Sfxiag6uTcdLicRicicoFSz8JpEfxtVaBHHSg/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section><section nodeleaf=""><img alt="图片" data-imgfileid="100009257" data-ratio="1.3796296296296295" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFszqd8cpAAQELtsicOAkDzFGKkdR7FwS0Ons1vnuibw3dyLtcMqbtL1MnwpPd1qdfuqb7yWXsic7jicIw/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="jpeg" data-w="1080" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFszqd8cpAAQELtsicOAkDzFGKkdR7FwS0Ons1vnuibw3dyLtcMqbtL1MnwpPd1qdfuqb7yWXsic7jicIw/640?wx_fmt=jpeg&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span leaf=""><span>import</span> pandas <span>as</span> pd</span></code><code><span leaf=""><span>import</span> numpy <span>as</span> np</span></code><code><span leaf=""><span>import</span> matplotlib.pyplot <span>as</span> plt</span></code><code><span leaf=""><span>import</span> matplotlib <span>as</span> mpl</span></code><code><span leaf=""><span>from</span> matplotlib.patches <span>import</span> Arc</span></code><code><span leaf=""><span>import</span> networkx <span>as</span> nx</span></code><code><span leaf=""><span># 开启交互模式，允许在绘图后继续执行代码</span></span></code><code><span leaf="">plt.ion()</span></code><code><span leaf=""><span>def</span> <span>draw_semicircle</span>(<span>x1, y1, x2, y2, color=</span><span><span>'black'</span></span><span>, lw=</span><span><span>1</span></span><span>, ax=</span><span><span>None</span></span>):</span></code><code><span leaf="">    <span>'''</span></span></code><code><span leaf="">    绘制从点 (x1, y1) 到点 (x2, y2) 的圆弧</span></code><code><span leaf="">    该圆弧绘制在以 (0, 0) 为圆心的圆上，位于线段 ((x1, y1), (x2, y2)) 的右侧</span></code><code><span leaf="">    '''</span></code><code><span leaf="">    <span># 如果没有传入坐标轴对象，则使用当前活动的坐标轴</span></span></code><code><span leaf="">    ax = ax <span>or</span> plt.gca()</span></code><code><span leaf="">    <span># 计算直径，使用欧几里得距离</span></span></code><code><span leaf="">    diameter = <span>2</span> * np.sqrt(x1 ** <span>2</span> + y1 ** <span>2</span>)</span></code><code><span leaf="">    <span># 添加圆弧到坐标轴</span></span></code><code><span leaf="">    ax.add_patch(Arc((<span>0</span>, <span>0</span>), diameter, diameter, theta1=np.degrees(np.arctan2(y1,x1)), theta2=np.degrees(np.arctan2(y2,x2)),</span></code><code><span leaf="">                     edgecolor=color, facecolor=<span>'none'</span>, lw=lw, zorder=<span>0</span>, capstyle=<span>'round'</span>))</span></code><code><span leaf=""><span># 设置文件路径</span></span></code><code><span leaf="">basic_analysis_file = <span>r'path'</span></span></code><code><span leaf="">sca_analysis_file = <span>r'path'</span></span></code><code><span leaf="">save_fig_path = <span>r'path'</span></span></code><code><span leaf=""><span># 设置一些参数</span></span></code><code><span leaf=""><span># 用于缩放的固定最大相关值</span></span></code><code><span leaf="">fixed_max_correlation_for_scale = <span>1</span></span></code><code><span leaf=""><span># 线条的最大宽度</span></span></code><code><span leaf="">max_line_width = <span>24</span></span></code><code><span leaf=""><span># 图例中显示的 firing rate 值（单位：Hz）</span></span></code><code><span leaf="">firing_rates_for_legend = np.array([<span>1.5</span>, <span>0.5</span>])</span></code><code><span leaf=""><span># 绘图的缩放因子</span></span></code><code><span leaf="">plot_scale_factor = <span>1.8</span></span></code><code><span leaf=""><span># 绘图的方向，可选 'diagonal' 或 'cardinal'</span></span></code><code><span leaf="">plot_orientation = <span>'diagonal'</span>  <span># ['diagonal','cardinal']</span></span></code><code><span leaf=""><span># 用于分组的列名</span></span></code><code><span leaf="">grouping_column = <span>'Genotype'</span></span></code><code><span leaf=""><span># 设置区域的顺序和颜色</span></span></code><code><span leaf=""><span># 唯一的区域列表</span></span></code><code><span leaf="">uniq_regions = [<span>'hCO'</span>, <span>'hStrO'</span>, <span>'hMeO'</span>, <span>'hDiO'</span>]</span></code><code><span leaf=""><span># 区域对列表，将每个区域与下一个区域配对，最后一个区域与第一个区域配对</span></span></code><code><span leaf="">region_pairs = <span>list</span>(<span>zip</span>(uniq_regions, uniq_regions[<span>1</span>:] + [uniq_regions[<span>0</span>]]))</span></code><code><span leaf=""><span>if</span> plot_orientation == <span>'diagonal'</span>:</span></code><code><span leaf="">    <span># 对角线方向的节点位置</span></span></code><code><span leaf="">    node_pos = {<span>'hCO'</span>: np.array([-<span>0.7</span>, <span>0.7</span>]), <span>'hStrO'</span>: np.array([-<span>0.7</span>, -<span>0.7</span>]), <span>'hMeO'</span>: np.array([<span>0.7</span>, -<span>0.7</span>]), <span>'hDiO'</span>: np.array([<span>0.7</span>, <span>0.7</span>])}</span></code><code><span leaf=""><span>elif</span> plot_orientation == <span>'cardinal'</span>:</span></code><code><span leaf="">    <span># 基本方向（上下左右）的节点位置</span></span></code><code><span leaf="">    node_pos = {<span>'hCO'</span>: np.array([<span>0</span>, <span>1</span>]), <span>'hStrO'</span>: np.array([-<span>1</span>, <span>0</span>]), <span>'hMeO'</span>: np.array([<span>0</span>, -<span>1</span>]), <span>'hDiO'</span>: np.array([<span>1</span>, <span>0</span>])}</span></code><code><span leaf=""><span># 获取颜色映射</span></span></code><code><span leaf="">cmap = mpl.colormaps[<span>'tab10'</span>]</span></code><code><span leaf=""><span># 为每个区域设置颜色</span></span></code><code><span leaf="">node_colors = {<span>'hCO'</span>: cmap(<span>1</span>), <span>'hStrO'</span>: cmap(<span>0</span>), <span>'hMeO'</span>: cmap(<span>2</span>), <span>'hDiO'</span>: cmap(<span>3</span>)}</span></code><code><span leaf=""><span># 获取灰度颜色映射</span></span></code><code><span leaf="">grey_cmap = mpl.colormaps[<span>'Greys'</span>]</span></code><code><span leaf=""><span># 是否保存图形</span></span></code><code><span leaf="">save_figures = <span>True</span></span></code><code><span leaf=""><span># 为每个分组（这里是年龄组）绘制图形</span></span></code><code><span leaf=""><span># 读取基本分析文件</span></span></code><code><span leaf="">xls_basics = pd.ExcelFile(basic_analysis_file)</span></code><code><span leaf=""><span># 读取 SCA 分析文件</span></span></code><code><span leaf="">xls_cch = pd.ExcelFile(sca_analysis_file)</span></code><code><span leaf=""><span># 获取分组的唯一值</span></span></code><code><span leaf="">groups = pd.read_excel(xls_basics)[grouping_column].unique()</span></code><code><span leaf=""><span>for</span> group <span>in</span> groups:</span></code><code><span leaf="">    <span>if</span> grouping_column == <span>'RHD filename'</span>:</span></code><code><span leaf="">        <span>if</span> <span>'_A-'</span> <span>in</span> group:</span></code><code><span leaf="">            <span># 提取分组名称</span></span></code><code><span leaf="">            group_str = group.split(<span>'_A-'</span>)[<span>0</span>]</span></code><code><span leaf="">        <span>elif</span> <span>'_ChA-'</span> <span>in</span> group:</span></code><code><span leaf="">            <span># 提取分组名称</span></span></code><code><span leaf="">            group_str = group.split(<span>'_ChA-'</span>)[<span>0</span>]</span></code><code><span leaf="">        <span>else</span>:</span></code><code><span leaf="">            group_str = <span>'Unclear'</span></span></code><code><span leaf="">    <span>if</span> grouping_column == <span>'Genotype'</span>:</span></code><code><span leaf="">        group_str = group</span></code><code><span leaf="">    <span># 创建有向图，用于绘图</span></span></code><code><span leaf="">    G = nx.DiGraph()</span></code><code><span leaf="">    <span># 添加区域作为节点，节点大小为其 firing rate</span></span></code><code><span leaf="">    <span>for</span> i_r, reg <span>in</span> <span>enumerate</span>(uniq_regions):</span></code><code><span leaf="">        <span># 读取对应区域的 DataFrame</span></span></code><code><span leaf="">        reg_df = pd.read_excel(xls_basics, sheet_name=reg)</span></code><code><span leaf="">        <span># 计算该分组下该区域的平均 firing rate</span></span></code><code><span leaf="">        reg_firing_rate = np.mean(reg_df[reg_df[grouping_column] == group][<span>'Firing rate'</span>].values)</span></code><code><span leaf="">        <span># 添加节点到图中</span></span></code><code><span leaf="">        G.add_node(reg, size=reg_firing_rate, pos=np.unravel_index(i_r, [<span>2</span>, <span>2</span>]))</span></code><code><span leaf="">    <span># 添加选定的区域间边，边的权重为其相关性值</span></span></code><code><span leaf="">    <span>for</span> reg1, reg2 <span>in</span> region_pairs:</span></code><code><span leaf="">        reg_pair_str = <span>None</span></span></code><code><span leaf="">        <span>if</span> <span>'{}-{}'</span>.<span>format</span>(reg1, reg2) <span>in</span> xls_cch.sheet_names:</span></code><code><span leaf="">            reg_pair_str = <span>'{}-{}'</span>.<span>format</span>(reg1, reg2)</span></code><code><span leaf="">        <span>elif</span> <span>'{}-{}'</span>.<span>format</span>(reg2, reg1) <span>in</span> xls_cch.sheet_names:</span></code><code><span leaf="">            reg_pair_str = <span>'{}-{}'</span>.<span>format</span>(reg2, reg1)</span></code><code><span leaf="">        <span>if</span> reg_pair_str <span>is</span> <span>not</span> <span>None</span>:</span></code><code><span leaf="">            <span># 读取对应区域对的 DataFrame</span></span></code><code><span leaf="">            reg_pair_df = pd.read_excel(xls_cch, sheet_name=reg_pair_str)</span></code><code><span leaf="">            <span># 计算该分组下该区域对的平均最大相关性</span></span></code><code><span leaf="">            reg_pair_correlation = np.mean(reg_pair_df[reg_pair_df[grouping_column] == group][<span>'Max_correlation'</span>].values)</span></code><code><span leaf="">            <span># 添加边到图中</span></span></code><code><span leaf="">            G.add_edge(reg1, reg2, weight=reg_pair_correlation)</span></code><code><span leaf="">    <span># 添加区域内边，边的权重为其相关性值</span></span></code><code><span leaf="">    <span>for</span> reg1 <span>in</span> uniq_regions:</span></code><code><span leaf="">        reg_pair_str = <span>'{}-{}'</span>.<span>format</span>(reg1, reg1)</span></code><code><span leaf="">        <span>if</span> reg_pair_str <span>in</span> xls_cch.sheet_names:</span></code><code><span leaf="">            <span># 读取对应区域内的 DataFrame</span></span></code><code><span leaf="">            reg_pair_df = pd.read_excel(xls_cch, sheet_name=reg_pair_str)</span></code><code><span leaf="">            <span># 计算该分组下该区域内的平均最大相关性</span></span></code><code><span leaf="">            reg_pair_correlation = np.mean(reg_pair_df[reg_pair_df[grouping_column] == group][<span>'Max_correlation'</span>].values)</span></code><code><span leaf="">            <span># 添加边到图中</span></span></code><code><span leaf="">            G.add_edge(reg1, reg1, weight=reg_pair_correlation)</span></code><code><span leaf="">    <span># 创建图形和坐标轴</span></span></code><code><span leaf="">    f, ax = plt.subplots(figsize=[<span>5</span>, <span>4</span>])</span></code><code><span leaf="">    <span># 获取节点的大小属性</span></span></code><code><span leaf="">    nodes = nx.get_node_attributes(G, <span>'size'</span>)</span></code><code><span leaf="">    <span># 获取边的权重属性</span></span></code><code><span leaf="">    edges = nx.get_edge_attributes(G, <span>'weight'</span>)</span></code><code><span leaf="">    <span># 获取最大节点大小</span></span></code><code><span leaf="">    max_node_size = np.<span>max</span>(<span>list</span>(nodes.values()))</span></code><code><span leaf="">    <span># 获取最大边的权重</span></span></code><code><span leaf="">    max_edge_size = np.<span>max</span>(<span>list</span>(edges.values()))</span></code><code><span leaf="">    <span># 定义一个从 0 到 10 的刻度，步长为 0.2</span></span></code><code><span leaf="">    scale = np.linspace(<span>0</span>, <span>10</span>, retstep=<span>0.2</span>)[<span>0</span>]</span></code><code><span leaf="">    <span># 获取最接近最大边权重的刻度值</span></span></code><code><span leaf="">    max_edge_scale = np.floor(scale[np.argmin(np.<span>abs</span>(scale - max_edge_size))] * <span>10</span>) / <span>10</span></span></code><code><span leaf="">    <span># 如果定义了固定的刻度，则覆盖该值</span></span></code><code><span leaf="">    max_edge_scale = np.<span>max</span>([max_edge_scale, fixed_max_correlation_for_scale])</span></code><code><span leaf="">    <span># 添加一个大的灰色圆圈</span></span></code><code><span leaf="">    great_circle_gray = plt.Circle([<span>0</span>, <span>0</span>], <span>2.5</span> * plot_scale_factor, color=<span>'white'</span>, lw=<span>0</span>, fill=<span>False</span>, zorder=-<span>3</span>)</span></code><code><span leaf="">    ax.add_patch(great_circle_gray)</span></code><code><span leaf="">    <span># 绘制节点和边</span></span></code><code><span leaf="">    <span>for</span> n, nv <span>in</span> nodes.items():</span></code><code><span leaf="">        <span># 定义气泡和自环的半径</span></span></code><code><span leaf="">        bubble_radius = np.<span>max</span>([np.sqrt(nv / np.pi), <span>0</span>])</span></code><code><span leaf="">        loop_radius = np.<span>max</span>([bubble_radius, <span>0.5</span>])</span></code><code><span leaf="">        <span># 定义自环的偏移量</span></span></code><code><span leaf="">        loop_offset = np.array([loop_radius * <span>0.75</span> * np.sign(node_pos[n][<span>0</span>]), loop_radius * <span>0.75</span> * np.sign(node_pos[n][<span>1</span>])])</span></code><code><span leaf="">        <span># 绘制自环</span></span></code><code><span leaf="">        loop_color = <span>'silver'</span></span></code><code><span leaf="">        <span>if</span> ~np.isnan(edges[(n, n)]):</span></code><code><span leaf="">            <span># 计算自环的线宽</span></span></code><code><span leaf="">            loop_line_width = np.<span>max</span>([<span>int</span>((max_line_width * edges[(n, n)]) / max_edge_scale), <span>2</span>])</span></code><code><span leaf="">            <span># 添加自环到坐标轴</span></span></code><code><span leaf="">            loop_circle_gray = plt.Circle(node_pos[n] * plot_scale_factor + loop_offset, loop_radius, color=loop_color, lw=loop_line_width, fill=<span>False</span>, zorder=-<span>1</span>)</span></code><code><span leaf="">            ax.add_patch(loop_circle_gray)</span></code><code><span leaf="">        <span># 绘制节点</span></span></code><code><span leaf="">        node_circle = plt.Circle(node_pos[n] * plot_scale_factor, bubble_radius, facecolor=node_colors[n], fill=<span>True</span>, label=n, linewidth=<span>1</span>, edgecolor=<span>'k'</span>)</span></code><code><span leaf="">        ax.add_patch(node_circle)</span></code><code><span leaf="">        <span># 绘制节点名称</span></span></code><code><span leaf="">        text_x, text_y = node_pos[n] * plot_scale_factor * <span>2.3</span></span></code><code><span leaf="">        ax.text(text_x, text_y, n, fontsize=<span>12</span>, horizontalalignment=<span>'center'</span>, verticalalignment=<span>'center'</span>, color=<span>'k'</span>)</span></code><code><span leaf="">        <span># 绘制选定的区域间边</span></span></code><code><span leaf="">        <span>for</span> e, ev <span>in</span> edges.items():</span></code><code><span leaf="">            <span>if</span> e[<span>0</span>] == n <span>and</span> e[<span>0</span>] != e[<span>1</span>] <span>and</span> ~np.isnan(ev):</span></code><code><span leaf="">                line_color = <span>'silver'</span></span></code><code><span leaf="">                <span># 计算边的线宽</span></span></code><code><span leaf="">                line_width = np.<span>max</span>([<span>int</span>((max_line_width * ev) / max_edge_scale), <span>2</span>])</span></code><code><span leaf="">                <span># 绘制半圆弧边</span></span></code><code><span leaf="">                draw_semicircle(node_pos[e[<span>0</span>]][<span>0</span>] * plot_scale_factor, node_pos[e[<span>0</span>]][<span>1</span>] * plot_scale_factor,</span></code><code><span leaf="">                                node_pos[e[<span>1</span>]][<span>0</span>] * plot_scale_factor, node_pos[e[<span>1</span>]][<span>1</span>] * plot_scale_factor, color=line_color, lw=line_width, ax=ax)</span></code><code><span leaf="">    <span># 设置坐标轴为空，并设置标题</span></span></code><code><span leaf="">    ax.set_title(group_str)</span></code><code><span leaf="">    ax.set_xticks([])</span></code><code><span leaf="">    ax.set_yticks([])</span></code><code><span leaf="">    <span># 气泡大小图例</span></span></code><code><span leaf="">    <span># 计算图例中气泡的半径</span></span></code><code><span leaf="">    legend_bubble_radius = np.sqrt(firing_rates_for_legend / np.pi)</span></code><code><span leaf="">    y_offset = <span>0</span></span></code><code><span leaf="">    <span>for</span> i_bubble <span>in</span> <span>range</span>(<span>len</span>(legend_bubble_radius)):</span></code><code><span leaf="">        <span>if</span> i_bubble &gt; <span>0</span>:</span></code><code><span leaf="">            <span># 计算 y 方向的偏移量</span></span></code><code><span leaf="">            y_offset = y_offset + legend_bubble_radius[i_bubble] + legend_bubble_radius[i_bubble - <span>1</span>] + <span>0.3</span></span></code><code><span leaf="">        <span>if</span> plot_orientation == <span>'diagonal'</span>:</span></code><code><span leaf="">            <span># 对角线方向的圆心位置</span></span></code><code><span leaf="">            center = (<span>0</span>, -<span>1.8</span> * plot_scale_factor - y_offset)</span></code><code><span leaf="">        <span>elif</span> plot_orientation == <span>'cardinal'</span>:</span></code><code><span leaf="">            <span># 基本方向的圆心位置</span></span></code><code><span leaf="">            center = (plot_scale_factor + <span>1</span>, -plot_scale_factor - <span>1</span> - y_offset)</span></code><code><span leaf="">        <span># 绘制图例中的气泡</span></span></code><code><span leaf="">        bubble = plt.Circle(center, legend_bubble_radius[i_bubble], fill=<span>False</span>, label=n, linewidth=<span>1</span>, edgecolor=<span>'k'</span>)</span></code><code><span leaf="">        ax.add_patch(bubble)</span></code><code><span leaf="">        <span># 绘制图例中的文本</span></span></code><code><span leaf="">        text_x = center[<span>0</span>] + legend_bubble_radius[<span>0</span>] * <span>1.2</span></span></code><code><span leaf="">        text_y = center[<span>1</span>]</span></code><code><span leaf="">        ax.text(text_x, text_y, <span>'{} Hz'</span>.<span>format</span>(firing_rates_for_legend[i_bubble]), fontsize=<span>10</span>, horizontalalignment=<span>'left'</span>, verticalalignment=<span>'center'</span>, color=<span>'k'</span>)</span></code><code><span leaf="">    <span># 设置坐标轴比例相等</span></span></code><code><span leaf="">    ax.axis(<span>'equal'</span>)</span></code><code><span leaf="">    <span># 线宽图例</span></span></code><code><span leaf="">    <span># 计算图例中的标签数量</span></span></code><code><span leaf="">    n_labels = <span>int</span>(max_edge_scale * <span>10</span> / <span>2</span> + <span>1</span>)</span></code><code><span leaf="">    <span># 生成图例中的标签</span></span></code><code><span leaf="">    line_labels = np.linspace(<span>0</span>, max_edge_scale, n_labels)</span></code><code><span leaf="">    <span># 计算图例中的线宽</span></span></code><code><span leaf="">    line_widths = [np.<span>max</span>([<span>int</span>(max_line_width * label / max_edge_scale), <span>1</span>]) <span>for</span> label <span>in</span> line_labels]</span></code><code><span leaf="">    <span># 创建图例中的标记</span></span></code><code><span leaf="">    markers = [plt.Line2D([<span>0</span>, <span>0</span>], [<span>0</span>, <span>0</span>], color=<span>'gray'</span>, lw=lw, solid_capstyle=<span>'butt'</span>) <span>for</span> lw <span>in</span> line_widths]</span></code><code><span leaf="">    <span># 添加图例</span></span></code><code><span leaf="">    ax.legend(markers, [<span>'{:.1f}'</span>.<span>format</span>(l) <span>for</span> l <span>in</span> line_labels], numpoints=<span>1</span>, title=<span>'Peak corr.'</span>, loc=<span>'center right'</span>)</span></code><code><span leaf="">    <span># 自动调整布局</span></span></code><code><span leaf="">    f.tight_layout()</span></code><code><span leaf="">    <span>if</span> save_figures:</span></code><code><span leaf="">        <span># 保存图形为 SVG 格式</span></span></code><code><span leaf="">        f.savefig(save_fig_path + <span>'\\'</span> + <span>'bubble_plot_{}'</span>.<span>format</span>(group_str) + <span>'.svg'</span>)</span></code><code><span leaf="">        <span># 保存图形为 PNG 格式</span></span></code><code><span leaf="">        <span># f.savefig(save_fig_path + '\\' + 'bubble_plot_{}'.format(group_str) + '.png')</span></span></code><code><span leaf="">break_point = <span>1</span></span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/_nGulOmLlJD8xaA4CPnOZA",target="_blank" rel="noopener noreferrer">原文链接</a>
