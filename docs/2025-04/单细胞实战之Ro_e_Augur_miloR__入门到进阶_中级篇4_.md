---
title: "å•ç»†èƒå®æˆ˜ä¹‹Ro/eã€Augurã€miloRâ€”â€”å…¥é—¨åˆ°è¿›é˜¶(ä¸­çº§ç¯‡4ï¼‰"
date: 2025-04-06T13:05:16Z
draft: ["false"]
tags: [
  "fetched",
  "å•ç»†èƒå¤©åœ°"
]
categories: ["Acdemic"]
---
å•ç»†èƒå®æˆ˜ä¹‹Ro/eã€Augurã€miloRâ€”â€”å…¥é—¨åˆ°è¿›é˜¶(ä¸­çº§ç¯‡4ï¼‰ by å•ç»†èƒå¤©åœ°
------
<div><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">åœ¨ä¸Šä¸€è®²ä¸­å®Œæˆäº†inferCNVåˆ†ææµç¨‹ï¼Œ<a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247528986&amp;idx=1&amp;sn=41d3a7cd4dea69bb5e03335dfe803060&amp;scene=21#wechat_redirect" textvalue="å•ç»†èƒå®æˆ˜ä¹‹inferCNVâ€”â€”å…¥é—¨åˆ°è¿›é˜¶(ä¸­çº§ç¯‡3ï¼‰" data-itemshowtype="0" target="_blank" linktype="text" data-linktype="2">å•ç»†èƒå®æˆ˜ä¹‹inferCNVâ€”â€”å…¥é—¨åˆ°è¿›é˜¶(ä¸­çº§ç¯‡3ï¼‰</a></span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">æœ¬è®²å°†å›é¡¾å­¦ä¹ å•ç»†èƒåˆ†æä¸­çš„ä¸‰ä¸ªå·¥å…·ï¼šRo/eã€Augurã€miloRï¼Œè¿™ä¸‰ä¸ªå·¥å…·åˆ†åˆ«èƒ½å¤Ÿåˆ¤æ–­ç»†èƒç°‡åœ¨ç»„ç»‡åˆ†å¸ƒå€¾å‘ã€æ‰°åŠ¨å½±å“å’Œç»†èƒå·®å¼‚ä¸°åº¦ã€‚</span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">æœ¬æ¬¡å†…å®¹æ¶‰åŠåˆ°çš„å·¥ç¨‹æ–‡ä»¶å¯é€šè¿‡ç½‘ç›˜è·å¾—ï¼šä¸­çº§ç¯‡2ï¼Œé“¾æ¥: https://pan.baidu.com/s/1y-HHLXoXsJbgWKCdz26-gQ æå–ç : yx93 ã€‚</span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">æ­¤å¤–ï¼Œå¯ä»¥å‘â€œç”Ÿä¿¡æŠ€èƒ½æ ‘â€å…¬ä¼—å·å‘é€å…³é”®è¯â€˜å•ç»†èƒâ€™ï¼Œç›´æ¥è·å–Seurat V5ç‰ˆæœ¬çš„å®Œæ•´ä»£ç ã€‚</span></p><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">Ro/eâ€”â€”åˆ¤æ–­ç»†èƒç°‡åœ¨ç»„ç»‡åˆ†å¸ƒå€¾å‘çš„åˆ†æå·¥å…·</span><span></span></h5><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">Ro/eåˆ†æåˆç§°ä¸ºSTARTRAC-distribution(å¼ æ³½æ°‘é™¢å£«å›¢é˜Ÿå¼€å‘çš„STARTRACæ¡†æ¶ä¸­çš„å…¶ä¸­ä¸€ä¸ªå·¥å…·)çš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡è®¡ç®—ç»„ç»‡ä¸­è§‚æµ‹ç»†èƒæ•°ä¸æœŸæœ›ç»†èƒæ•°ï¼ˆæœŸæœ›ç»†èƒæ•°é€šè¿‡å¡æ–¹æ£€éªŒè®¡ç®—å¾—å‡ºï¼‰çš„æ¯”ç‡ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqZI6pL4qeibWicU56Bdt9vDTTWWWy4B42icbx2ibezwhMv65Ywmphcfich5g/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.9283387622149837" data-type="png" data-w="614" data-imgfileid="100045497" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqZI6pL4qeibWicU56Bdt9vDTTWWWy4B42icbx2ibezwhMv65Ywmphcfich5g/640?wx_fmt=png&amp;from=appmsg">ä¸å¡æ–¹æ£€éªŒä¸­å®šä¹‰çš„ (è§‚æµ‹å€¼-æœŸæœ›ç»†èƒæ•°)Â²/æœŸæœ›ç»†èƒæ•°ä»…èƒ½åæ˜ è§‚æµ‹å€¼ä¸æœŸæœ›ç»†èƒæ•°çš„åç¦»ç¨‹åº¦ä¸åŒï¼ŒSTARTRACé€šè¿‡Ro/e å¯è¿›ä¸€æ­¥æŒ‡ç¤ºç‰¹å®šç»†èƒç°‡åœ¨ç‰¹å®šç»„ç»‡ä¸­æ˜¯å¦å¯Œé›†æˆ–è€—ç«­ã€‚å¦‚ä¸‹å›¾ä¸­æ˜¯åˆ†æä¸åŒçš„Tç»†èƒç°‡/å·¨å™¬ç»†èƒç°‡åœ¨ä¸åŒç»„ç»‡ä¸­çš„Ro/eå¯Œé›†æƒ…å†µã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqGJ01vMRkUxwIZH4rG3IGoBE8rNwaMf61p6iaHWUT6Au17qpCQajKANA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5648148148148148" data-type="png" data-w="1080" data-imgfileid="100045498" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqGJ01vMRkUxwIZH4rG3IGoBE8rNwaMf61p6iaHWUT6Au17qpCQajKANA/640?wx_fmt=png&amp;from=appmsg"></span><strong><span leaf="">Ro/e æŒ‡æ•°çš„è¯„åˆ†è§„åˆ™ ï¼š</span></strong></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">å¦‚æœ Ro/e&gt;1ï¼Œåˆ™è¡¨æ˜åœ¨è¯¥ç»„ç»‡ä¸­ï¼ŒæŸç»†èƒç°‡çš„ç»†èƒæ•°é‡é«˜äºæœŸæœ›ç»†èƒæ•°ï¼Œå³è¡¨ç°ä¸ºå¯Œé›†ï¼›å¦‚æœ Ro/e&lt;1ï¼Œåˆ™è¡¨æ˜æŸç»†èƒç°‡åœ¨è¯¥ç»„ç»‡ä¸­çš„ç»†èƒæ•°é‡ä½äºæœŸæœ›ç»†èƒæ•°ï¼Œå³è¡¨ç°ä¸ºæ¶ˆè€—ã€‚ +++, Ro/e &gt; 1; ++, 0.8 &lt; Ro/e â‰¤ 1; +, 0.2 â‰¤ Ro/e â‰¤ 0.8; +/âˆ’, 0 &lt; Ro/e &lt; 0.2; âˆ’, Ro/e = 0<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqq3VqibZSCeBC0IXbg6LLkIo6xAEY5ibUekNJoCks606FheZY31AYbTDlQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.26785714285714285" data-type="png" data-w="616" data-imgfileid="100045494" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqq3VqibZSCeBC0IXbg6LLkIo6xAEY5ibUekNJoCks606FheZY31AYbTDlQ/640?wx_fmt=png&amp;from=appmsg">ä¸ªäººè®¤ä¸ºæœŸæœ›ç»†èƒæ•°ä¹Ÿæ˜¯åŸºäºç°æœ‰æ•°æ®è¿›è¡Œæµ‹ç®—çš„å¹¶ä¸”æœ€åç”Ÿæˆçš„å€¼æ˜¯æ¯”ç‡ï¼Œæ‰€ä»¥å…¶å®æœ€ç»ˆç»“æœè·Ÿç»†èƒæ•°æœ¬èº«å¾ˆæœ‰å…³ç³»ï¼ŒåŒæ—¶ç»†èƒæ•°é‡ä¹Ÿä¸åº”å¤ªå°‘ï¼Œå®¹æ˜“å‡ºç°å¾ˆå¤§çš„åå€šã€‚</span></p><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">Ro/e æŒ‡æ•°åˆ†ææ­¥éª¤</span><span></span></h5><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">1.å¯¼å…¥</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">rm(list = ls())</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(Startrac)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(tictoc)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggpubr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ComplexHeatmap)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(RColorBrewer)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(circlize)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(tidyverse)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(sscVis)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(Seurat)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(tidyverse)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(readr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(qs)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(BiocParallel)</span><span leaf=""><br></span><span leaf="">register(MulticoreParam(workers =Â </span><span><span leaf="">8</span></span><span leaf="">, progressbar =Â </span><span><span leaf="">TRUE</span></span><span leaf="">))Â </span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">scRNA &lt;- qread(</span><span><span leaf="">"./9-CD4+T/CD4+t_final.qs"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Idents(scRNA) &lt;-Â </span><span><span leaf="">"celltype"</span></span><span leaf=""><br></span><span leaf="">DimPlot(scRNA)</span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">2.æ•°æ®é¢„å¤„ç†</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">data Â &lt;- scRNA@meta.data</span><span leaf=""><br></span><span leaf="">colnames(data)</span><span leaf=""><br></span><span><span leaf=""># Â [1] "orig.ident" Â  Â  Â  Â  "nCount_RNA" Â  Â  Â  Â  "nFeature_RNA" Â  Â  Â  "percent_mito" Â  Â  Â </span></span><span leaf=""><br></span><span><span leaf=""># Â [5] "percent_ribo" Â  Â  Â  "percent_hb" Â  Â  Â  Â  "RNA_snn_res.0.01" Â  "seurat_clusters" Â Â </span></span><span leaf=""><br></span><span><span leaf=""># Â [9] "RNA_snn_res.0.05" Â  "RNA_snn_res.0.1" Â  Â "RNA_snn_res.0.2" Â  Â "RNA_snn_res.0.3" Â Â </span></span><span leaf=""><br></span><span><span leaf=""># [13] "RNA_snn_res.0.5" Â  Â "RNA_snn_res.0.8" Â  Â "RNA_snn_res.1" Â  Â  Â "celltype" Â  Â  Â  Â  Â </span></span><span leaf=""><br></span><span><span leaf=""># [17] "location" Â  Â  Â  Â  Â  "pANN_0.25" Â  Â  Â  Â  Â "DF.classifications" "contamination" Â  Â Â </span></span><span leaf=""><br></span><span><span leaf=""># [21] "RNA_snn_res.0.4" Â  Â "RNA_snn_res.0.6" Â  Â "RNA_snn_res.0.7" Â  Â "RNA_snn_res.0.9" Â Â </span></span><span leaf=""><br></span><span><span leaf=""># [25] "RNA_snn_res.1.1" Â  Â "RNA_snn_res.1.2" Â  Â "RNA_snn_res.1.3" Â  Â "RNA_snn_res.1.4" Â Â </span></span><span leaf=""><br></span><span><span leaf=""># [29] "RNA_snn_res.1.5" Â  Â "RNA_snn_res.1.6" Â  Â "RNA_snn_res.1.7" Â  Â "RNA_snn_res.1.8" Â Â </span></span><span leaf=""><br></span><span><span leaf=""># [33] "RNA_snn_res.1.9" Â  Â "RNA_snn_res.2"Â </span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># éœ€è¦å¾—åˆ°clone.id(IDæ ‡è¯†),patient(æ ·æœ¬),majorCluster(ç»†èƒäºšç¾¤),loc(ä¸åŒç»„ç»‡/ä½ç½®)åˆ—</span></span><span leaf=""><br></span><span><span leaf=""># å¹¶ä¸”éœ€è¦é‡æ–°å‘½å</span></span><span leaf=""><br></span><span leaf="">data &lt;- data[,c(</span><span><span leaf="">34</span></span><span leaf="">,</span><span><span leaf="">1</span></span><span leaf="">,</span><span><span leaf="">16</span></span><span leaf="">,</span><span><span leaf="">17</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf="">colnames(data) &lt;- c(</span><span><span leaf="">"clone.id"</span></span><span leaf="">,</span><span><span leaf="">"patient"</span></span><span leaf="">,</span><span><span leaf="">"majorCluster"</span></span><span leaf="">,</span><span><span leaf="">"loc"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">data$Cell_Name &lt;- c(</span><span><span leaf="">"T cell"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">data$patient &lt;- as.character(data$patient)</span><span leaf=""><br></span><span leaf="">data$clone.id &lt;- as.character(data$clone.id)</span><span leaf=""><br></span><span leaf="">data$majorCluster &lt;- as.character(data$majorCluster)</span><span leaf=""><br></span><span leaf="">data$loc &lt;- as.character(data$loc)</span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">3.Ro/eåˆ†æ</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Roe &lt;- calTissueDist(data,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â byPatient =Â </span><span><span leaf="">F</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â colname.cluster =Â </span><span><span leaf="">"majorCluster"</span></span><span leaf="">,Â </span><span><span leaf=""># ä¸åŒç»†èƒäºšç¾¤</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â colname.patient =Â </span><span><span leaf="">"patient"</span></span><span leaf="">,Â </span><span><span leaf=""># ä¸åŒæ ·æœ¬</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â colname.tissue =Â </span><span><span leaf="">"loc"</span></span><span leaf="">,Â </span><span><span leaf=""># ä¸åŒç»„ç»‡</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â method =Â </span><span><span leaf="">"chisq"</span></span><span leaf="">,Â </span><span><span leaf=""># "chisq", "fisher", and "freq"Â </span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â min.rowSum =Â </span><span><span leaf="">0</span></span><span leaf="">)Â </span><span leaf=""><br></span><span leaf="">Roe</span><span leaf=""><br></span><span><span leaf=""># Â  Â  Â  Â  Â  Â  Â  left Â  Â  right</span></span><span leaf=""><br></span><span><span leaf=""># ELK4+T Â  Â 1.3286764 0.7309727</span></span><span leaf=""><br></span><span><span leaf=""># Naive T Â  0.6669732 1.2725882</span></span><span leaf=""><br></span><span><span leaf=""># Th1 Â  Â  Â  0.8664169 1.1093401</span></span><span leaf=""><br></span><span><span leaf=""># Th17 Â  Â  Â 1.2137669 0.8250281</span></span><span leaf=""><br></span><span><span leaf=""># Tm Â  Â  Â  Â 0.9822346 1.0145413</span></span><span leaf=""><br></span><span><span leaf=""># Treg Â  Â  Â 1.3638576 0.7021762</span></span><span leaf=""><br></span><span><span leaf=""># ZNF793+T Â 1.0462073 0.9621785</span></span><span leaf=""><br></span><span><span leaf=""># ZSCAN12+T 0.5643888 1.3565553</span></span><span leaf=""><br></span><span><span leaf=""># è¿™æ˜¯æœ€å…³é”®çš„å€¼ï¼Œç„¶åè¿›è¡Œå¯è§†åŒ–å³å¯</span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">4.å¯è§†åŒ–</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">table(data$majorCluster)</span><span leaf=""><br></span><span><span leaf=""># ELK4+T Â  Naive T Â  Â  Â  Th1 Â  Â  Â Th17 Â  Â  Â  Â Tm Â  Â  Â Treg Â ZNF793+T ZSCAN12+TÂ </span></span><span leaf=""><br></span><span><span leaf=""># Â  Â 204 Â  Â  Â 1459 Â  Â  Â  818 Â  Â  Â  421 Â  Â  Â 1045 Â  Â  Â 1528 Â  Â  Â  189 Â  Â  Â  248Â </span></span><span leaf=""><br></span><span leaf="">col_fun &lt;- colorRamp2(c(min(Roe, na.rm =Â </span><span><span leaf="">TRUE</span></span><span leaf="">),Â </span><span><span leaf="">1</span></span><span leaf="">, max(Roe, na.rm =Â </span><span><span leaf="">TRUE</span></span><span leaf="">)),Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  c(</span><span><span leaf="">"blue"</span></span><span leaf="">,Â </span><span><span leaf="">"white"</span></span><span leaf="">,Â </span><span><span leaf="">"red"</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf="">Heatmap(as.matrix(Roe),</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  show_heatmap_legend =Â </span><span><span leaf="">TRUE</span></span><span leaf="">,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  cluster_rows =Â </span><span><span leaf="">TRUE</span></span><span leaf="">,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  cluster_columns =Â </span><span><span leaf="">TRUE</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  row_names_side =Â </span><span><span leaf="">'right'</span></span><span leaf="">,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  show_column_names =Â </span><span><span leaf="">TRUE</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  show_row_names =Â </span><span><span leaf="">TRUE</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  col = col_fun,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  row_names_gp = gpar(fontsize =Â </span><span><span leaf="">10</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  column_names_gp = gpar(fontsize =Â </span><span><span leaf="">10</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  heatmap_legend_param = list(</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  title =Â </span><span><span leaf="">"Ro/e Index"</span></span><span leaf="">, Â </span><span><span leaf=""># è‡ªå®šä¹‰å›¾æ³¨åç§°</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  at = seq(</span><span><span leaf="">0.5</span></span><span leaf="">,Â </span><span><span leaf="">1.5</span></span><span leaf="">, by =Â </span><span><span leaf="">0.5</span></span><span leaf="">),Â </span><span><span leaf=""># ä¾‹åˆ»åº¦çš„ä½ç½®/è‡ªå·±çš„æ•°æ®å¿…é¡»ä¿®æ”¹ä¸€ä¸‹ï¼</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  labels = seq(</span><span><span leaf="">0.5</span></span><span leaf="">,Â </span><span><span leaf="">1.5</span></span><span leaf="">, by =Â </span><span><span leaf="">0.5</span></span><span leaf="">)Â </span><span><span leaf=""># æ¯ä¸ªåˆ»åº¦çš„æ ‡ç­¾/è‡ªå·±çš„æ•°æ®å¿…é¡»ä¿®æ”¹ä¸€ä¸‹ï¼</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  ),</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  cell_fun =Â </span><span><span leaf="">function</span></span><span leaf="">(j, i, x, y, width, height, fill) {</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  grid.text(sprintf(</span><span><span leaf="">"%.2f"</span></span><span leaf="">, Roe[i, j]), x, y, gp = gpar(fontsize =Â </span><span><span leaf="">8</span></span><span leaf="">, col =Â </span><span><span leaf="">"black"</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  }</span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># cell_fun = function(j, i, x, y, width, height, fill)</span></span><span leaf=""><br></span><span><span leaf=""># j å’Œ iï¼šåˆ†åˆ«è¡¨ç¤ºå•å…ƒæ ¼çš„åˆ—å’Œè¡Œç´¢å¼•ã€‚</span></span><span leaf=""><br></span><span><span leaf=""># x å’Œ yï¼šæ˜¯å•å…ƒæ ¼çš„ä¸­å¿ƒä½ç½®åæ ‡ï¼Œç”¨äºç¡®å®šæ–‡æœ¬çš„ä½ç½®ã€‚</span></span><span leaf=""><br></span><span><span leaf=""># width å’Œ heightï¼šè¡¨ç¤ºå•å…ƒæ ¼çš„å®½åº¦å’Œé«˜åº¦ï¼Œå¯ä»¥ç”¨æ¥è°ƒæ•´æ–‡æœ¬ä½ç½®æˆ–å¤§å°ã€‚</span></span><span leaf=""><br></span><span><span leaf=""># fillï¼šè¡¨ç¤ºå•å…ƒæ ¼çš„èƒŒæ™¯é¢œè‰²ã€‚</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">setwd(</span><span><span leaf="">".."</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqq1bpUOl5AialmUSAFxiaNSibFL6vvra1iaeJmgExXjAlHHAgU5UjON1EMEw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.4083333333333333" data-type="png" data-w="1080" data-imgfileid="100045495" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqq1bpUOl5AialmUSAFxiaNSibFL6vvra1iaeJmgExXjAlHHAgU5UjON1EMEw/640?wx_fmt=png&amp;from=appmsg">ä»ç»†èƒæ•°å’ŒRo/eå€¼å¯ä»¥çœ‹åˆ°å·¦åŠç»“è‚ ä¸­å­˜åœ¨è¾ƒå¤šæ•°é‡çš„Tregç»†èƒä»¥åŠè¾ƒé«˜çš„Ro/eå€¼ï¼ŒNaive Tç»†èƒåˆ™åœ¨å³åŠç»“è‚ ä¸­æ›´å¤šå’Œæ˜¾è‘—çš„Ro/eå€¼ã€‚å› æ­¤ï¼Œè¿™ä¹Ÿç¬¦åˆç°æœ‰çš„ç”Ÿç‰©å­¦çŸ¥è¯†ï¼Œå³åŠç»“è‚ ç™Œé€šå¸¸å…·æœ‰æ›´é«˜çš„å…ç–«åŸæ€§è€Œå·¦åŠç»“è‚ ç™Œåˆ™ç›¸åã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqTqLA3kIoaXLPenqJtZOjxGRiaxWvuKPFe2KVG6bg0icG5915Ku7vUQvw/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.1453634085213034" data-type="png" data-w="798" data-imgfileid="100045496" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqTqLA3kIoaXLPenqJtZOjxGRiaxWvuKPFe2KVG6bg0icG5915Ku7vUQvw/640?wx_fmt=png&amp;from=appmsg"></span></p><h4 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">Augurâ€”â€”åˆ¤æ–­æ‰°åŠ¨å½±å“çš„åˆ†æå·¥å…·</span><span></span></h4><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">Augurèƒ½å¤Ÿåœ¨å•ç»†èƒæ•°æ®ä¸­ä¼˜å…ˆè€ƒè™‘å¯¹ç”Ÿç‰©æ‰°åŠ¨æœ€æ•æ„Ÿçš„ç»†èƒç±»å‹ï¼Œå…¶é‡‡ç”¨æœºå™¨å­¦ä¹ æ¡†æ¶æ¥é‡åŒ–æ‰°åŠ¨å’Œæœªæ‰°åŠ¨ç»†èƒåœ¨é«˜ç»´ç©ºé—´ä¸­çš„å¯åˆ†æ€§(æ¯”å¦‚ä¸åŒçš„ç–¾ç—…çŠ¶æ€ï¼Œè¯ç‰©åˆºæ¿€ç­‰)ã€‚Augur ä½¿ç”¨çš„æœºå™¨å­¦ä¹ æ¡†æ¶ä¾èµ–äºåˆ†ç±»ç®—æ³•ï¼Œå¦‚éšæœºæ£®æ—ï¼ˆRandom Forestsï¼‰æˆ–é€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰ï¼Œè¿™äº›ç®—æ³•éå¸¸é€‚åˆå¤„ç†å…·æœ‰é«˜ç»´ç‰¹å¾ç©ºé—´çš„å•ç»†èƒæ•°æ®ã€‚</span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">Augurçš„å…·ä½“åšæ³•æ˜¯ï¼šé€šè¿‡åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿä»…å‡­åˆ†å­ç‰¹å¾å‡†ç¡®é¢„æµ‹å‡ºæ¯ä¸ªç»†èƒçš„å®éªŒå¤„ç†æ ‡ç­¾ï¼ˆå¦‚å¤„ç†ç»„ vs å¯¹ç…§ç»„ï¼‰ï¼Œæ¥é‡åŒ–è¿™ç§å¯åˆ†ç¦»æ€§ã€‚åœ¨å®é™…æ“ä½œä¸­ï¼Œå®ƒä¼šä¸ºæ¯ç§ç»†èƒç±»å‹å•ç‹¬è®­ç»ƒä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œç”¨äºé¢„æµ‹æ¯ä¸ªç»†èƒæ¥è‡ªå“ªä¸ªå®éªŒæ¡ä»¶ã€‚æ¥ç€ï¼Œé€šè¿‡äº¤å‰éªŒè¯è¯„ä¼°æ¯ä¸ªç»†èƒç±»å‹ç‰¹å®šåˆ†ç±»å™¨çš„å‡†ç¡®æ€§ï¼Œä»è€Œä¸ºç»†èƒç±»å‹çš„ä¼˜å…ˆçº§æ’åºæä¾›ä¸€ä¸ªå®šé‡çš„ä¾æ®ã€‚</span></p><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">Auguråˆ†ææµç¨‹</span><span></span></h5><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">1.å¯¼å…¥</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">rm(list = ls())</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(stringr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(Seurat)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(Augur)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(dplyr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(patchwork)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(viridis)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(qs)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(BiocParallel)</span><span leaf=""><br></span><span leaf="">register(MulticoreParam(workers =Â </span><span><span leaf="">8</span></span><span leaf="">, progressbar =Â </span><span><span leaf="">TRUE</span></span><span leaf="">))Â </span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">scRNA &lt;- qread(</span><span><span leaf="">"./9-CD4+T/CD4+t_final.qs"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Idents(scRNA) &lt;-Â </span><span><span leaf="">"celltype"</span></span><span leaf=""><br></span><span leaf="">DimPlot(scRNA)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">dir.create(</span><span><span leaf="">"./12-STARTRAC-miloR-Augur"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">setwd(</span><span><span leaf="">"./12-STARTRAC-miloR-Augur"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">2.å•ä¸€ç»„åˆ«ä¸åŒæ¡ä»¶ä¸‹auguråˆ†æ</span><span></span></h6><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">è¿™é‡Œçš„å®éªŒåˆ†ç»„å¯ä»¥ä½¿ç”¨æ¯”å¦‚æ²»ç–—å‰åç­‰æ•°æ®,ä½†æ˜¯æœ¬æ¬¡åˆ†æå°±æŠŠå·¦å³åŠç»“è‚ ä½ç½®æ•°æ®å½“åšå®éªŒåˆ†ç»„äº†ã€‚</span></p><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># æ­¤å‡½æ•°çš„ä¸»è¦ç›®çš„æ˜¯è¯„ä¼°å¹¶è®¡ç®—æ¯ç§ç»†èƒç±»å‹åœ¨ç‰¹å®šæ¡ä»¶ï¼ˆå¦‚å®éªŒç»„åˆ«æˆ–æ—¶é—´ç‚¹ï¼‰ä¸‹çš„è¡¨ç°ï¼Œé€šå¸¸é€šè¿‡è®¡ç®—åŒºåŸŸä¸‹æ›²çº¿ï¼ˆAUCï¼‰æ¥é‡åŒ–ã€‚å®ƒæ˜¯å•ä¸€æ¡ä»¶ä¸‹çš„ç»†èƒç±»å‹è¡¨ç°çš„åº¦é‡ï¼Œå¯ä»¥å¸®åŠ©è¯†åˆ«åœ¨ç‰¹å®šå®éªŒè®¾ç½®ä¸‹å“ªäº›ç»†èƒç±»å‹è¡¨ç°æœ€ä¸ºæ˜¾è‘—æˆ–é‡è¦ã€‚</span></span><span leaf=""><br></span><span leaf="">augur &lt;- calculate_auc(scRNA,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â cell_type_col =Â </span><span><span leaf="">"celltype"</span></span><span leaf="">,Â </span><span><span leaf=""># ç»†èƒäºšç¾¤æ•°æ®</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â label_col =Â </span><span><span leaf="">"location"</span></span><span leaf="">,Â </span><span><span leaf=""># å®éªŒåˆ†ç»„æ•°æ®</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â n_threads =Â </span><span><span leaf="">8</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">qsave(augur,</span><span><span leaf="">"augur.qs"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">head(augur$AUC,Â </span><span><span leaf="">5</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># # A tibble: 5 Ã— 2</span></span><span leaf=""><br></span><span><span leaf=""># Â  cell_type Â  auc</span></span><span leaf=""><br></span><span><span leaf=""># Â  &lt;chr&gt; Â  Â  &lt;dbl&gt;</span></span><span leaf=""><br></span><span><span leaf=""># 1 Naive T Â  0.628</span></span><span leaf=""><br></span><span><span leaf=""># 2 Th17 Â  Â  Â 0.621</span></span><span leaf=""><br></span><span><span leaf=""># 3 Th1 Â  Â  Â  0.604</span></span><span leaf=""><br></span><span><span leaf=""># 4 ZSCAN12+T 0.588</span></span><span leaf=""><br></span><span><span leaf=""># 5 ELK4+T Â  Â 0.586</span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">3.å¯è§†åŒ–</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># æ˜ç¡®å“ªä¸ªç»†èƒç¾¤ä½“çš„RNAæ°´å¹³å˜åŒ–æœ€å¤§</span></span><span leaf=""><br></span><span><span leaf=""># plot_lollipopå‡½æ•°æ˜¯åŸºäºggplotæ¡†æ¶çš„,æ‰€ä»¥å¾ˆå®¹æ˜“å°±å¯ä»¥ç¾åŒ–å›¾ç‰‡</span></span><span leaf=""><br></span><span><span leaf=""># è¿˜å¯ä»¥æå–åŸå§‹å‡½æ•°è¿›è¡Œä¿®æ”¹</span></span><span leaf=""><br></span><span leaf="">augur &lt;- qread(</span><span><span leaf="">"augur.qs"</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><span leaf=""><br></span><span leaf="">plot_lollipop(augur) +</span><span leaf=""><br></span><span leaf="">Â  geom_segment(aes(xend = cell_type, yend =Â </span><span><span leaf="">0.5</span></span><span leaf="">), size =Â </span><span><span leaf="">1</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">Â  geom_point(size =Â </span><span><span leaf="">3</span></span><span leaf="">, aes(color = cell_type)) + Â </span><span><span leaf=""># å¢åŠ ç‚¹çš„å¤§å°å’Œé¢œè‰²æ˜ å°„</span></span><span leaf=""><br></span><span leaf="">Â  scale_color_manual(values = c(</span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">"Naive T"</span></span><span leaf="">Â =Â </span><span><span leaf="">"#1f77b4"</span></span><span leaf="">, Â  Â  Â Â </span><span><span leaf=""># è“è‰²</span></span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">"Th17"</span></span><span leaf="">Â =Â </span><span><span leaf="">"#ff7f0e"</span></span><span leaf="">, Â  Â </span><span><span leaf=""># æ©™è‰²</span></span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">"Th1"</span></span><span leaf="">Â =Â </span><span><span leaf="">"#2ca02c"</span></span><span leaf="">, Â  Â </span><span><span leaf=""># ç»¿è‰²</span></span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">"ZSCAN12+T"</span></span><span leaf="">Â =Â </span><span><span leaf="">"#d62728"</span></span><span leaf="">, Â  Â  Â  Â </span><span><span leaf=""># çº¢è‰²</span></span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">"ELK4+T"</span></span><span leaf="">Â =Â </span><span><span leaf="">"#9467bd"</span></span><span leaf="">, Â Â </span><span><span leaf=""># ç´«è‰²</span></span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">"Treg"</span></span><span leaf="">Â =Â </span><span><span leaf="">"#8c564b"</span></span><span leaf="">, Â  Â  Â </span><span><span leaf=""># æ£•è‰²</span></span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">"Tm"</span></span><span leaf="">Â =Â </span><span><span leaf="">"#e377c2"</span></span><span leaf="">, Â  Â Â </span><span><span leaf=""># ç²‰è‰²</span></span><span leaf=""><br></span><span leaf="">Â  Â Â </span><span><span leaf="">"ZNF793+T"</span></span><span leaf="">Â =Â </span><span><span leaf="">"#7f7f7f"</span></span><span leaf="">Â  Â Â </span><span><span leaf=""># ç°è‰²</span></span><span leaf=""><br></span><span leaf="">Â  ))Â </span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># ç»“åˆumap</span></span><span leaf=""><br></span><span><span leaf=""># rankæ¨¡å¼</span></span><span leaf=""><br></span><span leaf="">plot_umap(augur,scRNA,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  mode =Â </span><span><span leaf="">"rank"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  reduction =Â </span><span><span leaf="">"umap"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  palette =Â </span><span><span leaf="">"cividis"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  cell_type_col =Â </span><span><span leaf="">"celltype"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># defaultæ¨¡å¼</span></span><span leaf=""><br></span><span leaf="">plot_umap(augur,scRNA,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  mode =Â </span><span><span leaf="">"default"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  reduction =Â </span><span><span leaf="">"umap"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  palette =Â </span><span><span leaf="">"YlGnBu"</span></span><span leaf="">,Â </span><span><span leaf=""># Â "viridis", "plasma", "magma", "inferno"</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  cell_type_col =Â </span><span><span leaf="">"celltype"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">setwd(</span><span><span leaf="">".."</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">plot_lollipopå±•ç¤ºäº†åœ¨ä¸åŒå¤„ç†æƒ…å†µä¸‹(group)ä¸­å˜åŒ–æœ€æ˜¾è‘—çš„ç»†èƒ(AUCå€¼)ï¼Œä»ç»“æœæ¥çœ‹Naive Tç»†èƒå—åˆ°çš„æ‰°åŠ¨ç¨‹åº¦æ˜¯æœ€å¤§çš„ï¼ŒZNF793+Tæ”¶åˆ°çš„æ‰°åŠ¨ç¨‹åº¦åˆ™æ˜¯æœ€å°çš„ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqvvsA4aDqcy9icnoSclFz3smMeROH6eGxWQpS4axhsnwsnHYkj8ClH5w/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.0855745721271393" data-type="png" data-w="409" data-imgfileid="100045501" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqvvsA4aDqcy9icnoSclFz3smMeROH6eGxWQpS4axhsnwsnHYkj8ClH5w/640?wx_fmt=png&amp;from=appmsg">modeä¸­çš„rankå’Œdefaultæ¨¡å¼çš„åŒºåˆ«åœ¨äºæ˜¯å¦ç”¨AUCå€¼è¿›è¡Œé¢œè‰²æ˜ å°„ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqe2lRpneaYrsnhmZrT36qMomV2hDWDQJnmCwJbgyQicdFfK8y2cfjFag/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.43004115226337447" data-type="png" data-w="486" data-imgfileid="100045500" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqe2lRpneaYrsnhmZrT36qMomV2hDWDQJnmCwJbgyQicdFfK8y2cfjFag/640?wx_fmt=png&amp;from=appmsg"></span></p><h4 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">miloRâ€”â€”åˆ¤æ–­ç»†èƒå·®å¼‚ä¸°åº¦çš„åˆ†æå·¥å…·</span><span></span></h4><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">miloRèƒ½å¤Ÿéšæœºå®šä¹‰ç»†èƒä¸­çš„ç»†èƒèŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡Kæœ€è¿‘é‚»æ³•å»è¯†åˆ«æ‰€å®šä¹‰èŠ‚ç‚¹ä¸å‘¨å›´çš„å…¶ä»–ç»†èƒèŠ‚ç‚¹ä¹‹é—´çš„é‚»è¿‘å…³ç³»ï¼Œæ‰¾åˆ°è·Ÿè¿™äº›èŠ‚ç‚¹æœ€è¿‘çš„(æ¯”å¦‚æ¬§å‡ é‡Œå¾—æ³•)å…¶ä»–ç»†èƒèŠ‚ç‚¹ï¼Œå°†è¿™äº›å…·æœ‰é‚»è¿‘å…³ç³»çš„ç»†èƒå°ç¾¤çœ‹åšä¸åŒçš„ç¾¤ç»„ï¼Œæ­¤æ—¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œæ¯ä¸ªç¾¤ç»„ä¸­éƒ½ä¼šå­˜åœ¨å…·æœ‰ç–¾ç—…å’Œæ­£å¸¸ä¿¡æ¯çš„è®¸å¤šç»†èƒï¼Œæ¥ç€å†å°†è¿™äº›ç¾¤ç»„ä¸­ç–¾ç—…ä¸å¦çš„ç»†èƒæ•°åˆ†åˆ«è¿›è¡Œæ¯”è¾ƒå’Œæ±‡æ€»ï¼Œæœ€åå¯ä»¥å¾—åˆ°åŸºäºæŸä¸€å¤§ç±»ç»†èƒä¸­å†…éƒ¨ç»†èƒå˜åŒ–è¶‹åŠ¿çš„ç»“æœ(æ¯”å¦‚æ˜¯å¦å€¾å‘ä¸ç–¾ç—…çš„æ–¹å‘)ã€‚</span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">æœ‰äº†è¿™ä¸ªç»“æœä¹‹åï¼Œç»“åˆé¢„å…ˆå®šä¹‰çš„ç»†èƒåˆ†ç¾¤ç»“æœæœ‰åŠ©äºä½¿ç”¨è€…æ›´å¥½çš„å»äº†è§£ç–¾ç—…ä¸å¦ã€ç–¾ç—…çŠ¶æ€ã€è¯ç‰©åˆºæ¿€ç­‰æƒ…å†µä¸‹çš„ä¸åŒç»†èƒäºšç¾¤çš„å˜åŒ–çŠ¶æ€ï¼Œå› æ­¤ä½¿ç”¨miloRå¯ä»¥æœ‰æ•ˆçš„ä½œä¸ºå•ç»†èƒæ°´å¹³ä¸Šç»†èƒå·®å¼‚åˆ†æçš„è¡¥å……å·¥å…·ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqJoByWGdMUfBzvnfBLIwqsAwVjWBKv9Xwp0STXl52t4ibkQib7eHDzuYQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8672566371681416" data-type="png" data-w="904" data-imgfileid="100045503" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqJoByWGdMUfBzvnfBLIwqsAwVjWBKv9Xwp0STXl52t4ibkQib7eHDzuYQ/640?wx_fmt=png&amp;from=appmsg"></span></p><h5 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">miloRåˆ†ææµç¨‹</span><span></span></h5><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">1.å¯¼å…¥</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">rm(list = ls())</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(stringr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(Seurat)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(miloR)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(scater)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(scran)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(dplyr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(patchwork)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(qs)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(BiocParallel)</span><span leaf=""><br></span><span leaf="">register(MulticoreParam(workers =Â </span><span><span leaf="">8</span></span><span leaf="">, progressbar =Â </span><span><span leaf="">TRUE</span></span><span leaf="">))Â </span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">scRNA &lt;- qread(</span><span><span leaf="">"./9-CD4+T/CD4+t_final.qs"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Idents(scRNA) &lt;-Â </span><span><span leaf="">"celltype"</span></span><span leaf=""><br></span><span leaf="">DimPlot(scRNA)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">dir.create(</span><span><span leaf="">"./12-STARTRAC-miloR-Augur"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">setwd(</span><span><span leaf="">"./12-STARTRAC-miloR-Augur"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">2.æ•°æ®é¢„å¤„ç†</span><span></span></h6><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">éœ€è¦ä¸€ä¸ªseuratå¯¹è±¡ï¼Œå»ºè®®æå‰é¢„å¤„ç†</span></p><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># check</span></span><span leaf=""><br></span><span leaf="">table(scRNA$orig.ident)</span><span leaf=""><br></span><span leaf="">Â </span><span><span leaf=""># Â  Â GSM5688706_WGC Â  Â  GSM5688707_JCA GSM5688708_LS-CRC3 GSM5688709_RS-CRC1 Â GSM5688710_R_CRC3Â </span></span><span leaf=""><br></span><span leaf="">Â </span><span><span leaf=""># Â  Â  Â  Â  Â  Â  Â  738 Â  Â  Â  Â  Â  Â  Â  Â 542 Â  Â  Â  Â  Â  Â  Â  1381 Â  Â  Â  Â  Â  Â  Â  1879 Â  Â  Â  Â  Â  Â  Â  Â 807Â </span></span><span leaf=""><br></span><span leaf="">Â </span><span><span leaf=""># GSM5688711_R_CRC4Â </span></span><span leaf=""><br></span><span leaf="">Â </span><span><span leaf=""># Â  Â  Â  Â  Â  Â  Â  565</span></span><span leaf=""><br></span><span leaf="">table(scRNA$celltype)</span><span leaf=""><br></span><span leaf="">Â  Â </span><span><span leaf=""># ELK4+T Â  Naive T Â  Â  Â  Th1 Â  Â  Â Th17 Â  Â  Â  Â Tm Â  Â  Â Treg Â ZNF793+T ZSCAN12+TÂ </span></span><span leaf=""><br></span><span leaf="">Â  Â </span><span><span leaf=""># Â  Â 204 Â  Â  Â 1459 Â  Â  Â  818 Â  Â  Â  421 Â  Â  Â 1045 Â  Â  Â 1528 Â  Â  Â  189 Â  Â  Â  248Â </span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">3.æ„å»ºmiloRå¯¹è±¡</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># ç”±äºéœ€è¦è¾“å…¥SingleCellExperimentå¯¹è±¡</span></span><span leaf=""><br></span><span><span leaf=""># å› æ­¤å…ˆè¿›è¡Œè½¬åŒ–ä¸€ä¸‹</span></span><span leaf=""><br></span><span leaf="">scRNA_pre &lt;- as.SingleCellExperiment(scRNA)</span><span leaf=""><br></span><span><span leaf=""># æ„å»ºmiloRå¯¹è±¡</span></span><span leaf=""><br></span><span leaf="">scRNA_milo &lt;- Milo(scRNA_pre)</span><span leaf=""><br></span><span leaf="">reducedDim(scRNA_milo,</span><span><span leaf="">"UMAP"</span></span><span leaf="">) &lt;- reducedDim(scRNA_pre,</span><span><span leaf="">"UMAP"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">scRNA_milo</span><span leaf=""><br></span><span><span leaf=""># class: MiloÂ </span></span><span leaf=""><br></span><span><span leaf=""># dim: 21308 5912Â </span></span><span leaf=""><br></span><span><span leaf=""># metadata(0):</span></span><span leaf=""><br></span><span><span leaf=""># assays(3): counts logcounts scaledata</span></span><span leaf=""><br></span><span><span leaf=""># rownames(21308): RP11-34P13.7 FO538757.2 ... GRIK1-AS1 AP001626.2</span></span><span leaf=""><br></span><span><span leaf=""># rowData names(0):</span></span><span leaf=""><br></span><span><span leaf=""># colnames(5912): GSM5688706_WGC_AACACACGTATCACGT-1 GSM5688706_WGC_AACACACTCAAGGTGG-1 ...</span></span><span leaf=""><br></span><span><span leaf=""># Â  GSM5688711_R_CRC4_TTTGGTTTCTGGGATT-1 GSM5688711_R_CRC4_TTTGTTGGTAATGCTC-1</span></span><span leaf=""><br></span><span><span leaf=""># colData names(35): orig.ident nCount_RNA ... RNA_snn_res.2 ident</span></span><span leaf=""><br></span><span><span leaf=""># reducedDimNames(3): PCA HARMONY UMAP</span></span><span leaf=""><br></span><span><span leaf=""># mainExpName: RNA</span></span><span leaf=""><br></span><span><span leaf=""># altExpNames(0):</span></span><span leaf=""><br></span><span><span leaf=""># nhoods dimensions(2): 1 1</span></span><span leaf=""><br></span><span><span leaf=""># nhoodCounts dimensions(2): 1 1</span></span><span leaf=""><br></span><span><span leaf=""># nhoodDistances dimension(1): 0</span></span><span leaf=""><br></span><span><span leaf=""># graph names(0):</span></span><span leaf=""><br></span><span><span leaf=""># nhoodIndex names(1): 0</span></span><span leaf=""><br></span><span><span leaf=""># nhoodExpression dimension(2): 1 1</span></span><span leaf=""><br></span><span><span leaf=""># nhoodReducedDim names(0):</span></span><span leaf=""><br></span><span><span leaf=""># nhoodGraph names(0):</span></span><span leaf=""><br></span><span><span leaf=""># nhoodAdjacency dimension(2): 1 1</span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">4.æ„å»ºKæœ€é‚»å›¾è°±</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># då€¼ä¸é™ç»´æ—¶é€‰å®šçš„pcaå€¼ä¸€è‡´</span></span><span leaf=""><br></span><span><span leaf=""># kå€¼ä¸FindNeighborsæ—¶é€‰å®šçš„å€¼ä¸€è‡´</span></span><span leaf=""><br></span><span leaf="">scRNA_milo &lt;- buildGraph(scRNA_milo, k =Â </span><span><span leaf="">30</span></span><span leaf="">, d =Â </span><span><span leaf="">15</span></span><span leaf="">,reduced.dim =Â </span><span><span leaf="">"PCA"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">5.åœ¨ KNN å›¾ä¸Šå®šä¹‰å…·æœ‰ä»£è¡¨æ€§çš„é‚»åŸŸ</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># å®˜ç½‘å»ºè®®propåœ¨0.1-0.2</span></span><span leaf=""><br></span><span><span leaf=""># Kå’Œdå’ŒKNNå›¾å‚æ•°ä¸€è‡´</span></span><span leaf=""><br></span><span leaf="">scRNA_milo &lt;- makeNhoods(scRNA_milo, prop =Â </span><span><span leaf="">0.2</span></span><span leaf="">, k =Â </span><span><span leaf="">30</span></span><span leaf="">, d =Â </span><span><span leaf="">15</span></span><span leaf="">,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  refined =Â </span><span><span leaf="">TRUE</span></span><span leaf="">, reduced_dims =Â </span><span><span leaf="">"PCA"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">plotNhoodSizeHist(scRNA_milo)</span><span leaf=""><br></span></code></pre><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqq3Wck29ey232kLohpxarbPZ2dibQAAHSziaTibQRfr7tJgd1KQH8IGzMMA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.20103986135181975" data-type="png" data-w="577" data-imgfileid="100045499" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqq3Wck29ey232kLohpxarbPZ2dibQAAHSziaTibQRfr7tJgd1KQH8IGzMMA/640?wx_fmt=png&amp;from=appmsg">å¼€å‘è€…å»ºè®®åœ¨50åˆ°100è¾¾åˆ°å³°å€¼ï¼Œå¦åˆ™éœ€è¦å¢åŠ k/propçš„å€¼ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqlVqQPSD4IichmSo2xeiadvxtr51twsiaQyHKO1D7q0TvSjO2HIQT2Llhw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6787037037037037" data-type="png" data-w="1080" data-imgfileid="100045502" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqlVqQPSD4IichmSo2xeiadvxtr51twsiaQyHKO1D7q0TvSjO2HIQT2Llhw/640?wx_fmt=png&amp;from=appmsg"></span></p><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">6.è®¡ç®—neighbourhoodsä¸­çš„ç»†èƒ</span><span></span></h6><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">è®¡ç®—æ¯ä¸ªæ ·æœ¬ä¸­æœ‰å¤šå°‘ç»†èƒä½äºæ¯ä¸ªé‚»åŸŸä¸­ã€‚</span></p><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">scRNA_milo &lt;- countCells(scRNA_milo,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  meta.data = as.data.frame(colData(scRNA_milo)),</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sample=</span><span><span leaf="">"orig.ident"</span></span><span leaf="">)Â </span><span><span leaf=""># sampleä»£è¡¨æ ·æœ¬</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># colData(scRNA) ç›¸å½“äºä»£è¡¨äº†metadataçš„ä¿¡æ¯</span></span><span leaf=""><br></span><span><span leaf=""># sampleä»£è¡¨äº†æ ·æœ¬æ•°</span></span><span leaf=""><br></span><span leaf="">head(nhoodCounts(scRNA_milo))</span><span leaf=""><br></span><span><span leaf=""># è¿™ä¸ªæ­¥éª¤èƒ½å¤Ÿç»™scRNAæ•°æ®ä¸­å¢åŠ ä¸€ä¸ªn*mçš„matrix</span></span><span leaf=""><br></span><span><span leaf=""># nä»£è¡¨ä¸åŒçš„neighborhoodæ•°é‡,mä»£è¡¨å®éªŒæ ·æœ¬</span></span><span leaf=""><br></span><span><span leaf=""># 6 x 6 sparse Matrix of class "dgCMatrix"</span></span><span leaf=""><br></span><span><span leaf=""># Â  GSM5688706_WGC GSM5688707_JCA GSM5688708_LS-CRC3 GSM5688709_RS-CRC1 GSM5688710_R_CRC3 GSM5688711_R_CRC4</span></span><span leaf=""><br></span><span><span leaf=""># 1 Â  Â  Â  Â  Â  Â  19 Â  Â  Â  Â  Â  Â  Â 7 Â  Â  Â  Â  Â  Â  Â  Â  41 Â  Â  Â  Â  Â  Â  Â  Â  18 Â  Â  Â  Â  Â  Â  Â  Â  . Â  Â  Â  Â  Â  Â  Â  Â  .</span></span><span leaf=""><br></span><span><span leaf=""># 2 Â  Â  Â  Â  Â  Â  Â 1 Â  Â  Â  Â  Â  Â  Â . Â  Â  Â  Â  Â  Â  Â  Â  Â 5 Â  Â  Â  Â  Â  Â  Â  Â  Â 3 Â  Â  Â  Â  Â  Â  Â  Â  2 Â  Â  Â  Â  Â  Â  Â  Â 61</span></span><span leaf=""><br></span><span><span leaf=""># 3 Â  Â  Â  Â  Â  Â  Â 5 Â  Â  Â  Â  Â  Â  Â 2 Â  Â  Â  Â  Â  Â  Â  Â  84 Â  Â  Â  Â  Â  Â  Â  Â  Â 3 Â  Â  Â  Â  Â  Â  Â  Â  . Â  Â  Â  Â  Â  Â  Â  Â  .</span></span><span leaf=""><br></span><span><span leaf=""># 4 Â  Â  Â  Â  Â  Â  10 Â  Â  Â  Â  Â  Â  21 Â  Â  Â  Â  Â  Â  Â  Â  Â 4 Â  Â  Â  Â  Â  Â  Â  Â  30 Â  Â  Â  Â  Â  Â  Â  Â  . Â  Â  Â  Â  Â  Â  Â  Â  .</span></span><span leaf=""><br></span><span><span leaf=""># 5 Â  Â  Â  Â  Â  Â  21 Â  Â  Â  Â  Â  Â  14 Â  Â  Â  Â  Â  Â  Â  Â  59 Â  Â  Â  Â  Â  Â  Â  Â  15 Â  Â  Â  Â  Â  Â  Â  Â  . Â  Â  Â  Â  Â  Â  Â  Â  .</span></span><span leaf=""><br></span><span><span leaf=""># 6 Â  Â  Â  Â  Â  Â  71 Â  Â  Â  Â  Â  Â  Â . Â  Â  Â  Â  Â  Â  Â  Â  19 Â  Â  Â  Â  Â  Â  Â  Â  Â 4 Â  Â  Â  Â  Â  Â  Â  Â  . Â  Â  Â  Â  Â  Â  Â  Â  3</span></span><span leaf=""><br></span></code></pre><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">è¿™ä¸ºå¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªçŸ©é˜µï¼Œå…¶ä¸­næ˜¯é‚»åŸŸçš„æ•°é‡ï¼Œğ‘šæ˜¯å®éªŒæ ·æœ¬çš„æ•°é‡ã€‚å€¼è¡¨ç¤ºæ¯ä¸ªæ ·æœ¬åœ¨é‚»åŸŸä¸­è®¡æ•°çš„ç»†èƒæ•°é‡ã€‚è¿™ä¸ªè®¡æ•°çŸ©é˜µå°†ç”¨äºå·®å¼‚ä¸°åº¦æµ‹è¯•ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqp5Bw1Inic5iaicKqorsjq5r0mFmRUiafn4lGsem2LFYUumJibfYmYlVjCsw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.14756944444444445" data-type="png" data-w="576" data-imgfileid="100045504" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqp5Bw1Inic5iaicKqorsjq5r0mFmRUiafn4lGsem2LFYUumJibfYmYlVjCsw/640?wx_fmt=png&amp;from=appmsg"></span></p><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">7.å®éªŒè®¾è®¡å®šä¹‰</span><span></span></h6><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqE2RSKRnHKdoxRZfWcyk3TaYTEJOBL2prgZ8zEflWlxOFjyqvRz8oJQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.2306368330464716" data-type="png" data-w="581" data-imgfileid="100045506" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqE2RSKRnHKdoxRZfWcyk3TaYTEJOBL2prgZ8zEflWlxOFjyqvRz8oJQ/640?wx_fmt=png&amp;from=appmsg">ç ”ç©¶è€…æŠŠåœ¨ä½¿ç”¨æ–‡ä»¶ä¸­æŠŠconditionå®šä¹‰ä¸ºcovariateï¼ˆåå˜é‡ï¼‰ï¼Œç„¶è€Œåœ¨æ­£å¼åˆ†ç»„çš„æ—¶å€™åˆæŠŠconditionå®šä¹‰ä¸ºå®éªŒåˆ†ç»„ï¼Œä¸ªäººè§‰å¾—åå˜é‡æ˜¯å®šä¹‰é”™äº†ï¼Œconditionå°±æ˜¯å®éªŒåˆ†ç»„ã€‚æœ¬æ¬¡æ•°æ®ä¸­locationå¯¹æ ‡conditionã€‚</span></p><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">traj_design &lt;- data.frame(colData(scRNA_milo))[,c(</span><span><span leaf="">"orig.ident"</span></span><span leaf="">,Â </span><span><span leaf="">"location"</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf="">traj_design &lt;- distinct(traj_design)</span><span leaf=""><br></span><span leaf="">rownames(traj_design) &lt;- traj_design$orig.ident</span><span leaf=""><br></span><span><span leaf="">#é‡æ–°æ’åºè¡Œåä»¥åŒ¹é…nhoodCountsï¼ˆmiloï¼‰çš„åˆ—</span></span><span leaf=""><br></span><span leaf="">traj_design &lt;- traj_design[colnames(nhoodCounts(scRNA_milo)), , drop=</span><span><span leaf="">FALSE</span></span><span leaf="">]</span><span leaf=""><br></span><span leaf="">traj_design$location &lt;- factor(traj_design$location, level = c(</span><span><span leaf="">"left"</span></span><span leaf="">,Â </span><span><span leaf="">"right"</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf="">traj_design</span><span leaf=""><br></span><span><span leaf=""># Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â orig.ident location</span></span><span leaf=""><br></span><span><span leaf=""># GSM5688706_WGC Â  Â  Â  Â  GSM5688706_WGC Â  Â  left</span></span><span leaf=""><br></span><span><span leaf=""># GSM5688707_JCA Â  Â  Â  Â  GSM5688707_JCA Â  Â  left</span></span><span leaf=""><br></span><span><span leaf=""># GSM5688708_LS-CRC3 GSM5688708_LS-CRC3 Â  Â  left</span></span><span leaf=""><br></span><span><span leaf=""># GSM5688709_RS-CRC1 GSM5688709_RS-CRC1 Â  Â right</span></span><span leaf=""><br></span><span><span leaf=""># GSM5688710_R_CRC3 Â  GSM5688710_R_CRC3 Â  Â right</span></span><span leaf=""><br></span><span><span leaf=""># GSM5688711_R_CRC4 Â  GSM5688711_R_CRC4 Â  Â right</span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">8.è®¡ç®—é‚»é‡Œè¿é€šæ€§</span><span></span></h6><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">Miloä½¿ç”¨cydarå¼•å…¥çš„Spatial FDRæ ¡æ­£çš„å˜ä½“ï¼Œè¯¥æ ¡æ­£è€ƒè™‘äº†é‚»åŸŸä¹‹é—´çš„é‡å ã€‚å…·ä½“æ¥è¯´ï¼Œæ¯ä¸ªå‡è®¾æ£€éªŒçš„På€¼éƒ½é€šè¿‡kä¸ªæœ€è¿‘é‚»è·ç¦»çš„å€’æ•°è¿›è¡ŒåŠ æƒã€‚è¦ä½¿ç”¨è¿™ä¸ªç»Ÿè®¡é‡ï¼Œé¦–å…ˆéœ€è¦åœ¨Miloå¯¹è±¡ä¸­å­˜å‚¨æœ€è¿‘é‚»ä¹‹é—´çš„è·ç¦»ã€‚</span></p><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># Miloä½¿ç”¨cydarå¼•å…¥çš„Spatial FDRæ ¡æ­£çš„å˜ä½“ï¼Œè¯¥æ ¡æ­£è€ƒè™‘äº†é‚»åŸŸä¹‹é—´çš„é‡å ã€‚å…·ä½“æ¥è¯´ï¼Œæ¯ä¸ªå‡è®¾æ£€éªŒçš„På€¼éƒ½é€šè¿‡kä¸ªæœ€è¿‘é‚»è·ç¦»çš„å€’æ•°è¿›è¡ŒåŠ æƒã€‚è¦ä½¿ç”¨è¿™ä¸ªç»Ÿè®¡é‡ï¼Œé¦–å…ˆéœ€è¦åœ¨Miloå¯¹è±¡ä¸­å­˜å‚¨æœ€è¿‘é‚»ä¹‹é—´çš„è·ç¦»ã€‚</span></span><span leaf=""><br></span><span leaf="">scRNA_milo &lt;- calcNhoodDistance(scRNA_milo, d=</span><span><span leaf="">15</span></span><span leaf="">, reduced.dim =Â </span><span><span leaf="">"PCA"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">9.æ£€æµ‹ç»“æœ</span><span></span></h6><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">æ­£å¼æµ‹è¯•ï¼Œæ˜ç¡®å®šä¹‰å®éªŒè®¾è®¡ï¼Œè¿™é‡Œä½¿ç”¨äº†location</span></p><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># æŠŠæ‰¹æ¬¡å’Œåˆ†ç»„ä¿¡æ¯åŠ åˆ°designä¸­å»</span></span><span leaf=""><br></span><span leaf="">da_results &lt;- testNhoods(scRNA_milo,design = ~ location, design.df = traj_design)</span><span leaf=""><br></span><span leaf="">da_results %&gt;%</span><span leaf=""><br></span><span leaf="">Â  arrange(SpatialFDR) %&gt;%</span><span leaf=""><br></span><span leaf="">Â  head()Â </span><span leaf=""><br></span><span><span leaf=""># Â  Â  Â  Â  logFC Â  logCPM Â  Â  Â  Â F Â  Â  Â PValue Â  Â  Â  FDR Nhood SpatialFDR</span></span><span leaf=""><br></span><span><span leaf=""># 15 Â -8.035409 10.53289 7.723075 0.005486977 0.1453135 Â  Â 15 Â 0.1009631</span></span><span leaf=""><br></span><span><span leaf=""># 25 Â  7.663408 10.18627 8.654687 0.003287987 0.1453135 Â  Â 25 Â 0.1009631</span></span><span leaf=""><br></span><span><span leaf=""># 31 Â  8.492067 10.93321 8.159168 0.004314811 0.1453135 Â  Â 31 Â 0.1009631</span></span><span leaf=""><br></span><span><span leaf=""># 131 -8.311036 10.77975 7.523350 0.006127759 0.1453135 Â  131 Â 0.1009631</span></span><span leaf=""><br></span><span><span leaf=""># 183 Â 8.511668 10.94935 8.097942 0.004462580 0.1453135 Â  183 Â 0.1009631</span></span><span leaf=""><br></span><span><span leaf=""># 231 -8.242297 10.71764 7.567548 0.005979667 0.1453135 Â  231 Â 0.1009631</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># å¯ä»¥çœ‹ä¸€ä¸‹æŸ±çŠ¶å›¾å’Œç‚¹å›¾</span></span><span leaf=""><br></span><span leaf="">ggplot(da_results, aes(PValue)) + geom_histogram(bins=</span><span><span leaf="">50</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">ggplot(da_results, aes(logFC, -log10(SpatialFDR))) +Â </span><span leaf=""><br></span><span leaf="">Â  geom_point() +</span><span leaf=""><br></span><span leaf="">Â  geom_hline(yintercept =Â </span><span><span leaf="">1</span></span><span leaf="">)Â </span><span><span leaf="">## Mark significance threshold (10% FDR)</span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">10.å¯è§†åŒ–</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">scRNA_milo &lt;- buildNhoodGraph(scRNA_milo)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## Plot single-cell UMAP</span></span><span leaf=""><br></span><span leaf="">umap_pl &lt;- plotReducedDim(scRNA_milo, dimred =Â </span><span><span leaf="">"UMAP"</span></span><span leaf="">,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colour_by=</span><span><span leaf="">"location"</span></span><span leaf="">, text_by =Â </span><span><span leaf="">"celltype"</span></span><span leaf="">,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text_size =Â </span><span><span leaf="">3</span></span><span leaf="">, point_size=</span><span><span leaf="">0.5</span></span><span leaf="">) + guides(fill=</span><span><span leaf="">"none"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">umap_pl</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## Plot neighbourhood graph</span></span><span leaf=""><br></span><span leaf="">nh_graph_pl &lt;- plotNhoodGraphDA(scRNA_milo, da_results,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layout=</span><span><span leaf="">"UMAP"</span></span><span leaf="">,alpha=</span><span><span leaf="">0.9</span></span><span leaf="">) Â </span><span><span leaf="">#alphaé»˜è®¤0.1</span></span><span leaf=""><br></span><span leaf="">Â Â </span><span leaf=""><br></span><span leaf="">umap_pl + nh_graph_pl +</span><span leaf=""><br></span><span leaf="">plot_layout(guides=</span><span><span leaf="">"collect"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">UMAP å›¾ï¼ˆå·¦å›¾ï¼‰ï¼šæ˜¾ç¤ºäº†ä¸åŒç»†èƒç±»å‹åœ¨ä¸¤ä¸ªå®éªŒç»„ä¹‹é—´çš„åˆ†å¸ƒã€‚å›¾ä¸­ä½¿ç”¨äº†ä¸¤ç§é¢œè‰²ï¼Œè“è‰²ï¼ˆleftï¼‰ å’Œ æ©™è‰²ï¼ˆrightï¼‰ï¼Œåˆ†åˆ«ä»£è¡¨leftç»„å’Œrightç»„ã€‚ä¸åŒçš„ç»†èƒç±»å‹è¢«æ˜ç¡®æ ‡æ³¨ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°leftç»„å’Œrightç»„ä¹‹é—´çš„ç»†èƒåˆ†å¸ƒã€‚</span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">é‚»åŸŸç½‘ç»œå›¾ï¼ˆå³å›¾ï¼‰ï¼šå³è¾¹çš„å›¾æ˜¯åŸºäºMiloRåˆ†æçš„é‚»åŸŸå›¾ã€‚æ¯ä¸ªåœˆä»£è¡¨ä¸€ä¸ªé‚»åŸŸï¼Œé‚»åŸŸçš„å¤§å°ä¸å…¶ä¸­ç»†èƒçš„æ•°é‡æˆæ¯”ä¾‹ã€‚é¢œè‰²æ¢¯åº¦è¡¨ç¤ºäº†logFCå€¼ï¼šæ­£çš„ logFCï¼ˆè“è‰²ï¼‰æ„å‘³ç€è¯¥é‚»åŸŸä¸­çš„ç»†èƒåœ¨rightç»„ä¸­å¯Œé›†ï¼Œè´Ÿçš„ logFCï¼ˆçº¢è‰²ï¼‰åˆ™è¡¨æ˜è¯¥é‚»åŸŸä¸­çš„ç»†èƒåœ¨leftç»„ä¸­å¯Œé›†ã€‚é‚»åŸŸä¹‹é—´çš„è¿çº¿è¡¨ç¤ºé‚»åŸŸä¹‹é—´çš„ç›¸ä¼¼æ€§æˆ–é‡å ï¼Œçº¿æ¡çš„åšåº¦è¡¨ç¤ºé‚»åŸŸä¹‹é—´çš„é‡å åº¦ï¼ˆoverlap sizeï¼‰ï¼Œè¶Šåšçš„çº¿è¡¨ç¤ºä¸¤ä¸ªé‚»åŸŸä¹‹é—´çš„ç»†èƒæ›´ä¸ºç›¸ä¼¼ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqFU2XWwScXiao128Wp5yOxjlLUbay2n3houGZciaHZEO9Rr0T4YnGoL0w/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7583333333333333" data-type="png" data-w="1080" data-imgfileid="100045508" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqFU2XWwScXiao128Wp5yOxjlLUbay2n3houGZciaHZEO9Rr0T4YnGoL0w/640?wx_fmt=png&amp;from=appmsg"></span></p><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">11.æ•°æ®æ³¨é‡Š</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">da_results &lt;- annotateNhoods(scRNA_milo,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â da_results,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â coldata_col =Â </span><span><span leaf="">"celltype"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">head(da_results)</span><span leaf=""><br></span><span><span leaf=""># Â  Â  Â  logFC Â  Â logCPM Â  Â  Â  Â  F Â  Â  PValue Â  Â  Â  FDR Nhood SpatialFDR celltype celltype_fraction</span></span><span leaf=""><br></span><span><span leaf=""># 1 -1.574239 Â 9.515303 0.4603793 0.49750211 0.6649894 Â  Â  1 Â 0.6489640 Â Naive T Â  Â  Â  Â  0.8596491</span></span><span leaf=""><br></span><span><span leaf=""># 2 Â 2.920511 10.169145 2.1800639 0.13991968 0.3845433 Â  Â  2 Â 0.3461536 Â Naive T Â  Â  Â  Â  0.8021978</span></span><span leaf=""><br></span><span><span leaf=""># 3 Â 4.925942 10.883476 4.0560689 0.04410711 0.2888600 Â  Â  3 Â 0.2281237 Â Naive T Â  Â  Â  Â  0.8735632</span></span><span leaf=""><br></span><span><span leaf=""># 4 -2.618949 11.056240 1.2512551 0.26340764 0.4888901 Â  Â  4 Â 0.4599119 Â  Â  Â  Tm Â  Â  Â  Â  0.8437500</span></span><span leaf=""><br></span><span><span leaf=""># 5 -2.062491 10.447327 1.0799157 0.29880501 0.5154568 Â  Â  5 Â 0.4895583 Â  Â  Â  Tm Â  Â  Â  Â  0.4098361</span></span><span leaf=""><br></span><span><span leaf=""># 6 Â 1.986811 10.452844 1.0385032 0.30825677 0.5173425 Â  Â  6 Â 0.4939665 Â  Â  Â Th1 Â  Â  Â  Â  0.5952381</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">ggplot(da_results, aes(celltype_fraction)) + geom_histogram(bins=</span><span><span leaf="">50</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">str(da_results)</span><span leaf=""><br></span><span leaf="">table(da_results$celltype)</span><span leaf=""><br></span><span leaf="">range(da_results$SpatialFDR)</span><span leaf=""><br></span><span leaf="">plotDAbeeswarm(da_results, group.by =Â </span><span><span leaf="">"celltype"</span></span><span leaf="">,alpha =Â </span><span><span leaf="">0.9</span></span><span leaf="">)Â </span><span><span leaf=""># alphaé»˜è®¤0.1</span></span><span leaf=""><br></span></code></pre><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">celltype_fraction ç›´æ–¹å›¾ï¼šå±•ç¤ºäº†é‚»åŸŸä¸­æŸç§ç‰¹å®šç»†èƒç±»å‹çš„æ¯”ä¾‹åˆ†å¸ƒï¼ˆcelltype_fractionï¼‰ã€‚Yè½´ä»£è¡¨é‚»åŸŸçš„æ•°é‡ï¼ŒXè½´è¡¨ç¤ºé‚»åŸŸä¸­ç»†èƒç±»å‹æ‰€å çš„æ¯”ä¾‹ï¼ˆèŒƒå›´ä»0åˆ°1ï¼‰ã€‚å¦‚æœé‚»åŸŸçš„ç»†èƒç±»å‹æ¯”ä¾‹æ¥è¿‘1ï¼Œè¯´æ˜å¤§å¤šæ•°é‚»åŸŸæ˜¯å•ä¸€ç»†èƒç±»å‹ä¸»å¯¼çš„ï¼Œè¿™æ„å‘³ç€é‚»åŸŸä¸­çš„ç»†èƒå‡ ä¹éƒ½æ˜¯åŒä¸€ç§ç±»å‹ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ··åˆç»†èƒç±»å‹ã€‚è¿™ç§ç»“æœé€šå¸¸å‡ºç°åœ¨è¾ƒä¸ºçº¯å‡€çš„ç»†èƒç¾¤æˆ–å…·æœ‰æ˜¾è‘—åˆ†ç¦»ç‰¹å¾çš„ç»†èƒäºšç¾¤ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqysOjwjR8zNJsQGmQBuSoFCJ60Z3DeQ23kBUwhTic6Sq1FsDQzPv5hOg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8788870703764321" data-type="png" data-w="611" data-imgfileid="100045507" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqysOjwjR8zNJsQGmQBuSoFCJ60Z3DeQ23kBUwhTic6Sq1FsDQzPv5hOg/640?wx_fmt=png&amp;from=appmsg">logFC ä¸ç»†èƒç±»å‹å…³è”çš„ beeswarm å›¾ï¼šå±•ç¤ºäº†ä¸åŒç»†èƒç±»å‹çš„logFCåœ¨ä¸åŒé‚»åŸŸä¸­çš„åˆ†å¸ƒã€‚Yè½´è¡¨ç¤ºç»†èƒç±»å‹ï¼ŒXè½´è¡¨ç¤ºlogFCï¼ˆå³ä¸åŒç»„ä¹‹é—´åœ¨é‚»åŸŸä¸­çš„å·®å¼‚ä¸°åº¦å˜åŒ–ï¼‰ï¼Œæ¯ä¸ªç‚¹ä»£è¡¨ä¸€ä¸ªé‚»åŸŸã€‚æ¯”å¦‚Naive Tç»†èƒä¼¼ä¹åœ¨rightç»„ä¸­çš„é‚»åŸŸå…·æœ‰æ›´å¤§çš„logFCå€¼ï¼ŒTregç»†èƒåœ¨ä¸¤ç»„ä¸­çš„logFCå€¼ä¼¼ä¹å·®ä¸å¤šï¼Œä½†åœ¨leftç»„ä¸­é‚»åŸŸæ•°é‡æ›´å¤šä¸”é›†ä¸­åœ¨-2.5å·¦å³ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqxqBnzCcPfx4icUVRusmvF090RmuVAwe1Waic73DbXd8OlhzUOkmRfibvw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8788870703764321" data-type="png" data-w="611" data-imgfileid="100045505" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqxqBnzCcPfx4icUVRusmvF090RmuVAwe1Waic73DbXd8OlhzUOkmRfibvw/640?wx_fmt=png&amp;from=appmsg"></span></p><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">12.æ‰¾åˆ°DAç¾¤ä½“çš„marker</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">## Add log normalized count to Milo object</span></span><span leaf=""><br></span><span leaf="">scRNA_milo &lt;- logNormCounts(scRNA_milo)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># alphaé»˜è®¤0.1,æ‰€ä»¥SpatialFDR &lt; 0.9æ˜¯ä¿®æ”¹è¿‡çš„</span></span><span leaf=""><br></span><span leaf="">da_results$NhoodGroup &lt;- as.numeric(da_results$SpatialFDR &lt;Â </span><span><span leaf="">0.9</span></span><span leaf="">Â &amp; da_results$logFC &lt;Â </span><span><span leaf="">0</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">da_nhood_markers &lt;- findNhoodGroupMarkers(scRNA_milo, da_results,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subset.row = rownames(scRNA_milo),Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aggregate.samples =Â </span><span><span leaf="">TRUE</span></span><span leaf="">,Â </span><span><span leaf=""># å»ºè®®è®¾ç½®ä¸ºTRUE</span></span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sample_col =Â </span><span><span leaf="">"orig.ident"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">head(da_nhood_markers)</span><span leaf=""><br></span><span><span leaf=""># Â  Â  GeneID Â  Â  Â logFC_1 adj.P.Val_1 Â  Â  Â logFC_0 adj.P.Val_0</span></span><span leaf=""><br></span><span><span leaf=""># 1 Â  Â  A1BG Â 0.069556844 Â  0.8845036 -0.069556844 Â  0.8845036</span></span><span leaf=""><br></span><span><span leaf=""># 2 A1BG-AS1 -0.034653314 Â  0.8845036 Â 0.034653314 Â  0.8845036</span></span><span leaf=""><br></span><span><span leaf=""># 3 Â  Â  A1CF Â 0.000000000 Â  1.0000000 Â 0.000000000 Â  1.0000000</span></span><span leaf=""><br></span><span><span leaf=""># 4 Â  Â  Â A2M Â 0.002280312 Â  0.9963105 -0.002280312 Â  0.9963105</span></span><span leaf=""><br></span><span><span leaf=""># 5 Â A2M-AS1 -0.004230877 Â  1.0000000 Â 0.004230877 Â  1.0000000</span></span><span leaf=""><br></span><span><span leaf=""># 6 Â  Â A2ML1 Â 0.000000000 Â  1.0000000 Â 0.000000000 Â  1.0000000</span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">12.1.è‡ªåŠ¨å¯¹é‚»åŸŸè¿›è¡Œåˆ†ç»„</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">#åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒDAé‚»åŸŸä½äºKNNå›¾çš„ä¸åŒåŒºåŸŸï¼Œå°†æ‰€æœ‰é‡è¦çš„ DA ç¾¤ä½“åˆ†ç»„åœ¨ä¸€èµ·å¯èƒ½å¹¶ä¸ç†æƒ³,å› ä¸ºå®ƒä»¬å¯èƒ½åŒ…æ‹¬éå¸¸ä¸åŒç»†èƒç±»å‹çš„ç»†èƒã€‚</span></span><span leaf=""><br></span><span><span leaf=""># å¯¹äºè¿™ç§åœºæ™¯,å¼€å‘è€…ç”¨äº†ä¸€ä¸ªé‚»é‡Œå‡½æ•°,å®ƒä½¿ç”¨ç¤¾åŒºæ£€æµ‹æ ¹æ®(1)ä¸¤ä¸ªé‚»åŸŸä¹‹é—´å…±äº«çš„å°åŒºæ•°é‡å°†é‚»åŸŸåˆ’åˆ†ä¸ºç»„;(2)DA ç¤¾åŒºçš„å€æ•°å˜åŒ–æ–¹å‘;(3)æŠ˜å å˜åŒ–çš„å·®å¼‚ã€‚</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## Run buildNhoodGraph to store nhood adjacency matrix</span></span><span leaf=""><br></span><span leaf="">scRNA_milo &lt;- buildNhoodGraph(scRNA_milo)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## Find groups</span></span><span leaf=""><br></span><span leaf="">da_results &lt;- groupNhoods(scRNA_milo, da_results,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  max.lfc.delta =Â </span><span><span leaf="">2</span></span><span leaf="">,da.fdr =Â </span><span><span leaf="">0.9</span></span><span leaf="">)</span><span><span leaf="">#da.fdré»˜è®¤0ï¼Œ1</span></span><span leaf=""><br></span><span leaf="">head(da_results)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">plotNhoodGroups(scRNA_milo, da_results, layout=</span><span><span leaf="">"UMAP"</span></span><span leaf="">)Â </span><span leaf=""><br></span><span leaf="">plotDAbeeswarm(da_results,Â </span><span><span leaf="">"NhoodGroup"</span></span><span leaf="">,alpha =Â </span><span><span leaf="">0.9</span></span><span leaf="">)Â </span><span><span leaf="">#alphaé»˜è®¤æ˜¯0.1</span></span><span leaf=""><br></span></code></pre><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">è¿™ä¸ªæ­¥éª¤æ˜¯æŒ‰ç…§DAçš„ç»“æœè¿›è¡Œè‡ªåŠ¨åˆ’åˆ†ç°‡ï¼Œåç»­æ­¥éª¤è¿˜å¯ä»¥æ‰¾åˆ°å·®å¼‚åŸºå› ã€‚<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqnBnpfTkgstWHmdABib1N93VkKCjtPic3buEHY6QJu2Z4DYPoM6gVUBgg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5287037037037037" data-type="png" data-w="1080" data-imgfileid="100045513" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqnBnpfTkgstWHmdABib1N93VkKCjtPic3buEHY6QJu2Z4DYPoM6gVUBgg/640?wx_fmt=png&amp;from=appmsg"></span></p><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">12.2 æ‰¾åˆ°ç‰¹å¾åŸºå› </span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">## Exclude zero counts genes</span></span><span leaf=""><br></span><span leaf="">keep.rows &lt;- rowSums(logcounts(scRNA_milo)) !=Â </span><span><span leaf="">0</span></span><span leaf=""><br></span><span leaf="">scRNA_milo &lt;- scRNA_milo[keep.rows, ]</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## Find HVGs</span></span><span leaf=""><br></span><span leaf="">dec &lt;- modelGeneVar(scRNA_milo)</span><span leaf=""><br></span><span leaf="">hvgs &lt;- getTopHVGs(dec, n=</span><span><span leaf="">2000</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">head(hvgs)</span><span leaf=""><br></span><span><span leaf=""># [1] "HSPA1A" "HSPA1B" "ANXA1" Â "S100A4" "DNAJB1" "TXNIP"Â </span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># æ‰¾åˆ°æ¯ä¸ªé‚»é‡Œç¾¤çš„one-vs-allå·®å¼‚åŸºå› è¡¨è¾¾</span></span><span leaf=""><br></span><span leaf="">nhood_markers &lt;- findNhoodGroupMarkers(scRNA_milo, da_results, subset.row = hvgs,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â aggregate.samples =Â </span><span><span leaf="">TRUE</span></span><span leaf="">, sample_col =Â </span><span><span leaf="">"orig.ident"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">head(nhood_markers)[</span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">4</span></span><span leaf="">,</span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">4</span></span><span leaf="">]</span><span leaf=""><br></span><span><span leaf=""># Â  GeneID Â  Â  logFC_1 adj.P.Val_1 Â  Â  Â logFC_2</span></span><span leaf=""><br></span><span><span leaf=""># 1 Â ABCA1 Â 0.09845269 Â  0.4335701 -0.034954072</span></span><span leaf=""><br></span><span><span leaf=""># 2 Â ABCA2 Â 0.13412658 Â  0.1315646 -0.047259161</span></span><span leaf=""><br></span><span><span leaf=""># 3 Â ABCA5 Â 0.01590351 Â  0.7922435 Â 0.010316026</span></span><span leaf=""><br></span><span><span leaf=""># 4 Â ABCA7 -0.01051437 Â  0.8831909 Â 0.001969199</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># æ‰¾åˆ°group2çš„å·®å¼‚åŸºå› </span></span><span leaf=""><br></span><span leaf="">gr2_markers &lt;- nhood_markers[c(</span><span><span leaf="">"logFC_2"</span></span><span leaf="">,Â </span><span><span leaf="">"adj.P.Val_2"</span></span><span leaf="">)]Â </span><span leaf=""><br></span><span leaf="">colnames(gr2_markers) &lt;- c(</span><span><span leaf="">"logFC"</span></span><span leaf="">,Â </span><span><span leaf="">"adj.P.Val"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">head(gr2_markers[order(gr2_markers$adj.P.Val), ])</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># å¦‚æœæ˜ç¡®äº†å¯¹ç¬¬äºŒç»„ç»†èƒæ„Ÿå…´è¶£</span></span><span leaf=""><br></span><span leaf="">nhood_markers &lt;- findNhoodGroupMarkers(scRNA_milo, da_results, subset.row = hvgs,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â aggregate.samples =Â </span><span><span leaf="">TRUE</span></span><span leaf="">, sample_col =Â </span><span><span leaf="">"orig.ident"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â subset.groups = c(</span><span><span leaf="">"2"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â )</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">head(nhood_markers)</span><span leaf=""><br></span><span><span leaf=""># Â  Â  Â  Â  Â logFC_2 Â adj.P.Val_2 GeneID</span></span><span leaf=""><br></span><span><span leaf=""># LARP4 Â 0.2920211 0.0000272445 Â LARP4</span></span><span leaf=""><br></span><span><span leaf=""># OAS3 Â  0.2884843 0.0002802494 Â  OAS3</span></span><span leaf=""><br></span><span><span leaf=""># NFKBID 0.3886595 0.0003353456 NFKBID</span></span><span leaf=""><br></span><span><span leaf=""># SSBP2 Â 0.3669311 0.0007693966 Â SSBP2</span></span><span leaf=""><br></span><span><span leaf=""># CD8B Â  0.3266638 0.0010654284 Â  CD8B</span></span><span leaf=""><br></span><span><span leaf=""># MRPL18 0.4196821 0.0067862948 MRPL18</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># å¦‚æœæ˜ç¡®äº†ç›¸æ¯”è¾ƒçš„é‚»åŸŸ</span></span><span leaf=""><br></span><span leaf="">nhood_markers &lt;- findNhoodGroupMarkers(scRNA_milo, da_results, subset.row = hvgs,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â subset.nhoods = da_results$NhoodGroup %</span><span><span leaf="">in</span></span><span leaf="">% c(</span><span><span leaf="">'2'</span></span><span leaf="">,</span><span><span leaf="">'5'</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â aggregate.samples =Â </span><span><span leaf="">TRUE</span></span><span leaf="">, sample_col =Â </span><span><span leaf="">"orig.ident"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">head(nhood_markers)</span><span leaf=""><br></span><span><span leaf=""># Â  GeneID Â  Â  Â logFC_2 adj.P.Val_2 Â  Â  Â logFC_5 adj.P.Val_5</span></span><span leaf=""><br></span><span><span leaf=""># 1 Â ABCA1 Â 0.007280498 Â 0.63548063 -0.007280498 Â 0.63548063</span></span><span leaf=""><br></span><span><span leaf=""># 2 Â ABCA2 -0.024945154 Â 0.40911416 Â 0.024945154 Â 0.40911416</span></span><span leaf=""><br></span><span><span leaf=""># 3 Â ABCA5 Â 0.021147177 Â 0.25841475 -0.021147177 Â 0.25841475</span></span><span leaf=""><br></span><span><span leaf=""># 4 Â ABCA7 -0.015377090 Â 0.66034055 Â 0.015377090 Â 0.66034055</span></span><span leaf=""><br></span><span><span leaf=""># 5 Â ABCD2 -0.006936849 Â 0.65999062 Â 0.006936849 Â 0.65999062</span></span><span leaf=""><br></span><span><span leaf=""># 6 ABHD18 -0.053001633 Â 0.04725136 Â 0.053001633 Â 0.04725136</span></span><span leaf=""><br></span></code></pre><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">12.3 å·®å¼‚åŸºå› å¯è§†åŒ–</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># å‚æ•°è‡ªè¡Œä¿®æ”¹</span></span><span leaf=""><br></span><span leaf="">ggplot(nhood_markers, aes(logFC_2,-log10(adj.P.Val_2 ))) +Â </span><span leaf=""><br></span><span leaf="">Â  geom_point(alpha=</span><span><span leaf="">0.5</span></span><span leaf="">, size=</span><span><span leaf="">0.5</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">Â  geom_hline(yintercept =Â </span><span><span leaf="">0.05</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># ç­›é€‰æ ‡å‡†å¯ä»¥è‡ªè¡Œä¿®æ”¹</span></span><span leaf=""><br></span><span leaf="">markers &lt;- nhood_markers$GeneID[nhood_markers$adj.P.Val_2 &lt;Â </span><span><span leaf="">0.05</span></span><span leaf="">Â &amp; nhood_markers$logFC_2 &gt;Â </span><span><span leaf="">1</span></span><span leaf="">]</span><span leaf=""><br></span><span leaf="">plotNhoodExpressionGroups(scRNA_milo, da_results, features=markers,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subset.nhoods = da_results$NhoodGroup %</span><span><span leaf="">in</span></span><span leaf="">% c(</span><span><span leaf="">'2'</span></span><span leaf="">,</span><span><span leaf="">'5'</span></span><span leaf="">),Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scale=</span><span><span leaf="">TRUE</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid.space =Â </span><span><span leaf="">"fixed"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><figure data-tool="mdniceç¼–è¾‘å™¨"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqWJ81rmuYgzPM67BKaGwuP4xjgYVMCol25rQOm8YyV5yoACc52GNwow/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5452898550724637" data-type="png" data-w="552" data-imgfileid="100045512" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjTdjPHAyiaICzZXF6cjgvUqqWJ81rmuYgzPM67BKaGwuP4xjgYVMCol25rQOm8YyV5yoACc52GNwow/640?wx_fmt=png&amp;from=appmsg"></span></figure><h6 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">12.4 åŒä¸€é‚»åŸŸä½†æ˜¯ä¸åŒå¹²é¢„çš„ç»†èƒæ¯”è¾ƒ</span><span></span></h6><pre data-tool="mdniceç¼–è¾‘å™¨"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">dge_5 &lt;- testDiffExp(scRNA_milo, da_results, design = ~ location,Â </span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â meta.data = data.frame(colData(scRNA_milo)),</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â subset.row = rownames(scRNA_milo),</span><span leaf=""><br></span><span leaf="">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â subset.nhoods=da_results$NhoodGroup==</span><span><span leaf="">"5"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">dge_5</span><span leaf=""><br></span><span><span leaf=""># $`5`</span></span><span leaf=""><br></span><span><span leaf=""># Â  Â  Â  Â  Â  Â  Â  Â  Â  Â logFC Â  Â AveExpr Â  Â  Â  Â  Â t Â  Â  Â  P.Value Â  Â  adj.P.Val Â  Â  Â  Â  Â B Nhood.Group</span></span><span leaf=""><br></span><span><span leaf=""># RPS26 Â  Â  Â  Â  2.05155879 2.16078022 Â 40.913548 2.133985e-259 3.832637e-255 583.478172 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># TSC22D3 Â  Â  Â  1.18443050 1.71490401 Â 18.676109 Â 2.678121e-71 Â 2.404953e-67 151.256496 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># TXNIP Â  Â  Â  Â  0.92242005 0.78962782 Â 17.282387 Â 4.814448e-62 Â 2.882250e-58 130.022537 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># IL7R Â  Â  Â  Â  Â 1.06746697 1.32047401 Â 16.570152 Â 1.643201e-57 Â 7.377973e-54 119.625571 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># UGP2 Â  Â  Â  Â  Â 0.80880323 0.85367836 Â 16.342942 Â 4.291897e-56 Â 1.541649e-52 116.376331 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># FAM118A Â  Â  Â -0.63992629 0.59464042 -15.560710 Â 2.510389e-51 Â 7.514431e-48 105.447340 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># ETS1 Â  Â  Â  Â  Â 0.69424488 1.08136205 Â 14.602241 Â 9.954116e-46 Â 2.553942e-42 Â 92.618518 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># AIM1 Â  Â  Â  Â  Â 0.36544366 0.22221315 Â 13.380244 Â 5.355135e-39 Â 1.202228e-35 Â 77.204983 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># MT-CO1 Â  Â  Â  -0.58424851 5.05175258 -12.970636 Â 7.565387e-37 Â 1.509715e-33 Â 72.284370 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># SMAP2 Â  Â  Â  Â  0.53193670 0.77612312 Â 12.062342 Â 2.816038e-32 Â 5.057605e-29 Â 61.829911 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># RPS9 Â  Â  Â  Â  -0.58244288 2.86336400 -11.929160 Â 1.249072e-31 Â 2.039394e-28 Â 60.350991 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span><span><span leaf=""># ZNF765 Â  Â  Â  Â 0.17038370 0.06098921 Â 11.890038 Â 1.929662e-31 Â 2.888060e-28 Â 59.919222 Â  Â  Â  Â  Â  5</span></span><span leaf=""><br></span></code></pre><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">éœ€è¦æé†’ä¸€ä¸‹ï¼Œå…¶ä¸­å¾ˆå¤šå‚æ•°ç¬”è€…åšäº†ä¿®æ”¹ä¹Ÿåšäº†æ³¨é‡Šï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦å…ˆä»é»˜è®¤å€¼å¼€å§‹åˆ†æï¼</span></p><p data-tool="mdniceç¼–è¾‘å™¨"><span leaf="">æœ¬æ¬¡å†…å®¹å®Œæˆäº†è¿™ä¸‰ä¸ªå·¥å…·çš„å®Œæ•´å®è·µæµç¨‹ã€‚è™½ç„¶å®ƒä»¬å„è‡ªä¾§é‡çš„åˆ†ææ–¹å‘ä¸åŒï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯æ˜¯å­˜åœ¨äº¤å‰çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹åŒä¸€æ‰¹æ•°æ®ï¼Œåˆ†åˆ«ä½¿ç”¨è¿™ä¸‰ä¸ªå·¥å…·ä»ä¸åŒçš„è§†è§’å’Œåˆ†æç»´åº¦è¿›è¡Œè§£è¯»ï¼Œæœ€ç»ˆè·å¾—æ›´åŠ å…¨é¢ã€ç«‹ä½“çš„ç”Ÿç‰©å­¦ä¿¡æ¯ã€‚</span></p><h4 data-tool="mdniceç¼–è¾‘å™¨"><span></span><span leaf="">å‚è€ƒèµ„æ–™ï¼š</span><span></span></h4><ol><li><section><span leaf="">Lineage tracking reveals dynamic relationships of T cells in colorectal cancer. Nature. 2018 Dec;564(7735):268-272.</span></section></li><li><section><span leaf="">A pan-cancer single-cell transcriptional atlas of tumor infiltrating myeloid cells. Cell. 2021 Feb 4;184(3):792-809.e23.</span></section></li><li><section><span leaf="">Global characterization of T cells in non-small-cell lung cancer by single-cell sequencing. Nat Med. 2018 Jul;24(7):978-985.</span></section></li><li><section><span leaf="">Cell type prioritization in single-cell data. Nat Biotechnol. 2021 Jan;39(1):30-34.</span></section></li><li><section><span leaf="">Differential abundance testing on single-cell data using k-nearest neighbor graphs. Nat Biotechnol. 2022 Feb;40(2):245-253.</span></section></li><li><section><span leaf="">STARTRAC githubï¼šhttps://github.com/Japrin/STARTRAC</span></section></li><li><section><span leaf="">Augur githubï¼šhttps://github.com/neurorestore/Augur</span></section></li><li><section><span leaf="">miloR githubï¼šhttps://rawcdn.githack.com/MarioniLab/miloR/7c7f906b94a73e62e36e095ddb3e3567b414144e/vignettes/milo_gastrulation.html#5_Finding_markers_of_DA_populations</span></section></li><li><section><span leaf="">å•ç»†èƒå¤©åœ°ï¼šhttps://mp.weixin.qq.com/s/FlO4fN5AlcyZ81llzHE5A https://mp.weixin.qq.com/s/yYTxb_kOjeRSkzzuUoI4mA</span></section></li><li><section><span leaf="">ç”Ÿä¿¡èœé¸Ÿå›¢ï¼šhttps://mp.weixin.qq.com/s/D0nGq3XGZRIlso7dKo0qkQ</span></section></li></ol><p data-tool="mdniceç¼–è¾‘å™¨"><strong><span leaf="">è‡´è°¢</span></strong><span leaf="">ï¼šæ„Ÿè°¢æ›¾è€å¸ˆä»¥åŠç”Ÿä¿¡æŠ€èƒ½æ ‘å›¢é˜Ÿå…¨ä½“æˆå‘˜ã€‚æ›´å¤šç²¾å½©å†…å®¹å¯å…³æ³¨å…¬ä¼—å·ï¼š</span><strong><span leaf="">ç”Ÿä¿¡æŠ€èƒ½æ ‘ï¼Œå•ç»†èƒå¤©åœ°ï¼Œç”Ÿä¿¡èœé¸Ÿå›¢</span></strong><span leaf="">ç­‰å…¬ä¼—å·ã€‚</span></p><p data-tool="mdniceç¼–è¾‘å™¨"><strong><span leaf="">æ³¨</span></strong><span leaf="">ï¼šè‹¥å¯¹å†…å®¹æœ‰ç–‘æƒ‘æˆ–è€…æœ‰å‘ç°æ˜ç¡®é”™è¯¯çš„æœ‹å‹ï¼Œè¯·è”ç³»åå°(æ¬¢è¿äº¤æµ)ã€‚</span></p><span><span leaf="">- END -</span></span></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/AVQJEYiF7TApDnRzyYXFWA",target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a>
