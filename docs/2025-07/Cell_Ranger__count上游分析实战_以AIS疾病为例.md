---
title: "Cell Ranger  count上游分析实战 以AIS疾病为例"
date: 2025-07-27T17:09:08Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
Cell Ranger  count上游分析实战 以AIS疾病为例 by 生信小博士
------
<div><p data-start="0" data-end="105"><span leaf="">根据 Cell Ranger 的使用文档，</span><strong data-start="21" data-end="45"><span leaf="">如果你的 FASTQ 目录中包含多个样本</span></strong><span leaf="">，建议在运行 cellranger count 时使用<span textstyle=""> </span></span><code data-start="73" data-end="83"><span leaf=""><span textstyle="">--sample</span></span></code><span leaf=""><span textstyle=""> 参数来指定你想要处理的特定样本</span>。原因如下：</span></p><ul><li><strong data-start="109" data-end="144"><span leaf="">单个 cellranger count 运行通常只针对一个样本</span></strong></li><li><section><span leaf="">如果 FASTQ 文件中包含多个样本的文件（例如文件名中各自有不同的 sample 名字），不使用 </span><code data-start="200" data-end="210"><span leaf="">--sample</span></code><span leaf=""> 参数可能导致 Cell Ranger 无法正确区分每个样本，或者将它们混合在一起进行处理。</span></section></li></ul><p data-start="258" data-end="267"><strong data-start="258" data-end="265"><span leaf="">因此：</span></strong></p><ul><li><section><span leaf="">如果你打算一次性处理所有样本，你需要将每个样本分开运行 cellranger count（即为每个样本单独创建一个 FASTQ 目录或者使用 </span><code data-start="341" data-end="351"><span leaf="">--sample</span></code><span leaf=""> 参数分别提交任务）。</span></section></li><li><section><span leaf="">如果你的 FASTQ 文件实际上来自同一个样本（即它们的 sample 名称前缀相同），则可以不指定 </span><code data-start="418" data-end="428"><span leaf="">--sample</span></code><span leaf=""> 参数。</span></section></li></ul><p data-start="434" data-end="439"><span leaf=""><span textstyle="">总结：</span></span></p><ul><li><strong data-start="442" data-end="466"><span leaf="">如果 FASTQ 文件夹下确实有多个样本</span></strong><section><span leaf="">（不同的 sample 前缀），建议为每个样本单独运行 cellranger count，并使用 </span><code data-start="515" data-end="525"><span leaf="">--sample</span></code><span leaf=""> 参数明确指定。</span></section></li><li><strong data-start="538" data-end="566"><span leaf="">如果 FASTQ 文件夹下只有一个样本的所有数据</span></strong><section><span leaf="">，那么可以不指定 </span><code data-start="575" data-end="585"><span leaf="">--sample</span></code><span leaf=""> 参数，Cell Ranger 会处理目录中的所有 FASTQ 文件。</span></section></li></ul><section nodeleaf=""><img data-imgfileid="100005184" data-ratio="0.6602564102564102" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkvT1vM9K6P0iapiaCJeDBialiawdGLFFqWVBWMYVDTkllKzUiaibIaYmKE0BB7wCVJfd7lsc9W563B8HDTw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="780" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkvT1vM9K6P0iapiaCJeDBialiawdGLFFqWVBWMYVDTkllKzUiaibIaYmKE0BB7wCVJfd7lsc9W563B8HDTw/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf=""><br></span></section><section><span leaf="">如果文件名类似 </span><code data-start="683" data-end="720"><span leaf="">SRR14241266_S1_L001_R1_001.fastq.gz</span></code><span leaf="">、</span><code data-start="721" data-end="758"><span leaf="">SRR14241267_S1_L001_R1_001.fastq.gz</span></code><span leaf=""> 等，说明是不同样本，则需要单独指定 sample 名称。</span></section><section><span leaf=""><span textstyle="">SRR14241266为sample的名称哦！！</span></span></section><hr><section><span leaf=""><br></span></section><hr><section><span leaf="">由于 </span><code data-start="54" data-end="62"><span leaf="">fastq/</span></code><span leaf=""> 目录下包含多个样本（</span><code data-start="73" data-end="86"><span leaf="">SRR14241266</span></code><span leaf="">, </span><code data-start="88" data-end="101"><span leaf="">SRR14241267</span></code><span leaf="">, </span><code data-start="103" data-end="116"><span leaf="">SRR14241268</span></code><span leaf="">, </span><code data-start="118" data-end="131"><span leaf="">SRR14241269</span></code><span leaf="">），需要 </span><strong data-start="137" data-end="169"><span leaf="">为每个样本单独运行 </span><code data-start="149" data-end="167"><span leaf="">cellranger count</span></code></strong><span leaf="">，并使用 </span><code data-start="174" data-end="184"><span leaf="">--sample</span></code><span leaf=""> 指定样本名称。</span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span leaf=""><span>#!/bin/bash</span></span></code><code><span leaf=""><span>#SBATCH --job-name=cellranger_count</span></span></code><code><span leaf=""><span>#SBATCH --partition=7542-64C-512G</span></span></code><code><span leaf=""><span>#SBATCH --output=%x_%j.out</span></span></code><code><span leaf=""><span>#SBATCH --error=%x_%j.err</span></span></code><code><span leaf=""><span>#SBATCH --nodes=1</span></span></code><code><span leaf=""><span>#SBATCH --ntasks=16  # 适当调整 CPU 数量</span></span></code><code><span leaf=""><span>#SBATCH --mail-type=BEGIN,END,FAIL</span></span></code><code><span leaf=""><span>#SBATCH --mail-user=youngleel@seu.edu.cn  </span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 设置环境变量</span></span></code><code><span leaf=""><span>cd</span> /seu_share/home/cj/230218989/ais/scrnaseq/01raw_data</span></code><code><span leaf="">ref=/seu_share/home/cj/230218989/datasets/cellranger_ref_data/hg19</span></code><code><span leaf="">fastqs=/seu_share/home/cj/230218989/ais/scrnaseq/01raw_data/fastq  <span># 指向 fastq 目录</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 遍历样本列表</span></span></code><code><span leaf=""><span>for</span> sample <span>in</span> SRR14241266 SRR14241267 SRR14241268 SRR14241269; <span>do</span></span></code><code><span leaf="">    <span>echo</span> <span>"Processing sample: </span><span><span>$sample</span></span><span>"</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">    /seu_share/home/cj/230218989/software/cellranger-6.1.2/bin/cellranger count \</span></code><code><span leaf="">        --<span>id</span>=<span>$sample</span> \</span></code><code><span leaf="">        --transcriptome=<span>$ref</span> \</span></code><code><span leaf="">        --fastqs=<span>$fastqs</span> \</span></code><code><span leaf="">        --sample=<span>$sample</span> \</span></code><code><span leaf="">        --nosecondary</span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span>echo</span> <span>"cellranger count for </span><span><span>${sample}</span></span><span> completed at </span><span><span>$(date)</span></span><span>"</span></span></code><code><span leaf=""><span>done</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">sbatch cellranger_count.slurm</span></code></pre></section><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247488830&amp;idx=1&amp;sn=715570480c4d900208f25d2062834df9&amp;scene=21#wechat_redirect" textvalue="单细胞上游分析cellranger count命令解析" data-itemshowtype="0" linktype="text" data-linktype="2">单细胞上游分析cellranger count命令解析</a></span></section><section><span leaf="">运行成功的话，长这样：</span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>cellranger</span> count for SRR14241267 completed at Fri Feb <span>14</span> <span>17</span>:<span>55</span>:<span>45</span> CST <span>2025</span></span></code><code><span leaf=""><span>Processing</span> sample: SRR14241268</span></code><code><span leaf=""><span>Martian</span> Runtime - v4.<span>0</span>.<span>6</span></span></code><code><span leaf=""><span>Serving</span> UI at http://fat09:<span>43841</span>?auth=Bz8am7BVg40JL1MUpF3YCtrGaoSZiZw4DEDve4YJYo4</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>Running</span> preflight checks (please wait)...</span></code><code><span leaf=""><span>Checking</span> sample info...</span></code><code><span leaf=""><span>Checking</span> FASTQ folder...</span></code><code><span leaf=""><span>Checking</span> reference...</span></code><code><span leaf=""><span>Checking</span> reference_path (/seu_share/home/chaojie/<span>230218989</span>/datasets/cellranger_ref_data/hg19) <span>on</span> fat09...</span></code><code><span leaf=""><span>Checking</span> optional arguments...</span></code><code><span leaf=""><span>mrc</span>: v4.<span>0</span>.<span>6</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>mrp</span>: v4.<span>0</span>.<span>6</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>Anaconda</span>: Python <span>3</span>.<span>8</span>.<span>2</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>numpy</span>: <span>1</span>.<span>19</span>.<span>2</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>scipy</span>: <span>1</span>.<span>6</span>.<span>2</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>pysam</span>: <span>0.16.0.1</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>h5py</span>: <span>3</span>.<span>2</span>.<span>1</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>pandas</span>: <span>1</span>.<span>2</span>.<span>4</span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>STAR</span>: <span>2</span>.<span>7</span>.<span>2</span>a</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>samtools</span>: samtools <span>1</span>.<span>10</span></span></code><code><span leaf=""><span>Using</span> htslib <span>1</span>.<span>10</span>.<span>2</span></span></code><code><span leaf=""><span>Copyright</span> (C) <span>2019</span> Genome Research Ltd.</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>2025</span>-<span>02</span>-<span>14</span> <span>17</span>:<span>55</span>:<span>52</span><span> [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_CHEMISTRY_DETECTOR._GEM_WELL_CHEMISTRY_DETECTOR.DETECT_COUNT_CHEMISTRY</span></span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (run:local)       ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_CHEMISTRY_DETECTOR._GEM_WELL_CHEMISTRY_DETECTOR.DETECT_COUNT_CHEMISTRY.fork0.chnk0.main</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.SANITIZE_MAP_CALLS</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_GEM_WELL_PROCESSOR.COUNT_GEM_WELL_PROCESSOR._BASIC_SC_RNA_COUNTER.DISABLE_BAMS</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (run:local)       ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_GEM_WELL_PROCESSOR.COUNT_GEM_WELL_PROCESSOR._BASIC_SC_RNA_COUNTER.DISABLE_BAMS.fork0.chnk0.main</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MAKE_FULL_CONFIG._MAKE_VDJ_CONFIG</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (run:local)       ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MAKE_FULL_CONFIG._MAKE_VDJ_CONFIG.fork0.chnk0.main</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.FULL_COUNT_INPUTS.WRITE_GENE_INDEX</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (run:local)       ID.SRR14241268.SC_RNA_COUNTER_CS.FULL_COUNT_INPUTS.WRITE_GENE_INDEX.fork0.chnk0.main</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.WRITE_GENE_INDEX</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (run:local)       ID.SRR14241268.SC_RNA_COUNTER_CS.WRITE_GENE_INDEX.fork0.chnk0.main</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (chunks_complete) ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MAKE_FULL_CONFIG._MAKE_VDJ_CONFIG</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (chunks_complete) ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_GEM_WELL_PROCESSOR.COUNT_GEM_WELL_PROCESSOR._BASIC_SC_RNA_COUNTER.DISABLE_BAMS</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_GEM_WELL_PROCESSOR.VDJ_T_GEM_WELL_PROCESSOR.MULTI_SETUP_CHUNKS</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_GEM_WELL_PROCESSOR.VDJ_B_GEM_WELL_PROCESSOR.MULTI_SETUP_CHUNKS</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_GEM_WELL_PROCESSOR.VDJ_T_GEM_WELL_PROCESSOR.SC_VDJ_CONTIG_ASSEMBLER.MAKE_SHARD</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_GEM_WELL_PROCESSOR.VDJ_B_GEM_WELL_PROCESSOR.SC_VDJ_CONTIG_ASSEMBLER.MAKE_SHARD</span></code><code><span leaf="">2025-02-14 17:55:52 [runtime] (ready)           ID.SRR14241268.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MULTI_GEM_WELL_PROCESSOR.VDJ_T_GEM_WELL_PROCESSOR.SC_VDJ_CONTIG_ASSEMBLER.BARCODE_CORRECTION</span></code><code><span leaf="">202</span></code></pre></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/UWWfh_7_746XsBdby1BfmA",target="_blank" rel="noopener noreferrer">原文链接</a>
