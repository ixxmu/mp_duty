---
title: "R语言冷知识：data[[]]、!!sym()、get() 、!!as.name()动态引用变量名的区别在哪里？"
date: 2025-07-09T11:40:04Z
draft: ["false"]
tags: [
  "fetched",
  "R语言学徒"
]
categories: ["Acdemic"]
---
R语言冷知识：data[[]]、!!sym()、get() 、!!as.name()动态引用变量名的区别在哪里？ by R语言学徒
------
<div><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEUeRH9VLyWbQoJghgIrTRx383Ak7ibU8ltoFYv9E74BicnHHtASRb1mJJU3Arr9qX25DhJ5pErPgDPw/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="0.2222222222222222" data-s="300,640" data-type="jpeg" data-w="900" type="block" data-imgfileid="100012638" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/oCSOtP61aEUeRH9VLyWbQoJghgIrTRx383Ak7ibU8ltoFYv9E74BicnHHtASRb1mJJU3Arr9qX25DhJ5pErPgDPw/640?wx_fmt=jpeg&amp;from=appmsg"></section><p><span><span leaf=""><span textstyle="">大家好呀！我是沉迷于 R 语言世界无法自拔的小师妹～最近在做数据分析项目时，我遇到了一个超头疼的问题！领导突然丢给我一堆数据，让我写个通用函数，能根据不同变量名灵活提取数据、做分析。当时我的表情 be like，满脑子都是 “变量名还能动态引用？这可咋整！”</span></span></span></p><p><span><span leaf=""><span textstyle="">在不断查资料、疯狂试错的过程中，我发现 </span></span></span><span><span><span leaf=""><span textstyle="">data[[color_var]]、!!sym(color_var)、get(color_var) 和 !!as.name(color_var)</span></span></span></span><span></span><span><span leaf=""><span textstyle=""> 这四种方法都能实现动态引用变量名。可它们到底有啥区别，什么时候该用哪个？这简直是 “玄学”！相信不少小伙伴和小师妹一样，在数据处理时，经常会遇到类似场景。比如，要对不同数据集的指定列做统计分析；或者在循环里，根据不同的变量名执行操作。要是用错方法，分分钟报错，让代码直接 “罢工”！</span></span></span></p><p><span><span leaf=""><span textstyle="">为了彻底搞清楚这些方法，小师妹熬夜研究、反复测试，终于摸透了它们的 “脾气”。今天，小师妹就把这份学习成果分享给大家，咱们一起揭开 R 语言中动态引用变量名的神秘面纱吧！</span></span></span></p><p><span><span leaf=""><span textstyle="">小师妹在这里还要强调一件事，自己分析数据及可视化出图的确有些费心费力，大家可以后台联系小师妹，小师妹有经验丰富的技术人员和算力庞大的集群给大家推荐哦，可以完美解决小伙伴们的时间和算力问题。</span></span></span></p><p><span><span leaf=""><span textstyle="">一、data[[color_var]]</span></span></span></p><p><span><span leaf=""><span textstyle="">data[[color_var]] 这种方式是基于数据框索引的动态引用方法。这里的 data 是一个数据框对象，color_var 是一个存储变量名的字符型变量。例如，有一个数据框：</span></span></span><page></page></p><section><ul><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>df</span> &lt;- data.frame(a = <span>1</span>:<span>5</span>, b = <span>6</span>:<span>10</span>)</span></code><code><span leaf=""><span>color_var</span> &lt;- <span>"a"</span></span></code><code><span leaf=""><span>df</span>[[color_var]]</span></code></pre></section><p><span><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbR2XicibIgPctk7BV8uS6W4ZxXcAHG47bwOiaOYQNXsiaqew4gHKENF7FsxA/640?wx_fmt=png" data-ratio="1.625" data-w="72" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbR2XicibIgPctk7BV8uS6W4ZxXcAHG47bwOiaOYQNXsiaqew4gHKENF7FsxA/640?wx_fmt=png"></span></span><span></span></p><section><ul><li></ul><pre data-lang="bash"><code><span leaf=""><span>df</span>[“a”]</span></code></pre></section><p><span><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbR2XicibIgPctk7BV8uS6W4ZxXcAHG47bwOiaOYQNXsiaqew4gHKENF7FsxA/640?wx_fmt=png" data-ratio="1.625" data-w="72" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbR2XicibIgPctk7BV8uS6W4ZxXcAHG47bwOiaOYQNXsiaqew4gHKENF7FsxA/640?wx_fmt=png"></span></span><span></span><span></span></p><p><span><span leaf=""><span textstyle="">这种方法的优点在于简洁直观，并且在数据框操作场景下具有较好的兼容性，因为它遵循数据框的标准索引规则。这样他就可以和咱们的传参函数进行联合使用：</span></span></span></p><section><ul><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>args</span> &lt;- commandArgs(trailingOnly = TRUE)</span></code><code><span leaf=""><span>input</span> &lt;- args[<span>1</span>]</span></code><code><span leaf=""><span>df</span> &lt;- data.frame(a = <span>1</span>:<span>5</span>, b = <span>6</span>:<span>10</span>)</span></code><code><span leaf=""><span>df</span>[[input]]</span></code></pre></section><p><span><span leaf=""><span textstyle="">若input被输入“b”，即调用命令为：</span></span></span></p><section><ul><li></ul><pre data-lang="css"><code><span leaf="">Rscript script<span>.R</span> <span>b</span></span></code></pre></section><p><span><span leaf=""><span textstyle="">结果为：</span></span></span></p><p><span><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbRA6NPvuC8iaBmfTia7JWtSJoQSgiaK6bb0mNMvDsZ6Cq2EH9906lEGzwdw/640?wx_fmt=png" data-ratio="1.2608695652173914" data-w="92" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbRA6NPvuC8iaBmfTia7JWtSJoQSgiaK6bb0mNMvDsZ6Cq2EH9906lEGzwdw/640?wx_fmt=png"></span></span><span></span></p><p><span><span leaf=""><span textstyle="">但它的局限性也很明显，只能用于数据框对象，无法处理不在数据框中的变量。如果尝试使用 data[[color_var]] 去获取全局环境中的独立变量，会导致错误。</span></span></span></p><p><span><span leaf=""><span textstyle="">二、!!sym(color_var)</span></span></span><page></page></p><p><span><span leaf=""><span textstyle="">!!sym(color_var) 是在使用 dplyr 等包进行数据操作时常用的一种动态引用方式，其核心依赖于 rlang 包中的 sym 函数。sym 函数会将传入的字符型变量转换为符号，而 !!（双叹号）在 tidyeval 框架中用于解除符号的引用，将其解析为实际的变量。</span></span></span></p><p><span><span leaf=""><span textstyle="">例如，在 dplyr 中进行数据筛选操作：</span></span></span></p><section><ul><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>library</span>(dplyr)</span></code><code><span leaf=""><span>df</span> &lt;- data.frame(a = <span>1</span>:<span>5</span>, b = <span>6</span>:<span>10</span>)</span></code><code><span leaf=""><span>color_var</span> &lt;- <span>"a"</span></span></code><code><span leaf=""><span>df</span> %&gt;% filter(!!sym(color_var) &gt; <span>3</span>)</span></code></pre></section><section nodeleaf=""><img data-imgfileid="100014033" data-ratio="0.20512820512820512" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbRvYhywea62rAVzicMQWqjhUxaJiaCLniaUomc5EDeshcH3icLtCGKvzXNKg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="312" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbRvYhywea62rAVzicMQWqjhUxaJiaCLniaUomc5EDeshcH3icLtCGKvzXNKg/640?wx_fmt=png&amp;from=appmsg"></section><p><span><span leaf=""><span textstyle="">上述代码会根据 color_var 的值动态选择数据框中的列，并对该列进行条件筛选。这种方法的优势在于与 tidyverse 生态系统高度契合，在进行数据清洗、转换和汇总等操作时非常方便。</span></span></span></p><p><span><span leaf=""><span textstyle="">然而，它的使用依赖于 rlang 和 tidyeval 框架，对于不熟悉该框架的用户来说，理解和使用起来可能存在一定难度，而且在非 tidyverse 的环境下使用会显得格格不入。</span></span></span></p><p><span><span leaf=""><span textstyle="">三、get(color_var)</span></span></span></p><p><span><span leaf=""><span textstyle="">get(color_var) 函数用于获取指定名称的对象。它会在当前环境及其父环境中搜索名称为 color_var 的对象，并返回该对象。例如，在全局环境中定义 x &lt;- 10，如果 color_var &lt;- "x"，那么 get(color_var) 就会返回 10。即使变量 x 存储在数据框中，get("x") 也会优先在全局环境中查找，若找不到才会在数据框等其他环境中搜索（需要指定环境参数）。</span></span></span><page></page></p><section><ul><li><li><li><li></ul><pre data-lang="swift"><code><span leaf="">x <span>&lt;-</span> <span>10</span></span></code><code><span leaf="">color_var <span>&lt;-</span> <span>"x"</span></span></code><code><span leaf="">result1 <span>&lt;-</span> <span>get</span>(color_var)</span></code><code><span leaf=""><span>print</span>(result1)</span></code></pre></section><p><span><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbRGUhicVqSicUhpnqpZ3rFjqSEyVlahqL6grGgO6GbSD1j7hsBbVszicoAw/640?wx_fmt=png" data-ratio="0.11141304347826086" data-w="368" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbRGUhicVqSicUhpnqpZ3rFjqSEyVlahqL6grGgO6GbSD1j7hsBbVszicoAw/640?wx_fmt=png"></span></span><span></span></p><p><span><span leaf=""><span textstyle="">get(color_var) 的优点是灵活性极高，可以获取全局环境、数据框或其他自定义环境中的变量。但正是因为其搜索范围广，可能会引发一些难以排查的问题，比如在复杂的嵌套环境中，可能获取到并非预期环境中的变量，导致结果出错。</span></span></span></p><p><span><span leaf=""><span textstyle="">四、!!as.name(color_var)</span></span></span></p><p><span><span leaf=""><span textstyle="">!!as.name(color_var) 与 !!sym(color_var) 有相似之处，as.name 函数同样会将字符型变量转换为名称对象，!! 用于解析该名称对象。但与 sym 函数相比，as.name 是 R 语言的基础函数，相对更加底层。</span></span></span></p><p><span><span leaf=""><span textstyle="">在一些简单的表达式解析场景中，!!as.name(color_var) 可以实现与 !!sym(color_var) 类似的功能，但在与 tidyverse 包的集成度上不如 sym 函数。例如，在自定义的简单表达式计算中，!!as.name(color_var) 可以根据动态变量名进行计算，但在 dplyr 等包的高级操作中，sym 函数往往更具优势。而且 as.name 函数在处理一些复杂的符号解析和环境问题时，可能不如 sym 函数表现稳定。</span></span></span></p><p><span><span leaf=""><span textstyle="">五、总结与选择建议</span></span></span></p><p><span><span leaf=""><span textstyle="">通过以上对四种动态引用变量名方法的分析，可以看出它们各有千秋。data[[color_var]] 适用于数据框内的列索引操作；!!sym(color_var) 是 tidyverse 生态下进行动态数据操作的利器；get(color_var) 凭借其广泛的适用性，在复杂环境变量获取中表现出色；!!as.name(color_var) 则在一些基础的表达式解析场景中也能发挥作用。</span></span></span><page></page></p><p><span><span leaf=""><span textstyle="">六、实战</span></span></span></p><p><span><span leaf=""><span textstyle="">好啦，相信各位小伙伴跟着小师妹的步伐已经大概了解了四种动态变量引用的分析方法，那咱们开始进行实战吧，利用以上方法进行可视化绘制。</span></span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span leaf="">library(tidyverse)</span></code><code><span leaf="">library(reshape2)</span></code><code><span leaf="">library(ggplot2)</span></code><code><span leaf=""> </span></code><code><span leaf="">prefix = <span>"output"</span></span></code><code><span leaf="">data &lt;- read.table(<span>"grouped.txt"</span>,sep = <span>'\t'</span>,header = T)</span></code><code><span leaf="">data<span>$sum</span> = rowSums(data[,-1])</span></code><code><span leaf=""><span>sum</span> &lt;- <span>"sum"</span></span></code><code><span leaf="">ord_data &lt;- data %&gt;% arrange(desc(!!sym(<span>sum</span>))) %&gt;% slice(1:20) %&gt;% <span>select</span>(-get(<span>sum</span>))</span></code><code><span leaf=""> </span></code><code><span leaf="">m_data &lt;- melt(ord_data)</span></code><code><span leaf=""> </span></code><code><span leaf="">col &lt;- c(<span>"#e54b34"</span>,<span>"#4cbad4"</span>,<span>"#009f86"</span>,<span>"#3b5387"</span>,<span>"#f29a7f"</span>,<span>"#8491b3"</span>,<span>"#91d1c1"</span>,<span>"#dc0000"</span>,<span>"#7e6047"</span>,<span>"#347988"</span>,<span>"#9f7685"</span>,</span></code><code><span leaf="">         </span></code><code><span leaf=""><span>"#c1969a"</span>,<span>"#8bb0bb"</span>,<span>"#ce8662"</span>,<span>"#b04929"</span>,<span>"#a59487"</span>,<span>"#e3907e"</span>,<span>"#41b4c1"</span>,<span>"#278c87"</span>,<span>"#726486"</span>,<span>"#dca5a5"</span>,<span>"#c1d1cd"</span>,</span></code><code><span leaf="">         </span></code><code><span leaf=""><span>"#a7abb3"</span>,<span>"#f2dcd5"</span>,<span>"#779f99"</span>,<span>"#b2ced4"</span>,<span>"#e5bfb9"</span>,<span>"#985738"</span>,<span>"#8ec0be"</span>,<span>"#3a6688"</span>,<span>"#927a66"</span>)</span></code><code><span leaf=""> </span></code><code><span leaf="">variable &lt;- <span>"variable"</span></span></code><code><span leaf="">value &lt;- <span>"value"</span></span></code><code><span leaf=""> </span></code><code><span leaf="">p &lt;- ggplot(m_data,aes(variable,value, fill =Taxonomy )) +</span></code><code><span leaf="">  geom_bar(<span>stat</span>= <span>"identity"</span>,position = <span>'fill'</span>,width = 0.6) +</span></code><code><span leaf="">  scale_fill_manual(values= col) +</span></code><code><span leaf="">  scale_y_continuous(<span>expand</span>= expansion(mult=c(0,0.1))) + </span></code><code><span leaf="">  theme_classic()+</span></code><code><span leaf="">  labs(x=<span>''</span>,y=<span>"Percentage"</span>,fill=<span>''</span>)+ </span></code><code><span leaf="">  theme(axis.text.x= element_text(size = 12,angle = 45,hjust = 1),</span></code><code><span leaf="">        axis.text.y= element_text(size = 12),</span></code><code><span leaf="">        axis.title.y= element_text(size = 16))</span></code><code><span leaf="">ggsave(filename = <span>paste</span>(prefix, <span>"svg"</span>, sep = <span>"."</span>), plot = p,width = 12, height = 8, device = <span>"svg"</span>)</span></code><code><span leaf="">ggsave(filename = <span>paste</span>(prefix, <span>"png"</span>, sep = <span>"."</span>), plot = p,width = 12, height = 8, device = <span>"png"</span>)</span></code><code><span leaf="">ggsave(filename = <span>paste</span>(prefix, <span>"pdf"</span>, sep = <span>"."</span>), plot = p,width = 12, height = 8, device = <span>"pdf"</span>)</span></code></pre></section><p><page></page></p><p><span><span leaf=""><img data-ratio="0.8745874587458746" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbRbiahBGy4XyS5TckAwFicwJxbjePDANtqHz81Lm4xruJ0LpTVW36icJDdA/640?wx_fmt=png" data-w="909" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWVKpYcAYY9mU3QTllaZPbRbiahBGy4XyS5TckAwFicwJxbjePDANtqHz81Lm4xruJ0LpTVW36icJDdA/640?wx_fmt=png"></span></span><span></span></p><p><span><span leaf=""><span textstyle="">小师妹这里只是简要使用这种方式进行了数据的清洗，即将sum赋值于其同名参数，当然，其余参数也行哦。然后后面分别使用!!sym()和get()的方法进行了传递，以帮助完成了相应的清晰。</span></span></span></p><p><span><span leaf=""><span textstyle="">小师妹相信当大家在画更复杂的循环图形或者是编程近自己的脚本中时肯定会更加复杂的啊，大家一起加油哦，一起进步哦。</span></span></span><span><span leaf=""><span textstyle="">但是如果大家并不想在数据处理和图形可视化上花费花太多的时间，可以来我们的云生信平台哦，里面有多种图形可视化的成熟代码，只需大家按照示例数据更改自己的数据然后上传就可以了哦，非常简便，快来加入我们吧！！</span></span></span></p><p><span><span leaf=""><span textstyle="">http://www.biocloudservice.com/home.html</span></span></span></p><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section powered-by="xiumi.us"><p><span leaf="">E</span></p></section></section><section><section powered-by="xiumi.us"><p><span leaf="">N</span></p></section></section><section><section powered-by="xiumi.us"><p><span leaf="">D</span></p></section></section><section><section powered-by="xiumi.us"><section><span leaf=""><br></span></section></section></section></section></section><p><span><span leaf="">如果您的时间和精力有限或者缺乏相关经验，并且对生信分析和服务器有所需要的话，我们非常乐意为您提供如下服务：思路评估、生信分析和方案设计以及服务器等，有意向的小伙伴欢迎咨询师妹哦！</span></span></p><section><section><section><section><section><section><section><span leaf=""><img data-cropselx1="0" data-cropselx2="219" data-cropsely1="0" data-cropsely2="219" data-imgfileid="100013742" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWesJCYlntv06OhltJriajm4LeGalupZW22ZNynYrOMW2MVzVNRghGJlq7GC8rj3ibl7m9cV4pTup3A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="396" src="https://mmbiz.qpic.cn/sz_mmbiz_png/oCSOtP61aEWesJCYlntv06OhltJriajm4LeGalupZW22ZNynYrOMW2MVzVNRghGJlq7GC8rj3ibl7m9cV4pTup3A/640?wx_fmt=png&amp;from=appmsg"></span></section></section></section><section><section><p><span leaf="">定制生信分析</span></p><p><span leaf="">课题思路设计</span></p><p><span leaf="">生信云服务器</span></p></section></section></section></section></section></section><section powered-by="xiumi.us"><p><span leaf=""><br></span></p></section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section><section><section powered-by="xiumi.us"><p><strong><span leaf="">往期推荐</span></strong></p></section></section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><svg viewbox="0 0 1 1"></svg></section></section></section></section></section></section><section powered-by="xiumi.us"><p><span leaf=""><br></span></p><p><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg5MDk3Mzg4OA==&amp;mid=2247490276&amp;idx=1&amp;sn=ec7fac6e48adeabefb732d2d1bf2e7fd&amp;scene=21#wechat_redirect" textvalue="史上最详细全面的GO，kegg富集分析绘图代码实操" data-itemshowtype="0" linktype="text" data-linktype="2">史上最详细全面的GO，kegg富集分析绘图代码实操</a></span><span leaf=""><br></span></p><p><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg5MDk3Mzg4OA==&amp;mid=2247497366&amp;idx=1&amp;sn=30f1d23ebcabbaad6cf58085f1f8f07b&amp;scene=21#wechat_redirect" textvalue="单细胞生信赛道“大佬”—北大张泽民院士，联合东肿团队，再次登顶Cancer Cell！" data-itemshowtype="0" linktype="text" data-linktype="2">单细胞生信赛道“大佬”—北大张泽民院士，联合东肿团队，再次登顶Cancer Cell！</a></span></p></section><p><span><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg5MDk3Mzg4OA==&amp;mid=2247497278&amp;idx=1&amp;sn=74e847a856f1c0d6d59de4442fde69c2&amp;scene=21#wechat_redirect" textvalue="生信绘图不再愁！karyoploteR包，三分钟轻松绘制基因组数据，快速掌握染色体可视化与注释技巧！" data-itemshowtype="0" linktype="text" data-linktype="2">生信绘图不再愁！karyoploteR包，三分钟轻松绘制基因组数据，快速掌握染色体可视化与注释技巧！</a></span></span><span leaf=""><br></span><page></page></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/yov7_VrN5mHW79MjpovIEg",target="_blank" rel="noopener noreferrer">原文链接</a>
