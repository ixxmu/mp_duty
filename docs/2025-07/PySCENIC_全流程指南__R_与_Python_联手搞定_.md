---
title: "PySCENIC 全流程指南：：R 与 Python 联手搞定！"
date: 2025-07-28T16:24:43Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
PySCENIC 全流程指南：：R 与 Python 联手搞定！ by 生信小博士
------
<div><section><span leaf="">本文不仅涵盖环境配置、数据准备、PySCENIC 三步分析，还贴心标注了</span><strong data-start="244" data-end="256" data-pm-slice="0 0 []"><span leaf="">常见报错与避坑点</span></strong><span leaf="">，全流程一文打尽！</span></section><ol><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=2&amp;sn=8525db4aa751b9ee5e701eb7100d7897&amp;scene=21#wechat_redirect" textvalue="pyscenic 三部曲之命令详解" data-itemshowtype="0" linktype="text" data-linktype="2">pyscenic 三部曲之命令详解</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=1&amp;sn=9f987422f21ad406a78fb0cfd65fd1e0&amp;scene=21#wechat_redirect" textvalue="pyscenic （附全流程代码）" data-itemshowtype="0" linktype="text" data-linktype="2">pyscenic （附全流程代码）</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=3&amp;sn=d324a1737c90a55f4cc4ee1a90b7b774&amp;scene=21#wechat_redirect" textvalue="pyscenic全流程（jupyterlab）" data-itemshowtype="0" linktype="text" data-linktype="2">pyscenic全流程（jupyterlab）</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=4&amp;sn=9f235d74097d7e95b4b7277e64a1528c&amp;scene=21#wechat_redirect" textvalue="单细胞转录因子分析：pyscenic" data-itemshowtype="0" linktype="text" data-linktype="2">单细胞转录因子分析：pyscenic</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=5&amp;sn=98b34397a0e16819aad350342c414a47&amp;scene=21#wechat_redirect" textvalue="R语言版本pyscenic，非常耗时！不推荐" data-itemshowtype="0" linktype="text" data-linktype="2">R语言版本pyscenic，非常耗时！不推荐</a></span></section><section><span leaf=""><br></span></section></li></ol><hr><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">🧱 一、项目背景与R语言数据准备</span></span></section><section><span leaf="">我们先在 R 中使用 </span><code data-start="304" data-end="312" data-pm-slice="0 0 []"><span leaf="">Seurat</span></code><span leaf=""> 筛选目标细胞群（如 fibroblast &amp; myofibroblast），并将表达矩阵导出：</span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span>load</span>(<span>"/home/data/.../subset.Rdata"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 可视化标记细胞</span></span></code><code><span leaf=""><span>DimPlot</span>(subset_data2, label = <span>TRUE</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 将 count 矩阵导出为 csv 文件（注意转置！！）</span></span></code><code><span leaf="">write.<span>csv</span>(</span></code><code><span leaf="">  <span>t</span>(<span>as</span>.<span>matrix</span>(subset_data2@assays<span>$RNA</span>@counts)),</span></code><code><span leaf="">  file = <span>"/.../fibo_1000.csv"</span></span></code><code><span leaf="">)</span></code><code><span leaf=""><br></span></code></pre></section><blockquote><p><span leaf="">💡 提示：PySCENIC 要求行为细胞、列为基因，因此必须转置！</span></p></blockquote><section><span leaf=""><br></span></section><h2 data-start="621" data-end="655" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">⚙️ 二、创建 Python 环境并注册 Jupyter 内核</span></span></h2><p data-start="657" data-end="708"><span leaf="">在终端执行以下命令，创建 PySCENIC 专属环境，并在 Jupyter Notebook 中注册：</span></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>conda</span> create -n pyscenic python=<span>3</span>.<span>10</span></span></code><code><span leaf=""><span>conda</span> activate pyscenic</span></code><code><span leaf=""><span>pip</span> install pyscenic</span></code><code><span leaf=""><span>conda</span> install ipykernel</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>python</span> -m ipykernel install --user --name pyscenic --display-name <span>"pyscenic"</span></span></code><code><span leaf=""><br></span></code></pre></section><h2 data-start="1003" data-end="1018" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">📂 三、安装依赖工具包</span></span></h2><p data-start="1020" data-end="1053"><span leaf="">PySCENIC 需要 </span><code data-start="1032" data-end="1040"><span leaf="">loompy</span></code><span leaf="">、</span><code data-start="1041" data-end="1049"><span leaf="">scanpy</span></code><span leaf=""> 等包：</span></p><section><ul><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>pip</span> install loompy scanpy</span></code><code><span leaf=""><span>pip</span> install numpy==<span>1</span>.<span>22</span> pandas==<span>1</span>.<span>5</span>.<span>3</span></span></code></pre></section><section><span leaf="">⚠️ numpy 与 numba 版本需匹配，强烈建议固定 </span><code data-start="1162" data-end="1175" data-pm-slice="0 0 []"><span leaf="">numpy==1.22</span></code><span leaf="">！</span></section><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">🧬 四、将 CSV 转换为 LOOM 格式</span></span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span leaf=""><span>import</span> scanpy <span>as</span> sc</span></code><code><span leaf=""><span>import</span> loompy <span>as</span> lp</span></code><code><span leaf=""><span>import</span> numpy <span>as</span> np</span></code><code><span leaf=""><br></span></code><code><span leaf="">x = sc.read_csv(<span>"./fibo_1000.csv"</span>)  <span># 读取 R 中导出的表达矩阵</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">row_attrs = {<span>"Gene"</span>: np.array(x.var_names)}</span></code><code><span leaf="">col_attrs = {<span>"CellID"</span>: np.array(x.obs_names)}</span></code><code><span leaf=""><br></span></code><code><span leaf="">lp.create(<span>"sample.loom"</span>, x.X.T, row_attrs, col_attrs)</span></code><code><span leaf=""><br></span></code></pre></section><section><span leaf=""><span textstyle="">🧠 五、PySCENIC 三步走！</span></span></section><section><span leaf=""><span textstyle="">🔹 Step 1：构建基因调控网络（GRN）</span></span></section><section><ul><li><li><li><li><li></ul><pre data-lang="css"><code><span leaf="">pyscenic grn sample<span>.loom</span> allTFs_mm<span>.txt</span> \</span></code><code><span leaf=""><span>--num_workers</span> <span>40</span> \</span></code><code><span leaf=""><span>--output</span> adj<span>.sample.tsv</span> \</span></code><code><span leaf=""><span>--method</span> grnboost2</span></code><code><span leaf=""><br></span></code></pre></section><section><span leaf="">📌 allTFs_mm.txt 是转录因子列表，可从官方数据库下载或自建。</span></section><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">🔹 Step 2：富集 motif 匹配（ctx）</span></span></section><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="css"><code><span leaf="">pyscenic ctx adj<span>.sample.tsv</span> \</span></code><code><span leaf="">/path/<span>to</span>/mm10<span>.genes_vs_motifs.rankings.feather</span> \</span></code><code><span leaf=""><span>--annotations_fname</span> /path/<span>to</span>/motifs<span>.tbl</span> \</span></code><code><span leaf=""><span>--expression_mtx_fname</span> sample<span>.loom</span> \</span></code><code><span leaf=""><span>--output</span> reg<span>.csv</span> \</span></code><code><span leaf=""><span>--mode</span> "dask_multiprocessing" \</span></code><code><span leaf=""><span>--num_workers</span> <span>40</span> \</span></code><code><span leaf=""><span>--mask_dropouts</span></span></code><code><span leaf=""><br></span></code></pre></section><section><span leaf="">🧠 该步骤将 motif 匹配信息与调控网络整合，生成 </span><code data-start="2026" data-end="2036" data-pm-slice="0 0 []"><span leaf="">regulons</span></code><span leaf="">。</span></section><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">🔹 Step 3：AUCell 打分，评估 regulon 活性</span></span></section><section><ul><li><li><li><li></ul><pre data-lang="css"><code><span leaf="">pyscenic aucell sample<span>.loom</span> reg<span>.csv</span> \</span></code><code><span leaf=""><span>--output</span> sample_SCENIC<span>.loom</span> \</span></code><code><span leaf=""><span>--num_workers</span> <span>3</span></span></code><code><span leaf=""><br></span></code></pre></section><section><span leaf="">✨ 得到的 </span><code data-start="2186" data-end="2193" data-pm-slice="0 0 []"><span leaf="">.loom</span></code><span leaf=""> 文件可用于 regulon 打分、tSNE/UMAP 可视化等后续分析。</span></section><h2 data-start="2237" data-end="2256" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">🧩 六、常见报错 &amp; 避坑提醒</span></span></h2><table><thead><tr><th><section><span leaf="">问题</span></section></th><th><section><span leaf="">解决方案</span></section></th></tr></thead><tbody><tr><td><code data-start="2294" data-end="2323"><span leaf="">SyntaxError: invalid syntax</span></code></td><td><section><span leaf="">Jupyter 运行 shell 命令要加 </span><code data-start="2348" data-end="2351"><span leaf="">!</span></code></section></td></tr><tr><td><code data-start="2356" data-end="2385"><span leaf="">pyscenic: command not found</span></code></td><td><section><span leaf="">添加环境路径或使用 </span><code data-start="2398" data-end="2411"><span leaf="">os.system()</span></code></section></td></tr><tr><td><code data-start="2416" data-end="2427"><span leaf="">numpy 不兼容</span></code></td><td><section><span leaf="">安装 </span><code data-start="2433" data-end="2446"><span leaf="">numpy==1.22</span></code><span leaf=""> 与 numba 匹配</span></section></td></tr><tr><td><code data-start="2462" data-end="2474"><span leaf="">loompy 找不到</span></code></td><td><code data-start="2477" data-end="2500"><span leaf="">pip install loompy -U</span></code><section><span leaf=""> 后重启环境</span></section></td></tr><tr><td><section><span leaf="">路径错误（Singularity）</span></section></td><td><section><span leaf="">检查 </span><code data-start="2534" data-end="2540"><span leaf="">.sif</span></code><span leaf=""> 文件是否真实存在</span></section></td></tr></tbody></table><section><span leaf=""><br></span></section><section><span leaf="">🎁 七、进阶用法：Singularity镜像运行（HPC 推荐）</span></section><section><ul><li><li><li></ul><pre data-lang="css"><code><span leaf="">singularity run aertslab-pyscenic-<span>0.12</span>.<span>1</span><span>.sif</span> \</span></code><code><span leaf="">pyscenic grn sample<span>.loom</span> allTFs_mm<span>.txt</span> \</span></code><code><span leaf=""><span>--output</span> adj<span>.tsv</span> <span>--num_workers</span> <span>6</span></span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/B5vSXc1CfQx0xaEfnJJSTA",target="_blank" rel="noopener noreferrer">原文链接</a>
