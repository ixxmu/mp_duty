---
title: "PySCENIC å…¨æµç¨‹æŒ‡å—ï¼šï¼šR ä¸ Python è”æ‰‹æå®šï¼"
date: 2025-07-28T16:24:43Z
draft: ["false"]
tags: [
  "fetched",
  "ç”Ÿä¿¡å°åšå£«"
]
categories: ["Acdemic"]
---
PySCENIC å…¨æµç¨‹æŒ‡å—ï¼šï¼šR ä¸ Python è”æ‰‹æå®šï¼ by ç”Ÿä¿¡å°åšå£«
------
<div><section><span leaf="">æœ¬æ–‡ä¸ä»…æ¶µç›–ç¯å¢ƒé…ç½®ã€æ•°æ®å‡†å¤‡ã€PySCENIC ä¸‰æ­¥åˆ†æï¼Œè¿˜è´´å¿ƒæ ‡æ³¨äº†</span><strong data-start="244" data-end="256" data-pm-slice="0 0 []"><span leaf="">å¸¸è§æŠ¥é”™ä¸é¿å‘ç‚¹</span></strong><span leaf="">ï¼Œå…¨æµç¨‹ä¸€æ–‡æ‰“å°½ï¼</span></section><ol><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=2&amp;sn=8525db4aa751b9ee5e701eb7100d7897&amp;scene=21#wechat_redirect" textvalue="pyscenic ä¸‰éƒ¨æ›²ä¹‹å‘½ä»¤è¯¦è§£" data-itemshowtype="0" linktype="text" data-linktype="2">pyscenic ä¸‰éƒ¨æ›²ä¹‹å‘½ä»¤è¯¦è§£</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=1&amp;sn=9f987422f21ad406a78fb0cfd65fd1e0&amp;scene=21#wechat_redirect" textvalue="pyscenic ï¼ˆé™„å…¨æµç¨‹ä»£ç ï¼‰" data-itemshowtype="0" linktype="text" data-linktype="2">pyscenic ï¼ˆé™„å…¨æµç¨‹ä»£ç ï¼‰</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=3&amp;sn=d324a1737c90a55f4cc4ee1a90b7b774&amp;scene=21#wechat_redirect" textvalue="pyscenicå…¨æµç¨‹ï¼ˆjupyterlabï¼‰" data-itemshowtype="0" linktype="text" data-linktype="2">pyscenicå…¨æµç¨‹ï¼ˆjupyterlabï¼‰</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=4&amp;sn=9f235d74097d7e95b4b7277e64a1528c&amp;scene=21#wechat_redirect" textvalue="å•ç»†èƒè½¬å½•å› å­åˆ†æï¼špyscenic" data-itemshowtype="0" linktype="text" data-linktype="2">å•ç»†èƒè½¬å½•å› å­åˆ†æï¼špyscenic</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247489239&amp;idx=5&amp;sn=98b34397a0e16819aad350342c414a47&amp;scene=21#wechat_redirect" textvalue="Rè¯­è¨€ç‰ˆæœ¬pyscenicï¼Œéå¸¸è€—æ—¶ï¼ä¸æ¨è" data-itemshowtype="0" linktype="text" data-linktype="2">Rè¯­è¨€ç‰ˆæœ¬pyscenicï¼Œéå¸¸è€—æ—¶ï¼ä¸æ¨è</a></span></section><section><span leaf=""><br></span></section></li></ol><hr><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">ğŸ§± ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸Rè¯­è¨€æ•°æ®å‡†å¤‡</span></span></section><section><span leaf="">æˆ‘ä»¬å…ˆåœ¨ R ä¸­ä½¿ç”¨Â </span><code data-start="304" data-end="312" data-pm-slice="0 0 []"><span leaf="">Seurat</span></code><span leaf="">Â ç­›é€‰ç›®æ ‡ç»†èƒç¾¤ï¼ˆå¦‚ fibroblast &amp; myofibroblastï¼‰ï¼Œå¹¶å°†è¡¨è¾¾çŸ©é˜µå¯¼å‡ºï¼š</span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span>load</span>(<span>"/home/data/.../subset.Rdata"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># å¯è§†åŒ–æ ‡è®°ç»†èƒ</span></span></code><code><span leaf=""><span>DimPlot</span>(subset_data2, label =Â <span>TRUE</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># å°† count çŸ©é˜µå¯¼å‡ºä¸º csv æ–‡ä»¶ï¼ˆæ³¨æ„è½¬ç½®ï¼ï¼ï¼‰</span></span></code><code><span leaf="">write.<span>csv</span>(</span></code><code><span leaf="">Â Â <span>t</span>(<span>as</span>.<span>matrix</span>(subset_data2@assays<span>$RNA</span>@counts)),</span></code><code><span leaf="">Â  file =Â <span>"/.../fibo_1000.csv"</span></span></code><code><span leaf="">)</span></code><code><span leaf=""><br></span></code></pre></section><blockquote><p><span leaf="">ğŸ’¡ æç¤ºï¼šPySCENIC è¦æ±‚è¡Œä¸ºç»†èƒã€åˆ—ä¸ºåŸºå› ï¼Œå› æ­¤å¿…é¡»è½¬ç½®ï¼</span></p></blockquote><section><span leaf=""><br></span></section><h2 data-start="621" data-end="655" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">âš™ï¸ äºŒã€åˆ›å»º Python ç¯å¢ƒå¹¶æ³¨å†Œ Jupyter å†…æ ¸</span></span></h2><p data-start="657" data-end="708"><span leaf="">åœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»º PySCENIC ä¸“å±ç¯å¢ƒï¼Œå¹¶åœ¨ Jupyter Notebook ä¸­æ³¨å†Œï¼š</span></p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>conda</span>Â create -n pyscenic python=<span>3</span>.<span>10</span></span></code><code><span leaf=""><span>conda</span>Â activate pyscenic</span></code><code><span leaf=""><span>pip</span>Â install pyscenic</span></code><code><span leaf=""><span>conda</span>Â install ipykernel</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span>python</span>Â -m ipykernel install --user --name pyscenic --display-nameÂ <span>"pyscenic"</span></span></code><code><span leaf=""><br></span></code></pre></section><h2 data-start="1003" data-end="1018" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">ğŸ“‚ ä¸‰ã€å®‰è£…ä¾èµ–å·¥å…·åŒ…</span></span></h2><p data-start="1020" data-end="1053"><span leaf="">PySCENIC éœ€è¦Â </span><code data-start="1032" data-end="1040"><span leaf="">loompy</span></code><span leaf="">ã€</span><code data-start="1041" data-end="1049"><span leaf="">scanpy</span></code><span leaf="">Â ç­‰åŒ…ï¼š</span></p><section><ul><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>pip</span>Â install loompy scanpy</span></code><code><span leaf=""><span>pip</span>Â install numpy==<span>1</span>.<span>22</span>Â pandas==<span>1</span>.<span>5</span>.<span>3</span></span></code></pre></section><section><span leaf="">âš ï¸ numpy ä¸ numba ç‰ˆæœ¬éœ€åŒ¹é…ï¼Œå¼ºçƒˆå»ºè®®å›ºå®šÂ </span><code data-start="1162" data-end="1175" data-pm-slice="0 0 []"><span leaf="">numpy==1.22</span></code><span leaf="">ï¼</span></section><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">ğŸ§¬ å››ã€å°† CSV è½¬æ¢ä¸º LOOM æ ¼å¼</span></span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span leaf=""><span>import</span>Â scanpyÂ <span>as</span>Â sc</span></code><code><span leaf=""><span>import</span>Â loompyÂ <span>as</span>Â lp</span></code><code><span leaf=""><span>import</span>Â numpyÂ <span>as</span>Â np</span></code><code><span leaf=""><br></span></code><code><span leaf="">x = sc.read_csv(<span>"./fibo_1000.csv"</span>) Â <span># è¯»å– R ä¸­å¯¼å‡ºçš„è¡¨è¾¾çŸ©é˜µ</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">row_attrs = {<span>"Gene"</span>: np.array(x.var_names)}</span></code><code><span leaf="">col_attrs = {<span>"CellID"</span>: np.array(x.obs_names)}</span></code><code><span leaf=""><br></span></code><code><span leaf="">lp.create(<span>"sample.loom"</span>, x.X.T, row_attrs, col_attrs)</span></code><code><span leaf=""><br></span></code></pre></section><section><span leaf=""><span textstyle="">ğŸ§  äº”ã€PySCENIC ä¸‰æ­¥èµ°ï¼</span></span></section><section><span leaf=""><span textstyle="">ğŸ”¹ Step 1ï¼šæ„å»ºåŸºå› è°ƒæ§ç½‘ç»œï¼ˆGRNï¼‰</span></span></section><section><ul><li><li><li><li><li></ul><pre data-lang="css"><code><span leaf="">pyscenic grn sample<span>.loom</span>Â allTFs_mm<span>.txt</span>Â \</span></code><code><span leaf=""><span>--num_workers</span>Â <span>40</span>Â \</span></code><code><span leaf=""><span>--output</span>Â adj<span>.sample.tsv</span>Â \</span></code><code><span leaf=""><span>--method</span>Â grnboost2</span></code><code><span leaf=""><br></span></code></pre></section><section><span leaf="">ğŸ“Œ allTFs_mm.txt æ˜¯è½¬å½•å› å­åˆ—è¡¨ï¼Œå¯ä»å®˜æ–¹æ•°æ®åº“ä¸‹è½½æˆ–è‡ªå»ºã€‚</span></section><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">ğŸ”¹ Step 2ï¼šå¯Œé›† motif åŒ¹é…ï¼ˆctxï¼‰</span></span></section><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="css"><code><span leaf="">pyscenic ctx adj<span>.sample.tsv</span>Â \</span></code><code><span leaf="">/path/<span>to</span>/mm10<span>.genes_vs_motifs.rankings.feather</span>Â \</span></code><code><span leaf=""><span>--annotations_fname</span>Â /path/<span>to</span>/motifs<span>.tbl</span>Â \</span></code><code><span leaf=""><span>--expression_mtx_fname</span>Â sample<span>.loom</span>Â \</span></code><code><span leaf=""><span>--output</span>Â reg<span>.csv</span>Â \</span></code><code><span leaf=""><span>--mode</span>Â "dask_multiprocessing" \</span></code><code><span leaf=""><span>--num_workers</span>Â <span>40</span>Â \</span></code><code><span leaf=""><span>--mask_dropouts</span></span></code><code><span leaf=""><br></span></code></pre></section><section><span leaf="">ğŸ§  è¯¥æ­¥éª¤å°† motif åŒ¹é…ä¿¡æ¯ä¸è°ƒæ§ç½‘ç»œæ•´åˆï¼Œç”ŸæˆÂ </span><code data-start="2026" data-end="2036" data-pm-slice="0 0 []"><span leaf="">regulons</span></code><span leaf="">ã€‚</span></section><section><span leaf=""><br></span></section><section><span leaf=""><span textstyle="">ğŸ”¹ Step 3ï¼šAUCell æ‰“åˆ†ï¼Œè¯„ä¼° regulon æ´»æ€§</span></span></section><section><ul><li><li><li><li></ul><pre data-lang="css"><code><span leaf="">pyscenic aucell sample<span>.loom</span>Â reg<span>.csv</span>Â \</span></code><code><span leaf=""><span>--output</span>Â sample_SCENIC<span>.loom</span>Â \</span></code><code><span leaf=""><span>--num_workers</span>Â <span>3</span></span></code><code><span leaf=""><br></span></code></pre></section><section><span leaf="">âœ¨ å¾—åˆ°çš„Â </span><code data-start="2186" data-end="2193" data-pm-slice="0 0 []"><span leaf="">.loom</span></code><span leaf="">Â æ–‡ä»¶å¯ç”¨äº regulon æ‰“åˆ†ã€tSNE/UMAP å¯è§†åŒ–ç­‰åç»­åˆ†æã€‚</span></section><h2 data-start="2237" data-end="2256" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">ğŸ§© å…­ã€å¸¸è§æŠ¥é”™ &amp; é¿å‘æé†’</span></span></h2><table><thead><tr><th><section><span leaf="">é—®é¢˜</span></section></th><th><section><span leaf="">è§£å†³æ–¹æ¡ˆ</span></section></th></tr></thead><tbody><tr><td><code data-start="2294" data-end="2323"><span leaf="">SyntaxError: invalid syntax</span></code></td><td><section><span leaf="">Jupyter è¿è¡Œ shell å‘½ä»¤è¦åŠ Â </span><code data-start="2348" data-end="2351"><span leaf="">!</span></code></section></td></tr><tr><td><code data-start="2356" data-end="2385"><span leaf="">pyscenic: command not found</span></code></td><td><section><span leaf="">æ·»åŠ ç¯å¢ƒè·¯å¾„æˆ–ä½¿ç”¨Â </span><code data-start="2398" data-end="2411"><span leaf="">os.system()</span></code></section></td></tr><tr><td><code data-start="2416" data-end="2427"><span leaf="">numpy ä¸å…¼å®¹</span></code></td><td><section><span leaf="">å®‰è£…Â </span><code data-start="2433" data-end="2446"><span leaf="">numpy==1.22</span></code><span leaf="">Â ä¸ numba åŒ¹é…</span></section></td></tr><tr><td><code data-start="2462" data-end="2474"><span leaf="">loompy æ‰¾ä¸åˆ°</span></code></td><td><code data-start="2477" data-end="2500"><span leaf="">pip install loompy -U</span></code><section><span leaf="">Â åé‡å¯ç¯å¢ƒ</span></section></td></tr><tr><td><section><span leaf="">è·¯å¾„é”™è¯¯ï¼ˆSingularityï¼‰</span></section></td><td><section><span leaf="">æ£€æŸ¥Â </span><code data-start="2534" data-end="2540"><span leaf="">.sif</span></code><span leaf="">Â æ–‡ä»¶æ˜¯å¦çœŸå®å­˜åœ¨</span></section></td></tr></tbody></table><section><span leaf=""><br></span></section><section><span leaf="">ğŸ ä¸ƒã€è¿›é˜¶ç”¨æ³•ï¼šSingularityé•œåƒè¿è¡Œï¼ˆHPC æ¨èï¼‰</span></section><section><ul><li><li><li></ul><pre data-lang="css"><code><span leaf="">singularity run aertslab-pyscenic-<span>0.12</span>.<span>1</span><span>.sif</span>Â \</span></code><code><span leaf="">pyscenic grn sample<span>.loom</span>Â allTFs_mm<span>.txt</span>Â \</span></code><code><span leaf=""><span>--output</span>Â adj<span>.tsv</span>Â <span>--num_workers</span>Â <span>6</span></span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/B5vSXc1CfQx0xaEfnJJSTA",target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a>
