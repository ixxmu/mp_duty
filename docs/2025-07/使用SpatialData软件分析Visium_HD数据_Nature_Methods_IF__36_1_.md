---
title: "使用SpatialData软件分析Visium HD数据（Nature Methods，IF: 36.1）"
date: 2025-07-20T15:33:29Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
使用SpatialData软件分析Visium HD数据（Nature Methods，IF: 36.1） by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><blockquote><p><span leaf="">今天学习一下Visum HD高分辨率平台使用比较多的分析框架 SpatialData 软件，于<span textstyle="">2024年3月20号</span>发表在Nature Methods杂志上，文献标题为<span textstyle="">《SpatialData: an open and universal data framework for spatial omics》</span>。</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">SpatialData 建立了一个统一且可扩展的多平台文件格式，支持大于内存的数据的惰性表示，以及转换和对齐到通用坐标系。SpatialData便于进行空间注释以及跨模态的聚合和分析，其效用在多个案例中得到了展示，包括在一个多模态Xenium和Visium乳腺癌研究中的整合分析。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkr771QrDicAkFUPpicZ3FmpdXnf9mllg07iaLSZ2mopYj68ibqZpe8uxSIQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8731481481481481" data-type="png" data-w="1080" data-imgfileid="100060711" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkr771QrDicAkFUPpicZ3FmpdXnf9mllg07iaLSZ2mopYj68ibqZpe8uxSIQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">SpatialData格式支持所有主要的空间组学技术和衍生量（图1a、c，补充注释2和补充表2）。简而言之，空间数据集通过五个基本元素来表示：图像（栅格图像）、标签（例如，栅格分割掩码）、点（例如，分子探针）、形状（例如，多边形感兴趣区域、阵列捕获位置等）和表格（例如，分子定量和注释）。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkDM5Aln7n5la2UUChgyzS92gKd7YKeFQs9NicgsBtmGd79n0434K4uhA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.47314814814814815" data-type="png" data-w="1080" data-imgfileid="100060710" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkDM5Aln7n5la2UUChgyzS92gKd7YKeFQs9NicgsBtmGd79n0434K4uhA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">spatialdata框架主要包括3个工具</span>：</span></p><ul><li><section><p><span leaf=""><span textstyle="">spatialdata-io</span>: 将常见空间组学技术中的数据加载生成spatialdata object；</span></p></section></li><li><section><p><span leaf=""><span textstyle="">spatialdata-plot</span>: spatialdata的静态绘图库；</span></p></section></li><li><section><p><span leaf=""><span textstyle="">napari-spatialdata-repo</span>: napari插件，用于spatialdata的交互式探索和注释。</span></p></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">网址：</span></p><blockquote><p><span leaf="">Documentation: https://spatialdata.scverse.org</span></p><p><span leaf="">Installation instructions: https://spatialdata.scverse.org/en/latest/installation.html</span></p><p><span leaf="">Tutorials: https://spatialdata.scverse.org/en/latest/tutorials/notebooks/notebooks.html</span></p></blockquote><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">支持的空转平台：</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">ref：https://github.com/scverse/spatialdata-io</span></p><ul><li><section><span leaf="">10x Genomics Visium®</span></section></li><li><section><span leaf="">10x Genomics Visium HD®</span></section></li><li><section><span leaf="">10x Genomics Xenium®</span></section></li><li><section><span leaf="">Akoya PhenoCycler® (formerly CODEX®)</span></section></li><li><section><span leaf="">Curio Seeker®</span></section></li><li><section><span leaf="">DBiT-seq</span></section></li><li><section><span leaf="">MCMICRO (output data)</span></section></li><li><section><span leaf="">NanoString CosMx®</span></section></li><li><section><span leaf="">Spatial Genomics GenePS® (seqFISH)</span></section></li><li><section><span leaf="">Steinbock (output data)</span></section></li><li><section><span leaf="">STOmics Stereo-seq®</span></section></li><li><section><span leaf="">Vizgen MERSCOPE® (MERFISH)</span></section></li><li><section><span leaf="">MACSima® (MACS® iQ View output)</span></section></li></ul><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">环境配置</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">软件官网：https://spatialdata.scverse.org/en/stable/</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf=""># 创建一个空转数据分析环境</span></span><span leaf=""><br></span><span leaf="">conda create -n spatial -y python=3.10</span><span leaf=""><br></span><span leaf="">conda activate spatial </span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 参考 https://mp.weixin.qq.com/s/nSVmbFdua8fQIpnVqTwMvA</span></span><span leaf=""><br></span><span><span leaf=""># 官方代码(国内下载较慢，暂不使用，还是用镜像站)</span></span><span leaf=""><br></span><span><span leaf=""># pip install spatialdata</span></span><span leaf=""><br></span><span><span leaf=""># pip install "spatialdata[extra]"</span></span><span leaf=""><br></span><span><span leaf=""># pip install "spatialdata[torch]"</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 这里安装github上的最新版，不然读取数据会报错</span></span><span leaf=""><br></span><span><span leaf=""># 安装git</span></span><span leaf=""><br></span><span><span leaf=""># conda install -y git</span></span><span leaf=""><br></span><span><span leaf=""># GitHub上下载下来软件包：https://github.com/scverse/spatialdata</span></span><span leaf=""><br></span><span><span leaf=""># cd spatialdata-main/</span></span><span leaf=""><br></span><span><span leaf=""># pip install git+https://github.com/scverse/spatialdata</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">conda install -y spatialdata=0.4.0 </span><span><span leaf=""># 最新版</span></span><span leaf=""><br></span><span leaf="">pip install -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple jupyterlab</span><span leaf=""><br></span><span><span leaf=""># https://pypi.org/project/spatialdata-io/</span></span><span leaf=""><br></span><span leaf="">pip install spatialdata-io -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</span><span leaf=""><br></span></code></pre><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">数据下载</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">示例数据：https://www.10xgenomics.com/products/visium-hd-spatial-gene-expression/dataset-human-crc</span></p><p data-tool="mdnice编辑器"><span leaf="">这个数据是10x genomics公司最早测的一批，相关的文章已经正式发表：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247543214&amp;idx=1&amp;sn=725d0564af1d0d59b1c7880e9c92593b&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">最新Visium HD数据发表在Nature Genetics杂志（IF=31.7）：GSE280315</a></span></p><p data-tool="mdnice编辑器"><span leaf="">Space Ranger输出文件结构参考官网：</span></p><blockquote><p><span leaf="">https://www.10xgenomics.com/support/software/space-ranger/latest/analysis/outputs/output-overview</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">总共有5个样本，数据太大了，我们这次只下载其中一个样本看看，如果网速不好各位就要想点办法去下载下来了。</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf=""># Human_Colon_Cancer_P2</span></span><span leaf=""><br></span><span><span leaf=""># Output Files</span></span><span leaf=""><br></span><span leaf="">wget https://cf.10xgenomics.com/samples/spatial-exp/3.0.0/Visium_HD_Human_Colon_Cancer_P2/Visium_HD_Human_Colon_Cancer_P2_binned_outputs.tar.gz</span><span leaf=""><br></span><span leaf="">wget https://cf.10xgenomics.com/samples/spatial-exp/3.0.0/Visium_HD_Human_Colon_Cancer_P2/Visium_HD_Human_Colon_Cancer_P2_spatial.tar.gz</span><span leaf=""><br></span><span leaf="">wget https://cf.10xgenomics.com/samples/spatial-exp/3.0.0/Visium_HD_Human_Colon_Cancer_P2/Visium_HD_Human_Colon_Cancer_P2_molecule_info.h5</span><span leaf=""><br></span><span leaf="">wget https://cf.10xgenomics.com/samples/spatial-exp/3.0.0/Visium_HD_Human_Colon_Cancer_P2/Visium_HD_Human_Colon_Cancer_P2_cloupe_008um.cloupe</span><span leaf=""><br></span><span leaf="">wget https://cf.10xgenomics.com/samples/spatial-exp/3.0.0/Visium_HD_Human_Colon_Cancer_P2/Visium_HD_Human_Colon_Cancer_P2_feature_slice.h5</span><span leaf=""><br></span><span leaf="">wget https://cf.10xgenomics.com/samples/spatial-exp/3.0.0/Visium_HD_Human_Colon_Cancer_P2/Visium_HD_Human_Colon_Cancer_P2_metrics_summary.csv</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">然后整理成下面的格式：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">Human_Colon_Cancer_P2</span><span leaf=""><br></span><span leaf="">├── binned_outputs</span><span leaf=""><br></span><span leaf="">├── P2_feature_slice.h5</span><span leaf=""><br></span><span leaf="">├── spatial</span><span leaf=""><br></span><span leaf="">└── web_summary.html</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">bin目录如下：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkKDJG1vibS5aepaPTUibtfL87pUfXV7bqCtwhg5G7NibyF4bwZS9iaDccqA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.9308437067773168" data-type="png" data-w="723" data-imgfileid="100060707" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkKDJG1vibS5aepaPTUibtfL87pUfXV7bqCtwhg5G7NibyF4bwZS9iaDccqA/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">读取数据</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">这里破费了一番功夫，<span textstyle="">记住上面的软件要安装最新的</span>，不然就会报错。</span></p><p data-tool="mdnice编辑器"><span leaf="">首先导入相关模块：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf="">import</span></span><span leaf=""> os</span><span leaf=""><br></span><span><span leaf="">import</span></span><span leaf=""> anndata</span><span leaf=""><br></span><span><span leaf="">import</span></span><span leaf=""> numpy </span><span><span leaf="">as</span></span><span leaf=""> np</span><span leaf=""><br></span><span><span leaf="">import</span></span><span leaf=""> scanpy </span><span><span leaf="">as</span></span><span leaf=""> sc</span><span leaf=""><br></span><span><span leaf="">from</span></span><span leaf=""> spatialdata_io </span><span><span leaf="">import</span></span><span leaf=""> visium_hd</span><span leaf=""><br></span><span><span leaf="">import</span></span><span leaf=""> matplotlib.pyplot </span><span><span leaf="">as</span></span><span leaf=""> plt</span><span leaf=""><br></span><span><span leaf="">from</span></span><span leaf=""> matplotlib.pyplot </span><span><span leaf="">import</span></span><span leaf=""> rc_context</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">接着使用 spatialdata_io的函数 读取 Visum HD数据</span></p><p data-tool="mdnice编辑器"><span leaf="">函数参考：https://spatialdata.scverse.org/projects/io/en/latest/generated/spatialdata_io.visium_hd.html#spatialdata_io.visium_hd</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">sdata = visium_hd(path=</span><span><span leaf="">"0.Data_Download/Human_Colon_Cancer_P2/"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">      </span><span><span leaf="">#dataset_id="P2_CRC", </span></span><span leaf=""><br></span><span leaf="">      bin_size=8, </span><span leaf=""><br></span><span leaf="">      load_all_images=True, </span><span leaf=""><br></span><span leaf="">      fullres_image_file=None</span><span leaf=""><br></span><span leaf="">      )</span><span leaf=""><br></span><span leaf="">sdata</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">成功了，流泪狂喜：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100060709" data-ratio="0.43425925925925923" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkTlD7Szp3fkTI4pXHa0y41dXM4bibw0A9CtabpnfIykoyR6BPyCwxvhw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkTlD7Szp3fkTI4pXHa0y41dXM4bibw0A9CtabpnfIykoyR6BPyCwxvhw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">这个数据结构还得去花点时间学习了！</span></p><p data-tool="mdnice编辑器"><span leaf="">把 8um 的结果提取出来进行后面的分析：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">adata = sdata.tables[</span><span><span leaf="">'square_008um'</span></span><span leaf="">]</span><span leaf=""><br></span><span leaf="">adata</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkG9Xw9rKTfE1v3bm2p3f80iaN4X4R9NGU4N4ictwAOejOib8iaaAf785RJg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.27423167848699764" data-type="png" data-w="846" data-imgfileid="100060708" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBkG9Xw9rKTfE1v3bm2p3f80iaN4X4R9NGU4N4ictwAOejOib8iaaAf785RJg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">现在已经是标准的anndata对象了，大家应该非常熟悉~</span></p><p data-tool="mdnice编辑器"><span leaf="">添加样本信息：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">adata.obs[</span><span><span leaf="">'sample'</span></span><span leaf="">] = </span><span><span leaf="">"P2_CRC"</span></span><span leaf=""><br></span><span leaf="">adata.var_names_make_unique()</span><span leaf=""><br></span><span leaf="">adata.obs</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBk9DqgNKwzJ3MwRibakrAGtkkCtSVCZvKQlWGkNmJm3LeH53055ibkIFPg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5074626865671642" data-type="png" data-w="1072" data-imgfileid="100060716" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyO1xspiayUKqyFvpbnhIPBk9DqgNKwzJ3MwRibakrAGtkkCtSVCZvKQlWGkNmJm3LeH53055ibkIFPg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">本次分享到这（续~）</span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><h4 data-tool="mdnice编辑器"><span leaf="">文末友情宣传</span></h4><p data-tool="mdnice编辑器"><span leaf="">强烈建议你推荐给身边的</span><strong><span leaf="">博士后以及年轻生物学PI</span></strong><span leaf="">，多一点数据认知，让他们的科研上一个台阶：</span></p><ul></ul></section><ul><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247544311&amp;idx=1&amp;sn=d41b5838e799f52280e78703135bb603&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课8月班" data-itemshowtype="0" linktype="text" data-linktype="2">生信入门&amp;数据挖掘线上直播课8月班</a><span textstyle="">，你的生物信息学入门课</span></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525079&amp;idx=1&amp;sn=0b997af16a58195b4192691373048fd5&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" textvalue="满足你生信分析计算需求的低价解决方案" data-itemshowtype="0" linktype="text" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=1679199708449144836&amp;scene=173&amp;subscene=207&amp;sessionid=1745492310&amp;enterid=1745492314&amp;from_msgid=2247541298&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信故事会" data-itemshowtype="0" linktype="text" data-linktype="2">生信故事会</a>，来看看他们的生信入门故事</span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=3690970204957147140&amp;scene=173&amp;subscene=207&amp;sessionid=1745066271&amp;enterid=1745066274&amp;from_msgid=2247540702&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信马拉松答疑专辑" data-itemshowtype="0" linktype="text" data-linktype="2">生信马拉松答疑专辑</a>，获取你的生信专属答疑</span></section></li></ul><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Aai8ygozP-zCtxqIgLZf0g",target="_blank" rel="noopener noreferrer">原文链接</a>
