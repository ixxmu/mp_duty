---
title: "数据准备篇 | 利用三元图来阐释细胞亚群的功能分布（杀伤or耗竭or调节)"
date: 2025-07-24T12:06:08Z
draft: ["false"]
tags: [
  "fetched",
  "生信作曲家"
]
categories: ["Acdemic"]
---
数据准备篇 | 利用三元图来阐释细胞亚群的功能分布（杀伤or耗竭or调节) by 生信作曲家
------
<div><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaCozlciapViazFwsheN5FpWR4zDN1LVmIOqyRl8lIDAUDNFuuBTibhz8KpnAnJib4HHV1Rslib2QTnpgog/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.47474747474747475" data-s="300,640" data-type="png" data-w="1287" type="block" data-imgfileid="100007432" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaCozlciapViazFwsheN5FpWR4zDN1LVmIOqyRl8lIDAUDNFuuBTibhz8KpnAnJib4HHV1Rslib2QTnpgog/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf="">关注作曲家，学习更多实用可视化</span></section><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="生信作曲家" data-alias="Bioinfo_composer" data-from="0" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaDQIG3BiaPDOAtTJDzqbyPp4crVHnib8fS6Gp6DMjvJJkK9bhPWe6wpNujV93n60FymcjAOfum0t9PA/0?wx_fmt=png" data-signature="交流生物信息学习经验，分享科研SCI撰写思路和规范，传递最新生物医药资讯。" data-id="MzI5ODI0NzM2OQ==" data-is_biz_ban="0" data-service_type="1" data-verify_status="0"></mp-common-profile></section><section><section><span leaf=""><br></span></section><section data-pm-slice="3 2 []"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf="">上一篇我们学习了一篇1区文字的这个图（右边），这个图将每种T细胞亚型做了杀伤、耗竭、调节（免疫抑制）三个评分的分布（三元图）</span></p><blockquote><section><p><span leaf="">可视化篇</span></p></section><section data-json="%7B%22type%22%3A%22inner%22%2C%22article%22%3A%7B%22title%22%3A%22%E5%88%A9%E7%94%A8%E4%B8%89%E5%85%83%E5%9B%BE%E6%9D%A5%E9%98%90%E9%87%8A%E7%BB%86%E8%83%9E%E4%BA%9A%E7%BE%A4%E7%9A%84%E5%8A%9F%E8%83%BD%E5%88%86%E5%B8%83%EF%BC%88%E6%9D%80%E4%BC%A4or%E8%80%97%E7%AB%ADor%E8%B0%83%E8%8A%82)%EF%BC%8C%E4%BD%A0%E5%AD%A6%E4%BC%9A%E4%BA%86%E5%90%97%EF%BC%9F%22%2C%22url%22%3A%22http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI5ODI0NzM2OQ%3D%3D%26mid%3D2247491126%26idx%3D1%26sn%3Dc7b432d9cb2d6d113df1b87acd2e9687%26chksm%3Deca9eb90dbde628618e84be8b0aef363fea4951ee903eda4354672e69032f9b0d8060aac6f44%23rd%22%2C%22nickname%22%3A%22%E7%94%9F%E4%BF%A1%E4%BD%9C%E6%9B%B2%E5%AE%B6%22%2C%22authorName%22%3A%22Bioinfo%20composer%22%7D%7D"><span>Bioinfo composer，公众号：生信作曲家<a href="http://mp.weixin.qq.com/s?__biz=MzI5ODI0NzM2OQ==&amp;mid=2247491126&amp;idx=1&amp;sn=c7b432d9cb2d6d113df1b87acd2e9687&amp;chksm=eca9eb90dbde628618e84be8b0aef363fea4951ee903eda4354672e69032f9b0d8060aac6f44#rd">利用三元图来阐释细胞亚群的功能分布（杀伤or耗竭or调节)，你学会了吗？</a></span></section></blockquote><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aF2I27ibJ0CmZpBjw2onTLIAIVFOxYNnpfunKBkZiavaANgWibKMsfUDOwg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.4685073339085418" data-type="png" data-w="1159" data-imgfileid="100007504" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aF2I27ibJ0CmZpBjw2onTLIAIVFOxYNnpfunKBkZiavaANgWibKMsfUDOwg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">很多同学向我们提出了问题，说数据表应该怎么准备呢？</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFPuK6icFWQkibwl8XicamOt0o9eRzYjMcCNayQGP5PbPOvGnJwYurFMDoA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6260017809439002" data-type="png" data-w="1123" data-imgfileid="100007502" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFPuK6icFWQkibwl8XicamOt0o9eRzYjMcCNayQGP5PbPOvGnJwYurFMDoA/640?wx_fmt=png&amp;from=appmsg"></span></figure></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aF52dH61HM7IF12hicYORcUicibQSrp2QdicU91RUahIMZUcA3liafZibJPI9w/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6280400572246065" data-s="300,640" data-type="png" data-w="699" type="block" data-imgfileid="100007509" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aF52dH61HM7IF12hicYORcUicibQSrp2QdicU91RUahIMZUcA3liafZibJPI9w/640?wx_fmt=png&amp;from=appmsg"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><figure data-tool="mdnice编辑器"><span leaf=""><br></span></figure><p data-tool="mdnice编辑器"><span leaf="">这也提示我们进一步需要对大家的单细胞分析基础予以较好的巩固！实际上，这涉及到了我们的</span><strong><span leaf="">单细胞评分</span></strong><span leaf="">，是比较常规的一个操作。</span></p><p data-tool="mdnice编辑器"><span leaf="">首先这篇文章的来源也是很多同学关心的，其实经常关注我们公众号的同学就会知道我们实际上推送过这篇文章！</span></p><blockquote><section><p><span leaf="">来源文献！</span></p></section><section data-json="%7B%22type%22%3A%22inner%22%2C%22article%22%3A%7B%22title%22%3A%22%E4%B8%80%E5%9B%BE%E6%80%BB%E7%BB%93%E7%B3%BB%E5%88%97%EF%BC%88B)%20%7C%20%E5%A4%9A%E7%81%B6%E6%80%A7%E8%86%80%E8%83%B1%E7%99%8C%E5%8D%95%E7%BB%86%E8%83%9E%E8%A7%A3%E6%9E%90%EF%BC%8C%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B8%8D%E9%94%99%E7%9A%84%E4%B8%80%E5%8C%BA%E6%9D%82%E5%BF%97%22%2C%22url%22%3A%22http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI5ODI0NzM2OQ%3D%3D%26mid%3D2247491096%26idx%3D1%26sn%3D1a4e0e2f59295d9fff1d92058ab954ff%26chksm%3Deca9ebbedbde62a84a200832f06847c91d3ec394fac5578918443195b840790cf42fc2cee9df%23rd%22%2C%22nickname%22%3A%22%E7%94%9F%E4%BF%A1%E4%BD%9C%E6%9B%B2%E5%AE%B6%22%2C%22authorName%22%3A%22Bioinfo%20composer%22%7D%7D"><span>Bioinfo composer，公众号：生信作曲家<a href="http://mp.weixin.qq.com/s?__biz=MzI5ODI0NzM2OQ==&amp;mid=2247491096&amp;idx=1&amp;sn=1a4e0e2f59295d9fff1d92058ab954ff&amp;chksm=eca9ebbedbde62a84a200832f06847c91d3ec394fac5578918443195b840790cf42fc2cee9df#rd">一图总结系列（B) | 多灶性膀胱癌单细胞解析，可视化不错的一区杂志</a></span></section></blockquote><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">实操</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">这篇文章的附表部分实际上已经为我们提供了三个功能方向的基因集！</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFjpoeibWQiaiay1fDVPicTsNrrDsNKobIjGiaGCAxEePKTbbTQB5TibnmPVUw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.9491133384734002" data-type="png" data-w="1297" data-imgfileid="100007505" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFjpoeibWQiaiay1fDVPicTsNrrDsNKobIjGiaGCAxEePKTbbTQB5TibnmPVUw/640?wx_fmt=png&amp;from=appmsg"></span></figure><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFRDbM8ibyicVxE9lCXrUWtvP4NVzjoicLfhlDibfby7V95cOMBHNsicIVhug/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.139697322467986" data-type="png" data-w="859" data-imgfileid="100007501" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFRDbM8ibyicVxE9lCXrUWtvP4NVzjoicLfhlDibfby7V95cOMBHNsicIVhug/640?wx_fmt=png&amp;from=appmsg"></span></figure><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">scRNAsub=readRDS(</span><span><span leaf="">'./scRNA_T.RDS'</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">cytotoxic_genes &lt;- c(</span><span leaf=""><br></span><span><span leaf="">"PRF1"</span></span><span leaf="">, </span><span><span leaf="">"IFNG"</span></span><span leaf="">, </span><span><span leaf="">"GNLY"</span></span><span leaf="">, </span><span><span leaf="">"NKG7"</span></span><span leaf="">, </span><span><span leaf="">"GZMB"</span></span><span leaf="">, </span><span><span leaf="">"GZMA"</span></span><span leaf="">, </span><span><span leaf="">"GZMH"</span></span><span leaf="">,</span><span leaf=""><br></span><span><span leaf="">"KLRK1"</span></span><span leaf="">, </span><span><span leaf="">"KLRB1"</span></span><span leaf="">, </span><span><span leaf="">"KLRD1"</span></span><span leaf="">, </span><span><span leaf="">"CTSW"</span></span><span leaf="">, </span><span><span leaf="">"CST7"</span></span><span leaf="">, </span><span><span leaf="">"CCL4"</span></span><span leaf="">, </span><span><span leaf="">"CCL3"</span></span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">exhausted_genes &lt;- c(</span><span leaf=""><br></span><span><span leaf="">"PDCD1"</span></span><span leaf="">, </span><span><span leaf="">"CTLA4"</span></span><span leaf="">, </span><span><span leaf="">"LAG3"</span></span><span leaf="">, </span><span><span leaf="">"HAVCR2"</span></span><span leaf="">, </span><span><span leaf="">"CD244"</span></span><span leaf="">, </span><span><span leaf="">"CD160"</span></span><span leaf="">, </span><span><span leaf="">"TIGIT"</span></span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">regulatory_genes &lt;- c(</span><span leaf=""><br></span><span><span leaf="">"IL2RA"</span></span><span leaf="">, </span><span><span leaf="">"IL1R2"</span></span><span leaf="">, </span><span><span leaf="">"FOXP3"</span></span><span leaf="">, </span><span><span leaf="">"LAYN"</span></span><span leaf="">, </span><span><span leaf="">"TNFRSF9"</span></span><span leaf="">, </span><span><span leaf="">"FANK1"</span></span><span leaf="">,</span><span leaf=""><br></span><span><span leaf="">"RTKN2"</span></span><span leaf="">, </span><span><span leaf="">"IL1R1"</span></span><span leaf="">, </span><span><span leaf="">"CUL9"</span></span><span leaf="">, </span><span><span leaf="">"IKZF2"</span></span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">gene_modules &lt;- list(</span><span leaf=""><br></span><span leaf="">  Cytotoxic = cytotoxic_genes,</span><span leaf=""><br></span><span leaf="">  Exhausted = exhausted_genes,</span><span leaf=""><br></span><span leaf="">  Regulatory = regulatory_genes</span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">scRNAsub=AddModuleScore(scRNAsub,features = gene_modules,name = names(gene_modules))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 提取 metadata</span></span><span leaf=""><br></span><span leaf="">meta &lt;- scRNAsub@meta.data</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 选择需要的列</span></span><span leaf=""><br></span><span leaf="">scores_df &lt;- meta[, c(</span><span><span leaf="">"T_celltype"</span></span><span leaf="">, </span><span><span leaf="">"Cytotoxic1"</span></span><span leaf="">, </span><span><span leaf="">"Exhausted2"</span></span><span leaf="">, </span><span><span leaf="">"Regulatory3"</span></span><span leaf="">)]</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 计算按 T_celltype 分组后的均值矩阵</span></span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(dplyr)</span><span leaf=""><br></span><span leaf="">data &lt;- scores_df %&gt;%</span><span leaf=""><br></span><span leaf="">  group_by(T_celltype) %&gt;%</span><span leaf=""><br></span><span leaf="">  summarise(</span><span leaf=""><br></span><span leaf="">    Cytotoxic1 = mean(Cytotoxic1, na.rm = </span><span><span leaf="">TRUE</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    Exhausted2 = mean(Exhausted2, na.rm = </span><span><span leaf="">TRUE</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    Regulatory3 = mean(Regulatory3, na.rm = </span><span><span leaf="">TRUE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  as.data.frame()</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">colnames(data)=c(</span><span><span leaf="">"T_celltype"</span></span><span leaf="">, </span><span><span leaf="">"Cytotoxic"</span></span><span leaf="">, </span><span><span leaf="">"Exhausted"</span></span><span leaf="">, </span><span><span leaf="">"Regulatory"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFbnib1GWHUNP5b7PFndiaJGTmn0MqNicwH2AKO4bBwnovdrjLGrgZXmMJA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5027262813522355" data-type="png" data-w="917" data-imgfileid="100007503" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFbnib1GWHUNP5b7PFndiaJGTmn0MqNicwH2AKO4bBwnovdrjLGrgZXmMJA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">好了，进一步采用上集进行可视化，我们就获得了如下的图，还是比较精准的！</span></p><blockquote><section><p><span leaf="">上集在这里</span></p></section><section data-json="%7B%22type%22%3A%22inner%22%2C%22article%22%3A%7B%22title%22%3A%22%E5%88%A9%E7%94%A8%E4%B8%89%E5%85%83%E5%9B%BE%E6%9D%A5%E9%98%90%E9%87%8A%E7%BB%86%E8%83%9E%E4%BA%9A%E7%BE%A4%E7%9A%84%E5%8A%9F%E8%83%BD%E5%88%86%E5%B8%83%EF%BC%88%E6%9D%80%E4%BC%A4or%E8%80%97%E7%AB%ADor%E8%B0%83%E8%8A%82)%EF%BC%8C%E4%BD%A0%E5%AD%A6%E4%BC%9A%E4%BA%86%E5%90%97%EF%BC%9F%22%2C%22url%22%3A%22http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI5ODI0NzM2OQ%3D%3D%26mid%3D2247491126%26idx%3D1%26sn%3Dc7b432d9cb2d6d113df1b87acd2e9687%26chksm%3Deca9eb90dbde628618e84be8b0aef363fea4951ee903eda4354672e69032f9b0d8060aac6f44%23rd%22%2C%22nickname%22%3A%22%E7%94%9F%E4%BF%A1%E4%BD%9C%E6%9B%B2%E5%AE%B6%22%2C%22authorName%22%3A%22Bioinfo%20composer%22%7D%7D"><span>Bioinfo composer，公众号：生信作曲家<a href="http://mp.weixin.qq.com/s?__biz=MzI5ODI0NzM2OQ==&amp;mid=2247491126&amp;idx=1&amp;sn=c7b432d9cb2d6d113df1b87acd2e9687&amp;chksm=eca9eb90dbde628618e84be8b0aef363fea4951ee903eda4354672e69032f9b0d8060aac6f44#rd">利用三元图来阐释细胞亚群的功能分布（杀伤or耗竭or调节)，你学会了吗？</a></span></section></blockquote><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFb70C9ZkHrMvfwicv0aiapdQmPM3Lrh8wrgpVTj3QZGlqVR31siapamteg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8272208638956805" data-type="png" data-w="1227" data-imgfileid="100007507" src="https://mmbiz.qpic.cn/mmbiz_png/mo60jlFOtaB7xrUElDibQzST5Y1HlN1aFb70C9ZkHrMvfwicv0aiapdQmPM3Lrh8wrgpVTj3QZGlqVR31siapamteg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">后记</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">如果你存在任何问题，依然可以继续向我们提出！</span></p></section><p data-tool="mdnice编辑器"><span leaf="">加入生信作曲家群聊交流更多 备注加群（回答问题正确后可入群）</span></p><section><span leaf=""><br></span></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/mo60jlFOtaBGpGicRlf1uIRz5z4icMGickywJW7jQIkU4lafb2SfXxTwtD6ia0Twl7EePYmgFGpYULxQ1Ym9GVbKibw/640?wx_fmt=jpeg" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="512" type="block" data-imgfileid="100001321" src="https://mmbiz.qpic.cn/mmbiz_jpg/mo60jlFOtaBGpGicRlf1uIRz5z4icMGickywJW7jQIkU4lafb2SfXxTwtD6ia0Twl7EePYmgFGpYULxQ1Ym9GVbKibw/640?wx_fmt=jpeg"></section></section><p data-tool="mdnice编辑器"><span leaf=""><br></span></p><p data-tool="mdnice编辑器"><span leaf=""><br></span></p></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Ovr1TJad1PoAy13kTEq9Xg",target="_blank" rel="noopener noreferrer">原文链接</a>
