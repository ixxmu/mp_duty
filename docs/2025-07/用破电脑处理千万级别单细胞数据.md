---
title: "用破电脑处理千万级别单细胞数据"
date: 2025-07-24T23:42:35Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
用破电脑处理千万级别单细胞数据 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><blockquote><p><span leaf="">在单细胞转录组学数据分析中，数据量通常非常庞大，动辄数百万个细胞和数千个基因。因此，如何高效地处理这些数据成为了一个关键问题。不同的文件处理方式在内存消耗上有显著差异 </span></p></blockquote><h3 data-tool="mdnice编辑器"><span><span leaf="">1. </span><strong><span leaf="">R 中的 Seurat</span></strong></span></h3><ul><li><section><strong><span leaf="">内存消耗</span></strong><span leaf="">：Seurat 是 R 中一个非常流行的单细胞数据分析包。它将单细胞表达量矩阵加载到内存中，以便进行后续的分析，如降维、聚类和分群。Seurat 的内存消耗相对较高，尤其是在处理大规模数据集时。例如，一个包含数百万个细胞的数据集可能会占用数 GB 的内存。</span></section></li><li><section><strong><span leaf="">工作原理</span></strong><span leaf="">：Seurat 将数据加载到内存中，类似于在 Excel 中打开一个大型文件。这种处理方式的优点是操作方便，可以快速进行复杂的数据操作，但缺点是内存消耗大，如果数据集过大，可能会导致计算机死机。</span></section></li><li><section><strong><span leaf="">适用场景</span></strong><span leaf="">：适用于数据集较小或计算机内存充足的情况。通常建议内存32G以上，或者直接服务器里面操作。</span></section></li></ul><h3 data-tool="mdnice编辑器"><span><span leaf="">2. </span><strong><span leaf="">Python 中的 AnnData</span></strong></span></h3><ul><li><section><strong><span leaf="">内存消耗</span></strong><span leaf="">：AnnData 是 Python 中一个用于存储和处理单细胞数据的库。</span><strong><span leaf="">它同样需要将单细胞表达量矩阵加载到内存中</span></strong><span leaf="">，但相比 Seurat，AnnData 在后续的降维、聚类和分群等操作中内存消耗稍低。尽管如此，处理大规模数据集时仍需要较大的内存。</span></section></li><li><section><strong><span leaf="">工作原理</span></strong><span leaf="">：AnnData 通过优化数据存储结构和高效的数据操作方法，减少了内存的使用。</span></section></li><li><section><strong><span leaf="">适用场景</span></strong><span leaf="">：适用于数据集较大但内存有限的情况，尤其是需要进行复杂分析时。</span></section></li></ul><h3 data-tool="mdnice编辑器"><span><span leaf="">3. </span><strong><span leaf="">命令行工具（如 grep）</span></strong></span></h3><ul><li><section><strong><span leaf="">内存消耗</span></strong><span leaf="">：命令行工具如 </span><code><span leaf="">grep</span></code><span leaf="">用于在文本文件中搜索特定内容，无需将整个文件加载到内存中。这种处理方式的内存消耗极低，几乎不受文件大小的限制。</span></section></li><li><section><strong><span leaf="">工作原理</span></strong><span leaf="">：</span><code><span leaf="">grep</span></code><span leaf="">命令逐行读取文件内容，只将匹配的行加载到内存中，因此即使文件非常大，也不会占用大量内存。这种处理方式的优点是内存效率高，缺点是操作相对复杂，需要一定的命令行操作技能。</span></section></li><li><section><strong><span leaf="">适用场景</span></strong><span leaf="">：适用于需要快速搜索文本文件中的特定内容，尤其是文件非常大时。</span></section></li></ul><h3 data-tool="mdnice编辑器"><span><span leaf="">如何在Python 中的 AnnData基础上面更加的节省内存呢？</span></span></h3><p data-tool="mdnice编辑器"><span leaf="">嘿，科研小伙伴们！今天要给大家介绍一个超级厉害的“科研神器”——AnnSQL！这可不是普通的工具哦，<span textstyle="">它简直就是单细胞数据处理界的“魔法师”，能帮你轻松搞定那些复杂得让人头大的数据，而且还不用担心电脑会“罢工”。听起来是不是很酷？别急，精彩还在后面呢！</span></span></p><p data-tool="mdnice编辑器"><span leaf="">先来说说这个 AnnSQL 是啥来头。它是一个基于 Python 的包，专门用来处理单细胞转录组数据的。你可能会问：“那这和别的工具有什么不一样呢？”别急，这就给你揭晓！首先，AnnSQL 可以把那些复杂的 AnnData 对象变成 SQL 数据库，这样一来，你就可以用 SQL 语句来查询和分析数据了。这就好比你有了一个“数据翻译官”，能帮你把那些难懂的数据变成你想要的样子。而且，它不仅能处理小数据集，还能搞定那些超大的数据集，甚至几百万个细胞的数据都不在话下！</span></p><p data-tool="mdnice编辑器"><span leaf="">比如我们读取这个GSE243013数据集里面的单细胞转录组表达量矩阵，同样的也是张泽民团队的百万级别项目：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247535679&amp;idx=1&amp;sn=8c24cc456645f1b1e1c707039808851c&amp;scene=21#wechat_redirect" textvalue="scanpy读取数据失败记录：张泽民团队的单细胞数据GSE212890" data-itemshowtype="0" linktype="text" data-linktype="2">scanpy读取数据失败记录：张泽民团队的单细胞数据GSE212890</a></span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">%%time</span><br><span leaf="">adata = sc.read_mtx(</span><span><span leaf="">"../inputs/GSE243013_NSCLC_immune_scRNA_counts.mtx.gz"</span></span><span leaf="">)</span><span><span leaf="">#读取稀疏矩阵</span></span><br><span leaf="">adata.var_names = pd.read_csv(</span><span><span leaf="">"../inputs/GSE243013_genes.csv.gz"</span></span><span leaf="">, header=0)[</span><span><span leaf="">'geneSymbol'</span></span><span leaf="">].values</span><span><span leaf=""># 添加基因名</span></span><br><span leaf="">adata.obs_names = pd.read_csv(</span><span><span leaf="">"../inputs/GSE243013_barcodes.csv.gz"</span></span><span leaf="">, header=0)[</span><span><span leaf="">'barcode'</span></span><span leaf="">].values</span><span><span leaf=""># 添加细胞ID</span></span><br><span leaf="">import sys</span><br><span leaf="">sys.getsizeof(adata)/1e9</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">时间的消耗就很夸张：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">CPU </span><span><span leaf="">times</span></span><span leaf="">: user 39min 10s, sys: 1min 42s, total: 40min 53s</span><br><span leaf="">Wall time: 38min 10s</span><br><span leaf="">16.299059446G</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">而且仅仅是这个对象就消耗了16G的内存，<span textstyle="">好多人的笔记本电脑就没办法hold住了，因为后面还需要降维聚类分群等。</span></span></p><p data-tool="mdnice编辑器"><span leaf="">最让人惊喜的是，AnnSQL 的运行速度简直快得飞起！别的工具可能需要在超级计算机上跑很久才能完成的任务，AnnSQL 在你的普通笔记本电脑上就能轻松搞定，而且速度还快了好几倍！这就像是给你的科研工作装上了“火箭助推器”，让你的项目进度一路飙升。</span></p><section nodeleaf=""><img data-imgfileid="100052050" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9hSyiaibGceLHj6MkysSEXC1Y3TtPuNQlIxA1SbPrYaeM6UKUiboJcxz3gI7ibYpfb7wUqyTEXSambLw/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9hSyiaibGceLHj6MkysSEXC1Y3TtPuNQlIxA1SbPrYaeM6UKUiboJcxz3gI7ibYpfb7wUqyTEXSambLw/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="mdnice编辑器"><span leaf="">而且，AnnSQL 还特别贴心，提供了超多实用的功能。比如，你可以用它来计算细胞的总表达量、对数据进行标准化处理、做 PCA 分析、UMAP 降维，还能进行差异表达分析……总之，只要你能想到的，AnnSQL 都能帮你做到！</span></p><p data-tool="mdnice编辑器"><span leaf="">说了这么多，你是不是已经迫不及待想试试 AnnSQL 了？别担心，它安装起来超简单，只需要在终端里输入一条命令，就能把它安装到你的电脑上。而且，它的文档也写得超详细，就算是新手也能轻松上手。</span></p><p data-tool="mdnice编辑器"><span leaf="">总之，AnnSQL 就像是单细胞数据处理界的“超级英雄”，能帮你轻松应对各种挑战，让你的科研工作变得更加轻松有趣。所以，赶紧行动起来，把 AnnSQL 加入到你的科研工具箱里吧！相信我，有了它，你的科研之路一定会更加顺畅！</span></p><p data-tool="mdnice编辑器"><span leaf="">文章：《</span><strong><span leaf="">AnnSQL: a Python SQL-based package for fast large-scale single-cell genomics analysis using minimal computational resources</span></strong><span leaf="">》</span></p><p data-tool="mdnice编辑器"><span leaf="">链接：https://academic.oup.com/bioinformaticsadvances/article/5/1/vbaf105/8125003</span></p><h3 data-tool="mdnice编辑器"><span><span leaf="">内存和计算速度之间存在一种权衡关系</span></span></h3><ul><li><section><strong><span leaf="">内存密集型操作</span></strong><span leaf="">：当数据量非常大时，将所有数据加载到内存中可以显著提高访问速度，因为内存的读写速度比磁盘快得多。然而，这会占用大量内存资源。</span></section></li><li><section><strong><span leaf="">磁盘 I/O 操作</span></strong><span leaf="">：如果数据太大无法全部加载到内存中，就需要频繁地从磁盘读取数据。虽然这可以节省内存，但磁盘 I/O 操作的速度通常比内存访问慢得多，因此会降低计算速度。</span></section></li></ul></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/tW59roVUFtuovtckB-wa9w",target="_blank" rel="noopener noreferrer">原文链接</a>
