---
title: "Nature 复现 | (扇形/半圆形) 箱线图"
date: 2025-07-24T03:59:04Z
draft: ["false"]
tags: [
  "fetched",
  "MsTt笔记"
]
categories: ["Acdemic"]
---
Nature 复现 | (扇形/半圆形) 箱线图 by MsTt笔记
------
<div><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="0 0 []"><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="MsTt笔记" data-from="1" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKJLwvM2QW48QKCicY8yHrEfwZA1qzJqmnSDuICrXOZEk6YYntc7QSLbdwg12uibFOEziaEVEXhEJQ4vQ/0?wx_fmt=png" data-signature="SCI绘图，Python/R，生物信息，数理统计，多组学原理" data-id="MzkxNDcwNzY2NQ==" data-is_biz_ban="0"></mp-common-profile></section><section data-mpa-powered-by="yiban.io" data-pm-slice="0 0 []"><span><span leaf=""><br></span></span></section><section data-mpa-powered-by="yiban.io" data-pm-slice="0 0 []"><span><span leaf="">请尊重原创劳动成果🙏</span></span></section><p><span><span leaf="">未经允许，不可抄袭，转载请注明出处！</span></span></p><p data-tool="mdnice编辑器"><span leaf="">今天来复现一个既美观又整洁的箱线图。</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">箱线图</span></strong><span leaf="">是一种用于展示数据分布的图形，特别适合展示不同组之间的差异。它主要展示了：</span></p><ul><li><section><span leaf="">中位数（Median）：箱子中间的那条横线</span></section></li><li><section><span leaf="">上下四分位数（Q1 和 Q3）：箱子的底部和顶部</span></section></li><li><section><span leaf="">四分位距（IQR）：Q3 - Q1，衡量数据的离散程度</span></section></li><li><section><span leaf="">须（Whiskers）：延伸到数据中不被视为极端值的最大范围</span></section></li><li><section><span leaf="">离群值（Outliers）：超出须之外的点，通常是异常值</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">虽然箱线图能概括数据的分布，但它看不到每个具体的数据点。这时我们可以加上：</span><strong><span leaf="">抖动散点图</span></strong><span leaf="">。即在每个组的箱线图上加一层轻微“抖动”的散点，让所有观测值都可见，不会重叠，更直观地看到数据密度、离群点、数据分布等。</span></p><p data-tool="mdnice编辑器"><span leaf="">有时候我们想知道两个组之间的差异是不是“显著的”，这就需要做</span><strong><span leaf="">统计检验</span></strong><span leaf="">。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">显著性检验方法汇总表（适用于箱线图等分组比较）</span></span><span></span></h3><section data-tool="mdnice编辑器"><table><thead><tr><th data-colwidth="88"><section><span leaf="">比较类型</span></section></th><th data-colwidth="138"><section><span leaf="">适用方法</span></section></th><th data-colwidth="97"><section><span leaf="">数据要求</span></section></th><th><section><span leaf="">非参数替代方法</span></section></th><th data-colwidth="88"><section><span leaf="">R中函数</span></section></th></tr></thead><tbody><tr><td data-colwidth="88"><section><span leaf="">两组独立样本</span></section></td><td data-colwidth="138"><strong><span leaf="">独立样本t检验</span></strong></td><td data-colwidth="97"><section><span leaf="">正态性 + 方差齐性</span></section></td><td><strong><span leaf="">Mann-Whitney U检验</span></strong></td><td data-colwidth="88"><code><span leaf="">t.test()</span></code></td></tr><tr><td data-colwidth="88"><section><span leaf="">两组配对样本</span></section></td><td data-colwidth="138"><strong><span leaf="">配对t检验</span></strong></td><td data-colwidth="97"><section><span leaf="">正态性 + 成对差异</span></section></td><td><strong><span leaf="">Wilcoxon符号秩检验</span></strong></td><td data-colwidth="88"><code><span leaf="">t.test(paired=TRUE)</span></code></td></tr><tr><td data-colwidth="88"><section><span leaf="">多组独立样本</span></section></td><td data-colwidth="138"><strong><span leaf="">ANOVA</span></strong></td><td data-colwidth="97"><section><span leaf="">正态性 + 方差齐性</span></section></td><td><strong><span leaf="">Kruskal-Wallis检验</span></strong></td><td data-colwidth="88"><code><span leaf="">aov()</span></code><section><span leaf=""> 或 </span><code><span leaf="">anova()</span></code></section></td></tr><tr><td data-colwidth="88"><section><span leaf="">多组配对样本</span></section></td><td data-colwidth="138"><strong><span leaf="">重复测量ANOVA</span></strong></td><td data-colwidth="97"><section><span leaf="">正态性 + 球形检验</span></section></td><td><strong><span leaf="">Friedman检验</span></strong></td><td data-colwidth="88"><code><span leaf="">aov() + Error()</span></code><section><span leaf=""> 或 </span><code><span leaf="">lme4::lmer()</span></code></section></td></tr><tr><td data-colwidth="88"><section><span leaf="">两两组间多重比较</span></section></td><td data-colwidth="138"><strong><span leaf="">Tukey HSD</span></strong></td><td data-colwidth="97"><section><span leaf="">基于ANOVA结果</span></section></td><td><strong><span leaf="">Dunn检验</span></strong><section><span leaf="">（配合Kr-W）</span></section></td><td data-colwidth="88"><code><span leaf="">TukeyHSD()</span></code><section><span leaf=""> 或</span><code><span leaf="">multcomp::glht()</span></code></section></td></tr><tr><td data-colwidth="88"><section><span leaf="">非参数多组比较后两两比较</span></section></td><td data-colwidth="138"><section><span leaf="">—</span></section></td><td data-colwidth="97"><section><span leaf="">无需正态</span></section></td><td><strong><span leaf="">Dunn检验</span></strong><section><span leaf="">（加Bonf.）</span></section></td><td data-colwidth="88"><code><span leaf="">FSA::dunnTest()</span></code></td></tr></tbody></table></section><p data-tool="mdnice编辑器"><strong><span leaf=""><span textstyle="">箱线图帮你看概况，抖动点帮你看细节，显著性检验告诉你“差异是不是靠谱”。</span></span></strong></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">原图</span></span></h2><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic82mza4m4Km9JT1q1DicdiaS3kjHJIgticibr3z2B1tvr5QerJd8FdrpichJg/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.0905797101449275" data-s="300,640" data-type="png" data-w="828" type="block" data-imgfileid="100001480" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic82mza4m4Km9JT1q1DicdiaS3kjHJIgticibr3z2B1tvr5QerJd8FdrpichJg/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">复现图 - 箱线图</span></span></h2><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8aJCSdcXOQCnI0GpTFxVK5eSiaf3ut39vLocsyy9QNcK3KiaXwazvczKQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.087037037037037" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001481" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8aJCSdcXOQCnI0GpTFxVK5eSiaf3ut39vLocsyy9QNcK3KiaXwazvczKQ/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">拓展图1 - 扇形箱线图</span></span></h2><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic86aNOgAF0iaGiabVFlbHCdMCZ9Bn97CwevR2yicHeo3ickLfbV8bDjicW5GQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7314814814814815" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001482" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic86aNOgAF0iaGiabVFlbHCdMCZ9Bn97CwevR2yicHeo3ickLfbV8bDjicW5GQ/640?wx_fmt=png&amp;from=appmsg"></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">拓展图2 - 半圆形小提琴图</span></span></h2><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8DaQR1vz2rurCU2PicnJibzEfNgIUicSRQEJwPbC26TngRWlicRTkhuvpZw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.649074074074074" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001483" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8DaQR1vz2rurCU2PicnJibzEfNgIUicSRQEJwPbC26TngRWlicRTkhuvpZw/640?wx_fmt=png&amp;from=appmsg"></section><h3 data-tool="mdnice编辑器"><span></span><span><span leaf=""><span textstyle="">原图-箱线图</span></span></span><span></span></h3><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载包，读入数据</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="powershell"><code><span leaf=""><span># 加载必要的包</span></span></code><code><span leaf="">library(tidyverse)   </span></code><code><span leaf="">library(readxl)      </span></code><code><span leaf="">library(ggbeeswarm)  </span></code><code><span leaf="">library(ggpubr) </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 设置随机种子保证结果可重复</span></span></code><code><span leaf="">set.seed(<span>123</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 读入数据</span></span></code><code><span leaf=""><span>data</span> &lt;- read_excel(<span>"data.xlsx"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 将数据从宽格式转换为长格式</span></span></code><code><span leaf=""><span>data</span> &lt;- <span>data</span> %&gt;%</span></code><code><span leaf="">  pivot_longer(</span></code><code><span leaf="">    cols = starts_with(<span>"Sample"</span>),  </span></code><code><span leaf="">    names_to = <span>"Sample"</span>,           </span></code><code><span leaf="">    values_to = <span>"Value"</span>            </span></code><code><span leaf="">  )</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 对Value进行log10转换，用于Y轴标准化</span></span></code><code><span leaf=""><span>data</span> &lt;- <span>data</span> %&gt;%</span></code><code><span leaf="">  mutate(log_Value = log10(Value)) </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义分组顺序（因子水平）</span></span></code><code><span leaf=""><span>data</span><span>$group</span>&lt;<span>-factor</span>(<span>data</span><span>$group</span>,levels = c(<span>"SARS-CoV-2"</span>,<span>"SARS-CoV-2 Delta"</span>,<span>"SARS-CoV-2 Beta"</span>,</span></code><code><span leaf="">                                         <span>"SARS-CoV-2 Mu"</span>,<span>"Bat CoV BANAL-52"</span>,<span>"Pangolin CoV GD-1"</span>,</span></code><code><span leaf="">                                         <span>"SARS-CoV-2 Omicron BA.1"</span>,<span>"SARS-CoV-2 Omicron BA.2"</span>,</span></code><code><span leaf="">                                         <span>"Bat CoV RaTG13"</span>,<span>"Pangolin CoV GX-P5L"</span>,<span>"SARS-CoV-1"</span>))</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义颜色</span></span></code><code><span leaf=""><span># 填充色</span></span></code><code><span leaf="">my_color&lt;- c(<span>"#b09ac9"</span>,<span>"#2ac4f4"</span>,<span>"#7aced6"</span>,<span>"#b09ac9"</span>,<span>"#f9af8b"</span>,<span>"#f48d8e"</span>,</span></code><code><span leaf="">             <span>"#2c165a"</span>,<span>"#3364af"</span>,<span>"#ed1d23"</span>,<span>"#007c8a"</span>,<span>"#f16221"</span>)</span></code><code><span leaf=""><span># 边框色</span></span></code><code><span leaf="">my_color1 &lt;- c(<span>"#2c165a"</span>,<span>"#3364af"</span>,<span>"#007c8a"</span>,<span>"#2c165a"</span>,<span>"#f16221"</span>,<span>"#eb1c22"</span>,</span></code><code><span leaf="">               <span>"#b09ac9"</span>,<span>"#2ac4f4"</span>,<span>"#f58e8f"</span>,<span>"#7aced6"</span>,<span>"#f8ab85"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义要进行统计比较的组别对</span></span></code><code><span leaf="">my_comparisons &lt;- list(</span></code><code><span leaf="">  c(<span>"SARS-CoV-2 Beta"</span>, <span>"Bat CoV BANAL-52"</span>),</span></code><code><span leaf="">  c(<span>"SARS-CoV-2 Omicron BA.1"</span>, <span>"SARS-CoV-2 Omicron BA.2"</span>),</span></code><code><span leaf="">  c(<span>"SARS-CoV-2 Omicron BA.1"</span>, <span>"Bat CoV RaTG13"</span>),</span></code><code><span leaf="">  c(<span>"SARS-CoV-2 Omicron BA.1"</span>, <span>"Pangolin CoV GX-P5L"</span>)</span></code><code><span leaf="">)</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">读入数据，处理数据，定义分组顺序、颜色、要进行统计比较的组别对。</span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">此绘图数据为模拟数据，无实际意义，如需文末可以自助获取。</span></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 先绘制箱线图并提取离群值</span></span></code><code><span leaf=""><span>p</span> &lt;- ggplot(data, aes(x = group, y = log_Value)) + geom_boxplot()</span></code><code><span leaf=""><span>box_data</span> &lt;- ggplot_build(p)$data[[<span>1</span>]]  </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 获取离群值</span></span></code><code><span leaf=""><span>outliers</span> &lt;- box_data %&gt;%</span></code><code><span leaf="">  <span>select</span>(x, y = outliers) %&gt;%   </span></code><code><span leaf="">  <span>tidyr</span>::unnest(y)              </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 过滤原始数据（排除离群值）</span></span></code><code><span leaf=""><span>data_filtered</span> &lt;- data %&gt;%</span></code><code><span leaf="">  <span>anti_join</span>(outliers, by = c(<span>"group"</span> = <span>"x"</span>, <span>"log_Value"</span> = <span>"y"</span>)) %&gt;% </span></code><code><span leaf="">  <span>group_by</span>(group) %&gt;%                </span></code><code><span leaf="">  <span>mutate</span>(max = max(log_Value)) %&gt;%   </span></code><code><span leaf="">  <span>ungroup</span>() </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 重新绘制完整图形</span></span></code><code><span leaf=""><span>ggplot</span>(data, aes(x = group, y = log_Value)) +</span></code><code><span leaf="">  <span>geom_boxplot</span>(aes(colour = group),</span></code><code><span leaf="">               <span>outlier</span>.shape = NA, size = <span>0</span>.<span>3</span>, width = <span>0</span>.<span>4</span>, staplewidth = <span>0</span>.<span>5</span>) +</span></code><code><span leaf="">  <span>geom_quasirandom</span>(data = data_filtered, aes(fill = group),</span></code><code><span leaf="">                   <span>size</span> = <span>1</span>.<span>1</span>, shape = <span>21</span>, stroke = <span>0</span>, width = <span>0</span>.<span>2</span>) +</span></code><code><span leaf="">  <span>geom_quasirandom</span>(data = data_filtered, aes(colour = group ), </span></code><code><span leaf="">                   <span>size</span> = <span>1</span>.<span>1</span>, shape = <span>21</span>, stroke = <span>0</span>.<span>25</span>, width = <span>0</span>.<span>2</span>, fill = NA) +</span></code><code><span leaf="">  <span>stat_compare_means</span>(comparisons = my_comparisons,   # 指定要比较的组别对</span></code><code><span leaf="">                     <span>method</span> = <span>"t.test"</span>,              # 使用的统计检验方法</span></code><code><span leaf="">                     <span>label</span> = <span>"p.format"</span>,             # 标签显示格式：显示p值</span></code><code><span leaf="">                     <span>tip</span>.length = <span>0</span>.<span>01</span>,              # 显著性线顶端的短横线长度</span></code><code><span leaf="">                     <span>step</span>.increase = <span>0</span>.<span>1</span>,            # 多重比较时标签的垂直间距增量</span></code><code><span leaf="">                     <span>size</span> = <span>4</span>,                       # 标签文字大小</span></code><code><span leaf="">                     <span>vjust</span> = <span>0</span>.<span>2</span>) +                  # 标签垂直调整位置</span></code><code><span leaf="">  <span># 添加每组的均值</span></span></code><code><span leaf="">  <span>geom_text</span>(data = distinct(data_filtered, group, mean, max),  </span></code><code><span leaf="">            <span>aes</span>(x = group, y = max+<span>0</span>.<span>15</span>, label = sprintf(<span>"%.1f"</span>, mean)),</span></code><code><span leaf="">            <span>hjust</span> = <span>0</span>.<span>5</span>, vjust = <span>0</span>.<span>5</span>, size = <span>4</span>) +</span></code><code><span leaf="">  <span># 设置填充颜色</span></span></code><code><span leaf="">  <span>scale_fill_manual</span>(values = my_color) +</span></code><code><span leaf="">  <span># 设置边框颜色</span></span></code><code><span leaf="">  <span>scale_color_manual</span>(values = my_color1) +</span></code><code><span leaf="">  <span># 设置Y轴范围，且不扩展</span></span></code><code><span leaf="">  <span>scale_y_continuous</span>(expand = c(<span>0</span>, <span>0</span>), limits = c(<span>0</span>, <span>5</span>))+</span></code><code><span leaf="">  <span># Y轴标题</span></span></code><code><span leaf="">  <span>labs</span>(y=<span>"sVNT (log NT50)"</span>)+</span></code><code><span leaf="">  <span># 设置主题</span></span></code><code><span leaf="">  <span>theme_classic</span>() +</span></code><code><span leaf="">  <span>theme</span>(axis.ticks.length = unit(<span>8</span>, <span>"pt"</span>),             # 坐标轴刻度线长度</span></code><code><span leaf="">        <span>axis</span>.title.x = element_blank(),                # 移除X轴标题</span></code><code><span leaf="">        <span>axis</span>.ticks = element_line(linewidth = <span>0</span>.<span>3</span>),    # 坐标轴刻度线宽度</span></code><code><span leaf="">        <span>axis</span>.line = element_line(linewidth = <span>0</span>.<span>3</span>),     # 坐标轴线宽度</span></code><code><span leaf="">        <span>axis</span>.title.y = element_text(size = <span>13</span>),        # Y轴标题大小</span></code><code><span leaf="">        <span>axis</span>.text.x = element_text(angle = <span>90</span>, hjust = <span>1</span>,vjust = <span>0</span>.<span>5</span>,</span></code><code><span leaf="">                                   <span>size</span> = <span>13</span>, color = <span>"black"</span>),  # X轴标签样式</span></code><code><span leaf="">        <span>axis</span>.text.y = element_text(size = <span>13</span>, color = <span>"black"</span>),  # Y轴标签样式</span></code><code><span leaf="">        <span>legend</span>.position = <span>"none"</span>,                      # 不显示图例</span></code><code><span leaf="">        <span>plot</span>.margin = margin(<span>10</span>, <span>10</span>, <span>10</span>, <span>10</span>))           # 四周边距：上/右/下/左  </span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8BEkIWl2JMC8dmhKhwOpEFbSrJh0XOiaeBE1Baaarj6SzlWgPSZvtPIw/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.0972222222222223" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001484" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8BEkIWl2JMC8dmhKhwOpEFbSrJh0XOiaeBE1Baaarj6SzlWgPSZvtPIw/640?wx_fmt=png&amp;from=appmsg"></section><h3 data-tool="mdnice编辑器"><span></span><span><span leaf=""><span textstyle="">拓展图1 - 扇形箱线图</span></span></span><span></span></h3><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载包，读入数据</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="powershell"><code><span leaf=""><span># 加载必要的包</span></span></code><code><span leaf="">library(tidyverse)   </span></code><code><span leaf="">library(readxl)      </span></code><code><span leaf="">library(ggbeeswarm)  </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 设置随机种子保证结果可重复</span></span></code><code><span leaf="">set.seed(<span>123</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 读入数据</span></span></code><code><span leaf=""><span>data</span> &lt;- read_excel(<span>"data.xlsx"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 将数据从宽格式转换为长格式</span></span></code><code><span leaf=""><span>data</span> &lt;- <span>data</span> %&gt;%</span></code><code><span leaf="">  pivot_longer(</span></code><code><span leaf="">    cols = starts_with(<span>"Sample"</span>),  </span></code><code><span leaf="">    names_to = <span>"Sample"</span>,           </span></code><code><span leaf="">    values_to = <span>"Value"</span>            </span></code><code><span leaf="">  )</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 对Value进行log10转换，用于Y轴标准化</span></span></code><code><span leaf=""><span>data</span> &lt;- <span>data</span> %&gt;%</span></code><code><span leaf="">  mutate(log_Value = log10(Value)) </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义分组顺序（因子水平）</span></span></code><code><span leaf=""><span>data</span><span>$group</span>&lt;<span>-factor</span>(<span>data</span><span>$group</span>,levels = c(<span>"SARS-CoV-2"</span>,<span>"SARS-CoV-2 Delta"</span>,<span>"SARS-CoV-2 Beta"</span>,</span></code><code><span leaf="">                                         <span>"SARS-CoV-2 Mu"</span>,<span>"Bat CoV BANAL-52"</span>,<span>"Pangolin CoV GD-1"</span>,</span></code><code><span leaf="">                                         <span>"SARS-CoV-2 Omicron BA.1"</span>,<span>"SARS-CoV-2 Omicron BA.2"</span>,</span></code><code><span leaf="">                                         <span>"Bat CoV RaTG13"</span>,<span>"Pangolin CoV GX-P5L"</span>,<span>"SARS-CoV-1"</span>))</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义颜色</span></span></code><code><span leaf=""><span># 填充色</span></span></code><code><span leaf="">my_color&lt;- c(<span>"#b09ac9"</span>,<span>"#2ac4f4"</span>,<span>"#7aced6"</span>,<span>"#b09ac9"</span>,<span>"#f9af8b"</span>,<span>"#f48d8e"</span>,</span></code><code><span leaf="">             <span>"#2c165a"</span>,<span>"#3364af"</span>,<span>"#ed1d23"</span>,<span>"#007c8a"</span>,<span>"#f16221"</span>)</span></code><code><span leaf=""><span># 边框色</span></span></code><code><span leaf="">my_color1 &lt;- c(<span>"#2c165a"</span>,<span>"#3364af"</span>,<span>"#007c8a"</span>,<span>"#2c165a"</span>,<span>"#f16221"</span>,<span>"#eb1c22"</span>,</span></code><code><span leaf="">               <span>"#b09ac9"</span>,<span>"#2ac4f4"</span>,<span>"#f58e8f"</span>,<span>"#7aced6"</span>,<span>"#f8ab85"</span>)</span></code></pre></section><p data-tool="mdnice编辑器"><span leaf="">读入数据，转成便于绘图的长格式，定义好每个分组的颜色和顺序。</span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">此绘图数据为模拟数据，无实际意义，如需文末可以自助获取。</span></span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 先绘制箱线图并提取离群值</span></span></code><code><span leaf=""><span>p</span> &lt;- ggplot(data, aes(x = group, y = log_Value)) + geom_boxplot()</span></code><code><span leaf=""><span>box_data</span> &lt;- ggplot_build(p)$data[[<span>1</span>]]  </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 获取离群值</span></span></code><code><span leaf=""><span>outliers</span> &lt;- box_data %&gt;%</span></code><code><span leaf="">  <span>select</span>(x, y = outliers) %&gt;%   </span></code><code><span leaf="">  <span>tidyr</span>::unnest(y)              </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 过滤原始数据（排除离群值）</span></span></code><code><span leaf=""><span>data_filtered</span> &lt;- data %&gt;%</span></code><code><span leaf="">  <span>anti_join</span>(outliers, by = c(<span>"group"</span> = <span>"x"</span>, <span>"log_Value"</span> = <span>"y"</span>)) %&gt;%  </span></code><code><span leaf="">  <span>group_by</span>(group) %&gt;%                </span></code><code><span leaf="">  <span>mutate</span>(max = max(log_Value)) %&gt;%   #</span></code><code><span leaf="">  <span>ungroup</span>() </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 重新绘制完整图形</span></span></code><code><span leaf=""><span>ggplot</span>(data, aes(x = group, y = log_Value)) +</span></code><code><span leaf="">  <span>geom_boxplot</span>(aes(colour = group),</span></code><code><span leaf="">               <span>outlier</span>.shape = NA, size = <span>0</span>.<span>3</span>, width = <span>0</span>.<span>4</span>, staplewidth = <span>0</span>.<span>5</span>) +</span></code><code><span leaf="">  <span>geom_quasirandom</span>(data = data_filtered, aes(fill = group),</span></code><code><span leaf="">                   <span>size</span> = <span>0</span>.<span>8</span>, shape = <span>21</span>, stroke = <span>0</span>, width = <span>0</span>.<span>2</span>) +</span></code><code><span leaf="">  <span>geom_quasirandom</span>(data = data_filtered, aes(colour = group ), </span></code><code><span leaf="">                   <span>size</span> = <span>0</span>.<span>8</span>, shape = <span>21</span>, stroke = <span>0</span>.<span>25</span>, width = <span>0</span>.<span>2</span>, fill = NA) +</span></code><code><span leaf="">  <span># 设置Y轴范围，且不扩展</span></span></code><code><span leaf="">  <span>scale_y_continuous</span>(expand = c(<span>0</span>, <span>0</span>), limits = c(<span>0</span>, <span>4</span>)) +</span></code><code><span leaf="">  <span># 添加垂直线 (x = 11.7处)</span></span></code><code><span leaf="">  <span>annotate</span>(<span>"segment"</span>, x = <span>11</span>.<span>7</span>, xend = <span>11</span>.<span>7</span>, y = <span>0</span>, yend = <span>4</span>, linewidth = <span>0</span>.<span>3</span>) +</span></code><code><span leaf="">  <span># 添加水平线 (y = 0处)</span></span></code><code><span leaf="">  <span>annotate</span>(<span>"segment"</span>, x = <span>0</span>, xend = <span>11</span>.<span>7</span>, y = <span>0</span>, yend = <span>0</span>, linewidth = <span>0</span>.<span>3</span>) +</span></code><code><span leaf="">  <span># 设置填充颜色</span></span></code><code><span leaf="">  <span>scale_fill_manual</span>(values = my_color) +</span></code><code><span leaf="">  <span># 设置边框颜色</span></span></code><code><span leaf="">  <span>scale_color_manual</span>(values = my_color1) +</span></code><code><span leaf="">  <span># 极坐标变换</span></span></code><code><span leaf="">  <span>coord_radial</span>(start = -pi/<span>3</span>,         </span></code><code><span leaf="">               <span>end</span> = pi/<span>3</span>,             </span></code><code><span leaf="">               <span>r</span>.axis.inside = TRUE,   </span></code><code><span leaf="">               <span>inner</span>.radius = <span>0</span>.<span>3</span>,    </span></code><code><span leaf="">               <span>rotate</span>.angle = TRUE,    </span></code><code><span leaf="">               <span>clip</span> = <span>"off"</span>) +         </span></code><code><span leaf="">  <span># 添加径向标签，并设置文本颜色</span></span></code><code><span leaf="">  <span>geom_text</span>(data = distinct(data_filtered, group),   </span></code><code><span leaf="">            <span>aes</span>(x = group, y = <span>4</span>, label = group, color = group),</span></code><code><span leaf="">            <span>angle</span> = <span>90</span>, hjust = -<span>0</span>.<span>05</span>, size = <span>3</span>.<span>5</span>, fontface = <span>"bold"</span>) +   # 文本方向是垂直</span></code><code><span leaf="">  <span># 添加均值标签</span></span></code><code><span leaf="">  <span>geom_text</span>(data = distinct(data_filtered, group, mean, max),  </span></code><code><span leaf="">            <span>aes</span>(x = group, y = max+<span>0</span>.<span>2</span>, label = sprintf(<span>"%.1f"</span>, mean)),</span></code><code><span leaf="">            <span>hjust</span> = <span>0</span>.<span>5</span>, vjust = <span>0</span>.<span>5</span>, size = <span>3</span>.<span>5</span>) +</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 设置主题</span></span></code><code><span leaf="">  <span>theme_minimal</span>() +</span></code><code><span leaf="">  <span>theme</span>(axis.title = element_blank(),  # 不显示X和Y坐标轴标题</span></code><code><span leaf="">        <span>axis</span>.line = element_line(color = <span>"black"</span>, linewidth = <span>0</span>.<span>3</span>),  # 设置坐标轴线样式</span></code><code><span leaf="">        <span>axis</span>.ticks = element_line(color = <span>"black"</span>),   # 设置刻度线颜色</span></code><code><span leaf="">        <span>axis</span>.text.x = element_blank(),                # 隐藏x轴(角度轴)标签，因为前面自定义已经添加了</span></code><code><span leaf="">        <span>axis</span>.text.y = element_text(size = <span>12</span>, color = <span>"black"</span>),  # 设置y轴(半径轴)标签样式</span></code><code><span leaf="">        <span>panel</span>.grid = element_line(linewidth = <span>0</span>.<span>3</span>),        # 设置网格线粗细</span></code><code><span leaf="">        <span>legend</span>.position = <span>"none"</span>,                     # 不显示图例</span></code><code><span leaf="">        <span>plot</span>.margin = margin(<span>10</span>, <span>10</span>, <span>0</span>, <span>10</span>))          # 四周边距：上/右/下/左  </span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8EO6IAws4Q3xJBaEzJqmWQsdrxE5TN8hjibgVddHqO4FJORVwvd1TPfA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.737037037037037" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001485" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8EO6IAws4Q3xJBaEzJqmWQsdrxE5TN8hjibgVddHqO4FJORVwvd1TPfA/640?wx_fmt=png&amp;from=appmsg"></section><h3 data-tool="mdnice编辑器"><span></span><span><span leaf=""><span textstyle="">拓展图2 - 半圆形小提琴图</span></span></span><span></span></h3><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">加载包，读入数据</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="powershell"><code><span leaf=""><span># 加载必要的包</span></span></code><code><span leaf="">library(tidyverse)   </span></code><code><span leaf="">library(readxl)      </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 设置随机种子保证结果可重复</span></span></code><code><span leaf="">set.seed(<span>123</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 读入数据</span></span></code><code><span leaf=""><span>data</span> &lt;- read_excel(<span>"data.xlsx"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 将数据从宽格式转换为长格式</span></span></code><code><span leaf=""><span>data</span> &lt;- <span>data</span> %&gt;%</span></code><code><span leaf="">  pivot_longer(</span></code><code><span leaf="">    cols = starts_with(<span>"Sample"</span>),  </span></code><code><span leaf="">    names_to = <span>"Sample"</span>,           </span></code><code><span leaf="">    values_to = <span>"Value"</span>            </span></code><code><span leaf="">  )</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 计算每组的最大值</span></span></code><code><span leaf=""><span>data</span> &lt;- <span>data</span> %&gt;%</span></code><code><span leaf="">  group_by(<span>group</span>) %&gt;%           </span></code><code><span leaf="">  mutate(max = max(Value)) %&gt;%  </span></code><code><span leaf="">  ungroup() </span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义分组顺序（因子水平）</span></span></code><code><span leaf=""><span>data</span><span>$group</span>&lt;<span>-factor</span>(<span>data</span><span>$group</span>,levels = c(<span>"SARS-CoV-2"</span>,<span>"SARS-CoV-2 Delta"</span>,<span>"SARS-CoV-2 Beta"</span>,</span></code><code><span leaf="">                                         <span>"SARS-CoV-2 Mu"</span>,<span>"Bat CoV BANAL-52"</span>,<span>"Pangolin CoV GD-1"</span>,</span></code><code><span leaf="">                                         <span>"SARS-CoV-2 Omicron BA.1"</span>,<span>"SARS-CoV-2 Omicron BA.2"</span>,</span></code><code><span leaf="">                                         <span>"Bat CoV RaTG13"</span>,<span>"Pangolin CoV GX-P5L"</span>,<span>"SARS-CoV-1"</span>))</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 定义颜色</span></span></code><code><span leaf=""><span># 填充色</span></span></code><code><span leaf="">my_color&lt;- c(<span>"#b09ac9"</span>,<span>"#2ac4f4"</span>,<span>"#7aced6"</span>,<span>"#b09ac9"</span>,<span>"#f9af8b"</span>,<span>"#f48d8e"</span>,</span></code><code><span leaf="">             <span>"#2c165a"</span>,<span>"#3364af"</span>,<span>"#ed1d23"</span>,<span>"#007c8a"</span>,<span>"#f16221"</span>)</span></code><code><span leaf=""><span># 边框色</span></span></code><code><span leaf="">my_color1 &lt;- c(<span>"#2c165a"</span>,<span>"#3364af"</span>,<span>"#007c8a"</span>,<span>"#2c165a"</span>,<span>"#f16221"</span>,<span>"#eb1c22"</span>,</span></code><code><span leaf="">               <span>"#b09ac9"</span>,<span>"#2ac4f4"</span>,<span>"#f58e8f"</span>,<span>"#7aced6"</span>,<span>"#f8ab85"</span>)</span></code></pre></section><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图</span></span></h2><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># 绘图</span></span></code><code><span leaf=""><span>ggplot</span>(data, aes(x = group, y = log10(Value))) +</span></code><code><span leaf="">  <span>geom_violin</span>(aes(fill = group, color = group),</span></code><code><span leaf="">              <span>width</span> = <span>0</span>.<span>4</span>, scale = <span>"width"</span>) +</span></code><code><span leaf="">  <span>geom_boxplot</span>(width = <span>0</span>.<span>1</span>, outlier.shape = NA, size = <span>0</span>.<span>3</span>, staplewidth = <span>0</span>.<span>5</span>) +</span></code><code><span leaf="">  <span># 设置Y轴范围，且不扩展</span></span></code><code><span leaf="">  <span>scale_y_continuous</span>(expand = c(<span>0</span>, <span>0</span>), limits = c(<span>0</span>, <span>4</span>)) +</span></code><code><span leaf="">  <span># 添加垂直线 (x = 11.7处)</span></span></code><code><span leaf="">  <span>annotate</span>(<span>"segment"</span>, x = <span>11</span>.<span>7</span>, xend = <span>11</span>.<span>7</span>, y = <span>0</span>, yend = <span>4</span>, linewidth = <span>0</span>.<span>3</span>) +</span></code><code><span leaf="">  <span># 设置填充颜色</span></span></code><code><span leaf="">  <span>scale_fill_manual</span>(values = my_color) +</span></code><code><span leaf="">  <span># 设置边框颜色</span></span></code><code><span leaf="">  <span>scale_color_manual</span>(values = my_color1) +</span></code><code><span leaf="">  <span># 极坐标变换</span></span></code><code><span leaf="">  <span>coord_radial</span>(start = -pi/<span>2</span>,          </span></code><code><span leaf="">               <span>end</span> = pi/<span>2</span>,             #</span></code><code><span leaf="">               <span>r</span>.axis.inside = TRUE,   # </span></code><code><span leaf="">               <span>inner</span>.radius = <span>0</span>.<span>1</span>,     </span></code><code><span leaf="">               <span>rotate</span>.angle = TRUE,    </span></code><code><span leaf="">               <span>clip</span> = <span>"off"</span>) +        </span></code><code><span leaf="">  <span># 添加径向标签，并设置文本颜色</span></span></code><code><span leaf="">  <span>geom_text</span>(data = distinct(data, group),   </span></code><code><span leaf="">            <span>aes</span>(x = group, y = <span>4</span>, label = group, color = group),</span></code><code><span leaf="">            <span>angle</span> = <span>90</span>, hjust = -<span>0</span>.<span>05</span>, size = <span>3</span>.<span>5</span>, fontface = <span>"bold"</span>) +   # 文本方向是垂直</span></code><code><span leaf="">  <span># 添加均值标签</span></span></code><code><span leaf="">  <span>geom_text</span>(data = distinct(data, group, mean, max),  </span></code><code><span leaf="">            <span>aes</span>(x = group, y = log10(max)+<span>0</span>.<span>2</span>, label = sprintf(<span>"%.1f"</span>, mean)),</span></code><code><span leaf="">            <span>hjust</span> = <span>0</span>.<span>5</span>, vjust = <span>0</span>.<span>5</span>, size = <span>3</span>.<span>5</span>) +</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># 设置主题</span></span></code><code><span leaf="">  <span>theme_minimal</span>() +</span></code><code><span leaf="">  <span>theme</span>(axis.title = element_blank(),  # 不显示X和Y坐标轴标题</span></code><code><span leaf="">        <span>axis</span>.line = element_line(color = <span>"black"</span>, linewidth = <span>0</span>.<span>3</span>),  # 设置坐标轴线样式</span></code><code><span leaf="">        <span>axis</span>.ticks = element_line(color = <span>"black"</span>),   # 设置刻度线颜色</span></code><code><span leaf="">        <span>axis</span>.text.x = element_blank(),                # 隐藏x轴(角度轴)标签，因为前面自定义已经添加了</span></code><code><span leaf="">        <span>axis</span>.text.y = element_text(size = <span>12</span>, color = <span>"black"</span>),  # 设置y轴(半径轴)标签样式</span></code><code><span leaf="">        <span>panel</span>.grid = element_line(linewidth = <span>0</span>.<span>3</span>),        # 设置网格线粗细</span></code><code><span leaf="">        <span>legend</span>.position = <span>"none"</span>,                     # 不显示图例</span></code><code><span leaf="">        <span>plot</span>.margin = margin(<span>10</span>, <span>60</span>, <span>0</span>, <span>60</span>))          # 四周边距：上/右/下/左   </span></code></pre></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8icicLMOE6QnMkhdSEPZMCGncciakldECiaXQS0RYxfcx1OwD5jONbnfx9Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.65" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100001486" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic8icicLMOE6QnMkhdSEPZMCGncciakldECiaXQS0RYxfcx1OwD5jONbnfx9Q/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">更多箱线图案例：</span></span></p><p data-tool="mdnice编辑器"><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkxNDcwNzY2NQ==&amp;mid=2247484110&amp;idx=1&amp;sn=e5693a88d7d1422da0143d1b90a8fdce&amp;scene=21#wechat_redirect" textvalue='复现一张"不一样"的小提琴图，被炫到了！' data-itemshowtype="0" linktype="text" data-linktype="2">复现一张"不一样"的小提琴图，被炫到了！</a></span></p><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic87RdEX4Au7FB5urI6czS0EpbxgHU58OysVbeg5amJwQQfmWLXmEWd7g/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5620814013395157" data-type="png" data-w="1941" data-imgfileid="100001490" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic87RdEX4Au7FB5urI6czS0EpbxgHU58OysVbeg5amJwQQfmWLXmEWd7g/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic83pibw8ZThjiaccEStpDiccdAp6MuKtGk88t2oaiaRUyibic6bEYCndIJm75Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.562037037037037" data-type="png" data-w="1080" data-imgfileid="100001491" src="https://mmbiz.qpic.cn/mmbiz_png/mEOTibibBIwKLCIr6mwrSunP9fs1pmTzic83pibw8ZThjiaccEStpDiccdAp6MuKtGk88t2oaiaRUyibic6bEYCndIJm75Q/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">获取以 RProject 形式保存的</span></span><strong><span leaf=""><span textstyle="">绘图代码+注释+数据模板</span></span></strong><span leaf=""><span textstyle="">，后台回复关键词: </span></span><em><span leaf=""><span textstyle="">250724_boxplots</span></span></em></p></section><section nodeleaf=""><mp-common-cpsad data-pluginname="mpcps" data-templateid="list" data-cpsversion="v120" data-goodssouce="1" data-traceid="eb64b4c7-a246-498f-af10-9c12e7063e5e" data-pid="101_14835066"></mp-common-cpsad></section><section nodeleaf=""><mp-common-cpsad data-pluginname="mpcps" data-templateid="list" data-cpsversion="v120" data-goodssouce="1" data-traceid="eb64b4c7-a246-498f-af10-9c12e7063e5e" data-pid="101_14324026"></mp-common-cpsad></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/cPBBUA1QLryNnMS554uCqw",target="_blank" rel="noopener noreferrer">原文链接</a>
