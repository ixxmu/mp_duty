---
title: "R tips：celltrek细胞共定位分析"
date: 2025-07-24T23:31:43Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
R tips：celltrek细胞共定位分析 by 生信菜鸟团
------
<div><p><span leaf="">CellTrek</span><span leaf="">是一个空间分析工具包，可以做单细胞和空间的整合分析、空间细胞共定位和空间基因表达分析。</span></p><p><span leaf="">它的共定位分析可以找到空间上距离相互靠近的细胞，并以网络图的形式呈现。</span></p><p><span leaf="">官方教程中，共定位分析需要依赖整合单细胞和空间数据之后的celltrek对象，本文则只使用空间数据进行共定位分析。同时官方提供了一个shiny程序用于展示共定位网络结构，交互性很好，但是无法导出图片，本文则使用igraph从头绘制共定位网络图。</span></p><p><span leaf="">仍以10X的xenium breast官方数据为例，下载后解压。</span></p><h3><span leaf="">读取数据，构造用于celltrek共定位分析的对象</span></h3><pre><ol><li><code><span><span leaf=""># read xenium gene expression data</span></span></code></li><li><code><span><span leaf="">xenium_expr </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> </span></span><span><span leaf="">Read10X_h5</span></span><span><span leaf="">(</span></span><span><span leaf="">"Xenium_V1_FFPE_Human_Breast_IDC/cell_feature_matrix.h5"</span></span><span><span leaf="">)</span></span></code></li><li><code><span><span leaf="">xenium </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> </span></span><span><span leaf="">CreateSeuratObject</span></span><span><span leaf="">(</span></span></code></li><li><code><span><span leaf="">    xenium_expr$</span></span><span><span leaf="">`Gene Expression`</span></span><span><span leaf="">,</span></span></code></li><li><code><span><span leaf="">    min</span></span><span><span leaf="">.</span></span><span><span leaf="">cells </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">10</span></span><span><span leaf="">,</span></span></code></li><li><code><span><span leaf="">    min</span></span><span><span leaf="">.</span></span><span><span leaf="">features </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">10</span></span></code></li><li><code><span><span leaf="">  </span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  </span></span><span><span leaf="">RenameCells</span></span><span><span leaf="">(</span></span><span><span leaf="">add</span></span><span><span leaf="">.</span></span><span><span leaf="">cell</span></span><span><span leaf="">.</span></span><span><span leaf="">id </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">"cell"</span></span><span><span leaf="">)</span></span></code></li><li><code></code></li><li><code><span><span leaf=""># read cell coords data</span></span></code></li><li><code><span><span leaf=""># 3 column should exists to run CellTrek::scoloc analysis</span></span></code></li><li><code><span><span leaf=""># coord_x, coord_y, id_new</span></span></code></li><li><code><span><span leaf="">coords_xenium </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> arrow</span></span><span><span leaf="">::</span></span><span><span leaf="">read_parquet</span></span><span><span leaf="">(</span></span><span><span leaf="">"Xenium_V1_FFPE_Human_Breast_IDC/cells.parquet"</span></span><span><span leaf="">)</span></span></code></li><li><code><span><span leaf="">meta_coords </span></span><span><span leaf="">&lt;-</span></span></code></li><li><code><span><span leaf="">  coords_xenium </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  dplyr</span></span><span><span leaf="">::</span></span><span><span leaf="">select</span></span><span><span leaf="">(</span></span></code></li><li><code><span><span leaf="">    cell_id</span></span><span><span leaf="">,</span></span></code></li><li><code><span><span leaf="">    coord_x </span></span><span><span leaf="">=</span></span><span><span leaf=""> x_centroid</span></span><span><span leaf="">,</span></span></code></li><li><code><span><span leaf="">    coord_y </span></span><span><span leaf="">=</span></span><span><span leaf=""> y_centroid</span></span></code></li><li><code><span><span leaf="">  </span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  mutate</span></span><span><span leaf="">(</span></span><span><span leaf="">cell_id </span></span><span><span leaf="">=</span></span><span><span leaf=""> str_c</span></span><span><span leaf="">(</span></span><span><span leaf="">"cell"</span></span><span><span leaf="">,</span></span><span><span leaf=""> cell_id</span></span><span><span leaf="">,</span></span><span><span leaf=""> sep </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">"_"</span></span><span><span leaf="">))</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  mutate</span></span><span><span leaf="">(</span></span><span><span leaf="">id_new </span></span><span><span leaf="">=</span></span><span><span leaf=""> cell_id</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  column_to_rownames</span></span><span><span leaf="">(</span></span><span><span leaf="">"cell_id"</span></span><span><span leaf="">)</span></span></code></li><li><code></code></li><li><code><span><span leaf="">xenium </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> xenium </span></span><span><span leaf="">%&gt;%</span></span><span><span leaf=""> </span></span><span><span leaf="">AddMetaData</span></span><span><span leaf="">(</span></span><span><span leaf="">meta_coords</span></span><span><span leaf="">)</span></span></code></li></ol></pre><p><span leaf="">构造模拟的组别和细胞注释，这里只是示意，正常情况下，group是分析组别，annotation是注释好的细胞类型。</span></p><pre><ol><li><code><span><span leaf="">set</span></span><span><span leaf="">.</span></span><span><span leaf="">seed</span></span><span><span leaf="">(</span></span><span><span leaf="">1234</span></span><span><span leaf="">)</span></span></code></li><li><code><span><span leaf="">xenium$group </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> sample</span></span><span><span leaf="">(</span></span><span><span leaf="">LETTERS</span></span><span><span leaf="">[</span></span><span><span leaf="">1</span></span><span><span leaf="">:</span></span><span><span leaf="">3</span></span><span><span leaf="">],</span></span><span><span leaf=""> size </span></span><span><span leaf="">=</span></span><span><span leaf=""> ncol</span></span><span><span leaf="">(</span></span><span><span leaf="">xenium</span></span><span><span leaf="">),</span></span><span><span leaf=""> replace </span></span><span><span leaf="">=</span></span><span><span leaf=""> TRUE</span></span><span><span leaf="">)</span></span></code></li><li><code><span><span leaf="">xenium$annotation </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> sample</span></span><span><span leaf="">(</span></span><span><span leaf="">str_c</span></span><span><span leaf="">(</span></span><span><span leaf="">"Cell"</span></span><span><span leaf="">,</span></span><span><span leaf=""> LETTERS</span></span><span><span leaf="">[</span></span><span><span leaf="">1</span></span><span><span leaf="">:</span></span><span><span leaf="">10</span></span><span><span leaf="">],</span></span><span><span leaf=""> sep </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">"_"</span></span><span><span leaf="">),</span></span><span><span leaf=""> size </span></span><span><span leaf="">=</span></span><span><span leaf=""> ncol</span></span><span><span leaf="">(</span></span><span><span leaf="">xenium</span></span><span><span leaf="">),</span></span><span><span leaf=""> replace </span></span><span><span leaf="">=</span></span><span><span leaf=""> TRUE</span></span><span><span leaf="">)</span></span></code></li></ol></pre><p><span leaf="">展示一下此时的数据，为了提高绘图速度，只是用10%的细胞绘制空间原位图：</span></p><pre><ol><li><code><span><span leaf=""># spatial plot</span></span></code></li><li><code><span><span leaf="">xenium</span></span><span><span leaf="">[[]]</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  dplyr</span></span><span><span leaf="">::</span></span><span><span leaf="">slice_sample</span></span><span><span leaf="">(</span></span><span><span leaf="">prop </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">0.1</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  ggplot</span></span><span><span leaf="">(</span></span><span><span leaf="">aes</span></span><span><span leaf="">(</span></span><span><span leaf="">x </span></span><span><span leaf="">=</span></span><span><span leaf=""> coord_x</span></span><span><span leaf="">,</span></span><span><span leaf=""> y </span></span><span><span leaf="">=</span></span><span><span leaf=""> coord_y</span></span><span><span leaf="">))</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">  geom_tile</span></span><span><span leaf="">(</span></span><span><span leaf="">aes</span></span><span><span leaf="">(</span></span><span><span leaf="">fill </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">group</span></span><span><span leaf="">),</span></span><span><span leaf=""> height </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">20</span></span><span><span leaf="">,</span></span><span><span leaf=""> width </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">20</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">  coord_equal</span></span><span><span leaf="">()</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">  ggsci</span></span><span><span leaf="">::</span></span><span><span leaf="">scale_fill_aaas</span></span><span><span leaf="">()</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">  theme_void</span></span><span><span leaf="">()</span></span></code></li><li><code></code></li><li><code><span><span leaf="">xenium</span></span><span><span leaf="">[[]]</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  dplyr</span></span><span><span leaf="">::</span></span><span><span leaf="">slice_sample</span></span><span><span leaf="">(</span></span><span><span leaf="">prop </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">0.1</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  ggplot</span></span><span><span leaf="">(</span></span><span><span leaf="">aes</span></span><span><span leaf="">(</span></span><span><span leaf="">x </span></span><span><span leaf="">=</span></span><span><span leaf=""> coord_x</span></span><span><span leaf="">,</span></span><span><span leaf=""> y </span></span><span><span leaf="">=</span></span><span><span leaf=""> coord_y</span></span><span><span leaf="">))</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">  geom_tile</span></span><span><span leaf="">(</span></span><span><span leaf="">aes</span></span><span><span leaf="">(</span></span><span><span leaf="">fill </span></span><span><span leaf="">=</span></span><span><span leaf=""> annotation</span></span><span><span leaf="">),</span></span><span><span leaf=""> height </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">20</span></span><span><span leaf="">,</span></span><span><span leaf=""> width </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">20</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">  coord_equal</span></span><span><span leaf="">()</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">  ggsci</span></span><span><span leaf="">::</span></span><span><span leaf="">scale_fill_igv</span></span><span><span leaf="">()</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">  theme_void</span></span><span><span leaf="">()</span></span></code></li></ol></pre><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9PkmFOPUwa2M58rpMEicL9gB1ZnicqysdWmSERLqtWPXWlHialnC8Hx4xK3rgEh4Eq8ojs9GibPfIb8Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100049170" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9PkmFOPUwa2M58rpMEicL9gB1ZnicqysdWmSERLqtWPXWlHialnC8Hx4xK3rgEh4Eq8ojs9GibPfIb8Q/640?wx_fmt=png&amp;from=appmsg"></section><h3><span leaf="">空间共定位</span></h3><pre><ol><li><code><span><span leaf=""># run CellTrek analysis sequentially for the three groups</span></span></code></li><li><code><span><span leaf="">all_data_grp_ls </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> xenium </span></span><span><span leaf="">%&gt;%</span></span><span><span leaf=""> </span></span><span><span leaf="">SplitObject</span></span><span><span leaf="">(</span></span><span><span leaf="">split</span></span><span><span leaf="">.</span></span><span><span leaf="">by</span></span><span><span leaf=""> </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">"group"</span></span><span><span leaf="">)</span></span></code></li><li><code></code></li><li><code><span><span leaf=""># run celltrek</span></span></code></li><li><code><span><span leaf="">all_celltrek_ls </span></span><span><span leaf="">&lt;-</span></span></code></li><li><code><span><span leaf="">  all_data_grp_ls </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  map</span></span><span><span leaf="">(</span></span><span><span leaf="">function</span></span><span><span leaf="">(</span></span><span><span leaf="">sc</span></span><span><span leaf="">){</span></span><span><span leaf=""> </span></span><span><span leaf=""># browser()</span></span></code></li><li><code><span><span leaf="">    graph_KL </span></span><span><span leaf="">&lt;-</span></span></code></li><li><code><span><span leaf="">      </span></span><span><span leaf="">CellTrek</span></span><span><span leaf="">::</span></span><span><span leaf="">scoloc</span></span><span><span leaf="">(</span></span></code></li><li><code><span><span leaf="">        sc</span></span><span><span leaf="">,</span></span></code></li><li><code><span><span leaf="">        col_cell   </span></span><span><span leaf="">=</span></span><span><span leaf="">'annotation'</span></span><span><span leaf="">,</span></span></code></li><li><code><span><span leaf="">        use_method </span></span><span><span leaf="">=</span></span><span><span leaf="">'KL'</span></span><span><span leaf="">,</span></span></code></li><li><code><span><span leaf="">        h   </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">10</span></span><span><span leaf="">,</span></span></code></li><li><code><span><span leaf="">        eps </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">1e-50</span></span></code></li><li><code><span><span leaf="">      </span></span><span><span leaf="">)</span></span></code></li><li><code></code></li><li><code><span><span leaf="">    cells </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> sc$annotation </span></span><span><span leaf="">%&gt;%</span></span><span><span leaf=""> unique</span></span><span><span leaf="">()</span></span></code></li><li><code><span><span leaf="">    names</span></span><span><span leaf="">(</span></span><span><span leaf="">cells</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> cells </span></span><span><span leaf="">%&gt;%</span></span><span><span leaf=""> make</span></span><span><span leaf="">.</span></span><span><span leaf="">names</span></span><span><span leaf="">()</span></span></code></li><li><code></code></li><li><code><span><span leaf="">    </span></span><span><span leaf="">## We extract the minimum spanning tree (MST) result from the graph</span></span></code></li><li><code><span><span leaf="">    graph_KL_mst_cons </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> graph_KL$mst_cons</span></span></code></li><li><code><span><span leaf="">    rownames</span></span><span><span leaf="">(</span></span><span><span leaf="">graph_KL_mst_cons</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">&lt;-</span></span></code></li><li><code><span><span leaf="">      colnames</span></span><span><span leaf="">(</span></span><span><span leaf="">graph_KL_mst_cons</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">&lt;-</span></span></code></li><li><code><span><span leaf="">      cells</span></span><span><span leaf="">[</span></span><span><span leaf="">colnames</span></span><span><span leaf="">(</span></span><span><span leaf="">graph_KL_mst_cons</span></span><span><span leaf="">)]</span></span></code></li><li><code></code></li><li><code><span><span leaf="">    </span></span><span><span leaf="">## We then extract the metadata (including cell types and their frequencies)</span></span></code></li><li><code><span><span leaf="">    cell_class </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> sc</span></span><span><span leaf="">[[]]</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      group_by</span></span><span><span leaf="">(</span></span><span><span leaf="">annotation</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      summarise</span></span><span><span leaf="">(</span></span><span><span leaf="">n </span></span><span><span leaf="">=</span></span><span><span leaf=""> n</span></span><span><span leaf="">())</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      </span></span><span><span leaf="">as</span></span><span><span leaf="">.</span></span><span><span leaf="">data</span></span><span><span leaf="">.</span></span><span><span leaf="">frame</span></span><span><span leaf="">()</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      dplyr</span></span><span><span leaf="">::</span></span><span><span leaf="">rename</span></span><span><span leaf="">(</span></span><span><span leaf="">id </span></span><span><span leaf="">=</span></span><span><span leaf=""> annotation</span></span><span><span leaf="">)</span></span></code></li><li><code></code></li><li><code><span><span leaf="">    list</span></span><span><span leaf="">(</span></span></code></li><li><code><span><span leaf="">      mst </span></span><span><span leaf="">=</span></span><span><span leaf=""> graph_KL_mst_cons</span></span><span><span leaf="">,</span></span></code></li><li><code><span><span leaf="">      cell_class </span></span><span><span leaf="">=</span></span><span><span leaf=""> cell_class</span></span></code></li><li><code><span><span leaf="">    </span></span><span><span leaf="">)</span></span></code></li><li><code><span><span leaf="">  </span></span><span><span leaf="">})</span></span></code></li><li><code></code></li><li><code><span><span leaf=""># celltrek network can be visualized by scoloc_vis</span></span></code></li><li><code><span><span leaf=""># group A:</span></span></code></li><li><code><span><span leaf="">CellTrek</span></span><span><span leaf="">::</span></span><span><span leaf="">scoloc_vis</span></span><span><span leaf="">(</span></span><span><span leaf="">all_celltrek_ls$A$mst</span></span><span><span leaf="">,</span></span><span><span leaf=""> meta_data </span></span><span><span leaf="">=</span></span><span><span leaf=""> all_data_grp_ls$A</span></span><span><span leaf="">[[]])</span></span></code></li></ol></pre><h3><span leaf="">共定位网络图绘制</span></h3><pre><ol><li><code><span><span leaf=""># plot celltrek network by igraph</span></span></code></li><li><code></code></li><li><code><span><span leaf="">cell_colors </span></span><span><span leaf="">&lt;-</span></span><span><span leaf=""> ggsci</span></span><span><span leaf="">::</span></span><span><span leaf="">pal_igv</span></span><span><span leaf="">()(</span></span><span><span leaf="">10</span></span><span><span leaf="">)</span></span></code></li><li><code></code></li><li><code><span><span leaf="">p_all_celltrek_ls </span></span><span><span leaf="">&lt;-</span></span></code></li><li><code><span><span leaf="">  all_celltrek_ls </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">  map</span></span><span><span leaf="">(</span></span><span><span leaf="">function</span></span><span><span leaf="">(</span></span><span><span leaf="">ct</span></span><span><span leaf="">){</span></span></code></li><li><code><span><span leaf="">    graph </span></span><span><span leaf="">&lt;-</span></span></code></li><li><code><span><span leaf="">      ct$mst </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      </span></span><span><span leaf="">as</span></span><span><span leaf="">.</span></span><span><span leaf="">data</span></span><span><span leaf="">.</span></span><span><span leaf="">frame</span></span><span><span leaf="">()</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      rownames_to_column</span></span><span><span leaf="">(</span></span><span><span leaf="">'from'</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span><span><span leaf=""> </span></span></code></li><li><code><span><span leaf="">      pivot_longer</span></span><span><span leaf="">(-</span></span><span><span leaf="">from</span></span><span><span leaf="">,</span></span><span><span leaf=""> names_to </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">"to"</span></span><span><span leaf="">,</span></span><span><span leaf=""> values_to </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">"weight"</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      dplyr</span></span><span><span leaf="">::</span></span><span><span leaf="">filter</span></span><span><span leaf="">(</span></span><span><span leaf="">weight </span></span><span><span leaf="">&gt;</span></span><span><span leaf=""> </span></span><span><span leaf="">0.2</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      igraph</span></span><span><span leaf="">::</span></span><span><span leaf="">graph_from_data_frame</span></span><span><span leaf="">()</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      tidygraph</span></span><span><span leaf="">::</span></span><span><span leaf="">as_tbl_graph</span></span><span><span leaf="">()</span></span><span><span leaf=""> </span></span></code></li><li><code></code></li><li><code></code></li><li><code><span><span leaf="">    </span></span><span><span leaf="">set</span></span><span><span leaf="">.</span></span><span><span leaf="">seed</span></span><span><span leaf="">(</span></span><span><span leaf="">12345</span></span><span><span leaf="">)</span></span></code></li><li><code><span><span leaf="">    p </span></span><span><span leaf="">&lt;-</span></span></code></li><li><code><span><span leaf="">      graph </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      tidygraph</span></span><span><span leaf="">::</span></span><span><span leaf="">activate</span></span><span><span leaf="">(</span></span><span><span leaf="">nodes</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      left_join</span></span><span><span leaf="">(</span></span><span><span leaf="">ct$cell_class</span></span><span><span leaf="">,</span></span><span><span leaf=""> </span></span><span><span leaf="">by</span></span><span><span leaf=""> </span></span><span><span leaf="">=</span></span><span><span leaf=""> c</span></span><span><span leaf="">(</span></span><span><span leaf="">name </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">'id'</span></span><span><span leaf="">))</span></span><span><span leaf=""> </span></span><span><span leaf="">%&gt;%</span></span></code></li><li><code><span><span leaf="">      ggraph</span></span><span><span leaf="">::</span></span><span><span leaf="">ggraph</span></span><span><span leaf="">(</span></span><span><span leaf="">layout </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">'fr'</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span><span><span leaf=""> </span></span><span><span leaf="">#, weights = weight) +</span></span></code></li><li><code><span><span leaf="">      ggraph</span></span><span><span leaf="">::</span></span><span><span leaf="">geom_edge_link</span></span><span><span leaf="">(</span></span><span><span leaf="">aes</span></span><span><span leaf="">(</span></span><span><span leaf="">width </span></span><span><span leaf="">=</span></span><span><span leaf=""> weight</span></span><span><span leaf="">),</span></span><span><span leaf=""> color </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">'gray'</span></span><span><span leaf="">,</span></span><span><span leaf=""> show</span></span><span><span leaf="">.</span></span><span><span leaf="">legend </span></span><span><span leaf="">=</span></span><span><span leaf=""> FALSE</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">      ggraph</span></span><span><span leaf="">::</span></span><span><span leaf="">geom_node_point</span></span><span><span leaf="">(</span></span><span><span leaf="">aes</span></span><span><span leaf="">(</span></span><span><span leaf="">size </span></span><span><span leaf="">=</span></span><span><span leaf=""> n</span></span><span><span leaf="">,</span></span><span><span leaf=""> color </span></span><span><span leaf="">=</span></span><span><span leaf=""> name</span></span><span><span leaf="">),</span></span><span><span leaf=""> show</span></span><span><span leaf="">.</span></span><span><span leaf="">legend </span></span><span><span leaf="">=</span></span><span><span leaf=""> FALSE</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">      ggraph</span></span><span><span leaf="">::</span></span><span><span leaf="">geom_node_text</span></span><span><span leaf="">(</span></span><span><span leaf="">aes</span></span><span><span leaf="">(</span></span><span><span leaf="">label </span></span><span><span leaf="">=</span></span><span><span leaf=""> name</span></span><span><span leaf="">),</span></span><span><span leaf=""> color </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">'gray10'</span></span><span><span leaf="">,</span></span><span><span leaf=""> nudge_y</span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">-</span></span><span><span leaf="">0.2</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">      ggraph</span></span><span><span leaf="">::</span></span><span><span leaf="">scale_edge_width</span></span><span><span leaf="">(</span></span><span><span leaf="">range </span></span><span><span leaf="">=</span></span><span><span leaf=""> c</span></span><span><span leaf="">(</span></span><span><span leaf="">1</span></span><span><span leaf="">,</span></span><span><span leaf=""> </span></span><span><span leaf="">4</span></span><span><span leaf="">))</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">      scale_size</span></span><span><span leaf="">(</span></span><span><span leaf="">range </span></span><span><span leaf="">=</span></span><span><span leaf=""> c</span></span><span><span leaf="">(</span></span><span><span leaf="">4</span></span><span><span leaf="">,</span></span><span><span leaf=""> </span></span><span><span leaf="">12</span></span><span><span leaf="">))</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">      </span></span><span><span leaf=""># ggsci::scale_color_igv() +</span></span></code></li><li><code><span><span leaf="">      scale_color_manual</span></span><span><span leaf="">(</span></span><span><span leaf="">values </span></span><span><span leaf="">=</span></span><span><span leaf=""> cell_colors</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">      coord_fixed</span></span><span><span leaf="">(</span></span><span><span leaf="">clip </span></span><span><span leaf="">=</span></span><span><span leaf=""> </span></span><span><span leaf="">'off'</span></span><span><span leaf="">)</span></span><span><span leaf=""> </span></span><span><span leaf="">+</span></span></code></li><li><code><span><span leaf="">      theme_void</span></span><span><span leaf="">()</span></span></code></li><li><code><span><span leaf="">    p</span></span></code></li><li><code><span><span leaf="">  </span></span><span><span leaf="">})</span></span></code></li></ol></pre><p><span leaf="">celltrek网络图入下：</span></p><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9PkmFOPUwa2M58rpMEicL9gZ18rkCEibxHb2Nup1ygZK6ibUnvDvKhc0L0nRyZQ5W8icZftRaibLQZqrw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100049171" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9PkmFOPUwa2M58rpMEicL9gZ18rkCEibxHb2Nup1ygZK6ibUnvDvKhc0L0nRyZQ5W8icZftRaibLQZqrw/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/tWRNh0P_icAj38QU-Hsqtw",target="_blank" rel="noopener noreferrer">原文链接</a>
