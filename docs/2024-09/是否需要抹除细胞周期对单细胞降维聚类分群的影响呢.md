---
title: "是否需要抹除细胞周期对单细胞降维聚类分群的影响呢"
date: 2024-09-18T13:07:49Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
是否需要抹除细胞周期对单细胞降维聚类分群的影响呢 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>前面的第一层次降维聚类分群，我们单独命名了一个细胞增殖亚群，如果看它的top10的特异性基因，是可以比较清晰的看到我们的定义的cycle细胞亚群主要是t细胞和b细胞的混合体，也是蛮奇怪的， 我处理很多其它癌症的单细胞转录组数据集经常是肯定肿瘤细胞会有恶性增殖的现象，这个数据集居然是一个例外。</p></blockquote><figure data-tool="mdnice编辑器"><img data-imgfileid="100050098" data-ratio="1.3351851851851853" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZuzbogC2KvwUeGYZJvH5t3uUEHJR92Omq0wDatH8C0E2wQ2oOe4f2uA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZuzbogC2KvwUeGYZJvH5t3uUEHJR92Omq0wDatH8C0E2wQ2oOe4f2uA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">然后，文献附件里面单独探讨了是否需要抹除细胞周期对单细胞降维聚类分群的影响，主要是做了 cell cycle regression 前后的PCA图，它给出来的图如下所示：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050096" data-ratio="1.0046296296296295" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZZAYmjBPmaoib5JlYR9ud7kjO8NNibumP1ljFZ8MIuuzZdGn4LtOLkNbw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZZAYmjBPmaoib5JlYR9ud7kjO8NNibumP1ljFZ8MIuuzZdGn4LtOLkNbw/640?wx_fmt=jpeg&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">但是我怀疑作者的图表可能有点问题，因为做了 cell cycle regression 前后的降维聚类分群tSNE图几乎是一模一样，也是太巧合了吧！</p><p data-tool="mdnice编辑器">因为做了 cell cycle regression 并不影响聚类分群，所以作者最后的选择是不需要做 cell cycle regression ，如下所示：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050097" data-ratio="1.087962962962963" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZmhbCibVbye7hJXQiaicibMe9smCIApGKnfgYzTR4NN2dYkxawxE7hnu7Lg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZmhbCibVbye7hJXQiaicibMe9smCIApGKnfgYzTR4NN2dYkxawxE7hnu7Lg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>实战一下</span><span></span></h3><p data-tool="mdnice编辑器">前面针对这个这个胃癌单细胞数据集GSE163558，我做了解读，详见 ：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533053&amp;idx=1&amp;sn=bd155638b280e875dcae14622198b65b&amp;scene=21#wechat_redirect" data-linktype="2">单细胞转录组降维聚类分群过滤基因和过滤细胞的区别</a> 。而且前面已经是完成了降维聚类分群，在<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533061&amp;idx=1&amp;sn=de67737df31c0302667d9c7a75214415&amp;scene=21#wechat_redirect" data-linktype="2">学习单细胞亚群命名的层次结构</a> 演示了一个降维聚类分群结果，就有了  2-harmony/sce.all_int.rds 文件，以及对应的 phe.Rdata 注释信息。</p><p data-tool="mdnice编辑器">因为细胞周期回归这个步骤非常耗费时间，所以我选择了针对我们的单细胞转录组表达量矩阵降维聚类分群后的每个单细胞亚群抽样1000个细胞来测试流程即可：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>) <br>getwd()<br><span>source</span>(<span>'./scRNA_scripts/lib.R'</span>)<br>sce.all.int = readRDS(<span>'2-harmony/sce.all_int.rds'</span>)<br>load(<span>'phe.Rdata'</span>) <br>sce.all.int$celltype=phe$celltype<br>sel.clust = <span>"celltype"</span><br>sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>table(sce.all.int@active.ident) <br>sce.all.int = subset(sce.all.int,downsample=<span>1000</span>) <br>DimPlot(sce.all.int,label = <span>T</span>,repel = <span>T</span>) <br></code></pre><p data-tool="mdnice编辑器">可以很明显的看到我们的抽样并不会影响整体的降维聚类分群：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050095" data-ratio="0.6108108108108108" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZs8Iuu1yKLw6fo5dqNOqibq7ibNW3UqQ4MV1GIibMzkm1pR0fQPETy3cJg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="740" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZs8Iuu1yKLw6fo5dqNOqibq7ibNW3UqQ4MV1GIibMzkm1pR0fQPETy3cJg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>细胞周期计算靠CellCycleScoring函数：</span><span></span></h3><p data-tool="mdnice编辑器">被我命名为cycle的亚群很明显主要是t细胞，但是它细胞周期打分就非常高，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>s.genes &lt;- str_to_upper(cc.genes$s.genes)<br>g2m.genes &lt;- str_to_upper(cc.genes$g2m.genes)<br>s.genes;g2m.genes <br>sce=sce.all.int<br>sce &lt;- CellCycleScoring(sce, <br>                        s.features = s.genes, <br>                        g2m.features = g2m.genes, <br>                        set.ident = <span>TRUE</span>)<br><br>colnames(sce@meta.data)<br>p1=VlnPlot(sce,features =  <span>"S.Score"</span> ,pt.size = <span>0</span>,group.by = <span>'celltype'</span>) +NoLegend()<br>p2=VlnPlot(sce,features =  <span>"G2M.Score"</span> ,pt.size = <span>0</span>,group.by = <span>'celltype'</span>)+NoLegend()<br>p1+p2<br>table(sce$Phase,sce$celltype) <br></code></pre><p data-tool="mdnice编辑器">可以看到，这两个打分都是</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050094" data-ratio="0.5918918918918918" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZicvXehXLPatEZgzCjicWKmssBiax1HX56iag03vibMtdLKiclCxVZfEjJhEA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="740" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZicvXehXLPatEZgzCjicWKmssBiax1HX56iag03vibMtdLKiclCxVZfEjJhEA/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>&gt; table(sce<span>$Phase</span>,sce<span>$celltype</span>)<br>     <br>      Bcells cycle endo epi fibro mac mast neutrophils plasma Tcells<br>  G1     607     0  364 563   783 898  128         822    911    650<br>  G2M     94   381   22 201    40  42    6          85     34    148<br>  S      299   241   41 236    69  60    8          93     55    202<br></code></pre><p data-tool="mdnice编辑器">这个时候需要补充一下生物学背景知识，就让人工智能大模型帮我们整理吧：</p><p data-tool="mdnice编辑器">细胞周期是细胞生长、复制DNA并分裂为两个新细胞的过程。细胞周期主要分为四个阶段：G1期（生长期）、S期（合成期）、G2期（准备期）和M期（分裂期）。以下是各个阶段的描述：</p><ol data-tool="mdnice编辑器"><li><section><p><strong>G1期（生长期）</strong>：</p></section></li></ol><ul><li><section>在G1期，细胞生长并合成蛋白质，为DNA复制做准备。这个阶段是细胞周期中最长的阶段，细胞会评估其环境和内部状态，以决定是否继续进行细胞周期或进入静止状态（G0期）。</section></li></ul><li><section><p><strong>S期（合成期）</strong>：</p></section></li><ul><li><section>S期是细胞复制其DNA的阶段。在这个阶段，每个染色体都被精确复制，形成两个相同的染色单体，为后续的细胞分裂做准备。</section></li></ul><li><section><p><strong>G2期（准备期）</strong>：</p></section></li><ul><li><section>G2期是细胞在进行分裂前的最后准备阶段。在这个阶段，细胞继续合成蛋白质，并检查DNA复制过程中可能出现的错误，进行修复。</section></li></ul><li><section><p><strong>M期（分裂期）</strong>：</p></section></li><ul><li><section>M期，也称为有丝分裂，是细胞实际分裂成两个新细胞的阶段。M期进一步分为前期（Prophase）、中期（Metaphase）、后期（Anaphase）和末期（Telophase），最后是细胞质分裂的胞质分裂（Cytokinesis）。</section></li></ul><p data-tool="mdnice编辑器"><strong>处于增殖期的状态</strong>：</p><ul data-tool="mdnice编辑器"><li><section>处于增殖期的细胞是指那些正在进行细胞周期的细胞，即处于G1期、S期、G2期和M期的细胞。这些细胞正在积极地准备、进行或完成细胞分裂。</section></li><li><section>其中"G2M"通常是指G2期和M期的连续过程，而不是一个单独的阶段。G2期是细胞在完成DNA复制后（S期）进入的阶段，准备进行细胞分裂。M期，或称为有丝分裂期，是细胞实际进行染色体分离和细胞分裂的阶段。在某些文献中，研究人员可能会将G2期和M期一起讨论，因为它们在细胞准备分裂的过程中是连续的，所以有时会简称为"G2M期"。这种表述方式强调了细胞从G2期过渡到M期的连续性，以及这两个阶段在细胞周期中的重要性。</section></li></ul><p data-tool="mdnice编辑器">在生物学概念的细胞周期中，只有处于G1期、S期和G2期的细胞才被认为是处于增殖期，因为它们正在准备或进行DNA复制和细胞分裂。M期是细胞周期的最后阶段，细胞在这个阶段实际分裂成两个新的细胞。而G0期是细胞周期的一个可选阶段，细胞可以暂时退出细胞周期，进入静止状态，直到接收到适当的信号重新开始细胞周期。</p><p data-tool="mdnice编辑器">但是从我们上面的代码运行结果来看，所有的细胞都会被归类为G1,G2M和S期，后面的两个才是降维聚类分群里面的细胞增殖状态的亚群。</p><h3 data-tool="mdnice编辑器"><span></span><span>回归靠ScaleData函数：</span><span></span></h3><p data-tool="mdnice编辑器">如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#  回归"S.Score","G2M.Score" </span><br>input_sce &lt;- ScaleData(sce, features = rownames(sce),<br>                   vars.to.regress = c(<span>"S.Score"</span>,<span>"G2M.Score"</span>) )  <br>input_sce&lt;-RunPCA(input_sce ) <br>p1=DimPlot(input_sce,reduction=<span>"pca"</span>) + DimPlot(sce,reduction=<span>"pca"</span>)<br>p2=DimPlot(input_sce,reduction=<span>"pca"</span>,group.by=<span>'celltype'</span>) + DimPlot(sce.all.int,reduction=<span>"pca"</span>) +NoLegend()<br>p1/p2<br>seuratObj&lt;-RunHarmony(input_sce,<span>"orig.ident"</span>)<br>names(seuratObj@reductions)<br>seuratObj&lt;-RunUMAP(seuratObj,dims=<span>1</span>:<span>15</span>,<br>                     reduction=<span>"harmony"</span>)<br>p=DimPlot(seuratObj,reduction=<span>"umap"</span>,label=<span>T</span>,group.by=<span>'celltype'</span>);p<br></code></pre><p data-tool="mdnice编辑器">很明显的可以看到这个ScaleData函数确实是影响了表达量矩阵以及后面的pca分析 ，前后的效果对比如下所示 ：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050103" data-ratio="0.8907407407407407" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZicjgOe8HM7hrIektX2ia3nVpqfHzibVbFkbyTEKTOMuh2foKLlicflnTCQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZicjgOe8HM7hrIektX2ia3nVpqfHzibVbFkbyTEKTOMuh2foKLlicflnTCQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">但是让我比较意外的是，这个操作并不会把cycle细胞亚群给打散到其它单细胞亚群，如下所示这个cycle细胞亚群仍然是自己聚集在一起。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050102" data-ratio="0.6982591876208898" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZGCtLIY6umFjPdjDlhOqCMvDRGSwZCMzpwlQgENSSiagmHky1MyjicX0w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1034" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZGCtLIY6umFjPdjDlhOqCMvDRGSwZCMzpwlQgENSSiagmHky1MyjicX0w/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">后来我思考了一下，我们的定义的cycle细胞亚群主要是t细胞和b细胞的混合体，所以其实这个cycle细胞亚群确实是被打散到其它单细胞亚群，不过是分散到t细胞和b细胞的亚群里面。所以，总体来说，这个细胞周期的回归是成功的！</p></section><p><br></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span>写在文末</span></h3></section><p>如果你也想做单细胞转录组数据分析，<span>最好是有自己的计算机资源哦，比如我们的</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533037&amp;idx=2&amp;sn=e6dd07e9339a84c8cbad2a9d6b42c8ca&amp;chksm=9b4b0156ac3c88403c55822722f6a93cde401fbb7b7cdbaee2a07211347e751ce414b7a47ec7&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然‍是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a><span>，而且还需要有基本的生物信息学基础，也可以看看我们的</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531929&amp;idx=1&amp;sn=f6f16b7bf6b907360d6d0052e3d10cf6&amp;chksm=9b4b3d22ac3cb434b6aa7753a4cf0f266578147ccf10b49cc834e46af578ee6de99be0accb30&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉‍松授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a><span> ，你的生物信息学入门课。</span></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/b3b0WeL4c-4gRYY7LRg81w",target="_blank" rel="noopener noreferrer">原文链接</a>
