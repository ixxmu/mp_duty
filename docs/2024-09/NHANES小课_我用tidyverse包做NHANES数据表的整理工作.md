---
title: "NHANES小课|我用tidyverse包做NHANES数据表的整理工作"
date: 2024-09-30T09:37:00Z
draft: ["false"]
tags: [
  "fetched",
  "R语言"
]
categories: ["Acdemic"]
---
NHANES小课|我用tidyverse包做NHANES数据表的整理工作 by R语言
------
<div><p cid="n590" mdtype="paragraph"><span md-inline="plain">大家好，我是王路情博士，一个坚持早上5点起床和使用R语言的数据科研工作者。</span></p><p cid="n597" mdtype="paragraph"><span md-inline="plain">NHANES小课自推出后，获得朋友们的喜欢和肯定，感谢大家的支持、关注、点赞和转发。</span></p><p cid="n599" mdtype="paragraph"><br></p><p cid="n601" mdtype="paragraph"><span md-inline="plain">我继续创作。</span></p><p cid="n595" mdtype="paragraph">当我们根据<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA4NDgyMzkyMA==&amp;mid=2650633450&amp;idx=1&amp;sn=094c485ffb030461668a4728d087a2b2&amp;chksm=87e88ef5b09f07e302a54bce222952b7b83d6afd73f84bcbb259f1e7171327043173679bb807&amp;scene=21#wechat_redirect" textvalue="科研选题" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span><strong>科研选题</strong></span></a>，确定好数据清单后，利用<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA4NDgyMzkyMA==&amp;mid=2650633463&amp;idx=1&amp;sn=c35969f79cb426326cd15bdd0e64e3f6&amp;chksm=87e88ee8b09f07fea97cb2b99bbae72b6029e13849fe085cf91e26e220c2f11588385b29fc07&amp;scene=21#wechat_redirect" textvalue="nhanesA包获取数据库" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span><strong>nhanesA包获取数据库</strong></span></a><span md-inline="plain">后，接下来，就需要<strong>对所获取的数据做整理工作</strong>。</span></p><p cid="n593" mdtype="paragraph"><span md-inline="plain">NHANES小课第五课，“<strong>我用tidyverse包做NHANES数据库表的整理工作</strong>"。</span></p><p cid="n603" mdtype="paragraph"><br></p><p cid="n605" mdtype="paragraph"><span md-inline="plain">tidyverse包，一个数据科学工具套件，可以高效而便利地完成数据科学整个工作流的任务。</span></p><p cid="n607" mdtype="paragraph"><span md-inline="plain">在这里，我们充分利用tidyverse包做NHANES数据库获取数据表后的整理工作，主要任务清单包括：</span></p><p cid="n609" mdtype="paragraph"><strong><span md-inline="plain">1）使用select函数，选取研究的变量</span></strong></p><p cid="n611" mdtype="paragraph"><strong><span md-inline="plain">2）使用bind_rows函数，对跨周期的多个数据表做横向拼接，做队列研究</span></strong></p><p cid="n614" mdtype="paragraph"><strong><span md-inline="plain">3）使用连接函数（full_join/left_join/inner_join），对同一周期的多个数据表做纵向延伸，做横断面研究</span></strong></p><p cid="n619" mdtype="paragraph"><strong><span md-inline="plain">4）使用filter函数，做基于条件的纳排处理</span></strong></p><p cid="n622" mdtype="paragraph"><strong><span md-inline="plain">5）使用recode_factor函数，对变量取值做映射编码并为因子类型</span></strong></p><p cid="n707" mdtype="paragraph"><strong><span md-inline="plain">6）使用mutate函数，做变量设计和衍生</span></strong></p><p cid="n710" mdtype="paragraph"><strong><span md-inline="plain">7）使用rename函数，对变量名做重命名</span></strong></p><p cid="n713" mdtype="paragraph"><strong><span md-inline="plain">8）使用case_when函数和if_else函数，做条件处理</span></strong></p><p cid="n716" mdtype="paragraph"><br></p><p cid="n625" mdtype="paragraph"><span md-inline="plain">实际上，上述函数，都是dplyr包里面提供的函数集，这些函数对于我们整理NHANES数据表，非常有用。</span></p><p cid="n630" mdtype="paragraph"><br></p><p cid="n632" mdtype="paragraph"><span md-inline="plain">本课，希望达成这些目标：</span></p><p cid="n634" mdtype="paragraph"><strong><span md-inline="plain">1）温习dplyr包的常用函数和使用方法</span></strong></p><p cid="n636" mdtype="paragraph"><strong><span md-inline="plain">2）以一篇NHANES论文举例说明，如何结合nhanesA和tidyverse包完成NHANES数据表的获取和整理工作</span></strong></p><p cid="n605" mdtype="paragraph"><span md-inline="plain"><br></span></p><p cid="n647" mdtype="paragraph"><span><strong>一、dplyr包学习</strong></span></p><p cid="n651" mdtype="paragraph"><span md-inline="plain">我在网上找了一份<strong>dplyr包的cheat sheet的PDF文档</strong>，我把它贴上来，并且把重要的函数，用红色方框圈出来，同时，对于这些函数，我在后面附上一份代码示例。</span></p><p><img data-galleryid="" data-imgfileid="503149817" data-ratio="0.7657407407407407" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0zibIaph43Cgmfm6PzI3ElUajAPUKKPkHia1lSPGeH1XLMfkjIIFCC4uA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0zibIaph43Cgmfm6PzI3ElUajAPUKKPkHia1lSPGeH1XLMfkjIIFCC4uA/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="503149818" data-ratio="0.7694444444444445" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0ZN2XYXMf2QHTxiaC6IdYtmaPdhDN4brJ8h4zrdPaWFDhsicmYtWTYqvQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0ZN2XYXMf2QHTxiaC6IdYtmaPdhDN4brJ8h4zrdPaWFDhsicmYtWTYqvQ/640?wx_fmt=png&amp;from=appmsg"></p><p cid="n651" mdtype="paragraph"><span>关于这个手册的学习有任何问题可以加我微信，交流和沟通。</span><span md-inline="plain"></span></p><p cid="n657" mdtype="paragraph"><span md-inline="plain">当我们加载tidyverse包后，这个数据科学套件工具，已经包括了<strong>dplyr包</strong>。</span></p><p cid="n659" mdtype="paragraph"><span md-inline="plain">tidyverse包的生态，如下图：</span></p><p><img data-galleryid="" data-imgfileid="503149819" data-ratio="0.7111111111111111" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0ecO2gW3G3fTouypr183rKXSrP3tGXa07iaAKibPHkib8lYRDy5100MxSQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0ecO2gW3G3fTouypr183rKXSrP3tGXa07iaAKibPHkib8lYRDy5100MxSQ/640?wx_fmt=png&amp;from=appmsg"></p><p cid="n659" mdtype="paragraph"><span md-inline="plain"><span>dplyr包，非常强大的数据管理包，对于数据的处理和整理，非常好用和有效。因此，建议用R语言做数据加工处理的朋友，一定要重视这个包的学习和使用，先从常用的函数学习和应用入手。</span></span></p><p cid="n796" mdtype="paragraph"><span md-inline="plain">在此，我提供一份代码示例，演示dplyr包常用函数的使用，关于这份代码示例，有任何问题，可以加我微信讨论。</span></p><pre spellcheck="false" lang="R" cid="n800" mdtype="fences"><span role="presentation"><span>#### 1 加载R包 ####</span></span><br><span role="presentation"><span>library</span>(<span>pacman</span>)</span><br><span role="presentation"><span>p_load</span>(<span>'tidyverse'</span>)</span><br><br><span role="presentation"><span>#### 2 数据集准备 ####</span></span><br><span role="presentation"><span>df</span> <span>&lt;-</span> <span>data.frame</span>(</span><br><span role="presentation">  <span>id</span> = <span>c</span>(<span>10</span>,<span>11</span>,<span>12</span>,<span>13</span>,<span>14</span>,<span>15</span>,<span>16</span>,<span>17</span>),</span><br><span role="presentation">  <span>name</span> = <span>c</span>(<span>'sai'</span>,<span>'ram'</span>,<span>'deepika'</span>,<span>'sahithi'</span>,<span>'kumar'</span>,<span>'scott'</span>,<span>'Don'</span>,<span>'Lin'</span>),</span><br><span role="presentation">  <span>gender</span> = <span>c</span>(<span>'M'</span>,<span>'M'</span>,<span>'F'</span>,<span>'F'</span>,<span>'M'</span>,<span>'M'</span>,<span>'M'</span>,<span>'F'</span>),</span><br><span role="presentation">  <span>dob</span> = <span>as.Date</span>(<span>c</span>(<span>'1990-10-02'</span>,<span>'1981-3-24'</span>,<span>'1987-6-14'</span>,<span>'1985-8-16'</span>,</span><br><span role="presentation">                  <span>'1995-03-02'</span>,<span>'1991-6-21'</span>,<span>'1986-3-24'</span>,<span>'1990-8-26'</span>)),</span><br><span role="presentation">  <span>state</span> = <span>c</span>(<span>'CA'</span>,<span>'NY'</span>,<span>NA</span>,<span>NA</span>,<span>'DC'</span>,<span>'DW'</span>,<span>'AZ'</span>,<span>'PH'</span>),</span><br><span role="presentation">  <span>row.names</span>=<span>c</span>(<span>'r1'</span>,<span>'r2'</span>,<span>'r3'</span>,<span>'r4'</span>,<span>'r5'</span>,<span>'r6'</span>,<span>'r7'</span>,<span>'r8'</span>)</span><br><span role="presentation">)</span><br><span role="presentation"><span>df</span></span><br><br><span role="presentation"><span>#### 3 dplyr包使用演示 ####</span></span><br><span role="presentation"><span># 1 选变量</span></span><br><span role="presentation"><span>df</span> <span>%&gt;%</span> <span>select</span>(<span>c</span>(<span>'id'</span>,<span>'name'</span>))</span><br><span role="presentation"><span># 2 选样本子集</span></span><br><span role="presentation"><span>df</span> <span>%&gt;%</span> <span>filter</span>(<span>state</span> <span>%in%</span> <span>c</span>(<span>"CA"</span>, <span>"AZ"</span>, <span>"PH"</span>))</span><br><span role="presentation"><span>df</span> <span>%&gt;%</span> <span>filter</span>(<span>gender</span> <span>==</span> <span>'M'</span> <span>&amp;</span> <span>id</span> <span>&gt;</span> <span>15</span>)</span><br><span role="presentation"><span># 3 创建新的变量</span></span><br><span role="presentation"><span>df</span> <span>%&gt;%</span> </span><br><span role="presentation">  <span>mutate</span>(<span>name</span> <span>=</span> <span>str_replace</span>(<span>name</span>, <span>"sai"</span>, <span>"SaiRam"</span>))</span><br><br><span role="presentation"><span># 4 重命名变量名</span></span><br><span role="presentation"><span>colnames</span>(<span>df</span>)</span><br><span role="presentation"><span># 使用rename函数，把gender重命名为sex</span></span><br><span role="presentation"><span>df</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>rename</span>(<span>sex</span> <span>=</span> <span>gender</span>)</span><br><br><span role="presentation"><span># 5 数据的合并操作</span></span><br><span role="presentation"><span># 5.1 横向合并</span></span><br><span role="presentation"><span># 使用bind_rows函数</span></span><br><span role="presentation"><span>df1</span> <span>&lt;-</span> <span>df</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>slice_head</span>(<span>n</span><span>=</span><span>2</span>)</span><br><span role="presentation"><span>df2</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>df</span>, <span>df1</span>)) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span>df2</span></span><br><br><span role="presentation"><span># 5.2 纵向合并</span></span><br><span role="presentation"><span>df3</span> <span>&lt;-</span> <span>data.frame</span>(</span><br><span role="presentation">  <span>id</span> = <span>c</span>(<span>12</span>, <span>13</span>),</span><br><span role="presentation">  <span>score</span> = <span>c</span>(<span>80</span>, <span>90</span>)</span><br><span role="presentation">)</span><br><span role="presentation"><span># 全连接 full_join</span></span><br><span role="presentation"><span>df</span> <span>%&gt;%</span> <span>full_join</span>(<span>df3</span>)</span><br><span role="presentation"><span># 左连接</span></span><br><span role="presentation"><span>df</span> <span>%&gt;%</span> <span>left_join</span>(<span>df3</span>)</span><br><span role="presentation"><span># 内连接</span></span><br><span role="presentation"><span>df</span> <span>%&gt;%</span> <span>inner_join</span>(<span>df3</span>)</span><br><br><span role="presentation"><span># 6 变量类型映射和转换</span></span><br><span role="presentation"><span>df</span> <span>%&gt;%</span> <span>mutate</span>(</span><br><span role="presentation">  <span>gender_1</span> = <span>case_when</span>(</span><br><span role="presentation">    <span>gender</span> == <span>'M'</span> <span>~</span> <span>1</span>,</span><br><span role="presentation">    <span>TRUE</span> <span>~</span> <span>0</span></span><br><span role="presentation">  ),</span><br><span role="presentation">  <span>gender_2</span> = <span>if_else</span>(<span>gender</span> <span>==</span> <span>'M'</span>, <span>1</span>, <span>0</span>)</span><br><span role="presentation">)</span><br><br><span role="presentation"><span>df</span> <span>%&gt;%</span> <span>mutate</span>(</span><br><span role="presentation">  <span>gender_3</span> = <span>recode_factor</span>(</span><br><span role="presentation">    <span>gender</span>,</span><br><span role="presentation">    <span>'M'</span> = <span>1</span>,</span><br><span role="presentation">    <span>'F'</span> = <span>0</span></span><br><span role="presentation">  )</span><br><span role="presentation">)</span></pre><p cid="n721" mdtype="paragraph"><strong><span>二、NHANES论文数据获取和整理</span></strong></p><p cid="n822" mdtype="paragraph"><span md-inline="plain">在此，我们以论文<strong>《Dietary carotenoids and cognitive function among US adults, NHANES 2011–2014》</strong>（美国成年人膳食类胡萝卜素与认知功能，NHANES 2011-2014）为例子。</span></p><p cid="n826" mdtype="paragraph"><span md-inline="plain">学习这个论文，并且完成这个论文里面<strong>NHANES数据表获取和整理工作</strong>。</span></p><p cid="n828" mdtype="paragraph"><strong><span md-inline="plain">论文摘要如下：</span></strong><span md-inline="plain"></span></p><p><img data-galleryid="" data-imgfileid="503149823" data-ratio="0.7037037037037037" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0bXu9r5dasEVdFKs3uuYr9t2n7w2TgkgKyQfJ9M24s5FENuMrevE7WQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0bXu9r5dasEVdFKs3uuYr9t2n7w2TgkgKyQfJ9M24s5FENuMrevE7WQ/640?wx_fmt=png&amp;from=appmsg"></p><p cid="n665" mdtype="paragraph"><strong><span md-inline="plain">摘要理解如下：</span></strong><span md-inline="plain"></span></p><p cid="n832" mdtype="paragraph"><span md-inline="plain">1）<strong>研究对象</strong>：美国成年人，选择了NHANES数据库两个周期，NHAENS2011-2014。</span></p><p cid="n834" mdtype="paragraph"><span md-inline="plain">2）<strong>研究内容</strong>：探索膳食类胡萝卜素与认知功能的关系。</span></p><p cid="n837" mdtype="paragraph"><span md-inline="plain">3）<strong>研究目的</strong>：膳食类胡萝卜素可能限制自由基对神经元的损伤，可能成为认知能力下降的一个可改变的风险因素。我们研究了 2011-2014 年全国健康和营养检查调查中年龄≥60 岁的参与者的叶黄素和玉米黄质 (L 和 Z) 摄入量与认知能力的关系。（第一句话介绍研究的可能性，第二句话介绍研究的内容）</span></p><p cid="n840" mdtype="paragraph"><span md-inline="plain">4）<strong>研究方法</strong>：通过两次非连续的 24 小时饮食回顾估计食物和补充剂中的 L 和 Z 摄入量。结局变量包括 CERAD 词汇学习子测试分数、动物流畅度测试分数和数字符号替换测试分数。回归模型根据调查设计变量、年份、性别、年龄、种族/民族、体重指数、家庭收入、教育、酒精和吸烟情况进行了调整。（第一句话，介绍论文的X变量、第二句话介绍Y变量，最后用于研究的X变量和Y变量，需要基于数据表的变量做进一步加工和整理，第三句话介绍研究的分析方法，对于自变量和因变量以及协变量，采用复杂权重调查调整后的回归模型分析）</span></p><p cid="n843" mdtype="paragraph"><span md-inline="plain">5）<strong>研究结果</strong>：在 2796 名参与者中，膳食中 L 和 Z 摄入量越高，每次测试的得分就越高。例如，与最低四分位数相比，L 和 Z 摄入量最高的四分位数，与最低四分位数相比，在数字符号分数测试中增加了2.52分（SE=0.86 分，P=0.01）。种族/民族之间存在差异，黑人参与者的正相关性通常比白人参与者更强。（总结研究的结果，同时举例进一步说明）</span></p><p cid="n846" mdtype="paragraph"><span md-inline="plain">6）<strong>研究讨论</strong>：需要进一步进行队列研究，但增加 L 和 Z 摄入量可能有助于预防或减缓认知能力下降。</span></p><p cid="n849" mdtype="paragraph"><span md-inline="plain">根据<strong>论文的标题和论文介绍的Material and methods</strong>，可以梳理出这篇论文需要用到数据模块以及对应的数据表。</span></p><p cid="n852" mdtype="paragraph"><strong><span md-inline="plain">1）选择了2个周期NHANES2011-2012、NHANES2013-2014</span></strong></p><p cid="n854" mdtype="paragraph"><strong><span md-inline="plain">2）自变量，膳食类的胡萝卜素，来自饮食模块的表</span></strong></p><p cid="n860" mdtype="paragraph"><strong><span md-inline="plain">3）因变量，认知功能评价体系，来自问卷模块的表</span></strong></p><p cid="n866" mdtype="paragraph"><strong><span md-inline="plain">4）协变量，来自人口统计模块、检查模块、问卷模块的表</span></strong><span md-inline="plain"></span></p><p cid="n869" mdtype="paragraph"><span md-inline="plain">确定好数据模块和数据表，用nhanesA包分步获取数据表，用tidyverse包对数据做整理。</span></p><p cid="n874" mdtype="paragraph"><strong><span md-inline="plain">在编写这个脚本之前，可以先把要做的事情，分步骤描述清楚</span></strong><span md-inline="plain">，如下图框架：</span></p><pre spellcheck="false" lang="R" cid="n878" mdtype="fences"><span role="presentation"><span>#### 1.确定数据表和研究变量，使用nhanesA包和tidyverse包完成工作 ####</span></span><br><span role="presentation"><span>##### 1.1 DEMO-人口学数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取</span></span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span>##### 1.2 SMQ-吸烟数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取</span></span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span>##### 1.3 ALQ-饮酒数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取</span></span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span>##### 1.4 BMX-BMI、腰围数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取</span></span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span>##### 1.5 饮食-L&amp;Z以及总卡里路数据提取（第1天&amp;第2天）#####</span></span><br><span role="presentation"><span># 1 数据表获取</span></span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span># 4 数据纵向连接</span></span><br><span role="presentation"><span>##### 1.6 膳食补充剂-L&amp;Z数据提取（第1天&amp;第2天）#####</span></span><br><span role="presentation"><span># 1 数据表获取</span></span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span># 4 数据纵向连接</span></span><br><span role="presentation"><span>##### 1.7 CFQ-认知数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取</span></span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span># 3 研究变量选取</span></span></pre><p cid="n863" mdtype="paragraph"><span md-inline="plain">上面这个框架，可以显示这个效果</span></p><p><img data-galleryid="" data-imgfileid="503149824" data-ratio="0.4824074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0iaHHo6VBaBv03LBz4IKOB84lW5PJVnlnPkrZA1l5eHLASjsicuZVud4A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/pMPbyicMFiacvrWJ1ibOFaiaqH5QdF3GsLe0iaHHo6VBaBv03LBz4IKOB84lW5PJVnlnPkrZA1l5eHLASjsicuZVud4A/640?wx_fmt=png&amp;from=appmsg"></p><p cid="n649" mdtype="paragraph"><span md-inline="plain">接下来，根据<strong>任务清单</strong>，填写R语言代码，并且运行。通过后，继续下一步。</span></p><p cid="n883" mdtype="paragraph"><span md-inline="plain">R代码示例如下：</span></p><pre spellcheck="false" lang="R" cid="n887" mdtype="fences"><span role="presentation"><span>#### 0.准备工作环境 ####</span></span><br><span role="presentation"><span>#### 1 加载R包</span></span><br><span role="presentation"><span>library</span>(<span>pacman</span>) <span># R包管理工具</span></span><br><span role="presentation"><span>p_load</span>(<span>'nhanesA'</span>) <span># NHANES数据库下载包</span></span><br><span role="presentation"><span>p_load</span>(<span>'tidyverse'</span>) <span># 数据科学工具包</span></span><br><span role="presentation"><span>p_load</span>(<span>'arsenal'</span>) <span># 基线表分析工具包</span></span><br><span role="presentation"><span>p_load</span>(<span>'survey'</span>) <span># 复杂权重分析包</span></span><br><br><span role="presentation"><span>#### 1.确定数据表和研究变量，使用nhanesA包和tidyverse包完成工作 ####</span></span><br><span role="presentation"><span>##### 1.1 DEMO-人口学数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取 人口统计学模块</span></span><br><span role="presentation"><span>demo_g</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DEMO_G'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>demo_h</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DEMO_H'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span>demo_data_file</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>demo_g</span>, <span>demo_h</span>))</span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span># 年龄-RIDAGEYR; </span></span><br><span role="presentation"><span># 性别-RIAGENDR; </span></span><br><span role="presentation"><span># 种族-RIDRETH3; </span></span><br><span role="presentation"><span># 教育程度-DMDEDUC2; </span></span><br><span role="presentation"><span># 贫困程度-INDFMPIR;</span></span><br><span role="presentation"><span>demo_data</span> <span>&lt;-</span> <span>demo_data_file</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>select</span>(<span>SEQN</span>, <span>RIDAGEYR</span>, <span>RIAGENDR</span>, <span>RIDRETH3</span>, <span>DMDEDUC2</span>, <span>INDFMPIR</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><br><span role="presentation"><span># 数据检视</span></span><br><span role="presentation"><span>View</span>(<span>demo_data</span>)</span><br><br><span role="presentation"><span># 数据理解</span></span><br><span role="presentation"><span>tab1</span> <span>&lt;-</span> <span>tableby</span>( <span>~</span> <span>RIDAGEYR</span> <span>+</span> <span>factor</span>(<span>RIAGENDR</span>) <span>+</span> <span>factor</span>(<span>RIDRETH3</span>) <span>+</span> <span>factor</span>(<span>DMDEDUC2</span>) <span>+</span> <span>INDFMPIR</span>, </span><br><span role="presentation">                 <span>data</span><span>=</span><span>demo_h</span>)  </span><br><span role="presentation"><span>summary</span>(<span>tab1</span>, <span>text</span><span>=</span><span>TRUE</span>)</span><br><span role="presentation"><span>##### 1.2 SMQ-吸烟数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取 问卷模块</span></span><br><span role="presentation"><span>smq_g</span> <span>&lt;-</span> <span>nhanes</span>(<span>'SMQ_G'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>smq_h</span> <span>&lt;-</span> <span>nhanes</span>(<span>'SMQ_H'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span>smq_data_file</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>smq_g</span>, <span>smq_h</span>))</span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span># 是否吸烟至少100支-SMQ020; </span></span><br><span role="presentation"><span># 现在是否吸烟-SMQ040; </span></span><br><span role="presentation"><span># 多久前开始戒烟-SMQ050Q;</span></span><br><span role="presentation"><span># 多久前开始戒烟的时间单位（天、周、月、年）-SMQ050U;</span></span><br><span role="presentation"><span>smq_data</span> <span>&lt;-</span> <span>smq_data_file</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>select</span>(<span>SEQN</span>, <span>SMQ020</span>, <span>SMQ040</span>, <span>SMQ050Q</span>, <span>SMQ050U</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span>##### 1.3 ALQ-饮酒数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取 问卷模块</span></span><br><span role="presentation"><span>alq_g</span> <span>&lt;-</span> <span>nhanes</span>(<span>'ALQ_G'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>alq_h</span> <span>&lt;-</span> <span>nhanes</span>(<span>'ALQ_H'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span>alq_data_file</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>alq_g</span>, <span>alq_h</span>))</span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span># 每年至少喝12杯酒-ALQ101</span></span><br><span role="presentation"><span># 一生中至少喝过12次酒-ALQ110；</span></span><br><span role="presentation"><span># 过去12个月多久喝一次酒-ALQ120Q</span></span><br><span role="presentation"><span># 过去12个月饮酒频率的单位（周，月，年）-ALQ120U;</span></span><br><span role="presentation"><span>alq_data</span> <span>&lt;-</span> <span>alq_data_file</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>select</span>(<span>SEQN</span>, <span>ALQ101</span>, <span>ALQ110</span>, <span>ALQ120Q</span>, <span>ALQ120U</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span>##### 1.4 BMX-BMI、腰围数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取 检查模块</span></span><br><span role="presentation"><span>bmx_g</span> <span>&lt;-</span> <span>nhanes</span>(<span>'BMX_G'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>bmx_h</span> <span>&lt;-</span> <span>nhanes</span>(<span>'BMX_H'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span>bmx_data_file</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>bmx_g</span>, <span>bmx_h</span>))</span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span>bmx_data</span> <span>&lt;-</span> <span>bmx_data_file</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>select</span>(<span>SEQN</span>, <span>BMXBMI</span>, <span>BMXWAIST</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><br><span role="presentation"><span>##### 1.5 饮食-L&amp;Z以及总卡里路数据提取（第1天&amp;第2天）#####</span></span><br><span role="presentation"><span># 1 数据表获取 饮食模块</span></span><br><span role="presentation"><span># 第1天 DR1TOT_G、DR1TOT_H</span></span><br><span role="presentation"><span>dr1tot_g</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DR1TOT_G'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>dr1tot_h</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DR1TOT_H'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span># 第2天 DR2TOT_G、DR2TOT_H</span></span><br><span role="presentation"><span>dr2tot_g</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DR2TOT_G'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>dr2tot_h</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DR2TOT_H'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span>dr1tot_data_file</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>dr1tot_g</span>, <span>dr1tot_h</span>))</span><br><span role="presentation"><span>dr2tot_data_file</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>dr2tot_g</span>, <span>dr2tot_h</span>))</span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span>dr1tot_data</span> <span>&lt;-</span> <span>dr1tot_data_file</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>select</span>(<span>SEQN</span>, <span>DR1TLZ</span>, <span>DR1TKCAL</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span>dr2tot_data</span> <span>&lt;-</span> <span>dr2tot_data_file</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>select</span>(<span>SEQN</span>, <span>DR2TLZ</span>, <span>DR2TKCAL</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span># 4 数据纵向连接</span></span><br><span role="presentation"><span>dr_data</span> <span>&lt;-</span> <span>dr1tot_data</span> <span>%&gt;%</span> </span><br><span role="presentation">  <span>inner_join</span>(<span>dr2tot_data</span>) <span>%&gt;%</span> </span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span>##### 1.6 膳食补充剂-L&amp;Z数据提取（第1天&amp;第2天）#####</span></span><br><span role="presentation"><span># 1 数据表获取 饮食模块</span></span><br><span role="presentation"><span># 第1天 DS1TOT_G、DS1TOT_H</span></span><br><span role="presentation"><span>ds1tot_g</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DS1TOT_G'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>ds1tot_h</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DS1TOT_H'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span># 第2天 DS2TOT_G、DS2TOT_H</span></span><br><span role="presentation"><span>ds2tot_g</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DS2TOT_G'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>ds2tot_h</span> <span>&lt;-</span> <span>nhanes</span>(<span>'DS2TOT_H'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span>ds1tot_data_file</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>ds1tot_g</span>, <span>ds1tot_h</span>))</span><br><span role="presentation"><span>ds2tot_data_file</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>ds2tot_g</span>, <span>ds2tot_h</span>))</span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span>ds1tot_data</span> <span>&lt;-</span> <span>ds1tot_data_file</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>select</span>(<span>SEQN</span>, <span>DS1TLZ</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span>ds2tot_data</span> <span>&lt;-</span> <span>ds2tot_data_file</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>select</span>(<span>SEQN</span>, <span>DS2TLZ</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span># 4 数据纵向连接</span></span><br><span role="presentation"><span>ds_data</span> <span>&lt;-</span> <span>ds1tot_data</span> <span>%&gt;%</span> </span><br><span role="presentation">  <span>inner_join</span>(<span>ds2tot_data</span>) <span>%&gt;%</span> </span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span>##### 1.7 CFQ-认知数据提取 #####</span></span><br><span role="presentation"><span># 1 数据表获取 问卷模块</span></span><br><span role="presentation"><span>cfq_g</span> <span>&lt;-</span> <span>nhanes</span>(<span>'CFQ_G'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span>cfq_h</span> <span>&lt;-</span> <span>nhanes</span>(<span>'CFQ_H'</span>, <span>translated</span> <span>=</span> <span>FALSE</span>)</span><br><span role="presentation"><span># 2 数据横向拼接</span></span><br><span role="presentation"><span>cfq_data_file</span> <span>&lt;-</span> <span>dplyr</span><span>::</span><span>bind_rows</span>(<span>list</span>(<span>cfq_g</span>, <span>cfq_h</span>))</span><br><span role="presentation"><span># 3 研究变量选取</span></span><br><span role="presentation"><span>cfq_data</span> <span>&lt;-</span> <span>cfq_data_file</span> <span>%&gt;%</span></span><br><span role="presentation">  <span>select</span>(<span>SEQN</span>, <span>CFDCST1</span>, <span>CFDCST2</span>, <span>CFDCST3</span>, <span>CFDCSR</span>, <span>CFDAST</span>, <span>CFDDS</span>) <span>%&gt;%</span></span><br><span role="presentation">  <span>as.data.frame</span>()</span><br><span role="presentation"><span cm-text="" cm-zwsp=""></span></span></pre><p cid="n556" mdtype="paragraph"><span md-inline="plain">上面这份代码运行通过，就获得了这篇论文<strong>所需要的两个周期的数据表以及对应的研究字段，包括自变量、因变量和协变量</strong>。</span></p><p cid="n890" mdtype="paragraph"><span md-inline="plain">接下来，为了能够进行后续的分析，需要做<strong>权重变量的选择和处理</strong>，以及<strong>论文研究对象的选择和确定</strong>这两个工作。</span></p><p cid="n892" mdtype="paragraph"><strong><span md-inline="plain">关于NHANES数据库权重变量的选择和使用，我会在第六课做详细介绍</span></strong><span md-inline="plain">。权重的理解和正确选择，对我们后续的基于权重的分析，至关重要。因此，第六课，请朋友们一定要关注。</span></p><p cid="n892" mdtype="paragraph">最后，我做个总结。</p><p cid="n892" mdtype="paragraph"><strong>1）我是用nhanesA获取NHANES数据库的表，然后使用tidyverse包对数据表做整理工作。</strong></p><p cid="n892" mdtype="paragraph"><strong>2）根据科研选题，分步骤描述数据获取和整理清单，并且找到每个步骤对应的数据模块和数据表以及需要的研究变量。</strong></p><p cid="n892" mdtype="paragraph"><strong>3）对照每步任务清单撰写R语言代码，并且运行通过，直到完成所有的步骤。</strong><br></p><p cid="n892" mdtype="paragraph"><br></p><p cid="n892" mdtype="paragraph">若是觉得NHANES小课有帮助，请点赞、转发和分享，让更多朋友知道。</p><p cid="n892" mdtype="paragraph"><strong>赠人玫瑰，手有余香。</strong></p><hr><p cid="n540" mdtype="paragraph"><strong><span>《NHAES小课》合集：</span></strong><br></p><p cid="n481" mdtype="paragraph"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA4NDgyMzkyMA==&amp;mid=2650633423&amp;idx=1&amp;sn=ca3721131c193962ce9b4f9d39e7cae1&amp;chksm=87e88ed0b09f07c6e778b67d7194e8231cd47e5985e951492aae8333aa941ecfa5a7f09e9d4d&amp;scene=21#wechat_redirect" textvalue="1NHANES小课|一起来挖NHANES数据库" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span><strong><span md-inline="plain">1NHANES小课|一起来挖NHANES数据库</span></strong></span></a></p><p cid="n481" mdtype="paragraph"><span><strong>2</strong></span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA4NDgyMzkyMA==&amp;mid=2650633438&amp;idx=1&amp;sn=d92a635239d2ea333d7dbe15038c53c8&amp;chksm=87e88ec1b09f07d7fa3be27bf806f80b00fc01b679a0ab934a74c80c867dd42b3438667bedb9&amp;scene=21#wechat_redirect" textvalue="NHANES小课|带你全面认识NHANES数据库" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span><strong>NHANES小课|带你全面认识NHANES数据库</strong></span></a></p><p cid="n481" mdtype="paragraph"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA4NDgyMzkyMA==&amp;mid=2650633450&amp;idx=1&amp;sn=094c485ffb030461668a4728d087a2b2&amp;chksm=87e88ef5b09f07e302a54bce222952b7b83d6afd73f84bcbb259f1e7171327043173679bb807&amp;scene=21#wechat_redirect" textvalue="3NHANES小课|NHANES数据科研选题一二三" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span><strong>3NHANES小课|NHANES数据库科研选题一二三</strong></span></a></p><p cid="n101" mdtype="paragraph"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzA4NDgyMzkyMA==&amp;mid=2650633463&amp;idx=1&amp;sn=c35969f79cb426326cd15bdd0e64e3f6&amp;chksm=87e88ee8b09f07fea97cb2b99bbae72b6029e13849fe085cf91e26e220c2f11588385b29fc07&amp;scene=21#wechat_redirect" textvalue="4NHANES小课|我用nhanesA包获取NHANES数据库" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span><strong><span md-inline="plain">4NHANES小课|我用nhanesA包获取NHANES数据库</span></strong></span></a><span md-inline="plain"></span></p><p cid="n101" mdtype="paragraph"><span md-inline="plain">若是你有什么想和我说的，欢迎扫码添加我的微信，备注：<strong>NHANES。</strong></span></p><p cid="n101" mdtype="paragraph"><span md-inline="plain"><strong></strong>感恩遇见，共赢未来。</span></p><p><strong><img data-galleryid="" data-imgfileid="503149820" data-ratio="1.0117096018735363" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/pMPbyicMFiacvbB8IDOtGuRAWrlvv7O30vwqDtkQD7lSvqPWbVYXzobmd0G0EqO8v3LfP5YSwsB3AvaAtSLZsVvw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="png" data-w="427" src="https://mmbiz.qpic.cn/mmbiz_png/pMPbyicMFiacvbB8IDOtGuRAWrlvv7O30vwqDtkQD7lSvqPWbVYXzobmd0G0EqO8v3LfP5YSwsB3AvaAtSLZsVvw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></strong></p><ul data-type="bulletedlist"><section><p><strong><span>据统计，天南地北R语言学习者都关注这个公众号</span></strong></p><section><section><strong><span>👇</span></strong></section><section><mp-common-profile data-pluginname="mpprofile" data-id="MzA4NDgyMzkyMA==" data-headimg="http://mmbiz.qpic.cn/mmbiz/pMPbyicMFiacvUQqibc9APO9dT4alyEec7BfVSysNQWKR2j7XatqgsLmXqR6Jl0jCVIHVb1UvV1yCfXSs26EvAo4g/300?wxfrom=19" data-nickname="R语言" data-alias="Ryuyan360" data-signature="R语言学习与实践" data-from="2" data-is_biz_ban="0" data-origin_num="366" data-isban="0" data-biz_account_status="0" data-index="0"></mp-common-profile><span></span></section></section></section></ul><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/hKI7Ov6OEpbN7mvJs3OcVg",target="_blank" rel="noopener noreferrer">原文链接</a>
