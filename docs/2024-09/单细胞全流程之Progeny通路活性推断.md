---
title: "单细胞全流程之Progeny通路活性推断"
date: 2024-09-17T03:24:13Z
draft: ["false"]
tags: [
  "fetched",
  "爱喝可乐的天天"
]
categories: ["Acdemic"]
---
单细胞全流程之Progeny通路活性推断 by 爱喝可乐的天天
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span><strong>首先祝大家月饼节快乐哈！</strong><br></span></h1><p data-tool="mdnice编辑器">今天我们来复现上一期分享的<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzNDQ3Njc4NQ==&amp;mid=2247484391&amp;idx=1&amp;sn=5b4191d23dc14e9c82312fca94390821&amp;chksm=c2bded79f5ca646ffc4caebc7cd8120e83c6054d5978b427521ab8fa47ca2be3323c99ae5ba1&amp;scene=21#wechat_redirect" textvalue="circulation" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">circulation</a>当中的单细胞progeny分析。</p><h2 data-tool="mdnice编辑器"><span></span><span>简单介绍下Progeny分析</span><span></span><span> </span></h2><p data-tool="mdnice编辑器">PROGENy（Pathway RespOnsive GENes for activity inference）是一种生物信息学工具，它通过利用大量公开可用的信号扰动实验数据来推断信号通路的活性。这种方法克服了仅依赖基因表达数据进行通路活性分析时可能忽略的翻译后修饰的影响，并且能够更准确地反映特定实验条件下的信号状态。</p><p data-tool="mdnice编辑器">基本原理：PROGENy的核心原理是通过分析已知信号扰动（如基因敲除、药物处理等）后的基因表达变化，来识别哪些基因对特定信号通路的扰动有响应。这些基因被称为“足迹基因”，它们对路径扰动的响应强度和方向被量化为权重。然后，PROGENy利用这些权重和基因表达数据来计算信号通路的得分，从而推断通路活性。</p><p data-tool="mdnice编辑器">作用：</p><ol data-tool="mdnice编辑器"><li><section>恢复已知驱动基因突变的作用：PROGENy可以识别和量化基因突变对信号通路活性的影响。</section></li><li><section>提供或改善药物的标记：通过分析药物处理后的细胞表达数据，PROGENy有助于发现药物作用的分子标记。</section></li><li><section>区分致癌和肿瘤抑制途径：PROGENy有助于识别对患者生存有影响的信号通路，区分其在癌症发展中的作用。</section></li></ol><p data-tool="mdnice编辑器">PROGENy能够从基因表达数据中推断14种信号通路的活性，包括雄激素、雌激素、EGFR、低氧、JAK-STAT、MAPK、NFkB、PI3K、p53、TGFb、TNFa、Trail、VEGF和WNT等。这些通路在癌症和其他疾病的发展中起着关键作用。</p><p data-tool="mdnice编辑器">在实际应用中，PROGENy可以应用于bulk RNA-seq和单细胞RNA-seq数据，帮助研究者分析不同条件下的信号通路活性，为疾病机理研究和药物开发提供重要信息。例如，在单细胞RNA-seq数据分析中，PROGENy可以帮助研究者识别不同细胞类型中信号通路的活性差异，从而揭示细胞异质性在疾病中的作用。</p><p data-tool="mdnice编辑器"><strong>总的来说跟常规的通路推断区别不大，区别在于其并不是完全依赖表达数据利用公开实验数据使推断结果更为准确</strong>。这个算法可能在肿瘤中比较常见，但其在心血管领域中的应用也十分多见，22年发表在nature上的心梗空转图谱也同样用了这个算法进行通路活性的比较分析。</p><h2 data-tool="mdnice编辑器"><span></span><span>原文复现</span><span></span><span> </span></h2><p data-tool="mdnice编辑器">话不多说，来看下文章中的原图，主要复现A,B,D,F四个小图</p><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000750" data-ratio="0.4326047358834244" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2UUiazzUOmJ6B6P8q5zlxMKkDVHCDfk1richQjk6g9O2hrMyA6IOlSRuQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1098" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2UUiazzUOmJ6B6P8q5zlxMKkDVHCDfk1richQjk6g9O2hrMyA6IOlSRuQ/640?wx_fmt=png&amp;from=appmsg"></p></figure><p data-tool="mdnice编辑器">这个文章没有OA，所以没能获取正式版本的方法学，幸好在bioRxiv上找到了预印本的SI。根据方法学提示，Progeny分析用的是小鼠AS造模16周的数据来进行的。而原文中提到的scRNA数据中只有GSM4705596符合这个要求。</p><p><img data-galleryid="" data-imgfileid="100000758" data-ratio="0.27699530516431925" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2AicCIWWAhBm55PwVE7L1HnXpARhVdFTza0Ay0fiahC8NAbjG61cGrHMQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="639" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2AicCIWWAhBm55PwVE7L1HnXpARhVdFTza0Ay0fiahC8NAbjG61cGrHMQ/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><span>这个数据是txt.gz的单细胞数据，下面我们来开</span><span>始</span><span>今天的主要内容。</span></p><figure data-tool="mdnice编辑器"><p><br></p><p><br></p></figure><h3 data-tool="mdnice编辑器"><span></span><span>数据读取</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#安装非常简单</span><br><span>#biocmanager::install("progeny")</span><br><span>library</span>(Seurat) <br><span>library</span>(tidyverse)<br><span>library</span>(data.table)<br><span>library</span>(progeny)<br><span>library</span>(pheatmap)<br><span>library</span>(ggpubr)<br><span>library</span>(ggsci)<br><span>#只有一个样本所以读起来会非常简单</span><br>dat &lt;- fread(<span>"GSM4705596_RPS007_matrix.txt.gz"</span>,data.table = <span>F</span>)<br>dat &lt;- dat %&gt;% column_to_rownames(<span>"gene"</span>)<br>scRNA1=CreateSeuratObject(counts=dat,<br>                           min.cells=<span>5</span>,<br>                           min.features=<span>300</span>)<br>scRNA1 &lt;- NormalizeData(scRNA1, normalization.method = <span>"LogNormalize"</span>, scale.factor = <span>10000</span>)<br>scRNA1&lt;-FindVariableFeatures(scRNA1, selection.method = <span>"vst"</span>, nfeatures = <span>2000</span>) <br>scale.genes &lt;-  rownames(scRNA1)<br>scRNA1 &lt;- ScaleData(scRNA1, features = scale.genes)<br>scRNA1 &lt;- RunPCA(scRNA1, features = VariableFeatures(scRNA1)) <br>pc.num=<span>1</span>:<span>20</span><br>scRNA1 &lt;- FindNeighbors(scRNA1, dims = pc.num) <br>scRNA1 &lt;- FindClusters(scRNA1, resolution = <span>0.4</span>)<br>scRNA1 = RunUMAP(scRNA1, dims = pc.num)<br><span>#这个数据最早是Reilly lab 20年发表在circulation上的，所以注释是根据那篇文章来的。</span><br><span>#Pan H, Xue C, Auerbach BJ, Fan J et al. Single-Cell Genomics Reveals a Novel Cell State During Smooth Muscle Cell Phenotypic Switching and Potential Therapeutic Targets for Atherosclerosis in Mouse and Human. Circulation 2020 Nov 24;142(21):2060-2075. PMID: 32962412<span es-id-type="PMID" es-id="32962412" es-collect-button-id="0" cslsource="pubmedPmid"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 1000 1000" enable-background="new 0 0 1000 1000" height="1em"></svg><br>        <g><path d="M852.3,135.6l-47.7,48.3c157.6,178.7,157.4,451,0.1,631l48.8,49.5C1035.9,672.1,1035.5,327.2,852.3,135.6z M740.9,248.6l-49.3,49.9c96.1,115.5,96.1,285.8,0.5,402.1l48.8,49.6C863.4,606.1,863.6,391.5,740.9,248.6z M195.4,183.9l-47.7-48.3c-183.2,191.6-183.6,536.5-1.2,728.8l48.8-49.5C37.9,635,37.8,362.6,195.4,183.9z M259.1,248.6C136.4,391.5,136.6,606.1,259,750.3l48.8-49.6c-95.6-116.4-95.6-286.6,0.4-402.1L259.1,248.6z M499.8,340.4c-87.3,0-158.1,71.8-158.1,160.4c0,88.5,70.8,160.4,158.1,160.4c87.3,0,158.1-71.8,158.1-160.4C657.8,412.2,587,340.4,499.8,340.4z"></path></g><br>        <span><span value="35.5">IF: 35.5 </span><span value="Q1">Q1 </span><span value="B1">B1</span></span></span> </span><br>genes_to_check &lt;- c(<span>"Myh11"</span>,<span>"Cnn1"</span>,<span>"Acta2"</span>,<span>"Tpm2"</span>,<span>"Ppp1r14a"</span>,<br>                    <span>"Vcam1"</span>,<span>"Fn1"</span>,<span>"Lum"</span>,<span>"Timp1"</span>,<span>"Sncg"</span>,<span>"Chad"</span>,<span>"Ibsp"</span>,<br>                    <span>"1500015O10Rik"</span>,<span>"Col2a1"</span>,<span>"C1qc"</span>,<span>"C1qb"</span>,<span>"Cd52"</span>,<br>                    <span>"C1qa"</span>,<span>"Ccl8"</span>,<span>"H2-Aa"</span>,<span>"H2-Eb1"</span>,<span>"H2-Ab1"</span>,<span>"Cd74"</span>,<span>"Lgals3"</span>,<br>                    <span>"Lyz2"</span>,<span>"Gpnmb"</span>,<span>"Ctss"</span>,<span>"Fabp5"</span>,<span>"Sfrp2"</span>,<span>"Prss12"</span>,<span>"Prrx2"</span>,<span>"Gxylt2"</span>,<br>                    <span>"Rgs5"</span>,<span>"F3"</span>,<span>"Serping1"</span>,<span>"Gsn"</span>,<span>"Serpinf1"</span>,<span>"Pi16"</span>,<span>"Igfbp5"</span>,<span>"Igfbp4"</span>,<span>"Egr1"</span>,<br>                    <span>"Cygb"</span>,<span>"Cxcl2"</span>,<span>"Pclaf"</span>,<span>"Hmgb2"</span>,<span>"Stmn1"</span>,<span>"H2afz"</span>,<span>"Ly6c1"</span>,<span>"Cldn5"</span>,<br>                    <span>"Pecam1"</span>,<span>"Fabp4"</span>,<span>"Egfl7"</span>)<br>DotPlot(scRNA1,features = genes_to_check)+coord_flip()<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000752" data-ratio="1.0010526315789474" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2yUla9k8XadayRxmgicmpcfUicViaKdHuyYuibsoWccPl2NkWA2s4QmgT6w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="950" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2yUla9k8XadayRxmgicmpcfUicViaKdHuyYuibsoWccPl2NkWA2s4QmgT6w/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span>细胞类型注释</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#0为SMC，1为SEM，6为FC</span><br>sce &lt;- subset(scRNA1,idents = c(<span>0</span>,<span>1</span>,<span>6</span>))<br>celltype=data.frame(ClusterID=c(<span>0</span>,<span>1</span>,<span>6</span>),<br>                    celltype=c(<span>0</span>,<span>1</span>,<span>6</span>))<br>celltype[celltype$ClusterID %<span>in</span>% c(<span>0</span>),<span>2</span>]=<span>"SMC"</span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>1</span>),<span>2</span>]=<span>"ICS(SEM)"</span><br>celltype[celltype$ClusterID %<span>in</span>% c(<span>6</span>),<span>2</span>]=<span>"FC"</span><br>sce@meta.data$celltype=<span>"NA"</span><br><span>for</span> (i <span>in</span> <span>1</span>:nrow(celltype)) {<br>  sce@meta.data[which(sce@meta.data$seurat_clusters==celltype$ClusterID[i]),<span>'celltype'</span>] &lt;- celltype$celltype[i]<br>  <br>}<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>progeny分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>Idents(sce) &lt;- <span>"celltype"</span><br>CellsClusters &lt;- data.frame(Cell = names(Idents(sce)), <br>                            CellType = as.character(Idents(sce)),<br>                            stringsAsFactors = <span>FALSE</span>)<br>DimPlot(sce, reduction = <span>"umap"</span>, label = <span>TRUE</span>, pt.size = <span>0.5</span>) + NoLegend()<br>sce&lt;- progeny(sce, scale=<span>FALSE</span>, organism=<span>"Mouse"</span>, top=<span>500</span>, perm=<span>1</span>, <br>                return_assay = <span>TRUE</span>)<span>#organism可选Human或者Mouse，top的数值是根据原文来的，大家可以自行调整</span><br>sce@assays$progeny<span>#分析结果会形成一个独立的assay</span><br>sce &lt;- Seurat::ScaleData(sce, assay = <span>"progeny"</span>) <br>progeny_scores_df &lt;- <br>  as.data.frame(t(GetAssayData(sce, slot = <span>"scale.data"</span>, <br>                               assay = <span>"progeny"</span>))) %&gt;%<br>  rownames_to_column(<span>"Cell"</span>) %&gt;%<br>  gather(Pathway, Activity, -Cell) <span>#将结果处理成数据框形式方便我们提取绘图</span><br>progeny_scores_df &lt;- inner_join(progeny_scores_df, CellsClusters)<span>#对应好细胞注释结果</span><br>summarized_progeny_scores &lt;- progeny_scores_df %&gt;% <br>  group_by(Pathway, CellType) %&gt;%<br>  summarise(avg = mean(Activity), std = sd(Activity))<br>summarized_progeny_scores_df &lt;- summarized_progeny_scores %&gt;%<br>  dplyr::select(-std) %&gt;%   <br>  spread(Pathway, avg) %&gt;%<br>  data.frame(row.names = <span>1</span>, check.names = <span>FALSE</span>, stringsAsFactors = <span>FALSE</span>) <span>#处理成长数据方便绘图</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>绘图</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>#热图</span><br>paletteLength = <span>100</span><br>myColor = colorRampPalette(c(<span>"#5e8ac2"</span>, <span>"white"</span>,<span>"#c04343"</span>))(paletteLength)<br><br>progenyBreaks = c(seq(min(summarized_progeny_scores_df), <span>0</span>, <br>                      length.out=ceiling(paletteLength/<span>2</span>) + <span>1</span>),<br>                  seq(max(summarized_progeny_scores_df)/paletteLength, <br>                      max(summarized_progeny_scores_df), <br>                      length.out=floor(paletteLength/<span>2</span>)))<br>pdf(<span>"progeny.pdf"</span>,height = <span>8</span>,width = <span>4</span>)<br>progeny_hmap = pheatmap(t(summarized_progeny_scores_df[,-<span>1</span>]),fontsize=<span>14</span>, <br>                        fontsize_row = <span>10</span>, <br>                        color=myColor, breaks = progenyBreaks, <br>                        main = <span>"PROGENy (500)"</span>, angle_col = <span>45</span>,<br>                        treeheight_col = <span>0</span>,  border_color = <span>NA</span>)<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><p><img data-backh="338" data-backw="168" data-galleryid="" data-imgfileid="100000753" data-ratio="2.0105820105820107" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2G2lpUfvJVThotMOoBtTeBVkaCIw1jaSacx2baMVFHu5HfTj6K4aV9A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="378" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2G2lpUfvJVThotMOoBtTeBVkaCIw1jaSacx2baMVFHu5HfTj6K4aV9A/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-backh="229" data-backw="144" data-galleryid="" data-imgfileid="100000754" data-ratio="1.5910652920962198" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2LIGtrWogPI4ib9QNuNmAhTC79W69JuVGzDgmx2StiaQpeCicUUFJia874A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="291" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2LIGtrWogPI4ib9QNuNmAhTC79W69JuVGzDgmx2StiaQpeCicUUFJia874A/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span>#小提琴图</span><br>my_comparisons=list(c(<span>"SMC"</span>,<span>"ICS(SEM)"</span>),<br>                    c(<span>"SMC"</span>,<span>"FC"</span>))<span>#设置需要比较的对象</span><br>path &lt;- c(<span>"NFkB"</span>,<span>"PI3K"</span>,<span>"MAPK"</span>)<br><span>for</span> (i <span>in</span> path) {<br>  pathway=subset(progeny_scores_df,Pathway == i)<br>  pathway$Activity &lt;- as.numeric(pathway$Activity)<br>  ggviolin(pathway, x=<span>"CellType"</span>, y=<span>"Activity"</span>, fill = <span>"CellType"</span>, <br>           palette = c(<span>'lancet'</span>),<br>           add = <span>"boxplot"</span>, <br>           add.params = list(fill=<span>"white"</span>),<br>           order=type)+ <br>    stat_compare_means(comparisons = my_comparisons)<br>  ggsave(paste0(i,<span>".pdf"</span>),height = <span>4</span>,width = <span>4</span>)<br>  <br>}<span>#批量绘图</span><br></code></pre><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000755" data-ratio="0.9947229551451188" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2z6g6iazJNwqkUAYXqt9nwT112Hmibbt7aSYeXV1LDv8K2wwjvaEuEZDg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="379" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2z6g6iazJNwqkUAYXqt9nwT112Hmibbt7aSYeXV1LDv8K2wwjvaEuEZDg/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000756" data-ratio="0.9920424403183024" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2lnnwYX90XibZqcgIZYFEDib9DRObygjf65c6jdyBQibZnuxFdpdPIoia6A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="377" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2lnnwYX90XibZqcgIZYFEDib9DRObygjf65c6jdyBQibZnuxFdpdPIoia6A/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000757" data-ratio="1.0106951871657754" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2ZticbKVtcahqQibXvMpzsNZZhYuBU29gIsia6iaicT7lrW82B9TEPms6Tgw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="374" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GX9ZMicHryiacG1Ljm5lunEz2ZticbKVtcahqQibXvMpzsNZZhYuBU29gIsia6iaicT7lrW82B9TEPms6Tgw/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器"><span>分析到这里就基本结束啦。可以看到整体结果与原文基本一致，就是在组间比较特定通路的结果上会有一些微小的差异，但总体来说结果是可以完整复现的。</span><span>不愧是顶刊。</span><br></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/L_yNW6fHpvcAIxH3GTIBnA",target="_blank" rel="noopener noreferrer">原文链接</a>
