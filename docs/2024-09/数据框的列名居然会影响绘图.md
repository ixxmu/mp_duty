---
title: "数据框的列名居然会影响绘图"
date: 2024-09-04T10:00:37Z
draft: ["false"]
tags: [
  "fetched",
  "珠海健明生物医药科技"
]
categories: ["Acdemic"]
---
数据框的列名居然会影响绘图 by 珠海健明生物医药科技
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>我们的生物信息学马拉松授课非常注重于编程基础，一般来说完成了两周的r编程语言的互动式授课之后我仍然是会建议大家完成我的b站视频学习和对应的100个r练习题；</p></blockquote><pre data-tool="mdnice编辑器"><span></span><code>生信基石之R语言<br>B站的10个小时教学视频务必看完，参考 GitHub 仓库存放的相关学习路线指导资料：https://github.com/jmzeng1314/R_bilibili ，思维导图在，https://share.mubu.com/doc/HGT7XBmgg<br><br>可以参考一些优秀笔记，比如https://mubu.com/doc/2KUiSCfVsg<br><br>初级10 个题目：http://www.bio-info-trainee.com/3793.html  <br>中级要求是：http://www.bio-info-trainee.com/3750.html<br>高级要求是完成20题：http://www.bio-info-trainee.com/3415.html<br>统计专题 30题：http://www.bio-info-trainee.com/4385.html<br>可视化专题30题：http://www.bio-info-trainee.com/4387.html<br><br>r全套资料<br>很多朋友之所以学习R语言其实就是为了重复一些简单的数据库挖掘文章，所以我也顺便录制了GEO数据库挖掘课程，代码在：https://github.com/jmzeng1314/geo，如果你网络很差，就下载打包版本的geo代码，https://share.weiyun.com/5vrfsqv<br><br>授课配套思维导图是，https://share.mubu.com/doc/19S0XYlVcg<br>配套教学视频在B站：https://www.bilibili.com/video/av26731585/<br>还有一个公共数据库挖掘：https://www.bilibili.com/video/av37568990<br><br>如果是需要安装R包，请务必参考：http://www.bio-info-trainee.com/3727.html 代码<br>专门为R语言建立了 GitHub 仓库存放相关学习路线指导资料：https://github.com/jmzeng1314/R_bilibili<br></code></pre><p data-tool="mdnice编辑器">最近有小伙伴反馈在做题的时候出现了一个百思不得其解的bug，是数据框的列名居然会影响绘图，蛮适合我们的人工智能大模型答疑的专辑，所以我也视频演练了一下</p><h3 data-tool="mdnice编辑器"><span></span><span>第一次提问：在r编程语言里面绘制一个箱线图</span><span></span></h3><p data-tool="mdnice编辑器">在R语言中，你可以使用<code>ggplot2</code>包来绘制箱线图，或者使用基础图形系统中的<code>boxplot()</code>函数。以下是两种方法的示例：</p><h3 data-tool="mdnice编辑器"><span></span><span>使用<code>ggplot2</code>包绘制箱线图</span><span></span></h3><p data-tool="mdnice编辑器">首先，确保你已经安装并加载了<code>ggplot2</code>包：</p><pre data-tool="mdnice编辑器"><span></span><code>install.packages(<span>"ggplot2"</span>)  <span># 如果你还没有安装ggplot2包</span><br><span>library</span>(ggplot2)<br></code></pre><p data-tool="mdnice编辑器">然后，创建一些模拟数据并绘制箱线图：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 创建模拟数据</span><br>set.seed(<span>123</span>)  <span># 为了可重复性</span><br>data &lt;- data.frame(<br> Category = rep(c(<span>"Group1"</span>, <span>"Group2"</span>), each = <span>100</span>),<br>  Value = c(rnorm(<span>100</span>, mean = <span>50</span>, sd = <span>10</span>), rnorm(<span>100</span>, mean = <span>60</span>, sd = <span>15</span>))<br>)<br><br><span># 使用ggplot2绘制箱线图</span><br>ggplot(data, aes(x = Category, y = Value)) +<br>  geom_boxplot() +<br>  labs(title = <span>"Boxplot Example"</span>, x = <span>"Category"</span>, y = <span>"Values"</span>)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>使用基础R函数<code>boxplot()</code>绘制箱线图</span><span></span></h3><p data-tool="mdnice编辑器">如果你不想使用<code>ggplot2</code>，可以使用R的基础图形函数<code>boxplot()</code>：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 使用相同的模拟数据</span><br>boxplot(Value ~ Category, data = data,<br>        ylab = <span>"Values"</span>, xlab = <span>"Category"</span>,<br>        main = <span>"Boxplot Example"</span>)<br></code></pre><p data-tool="mdnice编辑器">这两个示例都会生成一个箱线图，显示两个组（Group1和Group2）的值分布。<code>ggplot2</code>提供了更多的定制选项和美观的图形输出，而<code>boxplot()</code>函数则提供了一个更简单快捷的绘图方法。根据你的具体需求和偏好选择使用哪一种。</p><h3 data-tool="mdnice编辑器"><span></span><span>第二次提问；还有ggpubr包，ggstat等吗</span><span></span></h3><p data-tool="mdnice编辑器">在R语言中，除了<code>ggplot2</code>包之外，还有几个扩展包可以用于绘制包含统计信息的图形，包括箱线图。以下是两个常用的包：</p><ol data-tool="mdnice编辑器"><li><section><p><strong>ggpubr包</strong>：</p></section></li></ol><ul><li><section><p><code>ggpubr</code>是一个基于<code>ggplot2</code>的扩展包，它提供了创建符合出版物要求的图形的功能。这个包简化了为<code>ggplot2</code>图形添加p值和显著性标记的过程，并且支持多种图形的绘制，如箱线图、点图、条形图和线图等。安装可以通过CRAN或GitHub进行：</p><pre><span></span><code>install.packages(<span>"ggpubr"</span>)<br><span># 或者</span><br>devtools::install_github(<span>"kassambara/ggpubr"</span>)<br></code></pre></section></li><li><section><p>使用<code>ggpubr</code>绘制箱线图的示例代码：</p><pre><span></span><code><span>library</span>(ggpubr)<br>ggboxplot(data, x = <span>"分组变量"</span>, y = <span>"数值变量"</span>,<br>           palette = <span>"jco"</span>) + <span># 使用jco颜色方案</span><br>stat_compare_means() <span># 添加p值和显著性标记</span><br></code></pre></section></li></ul><li><section><p><strong>ggstatsplot包</strong>：</p></section></li><ul><li><section><p><code>ggstatsplot</code>是另一个<code>ggplot2</code>的扩展包，它允许用户创建包含统计细节的图形。这个包特别适合科研人员，因为它提供了一系列的函数来绘制箱线图、散点图、直方图等，并自动包含统计测试的结果。安装可以通过GitHub：</p><pre><span></span><code>devtools::install_github(<span>"IndrajeetPatil/ggstatsplot"</span>)<br></code></pre></section></li><li><section><p>使用<code>ggstatsplot</code>绘制箱线图的示例代码：</p><pre><span></span><code><span>library</span>(ggstatsplot)<br>ggbetweenstats(data = 数据框,<br>                x = 分组变量,<br>                y = 数值变量,<br>                type = <span>"p"</span>, <span># 显著性类型</span><br>                conf.level = <span>0.95</span>) <span># 置信水平</span><br></code></pre></section></li></ul><p data-tool="mdnice编辑器">这两个包都提供了丰富的定制选项和自动化的统计测试结果展示，使得数据可视化和结果解释更加直观和方便。</p><h3 data-tool="mdnice编辑器"><span></span><span>第三次提问：直接把报错的bug贴给大模型</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>我使用了ggstatsplot然后报错了Error <span>in</span> `select()`:<br>! Names must be unique.<br>✖ These names are duplicated:<br>  * <span>"expression"</span> at locations 2 and 11.<br>Run `rlang::last_trace()` to see <span>where</span> the error occurred.<br></code></pre><p data-tool="mdnice编辑器">在使用<code>ggstatsplot</code>包绘制图形时遇到"Error in <code>select()</code>: ! Names must be unique."的错误，这通常意味着在数据处理过程中，列名或其他标识符出现了重复。根据搜索结果，这个问题可能与数据处理方式有关，尤其是在使用<code>dplyr</code>包的<code>select()</code>函数时。</p><p data-tool="mdnice编辑器">解决这个问题的一种方法是确保在进行选择操作时，所选的列名是唯一的。例如，如果你在创建一个自定义函数来绘制图形，并且函数内部使用了<code>select()</code>，你需要确保传递给<code>select()</code>的变量名在数据框中不是重复的。如果需要从函数参数中动态选择列，可以使用<code>rlang</code>包中的<code>sym()</code>或<code>!!</code>操作符来避免非预期的列名重复问题。</p><p data-tool="mdnice编辑器">此外，如果错误发生在使用<code>ggstatsplot</code>的<code>ggwithinstats()</code>函数时，这可能是因为在处理大量数据点时，函数内部的某些操作导致了列名不唯一。在这种情况下，尝试减少数据点的数量，或者检查数据框确保没有重复的列名，可能会有所帮助。</p><p data-tool="mdnice编辑器">如果上述方法仍然不能解决问题，建议查看<code>ggstatsplot</code>的官方文档和GitHub问题跟踪页面，看看是否有其他用户报告了类似的问题以及可能的解决方案。同时，确保你的<code>ggstatsplot</code>包是最新版本，因为软件更新可能包含错误修复。</p><h3 data-tool="mdnice编辑器"><span></span><span>模拟数据测试流程：</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><br><span># 创建模拟数据</span><br>set.seed(<span>123</span>)  <span># 为了可重复性</span><br>data &lt;- data.frame(<br>  Category = rep(c(<span>"Group1"</span>, <span>"Group2"</span>), each = <span>100</span>),<br>  Value = c(rnorm(<span>100</span>, mean = <span>50</span>, sd = <span>10</span>), rnorm(<span>100</span>, mean = <span>60</span>, sd = <span>15</span>))<br>)<br><span>library</span>(ggplot2)<br><span># 使用ggplot2绘制箱线图</span><br>ggplot(data, aes(x = Category, y = Value)) +<br>  geom_boxplot() +<br>  labs(title = <span>"Boxplot Example"</span>, x = <span>"Category"</span>, y = <span>"Values"</span>) + theme_minimal() <br><br><span>library</span>(ggstatsplot)<br>ggbetweenstats(data = data ,<br>               x = Category,<br>               y = Value ,<br>               type = <span>"p"</span>, <span># 显著性类型</span><br>               conf.level = <span>0.95</span>) <span># 置信水平</span><br><br>df=data.frame(<br>  expression=rnorm(<span>100</span>),<br>  gene=rep(LETTERS[<span>1</span>:<span>5</span>],<span>20</span>)<br>)<br>head(df)<br><span>library</span>(ggplot2)<br><span># 使用ggplot2绘制箱线图</span><br>ggplot(df, aes(x = gene, y = expression)) +<br>  geom_boxplot() +<br>  labs(title = <span>"Boxplot Example"</span>, x = <span>"Category"</span>, y = <span>"Values"</span>) + theme_minimal()<br><br><span>library</span>(ggstatsplot)<br>ggbetweenstats(data = df,<br>               x = gene,<br>               y = expression ,<br>               type = <span>"p"</span>, <span># 显著性类型</span><br>               conf.level = <span>0.95</span>) <span># 置信水平</span><br><br><br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>最后还是靠人工debug</span><span></span></h3><p data-tool="mdnice编辑器">定位到了 ：https://github.com/IndrajeetPatil/ggstatsplot/issues/396</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; rlang::last_trace()<br>&lt;error/vctrs_error_names_must_be_unique&gt;<br>Error <span>in</span> `select()`:<br>! Names must be unique.<br>✖ These names are duplicated:<br>  * <span>"expression"</span> at locations 2 and 11.<br>---<br>Backtrace:<br>     ▆<br>  1. ├─ggstatsplot::ggbetweenstats(...)<br>  2. │ ├─base::suppressWarnings(...)<br>  3. │ │ └─base::withCallingHandlers(...)<br>  4. │ └─ggstatsplot:::.centrality_ggrepel(...)<br>  5. │   ├─base::suppressWarnings(...)<br>  6. │   │ └─base::withCallingHandlers(...)<br>  7. │   └─statsExpressions::centrality_description(...)<br>  8. │     └─... %&gt;% .glue_to_expression()<br>  9. ├─statsExpressions:::.glue_to_expression(.)<br> 10. │ └─... %&gt;% .add_package_class()<br> 11. ├─statsExpressions:::.add_package_class(.)<br> 12. │ └─tibble::as_tibble(data)<br> 13. ├─dplyr::mutate(...)<br> 14. ├─dplyr::ungroup(.)<br> 15. ├─dplyr::mutate(., expression = list(parse_expr(expression)))<br> 16. ├─dplyr::rowwise(.)<br> 17. ├─dplyr::select(...)<br> 18. └─dplyr:::select.data.frame(...)<br>Run rlang::last_trace(drop = FALSE) to see 14 hidden frames.<br></code></pre><p data-tool="mdnice编辑器"><strong>解决方案修改一下数据库里面的列名字即可，不能是expression，可以是exp，哈哈哈   </strong>：</p><pre data-tool="mdnice编辑器"><span></span><code>colnames(df)[<span>1</span>]=<span>'exp'</span><br>head(df)<br><span>library</span>(ggstatsplot)<br>ggbetweenstats(data = df,<br>               x = gene,<br>               y = exp ,<br>               type = <span>"p"</span>, <span># 显著性类型</span><br>               conf.level = <span>0.95</span>) <span># 置信水平</span><br><br></code></pre><p data-tool="mdnice编辑器">成功的绘图应该是如下所示：</p><p><img data-galleryid="" data-imgfileid="100049301" data-ratio="0.6351851851851852" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKcdcpV2KoJkGMCn7ng592Qm5W95e0pfMicNZCybS1kMMTjLWibJzibh5laDNBIcOCRxvIBtSvRvia3w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxKcdcpV2KoJkGMCn7ng592Qm5W95e0pfMicNZCybS1kMMTjLWibJzibh5laDNBIcOCRxvIBtSvRvia3w/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>成功的绘图</figcaption></figure></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span>写在文末</span></h3></section><p>如果你也想做单细胞转录组数据分析，<span>最好是有自己的计算机资源哦，比如我们的</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a><span>，而且还需要有基本的生物信息学基础，也可以看看我们的</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531929&amp;idx=1&amp;sn=f6f16b7bf6b907360d6d0052e3d10cf6&amp;chksm=9b4b3d22ac3cb434b6aa7753a4cf0f266578147ccf10b49cc834e46af578ee6de99be0accb30&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉‍松授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a><span> ，你的生物信息学入门课。</span></p><p><span>当然了，八月份比较特殊的是：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247526317&amp;idx=1&amp;sn=b6fef7bcd40fa18db974aa3d36656c20&amp;chksm=fa45a290cd322b86afc3676b1a715a734782956a9e37d40b978ef54d51c9cd47facb9f356e53&amp;scene=21#wechat_redirect" textvalue="单细胞数据挖掘线下培训（南京站）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1">单细胞数据挖掘线下培训（南京站）</a>，这个周六日，也就是明天啦，我们可以线下授课，惊喜不！</span></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/NnE_GQKYUNPfgeN22DWcUg",target="_blank" rel="noopener noreferrer">原文链接</a>
