---
title: "癌症和癌旁的差异基因能在单细胞层面区分上皮细胞的恶性与否吗"
date: 2024-09-20T00:08:38Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
癌症和癌旁的差异基因能在单细胞层面区分上皮细胞的恶性与否吗 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>前面在这个笔记：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533121&amp;idx=1&amp;sn=e898d5d3df5da109ce55a7c5c7f7c02a&amp;scene=21#wechat_redirect" data-linktype="2">为什么胃癌并不使用拷贝数来判断恶性的肿瘤上皮细胞呢</a>，我提到了对于胃癌来说，它跟其它上皮细胞来源的癌症有一点点不一样的地方是，它的上皮细胞相对于免疫细胞或者间质细胞来说没有那么的恶性。所以我们推荐 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533529&amp;idx=1&amp;sn=6c050003bd24d8aa372bc42e515dbfe9&amp;scene=21#wechat_redirect" data-linktype="2">走inferCNV流程的时候只需要针对上皮细胞即可</a>，这样的话可以比较清晰的看到我们的<strong>定义的上皮细胞里面混入了淋巴系和髓系免疫细胞，以及 正常个体来源的上皮细胞</strong>，这3个群都是拷贝数相对来说比较低的。</p></blockquote><p data-tool="mdnice编辑器">也就是说， 来源于normal样品的上皮细胞以及少量来源于其它癌症样品的上皮细胞，组合成为了一个可能的normal上皮细胞亚群，而它又恰好是被我们的inferCNV流程推断成为了拷贝数比较低的亚群：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050121" data-ratio="0.9453703703703704" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZW33vmQ9iaoySfLPV3WtnMXfrranhMgj8IbeJMO7qBZOLyD20IWnricgg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZW33vmQ9iaoySfLPV3WtnMXfrranhMgj8IbeJMO7qBZOLyD20IWnricgg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">虽然我们对每个上皮细胞都是进行了inferCNV打分，但实际上我们并没有使用这个inferCNV打分来探索最佳阈值去划分细胞的恶性与否！我们是先分组，然后看不同组之间的inferCNV打分的差异情况来划分正常和对照的组，并不是针对具体的每个单细胞在进行判断！</p><h3 data-tool="mdnice编辑器"><span></span><span>判断恶性与否的另外一个方法：癌症和癌旁的差异基因综合打分</span><span></span></h3><p data-tool="mdnice编辑器">大家可以详细的阅读 这个胃癌单细胞数据集GSE163558对应的文献“Revealing the transcriptional heterogeneity of organ-specific metastasis in human gastric cancer using single-cell RNA Sequencing”，研究者写的蛮清楚这个方法学， 就是去tcga数据库里面定位到胃癌的转录组测序数据集，然后根据分组做癌症和癌旁的差异分析后，拿到上下调各自的top50基因列表去单细胞表达量矩阵里面打分！</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050120" data-ratio="1.1056179775280899" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZkyXY1GUVxBUd1H3OqoZRkEnGx80Tcg6icBMNVujgtnPOc75FtTKKu1Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="890" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZkyXY1GUVxBUd1H3OqoZRkEnGx80Tcg6icBMNVujgtnPOc75FtTKKu1Q/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">文献的附件里面有这些基因的名字，所以很容易去我们的单细胞转录组表达量矩阵里面进行打分，前面的 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533529&amp;idx=1&amp;sn=6c050003bd24d8aa372bc42e515dbfe9&amp;scene=21#wechat_redirect" data-linktype="2">走inferCNV流程的时候只需要针对上皮细胞即可</a>和<a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533528&amp;idx=1&amp;sn=c731c51a3478151b7eaa040b4ad19e44&amp;chksm=9b4b0363ac3c8a751f4636764e1a1c23fea8ff87a88692fb057605ff8f6beee7f7bb1cd49de3&amp;scene=21#wechat_redirect" data-linktype="2">上皮细胞里面混入了淋巴系和髓系免疫细胞呢</a> 做好了上皮细胞的细分：</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>) <br>getwd()<br><span>source</span>(<span>'../../scRNA_scripts/lib.R'</span>) <br>sce.all.int = readRDS(<span>'2-harmony/sce.all_int.rds'</span>)<br>sce.all.int<br>f=<span>'phe.Rdata'</span> <br>load(f) <br>colnames(phe)<br>sce.all.int=sce.all.int[,colnames(sce.all.int) %<span>in</span>% rownames(phe)]<br>identical(colnames(sce.all.int), rownames(phe))<br>sce.all.int$celltype = phe$celltype<br>th =  theme(axis.text.x=element_text(angle=<span>45</span>,hjust = <span>1</span>)) <br>table(sce.all.int$celltype)<br>DimPlot(sce.all.int,group.by = <span>'celltype'</span>,<br>        repel = <span>T</span>,label = <span>T</span>)<br><br><span># 文章里面的 tcga的转录组差异top50基因</span><br>up=<span>'IBSP CST4 HOXC9 FEZF1 HOXA11 RDH8 ALPP HOXC10 MAGEA12 TAS2R38 EVX1 CCL7 C5orf46 DMBX1 HOXC13 FGF19 MAGEA6 HOXC12 R3HDML ALPG MMP8 MAGEA3 HOXC11 PRAC2 SP8 DCSTAMP CST1 PIWIL1 KRTAP4-1 CSF2 CSAG3 ACTL8 HOXC8 BAAT'</span><br>up=trimws(strsplit(up,<span>' '</span>)[[<span>1</span>]]);up<br>down=<span>'SLC5A7 PCSK2 DCAF12L1 SLC7A3 GCG CHIA RPRM PLP1 PTF1A KIAA0408 NR0B1 PEBP4 CCKBR LGI3 HSPB3 PLD5 CCKAR SYT4 NUPR2'</span><br>down=trimws(strsplit(down,<span>' '</span>)[[<span>1</span>]]);down  <br></code></pre><p data-tool="mdnice编辑器">我这里的打分 采用的是 Seurat::AddModuleScore函数，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>gene_vector=list(up=up,down=down)  <br>sc_dataset &lt;- Seurat::AddModuleScore(sce.all.int, <br>                                     features = gene_vector) <br><span>#signature.names &lt;- paste0(names(gene_vector), "_UCell") </span><br>options(repr.plot.width=<span>6</span>, repr.plot.height=<span>4</span>)<br>colnames(sc_dataset@meta.data)<br>table(sc_dataset$orig.ident)<br>Idents(sc_dataset)<br>p1=VlnPlot(sc_dataset, features = <span>'Cluster1'</span>, <br>        group.by = <span>"orig.ident"</span>,pt.size = <span>0</span> ) + NoLegend() ;p1<br>FeaturePlot(sc_dataset,<span>'Cluster1'</span>)<br>p2=VlnPlot(sc_dataset, features = <span>'Cluster2'</span>, <br>        group.by = <span>"orig.ident"</span>,pt.size = <span>0</span> ) + NoLegend() ;p2<br>FeaturePlot(sc_dataset,<span>'Cluster2'</span>) <br>p1+p2<br></code></pre><p data-tool="mdnice编辑器">可以比较清晰的看到了文献里面的上调基因在所有的癌症样品里面的打分都比较高，但是在NT1这个正常样品里面就打分很低 （下图的上半部分小提琴图）：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050119" data-ratio="0.8055555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZ7ARBJgLpBBv7x1f1ib2OKJa8XSb4QqnDsN1ia8lP0WviazibXuCGCV43Kg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZ7ARBJgLpBBv7x1f1ib2OKJa8XSb4QqnDsN1ia8lP0WviazibXuCGCV43Kg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">同理，文献里面的下调基因在NT1这个正常样品里面就打分很搞（上图的下半部分小提琴图）。</p><p data-tool="mdnice编辑器">然后作者<span><strong>使用了上调基因打分减去下调基因的打分，取一个 0.02的阈值，来划分正常细胞和恶性细胞。</strong></span></p><pre data-tool="mdnice编辑器"><span></span><code>ss=sc_dataset$Cluster1 -sc_dataset$Cluster2;head(ss)<br>plot(sort(ss))<br>x=<span>1</span>:length(ss)<br>y=sort(ss);  <br>plot(x, y, type = <span>"l"</span>, col = <span>"black"</span>)<br>fivenum(ss)<br>table(ss &lt; -<span>0.02</span>)  <br>table(ss &lt; -<span>0.02</span>,sce.all.int$orig.ident) <br></code></pre><p data-tool="mdnice编辑器">可以看到绝大部分细胞的这个打分都是在0 附近，所以为什么取0.02也是未解之谜 ：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; table(ss &lt; 0.02) <br><br>FALSE  TRUE <br>  283  2044 <br>&gt; table(ss &lt; -0.02) <br><br>FALSE  TRUE <br> 2258    69 <br>&gt; table(ss &lt; -0.02,sce.all.int<span>$orig</span>.ident) <br>       <br>         Li1  Li2  LN1  LN2  NT1   O1   P1  PT1  PT2  PT3<br>  FALSE   10   21    2   56   86  291  133  181 1442   36<br>  TRUE     0    0    0    0   44    1    0    1   14    9<br></code></pre><p data-tool="mdnice编辑器">而且这个打分也是很难完美的区分正常细胞和恶性细胞，因为那个NT1 正常样品里面的上皮细胞理论上都是正常的，被这个算法误判了大部分。</p><p data-tool="mdnice编辑器">但是文章里面秀出来的数据就很完美，可以看到那个NT1 正常样品里面的上皮细胞绝大部分都被判定为正常：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050118" data-ratio="0.25092592592592594" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZCYG59jotz8x3n7QlIXibeF4V3YiaszfywLibjuvsM4V2ticRMU6yq2pMOw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZCYG59jotz8x3n7QlIXibeF4V3YiaszfywLibjuvsM4V2ticRMU6yq2pMOw/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span>其实是因为上下调基因不应该是直接简单粗暴挑选top50或者top100</span><span></span></h3><p data-tool="mdnice编辑器">文献里面的做法是去tcga数据库里面定位到胃癌的转录组测序数据集，然后根据分组做癌症和癌旁的差异分析后，拿到上下调各自的top50基因列表去单细胞表达量矩阵里面打分！</p><p data-tool="mdnice编辑器">但实际上，<span><strong>每次差异分析上下调基因非常多，不能说是仅仅是靠变化倍数极端值来挑选基因，我个人比较推崇的一个方法学是RRA算法，如下所示做多个不同国家地区不同芯片平台的数据集，各自独立的差异分析后使用rra算法去汇总：</strong></span></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050122" data-ratio="2.146919431279621" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZEyhjPuiaszsqaTmiamoucIwojFEBrsgXrEicjK2342gR90sP3G4tY9a5Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="844" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZEyhjPuiaszsqaTmiamoucIwojFEBrsgXrEicjK2342gR90sP3G4tY9a5Q/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">上面的这些在多个癌症和癌旁差异分析都稳定的表现出来上下调的基因，就可以比较好的去单细胞层面区分上皮细胞的恶性与否啦。</p><pre data-tool="mdnice编辑器"><span></span><code> <span>#   https://doi.org/10.3389/fgene.2018.00265</span><br><span># Identification of Potential Key Genes Associated With the Pathogenesis and Prognosis of Gastric Cancer Based on Integrated Bioinformatics Analysis</span><br>up= c(<span>"CST1"</span>, <span>"SFRP4"</span>, <span>"THY1"</span>, <span>"SULF1"</span>, <span>"FAP"</span>, <span>"SPP1"</span>, <span>"CEACAM6"</span>, <span>"TIMP1"</span>, <span>"CLDN1"</span>, <br>      <span>"MMP7"</span>, <span>"THBS2"</span>, <span>"BGN"</span>, <span>"ASPN"</span>, <span>"CLDN7"</span>, <span>"CDH17"</span>, <span>"PLA2G7"</span>, <span>"OLFM4"</span>, <span>"CLDN4"</span>, <br>      <span>"MFAP2"</span>, <span>"SPARC"</span>)<br>down &lt;- c( <span>"GIF"</span>, <span>"GKN1"</span>, <span>"ATP4A"</span>, <span>"PSCA"</span>, <span>"KCNE2"</span>, <span>"LIPF"</span>, <span>"ATP4B"</span>, <br>           <span>"SST"</span>, <span>"CHIA"</span>, <span>"GKN2"</span>, <span>"CA9"</span>, <span>"CPA2"</span>, <span>"TFF2"</span>, <span>"FBP2"</span>, <span>"PGC"</span>, <span>"SOSTDC1"</span>, <span>"CA2"</span>, <br>           <span>"ANXA10"</span>, <span>"ALDH3A1"</span>);<br><br>gene_vector=c(up,down)<br><span># remotes::install_github("carmonalab/UCell")</span><br><span>library</span>(UCell)<br>scRNA=sce.all.int<br>scRNA<br>gene_vector=list(up=up,down=down)<br>gene_vector<br>names(gene_vector)<br>colnames(scRNA@meta.data)<br>sc_dataset &lt;- Seurat::AddModuleScore(scRNA, <br>                                     features = gene_vector) <br><span>#signature.names &lt;- paste0(names(gene_vector), "_UCell") </span><br>options(repr.plot.width=<span>6</span>, repr.plot.height=<span>4</span>)<br>colnames(sc_dataset@meta.data)<br>table(sc_dataset$orig.ident)<br>Idents(sc_dataset)<br>p1=VlnPlot(sc_dataset, features = <span>'Cluster1'</span>, <br>        group.by = <span>"orig.ident"</span>,pt.size = <span>0</span> ) + NoLegend() ;p1<br>FeaturePlot(sc_dataset,<span>'Cluster1'</span>)<br>p2=VlnPlot(sc_dataset, features = <span>'Cluster2'</span>, <br>        group.by = <span>"orig.ident"</span>,pt.size = <span>0</span> ) + NoLegend() ;p2<br>FeaturePlot(sc_dataset,<span>'Cluster2'</span>) <br>p1+p2<br><br>ss=sc_dataset$Cluster1 -sc_dataset$Cluster2;head(ss)<br>plot(sort(ss))<br>x=<span>1</span>:length(ss)<br>y=sort(ss);  <br>plot(x, y, type = <span>"l"</span>, col = <span>"black"</span>)<br>fivenum(ss)<br>table(ss &lt; -<span>0.25</span>)  <br>table(ss &lt; -<span>0.25</span>,sce.all.int$orig.ident) <br></code></pre><p data-tool="mdnice编辑器">可以看到，<strong>这个时候的阈值就不是文章里面的0.02这么诡异的情况了，我们的阈值来判断上皮细胞的恶性与否就比较符合常识</strong>，因为绝大部分正常样品里面的上皮细胞都会被我们的打分划分为正常上皮细胞。</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; table(ss &lt; -0.25,sce.all.int<span>$orig</span>.ident) <br>       <br>         Li1  Li2  LN1  LN2  NT1   O1   P1  PT1  PT2  PT3<br>  FALSE    5   20    2   56   20  289  133  177 1451   38<br>  TRUE     5    1    0    0  110    3    0    5    5    7<br></code></pre><p data-tool="mdnice编辑器">当然了，这里面仍然是有一个问题，<span><strong>就 是为什么我们选择的是0.25这个值呢，实际上是一个数学问题，就是判断下面的曲线的拐点：</strong></span></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100050127" data-ratio="0.49537037037037035" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZjdhSXTxtuWYq0oGibmffcHSqhCVgicD3OeaFhtO1XwzfIL6bWiaosicB7g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyRVeckKeRGkgCIPrINASeZjdhSXTxtuWYq0oGibmffcHSqhCVgicD3OeaFhtO1XwzfIL6bWiaosicB7g/640?wx_fmt=png&amp;from=appmsg"></figure><figure data-tool="mdnice编辑器"><br></figure><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span>写在文末</span></h3></section><p>如果你也想做单细胞转录组数据分析，<span>最好是有自己的计算机资源哦，比如我们的</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a><span>，而且还需要有基本的生物信息学基础，也可以看看我们的</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531929&amp;idx=1&amp;sn=f6f16b7bf6b907360d6d0052e3d10cf6&amp;chksm=9b4b3d22ac3cb434b6aa7753a4cf0f266578147ccf10b49cc834e46af578ee6de99be0accb30&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉‍松授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a><span> ，你的生物信息学入门课。 </span></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ai22FrXM4I7L_b6g2NJfiw",target="_blank" rel="noopener noreferrer">原文链接</a>
