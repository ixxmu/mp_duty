---
title: "功能富集分析 ORA | clusterProfiler 读取本地化KEGG数据"
date: 2024-09-18T01:00:23Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
功能富集分析 ORA | clusterProfiler 读取本地化KEGG数据 by 被炸熟的虾
------
<div><p><span>上一周</span><span>bulk RNA-seq</span><span>下游分析更新了：</span></p><ul><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247488232&amp;idx=1&amp;sn=6c9f3ff4fb18d8bfde183de6aa682e64&amp;chksm=c086ce20f7f1473616e0e2c6d6386321a4eb952793e10f142768a8ef91fc238350e622b6fa8c&amp;scene=21#wechat_redirect" textvalue="bulk RNA-seq | 下游分析 | 功能富集分析 ORA - clusterProfiler" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span><strong><span>bulk RNA-seq | 下游分析 | 功能富集分析 ORA - clusterProfiler</span></strong></span></a></p></li></ul><section><span>clusterProfiler</span><span>包的一个巨大优势就是可以<span>联网抓取最新信息，但也因此</span></span><span>很考验网络流畅度，在宿舍做作业的学生党应该很有体会<img data-ratio="1" data-w="128" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_32@2x.png" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_32@2x.png">。</span><span>KEGG</span><span>数据库的“偷袭”式更新也经常让人感觉恶意满满<img data-ratio="1" data-w="128" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_32@2x.png" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_32@2x.png">。</span></section><p><span>但其实仔细观察函数参数可以发现，</span><span>Y</span><span>叔已有安排——</span><span>enrichKEGG</span><span>函</span><span>数也可以读取本地数据库（设置参数：</span><span>use_internal_data = TRUE</span><span>) 。</span></p><pre><code>enrichKEGG(gene,                <span>#待富集的基因列表，只接受entrez gene id</span><br>           organism = <span>"hsa"</span>,    <span>#指定物种</span><br>           keyType = <span>"kegg"</span>,<br>           pvalueCutoff = <span>0.05</span>, <span>#指定 p 值阈值（可指定 1 以输出全部）</span><br>           qvalueCutoff = <span>0.2</span>,  <span>#指定 q 值阈值（可指定 1 以输出全部）</span><br>           pAdjustMethod = <span>"BH"</span>,<span>#指定 p 值校正方法，比如holm,hochberg,hommel,bonferroni,BH,BY,fdr,none</span><br>           universe,<br>           minGSSize = <span>10</span>,      <span>#通路最少基因数量</span><br>           maxGSSize = <span>500</span>,     <span>#通路最大基因数量</span><br>           use_internal_data = <span>FALSE</span>) <span>#使用本地KEGG.db还是在线抓取</span><br></code></pre><p><span>那如何让建立本地数据库呢？本来很复杂的步骤也被</span><span>Y</span><span>叔封装成</span><span>R</span><span>包<img data-ratio="1" data-w="128" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Wow.png" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Wow.png">：</span><span>createKEGGdb</span></p><pre><code><span># https://github.com/YuLab-SMU/createKEGGdb</span><br><span># remotes::install_github("YuLab-SMU/createKEGGdb")</span><br><span>library</span>(createKEGGdb)<br></code></pre><p><span>只需要指定待下载的物种：比如拟小鼠（</span><span>mmu</span><span>）和人（</span><span>hsa</span><span>）。</span></p><pre><code>species &lt;- c(<span>"hsa"</span>,<span>"mmu"</span>)<br>createKEGGdb::create_kegg_db(species)<br><span># Reading KEGG annotation online: "https://rest.kegg.jp/list/pathway/hsa"...</span><br><span># Reading KEGG annotation online: "https://rest.kegg.jp/list/pathway/mmu"...</span><br><span># Reading KEGG annotation online: "https://rest.kegg.jp/link/hsa/pathway"...</span><br><span># 2024-09-15 11:26:08 Getting KEGG data of hsa.</span><br><span># 2024-09-15 11:26:08 KEGG data of hsa has been downloaded.</span><br><span># 2024-09-15 11:26:08 KEGG data of hsa has been added to the sqlite database.</span><br><span># Reading KEGG annotation online: "https://rest.kegg.jp/link/mmu/pathway"...</span><br><span># 2024-09-15 11:26:10 Getting KEGG data of mmu.</span><br><span># 2024-09-15 11:26:10 KEGG data of mmu has been downloaded.</span><br><span># 2024-09-15 11:26:10 KEGG data of mmu has been added to the sqlite database.</span><br><span># ── R CMD build ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span># ✔  checking for file 'C:\Users\...\AppData\Local\Temp\RtmpO2TceT\file57c058d4510e/DESCRIPTION' (374ms)</span><br><span># ─  preparing 'KEGG.db': </span><br><span># ✔ checking DESCRIPTION meta-information </span><br><span># Warning in .write_description(db, ldpath) :  </span><br>   <span># Warning in .write_description(db, ldpath) :</span><br>     <span># Unknown encoding with non-ASCII data: converting to ASCI </span><br><span># ─  checking for LF line-endings in source and make files and shell scripts </span><br><span># ─  checking for empty or unneeded directories</span><br><span># ─  building 'KEGG.db_1.0.tar.gz'</span><br><span># [1] "./KEGG.db_1.0.tar.gz"</span><br></code></pre><p><span>具体物种和缩写的对应关系可以查看：</span><span>http://rest.kegg.jp/list/organism</span><span>。</span></p><p><span>也可以一步下载</span><span>KEGG</span><span>上所有物种：</span></p><pre><code>create_kegg_db(<span>"all"</span>) <span># 即可</span><br></code></pre><p><span>下载完成就可以本地安装生成</span><span>KEGG.db</span><span>包：</span></p><pre><code>install.packages(<span>"KEGG.db_1.0.tar.gz"</span>, repos = <span>NULL</span>,type = <span>"source"</span>)<br><span>library</span>(KEGG.db)<br><span>#KEGG.db contains mappings based on older data because the original resource was removed from the the public domain before the most recent update was produced. This</span><br><span>#  package should now be considered deprecated and future versions of Bioconductor may not have it available.  Users who want more current data are encouraged to look at</span><br><span>#  the KEGGREST or reactome.db packages</span><br></code></pre><p><span>下面就是应用测试，只需加载包，设置<span>参数：</span><span>use_internal_data = TRUE</span></span><span>即可。</span></p><pre><code><span>library</span>(KEGG.db)<br>Enrichment_KEGG2 &lt;- enrichKEGG(gene = unique(ID_entrez$ENTREZID),<br>                              organism = <span>"mmu"</span>, <span>#Mus musculus (house mouse)</span><br>                              pvalueCutoff = <span>0.5</span>,<br>                              qvalueCutoff = <span>0.5</span>,<br>                              pAdjustMethod = <span>"BH"</span>,<br>                              minGSSize = <span>5</span>,<br>                              maxGSSize = <span>10000</span>,<br>                              use_internal_data = <span>TRUE</span>)<br>head(Enrichment_KEGG2)<br></code></pre><section><span>通过构建本地数据库，不仅不再受制于网络，也保证了结果的可重复性。当然，后一个是以牺牲分析时效性为代价，因此大家</span><span>记得<strong>定时更新自己的本地数据库</strong></span><span>。</span></section><p><img data-imgfileid="100003752" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="png" data-w="341" src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></p><section data-tools="135编辑器" data-id="116886" draggable="true"><section><section><section><section><strong data-brushtype="text">被炸熟的虾</strong></section></section></section><section><section><section data-width="35%"><section><img data-cropselx1="0" data-cropselx2="115" data-cropsely1="0" data-cropsely2="115" data-imgfileid="100003750" data-ratio="1" data-type="jpeg" data-w="258" data-width="100%" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section></section><section data-width="63%"><section><section><strong>自己的摸索，发现问题麻烦告诉作者，光速回来改正</strong><strong><img data-imgfileid="100003751" data-ratio="1" data-type="png" data-w="64" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></strong></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/VxkYq7TcqBBS2ikCN73v6Q",target="_blank" rel="noopener noreferrer">原文链接</a>
