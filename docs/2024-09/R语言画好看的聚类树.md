---
title: "R语言画好看的聚类树"
date: 2024-09-30T09:38:05Z
draft: ["false"]
tags: [
  "fetched",
  "医学和生信笔记"
]
categories: ["Acdemic"]
---
R语言画好看的聚类树 by 医学和生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>本次例子用到的R包主要有<code>TreeAndLeaf</code>、<code>RedeR</code>、<code>igraph</code>、<code>RColorBrewer</code>,示例数据来自于R<code>flexclust</code>包的<code>nutrient</code>数据。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>加载数据和R包</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(TreeAndLeaf)<br><span>library</span>(RedeR)<br><span>library</span>(igraph)<br><span>library</span>(RColorBrewer)<br><br>data(nutrient, package = <span>"flexclust"</span>) <span># 加载数据</span><br></code></pre><p data-tool="mdnice编辑器">对数据进行简单的查看和处理</p><pre data-tool="mdnice编辑器"><span></span><code>head(nutrient) <span># 简单看一下数据</span><br><br>                energy protein fat calcium iron<br>beef braised       <span>340</span>      <span>20</span>  <span>28</span>       <span>9</span>  <span>2.6</span><br>hamburger          <span>245</span>      <span>21</span>  <span>17</span>       <span>9</span>  <span>2.7</span><br>beef roast         <span>420</span>      <span>15</span>  <span>39</span>       <span>7</span>  <span>2.0</span><br>beef steak         <span>375</span>      <span>19</span>  <span>32</span>       <span>9</span>  <span>2.6</span><br>beef canned        <span>180</span>      <span>22</span>  <span>10</span>      <span>17</span>  <span>3.7</span><br>chicken broiled    <span>115</span>      <span>20</span>   <span>3</span>       <span>8</span>  <span>1.4</span><br><br>row.names(nutrient) &lt;- tolower(row.names(nutrient)) <span># 把行名变成小写</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>聚类分析</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code>hc &lt;- hclust(dist(nutrient))<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>画图</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code>tal &lt;- treeAndLeaf(hc) <span># 转化为树和叶的形式，其实是转化为igraph对象</span><br><br>rdp &lt;- RedPort()<br>calld(rdp)<br>resetd(rdp)<br>addGraph(obj = rdp, g = tal)<br>relax(rdp, p1=<span>25</span>, p2=<span>200</span>, p3=<span>5</span>, p5=<span>5</span>, ps=<span>TRUE</span>) <span># 调节图形</span><br></code></pre><p data-tool="mdnice编辑器">这样就画出来一张聚类树的图：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.9440993788819876" data-type="png" data-w="644" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RibjpHLg5MGjmoUmtu7qBNCgciaoEglO2eYl2wibqk6bLNDeLj0chzl6kgcaYibTQrv6wlypIUU6c3OMg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RibjpHLg5MGjmoUmtu7qBNCgciaoEglO2eYl2wibqk6bLNDeLj0chzl6kgcaYibTQrv6wlypIUU6c3OMg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">是不是比传统的聚类分析的图更加好看和新颖呢？这是一个交互式的图形，旁边还有一个调整框，可以自己调节树枝的长度、叶子的大小等，主要是<code>p1/p2/p3/p5</code>这几个参数比较有用，其他参数大家可以自行探索。</p><h2 data-tool="mdnice编辑器"><span></span><span>继续美化图形</span><span></span></h2><p data-tool="mdnice编辑器">这个包的强大之处在于可以为图形添加各种映射，类似<code>ggplot2</code>，比如把某一列的值映射为图形颜色，点的大小等。主要就是理解<code>att.mapv</code>、<code>att.mape</code>、<code>att.addv</code>、<code>att.adde</code>四个函数。</p><ul data-tool="mdnice编辑器"><li><section><code>att.addv</code>：给<strong>点</strong>增加一个固定值的属性</section></li><li><section><code>att.adde</code>：给<strong>树枝</strong>增加一个固定值的属性</section></li><li><section><code>att.mapv</code>：给<strong>点</strong>增加一个渐变属性</section></li><li><section><code>att.mape</code>：给<strong>树枝</strong>增加一个渐变属性</section></li></ul><p data-tool="mdnice编辑器">具体用法可使用<code>?att.mapv</code>查看官方说明。</p><p data-tool="mdnice编辑器">接下来就是给图形添加各种属性，这个操作还是和<code>ggplot2</code>的图层理念有些类似，一点点叠加。</p><pre data-tool="mdnice编辑器"><span></span><code>tal &lt;- att.mapv(tal, nutrient, refcol = <span>0</span>)<br>pal &lt;- brewer.pal(<span>9</span>,<span>'Greens'</span>) <span># 设定颜色</span><br>tal &lt;- att.setv(tal, from = <span>'calcium'</span>, to = <span>'nodeColor'</span>,cols = pal, nquant = <span>5</span>) <span># 根据calcium确定点的颜色,nquant = 5表示颜色分为5段</span><br>tal &lt;- att.setv(g = tal, from = <span>"protein"</span>, to = <span>"nodeSize"</span>, xlim = c(<span>5</span>,<span>30</span>,<span>5</span>), nquant = <span>5</span>) <span># 把protein的大小映射为点的大小，最小设置为5，最大30,5个分段</span><br><br>tal &lt;- att.addv(tal, <span>"nodeFontSize"</span>, value = <span>15</span>, index = V(tal)$isLeaf) <span># 给点添加条件</span><br>tal &lt;- att.adde(tal, <span>"edgeWidth"</span>, value = <span>3</span>) <span># 给线添加条件</span><br><br>rdp &lt;- RedPort()<br>calld(rdp)<br>resetd(rdp)<br><br>addGraph(obj = rdp, g = tal)<br>relax(rdp, p1=<span>25</span>, p2=<span>200</span>, p3=<span>5</span>, p5=<span>5</span>, ps=<span>TRUE</span>)<br><br><span># 添加图例</span><br>addLegend.color(obj = rdp, tal, title = <span>"Murder Rate"</span>, position = <span>"topright"</span>)<br>addLegend.size(obj = rdp, tal, title = <span>"Urban Population Size"</span>, position = <span>"bottomright"</span>)<br></code></pre><p data-tool="mdnice编辑器">这样就给图形添加了不同的颜色和大小，同时增加图例加以说明：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.8310038119440915" data-type="png" data-w="787" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RibjpHLg5MGjmoUmtu7qBNCgVgZPiahNFfFOIeHaHA8o67fsvleSwHGvojNLXnHB0eoiaB4VIf8pIukg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RibjpHLg5MGjmoUmtu7qBNCgVgZPiahNFfFOIeHaHA8o67fsvleSwHGvojNLXnHB0eoiaB4VIf8pIukg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">这幅图还有很多细节可以修改，大家可以自行探索</p><h2 data-tool="mdnice编辑器"><span></span><span>可视化大型聚类树</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code><span># 加载R包和数据</span><br><span>library</span>(TreeAndLeaf)<br><span>library</span>(RedeR)<br><span>library</span>(igraph)<br><span>library</span>(RColorBrewer)<br><br><span># 聚类分析</span><br>hc &lt;- hclust(dist(quakes), <span>"ave"</span>)<br>plot(hc, main=<span>"Dendrogram for the 'quakes' dataset"</span>, xlab=<span>""</span>, sub=<span>""</span>)<br></code></pre><p data-tool="mdnice编辑器">默认画出来的图很丑：</p><figure data-tool="mdnice编辑器"><img data-ratio="0.7676348547717843" data-type="png" data-w="964" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RibjpHLg5MGjmoUmtu7qBNCgQszcoqWM2pOAbQqGicuOEX1JxQyCWbQEGfOtFbmx5LTxeBibuOdt5Micg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RibjpHLg5MGjmoUmtu7qBNCgQszcoqWM2pOAbQqGicuOEX1JxQyCWbQEGfOtFbmx5LTxeBibuOdt5Micg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">接下来进行美化：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 转换对象</span><br>tal &lt;- treeAndLeaf(hc)<br><br><span># 增加图形映射</span><br>tal &lt;- att.mapv(tal, quakes, refcol = <span>0</span>)<br>pal &lt;- brewer.pal(<span>9</span>, <span>"Greens"</span>)<br>tal &lt;- att.setv(g = tal, from = <span>"mag"</span>, to = <span>"nodeColor"</span>, cols = pal, nquant = <span>10</span>)<br>tal &lt;- att.setv(g = tal, from = <span>"depth"</span>, to = <span>"nodeSize"</span>, xlim = c(<span>40</span>, <span>120</span>, <span>20</span>), nquant = <span>5</span>)<br><br>tal &lt;- att.addv(tal, <span>"nodeFontSize"</span>, value = <span>1</span>)<br>tal &lt;- att.adde(tal, <span>"edgeWidth"</span>, value = <span>10</span>)<br><br>rdp &lt;- RedPort()<br>calld(rdp)<br>resetd(rdp)<br><br>addGraph(obj = rdp, g = tal, gzoom=<span>10</span>)<br>relax(rdp, p1=<span>25</span>, p2=<span>200</span>, p3=<span>10</span>, p4=<span>100</span>, p5=<span>10</span>, ps=<span>TRUE</span>)<br><br>addLegend.color(obj = rdp, tal, title = <span>"Richter Magnitude"</span>, position = <span>"bottomright"</span>)<br>addLegend.size(obj = rdp, tal, title = <span>"Depth (km)"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="1.1241379310344828" data-type="png" data-w="725" data-src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RibjpHLg5MGjmoUmtu7qBNCgbnUDNzwImM77nyVBmo1oHtJ2u0wC6D5MsYc6fEUCeicvNlY2xxQr5tg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84RibjpHLg5MGjmoUmtu7qBNCgbnUDNzwImM77nyVBmo1oHtJ2u0wC6D5MsYc6fEUCeicvNlY2xxQr5tg/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器">这样的一幅图是不是比刚才那个好看多了！</p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><code>TreeAndLeaf</code>这个包还有很多其他的例子，出图效果一级棒，大家可以直接去<span>官网</span><sup>[1]</sup>学习。</p><h3 data-tool="mdnice编辑器"><span>参考资料</span></h3><section data-tool="mdnice编辑器"><span><span>[1]</span><p>TreeAndLeaf: <em>http://bioconductor.org/packages/release/bioc/vignettes/TreeAndLeaf/inst/doc/TreeAndLeaf.html。</em></p></span></section></section><p data-tool="mdnice编辑器"><br></p><p data-tool="mdnice编辑器">欢迎大家关注我的公众号：<strong>医学和生信笔记</strong></p><section><mpprofile data-pluginname="mpprofile" data-id="MzUzOTQzNzU0NA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/tpAC6lR84R9YDc8IDhqWAHTrZsMuhDpFlw4scqOl1ZVWpeY77cdibaSzPeGALfkEhdVpwHzVibHCRSYZg4csB43g/0?wx_fmt=png" data-nickname="医学和生信笔记" data-alias="yxhsxbj" data-signature="记录医学相关知识，科研、生信等知识。" data-from="0"></mpprofile></section><blockquote data-tool="mdnice编辑器"><p><strong>医学和生信笔记</strong> 公众号主要分享：1.医学小知识、肛肠科小知识；2.R语言和Python相关的数据分析、可视化、机器学习等；3.生物信息学学习资料和自己的学习笔记！</p></blockquote></section></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/mKlgE43h5XDz1td71lF-AQ",target="_blank" rel="noopener noreferrer">原文链接</a>
