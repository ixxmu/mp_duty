---
title: "芯片数据处理提示：package rta10cdf not installed？"
date: 2024-09-08T14:47:23Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
芯片数据处理提示：package rta10cdf not installed？ by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">今天主要处理一下下面这篇文献中提到的多个火山图：</p><p data-tool="mdnice编辑器"><span>Nat Commun 2023 Jul 24</span>;14(1):4455. PMID: 37488113，<span>《<span>An osteoinductive and biodegradable intramedullary implant accelerates bone healing and mitigates complications of bone transport in male rats</span>》</span>。</p><p data-tool="mdnice编辑器">火山图如下：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100043610" data-ratio="1.1949250288350635" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KZ24JAR4OCNEAdP9J8LF3sQfIXIbnkbOwg3fgo4leibyn6BQJDJWqQ7wiarUNskG4XIGTrwK42I7w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="867" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KZ24JAR4OCNEAdP9J8LF3sQfIXIbnkbOwg3fgo4leibyn6BQJDJWqQ7wiarUNskG4XIGTrwK42I7w/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240908152700208</figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span>文章主要大概</span><span></span></h3><blockquote data-tool="mdnice编辑器"><p>骨运输是一种由手术驱动的治疗大骨缺损的程序。然而，具有挑战性的并发症包括长时间实结、对接部位骨不连和针束感染。在这里，作者通过<strong>混合组织工程构建技术</strong>开发了一种骨诱导和可生物降解的髓内植入物，使骨形态发生蛋白-2能够持续传递作为辅助治疗。</p><p>在雄性大鼠骨运输模型中，从植入物中洗脱的骨形态发生蛋白-2加速骨形成和重塑，导致早期骨融合，如<span>影像学、力学测试、组织学分析和 microarray 分析</span>所示。</p></blockquote><p data-tool="mdnice编辑器">这里就提到了使用 microarray 转录组技术分析 揭示 早期骨融合过程，来看一下具体的实验设计：</p><p data-tool="mdnice编辑器">取无骨移植体(BLK)或加入2 μg BMP-2 (IMI + B2)的骨移植体进行骨移植4 d，取无骨移植体或骨移植体的骨缺损对照组(CTRL)在截骨当日进行急性骨移植。</p><p data-tool="mdnice编辑器"><strong>差异分析分组有：</strong></p><ul data-tool="mdnice编辑器"><li><section>BLK Distal vs CTRL Distal</section></li><li><section>IMI+B2 Proximal vs BLK Proximal</section></li><li><section>BLK Distal vs lMl+B2 Proxima</section></li><li><section>IMI+B2 Distal vs BLK Distal</section></li><li><section>IMI+B2 Distal vs lMI+B2 Proximal</section></li></ul><figure data-tool="mdnice编辑器"><img data-imgfileid="100043609" data-ratio="0.8617788461538461" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KZ24JAR4OCNEAdP9J8LF3fTC2uQZADQBIU0E8rVa5vL8uicSlj5TibOzh19XPeRfJqG3RVlozIyWQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="832" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KZ24JAR4OCNEAdP9J8LF3fTC2uQZADQBIU0E8rVa5vL8uicSlj5TibOzh19XPeRfJqG3RVlozIyWQ/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240908153124517</figcaption></figure><p data-tool="mdnice编辑器">文章中对应的数据集为：<strong>The microarray data</strong> are available in the GEO database under the accession numbers GEO: <span><strong>GSE200518</strong></span></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100043607" data-ratio="1.0372250423011844" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KZ24JAR4OCNEAdP9J8LF3IvzBlLb640aAOPb25ntVmEAIpZoOZkD3rl9AbVgqtSqaibMo78pJ9ag/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="591" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KZ24JAR4OCNEAdP9J8LF3IvzBlLb640aAOPb25ntVmEAIpZoOZkD3rl9AbVgqtSqaibMo78pJ9ag/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240908154134631</figcaption></figure><p data-tool="mdnice编辑器">这个数据没有提供处理好的表达矩阵，<span>使用 affy 包处理原始芯片CELL文件提示缺少 rta10cdf 包但是网上是搜不到这个包的</span>，提到一个帖子：https://support.bioconductor.org/p/97990/，可以使用 oligo 包进行数据预处理。</p><pre data-tool="mdnice编辑器"><code>eset.rma &lt;- rma(AffyBatch_data)<br><span>'getOption("repos")'</span> replaces Bioconductor standard repositories, see <span>'help("repositories", package = "BiocManager")'</span> <span>for</span><br>details.<br>Replacement repositories:<br>    CRAN: http://mirror.lzu.edu.cn/CRAN/<br>Error <span>in</span> getCdfInfo(object) : <br>  Could not obtain CDF environment, problems encountered:<br>Specified environment does not contain RTA-1_0<br>Library - package rta10cdf not installed<br>Bioconductor - rta10cdf not available<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>使用 oligo 包进行数据预处理</span><span></span></h3><pre data-tool="mdnice编辑器"><code><span>## load packages</span><br>rm(list=ls())<br>options(timeout = 100000)  <span># 修改下载时间为10万秒</span><br>options(scipen = 20)       <span>#不以科学计数法表示</span><br>library(GEOquery)<br>library(stringr)<br><br><br><span>## download</span><br>gse &lt;- getGEO(<span>"GSE200518"</span>, destdir = <span>"data/"</span>, getGPL = F)<br>gse<br><br>class(gse)<br>str(gse)<br><br><span># 提取临床信息</span><br>pheno &lt;- pData(phenoData(gse[[1]]))<br>colnames(pheno)<br>pheno_select &lt;- pheno[, c(<span>"geo_accession"</span>,<span>"title"</span>)]<br>temp &lt;- str_split(pheno_select<span>$title</span>, pattern = <span>" "</span>, n = 3, simplify = T)<br>pheno_select<span>$group</span> &lt;- paste0(temp[,1], <span>"_"</span>, temp[,2])<br>write.table(pheno_select, file = <span>"data/GSE200518.group.xls"</span>, quote = F, sep = <span>"\t"</span>, row.names = F)<br><br><br><span># 查看注释平台gpl</span><br>gpl &lt;- getGEO(filename=<span>"data/GPL22388_family.soft.gz"</span>)<br>class(gpl)<br>gpl_anno &lt;- gpl@dataTable@table<br>colnames(gpl_anno)<br>head(gpl_anno)<br><br>id2name &lt;- gpl_anno[,c(<span>"probeset_id"</span> ,<span>"gene_assignment"</span>,<span>"swissprot"</span>,<span>"SPOT_ID"</span>)]<br>id2name<span>$gene</span> &lt;- str_split(id2name<span>$gene_assignment</span>,<span>'//'</span>,simplify = T)[,2]<br>table(id2name<span>$SPOT_ID</span>)<br><span># 去除基因前后的空格</span><br>id2name<span>$gene</span> &lt;- str_trim(id2name<span>$gene</span>, side = <span>"both"</span>)<br><span># 过滤掉空的探针</span><br>id2name &lt;- filter(id2name, SPOT_ID!=<span>"---"</span>)<br>id2name &lt;- filter(id2name, SPOT_ID!=<span>"Unassigned"</span>)<br>id2name &lt;- filter(id2name, gene!=<span>""</span>)<br><br><span># 选择</span><br>id2name_1 &lt;- id2name[, c(<span>"probeset_id"</span>,<span>"gene"</span>)]<br>colnames(id2name_1) &lt;- c(<span>"ID"</span>,<span>"GENE_SYMBOL"</span>)<br>head(id2name_1)<br><br><br><span>###################################################</span><br><span># 提取表达矩阵</span><br><span># http://math.usu.edu/jrstevens/stat5570/1.4.Preprocess_4up.pdf</span><br><span>## 使用oligo包进行数据预处理</span><br>BiocManager::install(<span>"oligo"</span>)<br>library(oligo)<br><br>setwd(<span>"data/GSE200518_RAW/"</span>)<br>celFiles &lt;- list.celfiles(listGzipped=T)<br>celFiles<br><br>affy &lt;- read.celfiles(celFiles)<br>eset &lt;- rma(affy)<br>eset<br><br><span># 获取表达数据并输出到表格</span><br>exprs &lt;- exprs(eset)<br>exprs[1:5,1:5]<br><br><span># 处理一下样本名</span><br>colnames(exprs) &lt;- str_split(colnames(exprs), pattern = <span>"_"</span>, n = 2, simplify = T)[,1]<br>exprs &lt;- exprs %&gt;% <br>  as.data.frame() %&gt;% <br>  rownames_to_column(var = <span>"ID"</span>)<br><br><span># 合并</span><br>exp_symbol &lt;- merge(id2name_1, exprs, by.x=<span>"ID"</span>, by.y=<span>"ID"</span>)<br><br><span># 多对一取均值</span><br>library(limma)<br>exp_symbol2 &lt;- avereps(exp_symbol[,-c(1,2)],ID = exp_symbol<span>$GENE_SYMBOL</span>) %&gt;% <br>  as.data.frame()<br><br>saveRDS(exp_symbol2, file = <span>"../GSE200518.exp_symbol.rds"</span>)<br><br>exp_symbol2 &lt;- exp_symbol2 %&gt;% <br>  rownames_to_column(var=<span>"Gene"</span>)<br>write.table(exp_symbol2, file = <span>"../GSE200518.exp_symbol.xls"</span>, row.names = F, sep = <span>"\t"</span>, quote = F )<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>接下来使用limma进行差异表达分析</span><span></span></h3><p data-tool="mdnice编辑器">文中筛选阈值为：All genes with <span>adjusted p-value &lt; 0.05 and fold change &gt; 1.2</span> were used for the analysis</p><p data-tool="mdnice编辑器">差异分组：</p><ul data-tool="mdnice编辑器"><li><section>BLK Distal vs CTRL Distal</section></li><li><section>IMI+B2 Proximal vs BLK Proximal</section></li><li><section>BLK Distal vs lMl+B2 Proxima</section></li><li><section>IMI+B2 Distal vs BLK Distal</section></li><li><section>IMI+B2 Distal vs lMI+B2 Proximal</section></li></ul><p data-tool="mdnice编辑器">使用 BLK Distal vs CTRL Distal 作为示例，总共得到 324个上调，321个下调基因。</p><pre data-tool="mdnice编辑器"><code><span># load package</span><br>library(dplyr)<br>library(limma)<br>packageVersion(<span>"limma"</span>)<br><br><br><span>## 读取表达矩阵</span><br>df &lt;- read.delim(file = <span>"data/GSE200518.exp_symbol.xls"</span>, row.names = 1, header=TRUE,check.names =F)<br>head(df)<br><br><br><span>## 读取差异分组信息</span><br>gp &lt;- read.delim(file = <span>"data/GSE200518.group.xls"</span>, header=T,check.names =F)<br>gp<br><br><span>## BLK Distal vs CTRL Distal</span><br>gp &lt;- filter(gp, group==<span>"Control_Distal"</span> | group==<span>"Blank_Distal"</span> )<br><br><span>## 提取分组信息对应的样本</span><br>df &lt;- df[, gp<span>$geo_accession</span>]<br><br><span># 去掉在所有样本中表达全为0的基因行</span><br>df &lt;- df[rowSums(df)!=0, ]<br><br><span>## make the design matrix</span><br><span>## BLK Distal vs CTRL Distal</span><br>group_list &lt;- factor(gp[,3], levels = c(<span>"Control_Distal"</span>,<span>"Blank_Distal"</span>)) <span># 对照组在前，处理组在后</span><br>design &lt;- model.matrix(~group_list)<br>fit &lt;- lmFit(df, design)<br>fit &lt;- eBayes(fit, trend=TRUE)<br>result &lt;- topTable(fit, coef=2, n=Inf, sort.by=<span>"P"</span>, adjust.method = <span>"BH"</span>)<br><br><br><span>## 筛选显著差异表达基因</span><br>result<span>$regulated</span> &lt;- <span>"None"</span><br>result<span>$regulated</span>[ result<span>$logFC</span>&gt;log2(1.2) &amp; result<span>$P</span>.Value&lt;0.05 ] &lt;- <span>"Up"</span><br>result<span>$regulated</span>[ result<span>$logFC</span> &lt; -log2(1.2) &amp; result<span>$P</span>.Value&lt;0.05 ] &lt;- <span>"Down"</span><br><br>table(result<span>$regulated</span>)<br><br>out_dt &lt;- result %&gt;% rownames_to_column(var = <span>"GeneID"</span>)<br>write.table(out_dt, file = <span>"data/GSE200518.Limma.Diff.xls"</span>, quote = F, sep = <span>"\t"</span>, row.names = F)<br><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>热图绘制</span><span></span></h3><p data-tool="mdnice编辑器">作者在热图上展示了一些他关注的marker基因，比如：</p><ul data-tool="mdnice编辑器"><li><section><p>The regenerate site in BLK showed elevated expression of：<strong>osteoblast/osteocyte markers (Alpl, Ibsp, Dmp1)</strong> and <strong>chondrocyte markers (Acan, Col2a1, Col10a1)</strong>, suggesting that DO promotes active endochondral ossification during the early phase of DO (Fig. 8c–h).</p></section></li><li><section><p>Eluting BMP-2 upregulated the expression of <strong>osteogenic markers (Alpl, Dmp1, Ibsp)</strong> and downregulated <strong>skeletal muscle markers (Mb, Myog, Myoz1)</strong> (Fig. 8c–h), suggesting that BMP-2 promoted bone regeneration but prevented skeletal muscle differentiation at the docking site. T</p></section></li></ul><pre data-tool="mdnice编辑器"><code>rm(list = ls())<br>library(ggplot2)<br>library(tidyverse)<br> <br><span># 读取差异分析结果</span><br>data &lt;- read.table(file = <span>"data/GSE200518.Limma.Diff.xls"</span>, header = T, sep = <span>"\t"</span>)<br>head(data)<br><br><br><span># 绘制火山图</span><br>gene_select &lt;- c(<span>"Fzd2"</span>, <span>"Bmp8a"</span>, <span>"Alpl"</span>, <span>"Acan"</span>, <span>"Mmp13"</span>, <span>"Bmp1"</span>, <span>"Col2a1"</span>, <span>"Dmp1"</span>, <br>                 <span>"Col10a1"</span>, <span>"Ibsp"</span>, <span>"Bmp6"</span>, <span>"Thbs2"</span>, <span>"Phex"</span>, <span>"Mmp9"</span>, <span>"Thbs1"</span>, <span>"Tgfb3"</span>, <span>"Bmp3"</span>, <span>"Fzd5"</span>, <br>                 <span>"Sfrp5"</span>, <span>"Serpina3n"</span>, <span>"Cd5l"</span>)<br><br>data_lable &lt;- data[match(gene_select, data<span>$GeneID</span>), ]<br><br>p &lt;- ggplot(data=data, aes(x=logFC, y=-log10(P.Value),color=regulated)) + <br>  geom_point(size=1) + <span># 绘制点图，size为点的大小</span><br>  theme_set(theme_set(theme_bw(base_size=12))) +  <span># 设置绘图主题，选择了ggplot2自带的theme_bw</span><br>  xlab(<span>"log2(Fold change)"</span>) +  <span># 添加x轴标题</span><br>  ylab(<span>"-log10(PValue)"</span>) +     <span># 添加x轴标题</span><br>  labs(colour = <span>"State"</span>) +     <span># 修改图例的标题</span><br>  scale_colour_manual(values = c(Down=<span>'darkblue'</span>,None=<span>'grey'</span>,Up=<span>'red'</span>)) +   <span># 修改点的颜色</span><br>  geom_vline(xintercept=c(-(log2(1.2)),log2(1.2)),lty=2,col=<span>"black"</span>,lwd=0.6) +  <span># 添加两条FC阈值竖线</span><br>  geom_hline(yintercept = -log10(0.05),lty=2,col=<span>"black"</span>,lwd=0.6)           <span># 添加PValue阈值横线</span><br>p<br><br>p1 &lt;- p + <br>  <span>#geom_point(size = 3, shape = 1, data = label) +</span><br>  ggrepel::geom_text_repel(data=data_lable, aes(label = GeneID), color=<span>"black"</span> ,max.overlaps = 20,<br>                           box.padding = unit(0.5, <span>"lines"</span>),point.padding = unit(0.8, <span>"lines"</span>),segment.color = <span>"black"</span>)<br>p1<br><br></code></pre><p data-tool="mdnice编辑器">跟原文比，我们这个结果还是有点区别的，包括芯片标准化方法，差异分析算法，绘图横坐标等不一样。</p><p data-tool="mdnice编辑器">结果如下：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100043608" data-ratio="0.8274193548387097" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KZ24JAR4OCNEAdP9J8LF37AMLcNIMicqqVuYH58yZMGM2Dx9DENuEpD5u6qcjAQmIhFS9yicVc1Xw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KZ24JAR4OCNEAdP9J8LF37AMLcNIMicqqVuYH58yZMGM2Dx9DENuEpD5u6qcjAQmIhFS9yicVc1Xw/640?wx_fmt=png&amp;from=appmsg"><figcaption>image-20240908210326493</figcaption></figure><p data-tool="mdnice编辑器">下次见~</p></section><p><br></p><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3IcCpro_Xcc-pQ0zt-_8Gw",target="_blank" rel="noopener noreferrer">原文链接</a>
