---
title: "单细胞BisqueRNA和BayesPrism(贝叶斯棱镜)去卷积分析工具简单比较"
date: 2024-09-20T00:18:01Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
单细胞BisqueRNA和BayesPrism(贝叶斯棱镜)去卷积分析工具简单比较 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">曾老师发来了一个工具，BisqueRNA，这个工具也可以用于单细胞/bulk数据的反卷积~</p><p data-tool="mdnice编辑器">因此本次就对这两个工具简单测评一下 ~<br></p><p data-tool="mdnice编辑器">BayesPrism去卷积相关的知识可以去瞧一瞧下边的推文~</p><p data-tool="mdnice编辑器"><strong>生信菜鸟团</strong>：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247509903&amp;idx=1&amp;sn=33b077e4d235cb512597860fedc451e9&amp;chksm=fa4562b2cd32eba4e63a9cc04adef874bfbc24709377ddd33b4c981650cd629d012c785968e3&amp;scene=21#wechat_redirect" textvalue="这个bulk RNA-seq反卷积工具，你可能还不知道" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">这个bulk RNA-seq反卷积工具，你可能还不知道</a></p><p data-tool="mdnice编辑器">笔者也曾经写过一个推文简单的介绍过，有兴趣的朋友可以点进去瞧一瞧：</p><p data-tool="mdnice编辑器"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247484435&amp;idx=1&amp;sn=d7169a12f39410cc807cb92797c5fa9e&amp;chksm=c0a3f2e6f7d47bf00a0f16d2aba9b957cee8596d6d8d6359f96941c700ba354cd3395893dbc3&amp;scene=21#wechat_redirect" textvalue="BayesPrism(贝叶斯棱镜法)可提取单细胞数据去卷积后将信息映射至bulkRNA数据对其进行细胞分群" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">BayesPrism(贝叶斯棱镜法)可提取单细胞数据去卷积后将信息映射至bulkRNA数据对其进行细胞分群</a><br></p><p data-tool="mdnice编辑器">接下来介绍一下BisqueRNA，它的底层架构主要基于线性回归模型。<img data-imgfileid="100001916" data-ratio="0.4311163895486936" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFm31TpU2Bad3DCfwHK6VVBCeb2bOSAuKa9LwdUg3hSVkZI8N54KgZ7c4Xbcrh9ne2COofIJicJ88A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="842" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFm31TpU2Bad3DCfwHK6VVBCeb2bOSAuKa9LwdUg3hSVkZI8N54KgZ7c4Xbcrh9ne2COofIJicJ88A/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><strong>主要用两种使用方式</strong></p><p data-tool="mdnice编辑器">Reference-Based Deconvolution，如果使用者有单细胞和bulk配对的数据可以采用这种方式进行。</p><p data-tool="mdnice编辑器">Marker-Based Deconvolution，也可以通过指定特定的细胞标记基因进行曲卷积。</p><p data-tool="mdnice编辑器">研究者更加建议使用第一种，但第一种的方法有点苛刻，需要使用者有同一样本的两种不同测序数据。</p><p data-tool="mdnice编辑器"><strong>BisqueRNA的主要特点：</strong></p><ol data-tool="mdnice编辑器"><li><section>使用单细胞 RNA-seq 数据作为参考，通过线性回归模型将bulk RNA-seq 数据去卷积为各个细胞类型的贡献。这种方法利用单细胞数据中各细胞类型的表达模式来推断混合样本中的细胞组成比例。</section></li><li><section>快速、直接使用单细胞数据作为参考，对各细胞类型的表达特征没有特别的假设；适用于基因表达数据较为均匀且细胞类型特征明显的情况。</section></li></ol><p data-tool="mdnice编辑器"><strong>BayesPrism的主要特点：</strong></p><ol data-tool="mdnice编辑器"><li><section>基于贝叶斯推断框架，将去卷积问题建模为一个概率问题，通过迭代的方法估计细胞类型的比例和表达特征。BayesPrism 在去卷积过程中，不仅估计细胞比例，还重新推断了各细胞类型的基因表达特征，同时考虑到不同细胞类型间的共享基因表达模式。</section></li><li><section>能够处理噪声数据和表达特征不确定性的情况，尤其擅长在异质性高且表达模式复杂的样本中准确去卷积。BayesPrism 强调对背景噪声的控制和对混合数据的全面描述。</section></li></ol><h4 data-tool="mdnice编辑器"><span></span><span>Bisque分析步骤流程</span><span></span></h4><h5 data-tool="mdnice编辑器"><span></span><span>1、导入</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(Biobase)<br><span>library</span>(BisqueRNA)<br><span>library</span>(qs)<br><span>library</span>(BiocParallel)<br>register(MulticoreParam(workers = <span>4</span>, progressbar = <span>TRUE</span>)) <br><br><span>#导入单细胞数据</span><br>scRNA = qread(<span>'sc_dataset.qs'</span>) <br><span>#导入bulkRNA数据</span><br>load(<span>"Data.Rdata"</span>)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>2、数据预处理</span><span></span></h5><p data-tool="mdnice编辑器">Bulk RNA-seq 数据从表达矩阵(列是样本，行是基因)转换为 ExpressionSe这里就跟贝叶斯反卷积的数据格式不一样了~</p><pre data-tool="mdnice编辑器"><span></span><code>bulk.matrix &lt;- <span>2</span>^exprSet-<span>1</span> <span># 逆转回TPM数据</span><br>bulk.eset &lt;- Biobase::ExpressionSet(assayData = bulk.matrix)<br></code></pre><p data-tool="mdnice编辑器">单细胞数据需要在ExpressionSet中添加额外的信息，特别是细胞类型标签和个体标签。个体标签用于指示每个细胞来自哪个个体。为了添加这些信息，Biobase要求将其存储为数据框格式。假设我们有细胞类型标签（cell.type.labels）和个体标签（individual.labels）的字符向量</p><pre data-tool="mdnice编辑器"><span></span><code><span># 提取200个细胞</span><br>sub_scRNA &lt;- subset(scRNA,downsample=<span>200</span>)<br>sc.counts.matrix &lt;-  as.matrix(sub_scRNA@assays$RNA@counts)<br><br>sample.ids &lt;- colnames(sc.counts.matrix) <span># 提取单细胞的counts</span><br>individual.labels &lt;-sub_scRNA@meta.data$orig.ident <span># 提取个体信息赋值到individual</span><br>cell.type.labels &lt;- sub_scRNA@meta.data$celltype <span># 提取细胞类型赋值到cell.type</span><br><br><span># individual.ids和cell.types s的顺序要跟sample.ids的一样！！</span><br>sc.pheno &lt;- data.frame(check.names=<span>F</span>, check.rows=<span>F</span>,<br>                       stringsAsFactors=<span>F</span>,<br>                       row.names=sample.ids,<br>                       SubjectName=individual.labels,<br>                       cellType=cell.type.labels)<br>sc.meta &lt;- data.frame(labelDescription=c(<span>"SubjectName"</span>, <span># individual.labels</span><br>                                         <span>"cellType"</span>), <span># cell.type.labels</span><br>                      row.names=c(<span>"SubjectName"</span>,<br>                                  <span>"cellType"</span>))<br>sc.pdata &lt;- new(<span>"AnnotatedDataFrame"</span>,<br>                data=sc.pheno,<br>                varMetadata=sc.meta)<br>sc.eset &lt;- Biobase::ExpressionSet(assayData=sc.counts.matrix,<br>                                  phenoData=sc.pdata)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>3、运行BisqueRNA</span><span></span></h5><p data-tool="mdnice编辑器">默认情况下，BisqueRNA使用所有基因进行分解。但是也可以提供一个基因列表进行分解</p><p data-tool="mdnice编辑器">假设单细胞数据和bulk数据有来自同一样本的use.overlap设置为True</p><pre data-tool="mdnice编辑器"><span></span><code>system.time({<br>res &lt;- BisqueRNA::ReferenceBasedDecomposition(bulk.eset, sc.eset, <br>                                              markers=<span>NULL</span>, use.overlap=<span>F</span>)<br>})<br><br> <span>#   user  system elapsed </span><br> <span># 42.291  96.513  11.910</span><br></code></pre><p data-tool="mdnice编辑器">超级快速！！!</p><h5 data-tool="mdnice编辑器"><span></span><span>4、保存结果</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>ref.based.estimates &lt;- res$bulk.props<br>write.csv(ref.based.estimates,<span>"ref.based.estimates.csv"</span>)<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span>BayesPrism分析步骤流程</span><span></span></h4><h5 data-tool="mdnice编辑器"><span></span><span>1、导入</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(BayesPrism)<br><span>library</span>(qs)<br><span>library</span>(BiocParallel)<br>register(MulticoreParam(workers = <span>4</span>, progressbar = <span>TRUE</span>)) <br><span>#导入单细胞数据</span><br>sub_scRNA = qread(<span>'sub_scRNA.qs'</span>)  <span># 这里就跟上面Bisque法是相同数据了</span><br><span>#导入bulkRNA数据</span><br>load(<span>"Data.Rdata"</span>)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>2、TCGA数据预处理</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span>#请注意我们要做BayesPrism分析</span><br><span>#请确保使用一致的基因注释（TCGA RNA-seq 使用 GENCODE v22）。</span><br><span>#建议使用未规范化和未转换（ unnormalized and untransformed）的count data。当原始计数不可用时，线性归一化（例如 TPM、RPM、RPKM、FPKM）也是可以接受的，因为 BayesPrism 对reference和mixture之间的线性乘法差异具有鲁棒性（换个单词 即Robust）。理想情况下，如果使用规范化数据，最好提供参考数据和通过相同方法转换的批量数据。应避免log转换。</span><br><br>exp &lt;- <span>2</span>^exprSet - <span>1</span> <span># 逆转回TPM</span><br>exp_pre &lt;- t(exp)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>3、scRNA数据预处理</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>sc_dataset &lt;- sub_scRNA<br>sc_dat &lt;- as.data.frame(sc_dataset@assays$RNA@counts)<br>sc_dat_pre &lt;- t(sc_dat)<br>table(sc_dataset$celltype)<br><br><span># 对细胞类型进行质量控制</span><br>plot.cor.phi (input=sc_dat_pre, <br>              input.labels=sc_dataset$celltype, <br>              title=<span>"cell type correlation"</span>,<br>              <span>#specify pdf.prefix if need to output to pdf</span><br>              <span>#pdf.prefix="gbm.cor.ct",</span><br>              cexRow=<span>0.5</span>, cexCol=<span>0.5</span>,<br>)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>4、过滤离群基因-单细胞和bulk</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span>#查看单细胞数据的离群基因</span><br><span>#sc.stat 显示每个基因的归一化平均表达(x 轴)和最大特异性(y 轴)的对数，以及每个基因是否属于一个潜在的异常值类别。Other _ Rb 是由核糖体假基因组成的一组精选基因。</span><br>sc.stat &lt;- plot.scRNA.outlier(<br>  input=sc_dat_pre, <span>#make sure the colnames are gene symbol or ENSMEBL ID </span><br>  cell.type.labels=sc_dataset$celltype,<br>  species=<span>"hs"</span>, <span>#currently only human(hs) and mouse(mm) annotations are supported</span><br>  return.raw=<span>TRUE</span> <span>#return the data used for plotting. </span><br>  <span>#pdf.prefix="gbm.sc.stat" specify pdf.prefix if need to output to pdf</span><br>)<br>head(sc.stat)  <br><br><span>#查看bulk细胞数据的离群基因</span><br>bk.stat &lt;- plot.bulk.outlier(<br>  bulk.input=exp_pre,<span>#make sure the colnames are gene symbol or ENSMEBL ID </span><br>  sc.input=sc_dat_pre, <span>#make sure the colnames are gene symbol or ENSMEBL ID </span><br>  cell.type.labels=sc_dataset$celltype,<br>  species=<span>"hs"</span>, <span>#currently only human(hs) and mouse(mm) annotations are supported</span><br>  return.raw=<span>TRUE</span><br>  <span>#pdf.prefix="gbm.bk.stat" specify pdf.prefix if need to output to pdf</span><br>)<br>head(bk.stat)<br><br><span>#过滤基因</span><br>sc.dat.filtered &lt;- cleanup.genes (input=sc_dat_pre,<br>                                   input.type=<span>"count.matrix"</span>,<br>                                   species=<span>"hs"</span>, <br>                                   gene.group=c( <span>"Rb"</span>,<span>"Mrp"</span>,<span>"other_Rb"</span>,<br>                                                 <span>"chrM"</span>,<span>"MALAT1"</span>,<span>"chrX"</span>,<span>"chrY"</span>) ,<br>                                   exp.cells=<span>5</span>)<br>plot.bulk.vs.sc (sc.input = sc.dat.filtered,<br>                 bulk.input = exp_pre<br>                 <span>#pdf.prefix="gbm.bk.vs.sc" specify pdf.prefix if need to output to pdf</span><br>)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>5、根据 “蛋白编码基因”确定子集</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>sc.dat.filtered.pc &lt;-  select.gene.type(sc.dat.filtered,<br>                                        gene.type = <span>"protein_coding"</span>)<br><span>#根据‘signature gene’确定子集</span><br><span>#或者，在细胞类型被定义为其中一些显示非常相似的转录或存在严重的批次效应的情况下，例如，reference 和mixture 来自不同的测定手段，选择signature gene是可行的。这是因为特征基因的选择可以丰富用于反卷积的基因信息，同时减少技术批量效应造成的噪声影响。</span><br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>6、构建BayesPrism模型</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>myPrism &lt;- new.prism(<br>   reference=sc.dat.filtered.pc, <br>   mixture=exp_pre,<br>   input.type=<span>"count.matrix"</span>, <br>   cell.type.labels = sc_dataset$celltype, <br>   cell.state.labels =<span>NULL</span>, <span># 不同的细胞状态不能分配到同一细胞类型中</span><br>   key= Malignant cells,   <span>#"Malignant cells",#key是 cell.type.label 中对应于恶性细胞类型的字符向量。如无恶性细胞，即设置为 NULL，此时，所有类型的细胞将被 treated equally。</span><br>   outlier.cut=<span>0.01</span>,<br>   outlier.fraction=<span>0.1</span>,<br> )<br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span>7、运行BayesPrism</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span>#后续即运行BayesPrism控制 Gibbs 采样和优化的参数可以使用 Gibbs.control 和 opt.control 指定。?run.prism获取details。这里建议使用默认参数</span><br>system.time({<br>bp.res &lt;- run.prism(prism = myPrism, n.cores=<span>20</span>)<br>})<br>  <span>#   user   system  elapsed </span><br>  <span># 75.387  248.935 3588.547</span><br><br><span>#qsave(sc_dataset,"sc_dataset.qs")</span><br>qsave(bp.res,file = <span>"bp.res.qs"</span>)<br></code></pre><p data-tool="mdnice编辑器">额，运行了差不多1小时...</p><h5 data-tool="mdnice编辑器"><span></span><span>8、提取细胞型分数 θ 的后验平均值/变异分数(CV)/Z分数</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>bp.res &lt;- qread(<span>"bp.res.qs"</span>)<br><span># 提取细胞型分数 θ 的后验平均值</span><br>theta &lt;- get.fraction (bp=bp.res,<br>            which.theta=<span>"final"</span>,<br>            state.or.type=<span>"type"</span>)<br><br>head(theta)<br>write.csv(theta,<span>"theta.csv"</span>)<br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span>统计分析环节</span><span></span></h4><h5 data-tool="mdnice编辑器"><span></span><span>1、简单的做个相关性分析</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>Bisque_res &lt;- read.csv(<span>"ref.based.estimates.csv"</span>,header = <span>T</span>,row.names = <span>1</span>)<br>BayesPrism_res &lt;- read.csv(<span>"theta.csv"</span>,header = <span>T</span>,row.names = <span>1</span>)<br>identical(rownames(Bisque_res),rownames(BayesPrism_res))<br>colnames(Bisque_res) &lt;- paste0(colnames(Bisque_res), <span>"_Bisque"</span>)<br>colnames(BayesPrism_res) &lt;- paste0(colnames(BayesPrism_res), <span>"_Bayes"</span>)<br>colnames(Bisque_res)<br>colnames(BayesPrism_res)<br>dat &lt;- cbind(Bisque_res,BayesPrism_res)<br><br><span># 绘图相关性分析</span><br><span># 加载所需的包</span><br><span>library</span>(ggstatsplot)<br><span>library</span>(patchwork) <span># 用于合并图像</span><br><span># 创建空列表用于存储图像</span><br>plot_list &lt;- list()<br><span># 获取细胞类型的名称，确保它们的名称能够被列索引</span><br>cells_Bisque &lt;- grep(<span>"_Bisque$"</span>, colnames(dat), value = <span>TRUE</span>)<br>cells_Bayes &lt;- gsub(<span>"_Bisque$"</span>, <span>"_Bayes"</span>, cells_Bisque)<br><span># 循环生成每个细胞类型的散点图</span><br><span>for</span> (i <span>in</span> seq_along(cells_Bisque)) {<br>  bisque_col &lt;- cells_Bisque[i]<br>  bayes_col &lt;- cells_Bayes[i]<br><br>  <span># 确保列名在数据集中存在</span><br>  <span>if</span> (bisque_col %<span>in</span>% colnames(dat) &amp;&amp; bayes_col %<span>in</span>% colnames(dat)) {<br>    <span># 从数据集中提取x和y的列</span><br>    x_data &lt;- dat[[bisque_col]]<br>    y_data &lt;- dat[[bayes_col]]<br>    <br>    <span># 生成散点图并添加到列表中</span><br>    p &lt;- ggscatterstats(<br>      data = data.frame(x = x_data, y = y_data),  <span># 创建新数据框</span><br>      x = x,  <br>      y = y,<br>      xlab = bisque_col,<br>      ylab = bayes_col,<br>      bf.message = <span>FALSE</span><br>    )<br>    <span># 将生成的图加入列表</span><br>    plot_list[[i]] &lt;- p<br>  }<br>}<br><br><span># 使用 patchwork 将所有图合并成一张图</span><br>combined_plot &lt;- wrap_plots(plot_list, ncol = <span>3</span>) <span># ncol 设置每行显示的图数</span><br><br><span># 显示合并后的图</span><br>print(combined_plot)<br><br><span># 保存合并后的图像</span><br><span>library</span>(ggplot2)<br>ggsave(<br>  filename = <span>"combined_plot.png"</span>, <span># 文件名，可以更改为你需要的名字和格式</span><br>  plot = combined_plot,           <span># 传入需要保存的图</span><br>  width = <span>12</span>,                     <span># 图的宽度，根据需要调整</span><br>  height = <span>12</span>,                     <span># 图的高度，根据需要调整</span><br>  units = <span>"in"</span>,                   <span># 尺寸单位，可以是 "in"、"cm" 或 "mm"</span><br>  dpi = <span>300</span>                       <span># 分辨率，适合打印的质量</span><br>)<br></code></pre><p data-tool="mdnice编辑器">两种不同工具得到的结果差异真的非常大！！相关性相对较好的是成纤维细胞和癌症细胞。<img data-imgfileid="100001918" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFm31TpU2Bad3DCfwHK6VVBVwS8wv2pBZuhNpe1pKDEY4RkoNKxyAgW7Pn1ULiaPeTlosNtRSpe1tg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1200" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFm31TpU2Bad3DCfwHK6VVBVwS8wv2pBZuhNpe1pKDEY4RkoNKxyAgW7Pn1ULiaPeTlosNtRSpe1tg/640?wx_fmt=png&amp;from=appmsg">因此笔者在思考是不是因为模型设置的问题。</p><p data-tool="mdnice编辑器">接下来在构建BayesPrism模型的时候把key设置为NULL。让函数对每一个细胞类型平等对待。</p><h5 data-tool="mdnice编辑器"><span></span><span>2、重新构建BayesPrism模型</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>myPrism &lt;- new.prism(<br>   reference=sc.dat.filtered.pc, <br>   mixture=exp_pre,<br>   input.type=<span>"count.matrix"</span>, <br>   cell.type.labels = sc_dataset$celltype, <br>   cell.state.labels =<span>NULL</span>, <span># 不同的细胞状态不能分配到同一细胞类型中</span><br>   key= <span>NULL</span>,   <span>#"Malignant cells",#key是 cell.type.label 中对应于恶性细胞类型的字符向量。如无恶性细胞，即设置为 NULL，此时，所有类型的细胞将被 treated equally。</span><br>   outlier.cut=<span>0.01</span>,<br>   outlier.fraction=<span>0.1</span>,<br> )<br></code></pre><p data-tool="mdnice编辑器">相关性还是不咋地，结果倒是跟第一次的十分相似！因此这就跟key值设定没有很大关系啦，应该是跟两种算法的底层逻辑有关。<img data-imgfileid="100001917" data-ratio="0.955719557195572" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFm31TpU2Bad3DCfwHK6VVBPXK186yZOljDsmrIibdsl62KMjUibsl78CPaIjpKbOCJGr3GhKJ2zrUg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="813" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFm31TpU2Bad3DCfwHK6VVBPXK186yZOljDsmrIibdsl62KMjUibsl78CPaIjpKbOCJGr3GhKJ2zrUg/640?wx_fmt=png&amp;from=appmsg"></p><h5 data-tool="mdnice编辑器"><span></span><span>3、再画一个简单的柱状图</span><span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(ggplot2)<br><span>library</span>(reshape2)<br><br><span># 将数据转换为长格式</span><br>dat_long &lt;- melt(dat, variable.name = <span>"Cell_Type"</span>, value.name = <span>"Value"</span>)<br><br><span># 提取细胞类型（去掉后面的_Bisque, _Bayes, _Bayes2）</span><br>dat_long$Cell_Group &lt;- gsub(<span>"_Bisque$|_Bayes$|_Bayes2$"</span>, <span>""</span>, dat_long$Cell_Type)<br><br><span># 按细胞类型排序</span><br>dat_long &lt;- dat_long[order(dat_long$Cell_Group, dat_long$Cell_Type), ]<br><br><span># 绘制柱状图，按细胞类型分组着色</span><br>ggplot(dat_long, aes(x = factor(Cell_Type, levels = unique(dat_long$Cell_Type)), y = Value, fill = Cell_Group)) +<br>  geom_bar(stat = <span>"identity"</span>, position = <span>"dodge"</span>) +<br>  labs(x = <span>"Cell Type"</span>, y = <span>"Value"</span>, title = <span>"Cell Type Distribution by Group"</span>) +<br>  theme(axis.text.x = element_text(angle = <span>45</span>, hjust = <span>1</span>)) + <span># 旋转x轴标签</span><br>  scale_fill_manual(values = c(<span>"blue"</span>, <span>"red"</span>, <span>"green"</span>, <span>"purple"</span>, <span>"orange"</span>, <span>"pink"</span>, <span>"brown"</span>,<span>"grey"</span>)) <span># 根据需要调整颜色</span><br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100001919" data-ratio="0.5" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFm31TpU2Bad3DCfwHK6VVBWibM8ohKTtjPwZDkxsUkAgUShSw91LiaHeoKgDv3cibDKVuT7HiaLIktww/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="3600" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyFm31TpU2Bad3DCfwHK6VVBWibM8ohKTtjPwZDkxsUkAgUShSw91LiaHeoKgDv3cibDKVuT7HiaLIktww/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">直接在pubmed中搜索关键词 BisqueRNA 或者 BayesPrism，目前后者的文章略多一些。</p><p data-tool="mdnice编辑器">至于该用哪个工具，大家就仁者见仁智者见智吧~</p><h4 data-tool="mdnice编辑器"><span></span><span>参考资料：</span><span></span></h4><p data-tool="mdnice编辑器">1、BisqueRNA: https://github.com/cran/BisqueRNA</p><p data-tool="mdnice编辑器">2、BayesPrism：https://bayesprism.org/pages/tutorial_deconvolution</p><p data-tool="mdnice编辑器"><strong>致谢</strong>：感谢曾老师以及生信技能树团队全体成员。</p><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。</p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ONYpoNdRjMXUsRQurKBDZg",target="_blank" rel="noopener noreferrer">原文链接</a>
