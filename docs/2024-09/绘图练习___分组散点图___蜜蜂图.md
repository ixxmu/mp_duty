---
title: "绘图练习 | 分组散点图 / 蜜蜂图"
date: 2024-09-09T04:23:52Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
绘图练习 | 分组散点图 / 蜜蜂图 by 被炸熟的虾
------
<div><p><span></span><span></span><span>昨天我们记录了<a href="https://mp.weixin.qq.com/s?__biz=MzkwNDQwMDI5NQ==&amp;mid=2247488170&amp;idx=1&amp;sn=4cfcc7ce5d74e0c9b1e1f133fffc0e11&amp;scene=21#wechat_redirect" data-linktype="2"><strong><code>ggplot2</code>包的<code>position</code>参数使用方法</strong></a></span><span>（对下图感兴趣但没看昨天笔记的建议了解一下<img data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/2_12.png" data-ratio="1" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/2_12.png">），今天借助一个图片复现来练习一下：</span></p><p><img data-imgfileid="100004524" data-ratio="1.024556616643929" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73HcALYqOwgFopUsIYmRMys3e5FzMCqIbIDTZygEnYuSKf0ZEToFkTr7Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="733" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73HcALYqOwgFopUsIYmRMys3e5FzMCqIbIDTZygEnYuSKf0ZEToFkTr7Q/640?wx_fmt=png&amp;from=appmsg"></p><section><span></span></section><section><figure><p><span>Gut microbiota modulates weight gain in mice after discontinued smoke exposure. Nature. 2021 Dec; PMID: 34880502.</span><br></p></figure></section><section><span><strong>绘图思路：</strong></span><br></section><p><span>1</span><span>、为了避免遮盖，第一步先添加灰色背景；</span></p><p><span>2</span><span>、<strong>分组散点图</strong>：使用</span><code><span>geom_point</span></code><span>函数绘制，<strong>既要分组也要设置随机抖动</strong>，所以需要设置</span><code><span>position_jitterdodge()</span></code><span>函数；</span></p><p><span>3</span><span>、<strong>均值\中位数横线</strong>：使用</span><code><span>geom_crossbar()</span></code><span>函数绘制，注意转换函数设置。只需要分组，<span>设置</span></span><code><span>position_dodge()</span></code><span>就可以。</span></p><p><span>全文画图数据都可以在附表中找到（</span><span>Fig1B</span><span>）</span></p><h2><span>Step1、数据整理与添加背景</span></h2><pre><code><span>library</span>(readxl)<br>exprSet &lt;- as.data.frame(read_excel(<span>"./Data2.xlsx"</span>,sheet = <span>1</span>))<br>exprSet2 &lt;- reshape2::melt(exprSet)<br>head(exprSet2)<br>  <span># Group variable     value</span><br><span># 1    NS  Smoking 0.4837348</span><br><span># 2    NS  Smoking 0.2165572</span><br><span># 3    NS  Smoking 0.5785105</span><br><span># 4    NS  Smoking 0.7888895</span><br><span># 5    NS  Smoking 0.5367586</span><br><span># 6    NS  Smoking 0.4482413</span><br>exprSet2$Group &lt;- factor(exprSet2$Group,<br>                         levels = c(<span>"NS"</span>,<span>"SMK"</span>,<span>"NS+abx"</span>,<span>"SMK+abx"</span>),<br>                         labels = c(<span>"Non-\nSMK"</span>,<span>"SMK"</span>,<span>"Non-\nSMK+\nabx"</span>,<span>"SMK+\nabx"</span>))       <br>colnames(exprSet2) &lt;- c(<span>"Group2"</span>,<span>"Group"</span>,<span>"Value"</span>)<br><span>library</span>(ggplot2)<br>mytheme &lt;- theme_classic() +<br>           theme(legend.title = element_blank(),<br>                 legend.text = element_text(size = <span>20</span>),<br>                 legend.position = <span>"top"</span>,<br>                 plot.margin = margin(t = <span>5</span>,  <span># 顶部边缘距离</span><br>                                      r = <span>10</span>,  <span># 右边边缘距离</span><br>                                      b = <span>5</span>,  <span># 底部边缘距离</span><br>                                      l = <span>5</span>), <span># 左边边缘距离</span><br>                 axis.text = element_text(size = <span>20</span>),<br>                 axis.title = element_text(size = <span>20</span>))<br></code></pre><p><span>生成一个空图，<strong>添加分类背景图层</strong>：</span></p><pre><code><span>library</span>(ggplot2)<br>p1 &lt;- ggplot(exprSet2,aes(x = Group,y = Value)) +<br>      scale_y_continuous(expand = c(<span>0</span>,<span>0</span>),limits = c(-<span>1</span>,<span>4</span>),breaks = seq(-<span>1</span>,<span>4</span>,<span>1</span>)) + <br>      labs(x = <span>NULL</span>,y = <span>"Weight Change(%)"</span>,title = <span>NULL</span>) + <br>      mytheme <br>p2 &lt;- p1 + <br>      annotate(<span>"rect"</span>, xmin = <span>1.5</span>, xmax = <span>Inf</span>, fill = <span>"grey"</span>,<br>               ymin = -<span>1</span>, ymax = <span>Inf</span>, alpha = <span>.9</span>) <br></code></pre><p><span>此时的背景位置有点偏，不用担心</span></p><p><img data-galleryid="" data-imgfileid="100004525" data-ratio="1.0095238095238095" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73HvCYylibtnAsFOrHLkUTicwwC1xo5ObEU5cmz6ERP3kLI4HsK7OiaalZbg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="735" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73HvCYylibtnAsFOrHLkUTicwwC1xo5ObEU5cmz6ERP3kLI4HsK7OiaalZbg/640?wx_fmt=png&amp;from=appmsg"></p><p><span></span></p><h2><span>Step2、添加图形主体</span></h2><p><strong><span>添加散点:</span></strong></p><pre><code>p3 &lt;- p2 + <br>      <span># 添加散点</span><br>      geom_point(aes(fill = Group2),<br>                 show.legend = <span>F</span>,color = <span>"black"</span>,<br>                 position = position_jitterdodge(seed = <span>12345</span>,<br>                                                 dodge.width = <span>0.8</span>,<br>                                                 jitter.width = <span>0.15</span>),<br>                 shape = <span>21</span>,size = <span>4</span>)<br></code></pre><p><strong><span>均值\中位数横线:</span></strong></p><pre><code>p4 &lt;- p3 + <br>      <span># 均值\中位数横线</span><br>      geom_crossbar(aes(fill = Group2),<br>                    stat = <span>"summary"</span>,<br>                    fun = median,<br>                    position = position_dodge(width = <span>0.8</span>),<br>                    size = <span>0.5</span>,width = <span>0.5</span>,<br>                    color = <span>'black'</span>)<br>      <span># stat_summary(fun = median,</span><br>                   <span># position = position_dodge(width = 0.8),</span><br>                   <span># geom = "crossbar",</span><br>                   <span># size = 0.5,width = 0.5,</span><br>                   <span># color = 'black')</span><br></code></pre><p><strong><span>修改颜色并添加额外水平线:</span></strong></p><pre><code>p5 &lt;- p4 + <br>      <span># 修改颜色</span><br>      scale_color_manual(values = c(<span>"#4d97cd"</span>,<span>"#db6968"</span>,<span>"#008343"</span>,<span>"#e8c559"</span>)) +<br>      scale_fill_manual(values = c(<span>"#4d97cd"</span>,<span>"#db6968"</span>,<span>"#008343"</span>,<span>"#e8c559"</span>)) + <br>      <span># 添加额外水平线</span><br>      geom_hline(yintercept = <span>0</span>,<br>                 size = <span>1</span>,color = <span>"black"</span>,lty = <span>"dashed"</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004526" data-ratio="1.0081632653061225" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73HQcT4rU42Kib6llhCvSpNbeI6iaZUKImtHCCuzuFwQ01Q6Mkiaz0h1z28Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="735" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73HQcT4rU42Kib6llhCvSpNbeI6iaZUKImtHCCuzuFwQ01Q6Mkiaz0h1z28Q/640?wx_fmt=png&amp;from=appmsg"></p><h2><span>Step3、添加显著性检验</span></h2><pre><code><span>library</span>(rstatix)<br><span>library</span>(tidyverse)<br>stat.test &lt;- exprSet2 %&gt;% <br>             group_by(Group) %&gt;% <br>             t_test(Value ~ Group2) %&gt;%<br>             adjust_pvalue() %&gt;% <br>             add_significance(<span>"p.adj"</span>) %&gt;% <br>             add_xy_position(x = <span>"Group"</span>)<br>data.frame(stat.test)<br>stat.test$y.position &lt;- stat.test$y.position - <span>0.5</span><br>p5 + stat_pvalue_manual(stat.test,label = <span>"p.adj.signif"</span>,hide.ns = <span>T</span>,<span>#label = "p" or label = "p.adj"</span><br>                        tip.length = <span>0.01</span>,label.size = <span>8</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004527" data-ratio="0.9890859481582538" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73Hxd82iadf4qWFPcjGrTUnIsQmee10c1W3dh6libnxgj8QbKB2bRGXBK3Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="733" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73Hxd82iadf4qWFPcjGrTUnIsQmee10c1W3dh6libnxgj8QbKB2bRGXBK3Q/640?wx_fmt=png&amp;from=appmsg"></p><p><strong><span></span></strong></p><p><strong><span>手动添加</span></strong><span>（因为作者只标注了部分）:</span></p><pre><code>tmp &lt;- stat.test[c(<span>1</span>,<span>6</span>,<span>7</span>,<span>11</span>),]<br>data.frame(tmp)<br><span>#      Group   .y.          group1    group2 n1 n2 statistic       df        p</span><br><span>#1   Smoking Value       Non-\nSMK       SMK 37 38  8.657194 52.58912 1.08e-11</span><br><span>#2   Smoking Value Non-\nSMK+\nabx SMK+\nabx 40 39  9.813350 55.89030 9.20e-14</span><br><span>#3 Cessation Value       Non-\nSMK       SMK 33 34 -9.476267 62.06300 1.13e-13</span><br><span>#4 Cessation Value             SMK SMK+\nabx 34 34  5.275416 59.57884 1.94e-06</span><br><span>#      p.adj p.adj.signif y.position                     groups x xmin xmax</span><br><span>#1 8.640e-11         ****   2.062760             Non-\nSMK, SMK 1  0.7  0.9</span><br><span>#2 1.104e-12         ****   3.627320 Non-\nSMK+\nabx, SMK+\nabx 1  1.1  1.3</span><br><span>#3 1.130e-12         ****   2.567760             Non-\nSMK, SMK 2  1.7  1.9</span><br><span>#4 1.164e-05         ****   3.819408             SMK, SMK+\nabx 2  1.9  2.3</span><br><span>library</span>(ggsignif)<br>p5 + geom_signif(annotations = tmp$p.adj.signif,<br>                 y_position = c(<span>2.5</span>,<span>2.8</span>,<span>3.1</span>,<span>3.6</span>),<br>                 xmin = tmp$xmin,<br>                 xmax = tmp$xmax,<br>                 size = <span>1.2</span>,textsize = <span>8</span>,<br>                 tip_length = <span>0</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100004528" data-ratio="0.9823369565217391" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73HaiaRd6pMoCzN65Ju3BmPy6OPcI7PQQnvQIG1cLTNqVsDnrbbJAIAptw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="736" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JiaRlCACeic4cRvwLodUM73HaiaRd6pMoCzN65Ju3BmPy6OPcI7PQQnvQIG1cLTNqVsDnrbbJAIAptw/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><h3><span></span></h3><section><span></span></section><section><img data-imgfileid="100003752" data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="png" data-w="341" src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section><section data-tools="135编辑器" data-id="116886" draggable="true"><section><section><section><section><strong data-brushtype="text">被炸熟的虾</strong></section></section></section><section><section><section data-width="35%"><section><img data-cropselx1="0" data-cropselx2="115" data-cropsely1="0" data-cropsely2="115" data-imgfileid="100003750" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="jpeg" data-w="258" data-width="100%" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section></section><section data-width="63%"><section><section><strong>自己的摸索，发现问题麻烦告诉作者，光速回来改正</strong><strong><img data-imgfileid="100003751" data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" data-type="png" data-w="64" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></strong></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/z044AxGC12Ax9qq2fr4Djg",target="_blank" rel="noopener noreferrer">原文链接</a>
