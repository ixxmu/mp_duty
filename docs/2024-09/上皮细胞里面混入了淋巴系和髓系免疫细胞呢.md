---
title: "上皮细胞里面混入了淋巴系和髓系免疫细胞呢"
date: 2024-09-15T19:47:27Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
上皮细胞里面混入了淋巴系和髓系免疫细胞呢 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>针对这个这个胃癌单细胞数据集GSE163558，我做了解读，详见 ：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533053&amp;idx=1&amp;sn=bd155638b280e875dcae14622198b65b&amp;scene=21#wechat_redirect" data-linktype="2">单细胞转录组降维聚类分群过滤基因和过滤细胞的区别</a> 。而且前面已经是完成了降维聚类分群，在<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533061&amp;idx=1&amp;sn=de67737df31c0302667d9c7a75214415&amp;scene=21#wechat_redirect" data-linktype="2">学习单细胞亚群命名的层次结构</a> 演示了一个降维聚类分群结果，就有了  2-harmony/sce.all_int.rds 文件，以及对应的 phe.Rdata 注释信息。</p></blockquote><p data-tool="mdnice编辑器">在文献里面的单细胞亚群以及其对应的基因和细胞数量分别是：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; <span>print</span>(cell_groups)<br>          Group Count               Genes<br>1    Epithelial  1743 EPCAM, KRT19, CLDN4<br>2       Stromal  1288 PECAM1, CLO1A2, VWF<br>3 Proliferative  1089  MKI67, STMN1, PCNA<br>4             T 24448     CD3D, CD3E, CD2<br>5             B  7708 CD79A, IGHG1, MS4A1<br>6            NK  1173  KLRD1, GNLY, KLRF1<br>7       Myeloid  5519  CSF1R, CSF3R, CD68<br></code></pre><p data-tool="mdnice编辑器">也就是说， 我把髓系免疫细胞区分成为巨噬细胞和中性粒细胞，还有mast细胞，而且把b细胞是可以区分成为浆细胞和普通b细胞。跟文章不一样的哦，所以我得到如下所示的亚群：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100049849" data-ratio="0.7888888888888889" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyt0ib2dmzuhyr9tJhzdRCx51Gu0uIDw6icj3OZMStIJlDXa3Gc2fTBFXlE2drIK2Fia6vCUNDDYZxHg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyt0ib2dmzuhyr9tJhzdRCx51Gu0uIDw6icj3OZMStIJlDXa3Gc2fTBFXlE2drIK2Fia6vCUNDDYZxHg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">可以看到每个单细胞亚群都是泾渭分明的，而且有一个独立的细胞增殖状态的亚群它是多种不同单细胞亚群的混合物。</p><h3 data-tool="mdnice编辑器"><span></span><span>提取上皮细胞进行细分亚群</span><span></span></h3><p data-tool="mdnice编辑器">我在第一层次降维聚类分群的工作文件夹里面新建了  sub-cluster/sub-epi-inferCNV 这样的文件夹结构，然后重新开始新的r项目，所以需要如下所示的代码提取上皮细胞：</p><pre data-tool="mdnice编辑器"><span></span><code>sce.all.int = readRDS(<span>'../../2-harmony/sce.all_int.rds'</span>)<br>colnames(sce.all.int@meta.data) <br>load(<span>'../../phe.Rdata'</span>)<br>table(phe$celltype)  <br>sce.all=sce.all.int[,phe$celltype %<span>in</span>% c(<span>'epi'</span> ) ]<br>sce.all=CreateSeuratObject(<br>  counts = sce.all@assays$RNA$counts,<br>  meta.data = sce.all@meta.data<br>)<br></code></pre><p data-tool="mdnice编辑器">就读取上面的两层的文件夹里面的   2-harmony/sce.all_int.rds 文件，以及对应的 phe.Rdata 注释信息。然后仍然是默认的降维聚类分群而已：</p><pre data-tool="mdnice编辑器"><span></span><code>sp=<span>'human'</span><br><span>###### step2:QC质控 ######</span><br>dir.create(<span>"./1-QC"</span>)<br>setwd(<span>"./1-QC"</span>)<br><span># 如果过滤的太狠，就需要去修改这个过滤代码</span><br><span>source</span>(<span>'../../../scRNA_scripts/qc.R'</span>)<br>sce.all.filt = basic_qc(sce.all)<br>print(dim(sce.all))<br>print(dim(sce.all.filt))<br>setwd(<span>'../'</span>)<br>getwd()<br> <br><span>###### step3: harmony整合多个单细胞样品 ######</span><br><br><span>if</span>(<span>T</span>){<br>  dir.create(<span>"2-harmony"</span>)<br>  getwd()<br>  setwd(<span>"2-harmony"</span>)<br>  <span>source</span>(<span>'../../../scRNA_scripts/harmony.R'</span>)<br>  <span># 默认 ScaleData 没有添加"nCount_RNA", "nFeature_RNA"</span><br>  <span># 默认的</span><br>  sce.all.int = run_harmony(sce.all.filt)<br>  setwd(<span>'../'</span>)<br>  <br>}<br><br>sce.all.tmp &lt;- RunUMAP(sce.all.int, dims = <span>1</span>:<span>15</span>, <br>                       reduction = <span>"pca"</span>)<br>DimPlot(sce.all.int,group.by = <span>'orig.ident'</span>) + <br>  DimPlot(sce.all.tmp,group.by = <span>'orig.ident'</span>)<br><br><br><span>###### step4:  看标记基因库 ######</span><br><span># 原则上分辨率是需要自己肉眼判断，取决于个人经验</span><br><span># 为了省力，我们直接看  0.1 </span><br>dir.create(<span>'check-by-0.1'</span>)<br>setwd(<span>'check-by-0.1'</span>)<br>sel.clust = <span>"RNA_snn_res.0.1"</span><br>sce.all.int &lt;- SetIdent(sce.all.int, value = sel.clust)<br>table(sce.all.int@active.ident) <br><br><span>source</span>(<span>'../../../scRNA_scripts/check-all-markers.R'</span>)<br>setwd(<span>'../'</span>) <br>getwd()<br><br></code></pre><p data-tool="mdnice编辑器">这个时候很明显的可以看到上皮细胞的降维聚类分群居然是出现了淋巴系和髓系免疫细胞的干扰哦，如下所示：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100049851" data-ratio="1.3101851851851851" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyt0ib2dmzuhyr9tJhzdRCx5iazlZeKnat8rTRGAbsNra2bNGWJEKYcpMK7LwTWlQJK8hSkpM79Kmgw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyt0ib2dmzuhyr9tJhzdRCx5iazlZeKnat8rTRGAbsNra2bNGWJEKYcpMK7LwTWlQJK8hSkpM79Kmgw/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">可以看到，cluster4是t淋巴细胞，而cluster6应该是髓系免疫细胞（可能是巨噬细胞或者单核细胞，中性粒细胞）。</p><p data-tool="mdnice编辑器">值得注意是，这个是上皮细胞的子集，我仍然是使用了harmony算法去除个体差异，如果是要考虑肿瘤病人间的异质性就不推荐使用harmony哦！</p><h3 data-tool="mdnice编辑器"><span></span><span>进一步确定这些是淋巴系和髓系免疫细胞而不是上皮细胞</span><span></span></h3><p data-tool="mdnice编辑器">如果是从上面的标记基因来看，确实是全部的细分亚群都是有上皮细胞特异性的基因的，但是如果看每个亚群的top基因和功能，就可以确定这些是淋巴系和髓系免疫细胞而不是上皮细胞啦。</p><p data-tool="mdnice编辑器">首先看看每个细分亚群的top10的基因，如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>cluster0:GABRP,RARRES3,TRIM29,CD55,ITGB4,AL121761.2<br> cluster1:TOP2A,CCNB1,ROMO1,OLFM4,GSTP1,TPX2<br> cluster2:HIST1H2BG,AL137077.2,CSKMT,PCK1,LINC00668,SOCS1<br> cluster3:MT1F,MT1M,METTL7A,CHGA,CPE,PTPRN2<br> cluster4:CD2,CD52,CD3D,CCL5,HCST,CD3E<br> cluster5:NPPB,TNF,CYP2E1,C6orf222,AC092069.1,LY6K<br> cluster6:FCGR3B,PLEK,G0S2,OSM,CSF3R,BCL2A1 <br></code></pre><p data-tool="mdnice编辑器">可以看到，cluster4是t淋巴细胞，而cluster6应该是中性粒细胞这样的髓系免疫细胞。基本上就可以手动给出来了这些单细胞亚群名字啦；</p><pre data-tool="mdnice编辑器"><span></span><code><span># 如果是手动给各个单细胞亚群命名</span><br><span>if</span>(<span>T</span>){<br>  sce.all.int<br>  celltype=data.frame(ClusterID=<span>0</span>:<span>6</span> ,<br>                      celltype= <span>0</span>:<span>6</span>  ) <br>  <span>#定义细胞亚群        </span><br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>4</span>  ),<span>2</span>]=<span>'Tcells'</span>      <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>6</span> ),<span>2</span>]=<span>'myeloids'</span>  <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>3</span> ),<span>2</span>]=<span>'normal'</span>  <br>  <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>0</span> ),<span>2</span>]=<span>'epi-1'</span><br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>1</span> ),<span>2</span>]=<span>'epi-2'</span> <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>2</span> ),<span>2</span>]=<span>'epi-3'</span>    <br>  celltype[celltype$ClusterID %<span>in</span>% c( <span>5</span> ),<span>2</span>]=<span>'epi-4'</span>    <br>   <br>  head(celltype)<br>  celltype<br>  table(celltype$celltype)<br>  sce.all.int@meta.data$celltype = <span>"NA"</span><br>  <br>  <span>for</span>(i <span>in</span> <span>1</span>:nrow(celltype)){<br>    sce.all.int@meta.data[which(sce.all.int@meta.data$RNA_snn_res.0.1 == celltype$ClusterID[i]),<span>'celltype'</span>] &lt;- celltype$celltype[i]}<br>  Idents(sce.all.int)=sce.all.int$celltype<br>  <br>  <br>} <br>table(Idents(sce.all.int)) <br></code></pre><p data-tool="mdnice编辑器">然后就可以看功能：</p><pre data-tool="mdnice编辑器"><span></span><code>sce = sce.all.int<br>  sel.clust = <span>"celltype"</span><br>  sce &lt;- SetIdent(sce, value = sel.clust)<br>  table(sce@active.ident) <br>  markers &lt;- FindAllMarkers(object = sce, only.pos = <span>TRUE</span>, <br>                            min.pct = <span>0.25</span>, <br>                            thresh.use = <span>0.25</span>)<br>  <span>#write.csv(markers,file='markers.csv')</span><br>  table(markers$cluster)<br>  <span>library</span>(dplyr)  <br>  <span>library</span>(clusterProfiler)  <br>  markers = markers[markers$p_val &lt;<span>0.01</span> &amp; markers$avg_log2FC &gt;<span>1</span>,]  <br>  table(markers$cluster)<br>  symbols_list = split(markers$gene,markers$cluster)<br>  <span>source</span>(<span>'../com_go_kegg_ReactomePA_human.R'</span>) <br>  com_go_kegg_ReactomePA_human(symbols_list, pro=<span>'epi'</span> ) <br></code></pre><p data-tool="mdnice编辑器">上面的代码需要source一个外部的R代码文件哦，然后就可以愉快的做go和kegg注释并且一次性出很多图啦！<strong>很明显的可以看到确实是命名为t细胞和髓系是合理的：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100049850" data-ratio="0.5518518518518518" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyt0ib2dmzuhyr9tJhzdRCx5qU0ER500gqZbEoNUIUYfYO8kEnIm5AkLFTN0ZGTednGmQ0Dykgbwxg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyt0ib2dmzuhyr9tJhzdRCx5qU0ER500gqZbEoNUIUYfYO8kEnIm5AkLFTN0ZGTednGmQ0Dykgbwxg/640?wx_fmt=png&amp;from=appmsg"></figure></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span>写在文末</span></h3></section><p>如果你也想做单细胞转录组数据分析，<span>最好是有自己的计算机资源哦，比如我们的</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247528363&amp;idx=1&amp;sn=5e02f3e9b2e148191e23ebc2c0d780e7&amp;scene=21#wechat_redirect" data-linktype="2">2024的共享服务器交个朋友福利价仍然是800</a><span>，而且还需要有基本的生物信息学基础，也可以看看我们的</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247531929&amp;idx=1&amp;sn=f6f16b7bf6b907360d6d0052e3d10cf6&amp;chksm=9b4b3d22ac3cb434b6aa7753a4cf0f266578147ccf10b49cc834e46af578ee6de99be0accb30&amp;scene=21#wechat_redirect" textvalue="生物信息学马拉‍松授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a><span> ，你的生物信息学入门课。 </span></p><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/g5ywA-ex2XcDuNZ8MK-dvA",target="_blank" rel="noopener noreferrer">原文链接</a>
