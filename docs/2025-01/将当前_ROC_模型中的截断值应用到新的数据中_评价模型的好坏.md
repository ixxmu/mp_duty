---
title: "将当前 ROC 模型中的截断值应用到新的数据中，评价模型的好坏"
date: 2025-01-11T00:04:14Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
将当前 ROC 模型中的截断值应用到新的数据中，评价模型的好坏 by 生信小博士
------
<div><p><span>我们将基于之前使用的 </span><code><span>gene_expression</span></code><span> 数据，并模拟一个新的数据集，详细讲解如何将当前模型中获取的截断值应用到新数据中，以评价当前模型的性能。</span></p><h3><span><strong><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247488496&amp;idx=1&amp;sn=80eafaa2f586ae27afd8b0832f526aab&amp;scene=21#wechat_redirect" textvalue="什么是ROC曲线？有何作用？如何理解？" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">什么是ROC曲线？有何作用？如何理解？</a><br></strong></span></h3><h3><span><strong><br></strong></span></h3><h3><span><strong>1. 原始数据与 ROC 模型构建</strong></span></h3><h4><span><strong>(1) 原始数据</strong></span></h4><ul><li><p><span>真实标签（</span><code><span>true_labels</span></code><span>）：</span><code><span>c(1, 0, 1, 0)</span></code><span>。</span></p></li><li><p><span>基因表达值（</span><code><span>gene_expression</span></code><span>）：</span><code><span>c(12.3, 5.6, 10.2, 4.7)</span></code><span>。</span></p></li></ul><h4><span><strong>(2) ROC 模型的构建</strong></span></h4><p><span>首先，我们基于 </span><code><span>gene_expression</span></code><span> 数据，绘制 ROC 曲线并计算最佳截断值：</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><p><code><span><span>library(pROC)</span></span></code><code><span><br></span></code><code><span><span># 原始数据</span></span></code><code><span><span>true_labels &lt;- c(1, 0, 1, 0)</span></span></code><code><span><span>gene_expression &lt;- c(12.3, 5.6, 10.2, 4.7)</span></span></code><code><span><br></span></code><code><span><span># 构建 ROC 对象</span></span></code><code><span><span>roc_obj &lt;- roc(true_labels, gene_expression)</span></span></code><code><span><br></span></code><code><span><span># 绘制 ROC 曲线</span></span></code><code><span><span>plot(roc_obj, col = "blue", main = "ROC Curve")</span></span></code><code><span><br></span></code><code><span><span># 计算 AUC 值</span></span></code><code><span><span>auc_value &lt;- auc(roc_obj)</span></span></code><code><span><span>print(paste("AUC 值：", auc_value))  # 输出 AUC 值</span></span></code><code><span><br></span></code><code><span><span># 获取最佳截断值</span></span></code><code><span><span>best_cutoff &lt;- coords(roc_obj, "best", ret = "threshold")</span></span></code><code><span><span>print(paste("最佳截断值：", best_cutoff))  # 输出最佳截断值</span></span></code><code><span><br></span></code><code><span><span>#计算结果为：</span></span></code><code><span><br></span></code><code><span><span>AUC = 1：表示当前模型在训练数据上表现完美。</span></span></code><code><span><span>最佳截断值 = 7.9：当基因表达值 ≥ 7.9 时，样本被预测为阳性（1）；否则为阴性（0）。</span></span></code><code><span><br></span></code></p></pre></section><p><img data-galleryid="" data-imgfileid="100004870" data-ratio="1.0879120879120878" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKUaic8Liav8JaIJIqib0YuiaGVjnBibfyDK1Tb4ibWSKLAag1u5DicyoO69kbQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="364" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKUaic8Liav8JaIJIqib0YuiaGVjnBibfyDK1Tb4ibWSKLAag1u5DicyoO69kbQ/640?wx_fmt=png&amp;from=appmsg"></p><h3><span><strong>2. 新数据的引入与分类</strong></span></h3><p><span>我们现在引入一个新的数据集，用于验证当前模型的分类能力。</span></p><h4><span><strong>(1) 新数据</strong></span></h4><p><span>假设新数据如下：</span></p><section><ul><li><li><li><li><li></ul><pre data-lang="css"><p><code><span><span># 新数据</span></span></code><code><span><span>new_true_labels &lt;- c(1, 0, 0, 1)  # 新数据真实标签</span></span></code><code><span><span>new_gene_expression &lt;- c(11.5, 6.0, 4.5, 10.8)  # 新数据基因表达值</span></span></code><code><span><br></span></code><code><span><br></span></code></p></pre></section><h4><span><strong>(2) 使用最佳截断值分类新数据</strong></span></h4><p><span>将之前模型中的最佳截断值 <strong>7.9</strong> 应用于新数据，预测分类结果：</span></p><section><ul><li></ul><pre data-lang="bash"><p><code><span><span># 新数据  new_true_labels &lt;- c(1, 0, 0, 1)  # 新数据真实标签  new_gene_expression &lt;- c(11.5, 6.0, 4.5, 10.8)  # 新数据基因表达值  # 使用最佳截断值对新数据进行分类  predicted_labels &lt;- ifelse(new_gene_expression &gt;= best_cutoff$threshold, 1, 0)  print(predicted_labels)  # 输出预测标签</span></span></code></p></pre></section><p><img data-galleryid="" data-imgfileid="100004871" data-ratio="0.2849604221635884" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKN4JrnPicNorNRpB6JFRiaSzKn3D7Sb7cqag2NJBibQrVmZZEo5nb2gSPQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="379" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKN4JrnPicNorNRpB6JFRiaSzKn3D7Sb7cqag2NJBibQrVmZZEo5nb2gSPQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100004872" data-ratio="0.12093023255813953" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKrCBxKEDtCeOoYTfich3qs2h0iccXic8iaFYNTCnjMxHib7OvI5cROWTXRxg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="430" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKrCBxKEDtCeOoYTfich3qs2h0iccXic8iaFYNTCnjMxHib7OvI5cROWTXRxg/640?wx_fmt=png&amp;from=appmsg"></p><h3><span><strong>3. 评价模型的好坏</strong></span></h3><p><span>通过比较新数据的真实标签（</span><code><span>new_true_labels</span></code><span>）和预测标签（</span><code><span>predicted_labels</span></code><span>），我们可以评价模型的性能。</span></p><h4><span><strong>(1) 构建混淆矩阵</strong></span></h4><p><span>混淆矩阵展示了模型的分类结果与真实标签的对比：</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><p><code><span><span># 加载 caret 包以生成混淆矩阵</span></span></code><code><span><span>library(caret)</span></span></code><code><span><br></span></code><code><span><span># 创建混淆矩阵</span></span></code><code><span><span>conf_matrix &lt;- confusionMatrix(as.factor(predicted_labels), as.factor(new_true_labels))</span></span></code><code><span><span>print(conf_matrix)</span></span></code><code><span><br></span></code><code><span><span>&gt; </span></span></code><code><span><span>&gt; # 创建混淆矩阵</span></span></code><code><span><span>&gt; conf_matrix &lt;- confusionMatrix(as.factor(predicted_labels), as.factor(new_true_labels))</span></span></code><code><span><span>&gt; print(conf_matrix)</span></span></code><code><span><span>Confusion Matrix and Statistics</span></span></code><code><span><br></span></code><code><span><span>          Reference</span></span></code><code><span><span>Prediction 0 1</span></span></code><code><span>         <span>0 2 0</span></span></code><code><span>         <span>1 0 2</span></span></code><code><span><br></span></code><code><span><span>               Accuracy : 1          </span></span></code><code><span>                 <span>95% CI : (0.3976, 1)</span></span></code><code><span><span>    No Information Rate : 0.5        </span></span></code><code><span><span>    P-Value [Acc &gt; NIR] : 0.0625     </span></span></code><code><span><br></span></code><code><span><span>                  Kappa : 1          </span></span></code><code><span><br></span></code><code><span><span> Mcnemar's Test P-Value : NA         </span></span></code><code><span><br></span></code><code><span><span>            Sensitivity : 1.0        </span></span></code><code><span><span>            Specificity : 1.0        </span></span></code><code><span><span>         Pos Pred Value : 1.0        </span></span></code><code><span><span>         Neg Pred Value : 1.0        </span></span></code><code><span><span>             Prevalence : 0.5        </span></span></code><code><span><span>         Detection Rate : 0.5        </span></span></code><code><span><span>   Detection Prevalence : 0.5        </span></span></code><code><span><span>      Balanced Accuracy : 1.0        </span></span></code><code><span><br></span></code><code><span><span>       'Positive' Class : 0</span></span></code><code><span><span>                                    </span></span></code><code><span><br></span></code></p></pre></section><p><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247488507&amp;idx=1&amp;sn=abd079bb24c4634a265b5d9b43acc53e&amp;scene=21#wechat_redirect" textvalue="ROC曲线中的特异性和灵敏度理解" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>ROC曲线中的特异性和灵敏度理解</span></a><br></p><p><img data-galleryid="" data-imgfileid="100004873" data-ratio="0.40054127198917455" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKdLhTZibFicPo1NlouJ7QbLvWGCGLFUBupo2pykIygldkpgfYKByZvT0Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="739" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKdLhTZibFicPo1NlouJ7QbLvWGCGLFUBupo2pykIygldkpgfYKByZvT0Q/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100004874" data-ratio="0.6362038664323374" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKAUvLdQu3aebNdvrAuheLeDCDqrhc6dw1KvMrrzFhm9hcvs2tFyNxiaQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="569" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKAUvLdQu3aebNdvrAuheLeDCDqrhc6dw1KvMrrzFhm9hcvs2tFyNxiaQ/640?wx_fmt=png&amp;from=appmsg"></p><p><span>其实上述指标在我们的混淆矩阵里都计算好了</span></p><hr><p><span><strong>(3) 在新数据上绘制 ROC 曲线</strong></span></p><p><span><em><span>理解一：</span></em><span>我们还可以基于新数据绘制 ROC 曲线，并计算 AUC</span><span>。</span></span></p><ol><li><p><span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247488508&amp;idx=1&amp;sn=3268feb04031b5c96bb1694241dd84ed&amp;scene=21#wechat_redirect" textvalue="ROC曲线是如何画出来的？（ROC原理篇）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">ROC曲线是如何画出来的？（ROC原理篇）</a></span></p></li><li><p><span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=Mzg2NDcxMzYwNg==&amp;mid=2247488525&amp;idx=1&amp;sn=8d45579373ec43607eac0c9a5bb30ee0&amp;scene=21#wechat_redirect" textvalue="ROC 分类器的本质是一种 评估工具 或 分析方法" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">ROC 分类器的本质是一种 评估工具 或 分析方法</a><br></span></p></li></ol><p><span>因为原来的roc模型的特征是（gene1 gene2 gene3 gene4）而不是<span>（gene5 gene6 gene7 gene8），所以我们新数据中的<span>new_gene_expression值是指原模型中的特征<span>（gene1 gene2 gene3 gene4）</span>在新数据中的值。本质上来说我们评估的是新数据集合中原模型的特征是否可以评估新数据的结局。所以我们绘制的新roc曲线应该使用new_true_labels和 new_gene_expression</span></span></span></p><p><img data-galleryid="" data-imgfileid="100004881" data-ratio="0.3005464480874317" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKDNOdskib0FO6KNxficu8lTh2M0cIv4ecpmXkDBUP0WeM9Iaf4CyhYDlA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="732" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKDNOdskib0FO6KNxficu8lTh2M0cIv4ecpmXkDBUP0WeM9Iaf4CyhYDlA/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span><span># 构建新数据的 ROC 对象</span></span></code><code><span>new_roc_obj &lt;- roc(new_true_labels, new_gene_expression)</span></code><code><span><br></span></code><code><span><span># 绘制新数据的 ROC 曲线</span></span></code><code><span>plot(new_roc_obj, col = <span>"red"</span>, main = <span>"New Data ROC Curve"</span>)</span></code><code><span><br></span></code><code><span><span># 计算新数据的 AUC 值</span></span></code><code><span>new_auc_value &lt;- auc(new_roc_obj)</span></code><code><span><span>print</span>(paste(<span>"新数据 AUC 值："</span>, new_auc_value))</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100004879" data-ratio="0.2781065088757396" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKZ4aEGps9ciaet7lqOyXWrfEAIwyhYuahCZImyiaZibnicphK1jx6ghgyNA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="507" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKZ4aEGps9ciaet7lqOyXWrfEAIwyhYuahCZImyiaZibnicphK1jx6ghgyNA/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><hr><p><span><span><em><span>理解二：</span></em></span>另外一种绘制新roc曲线的方法：这个时候我们的label就应该使用predicted_labels和new_gene_expression来画，这样才可以看出我们原来的roc模型中所获取的截断值是否具有泛化能力</span></p><p><img data-galleryid="" data-imgfileid="100004880" data-ratio="0.33147632311977715" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKKwdXwiaMGQXF5IsRtkWOnkCDAMuDQcChiccv9N2Rr8YziahIiaKOsBWukw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="718" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKKwdXwiaMGQXF5IsRtkWOnkCDAMuDQcChiccv9N2Rr8YziahIiaKOsBWukw/640?wx_fmt=png&amp;from=appmsg"></p><p><span></span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span>    <span># 构建新数据的 ROC 对象</span></span></code><code><span>    new_roc_obj &lt;- roc(predicted_labels, new_gene_expression)</span></code><code><span>    </span></code><code><span>    <span># 获取最佳截断值</span></span></code><code><span>    new_best_cutoff &lt;- coords(new_roc_obj, <span>"best"</span>, ret = <span>"threshold"</span>)</span></code><code><span>    <span>print</span>(paste(<span>"最佳截断值："</span>, new_best_cutoff ))  <span># 输出最佳截断值</span></span></code><code><span>    </span></code><code><span>    <span># 绘制新数据的 ROC 曲线</span></span></code><code><span>    plot(new_roc_obj, col = <span>"red"</span>, main = <span>"New Data ROC Curve"</span>)</span></code><code><span>    </span></code><code><span>    <span># 计算新数据的 AUC 值</span></span></code><code><span>    new_auc_value &lt;- auc(new_roc_obj)</span></code><code><span>    <span>print</span>(paste(<span>"新数据 AUC 值："</span>, new_auc_value))</span></code></pre></section><p><img data-galleryid="" data-imgfileid="100004875" data-ratio="1.1836158192090396" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFK363wJ4nmnorNXficwgg9BjwjtgdnCKelgrAFiaVTibIwtuxNiav97UkGvA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="354" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFK363wJ4nmnorNXficwgg9BjwjtgdnCKelgrAFiaVTibIwtuxNiav97UkGvA/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100004883" data-ratio="0.8318713450292398" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKHydiaCuhYhokR131SicXN9XRGBZhDBwppmAtibzPlrJ0oPia7OnpNTYiclg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="684" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sktibw29ekghZOHLg5XTDibOFKHydiaCuhYhokR131SicXN9XRGBZhDBwppmAtibzPlrJ0oPia7OnpNTYiclg/640?wx_fmt=png&amp;from=appmsg"></p><h3><span><strong>4. 结果解读</strong></span></h3><h4><span><strong><br></strong></span></h4><h4><span><strong>(1) 新数据上的分类表现</strong></span></h4><ol><li><p><span><strong>混淆矩阵</strong>：</span><span>直接展示模型的分类错误情况。</span></p></li></ol><ul><li><p><span>如果 TP 和 TN 数量较高，而 FP 和 FN 数量较低，则模型在新数据上的表现较好。</span></p></li></ul><li><p><span><strong>AUC 值</strong>：如果新数据的 AUC 值仍然接近 1，说明模型的分类能力在新数据上也很好。</span></p></li><h4><span><strong><br></strong></span></h4><h4><span><strong>(2) 当前模型的好坏</strong></span></h4><ul><li><p><span>如果新数据上的分类表现和 AUC 值与训练数据一致（如 AUC ≈ 1），说明当前模型具有良好的泛化能力。</span></p></li><li><p><span>如果新数据上的表现明显下降（如 AUC &lt; 0.7 或出现大量分类错误），可能说明：</span></p></li></ul><ol><li><p><span><strong>训练数据不足</strong>：模型过拟合于训练数据。</span></p></li><li><p><span><strong>新数据分布不同</strong>：新数据的特征分布与训练数据差异较大。</span></p></li></ol><h3><span><strong><br></strong></span></h3><h3><span><strong>5. 总结</strong></span></h3><ol><li><section><span><strong>从当前模型中获取截断值</strong>：</span></section></li></ol><ul><li><section><span>基于训练数据绘制 ROC 曲线，并选择最佳截断值（如 7.9）。</span></section></li></ul><li><section><span><strong>将截断值应用到新数据</strong>：</span></section></li><ul><li><section><span>使用截断值对新数据分类，生成预测标签。</span></section></li></ul><li><section><span><strong>评价模型性能</strong>：</span></section></li><ol></ol><ul><li><section><span>比较预测标签与真实标签，计算混淆矩阵、准确率、灵敏度、特异度等指标。</span></section></li><li><section><span>在新数据上绘制 ROC 曲线，并计算 AUC 值。</span></section></li></ul><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3y8PaIjyq8e8rBG8_PsE3w",target="_blank" rel="noopener noreferrer">原文链接</a>
