---
title: "不要再画这样的单细胞各个亚群特异性高表达量基因热图了"
date: 2025-01-27T02:26:12Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
不要再画这样的单细胞各个亚群特异性高表达量基因热图了 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>常规的单细胞转录组数据分析，如果是基于r编程语言的话，使用seurat包的标准流程即可，虽然它默认出图并不好看。</p></blockquote><p data-tool="mdnice编辑器">详见以前我们做的投票：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247500816&amp;idx=1&amp;sn=25568540a54d63225def0804c05025f8&amp;scene=21#wechat_redirect" data-linktype="2">可视化单细胞亚群的标记基因的5个方法</a>，下面的5个基础函数相信大家都是已经烂熟于心了：</p><ul data-tool="mdnice编辑器"><li><section>VlnPlot(pbmc, features = c("MS4A1", "CD79A"))</section></li><li><section>FeaturePlot(pbmc, features = c("MS4A1", "CD79A"))</section></li><li><section>RidgePlot(pbmc, features = c("MS4A1", "CD79A"), ncol = 1)</section></li><li><section>DotPlot(pbmc, features = unique(features)) + RotatedAxis()</section></li><li><section>DoHeatmap(subset(pbmc, downsample = 100), features = features, size = 3)</section></li></ul><p data-tool="mdnice编辑器">很多人喜欢凑图，上面的5种可视化方法其实任选其一即可，没办法每个图都堆砌到文章里面。当然了，更重要的所如果使用，就一定要用好啊，很多文章再画这样的单细胞各个亚群特异性高表达量基因热图，漏洞百出。比如文献：《Integrated analysis of single- cell RNA sequencing and bulk transcriptome data identifies a pyroptosis-associated diagnostic model for Parkinson’s disease》，是3个单细胞转录组数据集的汇总。其中第一层次降维聚类分群后的单细胞各个亚群特异性高表达量基因热图可视化如下所示：看得出来，还是做了一些简单的修饰：</p><p><img data-galleryid="" data-imgfileid="100044054" data-ratio="0.6194444444444445" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQcghokaGv6FIEXOv0hD5ucs6oDPadKMPXUEQMurbMIib47slEMHN7BmYO98jPpQoKLF1lib6iac31IQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQcghokaGv6FIEXOv0hD5ucs6oDPadKMPXUEQMurbMIib47slEMHN7BmYO98jPpQoKLF1lib6iac31IQ/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>单细胞各个亚群特异性高表达量基因热图</figcaption></figure><p data-tool="mdnice编辑器">我们之前写了一些美化的方法学，比如：</p><ul data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247524964&amp;idx=1&amp;sn=2bffeb7a2f159f3595461f1fe108cd9f&amp;chksm=ea1c64e6dd6bedf0734a1ae2e8daa6bdb8f965e3b2748e215385d15c83e30f41581c987f5b83&amp;scene=21#wechat_redirect" data-linktype="2">使用Complexheatmap美化热图</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247524659&amp;idx=1&amp;sn=bbbefc21979ceda1068c6828ca013f5d&amp;chksm=ea1c67b1dd6beea763f33b0e7dfe4f9b2d5c3fca215e02fa1b8d69aa74708a06aff030540f81&amp;scene=21#wechat_redirect" data-linktype="2">Doheatmap常用参数及美化</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247524497&amp;idx=1&amp;sn=441e2795b5c51a571c35fc4d206abc7c&amp;chksm=ea1c6613dd6bef05fe76f37ebfac26e4e3d740b1c7576055c58dfc1c1e8172b356eabcdf8819&amp;scene=21#wechat_redirect" data-linktype="2">细胞类群marker基因识别及可视化</a></section></li></ul><p data-tool="mdnice编辑器">实际上， 上面的热图最大的问题并不是美化，是根本就没有搞清楚为什么有一些特异性高表达量亚群的基因少得可怜，甚至于没有。<strong>其实就是一个大家找到的单细胞各个亚群特异性高表达量基因并不在我们的做降维聚类分群的时候默认的2000个基因里面。</strong></p><pre data-tool="mdnice编辑器"><span></span><code>sce.all &lt;- NormalizeData(sce.all, <br>                           normalization.method = <span>"LogNormalize"</span>,<br>                           scale.factor = 1e4) <br>sce.all &lt;- FindVariableFeatures(sce.all) <span># 这个时候默认所2000基因</span><br>sce.all &lt;- ScaleData(sce.all) <span>## 所以后面的 ScaleData的矩阵就只有2000个基因</span><br><span># 默认我们的DoHeatmap针对的是上面的 ScaleData的矩阵，就只有2000个基因</span><br></code></pre><p data-tool="mdnice编辑器">需要针对这些基因进行单独的scale然后去可视化，一个很简单的补丁代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code>top_10 &lt;- unique(as.character(apply(marker_cosg$names,<span>2</span>,head,<span>10</span>))) <br>sce.Scale &lt;- ScaleData(subset(sce.all,downsample=<span>100</span>),features =  top_10  ) <br>ll =  as.list(as.data.frame(apply(marker_cosg$names,<span>2</span>,head,<span>10</span>)))<br>ll = ll[ord]<br>rmg=names(table(unlist(ll))[table(unlist(ll))&gt;<span>1</span>])<br>ll = lapply(ll, <span>function</span>(x) x[!x %<span>in</span>% rmg])<br>ll<br>DoHeatmap(sce.Scale,<br>          features = unlist(ll),<br>          group.by = <span>"celltype"</span>,<br>          raster = <span>F</span>,<br>          assay = <span>'RNA'</span>, label = <span>T</span>)+<br>  scale_fill_gradientn(colors = c(<span>"white"</span>,<span>"grey"</span>,<span>"firebrick3"</span>))<br><br>ggsave(filename = <span>"fig4-top10-marker_pheatmap.pdf"</span>,units = <span>"cm"</span>,<br>       width = <span>25</span>,height = <span>30</span>)<br></code></pre></section><p>可以很清晰的看到每个单细胞亚群的特异性的高表达量的top10的基因，如下所示：</p><p><img data-galleryid="" data-imgfileid="100044055" data-ratio="1.3472222222222223" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQcghokaGv6FIEXOv0hD5ucvK05hFAbxcgiaibWnia8tFENq6ynJ6aSxQhnwnalmNm7DWIOt6ogmh0bw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQcghokaGv6FIEXOv0hD5ucvK05hFAbxcgiaibWnia8tFENq6ynJ6aSxQhnwnalmNm7DWIOt6ogmh0bw/640?wx_fmt=png&amp;from=appmsg"></p><section><mp-common-redpacket data-pluginname="redpacketcover" data-w="286" data-ratio="1.5664335664335665" data-name="%E5%8D%95%E7%BB%86%E8%83%9E%E5%A4%A9%E5%9C%B0" data-receiveimg="https%3A%2F%2Fsnssvppicc.video.qq.com%2Fsvid%2Fp0VkoI6zvYwPSRRO6DSxQjdnvgdtvHLUnO2E-KnsO9uC7sUIw-2UGebJdiBBs9U35P-1u1AmscvNN6oKW0opzzg%3Fhy%3DSH" data-synthetic="0" data-coveruri="dl6Nj_WUMesp6MoF" data-bizuin="3256988141" data-orderid="14574069601623439424" data-openimg="https%3A%2F%2Fsnssvppicc.video.qq.com%2Fsvid%2Fp0VkoI6zvYwPSRRO6DSxQjUZMgOC1owm09zo3oZIedDKzjdmJ4ISOR09vVgzU_jOxP-1u1AmscvNN6oKW0opzzg%3Fhy%3DSH" data-is-purchase-order="" data-errortype=""></mp-common-redpacket></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/iMtWTdW-jyrzUJcgNRlULA",target="_blank" rel="noopener noreferrer">原文链接</a>
