---
title: "maftools（r包）绘制棒棒图等"
date: 2025-01-28T09:40:33Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
maftools（r包）绘制棒棒图等 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器"><span>maftools包，一个专门对MAF文件进行总结，分析和可视化的工具，工具于</span><span>2018年11月发表在Genome Research</span><span>上：</span></p><blockquote data-tool="mdnice编辑器"><p>Mayakonda A, Lin DC, Assenov Y, Plass C, Koeffler HP. 2018. Maftools: efficient and comprehensive analysis of somatic variants in cancer. Genome Research. PMID: 30341162</p></blockquote><p data-tool="mdnice编辑器">学习官网：<span>https://bioconductor.org/packages/devel/bioc/vignettes/maftools/inst/doc/maftools.html</span></p><p data-tool="mdnice编辑器">这个包主要分为分析与可视化两个模块：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100053886" data-ratio="0.5425925925925926" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mzt3fjm0VQ9LrgdJ2NauxM5b14yuiaXubqCyuGOPsLS6doVta5qYpJFS6g/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mzt3fjm0VQ9LrgdJ2NauxM5b14yuiaXubqCyuGOPsLS6doVta5qYpJFS6g/640?wx_fmt=png&amp;from=appmsg"></figure><h2 data-tool="mdnice编辑器"><span></span><span>0、安装</span></h2><p data-tool="mdnice编辑器">首先简单的安装一下：</p><pre data-tool="mdnice编辑器"><code><span>## 使用西湖大学的 Bioconductor镜像</span><br>options(BioC_mirror=<span>"https://mirrors.westlake.edu.cn/bioconductor"</span>)<br>options(<span>"repos"</span>=c(CRAN=<span>"https://mirrors.westlake.edu.cn/CRAN/"</span>))<br><span># 安装</span><br><span>if</span> (!require(<span>"BiocManager"</span>))<br>    install.packages(<span>"BiocManager"</span>)<br>BiocManager::install(<span>"maftools"</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>1、读取maf文件并预处理</span></h2><p data-tool="mdnice编辑器">输入数据要求：</p><ul data-tool="mdnice编辑器"><li><section>MAF文件 - 可以是gz压缩的。必需的。</section></li><li><section>与MAF中的每个样本/Tumor_Sample_Barcode相关联的临床数据，可选但推荐。</section></li><li><section>如果有的话，可选的拷贝数数据。可以是GISTIC输出，或者是一个包含样本名称、基因名称和拷贝数状态（扩增或缺失）的自定义表格。</section></li></ul><p data-tool="mdnice编辑器"><code>read.maf</code> 函数用于读取 MAF 文件，以多种方式对其进行总结，并将其存储为一个 MAF 对象。</p><pre data-tool="mdnice编辑器"><code>rm(list=ls())<br>library(maftools)<br><br><span># path to TCGA LAML MAF file</span><br>laml.maf = system.file(<span>'extdata'</span>, <span>'tcga_laml.maf.gz'</span>, package = <span>'maftools'</span>) <br>laml.maf<br><span>#"/usr/local/software/miniconda3/envs/R4.4/lib/R/library/maftools/extdata/tcga_laml.maf.gz"</span><br><br><span># clinical information containing survival information and histology. This is optional</span><br>laml.clin = system.file(<span>'extdata'</span>, <span>'tcga_laml_annot.tsv'</span>, package = <span>'maftools'</span>) <br>laml.clin<br><span>#/usr/local/software/miniconda3/envs/R4.4/lib/R/library/maftools/extdata/tcga_laml_annot.tsv</span><br><br><span># 读取</span><br>laml = read.maf(maf = laml.maf, clinicalData = laml.clin)<br><br><span># Typing laml shows basic summary of MAF file.</span><br>laml<br></code></pre><p data-tool="mdnice编辑器">现在是一个MAF对象，MAF对象包含主要的MAF文件、总结数据以及任何相关的样本注释。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100053883" data-ratio="0.5291607396870555" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mztukp5yc27Y3CJ2eH0iaS2wDJMjzrHzDkcn8KUmp3PZiaJJulRmXm3HicBQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="703" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mztukp5yc27Y3CJ2eH0iaS2wDJMjzrHzDkcn8KUmp3PZiaJJulRmXm3HicBQ/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">简单探索一下maf对象：</p><pre data-tool="mdnice编辑器"><code><span># Shows sample summry.</span><br>getSampleSummary(laml)<br><br><span># Shows gene summary.</span><br>getGeneSummary(laml)<br><br><span># shows clinical data associated with samples</span><br>getClinicalData(laml)<br><br><span># Shows all fields in MAF</span><br>getFields(laml)<br><br><span># Writes maf summary to an output file with basename laml.</span><br>write.mafSummary(maf = laml, basename = <span>'laml'</span>)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>2、可视化</span></h2><h3 data-tool="mdnice编辑器"><span></span><span></span><span>2.1 绘制 MAF summary</span><span></span></h3><p data-tool="mdnice编辑器">我们可以使用<code>plotmafSummary</code>来绘制MAF文件的总结，它以堆叠条形图显示每个样本中的变异数量，并以箱线图显示按<code>Variant_Classification</code>总结的变异类型。</p><pre data-tool="mdnice编辑器"><code><span>## plot</span><br>plotmafSummary(maf = laml, rmOutlier = TRUE, addStat = <span>'median'</span>, dashboard = TRUE, titvRaw = FALSE)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100053885" data-ratio="0.7824074074074074" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mzt8QtDoldkvUxOrtvnLoGXDUUbjTuBOy5fzs2wlHEakFVjMITYdjOlVg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mzt8QtDoldkvUxOrtvnLoGXDUUbjTuBOy5fzs2wlHEakFVjMITYdjOlVg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><code>mafbarplot</code>函数：绘制每个基因的突变情况，默认绘制top20个基因</p><pre data-tool="mdnice编辑器"><code>mafbarplot(maf = laml)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100053882" data-ratio="0.8289085545722714" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztaFmjTWkrLEDn8pvibhNRfnjUAnUwsNo912wTpcp5PyzLGUL9eQ3yhUA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1017" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztaFmjTWkrLEDn8pvibhNRfnjUAnUwsNo912wTpcp5PyzLGUL9eQ3yhUA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>2.2 Oncoplots</span><span></span></h3><p data-tool="mdnice编辑器">MAF文件的更好表示可以是癌基因图（oncoplots），也被称为瀑布图。</p><pre data-tool="mdnice编辑器"><code><span># oncoplot for top ten mutated genes.</span><br>oncoplot(maf = laml, top = 10)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100053884" data-ratio="0.8222222222222222" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mzt5Hl3pAib4EwPLY8DumhTibjL1yicpP0aFJtNQ7nhvObEfVgObExOF3ejQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mzt5Hl3pAib4EwPLY8DumhTibjL1yicpP0aFJtNQ7nhvObEfVgObExOF3ejQ/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>2.3 转换和颠换</span><span></span></h3><p data-tool="mdnice编辑器"><code>titv</code> 函数将单核苷酸多态性（SNPs）分类为转换（Transitions）和颠换（Transversions），并以多种方式返回总结表格的列表。总结数据也可以通过箱线图可视化，展示六种不同转换的整体分布，以及通过堆叠条形图展示每个样本中转换的比例。</p><pre data-tool="mdnice编辑器"><code>laml.titv = titv(maf = laml, plot = FALSE, useSyn = TRUE)<br><span># plot titv summary</span><br>plotTiTv(res = laml.titv)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100053887" data-ratio="0.8531337698783911" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztTicR6l4635cAzxF9eTTc8fJs2mYtNXcKw4Xz3XKo03fKWOSZy52iah0A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1069" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztTicR6l4635cAzxF9eTTc8fJs2mYtNXcKw4Xz3XKo03fKWOSZy52iah0A/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>2.4 氨基酸变化的棒棒糖图</span><span></span></h3><p data-tool="mdnice编辑器"><code>lollipopPlot</code> 函数要求我们在 MAF 文件中具有氨基酸变化的信息。然而，MAF 文件对于命名氨基酸变化的字段没有明确的指导方针，不同的研究对氨基酸变化有不同的字段（或列）名称。默认情况下，<code>lollipopPlot</code> 查找列 <code>AAChange</code>，如果在 MAF 文件中找不到该列，它会打印所有可用字段并显示警告信息。在下面的例子中，MAF 文件在字段/列名 <code>Protein_Change</code> 下包含氨基酸变化。我们将使用参数 <code>AACol</code> 手动指定这一点。</p><p data-tool="mdnice编辑器">默认情况下，<code>lollipopPlot</code> 使用基因的最长异构体。</p><pre data-tool="mdnice编辑器"><code><span># lollipop plot for DNMT3A, which is one of the most frequent mutated gene in Leukemia.</span><br>lollipopPlot(<br>  maf = laml,<br>  gene = <span>'DNMT3A'</span>,<br>  AACol = <span>'Protein_Change'</span>,<br>  showMutationRate = TRUE,<br>  labelPos = 882<br>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100053888" data-ratio="0.8342592592592593" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztC0iblaw6yOWPcK16ytvU8K8go7rftjmQgn4dw7MGufDx19V7kTC8Z4w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztC0iblaw6yOWPcK16ytvU8K8go7rftjmQgn4dw7MGufDx19V7kTC8Z4w/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>2.5 Rainfall plots</span><span></span></h3><p data-tool="mdnice编辑器">癌症基因组，尤其是实体瘤，其特征是在基因组的特定区域存在局部高突变。这种超突变的基因组区域可以通过在基因组线性尺度上绘制变异间距离来可视化。这些图通常被称为降雨图，我们可以使用 <code>rainfallPlot</code> 来绘制这样的图。如果将 <code>detectChangePoints</code> 设置为 <code>TRUE</code>，降雨图还会突出显示潜在的变异间距离变化所在的区域。</p><pre data-tool="mdnice编辑器"><code>brca &lt;- system.file(<span>"extdata"</span>, <span>"brca.maf.gz"</span>, package = <span>"maftools"</span>)<br>brca<br>brca = read.maf(maf = brca, verbose = FALSE)<br>rainfallPlot(maf = brca, detectChangePoints = TRUE, pointSize = 0.4)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100053890" data-ratio="0.687037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mzt6NicrwSs707OqPiaibmPbT0heGo9fCNH0NSuMic9wCxUp8QvLHsaU6Ysvg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1Mzt6NicrwSs707OqPiaibmPbT0heGo9fCNH0NSuMic9wCxUp8QvLHsaU6Ysvg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>2.6 将突变负荷与TCGA队列进行比较</span><span></span></h3><p data-tool="mdnice编辑器"><code>tcgaCompare</code> 使用来自TCGA MC3的突变负荷数据，与33个TCGA队列的突变负担进行比较。生成的图表类似于Alexandrov等人描述的图表。</p><pre data-tool="mdnice编辑器"><code>laml.mutload = tcgaCompare(maf = laml, cohortName = <span>'Example-LAML'</span>, logscale = TRUE, capture_size = 50)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100053891" data-ratio="0.6194444444444445" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztOKzxTvjDW1vfTBCBXwjw3rVibUaicVlx1WcyTiauuF5xBACPh7BLVjZTA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztOKzxTvjDW1vfTBCBXwjw3rVibUaicVlx1WcyTiauuF5xBACPh7BLVjZTA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span><span></span><span>2.7 绘制VAF</span><span></span></h3><p data-tool="mdnice编辑器">这个函数以箱线图的形式绘制变异等位基因频率，这有助于快速估计突变基因的克隆状态（假设样本纯净，克隆基因的平均等位基因频率通常在~50%左右）。</p><pre data-tool="mdnice编辑器"><code>plotVaf(maf = laml, vafCol = <span>'i_TumorVAF_WU'</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100053889" data-ratio="0.8373831775700935" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztYcGsF7YsyAI1MjBQZAI9ExKXZBEWiaxAFom1CxmEusndcHm4tQ7hoyg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="535" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwO9CdAvOhOLUR5BVJu1MztYcGsF7YsyAI1MjBQZAI9ExKXZBEWiaxAFom1CxmEusndcHm4tQ7hoyg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">以上是关于maf文件的处理与可视化，后面还可以处理拷贝数等数据，见官网学习：https://bioconductor.org/packages/devel/bioc/vignettes/maftools/inst/doc/maftools.html</p><h3 data-tool="mdnice编辑器"><span></span><span></span><span>友情宣传：</span><span></span></h3><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzI1Njk4ODE0MQ==&amp;mid=2247527230&amp;idx=1&amp;sn=7156afcd5ab734c7d391b9048695747a&amp;scene=21#wechat_redirect" data-linktype="2">生信入门&amp;数据挖掘线上直播课2025年1月班</a></p><p data-tool="mdnice编辑器"><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" data-linktype="2">时隔5年，我们的生信技能树VIP学徒继续招生啦</a></p><p data-tool="mdnice编辑器"><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247535760&amp;idx=2&amp;sn=1e02a2e982a046ecf6389231e6768d5b&amp;scene=21#wechat_redirect" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/1zStWvVYNKvkCBRj2N2k-A",target="_blank" rel="noopener noreferrer">原文链接</a>
