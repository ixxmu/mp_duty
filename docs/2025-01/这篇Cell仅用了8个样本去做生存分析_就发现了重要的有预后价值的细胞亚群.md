---
title: "这篇Cell仅用了8个样本去做生存分析，就发现了重要的有预后价值的细胞亚群"
date: 2025-01-08T06:48:42Z
draft: ["false"]
tags: [
  "fetched",
  "生信资料共享"
]
categories: ["Acdemic"]
---
这篇Cell仅用了8个样本去做生存分析，就发现了重要的有预后价值的细胞亚群 by 生信资料共享
------
<div><section nodeleaf=""><img data-imgfileid="100000160" data-ratio="1.749074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1nSCwAMbcPvlKfEPiaQnjJsbyzwriciaPgKrNqtrDqJlXUsx9l1GjCwTvA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1nSCwAMbcPvlKfEPiaQnjJsbyzwriciaPgKrNqtrDqJlXUsx9l1GjCwTvA/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf=""><span textstyle="">一直觉得自己的样本量少，做出来的结果会不会不可靠，看到这篇Cell才知道，就算是8个样本，只要是有意义，样本量再少也丝毫不影响重要东西的发现。（主要发现了一个巨噬细胞亚群，然后分局这个亚群去做生存分析）</span></span></section><section nodeleaf=""><img data-imgfileid="100000153" data-ratio="0.4" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1WksB1iavWwQPuCNZo1EsYrjp6AFnkALR0RnCnLE0YJlvgkfcFz8bzHw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1WksB1iavWwQPuCNZo1EsYrjp6AFnkALR0RnCnLE0YJlvgkfcFz8bzHw/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1Bl0IRAxUL8lMKZuSWzVvUQVBR1vFtovJ6j1TMzvtuxujalibrweydXA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.825925925925926" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100000152" src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1Bl0IRAxUL8lMKZuSWzVvUQVBR1vFtovJ6j1TMzvtuxujalibrweydXA/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf=""><span textstyle="">不过这篇文章后面还是做了一个验证队列，扩大了样本量</span></span></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1lxsauZK5jAU8rGl4aWXaPibiapossiaN80l70NFhH2aS5bRxkxGgwHcGA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.42592592592592593" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100000154" src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1lxsauZK5jAU8rGl4aWXaPibiapossiaN80l70NFhH2aS5bRxkxGgwHcGA/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf=""><span textstyle="">下面是主要的研究内容，开发了一个很有用的单细胞蛋白质活性分析的包VIPER（用的是单细胞转录组的数据去做的）</span></span></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum19D2lib7oiahH5KA9YyPzdy6Mr86eH1LRvfcnXjDL6kUurNKdUkU40nEQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.25925925925925924" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100000156" src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum19D2lib7oiahH5KA9YyPzdy6Mr86eH1LRvfcnXjDL6kUurNKdUkU40nEQ/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf=""><span textstyle="">记录一个图像数据的工具包</span></span><span><span leaf=""><span textstyle="">phenoptr，有很多功能可以用</span></span></span></section><section nodeleaf=""><img data-imgfileid="100000157" data-ratio="0.3888888888888889" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1su16Rq7z9tN6ZAs6P38aOWF4ia120G14V2BkWoG9N8Ow5Z31zqrL0UQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZdyCZLtNqCdGnsE9Lo8sum1su16Rq7z9tN6ZAs6P38aOWF4ia120G14V2BkWoG9N8Ow5Z31zqrL0UQ/640?wx_fmt=png&amp;from=appmsg"></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="go"><code><span leaf=""><span># 加载 phenoptr 库，用于细胞分割数据分析等相关操作</span></span></code><code><span leaf=""><span>library(phenoptr)</span></span></code><code><span leaf=""><span># 创建一个数据框 ihc_data，包含患者信息，包括患者编号、肿瘤分期和肿瘤分级</span></span></code><code><span leaf=""><span>ihc_data=data.frame(patient=c(</span><span>"PatientA"</span><span>,</span><span>"PatientB"</span><span>,</span><span>"PatientC"</span><span>,</span><span>"Patient1"</span><span>,</span><span>"Patient2"</span><span>,</span><span>"Patient3"</span><span>,</span><span>"Patient4"</span><span>,</span><span>"Patient5"</span><span>,</span><span>"Patient6"</span><span>,</span><span>"Patient7"</span><span>,</span><span>"Patient8"</span><span>),</span></span></code><code><span leaf=""><span>                    stage=c(</span><span>"pT3a"</span><span>,</span><span>"pT1b"</span><span>,</span><span>"pT1b"</span><span>,</span><span>"pT1b"</span><span>,</span><span>"pT3a"</span><span>,</span><span>"pT3a"</span><span>,</span><span>"pT1b"</span><span>,</span><span>"pT3a"</span><span>,</span><span>"pT1b"</span><span>,</span><span>"pT3a"</span><span>,</span><span>"pT1b"</span><span>),grade=c(</span><span>3</span><span>,</span><span>2</span><span>,</span><span>2</span><span>,</span><span>2</span><span>,</span><span>2</span><span>,</span><span>1</span><span>,</span><span>1</span><span>,</span><span>4</span><span>,</span><span>2</span><span>,</span><span>3</span><span>,</span><span>2</span><span>))</span></span></code><code><span leaf=""><span># 初始化三个空向量，用于存储 C1Q、TREM2、APOE 在巨噬细胞中的优势比</span></span></code><code><span leaf=""><span>C1Q.macrophage.oddsratio=c()</span></span></code><code><span leaf=""><span>TREM2.macrophage.oddsratio=c()</span></span></code><code><span leaf=""><span>APOE.macrophage.oddsratio=c()</span></span></code><code><span leaf=""><span># 定义肿瘤组织中不同细胞类型的频率向量，包括 CA9+、CD3+等多种细胞类型以及其他类型</span></span></code><code><span leaf=""><span>tumor_freqs=c(</span><span>"CA9+"</span><span>,</span><span>"CD3+"</span><span>,</span><span>"CD68/CD163+"</span><span>,</span><span>"C1Q+CD68/CD163+"</span><span>,</span><span>"TREM2+CD68/CD163+"</span><span>,</span><span>"APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+CD68/CD163+"</span><span>,</span><span>"C1Q+APOE+CD68/CD163+"</span><span>,</span><span>"TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+"</span><span>,</span><span>"TREM2+"</span><span>,</span><span>"APOE+"</span><span>,</span><span>"Other"</span><span>)</span></span></code><code><span leaf=""><span># 定义基质组织中不同细胞类型的频率向量，与肿瘤组织中的定义相同</span></span></code><code><span leaf=""><span>stroma_freqs=c(</span><span>"CA9+"</span><span>,</span><span>"CD3+"</span><span>,</span><span>"CD68/CD163+"</span><span>,</span><span>"C1Q+CD68/CD163+"</span><span>,</span><span>"TREM2+CD68/CD163+"</span><span>,</span><span>"APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+CD68/CD163+"</span><span>,</span><span>"C1Q+APOE+CD68/CD163+"</span><span>,</span><span>"TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+"</span><span>,</span><span>"TREM2+"</span><span>,</span><span>"APOE+"</span><span>,</span><span>"Other"</span><span>)</span></span></code><code><span leaf=""><span># 定义正常组织中不同细胞类型的频率向量，与肿瘤组织中的定义相同，并添加一行 NaN 值</span></span></code><code><span leaf=""><span>normal_freqs=c(</span><span>"CA9+"</span><span>,</span><span>"CD3+"</span><span>,</span><span>"CD68/CD163+"</span><span>,</span><span>"C1Q+CD68/CD163+"</span><span>,</span><span>"TREM2+CD68/CD163+"</span><span>,</span><span>"APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+CD68/CD163+"</span><span>,</span><span>"C1Q+APOE+CD68/CD163+"</span><span>,</span><span>"TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+"</span><span>,</span><span>"TREM2+"</span><span>,</span><span>"APOE+"</span><span>,</span><span>"Other"</span><span>)</span></span></code><code><span leaf=""><span>normal_freqs=rbind(normal_freqs,rep(NaN,length(normal_freqs)))</span></span></code><code><span leaf=""><span># 以下是对患者 A 的数据分析</span></span></code><code><span leaf=""><span># 患者 A 的信息：stage </span><span>3</span><span>，grade </span><span>3</span></span></code><code><span leaf=""><span># 数据文件路径：IHC_data_allsamples/Batch_Sp18_10879</span></span></code><code><span leaf=""><span># 以下是该患者的一些细胞标记物在基质和肿瘤组织中的表达水平数据</span></span></code><code><span leaf=""><span># APOE Stroma </span><span>2.72</span><span> Tumor </span><span>2.02</span></span></code><code><span leaf=""><span># C1Q Stroma </span><span>3.02</span><span> Tumor </span><span>2.5</span></span></code><code><span leaf=""><span># CA9 Stroma </span><span>4.12</span><span> Tumor</span></span></code><code><span leaf=""><span># CD3 Stroma </span><span>0.28</span><span> Tumor</span></span></code><code><span leaf=""><span># CD68+CD163+ Stroma </span><span>3.2</span><span> Tumor </span><span>2.2</span></span></code><code><span leaf=""><span># TREM2 Stroma </span><span>0.42</span><span> Tumor </span><span>0.28</span></span></code><code><span leaf=""><span># 读取患者 A 的细胞分割数据文件，将多个文件的数据合并到 csd 数据框中</span></span></code><code><span leaf=""><span>files=list_cell_seg_files(</span><span>"IHC_data_allsamples/Batch_Sp18_10879"</span><span>)</span></span></code><code><span leaf=""><span>csd=read_cell_seg_data(files[</span><span>1</span><span>])</span></span></code><code><span leaf=""><span>for</span><span>(i in </span><span>2</span><span>:length(files)){</span></span></code><code><span leaf=""><span>  t=read_cell_seg_data(files[i])</span></span></code><code><span leaf=""><span>  csd=rbind(csd,t)</span></span></code><code><span leaf=""><span>}</span></span></code><code><span leaf=""><span># 计算 C1Q 在巨噬细胞中的优势比，并将结果添加到 C1Q.macrophage.oddsratio 向量中</span></span></code><code><span leaf=""><span># 首先生成一个列联表，比较 C1Q 表达水平和巨噬细胞标记物的关系</span></span></code><code><span leaf=""><span>write.table(table(csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>,csd$</span><span>`Entire Cell C1q (Opal 520) Mean`</span><span>&gt;</span><span>2.5</span><span>),sep=</span><span>"\t"</span><span>,quote=F)</span></span></code><code><span leaf=""><span># 使用 fisher 精确检验计算优势比，并将结果添加到向量中</span></span></code><code><span leaf=""><span>C1Q.macrophage.oddsratio=c(C1Q.macrophage.oddsratio,fisher.test(table(csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>,csd$</span><span>`Entire Cell C1q (Opal 520) Mean`</span><span>&gt;</span><span>2.5</span><span>))$estimate)</span></span></code><code><span leaf=""><span># 计算 TREM2 在巨噬细胞中的优势比，并将结果添加到 TREM2.macrophage.oddsratio 向量中</span></span></code><code><span leaf=""><span>write.table(table(csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>,csd$</span><span>`Entire Cell TREM2 (Opal 650) Mean`</span><span>&gt;</span><span>0.28</span><span>),sep=</span><span>"\t"</span><span>,quote=F)</span></span></code><code><span leaf=""><span>TREM2.macrophage.oddsratio=c(TREM2.macrophage.oddsratio,fisher.test(table(csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>,csd$</span><span>`Entire Cell TREM2 (Opal 650) Mean`</span><span>&gt;</span><span>0.28</span><span>))$estimate)</span></span></code><code><span leaf=""><span># 计算 APOE 在巨噬细胞中的优势比，并将结果添加到 APOE.macrophage.oddsratio 向量中</span></span></code><code><span leaf=""><span>write.table(table(csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>,csd$</span><span>`Entire Cell ApoE (Opal 620) Mean`</span><span>&gt;</span><span>2.02</span><span>),sep=</span><span>"\t"</span><span>,quote=F)</span></span></code><code><span leaf=""><span>APOE.macrophage.oddsratio=c(APOE.macrophage.oddsratio,fisher.test(table(csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>,csd$</span><span>`Entire Cell ApoE (Opal 620) Mean`</span><span>&gt;</span><span>2.02</span><span>))$estimate)</span></span></code><code><span leaf=""><span># 根据细胞标记物的表达水平对细胞进行分类，并将分类结果存储在 csd$celltype 中</span></span></code><code><span leaf=""><span>csd$celltype=</span><span>"Other"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell CA9 (Opal 540) Mean`</span><span>&gt;</span><span>4.12</span><span>)]=</span><span>"CA9+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell CD3 (Opal 690)  Mean`</span><span>&gt;</span><span>0.28</span><span>)]=</span><span>"CD3+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>)]=</span><span>"CD68/CD163+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell C1q (Opal 520) Mean`</span><span>&gt;</span><span>2.5</span><span>)]=</span><span>"C1Q+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell TREM2 (Opal 650) Mean`</span><span>&gt;</span><span>0.28</span><span>)]=</span><span>"TREM2+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell ApoE (Opal 620) Mean`</span><span>&gt;</span><span>2.02</span><span>)]=</span><span>"APOE+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell C1q (Opal 520) Mean`</span><span>&gt;</span><span>2.5</span><span> &amp; csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>)]=</span><span>"C1Q+CD68/CD163+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell TREM2 (Opal 650) Mean`</span><span>&gt;</span><span>0.28</span><span> &amp; csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>)]=</span><span>"TREM2+CD68/CD163+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell ApoE (Opal 620) Mean`</span><span>&gt;</span><span>2.02</span><span> &amp; csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>)]=</span><span>"APOE+CD68/CD163+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell C1q (Opal 520) Mean`</span><span>&gt;</span><span>2.5</span><span> &amp; csd$</span><span>`Entire Cell TREM2 (Opal 650) Mean`</span><span>&gt;</span><span>0.28</span><span> &amp; csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>)]=</span><span>"C1Q+TREM2+CD68/CD163+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell C1q (Opal 520) Mean`</span><span>&gt;</span><span>2.5</span><span> &amp; csd$</span><span>`Entire Cell ApoE (Opal 620) Mean`</span><span>&gt;</span><span>2.02</span><span> &amp; csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>)]=</span><span>"C1Q+APOE+CD68/CD163+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell TREM2 (Opal 650) Mean`</span><span>&gt;</span><span>0.28</span><span> &amp; csd$</span><span>`Entire Cell ApoE (Opal 620) Mean`</span><span>&gt;</span><span>2.02</span><span> &amp; csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>)]=</span><span>"TREM2+APOE+CD68/CD163+"</span></span></code><code><span leaf=""><span>csd$celltype[which(csd$</span><span>`Entire Cell C1q (Opal 520) Mean`</span><span>&gt;</span><span>2.5</span><span> &amp; csd$</span><span>`Entire Cell TREM2 (Opal 650) Mean`</span><span>&gt;</span><span>0.28</span><span> &amp; csd$</span><span>`EntirCell ApoE (Opal 620) Mean`</span><span>&gt;</span><span>2.02</span><span> &amp; csd$</span><span>`Entire Cell Macs (Opal 570) Mean`</span><span>&gt;</span><span>2.2</span><span>)]=</span><span>"C1Q+TREM2+APOE+CD68/CD163+"</span></span></code><code><span leaf=""><span># 将细胞类型转换为因子类型，并指定因子水平</span></span></code><code><span leaf=""><span>csd$celltype=factor(csd$celltype,levels=c(</span><span>"CA9+"</span><span>,</span><span>"CD3+"</span><span>,</span><span>"CD68/CD163+"</span><span>,</span><span>"C1Q+CD68/CD163+"</span><span>,</span><span>"TREM2+CD68/CD163+"</span><span>,</span><span>"APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+CD68/CD163+"</span><span>,</span><span>"C1Q+APOE+CD68/CD163+"</span><span>,</span><span>"TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+"</span><span>,</span><span>"TREM2+"</span><span>,</span><span>"APOE+"</span><span>,</span><span>"Other"</span><span>))</span></span></code><code><span leaf=""><span># 生成细胞类型和组织类别交叉表，并将结果输出到文件</span></span></code><code><span leaf=""><span>table(csd$celltype,csd$</span><span>`Tissue Category`</span><span>)</span></span></code><code><span leaf=""><span>write.table(table(csd$celltype,csd$</span><span>`Tissue Category`</span><span>),sep=</span><span>"\t"</span><span>,quote=F)</span></span></code><code><span leaf=""><span># 计算细胞类型在不同组织类别中的频率，并将结果转换为数据框</span></span></code><code><span leaf=""><span>x=as.matrix(table(csd$celltype,csd$</span><span>`Tissue Category`</span><span>))</span></span></code><code><span leaf=""><span>x=as.data.frame(apply(x,</span><span>2</span><span>,function(y){y/sum(y)}))</span></span></code><code><span leaf=""><span># 将计算得到的频率结果输出到文件</span></span></code><code><span leaf=""><span>write.table(x,sep=</span><span>"\t"</span><span>,quote=F)</span></span></code><code><span leaf=""><span># 将基质组织中的频率结果添加到 stroma_freqs 中</span></span></code><code><span leaf=""><span>stroma_freqs=rbind(stroma_freqs,x$Stroma)</span></span></code><code><span leaf=""><span># 将肿瘤组织中的频率结果添加到 tumor_freqs 中</span></span></code><code><span leaf=""><span>tumor_freqs=rbind(tumor_freqs,x$Tumor)</span></span></code><code><span leaf=""><span># 如果有正常组织的数据，则将其添加到 normal_freqs 中，否则添加一行 NaN 值</span></span></code><code><span leaf=""><span>if</span><span>(ncol(x)==</span><span>3</span><span>){normal_freqs=rbind(normal_freqs,x$</span><span>`Adjacent normal`</span><span>)} </span><span>else</span><span>{normal_freqs=rbind(normal_freqs,rep(NaN,ncol(normal_freqs)))}</span></span></code><code><span leaf=""><span>####</span></span></code><code><span leaf=""><span>#### 以下部分计算 APOE+巨噬细胞与 APOE-巨噬细胞到肿瘤细胞的平均距离，并进行统计检验</span></span></code><code><span leaf=""><span>####</span></span></code><code><span leaf=""><span># 将细胞类型赋值给 csd$Phenotype</span></span></code><code><span leaf=""><span>csd$Phenotype=csd$celltype</span></span></code><code><span leaf=""><span># 计算每个样本中细胞到 CA9+细胞的最近距离，存储在 distances 列表中</span></span></code><code><span leaf=""><span># 对于每个样本，调用 find_nearest_distance 函数计算距离</span></span></code><code><span leaf=""><span>distances=lapply(unique(csd$</span><span>`Sample Name`</span><span>),function(i){find_nearest_distance(csd[which(csd$</span><span>`Sample Name`</span><span>==i),],phenotypes=</span><span>"CA9+"</span><span>)})</span></span></code><code><span leaf=""><span>d=distances[[</span><span>1</span><span>]]</span></span></code><code><span leaf=""><span>for</span><span>(i in </span><span>2</span><span>:length(distances)){</span></span></code><code><span leaf=""><span>  d=rbind(d,distances[[i]])</span></span></code><code><span leaf=""><span>}</span></span></code><code><span leaf=""><span># 将距离结果添加到 csd 数据框中</span></span></code><code><span leaf=""><span>csd=cbind(csd,d)</span></span></code><code><span leaf=""><span># 将细胞类型转换为字符型，存储在 csd$MacrophageType 中</span></span></code><code><span leaf=""><span>csd$MacrophageType=as.character(csd$Phenotype)</span></span></code><code><span leaf=""><span># 筛选出特定类型的巨噬细胞数据</span></span></code><code><span leaf=""><span>csd=csd[which(csd$MacrophageType %in% c(</span><span>"APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"C1Q+TREM2+CD68/CD163+"</span><span>,</span><span>"CD68/CD163+"</span><span>,</span><span>"TREM2+APOE+CD68/CD163+"</span><span>,</span><span>"TREM2+CD68/CD163+"</span><span>)),]</span></span></code><code><span leaf=""><span># 对巨噬细胞类型进行重新编码</span></span></code><code><span leaf=""><span>csd$MacrophageType[which(csd$MacrophageType %in% c(</span><span>"CD68/CD163+"</span><span>))]=</span><span>"CD68/CD163+"</span></span></code><code><span leaf=""><span>csd$MacrophageType[which(csd$MacrophageType %in% c(</span><span>"C1Q+TREM2+CD68/CD163+"</span><span>))]=</span><span>"CD68/CD163+APOE+"</span></span></code><code><span leaf=""><span># 筛选出 CD68/CD163+和 CD68/CD163+APOE+两种巨噬细胞类型的数据</span></span></code><code><span leaf=""><span>csd=csd[which(csd$MacrophageType %in% c(</span><span>"CD68/CD163+"</span><span>,</span><span>"CD68/CD163+APOE+"</span><span>)),]</span></span></code><code><span leaf=""><span># 绘制 APOE+巨噬细胞与 APOE-巨噬细胞到肿瘤细胞距离的密度图</span></span></code><code><span leaf=""><span>ggplot(csd, aes(</span><span>`Distance to CA9+`</span><span>, color=MacrophageType)) +</span></span></code><code><span leaf=""><span>  geom_density(size=</span><span>1</span><span>)</span></span></code><code><span leaf=""><span># 绘制 APOE+巨噬细胞与 APOE-巨噬细胞到肿瘤细胞距离的箱线图</span></span></code><code><span leaf=""><span>ggplot(csd, aes(MacrophageType,</span><span>`Distance to CA9+`</span><span>,color=MacrophageType)) +</span></span></code><code><span leaf=""><span>  geom_boxplot()</span></span></code><code><span leaf=""><span># 计算 CD68/CD163+巨噬细胞到肿瘤细胞的平均距离（排除缺失值）</span></span></code><code><span leaf=""><span>mean(na.exclude(csd$</span><span>`Distance to CA9+`</span><span>[which(csd$MacrophageType==</span><span>"CD68/CD163+"</span><span>)]))</span></span></code><code><span leaf=""><span># 计算 CD68/CD163+APOE+巨噬细胞到肿瘤细胞的平均距离（排除缺失值）</span></span></code><code><span leaf=""><span>mean(na.exclude(csd$</span><span>`Distance to CA9+`</span><span>[which(csd$MacrophageType==</span><span>"CD68/CD163+APOE+"</span><span>)]))</span></span></code><code><span leaf=""><span># 进行 t 检验，比较 CD68/CD163+巨噬细胞和 CD68/CD163+APOE+巨噬细胞到肿瘤细胞的距离差异</span></span></code><code><span leaf=""><span>t.test(csd$</span><span>`Distance to CA9+`</span><span>[which(csd$MacrophageType==</span><span>"CD68/CD163+"</span><span>)],csd$</span><span>`Distance to CA9+`</span><span>[which(csd$MacrophageType==</span><span>"CD68/CD163+APOE+"</span><span>)])</span></span></code><code><span leaf=""><span># 将当前患者的距离数据存储到 csd_distance_to_tumor 中</span></span></code><code><span leaf=""><span>csd_distance_to_tumor=csd</span></span></code><code><span leaf=""><span>####</span></span></code></pre></section><section><span><span leaf=""><span textstyle=""> Single-cell protein activity analysis identifies recurrence-associated renal tumor macrophages. Cell. 2021 May</span></span></span></section><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="生信资料共享" data-from="0" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/2bvYMoCQeZcDJiaFUU498wO4fW4vYADDWt9u9mfiakXeTS861ShkrLChr2M6B8eiaDIicyIbw7tjgjOz9npdrGAZuA/0?wx_fmt=png" data-signature="北京大学在读博士生，日常分享生信资料，主要关注领域：单细胞和空间测序、多组学分析、宏基因组、病理组学、影像组学等生物信息学、机器学习和深度学习内容🌬欢迎大家交流学习" data-id="Mzk0MjcyMDk3Mg==" data-is_biz_ban="0" data-service_type="1"></mp-common-profile></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/PjtseyzDU0xZc7Rg3Bj9DQ",target="_blank" rel="noopener noreferrer">原文链接</a>
