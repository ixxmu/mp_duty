---
title: "普通转录组上游定量分析服务（仅需800每个项目）"
date: 2025-01-03T03:06:05Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
普通转录组上游定量分析服务（仅需800每个项目） by 生信技能树
------
<div><section powered-by="xiumi.us"><section><section><section><img data-ratio="0.91875" data-type="jpeg" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wztsZWIld4dbSAHficyAXWgkicrhjjacU8Ey0UKM56qbSnedHStMqWUfTPQxbqxNTVZy1g59nNW3BSg/640?wx_fmt=jpeg" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wztsZWIld4dbSAHficyAXWgkicrhjjacU8Ey0UKM56qbSnedHStMqWUfTPQxbqxNTVZy1g59nNW3BSg/640?wx_fmt=jpeg"></section></section><span title="" opera-tn-ra-cell="_$.pages:0.layers:0.comps:0.title1"><p><br></p></span></section><section><section powered-by="xiumi.us"><p>网罗了一大波生物信息学数据分析方面的工程师，是时候官宣咱们的<strong>业务列表</strong>：<br><span></span></p></section></section></section><section powered-by="xiumi.us"><section data-tools="新媒体排版" data-id="763890" data-style-type="undefined"><section placeholder="请输入标题">现在介绍只需要800元的转录组上游定量流程</section></section></section><h3 data-tool="mdnice编辑器">转录组产品线还是蛮丰富的：</h3><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247499830&amp;idx=1&amp;sn=365f26cf3454031d59f35856c852f6bb&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">明码标价之转录组常规测序服务（仅需799每个样品）</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247499208&amp;idx=1&amp;sn=5ef47d5e0d2ebfe61e481e02963bdcef&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">明码标价之普通转录组上游分析</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247500005&amp;idx=1&amp;sn=1ed83a9a3c6f6113b159ec1185228e86&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">明码标价之转录组下游分析仅需800元</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247499308&amp;idx=1&amp;sn=ca92b6fc47b7deb6928cddade0aa0436&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">明码标价之转录组测序数据的可变剪切</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247500795&amp;idx=1&amp;sn=78e855193e70080bf755180353351f0f&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">明码标价之RNA-Seq数据的内含子保留分析</a></section></li><li><p><span>扫描下面二维码即可添加微信咨询！</span></p></li><li><section>（添加好友务必备注 高校或者工作单位+姓名，方便后续认识）</section></li><li><p><img data-ratio="1.1700680272108843" data-s="300,640" data-type="png" data-w="294" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxvmNvIclfRGEpWuxOMxdq2rJV1jmplnEuXDDDPfEsMLbHvLCWVX4uFobR9uj6JQfxMysCQyyK9wg/640?wx_fmt=png" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxvmNvIclfRGEpWuxOMxdq2rJV1jmplnEuXDDDPfEsMLbHvLCWVX4uFobR9uj6JQfxMysCQyyK9wg/640?wx_fmt=png"></p></li></ul><p>如果是6~16个转录组样品的测序的fastq数据，需要比对到参考基因组并且定量，我们仅仅是收取一个计算机资源的费用，800元人民币即可，并且提供全套代码。不管是公共数据集还是你自己的实验测序数据，一样的费用！我们会代替你跑如下所示的流程：<br></p><h3 data-tool="mdnice编辑器">安装自己的conda</h3><p data-tool="mdnice编辑器">每个用户独立操作，安装方法代码如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span># 首先下载文件，20M/S的话需要几秒钟即可</span><br>wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh<br><span># 接下来使用bash命令来运行我们下载的文件，记得是一路yes下去</span><br>bash Miniconda3-latest-Linux-x86_64.sh <br><span>#  安装成功后需要更新系统环境变量文件</span><br><span>source</span> ~/.bashrc<br></code></pre><p data-tool="mdnice编辑器">安装好conda后需要设置镜像。</p><pre data-tool="mdnice编辑器"><span></span><code>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free<br>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge<br>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda<br>conda config --<span>set</span> show_channel_urls yes <br></code></pre><p data-tool="mdnice编辑器">有了conda我们的服务器才真正可以做生物信息学数据处理。</p><h3 data-tool="mdnice编辑器">conda下载aspera</h3><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span>RNA-seq小环境</span><br>conda activate rna<br><span>#</span><span>安装aspera</span><br>conda install -y -c hcc aspera-cli<br><br>which ascp <br><span>#</span><span><span># 一定要搞清楚你的软件被conda安装在哪</span></span><br>ls -lh ~/miniconda3/envs/download/etc/asperaweb_id_dsa.openssh<br></code></pre><h3 data-tool="mdnice编辑器">查找GSE130437的SRA文件地址</h3><p data-tool="mdnice编辑器">有一个神器：https://sra-explorer.info/</p><pre data-tool="mdnice编辑器"><span></span><code>搜索GSE130437，无结果<br>到NCBI查找 GSE130437 ，得到序号   PRJNA540259 <br>重新使用 序号  PRJNA540259 进行搜索  https://sra-explorer.info/ <br></code></pre><h3 data-tool="mdnice编辑器">aspera下载SRR文件</h3><p data-tool="mdnice编辑器">项目地址是：https://www.ebi.ac.uk/ena/browser/view/PRJNA540259</p><p data-tool="mdnice编辑器">有时候这个数据库会死机，等待几天。</p><p data-tool="mdnice编辑器">脚本如下：</p><pre data-tool="mdnice编辑器"><span></span><code><span># conda activate download </span><br><span># 自己搭建好 download 这个 conda 的小环境哦。</span><br>mkdir -p ~/public_data/immune_PRJEB33490<br><span>cd</span>  ~/public_data/immune_PRJEB33490<br><span># 下面的命令内容构建成为脚本：step1-aspera.sh</span><br>cat fq.txt |<span>while</span> <span>read</span> id<br><span>do</span><br>ascp -QT -l 300m -P33001  \<br>-i ~/miniconda3/envs/download/etc/asperaweb_id_dsa.openssh   \<br>era-fasp@<span>$id</span>  .<br><span>done</span><br><span># nohup bash step1-aspera.sh 1&gt;step1-aspera.log 2&gt;&amp;1 &amp;</span><br></code></pre><p data-tool="mdnice编辑器">这个脚本会根据你在EBI里面搜索到的 fq.txt 路径文件，来批量下载fastq测序数据文件。</p><p data-tool="mdnice编辑器">得到raw fq文件如下:</p><pre data-tool="mdnice编辑器"><span></span><code>1.9G 2月   2 22:40 rawdata/SRR8984523.fastq.gz<br>1.6G 2月   2 22:46 rawdata/SRR8984524.fastq.gz<br>1.8G 2月   2 22:31 rawdata/SRR8984525.fastq.gz<br>1.8G 2月   2 22:33 rawdata/SRR8984526.fastq.gz<br>1.8G 2月   2 22:52 rawdata/SRR8984527.fastq.gz<br>2.0G 2月   2 22:37 rawdata/SRR8984528.fastq.gz<br>2.1G 2月   4 09:38 rawdata/SRR8984529.fastq.gz<br>2.1G 2月   2 23:01 rawdata/SRR8984530.fastq.gz<br>2.0G 2月   2 23:04 rawdata/SRR8984531.fastq.gz<br>1.9G 2月   2 22:55 rawdata/SRR8984532.fastq.gz<br>1.9G 2月   2 22:54 rawdata/SRR8984533.fastq.gz<br>1.9G 2月   3 00:08 rawdata/SRR8984534.fastq.gz<br></code></pre><h3 data-tool="mdnice编辑器">Trim_galore去接头</h3><p data-tool="mdnice编辑器">因为是单端测序数据，所以代码是:</p><pre data-tool="mdnice编辑器"><span></span><code><span>source</span> activate rna<br>bin_trim_galore=trim_galore<br>dir=<span>'/home/jinwei/RNA/clean'</span><br>file=<span>"config"</span><br><span>cd</span> <span>$dir</span><br>cat <span>$file</span> |<span>while</span> <span>read</span> id<br><span>do</span><br>        new=`<span>echo</span> <span>$id</span>`<br>        <span>$bin_trim_galore</span> -q 25 --phred33 --length 36 --stringency 3 -o <span>$dir</span> <span>$new</span><br><span>done</span> <br><span>source</span> deactivate<br></code></pre><p data-tool="mdnice编辑器">得到 clean  fq文件如下:</p><pre data-tool="mdnice编辑器"><span></span><code>1.8G 2月   4 10:28 clean/SRR8984523_trimmed.fq.gz<br>1.6G 2月   4 10:39 clean/SRR8984524_trimmed.fq.gz<br>1.7G 2月   4 10:51 clean/SRR8984525_trimmed.fq.gz<br>1.8G 2月   4 11:04 clean/SRR8984526_trimmed.fq.gz<br>1.8G 2月   4 11:16 clean/SRR8984527_trimmed.fq.gz<br>2.0G 2月   4 11:30 clean/SRR8984528_trimmed.fq.gz<br>2.0G 2月   4 11:45 clean/SRR8984529_trimmed.fq.gz<br>2.0G 2月   4 11:59 clean/SRR8984530_trimmed.fq.gz<br>2.0G 2月   4 12:13 clean/SRR8984531_trimmed.fq.gz<br>1.8G 2月   4 12:26 clean/SRR8984532_trimmed.fq.gz<br>1.9G 2月   4 12:40 clean/SRR8984533_trimmed.fq.gz<br>1.9G 2月   4 12:54 clean/SRR8984534_trimmed.fq.gz<br></code></pre><p data-tool="mdnice编辑器">可以看到fq数据是有一定程度的缩小哦！</p><h3 data-tool="mdnice编辑器">Hisat2比对</h3><p data-tool="mdnice编辑器">同样的，代码需要是针对单端测序数据，如下:</p><pre data-tool="mdnice编辑器"><span></span><code>index=/home/data/server/reference/index/hisat/hg38/genome<br>inputdir=/home/jinwei/RNA/clean<br>outdir=/home/jinwei/RNA/align<br>cat /home/jinwei/RNA/SRR_Acc_List.txt|while read id<br>do<br> echo "nohup hisat2 -p 12 -x $index -U $inputdir/${id}_trimmed.fq.gz|samtools sort -@ 5 -o $outdir/${id}_aln.sorted.bam  &amp;&amp; samtools index $outdir/${id}_aln.sorted.bam $outdir/${id}_aln.sorted.bam.bai &amp;&amp; samtools flagstat $outdir/${id}_aln.sorted.bam &gt;$id.txt &amp;"<br>done &gt;Hisat.sh<br><span>#</span><span>如果下一步直接bash Hisat.sh,则应该是每个样本都一起并行，容易把服务器的核占满。</span><br><span>#</span><span>需要设置并行的样本数量，满足服务器的配置。</span><br></code></pre><p data-tool="mdnice编辑器">比对文件和索引文件：</p><pre data-tool="mdnice编辑器"><span></span><code>1.6G 2月   4 23:29 SRR8984523_aln.sorted.bam<br>1.4G 2月   4 23:41 SRR8984524_aln.sorted.bam<br>1.5G 2月   4 23:47 SRR8984525_aln.sorted.bam<br>1.5G 2月   4 23:55 SRR8984526_aln.sorted.bam<br>1.5G 2月   5 00:02 SRR8984527_aln.sorted.bam<br>1.7G 2月   4 23:43 SRR8984528_aln.sorted.bam<br>1.7G 2月   4 23:51 SRR8984529_aln.sorted.bam<br>1.7G 2月   5 00:00 SRR8984530_aln.sorted.bam<br>1.7G 2月   4 23:58 SRR8984531_aln.sorted.bam<br>1.5G 2月   4 23:50 SRR8984532_aln.sorted.bam<br>1.6G 2月   5 08:59 SRR8984533_aln.sorted.bam<br>1.6G 2月   4 23:43 SRR8984534_aln.sorted.bam<br></code></pre><pre data-tool="mdnice编辑器"><span></span><code>ll -lh *bai|cut -d <span>" "</span> -f 5-<br>3.1M 2月   4 23:29 SRR8984523_aln.sorted.bam.bai<br>3.0M 2月   4 23:41 SRR8984524_aln.sorted.bam.bai<br>3.0M 2月   4 23:48 SRR8984525_aln.sorted.bam.bai<br>3.0M 2月   4 23:55 SRR8984526_aln.sorted.bam.bai<br>3.0M 2月   5 00:02 SRR8984527_aln.sorted.bam.bai<br>3.1M 2月   4 23:43 SRR8984528_aln.sorted.bam.bai<br>3.0M 2月   4 23:51 SRR8984529_aln.sorted.bam.bai<br>3.0M 2月   5 00:00 SRR8984530_aln.sorted.bam.bai<br>3.0M 2月   5 09:16 SRR8984531_aln.sorted.bam.bai<br>2.9M 2月   4 23:51 SRR8984532_aln.sorted.bam.bai<br>2.8M 2月   5 09:00 SRR8984533_aln.sorted.bam.bai<br>2.9M 2月   4 23:43 SRR8984534_aln.sorted.bam.bai<br></code></pre><p data-tool="mdnice编辑器">samtools flagstat用于统计文件比对情况：</p><pre data-tool="mdnice编辑器"><span></span><code>ll -lh SRR*txt|cut -d <span>" "</span> -f 5-<br>395 2月   4 23:30 SRR8984523.txt<br>394 2月   4 23:41 SRR8984524.txt<br>394 2月   4 23:48 SRR8984525.txt<br>394 2月   4 23:56 SRR8984526.txt<br>394 2月   5 00:03 SRR8984527.txt<br>394 2月   4 23:44 SRR8984528.txt<br>394 2月   4 23:52 SRR8984529.txt<br>394 2月   5 00:01 SRR8984530.txt<br>394 2月   5 09:16 SRR8984531.txt<br>394 2月   4 23:51 SRR8984532.txt<br>394 2月   5 09:00 SRR8984533.txt<br>394 2月   4 23:43 SRR8984534.txt<br></code></pre><p data-tool="mdnice编辑器">结果示例：SRR8984523.txt</p><pre data-tool="mdnice编辑器"><span></span><code>53974859 + 0 <span>in</span> total (QC-passed reads + QC-failed reads) <span>#总reads数</span><br>10235416 + 0 secondary <span>#比对到参考基因组的多个位置的reads数</span><br>0 + 0 supplementary <br>0 + 0 duplicates <span>#如果做了markduplicates，则会统计PCR Duplicates reads数</span><br>53214835 + 0 mapped (98.59% : N/A) <span>#比对到参考基因组的比对率</span><br><span>#下面几行只针对双端测序</span><br>0 + 0 paired <span>in</span> sequencing<br>0 + 0 read1<br>0 + 0 read2<br>0 + 0 properly paired (N/A : N/A)<br>0 + 0 with itself and mate mapped<br>0 + 0 singletons (N/A : N/A)<br>0 + 0 with mate mapped to a different chr<br>0 + 0 with mate mapped to a different chr (mapQ&gt;=5)<br></code></pre><p data-tool="mdnice编辑器">样品比对信息统计脚本：</p><pre data-tool="mdnice编辑器"><span></span><code><span>#</span><span><span>#secondary表示比对到参考基因组多个位置的reads数</span></span><br>dir='/home/jinwei/RNA/align'<br>outfile='mapinfo.txt'<br>cd $dir<br><span>#</span><span><span>#先判断输出文件是否存在，方便多次修改调试脚本</span></span><br>if  [ -e  $outfile  ]; then<br>rm  -rf  $outfile<br>fi<br>ls *txt|while read id;do(echo $id|awk -F "." '{print $1}'&gt;&gt;sample);done<br><span>#</span><span>记住<span>'{printf "%'</span><span>"'"</span><span>'18.0f\n",$0}'</span>表示用“,”作为千位分隔符分隔整数，18.2f表示保留两位小数</span><br>ls *txt|while read id;do(cat $id|cut -d " " -f 1|sed -n "1p"|awk '{printf "%'"'"'18.0f\n",$0}' &gt;&gt;totalreads);done<br>ls *txt|while read id;do(cat $id|cut -d " " -f 1|sed -n "2p"|awk '{printf "%'"'"'18.0f\n",$0}'&gt;&gt;secondary);done<br>ls *txt|while read id;do(cat $id|cut -d " " -f 4,5|sed -n '5p'|awk -F "(" '{print $2}' &gt;&gt;mapratio);done<br>echo "sample    totalreads      secondary       mapratio" &gt;$outfile<br>paste -d "\t" sample totalreads secondary mapratio &gt;&gt;$outfile<br><span>#</span><span>删除中间文件</span><br>rm sample totalreads secondary mapratio<br></code></pre><p data-tool="mdnice编辑器">样品比对信息统计表：mapinfo.txt</p><pre data-tool="mdnice编辑器"><span></span><code>sample  totalreads      secondary       mapratio<br>SRR8984523              53,974,859              10,235,416      98.59%<br>SRR8984524              47,342,726               8,640,278      98.60%<br>SRR8984525              50,990,953               9,651,296      98.60%<br>SRR8984526              50,927,636               8,225,220      98.51%<br>SRR8984527              49,300,389               7,642,290      98.36%<br>SRR8984528              57,093,942               9,488,991      98.56%<br>SRR8984529              57,548,074               8,818,589      98.56%<br>SRR8984530              57,896,032               9,355,084      98.58%<br>SRR8984531              57,832,433               9,652,116      98.60%<br>SRR8984532              52,957,312               8,960,173      98.70%<br>SRR8984533              55,501,832               9,690,769      98.67%<br>SRR8984534              54,603,442               9,155,215      98.63%<br></code></pre><p data-tool="mdnice编辑器">比对率很高，而且大部分reads都只比对到了参考基因组的一个位置。</p><p data-tool="mdnice编辑器">没有问题就可以删除samtools flagstat的结果文件。</p><pre data-tool="mdnice编辑器"><span></span><code><span>cd</span> ../align<br>rm  SRR*txt<br></code></pre><h3 data-tool="mdnice编辑器">定量</h3><pre data-tool="mdnice编辑器"><span></span><code>cd ../counts<br><span>#</span><span> 需要自己下载 Homo_sapiens.GRCh38.98.gtf.gz 文件哦</span><br>gtf="/home/data/server/reference/gtf/ensembl/Homo_sapiens.GRCh38.98.gtf.gz"<br>inputdir="/home/jinwei/RNA/align"<br>source activate rna<br><span>#</span><span> featureCounts对bam文件进行计数</span><br>featureCounts -T 10 -t exon -g gene_id -a $gtf -o all.id.txt $inputdir/*.sorted.bam<br><span><br>#</span><span> 对定量结果质控</span><br>multiqc all.id.txt.summary<br><span><br>#</span><span> 得到表达矩阵</span><br>cat all.id.txt | cut -f1,7- &gt; counts.txt<br>source deactivate<br></code></pre><p data-tool="mdnice编辑器">拿到了表达量矩阵就可以进行后续分析，其中这个下游分析还有一个小插曲，见：<a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247499182&amp;idx=2&amp;sn=a0641744abc66d7db21e66ec0478996a&amp;scene=21#wechat_redirect" data-linktype="2" wah-hotarea="click">谁说样本一定要按照编号排序呢</a></p><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/cgaBGlKw-uOKDD5KKylAdg",target="_blank" rel="noopener noreferrer">原文链接</a>
