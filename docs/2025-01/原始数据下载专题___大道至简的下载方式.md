---
title: "原始数据下载专题 | 大道至简的下载方式"
date: 2025-01-12T08:59:31Z
draft: ["false"]
tags: [
  "fetched",
  "萌哥与生信"
]
categories: ["Acdemic"]
---
原始数据下载专题 | 大道至简的下载方式 by 萌哥与生信
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">背景介绍</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">这篇是这个系列的收官之作，之前介绍了那么多的工具，实际上数据下载没有必要弄得那么复杂，就像把</span><strong><span leaf="">大象放进冰箱</span></strong><span leaf="">一样分三步就够了：</span></p><ol><li><section><span leaf="">查询数据的地址</span></section></li><li><section><span leaf="">下载数据</span></section></li><li><section><span leaf="">检测数据完整性</span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">所以这一篇就解决三个问题：</span></p><ol><li><section><span leaf="">如何查询数据地址？</span></section></li><li><section><span leaf="">用什么命令下载？</span></section></li><li><section><span leaf="">如何确定数据是完整的？</span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">咱们一步一步来。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">查询原始数据存储地址</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">我目前最常用的工具就是 </span><code><span leaf="">https://sra-explorer.info/</span></code><span leaf=""> 这个网站。</span></p><p data-tool="mdnice编辑器"><span leaf="">这是由  </span><code><span leaf="">Phil Ewels</span></code><span leaf=""> 开发的网站。如果这个名字你不熟悉的话，或许你用过</span><code><span leaf="">MultiQC</span></code><span leaf="">？是的，也是这位大佬的作品。</span></p><p data-tool="mdnice编辑器"><span leaf="">这个网站设计也很简洁，最简单的，把你从文章里拿到的NCBI的编号往里面一贴，上至</span><code><span leaf="">BioPorject</span></code><span leaf="">的编号下到</span><code><span leaf="">running</span></code><span leaf="">的</span><code><span leaf="">accession</span></code><span leaf="">，都是没问题的。</span></p><p data-tool="mdnice编辑器"><span leaf="">例如编号：</span><code><span leaf="">PRJNA510689</span></code><span leaf="">，输入之后会自动加一个</span><code><span leaf="">[All Fields]</span></code><span leaf="">也就是在所有的字段里都查询这个关键词。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100000834" data-src="https://mmbiz.qpic.cn/mmbiz_png/IasV9nWZS0eVctaM0zSaiba6xLZoep7cFEEAicfeCLBekrc3h2FDZEpMCn22EZ1PIpoWgkBFrMibYUTK323bic9heA/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/IasV9nWZS0eVctaM0zSaiba6xLZoep7cFEEAicfeCLBekrc3h2FDZEpMCn22EZ1PIpoWgkBFrMibYUTK323bic9heA/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">sra-explorer.info</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">这个字段是符合</span><code><span leaf="">NCBI</span></code><span leaf="">的</span><code><span leaf="">SRA数据库</span></code><span leaf="">的高级搜索的语法的。如下图这些字段都是可以指定查询的。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100000836" data-src="https://mmbiz.qpic.cn/mmbiz_png/IasV9nWZS0eVctaM0zSaiba6xLZoep7cFBs5wXKmug2NHUZdZ2SlCOibtGfYicDBPVAj3FPia8kCOZbshSVflFF4IQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/IasV9nWZS0eVctaM0zSaiba6xLZoep7cFBs5wXKmug2NHUZdZ2SlCOibtGfYicDBPVAj3FPia8kCOZbshSVflFF4IQ/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">sra advanced search</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">查询到了编号对应的数据之后就可以勾选你需要的数据，然后就可以点击右边的</span><code><span leaf="">Add xx to collection</span></code><span leaf="">按钮了，添加完之后就可以点击右上角的   </span><code><span leaf="">xx saved datasets</span></code><span leaf="">按钮，页面下部就会跳转到</span><code><span leaf="">Saved Datasets</span></code><span leaf="">的内容，点击第一个标签的</span><code><span leaf="">FastQ Downloads</span></code><span leaf="">就可以得到想要下载的数据的地址了:</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-imgfileid="100000835" data-src="https://mmbiz.qpic.cn/mmbiz_png/IasV9nWZS0eVctaM0zSaiba6xLZoep7cF0SeDW9VwRojLIP48jhJKWVTkzicHpq8c2Lmicgp8UicEuMlG9Iu4oQmpQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/IasV9nWZS0eVctaM0zSaiba6xLZoep7cF0SeDW9VwRojLIP48jhJKWVTkzicHpq8c2Lmicgp8UicEuMlG9Iu4oQmpQ/640?wx_fmt=png&amp;from=appmsg"></span><figcaption><span leaf="">获得URL地址</span></figcaption></figure><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360250/SRR8360250.fastq.gz</span><br><span leaf="">ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/001/SRR8360251/SRR8360251.fastq.gz</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">下载</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">下载的工具有很多,这里主要推荐这几个:</span></p><ul><li><section><span leaf="">wget</span></section></li><li><section><span leaf="">curl</span></section></li><li><section><span leaf="">axel</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">还有几个我问GPT得到的或者我见过但是我不常用的:</span></p><ul><li><section><span leaf="">aria2</span></section></li><li><section><span leaf="">rsync</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">感兴趣的同学可以自己研究一下或者问问各种大模型什么的.</span></p><p data-tool="mdnice编辑器"><span leaf="">这些工具不是为下载生信数据设计的, 本身就能够用来下载各种各样的数据. 使用起来也很简单</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">wget</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">wget -c ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360250/SRR8360250.fastq.gz ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/001/SRR8360251/SRR8360251.fastq.gz</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">这里</span><code><span leaf="">-c</span></code><span leaf="">是</span><code><span leaf="">断点续传</span></code><span leaf="">的意思. 如果不加这个参数, 那么下载如果断了, 就会从头重新下载, 哪怕是下载到99%了断开了, 也得从头再来. 加了这个参数之后就可以增量下载了, 会从断开的地方继续下载.</span></p><p data-tool="mdnice编辑器"><span leaf="">如果你想下载多个文件, 可以直接把你想要下载的文件都放在后面用空格隔开就好了.</span></p><p data-tool="mdnice编辑器"><span leaf="">下载速度也是不错的.</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">wget -c ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360250/SRR8360250.fastq.gz ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/001/SRR8360251/SRR8360251.fastq.gz</span><br><span leaf="">--2025-01-12 00:09:31--  ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360250/SRR8360250.fastq.gz</span><br><span leaf="">           =&gt; ‘SRR8360250.fastq.gz’</span><br><span leaf="">Resolving ftp.sra.ebi.ac.uk (ftp.sra.ebi.ac.uk)... 193.62.193.165</span><br><span leaf="">Connecting to ftp.sra.ebi.ac.uk (ftp.sra.ebi.ac.uk)|193.62.193.165|:21... connected.</span><br><span leaf="">Logging </span><span><span leaf="">in</span></span><span leaf=""> as anonymous ... Logged </span><span><span leaf="">in</span></span><span leaf="">!</span><br><span leaf="">==&gt; SYST ... </span><span><span leaf="">done</span></span><span leaf="">.    ==&gt; PWD ... </span><span><span leaf="">done</span></span><span leaf="">.</span><br><span leaf="">==&gt; TYPE I ... </span><span><span leaf="">done</span></span><span leaf="">.  ==&gt; CWD (1) /vol1/fastq/SRR836/000/SRR8360250 ... </span><span><span leaf="">done</span></span><span leaf="">.</span><br><span leaf="">==&gt; SIZE SRR8360250.fastq.gz ... 1619924596</span><br><span leaf="">==&gt; PASV ... </span><span><span leaf="">done</span></span><span leaf="">.    ==&gt; RETR SRR8360250.fastq.gz ... </span><span><span leaf="">done</span></span><span leaf="">.</span><br><span leaf="">Length: 1619924596 (1.5G) (unauthoritative)</span><br><br><span leaf="">SRR8360250.fastq.gz      16%[===&gt;                          ] 253.22M  26.4MB/s    eta 79s    </span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">curl</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">如果你是mac用户, wget不是必备的命令, 默认mac是用curl的.</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">curl -C - -O ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360250/SRR8360250.fastq.gz</span><br></code></pre><p data-tool="mdnice编辑器"><code><span leaf="">-O:</span></code><span leaf=""> 将文件保存为其原始名称，而不是默认重定向到标准输出。</span></p><p data-tool="mdnice编辑器"><code><span leaf="">-C - </span></code><span leaf="">(可选):</span></p><p data-tool="mdnice编辑器"><span leaf="">启用断点续传。如果下载中断，可以继续未完成的部分，而不是重新下载。 (注意这里有一个减号哈.)</span></p><p data-tool="mdnice编辑器"><span leaf="">如果你有多个文件想要用curl下载, 可以用下面这两种方法:</span></p><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">curl多文件下载方法1:</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">如果要下载多个文件, 一个方法是每个文件前面加一个</span><code><span leaf="">-O</span></code></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">curl -O ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360250/SRR8360250.fastq.gz \</span><br><span leaf="">     -O ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360251/SRR8360251.fastq.gz</span><br></code></pre><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">curl多文件下载方法2:</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">借助</span><code><span leaf="">xargs</span></code><span leaf="">:</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">echo</span></span><span leaf=""> </span><span><span leaf="">"ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360250/SRR8360250.fastq.gz</span><br><span leaf="">ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360251/SRR8360251.fastq.gz"</span></span><span leaf=""> | \</span><br><span leaf="">xargs -n 1 curl -O</span><br></code></pre><p data-tool="mdnice编辑器"><code><span leaf="">xargs</span></code><span leaf=""> 会读取每一行的 </span><code><span leaf="">URL</span></code><span leaf="">，并对每个 </span><code><span leaf="">URL</span></code><span leaf=""> 执行 </span><code><span leaf="">curl -O</span></code><span leaf="">。</span></p><p data-tool="mdnice编辑器"><span leaf="">当然, 你会写循环或者愿意把下载地址存成文件的话, 那当然也是可以的.</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">axel</span></span><span></span></h3><p data-tool="mdnice编辑器"><code><span leaf="">axel</span></code><span leaf=""> 是一个多线程下载工具, 可以针对单个文件进行加速下载.</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">axel -n 10 ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360250/SRR8360250.fastq.gz</span><br></code></pre><p data-tool="mdnice编辑器"><code><span leaf="">-n 10</span></code><span leaf="">: 指定使用 10 个线程（可以根据网络情况调整）。</span></p><p data-tool="mdnice编辑器"><span leaf="">但是一样的, axel也是一次性只能下载一个文件, 你想要下载多个, 那就得写循环:</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">for</span></span><span leaf=""> url </span><span><span leaf="">in</span></span><span leaf=""> ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360250/SRR8360250.fastq.gz \</span><br><span leaf="">           ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR836/000/SRR8360251/SRR8360251.fastq.gz</span><br><span><span leaf="">do</span></span><br><span leaf="">    axel -n 10 </span><span><span leaf="">"</span><span><span leaf="">$url</span></span><span leaf="">"</span></span><br><span><span leaf="">done</span></span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">或者while循环:</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">while</span></span><span leaf=""> </span><span><span leaf="">read</span></span><span leaf=""> -r url; </span><span><span leaf="">do</span></span><br><span leaf="">    axel -n 10 </span><span><span leaf="">"</span><span><span leaf="">$url</span></span><span leaf="">"</span></span><br><span><span leaf="">done</span></span><span leaf=""> &lt; urls.txt</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">或者借助xargs:</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">cat urls.txt | xargs -n 1 -P 4 -I {} axel -n 10 {}</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">剩下的软件使用起来也大同小异, 最多参数之类的不太一样罢了.</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">验证数据完整性</span></span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">问: 为什么要验证数据完整性？</span></span><span></span></h3><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">答:</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">数据完整性是确保文件在</span><strong><span leaf="">传输</span></strong><span leaf="">或</span><strong><span leaf="">存储</span></strong><span leaf="">过程中没有被损坏、篡改或丢失的重要手段。尤其在生信分析中，如果数据不完整或错误，会直接影响结论的可靠性和成果的再现性。</span></p><blockquote><span></span><p><span leaf="">“garbage in, garbage out.”</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">只有验证了数据完整性, 才能确保我们下载到的数据和数据库里存储的数据是一样的.</span></p><p data-tool="mdnice编辑器"><span leaf="">验证完整性最主要是用</span><code><span leaf="">md5值</span></code><span leaf="">. 当然也可以用</span><code><span leaf="">gzip -t</span></code><span leaf="">来辅助检测.</span></p><hr><blockquote><span></span><p><span leaf="">回到前面的</span><code><span leaf="">sra-explorer.info</span></code><span leaf="">网站, 点击Full Matadata............. 写到这里发现翻车了, 因为</span><code><span leaf="">sra-explorer.info</span></code><span leaf="">网站不提供md5值. 汗流浃背了😅</span></p><p><span leaf="">那就用ENA数据库吧, 因为NCBI也没有这个信息🤷</span></p></blockquote><hr><p data-tool="mdnice编辑器"><span leaf="">访问ENA数据库:</span><code><span leaf="">https://www.ebi.ac.uk/ena/browser/home</span></code><span leaf="">, 在右边的第二个框里输入accession number, (比如 </span><code><span leaf="">PRJNA510689</span></code><span leaf="">)</span></p><p data-tool="mdnice编辑器"><span leaf="">在搜索结果里面点击</span><code><span leaf="">Show Column Selection</span></code><span leaf="">, 在下拉框里把</span><code><span leaf="">fastq_md5</span></code><span leaf="">给勾选起来, 这样就能在下面的列表里显示出md5值了.</span></p><p data-tool="mdnice编辑器"><span leaf="">接下来只要点击</span><code><span leaf="">Download report</span></code><span leaf=""> 里的  </span><code><span leaf="">TSV</span></code><span leaf="">按钮把</span><code><span leaf="">metadata</span></code><span leaf="">文件下载下来就可以了.</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">检测md5值</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">md5sum SRR8360250.fastq.gz</span><br><span leaf="">6e83028eb5edf9366d98d1fd4c8b4c01  SRR8360250.fastq.gz</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">就会生成这个文件的md5值, 只要跟下载下来的文件对照一下就知道下载的文件是否完整了.</span></p><p data-tool="mdnice编辑器"><span leaf="">或者把下载下来的文件整理这这样的两列的形式:</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">awk -F </span><span><span leaf="">"\t"</span></span><span leaf=""> </span><span><span leaf="">'NR==1 {</span><br><span leaf="">    for (i=1; i&lt;=NF; i++) {</span><br><span leaf="">        if ($i == "fastq_md5") md5_col = i;</span><br><span leaf="">        if ($i == "fastq_ftp") ftp_col = i;</span><br><span leaf="">    }</span><br><span leaf="">}</span><br><span leaf="">NR&gt;1 {</span><br><span leaf="">    split($ftp_col, path_parts, "/");</span><br><span leaf="">    print $md5_col "  " path_parts[length(path_parts)];</span><br><span leaf="">}'</span></span><span leaf=""> filereport_read_run_PRJNA510689_tsv.txt &gt; PRJNA510689.md5</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">输出的这个</span><code><span leaf="">PRJNA510689.md5</span></code><span leaf="">文件长这样:</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">61f6f02f7b21f884ddc02c7b37000625  SRR8360232.fastq.gz</span><br><span leaf="">d9d97c8489ed3b05b7bd9100d8a1467b  SRR8360237.fastq.gz</span><br><span leaf="">...</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">然后等数据都下载好了, 只要运行一下</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">md5sum -c PRJNA510689.md5</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">就可以了. 如果生成的md5值跟文件记录的值一样, 会输出</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">SRR8360232.fastq.gz: OK</span><br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">用</span><code><span leaf="">gzip -t</span></code><span leaf="">辅助确认文件完整性</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">命令很简单:</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">gzip -t SRR8360250.fastq.gz</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">如果文件</span><code><span leaf="">完整</span></code><span leaf="">, 那么不会有任何输出.</span></p><p data-tool="mdnice编辑器"><span leaf="">如果文件</span><code><span leaf="">不完整</span></code><span leaf="">, 就会有如下的输出:</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">gzip: SRR8360250.fastq.gz: unexpected end of file</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">那就说明数据没下完, 再尝试一下吧.</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">萌哥碎碎念</span></span><span></span></h2><ul><li><section><p><span leaf="">本来以为很快就会写完, 没想到又写了两三个小时.</span></p></section></li><li><section><p><span leaf="">本来觉得用各种软件挺麻烦的, 但是现在写了这一篇才发现</span><code><span leaf="">axel</span></code><span leaf="">和</span><code><span leaf="">curl</span></code><span leaf="">都是要写循环或者额外参数才能下载多个文件的, 远没有直接丢一个</span><code><span leaf="">BioProject</span></code><span leaf="">的编号给专门的原始数据下载工具(例如</span><code><span leaf="">fastq-dl</span></code><span leaf="">)来得方便.</span></p></section></li><li><section><p><span leaf="">再加上前面介绍的很多工具都会自动验证md5值, 就又免去了很多下载和操作.</span></p></section></li><li><section><p><span leaf="">果然人还是要学会使用工具.</span></p></section></li><li><section><p><span leaf="">今天换了一个主题色, 感觉不错, 喜欢了</span></p></section></li></ul></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/W5SdvNEAIrYVSBD3pt9UGw",target="_blank" rel="noopener noreferrer">原文链接</a>
