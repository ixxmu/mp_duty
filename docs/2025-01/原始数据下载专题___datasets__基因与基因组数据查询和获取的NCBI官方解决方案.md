---
title: "原始数据下载专题 | datasets——基因与基因组数据查询和获取的NCBI官方解决方案"
date: 2025-01-02T00:19:05Z
draft: ["false"]
tags: [
  "fetched",
  "萌哥与生信"
]
categories: ["Acdemic"]
---
原始数据下载专题 | datasets——基因与基因组数据查询和获取的NCBI官方解决方案 by 萌哥与生信
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">背景</span></span><span></span><span><span leaf=""> </span></span></h2><p data-tool="mdnice编辑器"><span leaf="">原始数据下载专题到最后一个工具啦，前面介绍的很多工具都是</span><code><span leaf="">下载原始的测序数据</span></code><span leaf="">的，而这个则不同，它是NCBI官方推出的用于</span><code><span leaf="">查询和获取基因、基因组数据</span></code><span leaf="">的工具。</span></p><p data-tool="mdnice编辑器"><span leaf="">NCBI的官方工具大家有印象的可能是</span><code><span leaf="">Entrez</span></code><span leaf="">，但是今天要介绍的这个</span><code><span leaf="">datasets</span></code><span leaf="">是一套新的更现代化的工具：</span></p><blockquote><span></span><p><span leaf="">简单介绍</span><code><span leaf="">Entrez</span></code><span leaf="">：</span></p><p><code><span leaf="">Entrez</span></code><span leaf="">是</span><code><span leaf="">NCBI</span></code><span leaf="">的综合搜索和检索系统，涵盖多个数据库，如PubMed、基因、核酸序列和蛋白质序列等。它允许用户通过固定的URL语法进行搜索、链接和检索操作。这些工具使研究人员能够以编程方式自动访问NCBI的各种数据库。</span></p><p><span leaf="">简单介绍</span><code><span leaf="">Datasets</span></code><span leaf="">：</span></p><p><code><span leaf="">Datasets</span></code><span leaf="">是NCBI推出的现代化工具，旨在简化基因组、分类和基因信息的访问和下载。它提供了一个统一的入口，用户可以通过</span><code><span leaf="">Web界面</span></code><span leaf="">或</span><code><span leaf="">命令行界面</span></code><span leaf="">获取所需的数据集。NCBI已宣布，</span><code><span leaf="">Datasets</span></code><span leaf="">将取代传统的Genome和Assembly资源，提供更流畅的用户体验。</span></p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">安装</span></span><span></span><span><span leaf=""> </span></span></h2><p data-tool="mdnice编辑器"><span leaf="">conda一键完成：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">conda install ncbi-datasets-cli</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">这个工具还在活跃的开发中，基本上半个月就更新一个小版本，目前最新版是</span><code><span leaf="">16.39.0</span></code></p><p data-tool="mdnice编辑器"><span leaf="">如果你直接搜索</span><code><span leaf="">datasets</span></code><span leaf="">，那个是huggingface旗下的用于机器学习模型训练的数据集，跟咱们今天介绍的不是一个东西，要分清楚哦。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">使用</span></span><span></span><span><span leaf=""> </span></span></h2><p data-tool="mdnice编辑器"><code><span leaf="">datasets</span></code><span leaf="">主要的三个子程序分别是:</span></p><ul><li><section><span leaf="">summary: 打印包含基因、基因组、分类学或病毒元数据的数据报告</span></section></li><li><section><span leaf="">download：以zip压缩包形式下载一个基因、基因组或者病毒的数据集</span></section></li><li><section><span leaf="">rehydrate：解除冻结已下载的冻结数据集</span></section></li></ul><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Data Retrieval Commands</span><br><span leaf="">  summary     Print a data report containing gene, genome, taxonomy or virus metadata</span><br><span leaf="">  download    Download a gene, genome or virus dataset as a zip file</span><br><span leaf="">  rehydrate   Rehydrate a downloaded, dehydrated dataset</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">前两个功能大家应该好理解，我解释一下第三个rehydrate：</span></p><blockquote><span></span><p><span leaf="">在NCBI的datasets命令行工具中，</span><code><span leaf="">rehydrate</span></code><span leaf="">命令用于处理之前下载的“脱水”数据集。</span></p><p><span leaf="">当您使用</span><code><span leaf="">datasets download</span></code><span leaf="">命令并添加</span><code><span leaf="">--dehydrated</span></code><span leaf="">标志下载数据集时，系统会创建一个包含元数据和数据文件位置的压缩包，但不包含实际的数据文件。</span></p><p><span leaf="">这种方法适用于需要下载大量数据的情况，因为初始下载的文件较小，便于传输和管理。</span></p><p><span leaf="">下载并解压缩该压缩包后，您可以使用rehydrate命令根据元数据中的文件位置下载实际的数据文件，从而“重新填充”数据集。这种两步下载过程提高了大规模数据集的下载效率和灵活性。</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">下载这个功能比较常用咱们先来使用这个。 下载一共能下载四个方面的内容：</span></p><ul><li><section><span leaf="">gene：下载一个基因的蛋白质和DNA序列</span></section></li><li><section><span leaf="">genome：下载一个基因组的组装注释数据</span></section></li><li><section><span leaf="">taxonomy：根据进化分类下载数据，例如</span><code><span leaf="">taxon human,sars-cov-2</span></code></section></li><li><section><span leaf="">virus: 下载病毒相关的数据</span></section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">场景1：下载基因组数据</span></span><span></span></h3><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">基因组文件下载</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">在大多数的生信分析的准备工作里都有要下载基因组这一步，以前都是打开网页不断地查询之后复制链接地址然后下载，现在直接一行命令就可以完成了。</span></p><p data-tool="mdnice编辑器"><span leaf="">在</span><code><span leaf="">genome</span></code><span leaf="">这个子程序里，又分为通过</span><code><span leaf="">taxon</span></code><span leaf="">或者</span><code><span leaf="">accession</span></code><span leaf="">来下载。</span></p><p data-tool="mdnice编辑器"><span leaf="">例如官方给的案例：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">datasets download genome accession GCF_000001405.40 --chromosomes X,Y --include genome,gff3,rna</span><br><span leaf="">datasets download genome taxon </span><span><span leaf="">"bos taurus"</span></span><span leaf=""> --dehydrated</span><br><span leaf="">datasets download genome taxon human --assembly-level chromosome,complete --dehydrated</span><br><span leaf="">datasets download genome taxon mouse --search C57BL/6J --search </span><span><span leaf="">"Broad Institute"</span></span><span leaf=""> --dehydrated</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">用</span><code><span leaf="">taxon途径</span></code><span leaf="">下载一下</span><code><span leaf="">拟南芥</span></code><span leaf="">（</span><em><span leaf="">Arabidopsis thaliana</span></em><span leaf="">）的基因组文件。</span></p><p data-tool="mdnice编辑器"><code><span leaf="">datasets</span></code><span leaf="">可以不仅仅是把参考基因组文件下了，还把一整套的基因组注释文件也一起下载下来：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">datasets download genome taxon  </span><span><span leaf="">"Arabidopsis thaliana"</span></span><span leaf=""> --reference --include genome,gff3,gtf,rna,cds,protein --filename Arabidopsis.genome.zip</span><br></code></pre><ul><li><section><span leaf="">如果不指定</span><code><span leaf="">--filename</span></code><span leaf="">则默认会使用</span><code><span leaf="">ncbi_dataset.zip</span></code><span leaf="">作为输出的文件名。</span></section></li><li><section><code><span leaf="">--reference</span></code><span leaf="">用于指定NCBI官方打了</span><code><span leaf="">reference标记</span></code><span leaf="">的版本，也就是官方认定的参考基因组版本，如果不加这个参数，默认会下载所有的基因组版本。</span></section></li><li><section><code><span leaf="">--include</span></code><span leaf="">用于指定要下载的内容，</span><code><span leaf="">genome</span></code><span leaf="">,</span><code><span leaf="">gff3</span></code><span leaf="">,</span><code><span leaf="">gtf</span></code><span leaf="">,</span><code><span leaf="">rna</span></code><span leaf="">,</span><code><span leaf="">cds</span></code><span leaf="">,</span><code><span leaf="">protein</span></code><span leaf="">,</span><code><span leaf="">gbff</span></code><span leaf="">,</span><code><span leaf="">seq-report</span></code><span leaf="">都是可选的，默认是仅下载</span><code><span leaf="">genome</span></code><span leaf="">。</span></section></li><li><section><span leaf="">像一些常见的物种有</span><code><span leaf="">nickname</span></code><span leaf="">，例如</span><code><span leaf="">human</span></code><span leaf="">和</span><code><span leaf="">mouse</span></code><span leaf="">就可以不用写拉丁名直接用常用名词下载了。</span></section></li></ul><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">下载一个物种的所有基因组组装版本</span></span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">当涉及到大量数据下载的时候就可以用</span><code><span leaf="">--dehydrated</span></code><span leaf="">这个参数先脱水， 也就是先获取信息，然后再</span><code><span leaf="">rehydrate</span></code><span leaf="">下载想要的信息。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">datasets download genome taxon </span><span><span leaf="">"Arabidopsis thaliana"</span></span><span leaf=""> --dehydrated --filename Arabidopsis.genome.all.zip</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">下载下来之后解压开，有文件里有一个叫</span><code><span leaf="">ncbi_dataset/fetch.txt</span></code><span leaf="">，这个文件大概长这样：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">https://api.ncbi.nlm.nih.gov/datasets/fetch_h/R2V0UmVtb3RlRGF0YWZpbGU/eNqTyuRKz0tOytROKymw0tdPT83Lz00t1k_MydF3d3bUNzAwAGJDfXNjUxA_3gAEDIE8PaP4EEfPIEMDPUOcEvFg0zKT9dLyEvXSqwwYLRgBs5Ud6A        0            data/GCA_000001735.2/GCA_000001735.2_TAIR10.1_genomic.fna</span><br><span leaf="">https://api.ncbi.nlm.nih.gov/datasets/fetch_h/R2V0UmVtb3RlRGF0YWZpbGU/eNqTyuXKzktOytROKymw0tdPT83Lz00t1k_MydF3d3bUNzAw0DcyNNQ3MjcF8eOBfCAXyNMzjHcM9gWzywzxSMWDTcxM1kvLS9RLrzJgtGAEADJ9Hx4       0            data/GCA_000211275.1/GCA_000211275.1_ASM21127v1_genomic.fna</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">看起来是一个三列的文件，第一列是要下载的文件的URL地址，第二列是个文件大小，显示为0，这可能表示文件大小未知或未指定。</span></p><p data-tool="mdnice编辑器"><span leaf="">第三列表示文件在本地存储时的路径。 我把前两行的内容代替掉整个fetch.txt文件，然后运行下面这个</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">datasets rehydrate --directory .</span><br></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">萌哥吐槽时间：</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">它这个功能有点傻，是自动匹配</span><code><span leaf="">*/ncbi_dataset/fetch.txt</span></code><span leaf="">这样一个地址的，如果重命名了文件夹就找不到了，会报下载失败。</span></p><p data-tool="mdnice编辑器"><span leaf="">也不能在上面的命令里指定</span><code><span leaf="">datasets rehydrate --directory ncbi_dataset/</span></code><span leaf="">，因为它会去找</span><code><span leaf="">ncbi_dataset/ncbi_dataset/fetch.txt</span></code><span leaf="">这样的一个地址然后告诉你找不到这个地址而下载失败。不够智能啊。</span></p><p data-tool="mdnice编辑器"><span leaf="">下载下来的文件会存放在</span><code><span leaf="">./ncbi_dataset/data</span></code><span leaf="">以各自的accession id命名的文件夹里。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">场景2：下载基因数据</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">可以用以下的方式下载gene数据</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">datasets download gene gene-id 672</span><br><span leaf="">datasets download gene symbol brca1 --taxon </span><span><span leaf="">"mus musculus"</span></span><br><span leaf="">datasets download gene accession NP_000483.3</span><br><span leaf="">datasets download gene gene-id 2778 --fasta-filter NC_000020.11,NM_001077490.3,NP_001070958.1</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">gene支持下面这四种方式：</span></p><ul><li><section><code><span leaf="">gene-id</span></code><span leaf="">: 是一串纯数字，例如著名的人类的</span><code><span leaf="">tp53基因</span></code><span leaf="">是</span><code><span leaf="">7157</span></code><span leaf="">。</span></section></li><li><section><code><span leaf="">symbol</span></code><span leaf="">：基因的名称，比如</span><code><span leaf="">brca1</span></code><span leaf="">，</span><code><span leaf="">tp53</span></code></section></li><li><section><code><span leaf="">accession</span></code><span leaf="">：基因的</span><code><span leaf="">NCBI编号</span></code></section></li><li><section><code><span leaf="">taxon</span></code><span leaf="">：NCBI的</span><code><span leaf="">Taxonomy ID</span></code><span leaf="">，拉丁名或者是常用名。</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">有的时候做进化树，会使用到特定的基因，比如</span><code><span leaf="">酵母</span></code><span leaf="">(</span><em><span leaf="">saccharomyces cerevisiae</span></em><span leaf="">)的</span><code><span leaf="">RPO21</span></code><span leaf="">基因。</span></p><p data-tool="mdnice编辑器"><span leaf="">这个基因的</span><code><span leaf="">gene id</span></code><span leaf="">是</span><code><span leaf="">851415</span></code><span leaf="">，而</span><code><span leaf="">RPO21</span></code><span leaf="">则是</span><code><span leaf="">Official Symbol</span></code><span leaf="">。</span><code><span leaf="">YDL140C</span></code><span leaf="">是这个基因的</span><code><span leaf="">Locus tag</span></code><span leaf="">（不支持这个关键字）。 但是我尝试了几次：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">datasets download gene symbol rpo21</span><br><span leaf="">datasets download gene symbol RPO21 </span><span><span leaf="">#试了试大写</span></span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">得到的结果都是</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">Error: No genes found that match selection</span><br><span leaf="">Use datasets download gene symbol &lt;</span><span><span leaf="">command</span></span><span leaf="">&gt; --</span><span><span leaf="">help</span></span><span leaf=""> </span><span><span leaf="">for</span></span><span leaf=""> detailed </span><span><span leaf="">help</span></span><span leaf=""> about a </span><span><span leaf="">command</span></span><span leaf="">.</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">看起来这个</span><code><span leaf="">symbol</span></code><span leaf="">的功能可能</span><strong><span leaf="">目前</span></strong><span leaf="">只适用于人类的</span><code><span leaf="">Official Symbol</span></code><span leaf="">，感觉可以去提一个issue。</span></p><p data-tool="mdnice编辑器"><span leaf="">用</span><code><span leaf="">Symbol</span></code><span leaf="">下载tp53倒是非常丝滑</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">datasets download gene symbol tp53 --ortholog all --filename tp53.zip</span><br></code></pre><ul><li><section><code><span leaf="">--ortholog</span></code><span leaf="">是把所有物种中含有这个symbol的基因都下载下来。感觉很适合用在做系统发育树的分析上。</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">用</span><code><span leaf="">gene-id</span></code><span leaf="">的方法去下载数据倒是很容易。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">datasets download gene gene-id 851415 --filename RPO21.zip</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">下载下来的压缩文件默认情况下会同时包含DNA序列和蛋白质序列。</span></p><p data-tool="mdnice编辑器"><span leaf="">如果你想下载时同时包含</span><code><span leaf="">5' UTR</span></code><span leaf="">或者</span><code><span leaf="">3' UTR</span></code><span leaf="">的信息，也可以也可以用</span><code><span leaf="">--include</span></code><span leaf="">来指定。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">萌哥碎碎念</span></span><span></span><span><span leaf=""> </span></span></h2><p data-tool="mdnice编辑器"><span leaf="">也没想到自己真能把这个系列写完，之后可能还想再更新一个</span><code><span leaf="">大道至简的原始数据下载方法</span></code><span leaf="">，介绍一下</span><code><span leaf="">https://sra-explorer.info/</span></code><span leaf=""> 这个工具结合</span><code><span leaf="">wget</span></code><span leaf="">或者</span><code><span leaf="">curl</span></code><span leaf="">或者</span><code><span leaf="">axel</span></code><span leaf="">的下载方式作为这个专题的收尾，然后再整理成一个大合集推文方便大家横向比较。</span></p><p data-tool="mdnice编辑器"><span leaf="">接下来距离我毕业大概还有五百多天，一半年，说长不长说短不短，要开始转变重心从咔咔分析数据到开始学习如何写文章了。我也收集了一些关于如何写学术论文的文章，到时候可以分享读文献笔记作为一个</span><code><span leaf="">“从零开始学习学术论文写作”</span></code><span leaf="">的专题给大家。总的框架是</span><code><span leaf="">输入，模仿，输出</span></code><span leaf="">，大家敬请期待哈。</span></p><p data-tool="mdnice编辑器"><span leaf="">说起来似乎是明白写公众号的意义了，其实还是主要是服务我自己，除非你是广告主来约投放，那么可以为了你写东西，否则绝大多数的内容都是为我自己服务的。当然包括给粉丝回答问题修复bug这也是一种为我服务。写推文的过程也是我自己整理学习和内化的一个过程，挺好。</span></p></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/3NZ26pV7ZEPVawoMYe9Ztg",target="_blank" rel="noopener noreferrer">原文链接</a>
