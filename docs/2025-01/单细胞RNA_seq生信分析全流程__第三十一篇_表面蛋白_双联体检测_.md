---
title: "单细胞RNA-seq生信分析全流程——第三十一篇：表面蛋白（双联体检测）"
date: 2025-01-12T23:53:23Z
draft: ["false"]
tags: [
  "fetched",
  "小鱼生物信息"
]
categories: ["Acdemic"]
---
单细胞RNA-seq生信分析全流程——第三十一篇：表面蛋白（双联体检测） by 小鱼生物信息
------
<div><section><span><span leaf="">31.1 前言</span></span></section><p><span leaf="">到目前为止，我们已经删除了仅基于高计数含量而可能反映双联体的细胞。我们还根据样本分布进行了过滤。现在，我们将重点关注异型双联体。借助ADT数据，我们可以使用细胞类型特异性表面标记检测它们。</span></p><section><span><span leaf="" data-pm-slice='1 1 ["para",null,"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;  background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>31.2 环境配置</span></span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span leaf=""><span>import</span><span> muon </span><span>as</span><span> mu</span></span></code><code><span leaf=""><span>import</span><span> pandas </span><span>as</span><span> pd</span></span></code><code><span leaf=""><span>import</span><span> pooch</span></span></code><code><span leaf=""><span>import</span><span> scanpy </span><span>as</span><span> sc</span></span></code><code><span leaf=""><span># setting visualization parameters</span></span></code><code><span leaf=""><span>sc.settings.verbosity = 0</span></span></code><code><span leaf=""><span>sc.settings.set_figure_params(</span></span></code><code><span leaf=""><span>    dpi=80,</span></span></code><code><span leaf=""><span>    facecolor="white",</span></span></code><code><span leaf=""><span>    frameon=False,</span></span></code><code><span leaf=""><span>)</span></span></code></pre></section><section><span><span leaf="" data-pm-slice='1 1 ["para",null,"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>31.3 加载数据</span></span></section><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span leaf=""><span>cite_filtered = pooch.retrieve(</span></span></code><code><span leaf=""><span>    url=</span><span>"https://figshare.com/ndownloader/files/41452443"</span><span>,</span></span></code><code><span leaf=""><span>    fname=</span><span>"cite_normalization.h5mu"</span><span>,</span></span></code><code><span leaf=""><span>    path=</span><span>"."</span><span>,</span></span></code><code><span leaf=""><span>    known_hash=</span><span>None</span><span>,</span></span></code><code><span leaf=""><span>    progressbar=</span><span>True</span><span>,</span></span></code><code><span leaf=""><span>)</span></span></code><code><span leaf=""><span>mdata = mu.read(</span><span>"cite_normalization.h5mu"</span><span>)</span></span></code></pre></section><section><span><span leaf="" data-pm-slice='1 1 ["para",null,"node",{"tagName":"span","attributes":{"style":"color: rgba(0, 0, 0, 0.9); font-family: \"PingFang SC\", system-ui, -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"Hiragino Sans GB\", \"Microsoft YaHei UI\", \"Microsoft YaHei\", Arial, sans-serif; font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 700; letter-spacing: 0.544px; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>31.4 用细胞类型标记检测双联体</span></span></section><p><span leaf="">我们现在将研究互斥的细胞类型标记。一些示例是 CD3（T细胞标记）与 CD19（B细胞标记）以识别T/B细胞双联体。由于在生理条件下不存在同时表达特定B细胞和T细胞标记的细胞，因此这些液滴很可能包含多个细胞。</span></p><p><span leaf="">对于同时表达T细胞（CD3）和单核细胞（CD14）标记的细胞也是如此。</span></p><section><ul><li></ul><pre data-lang=""><code><span leaf=""><span>mdata</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span leaf=""><span>MuData </span><span>object</span><span> </span><span>with</span><span> n_obs × n_vars = </span><span>120502</span><span> × </span><span>36741</span></span></code><code><span leaf=""><span>  </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>  </span><span>2</span><span> modalities</span></span></code><code><span leaf=""><span>    rna:	</span><span>120502</span><span> x </span><span>36601</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>    prot:	</span><span>120502</span><span> x </span><span>140</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span><span>, </span><span>'n_genes_by_counts'</span><span>, </span><span>'log1p_n_genes_by_counts'</span><span>, </span><span>'total_counts'</span><span>, </span><span>'log1p_total_counts'</span><span>, </span><span>'n_counts'</span><span>, </span><span>'outliers'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span><span>, </span><span>'n_cells_by_counts'</span><span>, </span><span>'mean_counts'</span><span>, </span><span>'log1p_mean_counts'</span><span>, </span><span>'pct_dropout_by_counts'</span><span>, </span><span>'total_counts'</span><span>, </span><span>'log1p_total_counts'</span></span></code><code><span leaf=""><span>      layers:	</span><span>'counts'</span></span></code></pre></section><section><ul><li></ul><pre data-lang="javascript"><code><span leaf=""><span>sc.</span><span>pl</span><span>.</span><span>scatter</span><span>(mdata[</span><span>"prot"</span><span>], x=</span><span>"CD3"</span><span>, y=</span><span>"CD19-1"</span><span>, color=</span><span>"log1p_total_counts"</span><span>)</span></span></code></pre></section><section><span leaf=""><img data-imgfileid="100000494" data-src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjOVSVFcD7BopujACWL3lz61rzia9akxTDBW5lY3xL4LO8MeTZicBwbhYFhJPTs9PV2ksozicH27gg3g/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjOVSVFcD7BopujACWL3lz61rzia9akxTDBW5lY3xL4LO8MeTZicBwbhYFhJPTs9PV2ksozicH27gg3g/640?wx_fmt=png&amp;from=appmsg"></span></section><p><span leaf="">在此图中，我们可以看到左下方有大量不表达T或B细胞标记的细胞，左上角和右下方有大量仅表达一种标记的细胞，右上角有一些同时表达两种标记的细胞。</span></p><p><span leaf="">表达两种标记的细胞很可能是双联体，可以去除。</span></p><p><span leaf="">我们还可以使用CD3和CD14来检测T/单核细胞双联体。</span></p><section><ul><li></ul><pre data-lang="javascript"><code><span leaf=""><span>sc.</span><span>pl</span><span>.</span><span>scatter</span><span>(mdata[</span><span>"prot"</span><span>], x=</span><span>"CD3"</span><span>, y=</span><span>"CD14-1"</span><span>, color=</span><span>"log1p_total_counts"</span><span>)</span></span></code></pre></section><section><span leaf=""><img data-imgfileid="100000495" data-src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjOVSVFcD7BopujACWL3lz6JWYc2KkUlMxolibcVlj6cFLtzhaKnicgic30I2pRxhfEVdQwicUXzBJDRg/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjOVSVFcD7BopujACWL3lz6JWYc2KkUlMxolibcVlj6cFLtzhaKnicgic30I2pRxhfEVdQwicUXzBJDRg/640?wx_fmt=png&amp;from=appmsg"></span></section><section><span leaf="">看起来分布的变化在2.5左右。我们可以使用至少两个不相容标记的2.5以上的表达水平作为标记双联体的阈值。</span></section><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span leaf=""><span>genes2filter = [</span><span>"CD3"</span><span>, </span><span>"CD19-1"</span><span>, </span><span>"CD14-1"</span><span>]</span></span></code><code><span leaf=""><span>temp = mdata[</span><span>"prot"</span><span>][:, genes2filter].X.T.tolist()</span></span></code><code><span leaf=""><span>mdata[</span><span>"prot"</span><span>].obs[</span><span>"doublets_markers"</span><span>] = [</span></span></code><code><span leaf=""><span>    (temp[</span><span>0</span><span>][i] &gt; </span><span>2.5</span><span> </span><span>and</span><span> temp[</span><span>1</span><span>][i] &gt; </span><span>2.5</span><span>) </span><span>or</span><span> (temp[</span><span>0</span><span>][i] &gt; </span><span>2.5</span><span> </span><span>and</span><span> temp[</span><span>2</span><span>][i] &gt; </span><span>2.5</span><span>)</span></span></code><code><span leaf=""><span>    </span><span>for</span><span> i </span><span>in</span><span> </span><span>range</span><span>(mdata.shape[</span><span>0</span><span>])</span></span></code><code><span leaf=""><span>]</span></span></code><code><span leaf=""><span>mdata[</span><span>"prot"</span><span>].obs[</span><span>"doublets_markers"</span><span>] = (</span></span></code><code><span leaf=""><span>    mdata[</span><span>"prot"</span><span>].obs[</span><span>"doublets_markers"</span><span>].astype(</span><span>str</span><span>)</span></span></code><code><span leaf=""><span>)</span></span></code></pre></section><section><span leaf="">我们忽略了表达两种标记的细胞。</span></section><section><ul><li></ul><pre data-lang="perl"><code><span leaf=""><span>sc.pl.violin(mdata[</span><span>"prot"</span><span>], </span><span>keys</span><span>=</span><span>"log1p_total_counts"</span><span>, groupby=</span><span>"doublets_markers"</span><span>)</span></span></code></pre></section><section><span leaf=""><img data-imgfileid="100000496" data-src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjOVSVFcD7BopujACWL3lz6roficfuwKZicibq6zfqSX1TGRpmOmYVzPBc6zFJaMwpCwyxwGS0POVt8w/640?wx_fmt=png&amp;from=appmsg" data-type="png" src="https://mmbiz.qpic.cn/mmbiz_png/e1cKg2SPUFjOVSVFcD7BopujACWL3lz6roficfuwKZicibq6zfqSX1TGRpmOmYVzPBc6zFJaMwpCwyxwGS0POVt8w/640?wx_fmt=png&amp;from=appmsg"></span></section><section><span leaf="">双联体通常具有较高的计数，因为存在来自多个细胞的计数增加。我们可以在使用我们的标记物分类为双联体的细胞中看到这种效果。</span></section><section><ul><li><li><li><li></ul><pre data-lang="sql"><code><span leaf=""><span>mdata.update()</span></span></code><code><span leaf=""><span>mdata </span><span>=</span><span> mdata[mdata.obs.loc[mdata["prot"].obs_names].index]</span></span></code><code><span leaf=""><span>mdata </span><span>=</span><span> mdata[mdata["prot"].obs["doublets_markers"] </span><span>==</span><span> "False"].</span><span>copy</span><span>()</span></span></code><code><span leaf=""><span>mdata</span></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="cs"><code><span leaf=""><span>MuData </span><span>object</span><span> </span><span>with</span><span> n_obs × n_vars = </span><span>119837</span><span> × </span><span>36741</span></span></code><code><span leaf=""><span>  </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>  </span><span>2</span><span> modalities</span></span></code><code><span leaf=""><span>    rna:	</span><span>119837</span><span> x </span><span>36601</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span></span></code><code><span leaf=""><span>    prot:	</span><span>119837</span><span> x </span><span>140</span></span></code><code><span leaf=""><span>      obs:	</span><span>'donor'</span><span>, </span><span>'batch'</span><span>, </span><span>'n_genes_by_counts'</span><span>, </span><span>'log1p_n_genes_by_counts'</span><span>, </span><span>'total_counts'</span><span>, </span><span>'log1p_total_counts'</span><span>, </span><span>'n_counts'</span><span>, </span><span>'outliers'</span><span>, </span><span>'doublets_markers'</span></span></code><code><span leaf=""><span>      </span><span>var</span><span>:	</span><span>'gene_ids'</span><span>, </span><span>'feature_types'</span><span>, </span><span>'n_cells_by_counts'</span><span>, </span><span>'mean_counts'</span><span>, </span><span>'log1p_mean_counts'</span><span>, </span><span>'pct_dropout_by_counts'</span><span>, </span><span>'total_counts'</span><span>, </span><span>'log1p_total_counts'</span></span></code><code><span leaf=""><span>      uns:	</span><span>'doublets_markers_colors'</span></span></code><code><span leaf=""><span>      layers:	</span><span>'counts'</span></span></code></pre></section><section><ul><li></ul><pre data-lang="javascript"><code><span leaf=""><span>mdata.</span><span>write</span><span>(</span><span>"cite_doublet_removal_xdbt.h5mu"</span><span>)</span></span></code></pre></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/awT4YtdSXFqIJTpajWGmRQ",target="_blank" rel="noopener noreferrer">原文链接</a>
