---
title: "ROC曲线的最佳截断值（cutoff value）"
date: 2025-01-10T10:05:07Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
ROC曲线的最佳截断值（cutoff value） by 生信小博士
------
<div><p><span><strong><span>1. 为什么很多时候最佳截断值不是直接来自某个数据点？</span></strong></span></p><p><span>ROC 曲线的最佳截断值是通过综合模型的**灵敏度（Sensitivity）<strong>和</strong>特异度（Specificity）**的权衡来确定的，而不是简单地使用 </span><code><span>gene_expression</span></code><span> 的实际值。这是因为 <strong><code>coords()</code></strong> 函数默认会基于不同的阈值策略计算最佳截断值，而不仅仅是逐一使用所有的观测值作为阈值。具体来说：</span></p><ul><li><p><span>在 </span><code><span>coords(roc_obj, "best")</span></code><span> 中，R 默认通过<strong>Youden 指数</strong>来选择最佳截断值：<semantics><mrow><mtext></mtext></mrow></semantics></span></p><p><img data-galleryid="" data-imgfileid="100004833" data-ratio="0.09876543209876543" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp7fXSSGU5ia0qJTP7ibYoJoPGhN7xicTdDajsSnL4GibV3x5PEfVyO34cfNw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="405" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp7fXSSGU5ia0qJTP7ibYoJoPGhN7xicTdDajsSnL4GibV3x5PEfVyO34cfNw/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p></li><li><p><span>R 会尝试所有可能的阈值（包括数据点之间的连续值），找到让 Youden 指数最大的那个阈值。</span></p></li><li><p><span>这意味着最佳截断值不一定是直接等于某个样本的 </span><code><span>gene_expression</span></code><span> 值，而是可能落在数据点之间。</span></p><p><br></p></li></ul><h3><span><strong>2. 为什么 R 的截断值是 7.9？</strong></span></h3><p><span>让我们回顾数据：</span></p><section><ul><li><li><li></ul><pre data-lang="css"><code><span>groups &lt;- c(1, 0, 1, 0)</span></code><code><span>gene_expression &lt;- c(12.3, 5.6, 10.2, 4.7)</span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100004832" data-ratio="0.6879699248120301" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp7jjzvsIoNSG1sBJSck6djedNSfAuwOUjrqOGicEgZcgLHwEInTlO4RkQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="532" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp7jjzvsIoNSG1sBJSck6djedNSfAuwOUjrqOGicEgZcgLHwEInTlO4RkQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100004827" data-ratio="0.21448467966573817" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp7wmC5gVfy8HdkeZicnHAfjf1BK20clrNgWluxd3JGa4ULNpxlfpIdJtQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="718" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp7wmC5gVfy8HdkeZicnHAfjf1BK20clrNgWluxd3JGa4ULNpxlfpIdJtQ/640?wx_fmt=png&amp;from=appmsg"></p><h3><span><strong>3. 如何验证截断值的计算过程？</strong></span></h3><p><span>我们可以手动计算每个可能阈值下的灵敏度、特异度、Youden 指数，并比较结果。</span></p><p><img data-galleryid="" data-imgfileid="100004830" data-ratio="0.2731788079470199" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp772icp5XRCibjanvq83hW1gUYLWRKgErKLsBxFr0FFOYM8DCxaKy88zTA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="604" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp772icp5XRCibjanvq83hW1gUYLWRKgErKLsBxFr0FFOYM8DCxaKy88zTA/640?wx_fmt=png&amp;from=appmsg"></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="bash"><code><span>library(pROC)</span></code><code><span><br></span></code><code><span># 数据</span></code><code><span>groups &lt;- c(1, 0, 1, 0)</span></code><code><span>gene_expression &lt;- c(12.3, 5.6, 10.2, 4.7)</span></code><code><span><br></span></code><code><span># 生成 ROC 对象</span></code><code><span>roc_obj &lt;- roc(groups, gene_expression)</span></code><code><span><br></span></code><code><span># 获取所有阈值的指标</span></code><code><span>roc_coords &lt;- coords(</span></code><code><span>  roc_obj,</span></code><code><span>  x = "all",  # 所有阈值</span></code><code><span>  ret = c("threshold", "sensitivity", "specificity", "tpr", "fpr")</span></code><code><span>)</span></code><code><span><br></span></code><code><span># 手动计算 Youden 指数</span></code><code><span>roc_coords$youden &lt;- roc_coords$sensitivity + roc_coords$specificity - 1</span></code><code><span><br></span></code><code><span># 查看所有阈值及对应的 Youden 指数</span></code><code><span>print(roc_coords)</span></code><code><span><br></span></code><code><span># 找到最大 Youden 指数对应的阈值</span></code><code><span>best_cutoff_manual &lt;- roc_coords$threshold[which.max(roc_coords$youden)]</span></code><code><span>print(paste("手动计算的最佳截断值：", best_cutoff_manual))</span></code><code><span><br></span></code></pre></section><p><img data-galleryid="" data-imgfileid="100004828" data-ratio="0.6964856230031949" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp7ibxfaw2viagZ0TdIOfYnmFcDPJhA4aZv5v8h2jd7Kv3mOHpGg3fNibRxg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="626" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktT5xE4TlrqgV5M1iaQN0Dp7ibxfaw2viagZ0TdIOfYnmFcDPJhA4aZv5v8h2jd7Kv3mOHpGg3fNibRxg/640?wx_fmt=png&amp;from=appmsg"></p><h3><span><strong>4. R 中截断值的含义</strong></span></h3><p><span>在 R 中，</span><code><span>coords(roc_obj, "best")</span></code><span> 默认会选择：</span></p><ul><li><p><span>灵敏度和特异度的最佳平衡点（即最大 Youden 指数的点）。</span></p></li><li><p><span>如果多个点的 Youden 指数相同，R 可能会优先选择靠近数据点中间值的那个点。</span></p></li></ul><p><span>例如，假设 </span><code><span>gene_expression</span></code><span> 的最佳分类是通过 7.9 来分割：</span></p><ul><li><p><code><span>7.9</span></code><span> 比 5.6 更高，因此更多样本会被预测为阳性；</span></p></li><li><p><span>同时，它比 10.2 更低，因此不会漏掉所有阳性。</span></p></li></ul><p><br></p><p><span><strong><span>5. 实际分析中的解读</span></strong></span></p><p><strong><span>截断值为 7.9 的意义在于：</span></strong></p><ol><li><p><span>它是平衡<strong>发现阳性样本</strong>与<strong>避免误判阴性样本</strong>的一种最佳选择。</span></p></li><li><p><span>不同的应用场景下，可能会需要调整阈值。例如：</span></p></li></ol><ul><li><p><span>如果希望<strong>不漏掉任何阳性病例</strong>（如高危疾病），可能会降低阈值，增加灵敏度。</span></p></li></ul><ul><li><p><span>如果希望<strong>尽量避免误判健康人</strong>（如高成本或高心理负担的诊断），可能会提高阈值，增加特异度。</span></p><hr><p><br></p><p><br></p></li></ul><h3><span><strong>6. 小结</strong></span></h3><ol><li><p><span><strong>为什么截断值是 7.9？</strong></span></p></li></ol><ul><li><p><span>这是通过 ROC 曲线的 Youden 指数优化计算得出的，确保灵敏度和特异度的最佳平衡。</span></p></li><li><p><span>截断值不一定对应于原始数据中的某个点，而可能是数据点之间的中间值。</span></p></li></ul><li><p><span><strong>如何验证计算？</strong></span></p></li><ul><li><p><span>手动计算每个阈值的灵敏度、特异度和 Youden 指数，验证 R 自动输出的截断</span><span>值。</span></p></li></ul><li><p><span><strong>如何灵活调整？</strong></span></p></li><ul><li><p><span>如果您希望优先提高灵敏度或特异度，可以手动选择一个适合实际需求的阈值。</span></p><p><br></p><hr><p><strong></strong></p><p><strong><span>如何强制使用实际观测值作为阈值？</span></strong></p></li></ul><p><span>如果您希望只使用实际观测值作为候选阈值，可以在计算中显式指定阈值范围。修改代码如下：</span></p><section><ul><li><li><li><li></ul><pre data-lang="bash"><code><span># 指定只使用 gene_expression 的实际值作为候选阈值</span></code><code><span>roc_coords &lt;- coords(roc_obj, x = gene_expression, ret = c("threshold", "sensitivity", "specificity"))</span></code><code><span>print(roc_coords)</span></code><code><span>#此时，ROC 曲线的计算仅使用实际观测值，而不进行插值。</span></code></pre></section><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzg2NDcxMzYwNg==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345Sks7JhVxUX46ZKxPSob6ptqIZgnIEnHOn5VMwCX8sN6MQy1Pq4XXFEOJ6grAmsoQugyCDKOZictDBHA/0?wx_fmt=png" data-nickname="生信小博士" data-alias="bioinformatics_Dr" data-signature="【生物信息学】R语言开始，学习生信。Seurat，单细胞测序，空间转录组。 Python，scanpy，cell2location。资料分享" data-from="0" data-is_biz_ban="0" data-service_type="1"></mp-common-profile></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/i7zJLvUJreuNh7MSJceZ6Q",target="_blank" rel="noopener noreferrer">原文链接</a>
