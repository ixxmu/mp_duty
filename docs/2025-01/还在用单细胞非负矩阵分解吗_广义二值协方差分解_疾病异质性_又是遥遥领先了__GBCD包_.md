---
title: "还在用单细胞非负矩阵分解吗？广义二值协方差分解+疾病异质性，又是遥遥领先了！（GBCD包）"
date: 2025-01-03T14:55:46Z
draft: ["false"]
tags: [
  "fetched",
  "生信碱移"
]
categories: ["Acdemic"]
---
还在用单细胞非负矩阵分解吗？广义二值协方差分解+疾病异质性，又是遥遥领先了！（GBCD包） by 生信碱移
------
<div><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-imgfileid="100011717" data-ratio="1.0324675324675325" data-src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="154" src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p>老铁快点击蓝字 <strong>关注俺</strong></p></section></section></section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-imgfileid="100011719" data-ratio="1.0324675324675325" data-src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" data-type="gif" data-w="154" src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section></section></section></section></section></section></section></section><section powered-by="xiumi.us"><section data-mpa-powered-by="yiban.io" data-style='white-space: normal; max-width: 100%; letter-spacing: 0.544px; text-size-adjust: auto; background-color: rgb(255, 255, 255); font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;'><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)"><section data-style="margin-top: 2em; padding-top: 0.5em; padding-bottom: 0.5em; max-width: 100%; border-style: solid none; text-decoration: inherit; border-top-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-top-width: 1px; border-bottom-width: 1px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p><span>生信碱移</span></p><section><strong>GBCD算法工具</strong></section></section></section></section><blockquote data-type="2" data-url="" data-author-name="" data-content-utf8-length="68" data-source-title="" data-style='color: rgba(0, 0, 0, 0.498); white-space: normal; max-width: 100%; letter-spacing: 0.544px; font-family: -apple-system-font, system-ui, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif; background-color: rgb(255, 255, 255); box-sizing: border-box !important; overflow-wrap: break-word !important;'><section><span>无监督广义二元协方差分解，可以算的上是真正的单细胞患者异质性研究神器了。</span></section></blockquote></section><p data-tool="markdown.com.cn编辑器"><strong>单细胞RNA测序</strong>（scRNA-seq）技术在解析肿瘤转录异质性方面的分辨率远高于传统的群体转录组分析，为深入理解癌症生物学提供了新视角。<strong>通过分析转录变异模式，可识别</strong><span><strong><span>基因表达程序</span>（GEP）</strong></span><strong>，即一组具有协同转录变化的基因。</strong><strong>这些GEPs可能具有患者特异性，也可能在部分患者间共享。共享的GEPs通常与分子亚型或细胞状态相关，从而揭示疾病病因。</strong></p><p data-tool="markdown.com.cn编辑器"><strong>在单细胞领域，</strong><span><strong>降维分解</strong></span><strong>是绕不过的分析流程。</strong>其主要是指将高维基因表达汇总成一个个具有代表性的特征组分，比如最常见的主成分分析(PCA) 便是将基因表达矩阵分解成了一个个主成分以及相应的载荷矩阵 (表示基因对不同主成分的贡献)。<strong>小编先前分享了多篇基于降维分解的方法，比较有代表性的是①近期发表在 Nature Biotechnology 的<span>单细胞可解释张量分解算法 scITD</span>，以及②登上 Nature Protocols 的热门算法<span>贝叶斯非负矩阵分解 CoGAPS</span>，感兴趣的铁子可以点击下方相应链接学习。</strong></p><p><img data-imgfileid="100011722" data-ratio="0.6407407407407407" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeW47lknv3MvTh9y2icIeeicylosJic1wISIxiancqmTTw58bhRZScvWVahoBnfwoxjS1QicpUEPicCpfrFg/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeW47lknv3MvTh9y2icIeeicylosJic1wISIxiancqmTTw58bhRZScvWVahoBnfwoxjS1QicpUEPicCpfrFg/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><section><span><strong><span>▲</span> <span>图：scITD 的设计概述及功能演示</span></strong><span>。简单来讲，scITD针对每种细胞类型生成“供体×基因”的伪批量表达矩阵（这里的供体就是个体）。①这些矩阵通过细胞类型维度堆叠，形成一个三维张量（供体×基因×细胞类型）。②该张量在进一步分析之前会经过标准化、归一化和缩放等预处理步骤。③随后，作者使用Tucker张量分解将三维数据分解为几个因子矩阵（样本因子、基因因子、细胞类型因子）和一个核心张量。Tucker张量分解类似于PCA，但它是针对三维数据的。</span></span><span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247494562&amp;idx=1&amp;sn=20ab1c2c80cb7b5b2a8b49a0bb0a4b40&amp;scene=21#wechat_redirect" textvalue="点击此处跳转" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>点击此处跳转</strong></a></span></section><p><img data-imgfileid="100011725" data-ratio="0.5760517799352751" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/LvUIqvYKCeWpvb9yav65d6msLM3iaKDcNJeM6doicVR6qZ4Q5zuu8VbBGe9OlWswhebFAYtpkp9dB2rPpdOTPmrA/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-w="927" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/LvUIqvYKCeWpvb9yav65d6msLM3iaKDcNJeM6doicVR6qZ4Q5zuu8VbBGe9OlWswhebFAYtpkp9dB2rPpdOTPmrA/640?wx_fmt=other&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><p data-class="mbImgTitle"><span><strong><span>▲</span> </strong><strong><span>图：来自美国约翰霍普金斯大学的研究者分享的一套流程。</span></strong><span>介绍了贝叶斯NMF算法（CoGAPS），并演示了如何通过 CoGAPS 分析量化公共领域单细胞 RNA 测序数据中的细胞状态转换。</span></span><span><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247493838&amp;idx=1&amp;sn=2e1fe0adcd78f84b0c985c9e2343272f&amp;scene=21#wechat_redirect" textvalue="点击‍此处跳转" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>点击此处跳转</strong></a></span></p><p><strong>尽管前面已经开发了一些方法，但是在肿瘤学等疾病研究领域，由于</strong><span><strong>患者异质性</strong></span><strong>的存在，使得识别患者共享的基因表达程序GEPs仍然是一个非常大的挑战。<span></span></strong><span>比如，</span>在肿瘤当中，患者的异质性被称为肿瘤异质性。在包含多个肿瘤的 scRNA-seq 数据中，恶性细胞通常按患者聚类，而患者间的重叠很少。<strong>这种强烈的患者间异质性往往掩盖了肿瘤间共享的、更微妙但重要的异质性模式。</strong><strong>不仅如此，针对多个数据集的分析还面临着</strong><span><strong>批次效应</strong></span><strong>的问题，批次效应往往还与患者异质性</strong><span><strong>混淆</strong></span><strong>，大多算法甚至在批次矫正时会去除这些有意义的生物学信号。</strong></p><p>为此，来自芝加哥大学的研究者提出了一种<strong>基于矩阵分解的新方法 </strong><span><strong>GBCD</strong></span><strong> (广义二值协方差分解)</strong>，于2025年1月2号见刊于 <span><strong>Nature Genetics</strong></span> <span><strong>[IF:31.7]</strong></span>。<strong>作者的实验结果表明，GBCD 克服了现有方法的局限性，能够在强肿瘤间异质性下取得更具解释性的结果。</strong></p><section><img data-galleryid="" data-imgfileid="100011726" data-ratio="0.5861111111111111" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeVOibGUpnMdsnVxS6CU17EoJDZribv2YaI9MSxoYazpQsuGtbodaaIruEGQuCJcbjh2YwGw9xmBfMuQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeVOibGUpnMdsnVxS6CU17EoJDZribv2YaI9MSxoYazpQsuGtbodaaIruEGQuCJcbjh2YwGw9xmBfMuQ/640?wx_fmt=png&amp;from=appmsg"></section><section><span>▲ 在文章的演示中，GBCD能够在 HNSCC 数据中识别出与亚型相关的 GEPs，在 PDAC 数据中精细化临床亚型，并发现与应激响应通路相关的 GEP并独立预测较差生存率。DOI: 10.1038/s41588-024-01997-z。</span></section><p data-tool="markdown.com.cn编辑器"><strong>本文将简要介绍GBCD的</strong><span><strong>方法原理</strong></span><strong>以及</strong><span><strong>代码示例运行</strong></span><strong>，感兴趣的铁子可以查阅以下链接</strong>：</p><ul data-tool="markdown.com.cn编辑器"><li><section>https://github.com/stephenslab/gbcd</section></li></ul><h3 data-tool="markdown.com.cn编辑器"><span></span><span>GBCD 原理</span><span></span></h3><p data-tool="markdown.com.cn编辑器">GBCD是一个无监督方法，这意味着其并不会过于利用现有的样本标签，混淆样本批次或肿瘤异质性信息。简单来讲，GBCD 通过将单细胞基因表达矩阵分解为<span><strong>细胞与模式<span>的关联矩阵</span></strong></span>(模式特指前面所提到的基因表达程序GEP) 和<span><strong>基因与模式的贡献矩阵</strong></span>。其数学描述为：</p><span data-tool="markdown.com.cn编辑器"><section data-formula="Y_{ij} \approx L_{ik} \cdot F_{jk}" data-formula-type="block-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 6017.4 977.2" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44C" d="M66 637Q54 637 49 637T39 638T32 641T30 647T33 664T42 682Q44 683 56 683Q104 680 165 680Q288 680 306 683H316Q322 677 322 674T320 656Q316 643 310 637H298Q242 637 242 624Q242 619 292 477T343 333L346 336Q350 340 358 349T379 373T411 410T454 461Q546 568 561 587T577 618Q577 634 545 637Q528 637 528 647Q528 649 530 661Q533 676 535 679T549 683Q551 683 578 682T657 680Q684 680 713 681T746 682Q763 682 763 673Q763 669 760 657T755 643Q753 637 734 637Q662 632 617 587Q608 578 477 424L348 273L322 169Q295 62 295 57Q295 46 363 46Q379 46 384 45T390 35Q390 33 388 23Q384 6 382 4T366 1Q361 1 324 1T232 2Q170 2 138 2T102 1Q84 1 84 9Q84 14 87 24Q88 27 89 30T90 35T91 39T93 42T96 44T101 45T107 45T116 46T129 46Q168 47 180 50T198 63Q201 68 227 171L252 274L129 623Q128 624 127 625T125 627T122 629T118 631T113 633T105 634T96 635T83 636T66 637Z"></path></g><g data-mml-node="TeXAtom" transform="translate(614,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(345,0)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path></g></g></g><g data-mml-node="mo" transform="translate(1477.1,0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="msub" transform="translate(2532.8,0)"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g><g data-mml-node="TeXAtom" transform="translate(714,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(345,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="mo" transform="translate(4131.4,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="msub" transform="translate(4631.6,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path></g><g data-mml-node="mi" transform="translate(412,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></g></svg></section></span><p data-tool="markdown.com.cn编辑器"><strong>上面公式非常简练</strong>：</p><ul data-tool="markdown.com.cn编辑器"><li><section><span><span data-formula="Y_{ij}" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 1199.3 977.2" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44C" d="M66 637Q54 637 49 637T39 638T32 641T30 647T33 664T42 682Q44 683 56 683Q104 680 165 680Q288 680 306 683H316Q322 677 322 674T320 656Q316 643 310 637H298Q242 637 242 624Q242 619 292 477T343 333L346 336Q350 340 358 349T379 373T411 410T454 461Q546 568 561 587T577 618Q577 634 545 637Q528 637 528 647Q528 649 530 661Q533 676 535 679T549 683Q551 683 578 682T657 680Q684 680 713 681T746 682Q763 682 763 673Q763 669 760 657T755 643Q753 637 734 637Q662 632 617 587Q608 578 477 424L348 273L322 169Q295 62 295 57Q295 46 363 46Q379 46 384 45T390 35Q390 33 388 23Q384 6 382 4T366 1Q361 1 324 1T232 2Q170 2 138 2T102 1Q84 1 84 9Q84 14 87 24Q88 27 89 30T90 35T91 39T93 42T96 44T101 45T107 45T116 46T129 46Q168 47 180 50T198 63Q201 68 227 171L252 274L129 623Q128 624 127 625T125 627T122 629T118 631T113 633T105 634T96 635T83 636T66 637Z"></path></g><g data-mml-node="TeXAtom" transform="translate(614,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(345,0)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path></g></g></g></g></g></svg></span></span> 是输入的单细胞基因表达矩阵，共有 <span><span data-formula="i" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -661 345 672" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></svg></span></span> 个细胞，<span><span data-formula="j" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -661 412 865" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path></g></g></g></svg></span></span> 个基因；</section></li><li><section><span><span data-formula="L" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 681 683" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g></g></g></svg></span></span> 是 <span><span data-formula="i" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -661 345 672" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></svg></span></span> 个细胞与模式 (共 <span><span data-formula="k" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -694 521 705" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></svg></span></span> 个) 的关联矩阵，其数值范围限定接近于0或1，意味着特定基因表达程序是否在特定细胞表达；</section></li><li><section><span><span data-formula="F" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -680 749 680" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g></g></g></svg></span></span> 是基因 (共 <span><span data-formula="j" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -661 412 865" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path></g></g></g></svg></span></span> 个) 与模式的权重矩阵，意味着基因对特定基因表达程序的贡献。</section></li></ul><p data-tool="markdown.com.cn编辑器">"<span><span data-formula="\approx" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -483 778 428" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g></g></g></svg></span></span>" 指代该分解是一个<strong>优化问题</strong>，其主要基于近似二值化和正交性的两个假设来优化矩阵分解结果：</p><ul data-tool="markdown.com.cn编辑器"><li><section><strong><span>① 二值化假设</span></strong><strong>：</strong><span><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 681 683" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g></g></g></svg></span> 数值范围限定接近于0或1，其目标是捕捉任何的离散结构，例如患者效应或肿瘤亚型。这种假设被作者称为<span><strong>广义二值假设</strong></span>（Generalized Binary Assumption）。</section></li><li><section><strong>② 正交性假设：</strong>限制 <span><span data-formula="F" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -680 749 680" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g></g></g></svg></span></span> 的列彼此正交 (正交其实是一个常见的数学名词，不同的铁子可以自行谷歌)，简单来说就是确保不同的模式不会混在一起。</section></li></ul><p data-tool="markdown.com.cn编辑器">小编给没听懂的同学总结一下，通过 GBCD 我们最终可以获得<span><strong>细胞与模式关联矩阵</strong></span> <span><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 681 683" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g></g></g></svg></span> 、<span><strong>基</strong><strong>因与模式的关联矩阵</strong></span> <span><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -680 749 680" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g></g></g></svg></span> ，<span><strong>前者</strong></span><span><strong>可以用于确定细胞属于哪些特定模式 (区分不同细胞群体以及细胞亚型)，</strong></span><span><strong>后者</strong></span><span><strong>可以用于确定哪些基因在特定生物学模式中上调或下调</strong></span></p><h3 data-tool="markdown.com.cn编辑器"><span></span><span>GBCD 示例运行</span><span></span></h3><p data-tool="markdown.com.cn编辑器"><strong>代码运行讲解可以分为以下六个步骤</strong>：<br></p><p data-tool="markdown.com.cn编辑器"><strong>①</strong> <code>GBCD</code>基于R编程语言实现，可以通过以下代码安装：</p><pre data-tool="markdown.com.cn编辑器"><span></span><code><span># install.packages("remotes")</span><br>remotes::install_github(<span>"stephenslab/gbcd"</span>)<br></code></pre><p data-tool="markdown.com.cn编辑器">运行示例还需要一些其它的R包，可以一起引用 (没有引用的话需要安装)：</p><pre data-tool="markdown.com.cn编辑器"><span></span><code><span>library</span>(Matrix)<br><span>library</span>(ggplot2)<br><span>library</span>(cowplot)<br><span>library</span>(ggrepel)<br><span>library</span>(pheatmap)<br><span>library</span>(Rtsne)<br><span>library</span>(flashier)<br><span>library</span>(gbcd)<br><span>#</span><br><span>library</span>(GBCD)<br></code></pre><section><strong>② 内置数据集介绍</strong>：来源于头颈癌（HNSCC）患者的基因表达数据，包含了 2176 个恶性细胞，<code>hnscc$info</code>为细胞注释信息，其中：</section><ul data-tool="markdown.com.cn编辑器"><li><section><code>subtype</code>列：代表预先知道的每个细胞的亚型</section></li><li><section><code>sample</code>列：代表相应的样本</section></li><li><p><code>cell.type</code>列：代表相应的细胞注释</p></li></ul><pre data-tool="markdown.com.cn编辑器"><span></span><code>data(hnscc)<br>dim(hnscc$Y)<br>head(hnscc$info)<br><span># [1]  2176 17113</span><br><span>#                                             cell.id lymph.node cancer.cell</span><br><span># HN26_P14_D11_S239_comb       HN26_P14_D11_S239_comb          1           1</span><br><span># HN26_P25_H09_S189_comb       HN26_P25_H09_S189_comb          1           1</span><br><span># HN26_P14_H06_S282_comb       HN26_P14_H06_S282_comb          1           1</span><br><span># HN25_P25_C04_S316_comb       HN25_P25_C04_S316_comb          1           1</span><br><span># HN26_P25_C09_S129_comb       HN26_P25_C09_S129_comb          1           1</span><br><span># HNSCC26_P24_H05_S377_comb HNSCC26_P24_H05_S377_comb          1           1</span><br><span>#                           cell.type patient.id    sample  subtype</span><br><span># HN26_P14_D11_S239_comb            0        T26 MEEI26_LN Atypical</span><br><span># HN26_P25_H09_S189_comb            0        T26 MEEI26_LN Atypical</span><br><span># HN26_P14_H06_S282_comb            0        T26 MEEI26_LN Atypical</span><br><span># HN25_P25_C04_S316_comb            0        T25 MEEI25_LN    Basal</span><br><span># HN26_P25_C09_S129_comb            0        T26 MEEI26_LN Atypical</span><br><span># HNSCC26_P24_H05_S377_comb         0        T26 MEEI26_LN Atypical</span><br></code></pre><section><strong>③ 可视化HNSCC数据集</strong>，可以发现存在明显的肿瘤异质性或者是批次效应：</section><pre data-tool="markdown.com.cn编辑器"><span></span><code>set.seed(1)<br>cols &lt;- order(apply(hnscc$Y,2,sd),decreasing = TRUE)<br>cols &lt;- cols[1:3000]<br>res  &lt;- Rtsne(as.matrix(hnscc$Y[,cols]),normalize = TRUE)<br>colnames(res$Y) &lt;- c("tsne1","tsne2")<br>pdat &lt;- cbind(res$Y,hnscc$info)<br>ggplot(pdat,aes(x = tsne1,y = tsne2,color = sample,shape = subtype)) +<br>  geom_point(size = 1) + scale_color_manual(values = hnscc$sample_col) +<br>  scale_shape_manual(values = c(15,16,18)) +<br>  theme_cowplot(font_size = 10)<br></code></pre><section><img data-galleryid="" data-imgfileid="100011727" data-ratio="0.7648148148148148" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeVOibGUpnMdsnVxS6CU17EoJdlPzpfVvXXmibibMKGgM73SibtLTHX5lDsWHsaespf2OcUKCcTwhHI2pA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeVOibGUpnMdsnVxS6CU17EoJdlPzpfVvXXmibibMKGgM73SibtLTHX5lDsWHsaespf2OcUKCcTwhHI2pA/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器">如上图所示，细胞间存在强烈的肿瘤间异质性。图中显示出典型样本分群，即细胞的 t-SNE 可视化的主要结构是按患者聚类。</p><p data-tool="markdown.com.cn编辑器"><strong>④ 使用</strong><code>fit_gbcd</code><strong>函数进行GBCD分析：</strong></p><pre data-tool="markdown.com.cn编辑器"><span></span><code>res.gbcd &lt;- fit_gbcd(Y = hnscc$Y, Kmax = <span>12</span>, maxiter1 = <span>100</span>,<br>                     maxiter2 = <span>50</span>, maxiter3 = <span>50</span>, <br>                     prior = flash_ebnm(prior_family = <span>"generalized_binary"</span>,<br>                                        scale = <span>0.04</span>))<br><span># [1] "Form cell by cell covariance matrix..."</span><br><span>#    user  system elapsed </span><br><span>#  15.207   0.072  16.125 </span><br><span># [1] "Initialize GEP membership matrix L..."</span><br><span># Adding factor 1 to flash object...</span><br><span># Wrapping up...</span><br><span># Done.</span><br><span># Adding factor 2 to flash object...</span><br><span># Adding factor 3 to flash object...</span><br><span># Adding factor 4 to flash object...</span><br><span># Adding factor 5 to flash object...</span><br><span># Adding factor 6 to flash object...</span><br><span># Adding factor 7 to flash object...</span><br><span># Adding factor 8 to flash object...</span><br><span># Adding factor 9 to flash object...</span><br><span># Adding factor 10 to flash object...</span><br><span># Adding factor 11 to flash object...</span><br><span># Adding factor 12 to flash object...</span><br><span># Wrapping up...</span><br><span># Done.</span><br><span># Backfitting 12 factors (tolerance: 7.06e-02)...</span><br><span>#   Difference between iterations is within 1.0e+04...</span><br><span>#   Difference between iterations is within 1.0e+03...</span><br><span>#   Difference between iterations is within 1.0e+02...</span><br><span>#   --Maximum number of iterations reached!</span><br><span># Wrapping up...</span><br><span># Done.</span><br><span># Backfitting 12 factors (tolerance: 7.06e-02)...</span><br><span>#   Difference between iterations is within 1.0e+04...</span><br><span>#   Difference between iterations is within 1.0e+03...</span><br><span>#   Difference between iterations is within 1.0e+02...</span><br><span>#   Difference between iterations is within 1.0e+01...</span><br><span>#   --Maximum number of iterations reached!</span><br><span># Wrapping up...</span><br><span># Done.</span><br><span>#    user  system elapsed </span><br><span>#  35.554   2.770  39.815 </span><br><span># [1] "Estimate GEP membership matrix L..."</span><br><span># Backfitting 23 factors (tolerance: 7.06e-02)...</span><br><span>#   Difference between iterations is within 1.0e+05...</span><br><span>#   Difference between iterations is within 1.0e+04...</span><br><span>#   Difference between iterations is within 1.0e+03...</span><br><span>#   --Maximum number of iterations reached!</span><br><span># Wrapping up...</span><br><span># Done.</span><br><span># Backfitting 23 factors (tolerance: 7.06e-02)...</span><br><span>#   Difference between iterations is within 1.0e+03...</span><br><span>#   Difference between iterations is within 1.0e+02...</span><br><span>#   --Maximum number of iterations reached!</span><br><span># Wrapping up...</span><br><span># Done.</span><br><span>#    user  system elapsed </span><br><span>#  64.059   3.096  67.728 </span><br><span># [1] "Estimate GEP signature matrix F..."</span><br><span># Backfitting 23 factors (tolerance: 5.55e-01)...</span><br><span>#   Difference between iterations is within 1.0e+03...</span><br><span>#   Difference between iterations is within 1.0e+02...</span><br><span>#   --Maximum number of iterations reached!</span><br><span># Wrapping up...</span><br><span># Done.</span><br><span>#    user  system elapsed </span><br><span># 314.585  13.651 331.738</span><br></code></pre><p data-tool="markdown.com.cn编辑器"><strong>需要注意的是该函数的参数设置：</strong></p><ul data-tool="markdown.com.cn编辑器"><li><section><code>Kmax</code>：模式数量的上限，上一个原理处所提到的<code>k</code>。需要注意，设置的 Kmax 只是初始化的目的，最终 GEP 数量通常接近但不一定等于 (并且可能大于) Kmax。<strong>根据作者的经验，Kmax 在 10 到 40 之间通常效果良好。</strong></section></li><li><section><code>scale</code>：每个条目分配的广义二进制先验，默认是0.04。一般来说，<strong>对于包含更多细胞的大型数据集，较小的比率是推荐的</strong>，0.01 到 0.1 之间的值通常效果很好。</section></li><li><section><code>prior</code>：用于为GEP指定其他非负先验，例如，用户可以通过在调用fit_gbcd时设置<code>prior = ebnm_point_exponential</code>来指定点指数先验。但是，作者的经验表明，GB先验通常在解析多个样本和/或研究中的肿瘤转录异质性方面表现最佳。</section></li><li><section>此外，可以看到这个方法不需要提供细胞的患者/数据集身份信息，纯纯的非监督方法。</section></li></ul><p data-tool="markdown.com.cn编辑器"><strong>⑤ 细胞与模式关联得分矩阵 <span><span data-formula="L" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -683 681 683" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g></g></g></svg></span></span> 的可视化</strong>（只是小编的称呼，英文为GEP membership estimates）。通过<code>$L</code>提取，可以看到其是不同的基因表达模式GEP在细胞中的得分 (如前所述 0-1 范围)。</p><pre data-tool="markdown.com.cn编辑器"><span></span><code>head(round(res.gbcd$L, <span>3</span>))<br><span>#                           Baseline GEP1  GEP2  GEP3  GEP4  GEP5  GEP6  GEP7</span><br><span># HN26_P14_D11_S239_comb       0.735    0 0.000 0.895 0.354 0.000 0.000 0.573</span><br><span># HN26_P25_H09_S189_comb       0.657    0 0.141 0.776 0.000 0.479 0.000 0.617</span><br><span># HN26_P14_H06_S282_comb       0.791    0 0.244 0.710 0.606 0.000 0.000 0.713</span><br><span># HN25_P25_C04_S316_comb       0.412    0 0.661 0.212 0.000 0.649 0.000 0.000</span><br><span># HN26_P25_C09_S129_comb       0.645    0 0.000 0.743 0.000 0.382 0.000 0.733</span><br><span># HNSCC26_P24_H05_S377_comb    0.586    0 0.000 0.739 0.000 0.405 0.345 0.696</span><br><span>#                           GEP8  GEP9 GEP10 GEP11 GEP12 GEP13 GEP14 GEP15 GEP16</span><br><span># HN26_P14_D11_S239_comb       0 0.000 0.664     0     0 0.437 0.000 0.000 0.000</span><br><span># HN26_P25_H09_S189_comb       0 0.000 0.000     0     0 0.471 0.000 0.591 0.000</span><br><span># HN26_P14_H06_S282_comb       0 0.000 0.000     0     0 0.452 0.000 0.000 0.585</span><br><span># HN25_P25_C04_S316_comb       0 0.695 0.672     0     0 0.606 0.793 0.670 0.000</span><br><span># HN26_P25_C09_S129_comb       0 0.000 0.000     0     0 0.000 0.000 0.748 0.000</span><br><span># HNSCC26_P24_H05_S377_comb    0 0.000 0.000     0     0 0.000 0.461 0.586 0.000</span><br><span>#                           GEP17 GEP18 GEP19 GEP20</span><br><span># HN26_P14_D11_S239_comb        0  0.00     0     0</span><br><span># HN26_P25_H09_S189_comb        0  0.00     0     0</span><br><span># HN26_P14_H06_S282_comb        0  0.36     0     0</span><br><span># HN25_P25_C04_S316_comb        0  0.00     0     0</span><br><span># HN26_P25_C09_S129_comb        0  0.00     0     0</span><br><span># HNSCC26_P24_H05_S377_comb     0  0.00     0     0</span><br></code></pre><p><strong>用热图可视化看看呢</strong>：</p><pre data-tool="markdown.com.cn编辑器"><span></span><code><span># 创建注释信息</span><br>anno &lt;- data.frame(sample = hnscc$info$sample, subtype = hnscc$info$subtype)<br>rownames(anno) &lt;- rownames(res.gbcd$L)<br>anno_colors &lt;- list(sample = hnscc$sample_col, subtype = hnscc$subtype_col)<br>cols &lt;- colorRampPalette(c(<span>"gray96"</span>, <span>"red"</span>))(<span>50</span>)<br>brks &lt;- seq(<span>0</span>, <span>1</span>, <span>0.02</span>)<br><br><span># 可视化</span><br>pheatmap(res.gbcd$L[order(anno$sample), -c(<span>1</span>)], cluster_rows = <span>FALSE</span>,<br>         cluster_cols = <span>FALSE</span>, show_rownames = <span>FALSE</span>, annotation_row = anno,<br>         annotation_colors = anno_colors, annotation_names_row = <span>FALSE</span>,<br>         angle_col = <span>45</span>, fontsize = <span>9</span>, color = cols, breaks = brks,<br>         main = <span>""</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100011728" data-ratio="0.7935185185185185" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeVOibGUpnMdsnVxS6CU17EoJN096mAJ42oc75RCuEBKeicjGPj4lq9aqlQucGbY7qr2PVIqJIU4DksQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeVOibGUpnMdsnVxS6CU17EoJN096mAJ42oc75RCuEBKeicjGPj4lq9aqlQucGbY7qr2PVIqJIU4DksQ/640?wx_fmt=png&amp;from=appmsg"></p><p data-class="mbImgTitle"><span>▲ 热图显示了 2,176 个细胞（行）的模式得分关系。细胞按照肿瘤分子亚型从上到下排列，并按原患者来源排列。得分针对每个 GEP 分别重新缩放，使得每个 GEP 的最大得分始终为 1。</span></p><p data-tool="markdown.com.cn编辑器">从上述热图中，<strong>①</strong>首先我们可以看到GEPs 1-3与之前定义的分子亚型高度一致：GEP1主要在2例经典患者 (Classical) 的细胞中活跃；GEP2主要在7例基底细胞患者 (Basal) 的细胞中活跃；而GEP3主要在1例非典型 (Atypical) 患者的细胞中活跃。<strong>这表明 GBCD 可以从单细胞数据中独立提取分子亚型信息</strong>；<strong>②</strong>在其他 GEPs 中，有些主要在个别患者中活跃，因此可以解释为患者特异性 GEPs，如 GEPs 8、9 和 11；其他 GEPs 则在不同患者之间共享，但不对应于分子亚型。每个 GEP 的患者特异性与共享表达程度可以通过<code>gep_annotation</code>函数量化。<strong>效果还是很牛的，要知道这可是无监督的方法！</strong></p><p data-tool="markdown.com.cn编辑器"><strong>⑥ 基因与模式关联得分矩阵 <span><span data-formula="F" data-formula-type="inline-equation"><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -680 749 680" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g></g></g></svg></span></span> 的可视化</strong>（只是小编的称呼，英文为GEP signature estimates ）。通过<code>$F$lfc</code>提取，可以看到其是不同的基因对于基因表达模式GEP的得分。每个条目大约表示为属于特定 GEP 相关的对数折叠变化（以 2 为底）。</p><pre data-tool="markdown.com.cn编辑器"><span></span><code>head(round(res.gbcd$<span>F</span>$lfc, <span>3</span>))<br><span>#              Baseline   GEP1   GEP2   GEP3   GEP4   GEP5   GEP6   GEP7   GEP8</span><br><span># C9orf152        0.000  0.064  0.000  0.004  0.000  0.003  0.000  0.000  0.000</span><br><span># ELMO2           2.056  0.000 -0.466  0.715  0.003 -0.273 -0.065  0.015 -0.051</span><br><span># PNMA1           1.933  0.003 -1.326  0.035 -0.002  0.019 -0.043 -0.019 -0.018</span><br><span># MMP2            0.763 -0.468  2.441 -0.897 -0.005  0.786 -0.597 -0.004 -1.206</span><br><span># TMEM216         2.141  1.046 -0.652  0.021  0.006 -0.012 -0.115 -0.021 -0.002</span><br><span># TRAF3IP2-AS1    0.216  0.293  0.000  0.588  0.001  0.132  0.000  0.003  0.000</span><br><span>#               GEP9  GEP10  GEP11  GEP12 GEP13  GEP14  GEP15  GEP16  GEP17</span><br><span># C9orf152     0.000 -0.003 -0.004  0.000 0.002  0.084  0.000  0.000  0.000</span><br><span># ELMO2        0.081  0.005 -0.764 -0.036 0.348 -0.352 -0.566 -0.019 -0.003</span><br><span># PNMA1        2.154  0.065 -0.017  0.339 0.731  0.012 -0.048  0.014 -0.002</span><br><span># MMP2         0.051 -0.031  0.026 -0.867 0.800  0.348 -0.508  0.035 -0.297</span><br><span># TMEM216      1.137 -0.088 -0.401 -0.262 0.189 -0.605 -0.013 -0.429 -0.055</span><br><span># TRAF3IP2-AS1 0.005  0.013  0.011 -0.004 0.025  0.449 -0.002  0.019 -0.001</span><br><span>#               GEP18  GEP19  GEP20</span><br><span># C9orf152      0.014 -0.001  0.000</span><br><span># ELMO2        -0.104  0.060  0.019</span><br><span># PNMA1        -0.007 -0.008  0.022</span><br><span># MMP2         -1.498 -0.020  3.791</span><br><span># TMEM216      -0.037 -0.012  0.029</span><br><span># TRAF3IP2-AS1 -0.002  0.042 -0.001</span><br></code></pre><section><strong>用火山图可视化呢，以GEP2这个基因表达模式为例：</strong></section><pre data-tool="markdown.com.cn编辑器"><span></span><code><span># 可以看到，下面利用了 fit_gbcd 调用输出的后验统计量，包括 z 分数和局部假阳性率（lfsr）</span><br>pdat &lt;- data.frame(gene = rownames(res.gbcd$<span>F</span>$lfc), <br>                   lfc = res.gbcd$<span>F</span>$lfc[, <span>"GEP2"</span>], <br>                   z = abs(res.gbcd$<span>F</span>$z_score[, <span>"GEP2"</span>]), <br>                   lfsr = res.gbcd$<span>F</span>$lfsr[, <span>"GEP2"</span>],<br>                   stringsAsFactors = <span>FALSE</span>)<br>pdat &lt;- transform(pdat, lfsr = cut(lfsr, c(-<span>1</span>, <span>0.001</span>, <span>0.01</span>, <span>0.05</span>, <span>Inf</span>)))<br>rows  &lt;- with(pdat, which(!(abs(lfc) &gt; quantile(abs(lfc), <span>0.998</span>) | (z &gt; <span>10</span>))))<br>pdat[rows, <span>"gene"</span>] &lt;- <span>""</span><br>ggplot(pdat, aes(x = lfc, y = z, color = lfsr, label = gene)) + geom_point() + <br>  geom_text_repel(color = <span>"black"</span>, size = <span>2.5</span>, segment.color = <span>"black"</span>,<br>                  segment.size = <span>0.25</span>, min.segment.length = <span>0</span>,<br>                  max.overlaps = <span>Inf</span>, na.rm = <span>TRUE</span>) +<br>  scale_color_manual(values = c(<span>"coral"</span>, <span>"orange"</span>, <span>"gold"</span>, <span>"deepskyblue"</span>)) +<br>  labs(x = <span>"log-fold change"</span>, y = <span>"|posterior z-score|"</span>) + <br>  guides(colour = guide_legend(override.aes = list(size = <span>2</span>))) + <br>  theme(plot.title      = element_text(hjust = <span>0.5</span>,size = <span>12</span>),<br>        axis.text       = element_text(size = <span>10</span>),<br>        axis.title      = element_text(size = <span>10</span>),<br>        legend.title    = element_text(size = <span>12</span>),<br>        legend.text     = element_text(size = <span>10</span>),<br>        legend.position = <span>"bottom"</span>) +<br>  ggtitle(<span>"Volcano plot of gene signature for GEP2"</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100011729" data-ratio="0.8231481481481482" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeVOibGUpnMdsnVxS6CU17EoJgw0QB4jB5CGO59ITuNGJyIibXStWkH4Mpux5tYltLpqXgJtcg9ick6hA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeVOibGUpnMdsnVxS6CU17EoJgw0QB4jB5CGO59ITuNGJyIibXStWkH4Mpux5tYltLpqXgJtcg9ick6hA/640?wx_fmt=png&amp;from=appmsg"></p><section><span>▲ 上图可</span><span>以理解为每个基因的贡献，使用这个结果也可以对不同的基因表达模式得分计算相应的GSEA通路富集指标奥。</span></section><section><span><strong><span><span><strong><span>真是江山更有才人出啊</span></strong></span></span></strong></span></section><p><strong><span>好好学习学习<br></span></strong></p><p><strong><span><strong><span><span><strong><span>今天就分享到这里了 </span></strong><strong><span><img data-ratio="1" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Yellowdog.png" data-w="128" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Yellowdog.png"></span></strong></span></span></strong></span></strong></p><p><strong><span>欢迎点击下方标签关注</span></strong></p><section><mp-common-profile data-id="MzkyNTIzMzYyMA==" data-pluginname="mpprofile" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/LvUIqvYKCeXYZNMxRMnjiaicO2a27jDZ2FgQga8TdeQcsGRJRIn2IInkKtfcbbMXOBSViaPXpTOBulUlNzd11pzow/0?wx_fmt=png" data-nickname="生信碱移" data-alias="liudoufu307" data-signature="春来秋至，分享我的所见与所识" data-from="2" data-weuitheme="light"></mp-common-profile></section><section><br></section><section><strong><span>END~</span></strong><br></section><p><span><strong>仅供粉丝老铁们参考</strong></span></p><p><strong>如有侵权或错误，请联系删除改正～</strong></p><p><br></p><section data-class="_mbEditor" data-id="32689"><section><section><section><p><span><strong mpa-from-tpl="t">推荐好文，点击查看:</strong></span></p><p><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247495344&amp;idx=1&amp;sn=5025a08562c7f85e4ccfd24dee439843&amp;scene=21#wechat_redirect" textvalue="【教程】一文读懂孟德尔‍随机化！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">【教程】2024 必学生信工具！从单细胞测序到深度学习一网打尽，最新前沿动态总结！</a><br></p><p><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247495158&amp;idx=1&amp;sn=de1ba806767441a24543e5c6650bbd26&amp;scene=21#wechat_redirect" textvalue="【工具】NBT: 单细胞可解‍释张量分解算法sclTD！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span>【工具】miRTalk：使用单细胞测序数据推测外囊泡来源 miRNA 介导的细胞通讯网络！</span></a></p><p><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247495064&amp;idx=1&amp;sn=4bd28bc44e8fe2e534c5de9d3aba2489&amp;scene=21#wechat_redirect" textvalue="【文献】这篇顶刊纯生信领‍先常规生信分析一个版本！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">【文献】</a><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247495064&amp;idx=1&amp;sn=4bd28bc44e8fe2e534c5de9d3aba2489&amp;scene=21#wechat_redirect" textvalue="【文献】这篇顶刊纯生信领‍先常规生信分析一个版本！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"></a><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247495064&amp;idx=1&amp;sn=4bd28bc44e8fe2e534c5de9d3aba2489&amp;scene=21#wechat_redirect" textvalue="【文献】这篇顶刊纯生信领‍先常规生信分析一个版本！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">纯数据库泛癌队列+集成变分自编码器，把你的 PCA 换成这个深度学习架构试试！</a></p><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247494231&amp;idx=2&amp;sn=b3fb91ed7fa5d5775e16422cd502b0e8&amp;chksm=c1cb12ecf6bc9bfab457e75d1deb37045c9a86e9609e87f3707c38d9dd3083eefcf47689699b&amp;scene=21#wechat_redirect" textvalue="【期刊】无版面费低分 SCI 期刊，近期发表多篇纯网药‍研究！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1"><span>【期刊】无版面费低分 SCI 期刊，近期发表多篇纯网药研究！</span></a><span></span></p></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/PXSfdlt1TAjsmyNEYj1oTw",target="_blank" rel="noopener noreferrer">原文链接</a>
