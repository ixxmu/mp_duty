---
title: "在什么情况下癌症样本与正常样本是分不开的呢？"
date: 2025-01-03T03:05:06Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
在什么情况下癌症样本与正常样本是分不开的呢？ by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h3 data-tool="mdnice编辑器"><span>在老板给出的100个GEO芯片数据分析中，我们前面已经介绍过四个有意思的数据集了，大家可以先去读一下，详见：</span><span></span></h3><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247535869&amp;idx=1&amp;sn=24de831c07fa9fabc9772e0a6fd0873e&amp;scene=21#wechat_redirect" data-linktype="2">正常组织与癌旁组织可以一视同仁吗？</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247535787&amp;idx=1&amp;sn=e53c68f76fe89c9ab47a2aeb9745ee40&amp;scene=21#wechat_redirect" data-linktype="2">2万个基因少一半也不影响最后的差异分析富集结果啊？</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247535946&amp;idx=1&amp;sn=c35fc3f49981b80da379da6102a09b74&amp;scene=21#wechat_redirect" data-linktype="2">火山图展示差异分析上下调基因数量，不平衡无处不在吗？</a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247536076&amp;idx=1&amp;sn=72d6ccfa884c8ae6b6020d0f8e936c40&amp;scene=21#wechat_redirect" data-linktype="2">花了10多万的队列就只为了这一张图吗？</a></section></li></ul><p data-tool="mdnice编辑器">今天遇到的数据集合为：<span>https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE54236</span>，数据情况如下：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100052514" data-ratio="0.5946601941747572" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1Lr3k63ib2ZKOy8c5rPaib9ibo7tBoH1LN8zibc6gmezriaZW50giaoen6h3TSg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="824" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1Lr3k63ib2ZKOy8c5rPaib9ibo7tBoH1LN8zibc6gmezriaZW50giaoen6h3TSg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span>首先还是标准的芯片数据分析得到表达矩阵：<span></span></h3><pre data-tool="mdnice编辑器"><code><span>## 魔幻操作，一键清空~</span><br>rm(list = ls())<br>library(AnnoProbe)<br>library(GEOquery)<br>library(ggplot2)<br>library(ggstatsplot)<br>library(patchwork)<br>library(reshape2)<br>library(stringr)<br>library(limma)<br>library(tidyverse)<br>getOption(<span>'timeout'</span>)<br>options(timeout=10000)<br><br><span>## 获取并且检查表达量矩阵</span><br><span>## ～～～gse编号需修改～～～</span><br>gse_number &lt;- <span>"GSE54236"</span><br>dir.create(gse_number)<br>setwd(gse_number)<br>getwd()<br>list.files() <br><br><span>#gset &lt;- geoChina(gse_number)</span><br>gset &lt;- getGEO(gse_number, destdir = <span>'.'</span>, getGPL = T)<br>gset[[1]]<br><br>a &lt;- gset[[1]]<br>dat &lt;- exprs(a) <span># a现在是一个对象，取a这个对象通过看说明书知道要用exprs这个函数</span><br>dim(dat)        <span># 看一下dat这个矩阵的维度</span><br>dat[1:4,1:4]    <span># 查看dat这个矩阵的1至4行和1至4列，逗号前为行，逗号后为列</span><br>range(dat)<br>table(is.na(dat))<br><span>#dat[is.na(dat)] &lt;- 0</span><br>dat &lt;- na.omit(dat)<br>range(dat)<br>dim(dat)<br><br><span>## 根据生物学背景及研究目的人为分组</span><br><span>## 通过查看说明书知道取对象a里的临床信息用pData</span><br><span>## 挑选一些感兴趣的临床表型。</span><br>pd &lt;- pData(a)<br>colnames(pd)<br>pd<span>$title</span><br>pd<span>$characteristics_ch1</span><br>table(pd<span>$characteristics_ch1</span>)<br><br><span>## ～～～分组信息编号需修改～～～</span><br>group_list &lt;- ifelse(grepl(<span>'Non tumor'</span>,pd<span>$title</span> ,ignore.case = T ), <span>"control"</span>,<span>"case"</span>)<br>group_list &lt;- factor(group_list, levels = c(<span>"control"</span>,<span>"case"</span>))<br>table(group_list)<br><br><span>## 查看注释平台gpl 获取芯片注释信息</span><br>a<br>a@annotation<br>gpl &lt;- getGEO(filename=paste0(a@annotation,<span>".soft.gz"</span>))<br>class(gpl)<br>gpl_anno &lt;- gpl@dataTable@table<br>colnames(gpl_anno)<br><br>id2name &lt;- gpl_anno[,c(<span>"ID"</span> ,<span>"GENE_SYMBOL"</span>)]<br>colnames(id2name) &lt;- c(<span>"ID"</span>,<span>"GENE_SYMBOL"</span>)<br><span># 1.过滤掉空的探针</span><br>id2name &lt;- na.omit(id2name)<br>id2name &lt;- id2name[<span>which</span>(id2name<span>$GENE_SYMBOL</span>!=<span>""</span>), ]<br><span># 2.过滤探针一对多</span><br>id2name &lt;- id2name[!grepl(<span>"\\///"</span>,id2name<span>$GENE_SYMBOL</span>), ]<br>head(id2name)<br><br><span># 3.多对一取均值</span><br><span># 合并探针ID 与基因，表达谱对应关系</span><br><span># 提取表达矩阵</span><br>dat &lt;- dat %&gt;% <br>  as.data.frame() %&gt;% <br>  rownames_to_column(<span>"ID"</span>)<br><br>exp &lt;- merge(id2name, dat, by.x=<span>"ID"</span>, by.y=<span>"ID"</span>)<br><br><span># 多对一取均值</span><br>exp &lt;- avereps(exp[,-c(1,2)],ID = exp<span>$GENE_SYMBOL</span>) %&gt;% <br>  as.data.frame()<br><br>dat &lt;- as.matrix(exp[,pd<span>$geo_accession</span>])<br>dim(dat)<br>fivenum(dat[<span>'CRP'</span>,])<br>fivenum(dat[<span>'GAPDH'</span>,])<br>dat[1:5, 1:6]<br>save(gse_number, dat, group_list, pd, file = <span>'step1_output.Rdata'</span>)<br></code></pre><p data-tool="mdnice编辑器">得到的表达矩阵如下：</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100052513" data-ratio="0.17871222076215507" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1LrK0dx6pQOvwyUnsKXiamc7GDdb8OlQPpwOYBmXp31QaPBPd3oZrSLh1A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="761" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1LrK0dx6pQOvwyUnsKXiamc7GDdb8OlQPpwOYBmXp31QaPBPd3oZrSLh1A/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">进行简单的质控，绘制三张经典的质控图：</p><pre data-tool="mdnice编辑器"><code><span>## 数据检查</span><br>load( file = <span>'step1_output.Rdata'</span>)<br><span>source</span>(<span>'../scripts/run_check.R'</span>)<br>run_check(dat, group_list, target_gene=<span>'AFP'</span>, pro=gse_number,path=<span>'./'</span>)<br></code></pre><p data-tool="mdnice编辑器">结果如下，<span>PCA图中 可以看到 肿瘤样本与对照样本全完的混在了一起</span></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100052516" data-ratio="0.21574074074074073" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1LrwCMLGuibgZ9ZJq4DzqXFo0k1xrToXvRibvyvicIS5maCbPSCWhcibpcZFw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1LrwCMLGuibgZ9ZJq4DzqXFo0k1xrToXvRibvyvicIS5maCbPSCWhcibpcZFw/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span>进行简单的差异分析：<span></span></h3><pre data-tool="mdnice编辑器"><code><span>## 人类看家基因列表如下（部分基因，最常用的是CRP和CRP）</span><br><span>source</span>(<span>'../scripts/run_DEG.R'</span>)<br>group_list<br>deg &lt;- run_DEG(dat, group_list, target_gene=c(<span>'AFP'</span>),pro=gse_number,path=<span>'./'</span>)<br>head(deg)<br>table(deg<span>$g</span>)<br></code></pre><p data-tool="mdnice编辑器"><span>肿瘤与正常癌旁样本的差异基因数量非常少：</span></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100052517" data-ratio="0.39166666666666666" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1Lrx6mqzSrqtiaVVsEyNLIyP2vPOITvhzQ5j3UgpITZGX7fxJc2ic2EeiauA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1Lrx6mqzSrqtiaVVsEyNLIyP2vPOITvhzQ5j3UgpITZGX7fxJc2ic2EeiauA/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span>如果只用差异基因做PCA分析：<span></span></h3><pre data-tool="mdnice编辑器"><code>exp &lt;- dat[deg<span>$g</span>!=<span>"stable"</span>,]<br><span>## 下面是画PCA的必须操作，需要看说明书。</span><br>exp=t(exp)<span>#画PCA图时要求是行名时样本名，列名时探针名，因此此时需要转换</span><br>exp=as.data.frame(exp)<span>#将matrix转换为data.frame </span><br><br>library(<span>"FactoMineR"</span>)<span>#画主成分分析图需要加载这两个包</span><br>library(<span>"factoextra"</span>)  <br><span>#～～～主成分分析图p2～～～</span><br>dat.pca &lt;- PCA(exp , graph = FALSE)<span>#现在exp最后一列是group_list，需要重新赋值给一个dat.pca,这个矩阵是不含有分组信息的</span><br>pro &lt;- gse_number<br>this_title &lt;- paste0(pro,<span>'_PCA'</span>)<br>p2 &lt;- fviz_pca_ind(dat.pca,<br>                 geom.ind = <span>"point"</span>, <span># show points only (nbut not "text")</span><br>                 col.ind = group_list, <span># color by groups</span><br>                 palette = <span>"Dark2"</span>,<br>                 addEllipses = TRUE, <span># Concentration ellipses</span><br>                 legend.title = <span>"Groups"</span>)+<br>ggtitle(this_title) +<br>theme_ggstatsplot() +<br>theme(plot.title = element_text(size=12,hjust = 0.5))<br><br>p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100052515" data-ratio="0.8733850129198967" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1LrGO7JS1n0q8SvDFZdia5rSucQs1FEMjrQflCpPWVMZy9YHGf1H9soWBg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="774" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1LrGO7JS1n0q8SvDFZdia5rSucQs1FEMjrQflCpPWVMZy9YHGf1H9soWBg/640?wx_fmt=png&amp;from=appmsg"></figure><h3 data-tool="mdnice编辑器"><span></span>如果使用sd值指标挑选：<span></span></h3><pre data-tool="mdnice编辑器"><code>cg &lt;- names(tail(sort(apply(dat,1,sd)),1000))<span>#apply按行（'1'是按行取，'2'是按列取）取每一行的方差，从小到大排序，取最大的1000个</span><br><br>exp &lt;- dat[cg,]<br><span>## 下面是画PCA的必须操作，需要看说明书。</span><br>exp=t(exp)<span>#画PCA图时要求是行名时样本名，列名时探针名，因此此时需要转换</span><br>exp=as.data.frame(exp)<span>#将matrix转换为data.frame </span><br><br>library(<span>"FactoMineR"</span>)<span>#画主成分分析图需要加载这两个包</span><br>library(<span>"factoextra"</span>)  <br><span>#～～～主成分分析图p2～～～</span><br>dat.pca &lt;- PCA(exp , graph = FALSE)<span>#现在exp最后一列是group_list，需要重新赋值给一个dat.pca,这个矩阵是不含有分组信息的</span><br>pro &lt;- gse_number<br>this_title &lt;- paste0(pro,<span>'_PCA'</span>)<br>p2 &lt;- fviz_pca_ind(dat.pca,<br>                 geom.ind = <span>"point"</span>, <span># show points only (nbut not "text")</span><br>                 col.ind = group_list, <span># color by groups</span><br>                 palette = <span>"Dark2"</span>,<br>                 addEllipses = TRUE, <span># Concentration ellipses</span><br>                 legend.title = <span>"Groups"</span>)+<br>ggtitle(this_title) +<br>theme_ggstatsplot() +<br>theme(plot.title = element_text(size=12,hjust = 0.5))<br><br>p2<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100052518" data-ratio="0.8806161745827985" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1LrXXXibG28eDqey8tv63QqbtlIubfRqZlcbryxp9VaaIlsRnv382icsVsw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="779" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wxJgKHlNibMY4prkmxfqd1LrXXXibG28eDqey8tv63QqbtlIubfRqZlcbryxp9VaaIlsRnv382icsVsw/640?wx_fmt=png&amp;from=appmsg"><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器"><strong>要是使用差异最大的那部分基因，还是强行可以勉强分开的。</strong></p><h3 data-tool="mdnice编辑器"><span></span>那什么时候肿瘤样本和癌旁样本分不开呢？<span></span></h3><p data-tool="mdnice编辑器">在使用PCA（主成分分析）分析肿瘤样本与癌旁样本时，肿瘤样本和癌旁样本可能在以下情况下分不开：</p><ol data-tool="mdnice编辑器"><li><section><p><span><strong>样本间差异性不足</strong>：</span><span>如果肿瘤样本和癌旁样本在基因表达上的差异不够显著，PCA可能无法有效地将它们区分开来。这可能是因为肿瘤和癌旁组织在分子层面的异质性较低，或者肿瘤微环境与正常组织的差异不大</span><span>。</span></p></section></li><li><section><p><strong>样本量不足</strong>：如果分析的样本数量较少，PCA可能无法捕捉到足够的变异性来区分肿瘤和癌旁样本。样本量的不足可能导致分析结果的不稳定和不准确。</p></section></li><li><section><p><strong>数据质量问题</strong>：如果输入PCA的数据质量不高，例如存在大量的噪声或者技术偏差，这可能会掩盖肿瘤和癌旁样本之间的真实差异，导致PCA分析无法有效分离样本。</p></section></li><li><section><p><strong>预处理不当</strong>：在进行PCA之前，数据需要适当的预处理，包括标准化、去除批次效应等。如果预处理步骤不当，可能会影响PCA分析的结果，使得肿瘤和癌旁样本难以区分。</p></section></li><li><section><p><span><strong>肿瘤微环境的复杂性</strong></span>：肿瘤微环境可能包含多种细胞类型，包括免疫细胞、基质细胞等，这些细胞的存在可能使得肿瘤样本的基因表达模式与癌旁样本相似，从而难以通过PCA区分。</p></section></li><li><section><p><span><strong>肿瘤异质性</strong></span>：肿瘤本身的异质性也可能导致PCA分析中肿瘤样本与癌旁样本难以区分。不同肿瘤样本之间可能存在显著的基因表达差异，这使得它们在PCA分析中难以与癌旁样本区分开来。</p></section></li><li><section><p><strong>分析方法的选择</strong>：PCA是一种线性降维技术，对于非线性关系可能不够敏感。如果肿瘤和癌旁样本之间的差异是非线性的，可能需要考虑使用其他更复杂的分析方法。</p></section></li></ol><p data-tool="mdnice编辑器">总结来说，肿瘤样本和癌旁样本在PCA分析中分不开可能是由于样本间差异性不足、样本量不足、数据质量问题、预处理不当、肿瘤微环境的复杂性、肿瘤异质性以及分析方法的选择等多种因素造成的。</p><h3 data-tool="mdnice编辑器"><span></span>学徒作业<span></span></h3><p data-tool="mdnice编辑器">老板给我发了另外一个数据集，也是存在肿瘤样本与癌旁样本分不开的情况，数据来自文献《<strong>A Candidate Molecular Biomarker Panel for the Detection of Bladder Cancer</strong>》，数据编号为：<span>https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE31189</span>，</p><p data-tool="mdnice编辑器">使用上面的代码，去做做看。</p><h4 data-tool="mdnice编辑器">文末友情宣传</h4><p data-tool="mdnice编辑器">强烈建议你推荐给身边的<strong>博士后以及年轻生物学PI</strong>，多一点数据认知，让他们的科研上一个台阶：</p><ul data-tool="mdnice编辑器"><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247536035&amp;idx=2&amp;sn=dab1e47f7ca8aa2ff26a6e440d9bb044&amp;scene=21#wechat_redirect" data-linktype="2"><strong>生信入门&amp;数据挖掘线上直播课2025年1月班</strong></a><strong>，你的生物信息学入门课</strong></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247524148&amp;idx=1&amp;sn=7806da6feb41a36493c519c1cfc1d3ac&amp;chksm=9b4bdf8fac3c569960369602f1ef26639cb366b250f233b2297d1f059471c0458335bfc0b829&amp;scene=21#wechat_redirect" data-linktype="2"><strong>时隔5年，我们的生信技能树VIP学徒继续招生啦</strong></a></section></li><li><section><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" data-linktype="2"><strong>满足你生信分析计算需求的低价解决方案</strong></a></section></li></ul></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/vzhlOwpKEAmXePjbv6npqA",target="_blank" rel="noopener noreferrer">原文链接</a>
