---
title: "这个工具比 inferCNV 快10倍？！兼容单细胞与空转的 CNV 分析与聚类，竟然还支持肿瘤的亚克隆树构建！"
date: 2025-12-19T12:21:29Z
draft: ["false"]
tags: [
  "fetched",
  "生信碱移"
]
categories: ["Acdemic"]
---
这个工具比 inferCNV 快10倍？！兼容单细胞与空转的 CNV 分析与聚类，竟然还支持肿瘤的亚克隆树构建！ by 生信碱移
------
<div><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor" data-pm-slice="0 0 []"><section powered-by="xiumi.us" data-pm-slice="9 3 []"><section><section powered-by="xiumi.us"><section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1.0324675324675325" data-type="gif" data-w="154" data-src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section></section></section></section><section><section powered-by="xiumi.us"><section><p><span leaf="">老铁快点击蓝字 </span><strong><span leaf="">关注俺</span></strong></p></section></section></section><section><section powered-by="xiumi.us"><section><section powered-by="xiumi.us"><section><img data-ratio="1.0324675324675325" data-type="gif" data-w="154" data-src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1" src="https://mmbiz.qpic.cn/mmbiz_gif/lN9Tp5oiaqHFn9Rg6MwMU3ukMR9ROPh7bf7QWHEMwhUBUwSUKFsV8oK9noHic3jLaeJVQewHJcLq1cTXVAat35Tw/640?wx_fmt=gif&amp;wxfrom=5&amp;wx_lazy=1"></section></section></section></section></section></section></section></section></section><section data-mpa-powered-by="yiban.io" data-style='white-space: normal; max-width: 100%; letter-spacing: 0.544px; text-size-adjust: auto; background-color: rgb(255, 255, 255); font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;' data-pm-slice="9 4 []"><section><section><section><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)"><section data-style="margin-top: 2em; padding-top: 0.5em; padding-bottom: 0.5em; max-width: 100%; border-style: solid none; text-decoration: inherit; border-top-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-top-width: 1px; border-bottom-width: 1px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p><span><span leaf="">生信碱移</span></span></p><section><strong><span leaf="">快速CNV分析</span></strong></section></section></section></section></section></section></section><blockquote><section><span><span leaf=""><span textstyle="">fastCNV</span> 是scRNA-seq与空间转录组（含Visium HD）的快速 CNV 推断工具，<span textstyle="">比常规工具 inferCNV 运行速度快 10 倍，平均内存占用减少 94%</span>。不仅如此，fastCNV 通过将 spots/cells 聚合为 meta-spots/meta-cells 以增强信号，<span textstyle="">输出全基因组 CNV 热图，并进行 CNV 聚类、克隆树推断与染色体臂级别 CNV 事件注释</span>。</span></span></section></blockquote><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">DNA拷贝数变异（CNV）</span>在肿瘤发生发展中占据核心地位，其既可能通过抑癌基因缺失或致癌基因扩增驱动病理过程，也会在肿瘤演化中逐步累积，塑造显著的肿瘤内异质性，并影响生长、耐药与预后。</span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">临床上，CNV 通常依赖 WES/WGS 等 DNA 测序手段进行检测</span>。<span textstyle="">单细胞转录组与空间转录组（ST）</span>在解析组织结构与细胞状态方面优势突出，如果能够从这些转录组数据中推断CNV，就有机会以更低成本、更高空间/细胞分辨率描绘肿瘤克隆结构。<span textstyle="">尽管如此，现有 CNV 分析工具难以处理大规模数据，包括运行速度慢、内存消耗高等。</span></span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">小编也是苦运行速度久矣</span><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaRLGGjXiaE7l1R71y8yNL6XZtGJh9fe6uGgNDNF9lMIafpG6UDEefyvQ/640?wx_fmt=png&amp;from=appmsg" data-w="128" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaRLGGjXiaE7l1R71y8yNL6XZtGJh9fe6uGgNDNF9lMIafpG6UDEefyvQ/640?wx_fmt=png&amp;from=appmsg">，这不最近冲浪的时候发现了一个刚刚上线的 R 包 <span textstyle="">fastCNV</span>，能够实现面向 scRNA-seq 与空间转录组的快速精确 CNV 推断。</span></p><section><img data-ratio="0.5527777777777778" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100013628" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2CLibdEicKicetJWD4sqoiaibcbgYpP2icHiaxUzfowFGib710Mia8ficOwf9DQSog/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2CLibdEicKicetJWD4sqoiaibcbgYpP2icHiaxUzfowFGib710Mia8ficOwf9DQSog/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">一开始不得不提一下 fastCNV 的三大特点，具体带大家根据原文的分析结果来看看。</span></span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">特点一：更高的 CNV 推断准确性</span>。作者选择 117 个 CCLE 癌细胞系，这些细胞系具有全基因组的配对结果。总体来说，fastCNV 与 WES 的相关性整体较高，raw 分数的中位相关性为 0.76（均值0.72），denoised 分数中位数为 0.71（均值0.67）。<span textstyle="">对比 inferCNV 时，fastCNV 无论在 raw 还是 denoised 层面都显著优于 inferCNV（配对T检验p值分别小于4e-31与8e-24）</span><span textstyle="">。</span></span></p><section><img data-ratio="0.5972222222222222" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100013629" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2C0T2ztmWMhvjRYOpuBUbUBIZYHVj5U12PmKb1TBBSVBuXewbKarnGlg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2C0T2ztmWMhvjRYOpuBUbUBIZYHVj5U12PmKb1TBBSVBuXewbKarnGlg/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">图：fastCNV 与 inferCNV 的性能比较</span><span textstyle="">。作者分别对每个细胞系的 scRNA-seq 数据分别运行 fastCNV 与 inferCNV，最终与 WES 推测的 CNV 在同一基因组区域尺度上计算相关性。a图显示 fastCNV 具有高相关性，b图显示 fastCNV 由于inferCNV。</span></span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">特点二：快速且更低内存占用的 CNV 计算</span>。具体来说，fastCNV 在 117 个细胞系上完成分析需要约 4 分钟，而 inferCNV 则需要约 40 分钟<span textstyle="">（运行时间快了 10 倍啊）</span>。在此基础上，其平均内存仅为 80 MiB（<span textstyle="">内存占用约为 inferCNV 的6%）</span>，峰值内存约 19 GiB（inferCNV 约 32 GiB）。</span></p><section><img data-ratio="1.1716961498439127" data-s="300,640" data-type="png" data-w="961" type="block" data-imgfileid="100013630" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2CQ8tPydQGWvP6t9MINHJzLbqicP0C6qlIBBlWLuFiadfsS0aYgW9xd2kg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2CQ8tPydQGWvP6t9MINHJzLbqicP0C6qlIBBlWLuFiadfsS0aYgW9xd2kg/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">图：10次运行下 fastCNV 与 inferCNV 的时间/内存占用比较。</span></span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">特点三：空间转录组的 CNV 推断与空间亚克隆/演化分析功能</span>。fastCNV 不仅在 scRNA-seq 上做 CNV 打分和聚类，还能把 CNV 簇映射回组织空间位置，用 CNV fraction 等指标区分肿瘤与非肿瘤区域。</span></p><section><img data-ratio="0.6138888888888889" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100013631" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2CPWGbuPqXLgOcNQmXT1wHgcfvr5sKwk7FxXaicfuu3du6gjs4jicTIqzw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2CPWGbuPqXLgOcNQmXT1wHgcfvr5sKwk7FxXaicfuu3du6gjs4jicTIqzw/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">图：基于CNV的聚类与打分。</span></span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">在此基础上能够进一步重建空间层面的克隆结构与克隆树，探究亚克隆出现以及肿瘤演化顺序。</span></span></p><section><img data-ratio="0.8546296296296296" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100013632" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2CycsaJcv1df8IfhCaTFD5ELXYoZ5TAzjG2AeI0bScr6sDkkT2GpOZPQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeV2HCRpAialZ8ibAkK95nRZ2CycsaJcv1df8IfhCaTFD5ELXYoZ5TAzjG2AeI0bScr6sDkkT2GpOZPQ/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">图：CNV得分与亚克隆树构建。</span></span></p><p data-tool="markdown.com.cn编辑器"><span leaf="">fastCNV 的使用和原理层面且听小编婉婉道来。<span textstyle="">简单来说，其以 Seurat对象（单样本或多样本列表）作为输入，输出包含 CNV 结果的 Seurat 对象，并可生成类似于 inferCNV 全基因组热图。</span><span textstyle="">具体的流程如下</span><span textstyle="">：</span><span textstyle="">①</span> fastCNV 先用 Louvain 聚类并簇内<span textstyle="">聚合生成meta cell以增强低读数信号</span>，<span textstyle="">②</span> 继而基于 Ensembl 将高表达基因按染色体臂滑窗划分区域，<span textstyle="">③</span> 对 log2 零中心化表达<span textstyle="">以二倍体参考校正得到 raw </span>并截断；<span textstyle="">④</span> 再<span textstyle="">按参考分位去噪生成 denoised 与 CNV fraction</span>，⑤ 最后<span textstyle="">以层次聚类确定亚克隆</span>并由 CNVTree <span textstyle="">基于簇中心构建克隆树</span>并标注臂级增益/缺失。</span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">本文简要介绍 fastCNV 在单细胞与空转数据上的使用，感兴趣的铁子可以进一步阅读原文与 github</span>：</span></p><ul><li><section><span leaf="">github链接: https://github.com/must-bioinfo/fastCNV</span></section></li><li><section><span leaf="">原文DOI：</span><span leaf="">10.1101/2025.10.22.683855</span></section></li></ul><h3 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">0.R包安装</span></span><span></span></h3><p data-tool="markdown.com.cn编辑器"><span leaf="">fastCNV 仅适用于 Seurat5 版本，具体可以使用以下代码安装该包：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># R包</span></span><span leaf=""><br></span><span leaf="">remotes::install_github(</span><span><span leaf="">"must-bioinfo/fastCNV"</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 示例数据</span></span><span leaf=""><br></span><span leaf="">remotes::install_github(</span><span><span leaf="">"must-bioinfo/fastCNVdata"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h3 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">1.单细胞fastCNV分析</span></span><span></span></h3><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">① </span><span textstyle="">加载示例数据</span><span textstyle="">：</span></span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(fastCNV)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(fastCNVdata)</span><span leaf=""><br></span><span><span leaf=""># 加载 scColon1、scColon2、scColon3、scColon4</span></span><span leaf=""><br></span><span><span leaf=""># 为结直肠肿瘤单细胞测序数据</span></span><span leaf=""><br></span><span><span leaf=""># 具体信息见作者原文</span></span><span leaf=""><br></span><span leaf="">utils::data(scColon1)</span><span leaf=""><br></span><span><span leaf=""># 查看数据注释</span></span><span leaf=""><br></span><span leaf="">unique(scColon1[[</span><span><span leaf="">"annot"</span></span><span leaf="">]])</span><span leaf=""><br></span></code></pre><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">② </span><span textstyle="">执行fastCNV分析</span>：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">scColon1 &lt;- fastCNV(seuratObj = scColon1, </span><span leaf=""><br></span><span leaf="">                    sampleName = </span><span><span leaf="">"scColon1"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                    referenceVar = </span><span><span leaf="">"annot"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                    referenceLabel = c(</span><span><span leaf="">"TNKILC"</span></span><span leaf="">, </span><span><span leaf="">"Myeloid"</span></span><span leaf="">, </span><span><span leaf="">"B"</span></span><span leaf="">,</span><span><span leaf="">"Mast"</span></span><span leaf="">, </span><span><span leaf="">"Plasma"</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">                    printPlot = </span><span><span leaf="">T</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.7410440122824974" data-s="300,640" data-type="png" data-w="977" type="block" data-imgfileid="100013635" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiazv3I9EORpqficHatThVancMATnKQiabEaFyxY4z3X7DpFKPiaRvzpBs3Q/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiazv3I9EORpqficHatThVancMATnKQiabEaFyxY4z3X7DpFKPiaRvzpBs3Q/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf="">上述代码在scColon1对象上运行</span><span leaf="">fastCNV()</span><span leaf="">进行CNV推断，其中以</span><code><span leaf="">annot</span></code><span leaf="">列中标注为 TNKILC、Myeloid、B、Mast、Plasma 的细胞作为<span textstyle="">参考二倍体群体（拷贝数正常的细胞群体）</span>，并将样本命名为scColon1且输出结果图（printPlot=TRUE）。</span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">③ </span></span><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{"data-tool":"markdown编辑器","data-website":"https://markdown.com.cn/editor","style":"font-size: 16px;word-spacing: 0px;letter-spacing: 0px;word-break: break-word;word-wrap: break-word;text-align: justify;margin-top: -10px;line-height: 1.75;color: #3f3f3f;font-family: Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light;background-image: linear-gradient(90deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%), linear-gradient(360deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%);background-size: 20px 20px;background-position: center center;padding: 25px;","data-pm-slice":"0 0 []"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"p","attributes":{"data-tool":"markdown.com.cn编辑器","style":"padding-top: 8px;padding-bottom: 8px;margin: 10px 0px;letter-spacing: 1.5px;margin-top: 0px;margin-bottom: 0px;font-size: 16px;line-height: 2;color: #3f3f3f !important;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'><span textstyle="">cnv得分计算</span>。</span><span leaf="">fastCNV 会为 Seurat 对象中的每个观测值计算一个 cnv_fraction (CNV 得分)。可以直接使用 Seurat 的绘图函数对其进行绘制：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(Seurat)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">scColon1 &lt;- RunUMAP(scColon1, dims = </span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">10</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">common_theme &lt;- theme(</span><span leaf=""><br></span><span leaf="">  plot.title = element_text(size = </span><span><span leaf="">10</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">  legend.text = element_text(size = </span><span><span leaf="">8</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">  legend.title = element_text(size = </span><span><span leaf="">8</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">  axis.title = element_text(size = </span><span><span leaf="">8</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">  axis.text = element_text(size = </span><span><span leaf="">6</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">FeaturePlot(scColon1, features = </span><span><span leaf="">"cnv_fraction"</span></span><span leaf="">, reduction = </span><span><span leaf="">"umap"</span></span><span leaf=""> ) &amp; common_theme |</span><span leaf=""><br></span><span leaf="">  DimPlot(scColon1, reduction = </span><span><span leaf="">"umap"</span></span><span leaf="">, group.by =  </span><span><span leaf="">"annot"</span></span><span leaf="">) &amp; common_theme</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.39814814814814814" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100013636" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaIwPQGibkicDoqxEVPfa9AyCBIyZhSFLVz6DpOiaV74fS93u4SoiczBGZ9A/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaIwPQGibkicDoqxEVPfa9AyCBIyZhSFLVz6DpOiaV74fS93u4SoiczBGZ9A/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">画个boxplot，可以看到一些细胞亚群的拷贝数变异（CNV）分数比其他簇高得多：</span></span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">ggplot(FetchData(scColon1, vars = c(</span><span><span leaf="">"annot"</span></span><span leaf="">, </span><span><span leaf="">"cnv_fraction"</span></span><span leaf="">)), </span><span leaf=""><br></span><span leaf="">       aes(annot, cnv_fraction, fill = annot)) +</span><span leaf=""><br></span><span leaf="">  geom_boxplot() +</span><span leaf=""><br></span><span leaf="">  theme(axis.text.x = element_text(angle = </span><span><span leaf="">45</span></span><span leaf="">, vjust = </span><span><span leaf="">1</span></span><span leaf="">, hjust = </span><span><span leaf="">1</span></span><span leaf="">, color = </span><span><span leaf="">"black"</span></span><span leaf="">))</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.7244897959183674" data-s="300,640" data-type="png" data-w="1078" type="block" data-imgfileid="100013637" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaekkFeRv94aRBcKicbedOk91tqWCNekkH7aiabguX29UG2thIDUyBVE5A/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaekkFeRv94aRBcKicbedOk91tqWCNekkH7aiabguX29UG2thIDUyBVE5A/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">在此基础上，还可以使用 Seurat 的绘图函数来绘制按染色体臂划分的 CNV</span>。对于某些肿瘤，其在特定染色体中会存在显著 CNV 变化的：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(scales)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">FeaturePlot(scColon1, features = </span><span><span leaf="">"20.p_CNV"</span></span><span leaf="">)  +</span><span leaf=""><br></span><span leaf="">  scale_color_distiller(palette = </span><span><span leaf="">"RdBu"</span></span><span leaf="">, direction = -</span><span><span leaf="">1</span></span><span leaf="">, limits = c(-</span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">                       rescaler = </span><span><span leaf="">function</span></span><span leaf="">(x, to = c(</span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">), from = </span><span><span leaf="">NULL</span></span><span leaf="">) {</span><span leaf=""><br></span><span leaf="">                         rescale_mid(x, to = to, mid = </span><span><span leaf="">0</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">                       }) +</span><span leaf=""><br></span><span leaf="">  common_theme |</span><span leaf=""><br></span><span leaf="">FeaturePlot(scColon1, features = </span><span><span leaf="">"X.q_CNV"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  scale_color_distiller(palette = </span><span><span leaf="">"RdBu"</span></span><span leaf="">, direction = -</span><span><span leaf="">1</span></span><span leaf="">, limits = c(-</span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">                       rescaler = </span><span><span leaf="">function</span></span><span leaf="">(x, to = c(</span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">), from = </span><span><span leaf="">NULL</span></span><span leaf="">) {</span><span leaf=""><br></span><span leaf="">                         rescale_mid(x, to = to, mid = </span><span><span leaf="">0</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">                       }) +</span><span leaf=""><br></span><span leaf="">  common_theme</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.4324074074074074" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100013638" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiadiaKkALvC7e3QVclb1pjm39mia3u5HfY0XPwuVcar6scTvQZiaOLImiaJQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiadiaKkALvC7e3QVclb1pjm39mia3u5HfY0XPwuVcar6scTvQZiaOLImiaJQ/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">④ </span><span textstyle="">CNV 分类</span>。通过使用按染色体臂划分的 CNV 和 </span><code><span leaf="">CNVclassification</span></code><span leaf="">函数，可以获得根据染色体臂改变的分类：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">scColon1 &lt;- CNVClassification(scColon1)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">DimPlot(scColon1, group.by = </span><span><span leaf="">"20.p_CNV_classification"</span></span><span leaf="">) &amp;</span><span leaf=""><br></span><span leaf="">  scale_color_manual(values = c(gain = </span><span><span leaf="">"red"</span></span><span leaf="">, no_alteration = </span><span><span leaf="">"grey"</span></span><span leaf="">, loss = </span><span><span leaf="">"blue"</span></span><span leaf="">)) &amp;</span><span leaf=""><br></span><span leaf="">  common_theme |</span><span leaf=""><br></span><span leaf="">DimPlot(scColon1, group.by = </span><span><span leaf="">"X.q_CNV_classification"</span></span><span leaf="">) &amp;</span><span leaf=""><br></span><span leaf="">  scale_color_manual(values = c(gain = </span><span><span leaf="">"red"</span></span><span leaf="">, no_alteration = </span><span><span leaf="">"grey"</span></span><span leaf="">, loss = </span><span><span leaf="">"blue"</span></span><span leaf="">)) &amp;</span><span leaf=""><br></span><span leaf="">  common_theme</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.4537037037037037" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100013639" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiapIrDSib9k0sU2aiaUIJ2GP0JsHGAeZXr1tQ17QNVSNvag6lSNjT8DrvA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiapIrDSib9k0sU2aiaUIJ2GP0JsHGAeZXr1tQ17QNVSNvag6lSNjT8DrvA/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">⑤ </span><span textstyle="">基于拷贝数变异的聚类簇</span>。fastCNV 还会计算 CNV 聚类，并将其以 “cnv_clusters” 的形式保存在 Seurat 对象的元数据中：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">DimPlot(scColon1, group.by = </span><span><span leaf="">"cnv_clusters"</span></span><span leaf="">) + common_theme</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.9950331125827815" data-s="300,640" data-type="png" data-w="604" type="block" data-imgfileid="100013640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaDaLEBz0kUVPm2wuLMv7ECMgF71gYcVkDNpHBibgxEzHAVSUJ7QylLWQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaDaLEBz0kUVPm2wuLMv7ECMgF71gYcVkDNpHBibgxEzHAVSUJ7QylLWQ/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf="">通过这个分析，作者发现肿瘤细胞几乎总是属于2/3/4/5 cnv_cluster；而健康细胞往往是 cnv_cluster 1，几乎没有没有拷贝数变异。</span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">⑥ </span><span textstyle="">亚克隆性树构建</span>。如上一小节所述，scColon1 中有 4 个肿瘤亚簇（2/3/4/5），以及 1 个健康亚簇（1）。在此基础上，可以使用 </span><span leaf="">CNVTree()</span><span leaf=""> 来构建亚克隆性树：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">tree_data &lt;- CNVTree(scColon1, values = </span><span><span leaf="">"calls"</span></span><span leaf="">, cnv_thresh = </span><span><span leaf="">0.09</span></span><span leaf="">, healthyClusters = </span><span><span leaf="">"1"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.5121042830540037" data-s="300,640" data-type="png" data-w="1074" type="block" data-imgfileid="100013641" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaunVRqQuM0Ma5WssL0QQtm9MPg6zI4A3hZaSiaged9B3rKAy8wTXEjicQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaunVRqQuM0Ma5WssL0QQtm9MPg6zI4A3hZaSiaged9B3rKAy8wTXEjicQ/640?wx_fmt=png&amp;from=appmsg"></section><h3 data-tool="markdown.com.cn编辑器"><span></span><span><span leaf="">2.空转fastCNV分析</span></span><span></span></h3><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">① </span><span textstyle="">示例数据加载</span> (</span><span leaf="">Visium HD 数据，分辨率更高需要更高的内存占用)</span><span leaf="">：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(fastCNV)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(fastCNVdata)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(Seurat)</span><span leaf=""><br></span><span><span leaf=""># 加载数据</span></span><span leaf=""><br></span><span leaf="">HDBreast &lt;- load_HDBreast()</span><span leaf=""><br></span><span><span leaf=""># 查看注释好的肿瘤/非肿瘤区域</span></span><span leaf=""><br></span><span leaf="">unique(HDBreast[[</span><span><span leaf="">"annots_8um"</span></span><span leaf="">]])</span><span leaf=""><br></span><span><span leaf="">#&gt;                       annots_8um</span></span><span leaf=""><br></span><span><span leaf="">#&gt; s_016um_00107_00066-1           </span></span><span leaf=""><br></span><span><span leaf="">#&gt; s_008um_00269_00526-1    NoTumor</span></span><span leaf=""><br></span><span><span leaf="">#&gt; s_008um_00260_00253-1      Tumor</span></span><span leaf=""><br></span></code></pre><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">值得强调的是，fastCNV 默认使用 16um 测序</span>，如果大家的注释是在 8um 分辨率上的，则需要在对 16um 测序运行 fastCNV 之前先运行下述转换：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">HDBreast &lt;- annotations8umTo16um(HDBreast, referenceVar = </span><span><span leaf="">"annots_8um"</span></span><span leaf="">) </span><span leaf=""><br></span><span><span leaf="">#&gt; [1] "New annotation column (new referenceVar) is named : projected_annots_8um."</span></span><span leaf=""><br></span></code></pre><p data-tool="markdown.com.cn编辑器"><span leaf="">上述代码对 16µm 点分配给 8µm 点的注释，生成了</span><code><span leaf="">projected_annots_8um</span></code><span leaf="">新的列。在此基础上，可以打印注释看看对不对：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">SpatialDimPlot(HDBreast, group.by = </span><span><span leaf="">"projected_annots_8um"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.7587511825922422" data-s="300,640" data-type="png" data-w="1057" type="block" data-imgfileid="100013642" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiajibxqcfFwMO86oiaD3t3PQZFGlXGfmg6UTfdF8CDiaefyene2BYgpCArg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiajibxqcfFwMO86oiaD3t3PQZFGlXGfmg6UTfdF8CDiaefyene2BYgpCArg/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">② </span><span textstyle="">运行 fastCNV</span>，参数与单细胞的分析一致。这里将 NoTumor指定为参考：</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">HDBreast &lt;- fastCNV_10XHD(HDBreast, </span><span leaf=""><br></span><span leaf="">                          sampleName = </span><span><span leaf="">"HDBreast"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                          referenceVar = </span><span><span leaf="">"projected_annots_8um"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                          referenceLabel = </span><span><span leaf="">"NoTumor"</span></span><span leaf="">, </span><span leaf=""><br></span><span leaf="">                          printPlot = </span><span><span leaf="">TRUE</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.7555555555555555" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100013643" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiakWOF7hopFOLjuYj4iau3UichSR3IyfdjRw6Y2PGtYJoOyGHO4hGVic6Pg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiakWOF7hopFOLjuYj4iau3UichSR3IyfdjRw6Y2PGtYJoOyGHO4hGVic6Pg/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf="">下面的分析就与单细胞类似了，小编不做过多赘述。</span></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">③ </span><span textstyle="">CNV 分数</span><span textstyle=""> (cnv_fraction)</span>。</span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(patchwork)</span><span leaf=""><br></span><span leaf="">SpatialFeaturePlot(HDBreast, </span><span><span leaf="">"cnv_fraction"</span></span><span leaf="">) | SpatialPlot(HDBreast, group.by = </span><span><span leaf="">"projected_annots_8um"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.43418467583497056" data-s="300,640" data-type="png" data-w="1018" type="block" data-imgfileid="100013645" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaT4xYbr3icx6MeyDicaYnthvEglPTNdwA4YD5vs0ZnrDKtNK2quPQvSeA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaT4xYbr3icx6MeyDicaYnthvEglPTNdwA4YD5vs0ZnrDKtNK2quPQvSeA/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">两个区域的CNV差异：</span></span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><span leaf=""><br></span><span leaf="">ggplot(FetchData(HDBreast, vars = c(</span><span><span leaf="">"projected_annots_8um"</span></span><span leaf="">, </span><span><span leaf="">"cnv_fraction"</span></span><span leaf="">)), </span><span leaf=""><br></span><span leaf="">       aes(projected_annots_8um, cnv_fraction, fill = projected_annots_8um)) +</span><span leaf=""><br></span><span leaf="">  geom_boxplot() +</span><span leaf=""><br></span><span leaf="">  theme(axis.text.x = element_text(angle = </span><span><span leaf="">45</span></span><span leaf="">, vjust = </span><span><span leaf="">1</span></span><span leaf="">, hjust = </span><span><span leaf="">1</span></span><span leaf="">, color = </span><span><span leaf="">"black"</span></span><span leaf="">))</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.6767241379310345" data-s="300,640" data-type="png" data-w="928" type="block" data-imgfileid="100013646" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaymVWKS1yQLXskxIprm1RkhnBmpCeJejuvXk0WdSD4bGuq2P5V5L0tg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaymVWKS1yQLXskxIprm1RkhnBmpCeJejuvXk0WdSD4bGuq2P5V5L0tg/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">以及按照染色体臂划分的CNV：</span></span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(scales)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">SpatialFeaturePlot(HDBreast, features = </span><span><span leaf="">"11.q_CNV"</span></span><span leaf="">)  +</span><span leaf=""><br></span><span leaf="">  scale_fill_distiller(palette = </span><span><span leaf="">"RdBu"</span></span><span leaf="">, direction = -</span><span><span leaf="">1</span></span><span leaf="">, limits = c(-</span><span><span leaf="">0.5</span></span><span leaf="">, </span><span><span leaf="">0.5</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">                       rescaler = </span><span><span leaf="">function</span></span><span leaf="">(x, to = c(</span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">), from = </span><span><span leaf="">NULL</span></span><span leaf="">) {</span><span leaf=""><br></span><span leaf="">                         rescale_mid(x, to = to, mid = </span><span><span leaf="">0</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">                       }) |</span><span leaf=""><br></span><span leaf="">SpatialFeaturePlot(HDBreast, features = </span><span><span leaf="">"8.q_CNV"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  scale_fill_distiller(palette = </span><span><span leaf="">"RdBu"</span></span><span leaf="">, direction = -</span><span><span leaf="">1</span></span><span leaf="">, limits = c(-</span><span><span leaf="">0.5</span></span><span leaf="">, </span><span><span leaf="">0.5</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">                       rescaler = </span><span><span leaf="">function</span></span><span leaf="">(x, to = c(</span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">1</span></span><span leaf="">), from = </span><span><span leaf="">NULL</span></span><span leaf="">) {</span><span leaf=""><br></span><span leaf="">                         rescale_mid(x, to = to, mid = </span><span><span leaf="">0</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">                       })</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.5877192982456141" data-s="300,640" data-type="png" data-w="1026" type="block" data-imgfileid="100013647" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiagofQjLZoiaKTbWezeyG7zuKlAOXvTvgX2QF1rribiacj12uX2G2zyTzRQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiagofQjLZoiaKTbWezeyG7zuKlAOXvTvgX2QF1rribiacj12uX2G2zyTzRQ/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">④ </span><span textstyle="">基于CNV的聚类簇</span><span textstyle="">：</span></span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">HDBreast &lt;- CNVCluster(HDBreast, referenceVar = </span><span><span leaf="">"projected_annots_8um"</span></span><span leaf="">, tumorLabel = </span><span><span leaf="">"Tumor"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">SpatialDimPlot(HDBreast, group.by = </span><span><span leaf="">"cnv_clusters"</span></span><span leaf="">) </span><span leaf=""><br></span></code></pre><section><img data-ratio="0.7790055248618785" data-s="300,640" data-type="png" data-w="724" type="block" data-imgfileid="100013648" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibia8UGzvBkFpFib3ccTZvpykeGDiaEgwVKxX9TzJZZW7O8GiaWU6tRo6uGOA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibia8UGzvBkFpFib3ccTZvpykeGDiaEgwVKxX9TzJZZW7O8GiaWU6tRo6uGOA/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">比例展示：</span></span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(SeuratObject)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">HDBreast$cnv_clusters &lt;- as.factor(HDBreast$cnv_clusters)</span><span leaf=""><br></span><span leaf="">ggplot(FetchData(HDBreast, vars = c(</span><span><span leaf="">"cnv_clusters"</span></span><span leaf="">, </span><span><span leaf="">"projected_annots_8um"</span></span><span leaf="">)), aes(projected_annots_8um, fill = cnv_clusters)) +</span><span leaf=""><br></span><span leaf="">  geom_bar(position = </span><span><span leaf="">"fill"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  theme(axis.text.x = element_text(angle = </span><span><span leaf="">45</span></span><span leaf="">, vjust = </span><span><span leaf="">1</span></span><span leaf="">, hjust = </span><span><span leaf="">1</span></span><span leaf="">, color = </span><span><span leaf="">"black"</span></span><span leaf="">))</span><span leaf=""><br></span></code></pre><section><img data-ratio="0.8026315789473685" data-s="300,640" data-type="png" data-w="760" type="block" data-imgfileid="100013649" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaBkgCAicacvdSpxI4xqMYP7QEu7DmXib7dkFQtgvfp4mDiaR0f9XJsO57g/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaBkgCAicacvdSpxI4xqMYP7QEu7DmXib7dkFQtgvfp4mDiaR0f9XJsO57g/640?wx_fmt=png&amp;from=appmsg"></section><p data-tool="markdown.com.cn编辑器"><span leaf=""><span textstyle="">再次绘制 CNV 热图，在热图中可视化这些聚类:</span></span></p><pre data-tool="markdown.com.cn编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">plotCNVResultsHD(HDBreast, referenceVar = </span><span><span leaf="">"projected_annots_8um"</span></span><span leaf="">, printPlot = </span><span><span leaf="">TRUE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span></code></pre><section><img data-ratio="0.7574074074074074" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100013650" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaxvewadicibZ9S5mjLqNyqWictkgVCZeYSUBrZZIPQ5NHMIqpNbLtbLAQA/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaxvewadicibZ9S5mjLqNyqWictkgVCZeYSUBrZZIPQ5NHMIqpNbLtbLAQA/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf=""><span textstyle="">⑤ </span><span textstyle="">构建基于CNV的亚克隆树</span><span textstyle="">：</span></span></p><pre data-tool="markdown.com.cn编辑器"><code><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{"data-tool":"markdown编辑器","data-website":"https://markdown.com.cn/editor","style":"font-size: 16px;word-spacing: 0px;letter-spacing: 0px;word-break: break-word;word-wrap: break-word;text-align: justify;margin-top: -10px;line-height: 1.75;color: #3f3f3f;font-family: Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light;background-image: linear-gradient(90deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%), linear-gradient(360deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%);background-size: 20px 20px;background-position: center center;padding: 25px;","data-pm-slice":"0 0 []"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"pre","attributes":{"data-tool":"markdown.com.cn编辑器","style":"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"node",{"tagName":"code","attributes":{"style":"overflow-x: auto;padding: 16px;color: #333;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #f8f8f8;border-radius: 5px;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>tree_data &lt;- CNVTree(HDBreast, values ="calls", cnv_thresh = 0.09, healthyClusters = "0")</span></code></pre><section><img data-imgfileid="100013651" data-ratio="0.6428571428571429" data-s="300,640" data-type="png" data-w="966" type="block" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaJwI3p4YrtIdBJ2FVpOTJ3IvrjMEn2E3ficjAlM584ZEArNszSmX17FQ/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaJwI3p4YrtIdBJ2FVpOTJ3IvrjMEn2E3ficjAlM584ZEArNszSmX17FQ/640?wx_fmt=png&amp;from=appmsg"></section><p><strong><span><span leaf=""><span textstyle="">速度确实快啊，不过得测试测试</span></span><span leaf=""><br></span></span></strong></p><p><span leaf=""><span textstyle="">准确性似</span></span><span leaf=""><span textstyle="">乎也更高？</span></span><span leaf=""><img data-ratio="1" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaRLGGjXiaE7l1R71y8yNL6XZtGJh9fe6uGgNDNF9lMIafpG6UDEefyvQ/640?wx_fmt=png&amp;from=appmsg" data-w="128" src="https://mmbiz.qpic.cn/sz_mmbiz_png/LvUIqvYKCeXBAhbiabqxDJQQyI3Bw5wibiaRLGGjXiaE7l1R71y8yNL6XZtGJh9fe6uGgNDNF9lMIafpG6UDEefyvQ/640?wx_fmt=png&amp;from=appmsg"></span></p><p><strong><strong><span><span><strong><span><span leaf=""><span textstyle="">收藏学习学习 </span></span></span></strong></span></span></strong></strong></p><p><strong><span><span leaf=""><span textstyle="">欢迎各位佬铁点点关注</span></span></span></strong></p><section><mp-common-profile data-pluginname="mpprofile" data-nickname="生信碱移" data-alias="liudoufu307" data-from="2" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/LvUIqvYKCeXYZNMxRMnjiaicO2a27jDZ2FgQga8TdeQcsGRJRIn2IInkKtfcbbMXOBSViaPXpTOBulUlNzd11pzow/0?wx_fmt=png" data-signature="春来秋至，分享我的所见与所识" data-id="MzkyNTIzMzYyMA=="></mp-common-profile></section><section><span leaf=""><br></span></section><section><strong><span><span leaf="">END~</span></span></strong><span leaf=""><br></span></section><p><span><strong><span leaf="">仅供粉丝老铁们参考</span></strong></span></p><p><strong><span leaf="">如有侵权或错误，请联系删除改正～</span></strong></p><p data-tool="markdown.com.cn编辑器"><span leaf=""><br></span></p><section data-class="_mbEditor" data-id="32689"><section><section><section data-pm-slice='5 4 ["para",{"tagName":"section","attributes":{"data-class":"_mbEditor","data-id":"32689","style":"-webkit-tap-highlight-color: transparent;margin-bottom: 0px;outline: 0px;font-size: 16px;color: rgb(63, 63, 63);font-family: Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light;letter-spacing: 2px;background-color: rgb(255, 255, 255);"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{"style":"-webkit-tap-highlight-color: transparent;outline: 0px;border-width: 0px;border-style: none;border-color: initial;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"section","attributes":{"style":"-webkit-tap-highlight-color: transparent;outline: 0px;border-style: solid;-webkit-border-image: url(\"https://mmbiz.qpic.cn/mmbiz_png/b96CibCt70iaY62dey05FUCzFxmD5kYLSzMkskfzNG4hzY0V1ZcwXYEZxM9BiaYUTyd2xhLv2B8qrS54uy2mIyfxQ/640\") 94 170 140 fill;border-width: 20px 32px 40px 24px;font-size: 14px;line-height: 30px;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'><p><span><strong mpa-from-tpl="t"><span leaf="">推荐好文，点击查看:</span></strong></span></p><p><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247497255&amp;idx=1&amp;sn=6069be8eaef52c345190ea208592a450&amp;scene=21#wechat_redirect" textvalue="【教程】这个方法直接把 TCGA 预后模型那一套迁移到单细胞与空转数据上了！竟然还能做模拟敲除与预后靶点筛选？！" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">【教程】这个方法直接把 TCGA 预后模型那一套迁移到单细胞与空转数据上了！竟然还能做模拟敲除与预后靶点筛选？！</span></a></span></p><p><span><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247497184&amp;idx=1&amp;sn=5977a04a2c1e52f656d39fda5e7053b3&amp;scene=21#wechat_redirect" textvalue="【热点】从基础模型到时空组学，盘点 2025 生信研究热门方向！" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">【热点】从基础模型到时空组学，盘点 2025 生信研究热门方向！</span></a></span></span></p><p><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247496608&amp;idx=1&amp;sn=e885795a60b0e69d18f256807740a631&amp;scene=21#wechat_redirect" textvalue="【文献】基因集预后模型泛滥了？关我Transformer什么事！" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">【文献】基因集预后模型泛滥了？关我Transformer什么事！</span></a></span></p><p><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzkyNTIzMzYyMA==&amp;mid=2247496905&amp;idx=1&amp;sn=52c6d981a7dd0c672d85d9411c11350b&amp;scene=21#wechat_redirect" textvalue="【期刊】200 本 2025 生信友好期刊，附影响因子、中科院分区与生信发文数量！" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">【期刊】200 本 2025 生信友好期刊，附影响因子、中科院分区与生信发文数量！</span></a></span></p></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ZD_nHjqMn7pQWEQcYN9a2g",target="_blank" rel="noopener noreferrer">原文链接</a>
