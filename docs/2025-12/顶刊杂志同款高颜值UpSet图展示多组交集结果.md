---
title: "顶刊杂志同款高颜值UpSet图展示多组交集结果"
date: 2025-12-24T04:42:23Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
顶刊杂志同款高颜值UpSet图展示多组交集结果 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><blockquote><p><span leaf="">今天来学习之前珍藏了很久的一篇文献，里面有很多好看的图。文献与2023年12月11号发表在 EMBO J.  杂志上，标题为《Single-cell transcriptomics stratifies organoid models of metabolic dysfunction-associated steatotic liver disease》。</span></p></blockquote><p data-tool="mdnice编辑器"><strong><span leaf="">UpSet 图展示了经 OA、PA、TGF-β1处理和对照组的HLOs中，具有显著性（P值 &lt; 0.05）的细胞类型特异性受体-配体相互作用的交集与独有数量。</span></strong><span leaf="">图中展示了各类处理条件下含有独有相互作用的受体-配体对类别示例。数据包含1,427对显著的细胞-细胞配对特异性受体-配体相互作用，每种处理条件下设置2个重复样本，并包含6个对照组样本。</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">核心要点：</span></strong></p><ol><li><section><span leaf="">通过UpSet图可视化四种处理条件下受体-配体相互作用的共性与独有特征；</span></section></li><li><section><span leaf="">重点展示各处理组特有的受体-配体互作模式；</span></section></li><li><section><span leaf="">研究基于1,427对显著性相互作用，采用重复实验设计进行验证。</span></section></li></ol><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wznWeHg5OfhdKDymwRT9lukdvHYz6Oic78bibepCaicNqibtaH8EU2CpWRXZku5CUWZq2nsibQib4RrIHDw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6287037037037037" data-type="png" data-w="1080" data-imgfileid="100063700" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wznWeHg5OfhdKDymwRT9lukdvHYz6Oic78bibepCaicNqibtaH8EU2CpWRXZku5CUWZq2nsibQib4RrIHDw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">图注：</span></p><blockquote><p><span leaf="">Figure 5. OA induces an interactome distinct from crosstalk observed with TGF-β1 and PA treatment.</span></p><p><span leaf="">UpSet plot displays the numbers of intersecting and unique significant (P-value &lt; 0.05) cell-type-specific receptor-ligand interactions of HLOs treated with OA, PA, TGF-β1, and controls.</span></p></blockquote><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">数据预处理</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">上面的图对应的数据在文献的附件：embj2023113898-sup-0008-datasetev7.xlsx</span></p><p data-tool="mdnice编辑器"><span leaf="">读取进来：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span leaf="">library(ggplot2)</span><span leaf=""><br></span><span><span leaf=""># 加载包</span></span><span leaf=""><br></span><span leaf="">library(readxl)</span><span leaf=""><br></span><span leaf="">library(ggpubr)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 读取特定工作表（按名称）</span></span><span leaf=""><br></span><span leaf="">data &lt;- read_excel(</span><span><span leaf="">"embj2023113898-sup-0008-datasetev7.xlsx"</span></span><span leaf="">, sheet = </span><span><span leaf="">"Dataset_EV7"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">head(data)</span><span leaf=""><br></span><span leaf="">table(data</span><span><span leaf="">$sample</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">table(data</span><span><span leaf="">$condition</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">table(data</span><span><span leaf="">$sample_group</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 总共 1427对</span></span><span leaf=""><br></span><span leaf="">length(unique(data</span><span><span leaf="">$unique_interaction</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">CTRL &lt;- unique(data[data</span><span><span leaf="">$sample_group</span></span><span leaf="">==</span><span><span leaf="">"CTRL"</span></span><span leaf="">, </span><span><span leaf="">"unique_interaction"</span></span><span leaf="">])</span><span leaf=""><br></span><span leaf="">OA &lt;- unique(data[data</span><span><span leaf="">$sample_group</span></span><span leaf="">==</span><span><span leaf="">"OA500"</span></span><span leaf="">, </span><span><span leaf="">"unique_interaction"</span></span><span leaf="">])</span><span leaf=""><br></span><span leaf="">PA &lt;- unique(data[data</span><span><span leaf="">$sample_group</span></span><span leaf="">==</span><span><span leaf="">"PA"</span></span><span leaf="">, </span><span><span leaf="">"unique_interaction"</span></span><span leaf="">])</span><span leaf=""><br></span><span leaf="">TGFB1 &lt;- unique(data[data</span><span><span leaf="">$sample_group</span></span><span leaf="">==</span><span><span leaf="">"TGFB1"</span></span><span leaf="">, </span><span><span leaf="">"unique_interaction"</span></span><span leaf="">])</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">df_list &lt;- list(CTRL=as.character(CTRL</span><span><span leaf="">$unique_interaction</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">                PA=as.character(PA</span><span><span leaf="">$unique_interaction</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">                OA=as.character(OA</span><span><span leaf="">$unique_interaction</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">                TGFB1=as.character(TGFB1</span><span><span leaf="">$unique_interaction</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf="">df_list</span><span leaf=""><br></span><span leaf="">df &lt;- fromList(df_list)</span><span leaf=""><br></span><span leaf="">head(df)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">这样数据就整理好了输入格式（这里的数目跟原文有点对不上，不追究了，这里的重点是怎么绘图，后面自己的项目按照这个格式输入就可以了。）：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wznWeHg5OfhdKDymwRT9luklrCT0ndShACTMibpQgdibvSPiaa6n4nmodSOR3icU3yAuZQHm1QciaSVvtw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5346938775510204" data-type="png" data-w="490" data-imgfileid="100063697" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wznWeHg5OfhdKDymwRT9luklrCT0ndShACTMibpQgdibvSPiaa6n4nmodSOR3icU3yAuZQHm1QciaSVvtw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">开始绘图！</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">使用 UpSetR 绘图 这里有一个小问题，<span textstyle="">作者包里面的点 的形状写死了，是 shape = 16</span><span textstyle="">，</span> 这个值不能有点的外边框和点的内部填充色设置，是个实心圆。如下：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wznWeHg5OfhdKDymwRT9lukfXxMm6UTt00X0Ya04kcxUtiaTzbyz67y2c2l7VNNQ5AzwWIIntiaTRYw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.9034334763948498" data-type="png" data-w="466" data-imgfileid="100063698" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wznWeHg5OfhdKDymwRT9lukfXxMm6UTt00X0Ya04kcxUtiaTzbyz67y2c2l7VNNQ5AzwWIIntiaTRYw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">然后upset 图上半部分的柱子边框也不能设置粗细，这里我把源码下载下来，<span textstyle="">简单的修改了一下 shape=21</span>（你肯定也可以找到对应的修改的地方，如果不会来找我哇，微信 Biotree123）：</span></p><p data-tool="mdnice编辑器"><span leaf="">包地址：https://github.com/cran/UpSetR/tree/master</span></p><p data-tool="mdnice编辑器"><span leaf="">下载下来解压，然后修改R目录中的代码，然后安装：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf=""># 移除特定包</span></span><span leaf=""><br></span><span leaf="">detach(</span><span><span leaf="">"package:UpSetR"</span></span><span leaf="">, unload = TRUE)</span><span leaf=""><br></span><span leaf="">install.packages(</span><span><span leaf="">"UpSetR-master/"</span></span><span leaf="">,repos = NULL,</span><span><span leaf="">type</span></span><span leaf=""> = </span><span><span leaf="">"source"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">library(UpSetR)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">重新绘图 并保存：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">p &lt;- upset(df, nsets =4, sets =c(</span><span><span leaf="">"CTRL"</span></span><span leaf="">,</span><span><span leaf="">"PA"</span></span><span leaf="">,</span><span><span leaf="">"OA"</span></span><span leaf="">,</span><span><span leaf="">"TGFB1"</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">           keep.order =T, number.angles =0,</span><span leaf=""><br></span><span leaf="">           line.size =1.5, mb.ratio =c(0.6,0.4),  </span><span><span leaf=""># 主条形图和矩阵图的比例</span></span><span leaf=""><br></span><span leaf="">           order.by =c(</span><span><span leaf="">"degree"</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">           decreasing = F,</span><span leaf=""><br></span><span leaf="">          </span><span leaf=""><br></span><span leaf="">           main.bar.color = c(</span><span><span leaf="">"<a topic-id="miobqsue-s9r65s" data-topic="1">#d56763</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="miobqsue-7j7kd6" data-topic="1">#fcd2a1</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="miobqsue-5vhtij" data-topic="1">#477b80</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="miobqsue-bo198k" data-topic="1">#808080</a>"</span></span><span leaf="">,rep(</span><span><span leaf="">"<a topic-id="miobqsue-7o7bsm" data-topic="1">#000000</a>"</span></span><span leaf="">,11) ) , </span><span><span leaf=""><a topic-id="miobqsue-syzihu" data-topic="1">#上方y轴柱状图颜色</a></span></span><span leaf=""><br></span><span leaf="">           matrix.color = </span><span><span leaf="">"<a topic-id="miobqsue-m3r1uo" data-topic="1">#000000</a>"</span></span><span leaf="">,             </span><span><span leaf=""># 矩阵点颜色  </span></span><span leaf=""><br></span><span leaf="">           sets.bar.color = </span><span><span leaf="">"<a topic-id="miobqsue-bgqnbd" data-topic="1">#000000</a>"</span></span><span leaf="">,           </span><span><span leaf=""># 集合柱状图颜色</span></span><span leaf=""><br></span><span leaf="">           </span><span leaf=""><br></span><span leaf="">           point.size = 5, </span><span><span leaf=""><a topic-id="miobqsue-fq6bit" data-topic="1">#矩阵中交点大小</a></span></span><span leaf=""><br></span><span leaf="">          </span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># 只显示包含某一组的交集</span></span><span leaf=""><br></span><span leaf="">           queries = list(</span><span leaf=""><br></span><span leaf="">             list(query = intersects, params = list(</span><span><span leaf="">"CTRL"</span></span><span leaf="">),  color = </span><span><span leaf="">"<a topic-id="miobqsue-3wf5vx" data-topic="1">#808080</a>"</span></span><span leaf="">, active = TRUE),</span><span leaf=""><br></span><span leaf="">             list(query = intersects, params = list(</span><span><span leaf="">"PA"</span></span><span leaf="">),  color = </span><span><span leaf="">"<a topic-id="miobqsue-56vofi" data-topic="1">#ff7f0e</a>"</span></span><span leaf="">,  active = TRUE),</span><span leaf=""><br></span><span leaf="">             list(query = intersects, params = list(</span><span><span leaf="">"OA"</span></span><span leaf="">),  color = </span><span><span leaf="">"<a topic-id="miobqsue-baod4y" data-topic="1">#fcd2a1</a>"</span></span><span leaf="">,  active = TRUE),</span><span leaf=""><br></span><span leaf="">             list(query = intersects, params = list(</span><span><span leaf="">"TGFB1"</span></span><span leaf="">),  color = </span><span><span leaf="">"<a topic-id="miobqsue-a95xnz" data-topic="1">#477b80</a>"</span></span><span leaf="">,  active = TRUE) </span><span leaf=""><br></span><span leaf="">             ),</span><span leaf=""><br></span><span leaf="">           </span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># text.scale参数说明：</span></span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># • 第1个值：Y轴标题</span></span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># • 第2个值：Y轴刻度标签</span></span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># • 第3个值：X轴标题</span></span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># • 第4个值：X轴刻度标签</span></span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># • 第5个值：集合名字大小</span></span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># • 第6个值：柱体s上的数字</span></span><span leaf=""><br></span><span leaf="">           text.scale =c( 2, 2,1.8, 2,2,2.5),</span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># 标签</span></span><span leaf=""><br></span><span leaf="">           sets.x.label =</span><span><span leaf="">""</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">           mainbar.y.label =</span><span><span leaf="">"n= 1,427 significant cell-specific\nreceptor-ligand interactions (p &lt; 0.05)"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">          </span><span leaf=""><br></span><span leaf="">           </span><span><span leaf=""># 边距</span></span><span leaf=""><br></span><span leaf="">           set.metadata =NULL</span><span leaf=""><br></span><span leaf="">           )</span><span leaf=""><br></span><span leaf="">library(ggplotify)</span><span leaf=""><br></span><span leaf="">pdf(file = </span><span><span leaf="">"Fig5E.pdf"</span></span><span leaf="">,width = 12,height = 7)</span><span leaf=""><br></span><span><span leaf="">print</span></span><span leaf="">(p)</span><span leaf=""><br></span><span leaf="">dev.off()</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wznWeHg5OfhdKDymwRT9lukiciblCVnwrxFLgyNXV52kTciaqk78qJ0icxRgYzic0uFH8fiahfd8r3PQEKg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5722222222222222" data-type="png" data-w="1080" data-imgfileid="100063701" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wznWeHg5OfhdKDymwRT9lukiciblCVnwrxFLgyNXV52kTciaqk78qJ0icxRgYzic0uFH8fiahfd8r3PQEKg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">完美！</span></p><p data-tool="mdnice编辑器"><span leaf="">这个包的参数非常多，其实整体上个性化调整不是很好搞，做成这样再去AI大法好微调吧。</span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">友情转发：</span></span></p></section><ul><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247547012&amp;idx=1&amp;sn=f55923d9a6d9e04c3e923c2a3cae6e56&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课12月班" data-itemshowtype="0" linktype="text" data-linktype="2">生信入门&amp;数据挖掘线上直播课12月班</a><span textstyle="">，你的生物信息学入门课</span></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525079&amp;idx=1&amp;sn=0b997af16a58195b4192691373048fd5&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" textvalue="满足你生信分析计算需求的低价解决方案" data-itemshowtype="0" linktype="text" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=1679199708449144836&amp;scene=173&amp;subscene=207&amp;sessionid=1745492310&amp;enterid=1745492314&amp;from_msgid=2247541298&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信故事会" data-itemshowtype="0" linktype="text" data-linktype="2">生信故事会</a>，来看看他们的生信入门故事</span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=3690970204957147140&amp;scene=173&amp;subscene=207&amp;sessionid=1745066271&amp;enterid=1745066274&amp;from_msgid=2247540702&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信马拉松答疑专辑" data-itemshowtype="0" linktype="text" data-linktype="2">生信马拉松答疑专辑</a>，获取你的生信专属答疑</span></section></li></ul><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/L-A0Y0pmzgJoZpqW5x94sw",target="_blank" rel="noopener noreferrer">原文链接</a>
