---
title: "NC图表复现｜多分组火山图的系统绘制方法（附完整代码）"
date: 2025-12-23T14:17:22Z
draft: ["false"]
tags: [
  "fetched",
  "R语言数据分析指南"
]
categories: ["Acdemic"]
---
NC图表复现｜多分组火山图的系统绘制方法（附完整代码） by R语言数据分析指南
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">欢迎关注R语言数据分析指南</span></span><span></span></h3><blockquote><span><span leaf="">❝</span></span><p><span leaf="">本节来通过NC上的一篇论文来做一个多分组火山图的绘制，关于此类图之前小编已经做过介绍。但是此案例稍有不同因此来详细介绍一下，有些许细节需要读者注意，仔细阅读定有所收获。论文提供了绘图数据，小编基于自身对数据的理解来进行数据筛选及绘图，因此与原文有所不同，个人观点仅供参考。</span></p></blockquote><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">论文信息</span></span><span></span></h3><p data-tool="mdnice编辑器"><strong><span leaf="">Transferrin-phosphatidylserine liposomes target TDP-43 and neuroinflammation in male mice with neuropathic pain</span></strong><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0cmqA2hVGHdCRMMSfzZPdII2WQvjiagE8rp2Fc4rCbK28D7ZY941yqVA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.35555555555555557" data-type="png" data-w="1080" data-imgfileid="100055397" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0cmqA2hVGHdCRMMSfzZPdII2WQvjiagE8rp2Fc4rCbK28D7ZY941yqVA/640?wx_fmt=png&amp;from=appmsg">Liu, Y., Wu, Y., Zu, M. et al. Transferrin-phosphatidylserine liposomes target TDP-43 and neuroinflammation in male mice with neuropathic pain. Nat Commun 16, 11314 (2025). https://doi.org/10.1038/s41467-025-66397-1</span></p><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">论文图</span></span><span></span></h3><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0yFaB32OgBsh4aDFT7d6WAhibv15VXah3f7icFic4Yf3ZpuAnP1Fwna5Ig/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="0.47314814814814815" data-type="jpeg" data-w="1080" data-imgfileid="100055401" src="https://mmbiz.qpic.cn/mmbiz_jpg/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0yFaB32OgBsh4aDFT7d6WAhibv15VXah3f7icFic4Yf3ZpuAnP1Fwna5Ig/640?wx_fmt=jpeg&amp;from=appmsg"></span></figure><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图思路</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">关于图C这类多组火山图的绘制，小编在之前的文档中已经做过介绍，绘图主要就是筛选数据定义背景色与填充面板的信息。 但是此图稍微有所不同，由于是通过文本进行填充因此需要通过定义因子的方式来确定顺序，同时在添加基因标签时也按上下调类型来分别筛选。需要读者有一定数据筛选的能力，难度系数中等适合进阶学习，当然如果看过下方所示小编4月份所写的案例那只需要做微小改动即可。</span></p><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">往期案例</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0BqSiayEE6921JhFjf8lG0mgmRHmUu2vf9Eicuj1KOFovGQQRm9lCEXfA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6236559139784946" data-type="png" data-w="930" data-imgfileid="100055399" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0BqSiayEE6921JhFjf8lG0mgmRHmUu2vf9Eicuj1KOFovGQQRm9lCEXfA/640?wx_fmt=png&amp;from=appmsg"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0nItZXZC4VJUCWic2FEFQSwyyj1NibQ1EF9RNHkTTGZgg7d8vQRv2OpTA/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.164882226980728" data-type="png" data-w="934" data-imgfileid="100055400" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0nItZXZC4VJUCWic2FEFQSwyyj1NibQ1EF9RNHkTTGZgg7d8vQRv2OpTA/640?wx_fmt=png&amp;from=appmsg"></span></p><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">加载R包</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf="">library</span></span><span leaf="">(tidyverse)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggrepel)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggprism)</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">数据读取</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">df &lt;- read_tsv(</span><span><span leaf="">"data.tsv"</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(chr  = as.character(cluster),</span><span leaf=""><br></span><span leaf="">    type = if_else(avg_log2FC &gt; </span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">"UP_Highly"</span></span><span leaf="">, </span><span><span leaf="">"Down_Highly"</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">cluster_colors &lt;- c(</span><span><span leaf="">"<a topic-id="mjinbyyt-v2gycl" data-topic="1">#3B9AB2</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mjinbyyt-wpl8uo" data-topic="1">#78B7C5</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mjinbyyt-ndsdza" data-topic="1">#EBCC2A</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mjinbyyt-u43ls2" data-topic="1">#E1AF00</a>"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                    </span><span><span leaf="">"<a topic-id="mjinbyyt-y8vzg8" data-topic="1">#F21A00</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mjinbyyt-26eqna" data-topic="1">#C51B7D</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mjinbyyt-s6octm" data-topic="1">#7F3B08</a>"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                    </span><span><span leaf="">"<a topic-id="mjinbyyt-078ej0" data-topic="1">#B2ABD2</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mjinbyyt-6hvcu4" data-topic="1">#ABDDA4</a>"</span></span><span leaf="">,</span><span><span leaf="">"<a topic-id="mjinbyyt-jiahhl" data-topic="1">#FC8D62</a>"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">定义背景</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># cluster 因子顺序</span></span><span leaf=""><br></span><span leaf="">df$cluster &lt;- factor(df$cluster, levels = unique(df$cluster))</span><span leaf=""><br></span><span><span leaf=""># 水平背景</span></span><span leaf=""><br></span><span leaf="">bg_df &lt;- tibble(</span><span leaf=""><br></span><span leaf="">  cluster = levels(df$cluster),</span><span leaf=""><br></span><span leaf="">  xmin = seq_along(levels(df$cluster)) - </span><span><span leaf="">0.48</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  xmax = seq_along(levels(df$cluster)) + </span><span><span leaf="">0.48</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  ymin = -</span><span><span leaf="">0.5</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  ymax = </span><span><span leaf="">0.5</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 垂直背景</span></span><span leaf=""><br></span><span leaf="">bg_vertical &lt;- df %&gt;%</span><span leaf=""><br></span><span leaf="">  group_by(cluster) %&gt;%</span><span leaf=""><br></span><span leaf="">  summarise(</span><span leaf=""><br></span><span leaf="">    ymin = min(avg_log2FC, na.rm = </span><span><span leaf="">TRUE</span></span><span leaf="">) - </span><span><span leaf="">0.1</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">    ymax = max(avg_log2FC, na.rm = </span><span><span leaf="">TRUE</span></span><span leaf="">) + </span><span><span leaf="">0.1</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">    .groups = </span><span><span leaf="">"drop"</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(</span><span leaf=""><br></span><span leaf="">    xmin = seq_along(cluster) - </span><span><span leaf="">0.48</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">    xmax = seq_along(cluster) + </span><span><span leaf="">0.48</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">标注基因</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">label_df &lt;- df %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(p_val_adj &lt; </span><span><span leaf="">0.05</span></span><span leaf="">, abs(avg_log2FC) &gt; </span><span><span leaf="">1</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  group_by(chr) %&gt;%</span><span leaf=""><br></span><span leaf="">  group_modify(~ bind_rows(</span><span leaf=""><br></span><span leaf="">    slice_max(.x, avg_log2FC, n = </span><span><span leaf="">5</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    slice_min(.x, avg_log2FC, n = </span><span><span leaf="">5</span></span><span leaf="">))) %&gt;%</span><span leaf=""><br></span><span leaf="">  ungroup()</span><span leaf=""><br></span></code></pre><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">绘图</span></span><span></span></h3><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">ggplot(df, aes(cluster, avg_log2FC, color = type)) +</span><span leaf=""><br></span><span leaf="">  geom_rect(data = bg_vertical,</span><span leaf=""><br></span><span leaf="">            aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),</span><span leaf=""><br></span><span leaf="">            inherit.aes = </span><span><span leaf="">FALSE</span></span><span leaf="">, fill = </span><span><span leaf="">"grey95"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  geom_rect(data = bg_df,</span><span leaf=""><br></span><span leaf="">            aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax,</span><span leaf=""><br></span><span leaf="">                fill = cluster),</span><span leaf=""><br></span><span leaf="">            inherit.aes = </span><span><span leaf="">FALSE</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  geom_jitter(stroke = </span><span><span leaf="">0</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  geom_text_repel(</span><span leaf=""><br></span><span leaf="">    data = label_df,</span><span leaf=""><br></span><span leaf="">    aes(cluster, avg_log2FC, label = gene),</span><span leaf=""><br></span><span leaf="">    size = </span><span><span leaf="">2.5</span></span><span leaf="">, color = </span><span><span leaf="">"black"</span></span><span leaf="">, box.padding = </span><span><span leaf="">0.2</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  geom_text(aes(cluster, </span><span><span leaf="">0</span></span><span leaf="">, label = chr),</span><span leaf=""><br></span><span leaf="">            size = </span><span><span leaf="">3</span></span><span leaf="">, color = </span><span><span leaf="">"white"</span></span><span leaf="">, show.legend = </span><span><span leaf="">FALSE</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  scale_fill_manual(values = cluster_colors, guide = </span><span><span leaf="">"none"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  scale_color_manual(values = c(</span><span><span leaf="">"<a topic-id="mjinbyyt-tuun88" data-topic="1">#0073C2FF</a>"</span></span><span leaf="">, </span><span><span leaf="">"<a topic-id="mjinbyyt-iofioj" data-topic="1">#EE0000FF</a>"</span></span><span leaf="">)) +</span><span leaf=""><br></span><span leaf="">  scale_y_continuous(</span><span leaf=""><br></span><span leaf="">    limits = c(-</span><span><span leaf="">3</span></span><span leaf="">, </span><span><span leaf="">7</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    breaks = c(-</span><span><span leaf="">3</span></span><span leaf="">, -</span><span><span leaf="">2</span></span><span leaf="">, -</span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">0</span></span><span leaf="">, </span><span><span leaf="">2</span></span><span leaf="">, </span><span><span leaf="">4</span></span><span leaf="">, </span><span><span leaf="">6</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    guide = </span><span><span leaf="">"prism_offset_minor"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  labs(x = </span><span><span leaf="">NULL</span></span><span leaf="">, y = </span><span><span leaf="">"average log2FC"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  guides(color = guide_legend(</span><span leaf=""><br></span><span leaf="">    override.aes = list(size = </span><span><span leaf="">5</span></span><span leaf="">, shape = </span><span><span leaf="">19</span></span><span leaf="">))) +</span><span leaf=""><br></span><span leaf="">  theme_prism(base_line_size = </span><span><span leaf="">0.3</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  theme(</span><span leaf=""><br></span><span leaf="">    panel.background = element_blank(),</span><span leaf=""><br></span><span leaf="">    axis.text.x  = element_blank(),</span><span leaf=""><br></span><span leaf="">    axis.ticks.x = element_blank(),</span><span leaf=""><br></span><span leaf="">    axis.line.x  = element_blank(),</span><span leaf=""><br></span><span leaf="">    axis.text.y  = element_text(size = </span><span><span leaf="">10</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    axis.title   = element_text(size = </span><span><span leaf="">11</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    legend.position = c(</span><span><span leaf="">0.08</span></span><span leaf="">, </span><span><span leaf="">0.9</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    legend.key = element_blank(),</span><span leaf=""><br></span><span leaf="">    legend.background = element_blank(),</span><span leaf=""><br></span><span leaf="">    legend.text = element_text(margin = margin(l = </span><span><span leaf="">0</span></span><span leaf="">)))</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0hjap0RDfBia7bzaUrmCiaaavGia1QyBFN423zYbicibupDmtcKPuzjEIrGQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.425" data-type="png" data-w="1080" data-imgfileid="100055398" src="https://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAbt3wN5dAwHoQdBB8YAq1N0hjap0RDfBia7bzaUrmCiaaavGia1QyBFN423zYbicibupDmtcKPuzjEIrGQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><h3 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">关注下方公众号下回更新不迷路</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf=""><br></span></p></section><section nodeleaf=""><mp-common-profile data-pluginname="mpprofile" data-nickname="R语言数据分析指南" data-alias="YanJANtwo" data-from="0" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EibnicgwScTAZF0rpeZII9Ltl26VbVagriczTria1fib3XgjwwHEHFjPzkmGpqWDVVHBSzhENictUM2iavAKiaM5lc9USw/0?wx_fmt=png" data-signature="R语言重症爱好者，喜欢绘制各种精美的图表，喜欢的小伙伴可以关注我，跟我一起学习" data-id="Mzg3MzQzNTYzMw==" data-is_biz_ban="0" data-service_type="1" data-verify_status="0"></mp-common-profile></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/tw1qQ6qBtxx_xi25PrHfuA",target="_blank" rel="noopener noreferrer">原文链接</a>
