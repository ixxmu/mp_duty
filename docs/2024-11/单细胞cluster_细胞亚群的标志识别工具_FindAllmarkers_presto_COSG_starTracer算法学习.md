---
title: "单细胞cluster/细胞亚群的标志识别工具—FindAllmarkers/presto/COSG/starTracer算法学习"
date: 2024-11-07T01:52:41Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
单细胞cluster/细胞亚群的标志识别工具—FindAllmarkers/presto/COSG/starTracer算法学习 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">随着细胞数量的增加，使用 FindAllMarkers进行标志基因分析的速度变得很慢，因此笔者就把几种常用的标志基因检测工具都用来试了试。</p><h4 data-tool="mdnice编辑器"><span></span>步骤流程<span></span></h4><h5 data-tool="mdnice编辑器"><span></span>1.导入<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br>V5_path = <span>"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/seurat5/"</span><br>.libPaths(V5_path)<br>.libPaths()<br><span>library</span>(Seurat) <span>#v5</span><br><span>library</span>(presto)<br>load(<span>"scRNA.Rdata"</span>)<br>dim(scRNA)<br><span># [1] 24357  4031</span><br><br><span># check</span><br>DimPlot(scRNA,group.by = <span>"celltype"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100002965" data-ratio="0.9311926605504587" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEqRyD8ebV7GS0KmgjlJOKDoeWR5D9vicc1EeDcPR5MIwoIG63ib94mgywDvGS51e2Q8lKFH49Ew4wQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="872" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEqRyD8ebV7GS0KmgjlJOKDoeWR5D9vicc1EeDcPR5MIwoIG63ib94mgywDvGS51e2Q8lKFH49Ew4wQ/640?wx_fmt=png&amp;from=appmsg"></figure><h5 data-tool="mdnice编辑器"><span></span>2.FindAllmarkers<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>start_time &lt;- Sys.time() <span># 记录初始时间</span><br>res &lt;- FindAllMarkers(object = scRNA, only.pos = <span>TRUE</span>,<br>                       min.pct = <span>0.25</span>,logfc.threshold = <span>0.25</span>)<br>end_time &lt;- Sys.time() <span># 记录终止时间</span><br>end_time - start_time <span># 计算时间差</span><br><span># Time difference of 3.996232 secs </span><br><br><span># top5</span><br><span>library</span>(dplyr) <br>top5 &lt;- res %&gt;% <br>  group_by(cluster) %&gt;% <span># 按照cluster分析</span><br>  arrange(desc(avg_log2FC), .by_group=<span>T</span>) %&gt;%<br>  top_n(<span>5</span>, avg_log2FC) <span># 对每个分组选择avg_log2FC排名前5的基因</span><br>top5<br></code></pre><p data-tool="mdnice编辑器">运行时间是3.996232秒</p><p data-tool="mdnice编辑器">logfc.threshold: log2倍数变化(log fold change, LogFC)的阈值。默认是0.1，</p><p data-tool="mdnice编辑器">min.pct: 基因在至少一个群体中的表达比例阈值。默认是0.01，即基因需要在至少1%的细胞中表达。</p><p data-tool="mdnice编辑器">only.pos: 是否只返回在给定群体中上调的基因，默认为 FALSE。<img data-imgfileid="100002966" data-ratio="0.9088050314465409" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEqRyD8ebV7GS0KmgjlJOKDahX4BHla97NIXJ0lhrbd4JG5EIjK9gCr7j3clnzB86lP1Ql3PQ13rQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="636" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEqRyD8ebV7GS0KmgjlJOKDahX4BHla97NIXJ0lhrbd4JG5EIjK9gCr7j3clnzB86lP1Ql3PQ13rQ/640?wx_fmt=png&amp;from=appmsg"></p><h4 data-tool="mdnice编辑器"><span></span>3.presto<span></span></h4><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(presto)<br>start_time &lt;- Sys.time() <span># 记录初始时间</span><br><span># groups_use = c("B-cells", "T-cells") 如果附加了这个参数就是两群细胞之间比较</span><br>presto &lt;- wilcoxauc(scRNA,group_by = <span>"celltype"</span>) <br>end_time &lt;- Sys.time() <span># 记录终止时间</span><br>end_time - start_time <span># 计算时间差</span><br><span># Time difference of 0.8209939 secs </span><br><br>presto_top5 &lt;- presto %&gt;%<br>    filter(logFC &gt; <span>0.25</span> &amp; pct_in &gt; <span>25</span> &amp; padj &lt; <span>0.05</span>) %&gt;%<br>    group_by(group) %&gt;%<br>    arrange(desc(logFC), .by_group=<span>T</span>) %&gt;%<br>    top_n(n = <span>5</span>, wt = logFC) <br>presto_top5<br></code></pre><p data-tool="mdnice编辑器">运行时间是0.8209939秒</p><p data-tool="mdnice编辑器">看了这个函数的参数介绍，没有明确写出默认值，那就按照findallmarker的来。<img data-imgfileid="100002967" data-ratio="0.7246558197747184" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEqRyD8ebV7GS0KmgjlJOKDK1LkeG69HrSQ6PD5LumiabFiaVeAKEx99SQcoakFddneUjlpZibXGGTwg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="799" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyEqRyD8ebV7GS0KmgjlJOKDK1LkeG69HrSQ6PD5LumiabFiaVeAKEx99SQcoakFddneUjlpZibXGGTwg/640?wx_fmt=png&amp;from=appmsg"></p><h5 data-tool="mdnice编辑器"><span></span>4.COSG<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(COSG)<br>start_time &lt;- Sys.time() <span># 记录初始时间</span><br>cosg &lt;- cosg(<br>  scRNA,<br>  groups=<span>'all'</span>, <span>#考虑全部分组</span><br>  assay=<span>'RNA'</span>,<br>  slot=<span>'data'</span>,<br>  mu=<span>1</span>,         <span>#惩罚项参数，值越大</span><br>  remove_lowly_expressed=<span>TRUE</span>,   <span>#是否过滤低表达基因</span><br>  expressed_pct=<span>0.1</span>,             <span>#设置阈值(规定百分比)</span><br>  n_genes_user=<span>100</span> <span>#每个cluster定义Top-N个marker gene</span><br>)<br>end_time &lt;- Sys.time() <span># 记录终止时间</span><br>end_time - start_time <span># 计算时间差</span><br><span># Time difference of 0.7045739 secs</span><br><br><span># Check the marker genes:</span><br>head(cosg$names)<br><span>#   CD4+ T-cells Fibroblasts   B-cells CD8+ T-cells Neutrophils Monocytes Adipocytes NK cells Endothelial cells</span><br><span># 1         IL7R      COL6A2     CD79A         GZMK      FCGR3B    MS4A6A       AQP1   FGFBP2              TFF3</span><br><span># 2         CD28         C1S     BANK1         CCL5      S100A8     CD163      PLVAP    KLRF1              TBX1</span><br><span># 3          MAL      COL6A1     MS4A1         CD8A        G0S2     MS4A7     ADGRL4     GNLY             MMRN1</span><br><span># 4         LEF1         C1R      IGHM         GZMA        FPR1      CD68      PALMD    KLRD1             CCL21</span><br><span># 5        PDE3B    SERPINF1 TNFRSF13C         CD8B       CSF3R     CSF1R      MMRN2     GZMB             PROX1</span><br><span># 6         TCF7       FBLN1   RALGPS2        CRTAM      S100A9      C1QA        VWF     PRF1               NTS</span><br>head(cosg$scores)<br><span>#   CD4+ T-cells Fibroblasts   B-cells CD8+ T-cells Neutrophils Monocytes Adipocytes  NK cells Endothelial cells</span><br><span># 1    0.5226850   0.8841391 0.8285084    0.6263870   0.8532547 0.6944153  0.6827161 0.7548425         0.8540223</span><br><span># 2    0.4225969   0.8769785 0.8008367    0.5764124   0.8392333 0.6699419  0.6639528 0.7526524         0.8356658</span><br><span># 3    0.4225396   0.8598057 0.7772619    0.5161820   0.8104408 0.6528903  0.6603293 0.7123577         0.7992476</span><br><span># 4    0.4191782   0.8500572 0.6866467    0.4842701   0.8070109 0.6226761  0.6008893 0.6192011         0.7812084</span><br><span># 5    0.4044170   0.8455154 0.6860877    0.4538657   0.8032351 0.6146647  0.5992065 0.6186626         0.7576402</span><br><span># 6    0.3970676   0.8436453 0.6035435    0.4133991   0.7707526 0.6091362  0.5956636 0.5936507         0.7520553</span><br></code></pre><p data-tool="mdnice编辑器">运行时间是0.7045739秒</p><p data-tool="mdnice编辑器">COSG score取值范围为0~1。值越大，表示为cluster specific marker gene</p><h5 data-tool="mdnice编辑器"><span></span>5.starTracer<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(starTracer)<br>start_time &lt;- Sys.time() <span># 记录初始时间</span><br>starTracer &lt;- searchMarker(<br>  x = scRNA, <span># 输入一个Seurat对象、一个dgCMatrix或者是一个Average Expression Matrix</span><br>  thresh.1 = <span>0.5</span>, <span># 建议使用默认值</span><br>  thresh.2 = <span>0.3</span>, <span># thresh2越高，表达水平越高，特异性越低。请设置在0-1范围内</span><br>  method = <span>"pos"</span>, <span># pos/all/neg</span><br>  num = <span>5</span>, <span># 输出的top N marker基因数量</span><br>  gene.use = <span>NULL</span>, <span>#留空使用所有基因，设置为“HVG”则使用HVG</span><br>  meta.data = <span>NULL</span>,<br>  ident.use = <span>NULL</span><br>)<br>end_time &lt;- Sys.time() <span># 记录终止时间</span><br>end_time - start_time <span># 计算时间差</span><br><span># Time difference of 1.751583 secs</span><br><br><span>#您可以使用以下代码来获取marker基因的pseudo-bulk表达矩阵</span><br>starTracer$expr.use[starTracer$genes.markers,]<br><br><span>#您可以使用以下代码来获取marker基因记忆其对应的cluster</span><br>starTracer$para_frame[starTracer$genes.markers,c(<span>"max.X"</span>,<span>"gene"</span>)]<br><span>#                        max.X       gene</span><br><span># SH2D1B              NK cells     SH2D1B</span><br><span># KLRC2               NK cells      KLRC2</span><br><span># FGFBP2              NK cells     FGFBP2</span><br><span># KLRF1               NK cells      KLRF1</span><br><span># KIR2DL1             NK cells    KIR2DL1</span><br><span># TFF3       Endothelial cells       TFF3</span><br><span># GPR182     Endothelial cells     GPR182</span><br><span># STAB2      Endothelial cells      STAB2</span><br><span># NTS        Endothelial cells        NTS</span><br><span># AC007998.3 Endothelial cells AC007998.3</span><br><span># LYPD2              Monocytes      LYPD2</span><br><span># SIGLEC8            Monocytes    SIGLEC8</span><br><span># ASGR2              Monocytes      ASGR2</span><br><span># AL662860.1         Monocytes AL662860.1</span><br><span># KCNA7              Monocytes      KCNA7</span><br><span># DLK1             Fibroblasts       DLK1</span><br><span># ADCY5            Fibroblasts      ADCY5</span><br><span># ADGRL3           Fibroblasts     ADGRL3</span><br><span># FAM43B           Fibroblasts     FAM43B</span><br><span># CCDC8            Fibroblasts      CCDC8</span><br><span># S100P            Neutrophils      S100P</span><br><span># CMTM2            Neutrophils      CMTM2</span><br><span># LINC00664        Neutrophils  LINC00664</span><br><span># PI3              Neutrophils        PI3</span><br><span># MGAM             Neutrophils       MGAM</span><br><span># ELAVL2            Adipocytes     ELAVL2</span><br><span># GC                Adipocytes         GC</span><br><span># AMBP              Adipocytes       AMBP</span><br><span># TFF1              Adipocytes       TFF1</span><br><span># TFF2              Adipocytes       TFF2</span><br><span># IL17A           CD4+ T-cells      IL17A</span><br><span># CCR8            CD4+ T-cells       CCR8</span><br><span># KLHL7-DT        CD4+ T-cells   KLHL7-DT</span><br><span># AC026471.3      CD4+ T-cells AC026471.3</span><br><span># IGFL2           CD4+ T-cells      IGFL2</span><br><span># LINC00461       CD8+ T-cells  LINC00461</span><br><span># AC026954.2      CD8+ T-cells AC026954.2</span><br><span># AC023051.1      CD8+ T-cells AC023051.1</span><br><span># TRDV2           CD8+ T-cells      TRDV2</span><br><span># RSPH6A          CD8+ T-cells     RSPH6A</span><br><span># IGKV1-16             B-cells   IGKV1-16</span><br><span># LCN8                 B-cells       LCN8</span><br><span># IGHV4-61             B-cells   IGHV4-61</span><br><span># IGHV1-24             B-cells   IGHV1-24</span><br><span># PLEKHG7              B-cells    PLEKHG7</span><br></code></pre><p data-tool="mdnice编辑器">运行时间是1.751583秒</p><p data-tool="mdnice编辑器">笔者觉得结果还是存在差异的hhh，使用哪一种大家仁者见仁智者见智吧~</p><h4 data-tool="mdnice编辑器"><span></span>参考资料：<span></span></h4><ol data-tool="mdnice编辑器"><li><section>Seurat：https://satijalab.org/seurat/articles/seurat5_integration</section></li><li><section>presto：https://github.com/immunogenomics/presto https://immunogenomics.github.io/presto/articles/getting-started.html</section></li><li><section>COSG：https://github.com/genecell/COSGR</section></li><li><section>starTracer：https://github.com/JerryZhang-1222/starTracer</section></li><li><section>单细胞天地：https://mp.weixin.qq.com/s/Y-NUJmkqcUWe01YVmIrjDA https://mp.weixin.qq.com/s/x0zk66873PQ3O1MYNXc0oA</section></li><li><section>生信技能树：https://mp.weixin.qq.com/s/vtpdxDDd-ZoW0mqfKiPsdg https://mp.weixin.qq.com/s/7GkGUIq5hB-fS27AyGjnrA</section></li></ol><p data-tool="mdnice编辑器"><strong>致谢</strong>：感谢曾老师以及生信技能树团队全体成员。</p><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。更多内容可关注公众号：<strong>生信方舟</strong></p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/0MszCjJUBh3ZrfX65bAPNQ",target="_blank" rel="noopener noreferrer">原文链接</a>
