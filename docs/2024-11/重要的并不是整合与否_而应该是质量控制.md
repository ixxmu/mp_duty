---
title: "重要的并不是整合与否，而应该是质量控制"
date: 2024-11-20T13:43:03Z
draft: ["false"]
tags: [
  "fetched",
  "珠海健明生物医药科技"
]
categories: ["Acdemic"]
---
重要的并不是整合与否，而应该是质量控制 by 珠海健明生物医药科技
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>前些天我们众筹了这个2024-HRA004702-胃癌-卵巢转移-单细胞数据集：45 tumor samples from 18 GC patients with OM.</p></blockquote><p data-tool="mdnice编辑器">是2024年9月30日，浙江省肿瘤医院<strong>程向东</strong>教授团队联合北京大学生物医学前沿创新中心<strong>白凡</strong>教授团队合作在<em><strong>Nature Communications</strong></em>上发表了题为The estrogen response in fibroblasts promotes ovarian metastases of gastric cancer的研究成果，该研究发现雌激素调节卵巢成纤维细胞会促进胃癌的卵巢转移，可能是胃癌卵巢转移好发于年轻女性的重要原因。对应的数据集链接是：https://ngdc.cncb.ac.cn/gsa-human/browse/HRA004702</p><pre data-tool="mdnice编辑器"><span></span><code>标题：Application of single cell sequencing <span>in</span> metastatic gastric cancer<br>发布日期：2024-07-14<br>描述信息：Single cell sequencing was performed on samples of ovarian metastasis of gastric cancer to construct a single cell panorama of ovarian metastasis of gastric cancer<br>访问方式：   Open access<br>BioProject编号:PRJCA017230<br></code></pre><p data-tool="mdnice编辑器">因为是公开了fastq文件格式的测序数据，大概耗费了7个T的磁盘空间，一周的下载数据和计算时间，所以很容易走cellranger的定量流程拿到表达量矩阵。但是，拿到了表达量矩阵先小伙伴们反馈说压根就拿不到文章那样的降维聚类分群结果，如下所示：</p><p><img data-galleryid="" data-imgfileid="100051019" data-ratio="0.3731481481481482" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyMXwWHszFbGAzoogFiamYyWT95o823X0X3NSVqHpxHJtPPolnpMMowaKLFnYplzm9Y96rFpapllzg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyMXwWHszFbGAzoogFiamYyWT95o823X0X3NSVqHpxHJtPPolnpMMowaKLFnYplzm9Y96rFpapllzg/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><figure data-tool="mdnice编辑器"><figcaption>文章那样的降维聚类分群结果</figcaption></figure><p data-tool="mdnice编辑器">从上面的UMAP图可以看到，作者得到了227,836 个单细胞，然后第一层次降维聚类分群后的上皮细胞和间质细胞是比较散乱的，其它单细胞亚群就可以比较好的把来源于不同病人不同部位的单细胞样品聚集在一起。而且里面的t细胞圆润的有点让人吃惊。。。</p><p data-tool="mdnice编辑器">这个单细胞转录组数据集的降维聚类分群结果显示了多个不同的细胞亚群，每个亚群由特定的标记基因定义。从文章里面可以很清晰的看到各个单细胞亚群对应的标记基因：</p><ol data-tool="mdnice编辑器"><li><section><p><strong>基质细胞（Stromal Cells）</strong>：</p></section></li></ol><ul><li><section>标记基因：COL1A1、COL1A2、DCN</section></li><li><section>这些细胞负责产生细胞外基质，通常在组织结构和修复中起重要作用。</section></li></ul><li><section><p><strong>T细胞（T Cells）</strong>：</p></section></li><ul><li><section>标记基因：CD3E、CD3D、CD3G</section></li><li><section>T细胞是适应性免疫系统的关键组成部分，参与细胞免疫反应。</section></li></ul><li><section><p><strong>髓系细胞（Myeloid Cells）</strong>：</p></section></li><ul><li><section>标记基因：CD14、MS4A7（可能指CD20）、FCGR3A（可能指Fcγ受体）</section></li><li><section>髓系细胞包括多种类型的免疫细胞，如巨噬细胞、树突细胞和粒细胞。</section></li></ul><li><section><p><strong>上皮细胞（Epithelial Cells）</strong>：</p></section></li><ul><li><section>标记基因：EPCAM、KRT8、KRT19</section></li><li><section>上皮细胞构成组织的表面，如皮肤、消化道和呼吸道的内衬。</section></li></ul><li><section><p><strong>浆细胞（Plasma Cells）</strong>：</p></section></li><ul><li><section>标记基因：MZB1（可能指XBP1）、IGKC、DERL3</section></li><li><section>浆细胞是B细胞的终末分化形式，负责产生抗体。</section></li></ul><li><section><p><strong>B细胞（B Cells）</strong>：</p></section></li><ul><li><section>标记基因：CD79A、MS4A1、CD19</section></li><li><section>B细胞是适应性免疫系统的另一个关键组成部分，负责产生抗体和提供抗原呈递。</section></li></ul><li><section><p><strong>内皮细胞（Endothelial Cells）</strong>：</p></section></li><ul><li><section>标记基因：VWF、PECAM1、ENG</section></li><li><section>内皮细胞构成血管的内衬，参与血液和淋巴循环。</section></li></ul><li><section><p><strong>肥大细胞（Mast Cells）</strong>：</p></section></li><ul><li><section>标记基因：TPSAB1（可能指Tryptase beta 1）、CPA3（可能指Carboxypeptidase A3）、MS4A2（可能指CD20）</section></li><li><section>肥大细胞在过敏反应和免疫防御中起作用，能够释放多种炎症介质。</section></li></ul><p data-tool="mdnice编辑器">这些细胞亚群的识别有助于理解组织内的细胞多样性和它们在健康和疾病中的作用。通过分析这些亚群的基因表达模式，研究人员可以探索不同细胞类型在生物学过程和疾病状态中的特定功能。</p><p data-tool="mdnice编辑器">因为文章里面的上皮细胞和间质细胞是比较散乱的，所以就很难确定文章是否走了harmony类似的多个单细胞样品的数据整合过程，那我们自己读取一下cellranger出来的表达量矩阵然后降维聚类分群看看是否走harmony的不同选择可以对比看看：</p><pre data-tool="mdnice编辑器"><span></span><code>seuratObj &lt;- RunUMAP(sce.all.int,  <br>                     reduction = <span>"pca"</span>,<br>                     dims = <span>1</span>:<span>15</span> )<br>colnames(sce.all.int@meta.data)<br>p3=DimPlot(sce.all.int, reduction = <span>"umap"</span>, <br>        group.by = <span>"celltype"</span> ) <span>#+ NoLegend()</span><br>p4=DimPlot(seuratObj, reduction = <span>"umap"</span> , <br>          group.by = <span>"celltype"</span>)+ NoLegend()<br><br>p1=DimPlot(sce.all.int, reduction = <span>"umap"</span>, <br>           group.by = <span>"orig.ident"</span> )+ NoLegend()<br>p2=DimPlot(seuratObj, reduction = <span>"umap"</span> , <br>           group.by = <span>"orig.ident"</span>)+ NoLegend()<br><br>(p1+p2)/(p3+p4)<br>ggsave(<span>'harmony-or-not.pdf'</span>,width = <span>12</span>,height = <span>12</span>)<br></code></pre><p data-tool="mdnice编辑器">详细的代码在百度云网盘链接: https://pan.baidu.com/s/1QRFWje5tI6Nodw3I3EX5Tg?pwd=7xp4 提取码: 7xp4  ，这里我们仅仅是展示harmony与否的UMAP的差异：</p><p><img data-cropselx1="81" data-cropselx2="477" data-cropsely1="0" data-cropsely2="492" data-galleryid="" data-imgfileid="100051020" data-ratio="0.6277777777777778" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyMXwWHszFbGAzoogFiamYyWMuj50aHDhT37icb4VXiaFlFicm74mrUzA5vlaicD51ibx3F8nhGe7ehYvFg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyMXwWHszFbGAzoogFiamYyWMuj50aHDhT37icb4VXiaFlFicm74mrUzA5vlaicD51ibx3F8nhGe7ehYvFg/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>harmony与否的UMAP的差异</figcaption></figure><p data-tool="mdnice编辑器">很明显的是，如果不走harmony这样的多个单细胞样品的数据整合过程，就是右图，每个单细胞亚群比如t细胞和b细胞都是可以很明显的清晰的独立成群，但是具体到每个群里面又确实是可以看到样品之间的差异。而且呢，上皮细胞和成纤维又确实是很明显的有个体差异，就好奇怪，因为上皮细胞通常情况下是可以解释为恶性上皮细胞的肿瘤病人之间的异质性所以有个体差异，成纤维我就暂时解释不清楚。</p><p data-tool="mdnice编辑器">然后呢我们的左边的图，很明显是harmony之后的效果，无论是什么样的单细胞亚群都很清晰的独自成群了，而且每个群内部的每个单细胞样品个体也很好的很均匀的混合起来了。说明harmony确实是抹去了单细胞样品本身差异，但是同时也抹去了肿瘤病人的癌细胞的异质性，这个就需要单独去讨论了。</p><p data-tool="mdnice编辑器">但是，这个并不是重点，因为多个单细胞样品的数据整合与否，都有可取之处，真正的麻烦的地方是细胞数量很难使用作者在文章里面的公布的质量控制标准来达到，36.6万多的细胞数量过滤到227,836 个单细胞：</p><p><img data-galleryid="" data-imgfileid="100051020" data-ratio="1.2435344827586208" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyMXwWHszFbGAzoogFiamYyWZZmib5a2z2DSOCGMEuUxIJv1IZY7ZpvP4iawAkA2B3ovHq88r2FCRH2Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="928" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyMXwWHszFbGAzoogFiamYyWZZmib5a2z2DSOCGMEuUxIJv1IZY7ZpvP4iawAkA2B3ovHq88r2FCRH2Q/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>36.6万多的细胞数量过滤到227,836 个单细胞</figcaption></figure><p data-tool="mdnice编辑器">从36.6万多的细胞数量过滤到227,836 个单细胞，确实是很严格的质量控制了，<strong>但是上面写的 maximum percentage mito = 10%, minimum number of UMIs = 1000, and minimum nGene = 500. ：</strong></p><ol data-tool="mdnice编辑器"><li><section><p><strong>最大线粒体基因表达百分比（Maximum percentage mito）</strong>：</p></section></li></ol><ul><li><section>这个阈值用于识别可能受到线粒体DNA污染或具有高线粒体基因表达的细胞，这可能是由于细胞应激或损伤。设置为10%意味着如果一个细胞的线粒体基因表达量占其总表达量的10%以上，则该细胞可能会被移除或标记为异常。</section></li></ul><li><section><p><strong>最小UMI数量（Minimum number of UMIs）</strong>：</p></section></li><ul><li><section>UMI（Unique Molecular Identifiers）是用于标记单个mRNA分子的分子条形码，有助于准确估计基因表达水平。最小UMI数量为1000意味着如果一个细胞的UMI计数少于1000，则该细胞可能被认为是低质量的，可能会被移除。</section></li></ul><li><section><p><strong>最小基因数量（Minimum nGene）</strong>：</p></section></li><ul><li><section>这个阈值用于确保细胞具有足够的基因表达信息。如果一个细胞表达的基因数量少于500，则该细胞可能被认为是低质量的，可能会被移除。</section></li></ul><p data-tool="mdnice编辑器">这些过滤阈值有助于从数据集中移除可能影响分析结果的低质量细胞，例如那些受到污染、死亡或处于非典型状态的细胞。通过应用这些阈值，研究人员可以提高后续分析的可靠性和生物学解释的有效性。<strong>需要注意的是，这些阈值可能需要根据具体的实验设计、数据质量和研究目的进行调整。在设置这些阈值时，应考虑数据的分布和生物学背景。</strong></p><p data-tool="mdnice编辑器">初始矩阵读入后，可以看到其实每个样品细胞数量仍然是在5到10k之间，问题不大，基本上没什么双细胞的可能性。</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; tmp<br>        [,1]  [,2]<br>P01_OM 26591  9653<br>P01_PM 23848  6969<br>P01_PT 23078  2695<br>P02_AS 24022 10104<br>P02_OM 26501  7984<br>P02_PM 25401  8293<br>P02_PT 22542  3728<br>P03_OM 25249  7277<br>P03_PM 25308  9511<br>P03_PT 23062  7037<br>P04_OM 23706  5830<br>P04_PM 23691  5598<br>P04_PT 24104  6626<br>P05_AS 24756  7674<br>P05_OM 24072  5462<br>P05_PT 24004  4532<br>P06_AS 17451  3841<br>P06_PT 17385  1685<br>P07_AS 22084  5121<br>P07_OM 18518  2797<br>P09_AD 19461  4118<br>P09_AS 19201 10919<br>P09_PT 20720  3269<br>P10_AS 19973  7971<br>P10_PT 20715  4473<br>P11_OM 27215  7725<br>P11_PM 27581  9678<br>P11_PT 26387  7011<br>P12_AD 21277  4832<br>P13_AD 20859  4064<br>P14_AD 21774  5066<br>P15_AD 22864  7583<br>P17_AS 25084  9346<br>P17_OM 27155  8546<br>P17_PT 24893 15448<br>P18_AS 24528 11413<br>P18_OM 26289 11252<br>P18_PT 26054 13154<br>P19_OM 26288 11826<br>P19_PT 25159 10617<br>P20_OM 25568  6676<br>P20_PT 22662  3607<br>P21_OM 25165 11636<br>P21_PT 22638  3912<br>P22_OM 26131  8315<br>P22_PT 25450  7028<br>P23_OM 27676 10125<br>P23_PT 25012  6443<br>P24_OM 26163  9735<br>P24_PT 26606  8118<br></code></pre><p data-tool="mdnice编辑器">如果大家使用同样的阈值，其实压根就没办法过滤到文献一样的结果，唯一剩下的就是在每个样品里面的使用 R package scDblFinder (v.1.4.0) ，我测试了一下， 如果想达到文献里面的过滤程度是需要卡上限而不是下限，比如 nFeature_RNA 和nCount_RNA的上限的指标：</p><pre data-tool="mdnice编辑器"><span></span><code> <br>sce.all.filt<br>fivenum(sce.all.filt$nCount_RNA)<br>plot(sort(sce.all.filt$nCount_RNA))<br>tmp=subset(sce.all.filt,subset = percent_mito &lt; <span>10</span> &amp;<br>             nCount_RNA &lt; fivenum(sce.all.filt$nCount_RNA)[<span>4</span>]  &amp;<br>             nFeature_RNA &lt;<span>7500</span>&amp;<br>             nCount_RNA &gt; <span>1000</span> &amp; <br>             nFeature_RNA&gt;<span>500</span>)<br>tmp<br><br>sce.all=tmp<br>sort(table(tmp$orig.ident))<br>sce.all.filt =tmp<br><br></code></pre><p data-tool="mdnice编辑器">其实，上面的 质量控制指标里面，<span><strong>作用最大的就是        nCount_RNA &lt; fivenum(sce.all.filt$nCount_RNA)[4] </strong></span>，但是这个策略的统计学理论很难站住脚。因为在数据处理中，过滤极端值（也称为离群值）的方法取决于数据的分布、研究目的和领域惯例。以下是几种常见的方法：</p><ol data-tool="mdnice编辑器"><li><section><p><strong>Mean + 2SD（均值加2个标准差）</strong>：</p></section></li></ol><ul><li><section>这种方法基于正态分布的假设，认为数据中约95%的值会落在均值的2个标准差之内。超出这个范围的值可能被视为离群值。</section></li></ul><li><section><p><strong>Mean + 3SD（均值加3个标准差）</strong>：</p></section></li><ul><li><section>类似于2SD方法，但更为宽松，允许更多的数据点被保留。在正态分布中，约99.7%的值会落在均值的3个标准差之内。</section></li></ul><li><section><p> 去除Top 25% ：</p></section></li><ul><li><section>这种方法不依赖于标准差，<span><strong>而是直接去除数据中最高的25%。这种方法适用于非正态分布的数据，或者当你认为数据的极端值是由特定的生物学过程或技术因素引起的。</strong></span></section></li></ul><p data-tool="mdnice编辑器">选择哪种方法取决于以下几个因素：</p><ul data-tool="mdnice编辑器"><li><section><p><strong>数据分布</strong>：如果数据近似正态分布，使用2SD或3SD可能更合适。如果数据分布偏斜或有多个峰值，可能需要考虑其他方法。</p></section></li><li><section><p><strong>研究目的</strong>：如果你的目标是去除由于技术或生物学原因产生的异常值，可能需要更具体的标准。</p></section></li><li><section><p><strong>领域惯例</strong>：不同的研究领域可能有不同的标准和惯例。查看相关文献或与领域专家交流可以帮助确定最合适的方法。</p></section></li><li><section><p><strong>数据敏感性</strong>：在某些情况下，过度过滤可能会移除重要的生物学信号。因此，需要权衡过滤的严格性与数据完整性。</p></section></li><li><section><p><strong>数据量</strong>：样本量的大小也会影响过滤策略。在样本量较小的情况下，过滤可能会对结果产生较大影响。</p></section></li></ul><p data-tool="mdnice编辑器">在实际操作中，你可能需要尝试不同的方法，并结合数据的可视化（如箱线图、散点图）来评估哪种方法最适合你的数据。此外，过滤前后的数据都应该进行仔细检查，以确保过滤过程没有引入新的偏差。</p><p data-tool="mdnice编辑器">因为<span><strong>作用最大的就是        nCount_RNA &lt; fivenum(sce.all.filt$nCount_RNA)[4] </strong></span>，虽然我不知道它的合理性，但确实是达到了文章类似的细胞数量，<span>从36.6万多的细胞数量过滤到227,836 个单细胞，如下所示：</span></p><p><img data-galleryid="" data-imgfileid="100051017" data-ratio="0.9972222222222222" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyMXwWHszFbGAzoogFiamYyWeibcMnn3520rYOHDjvnhsp3q8m5uT3nWv218Lw8W2FmotUGI476mJWw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyMXwWHszFbGAzoogFiamYyWeibcMnn3520rYOHDjvnhsp3q8m5uT3nWv218Lw8W2FmotUGI476mJWw/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器"><br></p></section><p><span>如果你也想做单细胞转录组数据分析，</span><span>最好是有自己的计算机资源哦，比如我们的</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247533037&amp;idx=2&amp;sn=e6dd07e9339a84c8cbad2a9d6b42c8ca&amp;chksm=9b4b0156ac3c88403c55822722f6a93cde401fbb7b7cdbaee2a07211347e751ce414b7a47ec7&amp;scene=21#wechat_redirect" textvalue="2024的共享服务器交个朋友福利价仍然‍是800" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">2024的共享服务器交个朋友福利价仍然是800</a><span>，而且还需要有基本的生物信息学基础，也可以看看我们的</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247534569&amp;idx=1&amp;sn=b784451a39ca32e4d87200ea4c31bc57&amp;chksm=9b4b0752ac3c8e44a4751ddd99180a4ff24119b1ab6b3827e4f1c76d26339339b1abaf8abc74&amp;scene=21#wechat_redirect" textvalue="生物‍信息学马拉松授课（买一得五）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">生物信息学马拉松授课（买一得五）</a><span> ，你的生物信息学入门课。而且这个周六日我们在长沙线下授课哦：</span><span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247534419&amp;idx=1&amp;sn=45f3aa273b6d617e0ea4c543e8c59a7c&amp;chksm=9b4b07e8ac3c8efe736ab0f923d796d06e1e6413eeff4bf60713a1c986fb6d50279bef0b12fa&amp;scene=21#wechat_redirect" textvalue="千呼万唤‍，让我们广州线下约起" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1">千呼万唤，让我们<span>长沙</span>线下约起</a></span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/6dfPqABGoV58NY5T8viaaA",target="_blank" rel="noopener noreferrer">原文链接</a>
