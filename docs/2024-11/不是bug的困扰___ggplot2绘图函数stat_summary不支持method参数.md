---
title: "不是bug的困扰 | ggplot2绘图函数stat_summary不支持method参数"
date: 2024-11-25T10:54:51Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
不是bug的困扰 | ggplot2绘图函数stat_summary不支持method参数 by 被炸熟的虾
------
<div><p><span>很久前写的笔记</span><br></p><p><img data-imgfileid="100004928" data-ratio="0.6" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LYdvAQxIibqjBdK0H0xu83cDiaxwGicrGXlT2P6LnSfcl84w9fU0Ht7W7onwNCicLWhiaa6NEw9dbh6iaw/640?wx_fmt=png&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LYdvAQxIibqjBdK0H0xu83cDiaxwGicrGXlT2P6LnSfcl84w9fU0Ht7W7onwNCicLWhiaa6NEw9dbh6iaw/640?wx_fmt=png&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><section>线性拟合用的是全部数据点，如果想<span><strong>改用每组的平均值点进行拟合</strong></span>该怎么办呢？</section><pre><code>data(<span>"ToothGrowth"</span>)<br>head(ToothGrowth)<br>   <span># len supp dose</span><br><span># 1  4.2   VC  0.5</span><br><span># 2 11.5   VC  0.5</span><br><span># 3  7.3   VC  0.5</span><br><span>library</span>(ggplot2)<br>mytheme &lt;- theme_bw() + <br>           theme(strip.text = element_text(size = <span>18</span>),<br>                 axis.line = element_line(color = <span>"black"</span>,size = <span>0.4</span>),<br>                 axis.text.y = element_text(color = <span>"black"</span>,size = <span>18</span>),<br>                 axis.text.x = element_text(color = <span>"black"</span>,size = <span>16</span>),<br>                 axis.title = element_text(color = <span>"black"</span>,size = <span>20</span>),<br>                 panel.grid.minor = element_blank(),<br>                 panel.grid.major = element_line(size = <span>0.2</span>,color = <span>"#e5e5e5"</span>),<br>                 legend.position = <span>"none"</span>)<br>p1 &lt;- ggplot(ToothGrowth,mapping = aes(x = factor(dose),y = len)) +<br>     stat_boxplot(geom = <span>"errorbar"</span>,width = <span>0.1</span>) +<br>     geom_boxplot(outlier.shape = <span>NA</span>) + <br>     geom_point(aes(fill = factor(dose)),pch = <span>21</span>,size = <span>6</span>,<br>                position = position_jitter(<span>0.2</span>))+<br>     scale_fill_manual(values = c(<span>"#db6968"</span>,<span>"#4d97cd"</span>,<span>"#f8984e"</span>,<span>"#459943"</span>)) + <br>     labs(x = <span>NULL</span>,y = <span>"Relative Expression"</span>) +<br>     mytheme +<br>     stat_summary(fun = median,geom = <span>'point'</span>,pch = <span>24</span>,<br>                  size = <span>10</span>,color = <span>"red"</span>,fill = <span>"red"</span>) +<br>     stat_summary(fun = mean,geom = <span>'point'</span>,pch = <span>24</span>,<br>                  size = <span>10</span>,color = <span>"blue"</span>,fill = <span>"blue"</span>)<br></code></pre><pre><code>p1 + stat_summary(fun = mean,geom = <span>'smooth'</span>,method = <span>"lm"</span>,<br>                  size = <span>2</span>,se = <span>T</span>,<span>#添加置信区间</span><br>                  color = <span>"black"</span>,aes(group = <span>1</span>),<br>                  linetype = <span>"dashed"</span>)<br></code></pre><pre><code>Warning messages:<br><span>1</span>: In stat_summary(fun = mean, geom = <span>"smooth"</span>, method = <span>"lm"</span>, size = <span>2</span>,  :<br>  Ignoring unknown parameters: `method`<br><span>2</span>: In max(ids, na.rm = <span>TRUE</span>) : max里所有的参数都不存在；回覆-<span>Inf</span><br></code></pre><p><img data-galleryid="" data-imgfileid="100004929" data-ratio="0.5796296296296296" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LUzI6zu2ZYn1iak3Pyvv0Ad57QzfS32Ucl7JLTibZ21qz0akztJSbgvXxJIBytFTTlicwtpU7FjNZwg/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LUzI6zu2ZYn1iak3Pyvv0Ad57QzfS32Ucl7JLTibZ21qz0akztJSbgvXxJIBytFTTlicwtpU7FjNZwg/640?wx_fmt=png&amp;from=appmsg"></p><p>查询解释：</p><ul><li><section>在<code>ggplot2</code>中，<code>stat_summary()</code>函数用于计算摘要统计量，并且可以通过<code>geom</code>参数指定绘制的几何对象。然而，当你设置<code>geom = 'smooth'</code>时，<code>stat_summary()</code>内部实际上会调用<code>geom_smooth()</code>的某些功能，<strong>但并不完全等同于直接使用<code>geom_smooth()</code>。</strong></section></li><li><section>重要的是要理解<code>method = "lm"</code>在<code>geom_smooth()</code>中是用来指定拟合方法的（线性模型），但在<code>stat_summary()</code>中，<code>method</code>参数并不直接控制拟合方法，因为<code>stat_summary()</code>的主要目的是计算摘要统计量（如均值、中位数等），而不是进行拟合......<code>stat_summary()</code><span>不支持直接绘制拟合线（它只支持绘制摘要统计量的点或条等）</span></section></li></ul><section>有点迷糊的解释<img data-ratio="1" data-w="128" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_26@2x.png" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/Expression/Expression_26@2x.png">，就是和警告输出内容一致，<code>stat_summary()</code>函数不支持<code>geom_smooth()</code>的<code>method</code>、<code>se</code>等参数，设置了<code>geom = 'smooth'</code>也只是得到<strong>连接均值点的线，不是真正的拟合曲线！！</strong></section><section>无奈只好手动计算，重新添加<img data-ratio="1" data-w="128" data-src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/2_05.png" src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/2_05.png"></section><pre><code><span>library</span>(Rmisc)<br>suma &lt;- summarySE(ToothGrowth,<br>                  measurevar = <span>'len'</span>,<br>                  groupvars = c(<span>'dose'</span>))<br>head(suma)<br>  <span># supp dose  N   len       sd        se       ci</span><br><span># 1   OJ  0.5 10 13.23 4.459709 1.4102837 3.190283</span><br><span># 2   OJ  1.0 10 22.70 3.910953 1.2367520 2.797727</span><br><span># 3   OJ  2.0 10 26.06 2.655058 0.8396031 1.899314</span><br><span># 4   VC  0.5 10  7.98 2.746634 0.8685620 1.964824</span><br><span># 5   VC  1.0 10 16.77 2.515309 0.7954104 1.799343</span><br><span># 6   VC  2.0 10 26.14 4.797731 1.5171757 3.432090</span><br></code></pre><section>每一步都得单独添加data和mapping：</section><pre><code><span>library</span>(ggpubr)<br>p2 &lt;- p1 +<br>      geom_smooth(data = suma, aes(x = factor(dose), y = len,group = <span>1</span>),<br>                 method = <span>"lm"</span>,color = <span>"black"</span>,<br>                 se = <span>TRUE</span>,linetype = <span>"solid"</span>) +<br>      <span>#添加相关性检验结果</span><br>      stat_cor(data = suma, <br>               aes(x = factor(dose), y = len,group = <span>1</span>,<br>                   label = paste(..rr.label.., ..p.label.., sep = <span>"~`,`~"</span>)),<br>               label.y = -<span>2</span>,size = <span>6</span>,<br>               color = <span>"black"</span>,method = <span>"spearman"</span>,<br>               label.x.npc = <span>"left"</span>) +<br>      <span>#添加回归方程</span><br>      stat_regline_equation(data = suma, <br>                            aes(x = factor(dose), y = len,group = <span>1</span>),<br>                            label.y = <span>2</span>,size = <span>6</span>,<br>                            color = <span>"red"</span>)<span></span></code></pre><p><img data-galleryid="" data-imgfileid="100004927" data-ratio="0.4148148148148148" data-s="300,640" data-type="png" data-w="1080" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LUzI6zu2ZYn1iak3Pyvv0Ad983ddOOSjnG2aBCNbYRYfwAoI8f1Myw9OgibxQzaico2WsOWY2eUrPFw/640?wx_fmt=png&amp;from=appmsg" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3LUzI6zu2ZYn1iak3Pyvv0Ad983ddOOSjnG2aBCNbYRYfwAoI8f1Myw9OgibxQzaico2WsOWY2eUrPFw/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><section><img data-imgfileid="100004933" data-ratio="0.05278592375366569" data-type="png" data-w="341" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section><section><span></span></section><section data-tools="135编辑器" data-id="116886" draggable="true"><section><section><section><section><strong data-brushtype="text">被炸熟的虾</strong></section></section></section><section><section><section data-width="35%"><section><img data-cropselx1="0" data-cropselx2="115" data-cropsely1="0" data-cropsely2="115" data-imgfileid="100004934" data-ratio="1" data-type="jpeg" data-w="258" data-width="100%" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></section></section><section data-width="63%"><section><section><strong>自己的摸索，发现问题麻烦告诉作者，光速回来改正</strong><strong><img data-imgfileid="100004932" data-ratio="1" data-type="png" data-w="64" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=other&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1&amp;tp=webp"></strong></section></section></section></section></section></section></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/BvvXLfjRPF_dEHWCDYmh6Q",target="_blank" rel="noopener noreferrer">原文链接</a>
