---
title: "【异地备份】如何将MinIO的S3服务挂载为本地磁盘路径（s3fs-fuse、rclone）"
date: 2024-11-23T00:13:13Z
draft: ["false"]
tags: [
  "fetched",
  "AiDBA"
]
categories: ["Acdemic"]
---
【异地备份】如何将MinIO的S3服务挂载为本地磁盘路径（s3fs-fuse、rclone） by AiDBA
------
<div><section><h2><span>简介</span></h2><p>要将S3挂载为本地路径，可以使用一些工具，例如 <code>s3fs-fuse</code> 或 <code>rclone</code>。这两个工具都可以将 Amazon S3（或兼容的 S3 服务）存储桶挂载为 Linux 文件系统，从而像本地文件一样访问。</p><h2><span>Linux方法 1：使用 s3fs-fuse</span></h2><p>https://github.com/s3fs-fuse/s3fs-fuse</p><p><code>s3fs-fuse</code> 可以让你将 S3 存储桶挂载为文件系统。</p><pre><code><span> 1</span>sudo yum <span>install</span> s3fs-fuse -y<br><span> 2</span><br><span> 3</span>echo <span>"12345678:12345678"</span> &gt; ~/.passwd-s3fs<br><span> 4</span>chmod <span>600</span> ~/.passwd-s3fs<br><span> 5</span><br><span> 6</span><br><span> 7</span>mkdir -p /s3fs_dbbk<br><span> 8</span>s3fs dbbk /s3fs_dbbk -o passwd_file=~/.passwd-s3fs -o <span>url</span>=<span>http</span>://<span>192.16</span><span>.7</span><span>.162</span>:<span>9001</span> -o use_path_request_style  -o allow_other<br><span> 9</span><br><span>10</span><br><span>11</span>fusermount -uz /s3fs_dbbk<br><span>12</span>pkill <span>-9</span> s3fs<br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span>[gpadmin@mdw s3fs]$ df -T | grep s3<br><span>17</span>s3fs                    fuse.s3fs <span>70368744161280</span>         <span>0</span> <span>70368744161280</span>   <span>0</span>% /s3fs<br><span>18</span>[gpadmin@mdw s3fs]$ ps -ef|grep s3<br><span>19</span>root     <span>2440517</span>       <span>1</span>  <span>0</span> <span>19</span>:<span>54</span> ?        <span>00</span>:<span>00</span>:<span>00</span> s3fs dbbk /s3fs -o passwd_file=/root/.passwd-s3fs -o <span>url</span>=<span>http</span>://<span>192.16</span><span>.7</span><span>.162</span>:<span>9001</span> -o use_path_request_style -o allow_other<br><span>20</span>gpadmin  <span>2446635</span> <span>2440693</span>  <span>0</span> <span>19</span>:<span>56</span> pts/<span>10</span>   <span>00</span>:<span>00</span>:<span>00</span> grep <span>--color=auto s3</span><br><span>21</span>[gpadmin@mdw s3fs]$ <br></code></pre><h2><span>Linux方法 2：使用 rclone</span></h2><p>https://rclone.org/</p><p>https://downloads.rclone.org/v1.68.1/rclone-v1.68.1-windows-amd64.zip</p><p>兼容性：https://go.dev/wiki/MinimumRequirements#linuxlinux</p><blockquote><p>Kernel version 2.6.32 or later. [<em>This depends on architecture though, we need to have specific builder for this.</em>] Linux/ARMv5 requires much newer kernels, at least v3.1 (for <code>__kuser_cmpxchg64</code>).</p><p>We don’t support CentOS 5. The kernel is too old (2.6.18).</p><p>For little-endian MIPS64, kernel version 4.1 is known to fail, and 4.8 works.</p><p>If you are using tinyconfig (e.g. make tinyconfig) for embedded  systems, you will also almost certainly enable printk in the kernel as  well as a console; we will not include those generic options here. For  Go, you must also enable CONFIG_FUTEX and CONFIG_EPOLL.</p><p>On arm64, an out of date (lower than version 2.33) ld.gold may cause shared library tests to fail (see https://github.com/golang/go/issues/28334).</p></blockquote><p><code>rclone</code> 是一个强大的命令行工具，支持多种云存储服务，包括 S3。可以用它将 S3 存储桶挂载为本地文件系统。</p><pre><code><span> 1</span>wget https://downloads.rclone.org/v1.68.1/rclone-v1.68.1-linux-amd64.zip <br><span> 2</span>unzip rclone-v1.68.1-linux-amd64.zip  -d /usr/local/<br><span> 3</span>ln -s /usr/local/rclone-v1.68.1-linux-amd64 /usr/local/rclone<br><span> 4</span>ln -s /usr/local/rclone/rclone /usr/local/bin<br><span> 5</span><br><span> 6</span><span># /usr/local/rclone/rclone config</span><br><span> 7</span><br><span> 8</span>cat &gt; ~/.config/rclone/rclone.conf &lt;&lt;"EOF"<br><span> 9</span>[mys3]<br><span>10</span>type = s3<br><span>11</span>provider = Minio<br><span>12</span>access_key_id = minioadmin<br><span>13</span>secret_access_key = minioadmin<br><span>14</span>region = us-east-1<br><span>15</span>endpoint = http://192.16.7.162:9001<br><span>16</span>acl = private<br><span>17</span>EOF<br><span>18</span><br><span>19</span><br><span>20</span>rclone lsd mys3: -vv<br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span>mkdir ~/s3bucket<br><span>25</span>ln -s /usr/bin/fusermount /usr/bin/fusermount3<br><span>26</span><br><span>27</span>/usr/local/rclone/rclone mount  mys3:pgbk  ~/s3bucket <span>--allow-other &amp;</span><br><span>28</span><br><span>29</span><br><span>30</span>rclone config <span>show</span><br><span>31</span><br><span>32</span>pkill <span>-9</span> rclone<br><span>33</span>umount ~/s3bucket<br></code></pre><h2><span>Windows挂载S3服务端为本地盘--使用rclone</span></h2><p>https://github.com/winfsp/winfsp  ，Windows File System Proxy - FUSE for Windows</p><p>https://downloads.rclone.org/</p><p>https://downloads.rclone.org/v1.68.1/rclone-v1.68.1-windows-amd64.zip</p><p>兼容性：https://go.dev/wiki/MinimumRequirements#linuxlinux</p><blockquote><p>For Go 1.10: Windows XP (w/ Service Pack 3) or higher.</p><p>For Go 1.11 and later: Windows 7 and higher or Windows Server 2008 R2 and higher. We test on Windows Server 2008 R2, 2012 R2, and 2016, which are roughly Windows 7, Windows 8.1, and Windows 10.</p><p>For Go 1.21 and later: Windows 10 and higher or Windows Server 2016 and higher.</p><p>安装winfsp-2.0.23075.msi，解压rclone-current-windows-amd64.zip即可。</p></blockquote><pre><code><span> 1</span>https://github.com/winfsp/winfsp/releases/download/v2.0/winfsp-2.0.23075.msi<br><span> 2</span>https://downloads.rclone.org/rclone-current-windows-amd64.zip<br><span> 3</span><br><span> 4</span>rclone.exe config<br><span> 5</span><br><span> 6</span><span>-- 默认配置文件： %AppData%\rclone\rclone.conf ，也可以自定义文件位置，然后启动时通过--config "D:\rclone\rclone.conf" 指定</span><br><span> 7</span>[mys3]<br><span> 8</span>type = s3<br><span> 9</span>provider = Minio<br><span>10</span>access_key_id = 12345678<br><span>11</span>secret_access_key = 12345678<br><span>12</span>region = ""<br><span>13</span>endpoint = http://192.16.7.162:9001<br><span>14</span>acl = private<br><span>15</span><br><span>16</span><br><span>17</span>rclone.exe  mount  mys3:gpbk  h:\  <span>--vfs-cache-mode writes</span><br><span>18</span>rclone.exe  mount  mys3:gpbk  h:\  <span>--vfs-cache-mode writes --config "D:\rclone\rclone.conf"</span><br><span>19</span><br><span>20</span><span># 后台运行</span><br><span>21</span><span>start</span> /b rclone.exe  <span>mount</span>  mys3:gpbk  h:\  <span>--vfs-cache-mode writes --config "D:\rclone\rclone.conf"</span><br><span>22</span><br><span>23</span>gpbk为buket名称，<br><span>24</span>就可以看到本地会挂载一个H盘，名称为mys3_gpbk<br><span>25</span><br><span>26</span><br><span>27</span><span># bat脚本放入开机启动 C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</span><br><span>28</span>shell:Common <span>Startup</span><br></code></pre><h2><span>总结</span></h2><p><strong>1、使用s3fs-fuse要比rclone简单的多，但是s3fs-fuse不支持windows系统</strong></p><p><br></p><p><br></p></section><section><mp-common-cpsad data-pluginname="mpcps" data-adtype="short-play" data-playappid="wxed6ed426f5736987" data-planid="202411130931030581208" data-dramaid="118479" data-srcappid="wxdc414bb7de587729" data-templateid="video-play" data-defaultpath="plugin-private%3A%2F%2Fwx94a6522b1d640c3b%2Fpages%2Fplaylet%2Fplaylet%3FdramaId%3D118479%26srcAppid%3Dwxdc414bb7de587729%26wxTicket%3DdGlja2V0NTE0Mzg5ODA5ODk4NTAwNTQ2MjA1MDM3" data-goodssouce="1" data-traceid="fd7f07fb-53d4-4d2d-a869-764cd82a5d68118479" data-videocarddata='{"name":"吴家有女撼乾坤","categoryName":"家庭","videoCoverUrl":"https://wxaintpcos.wxqcloud.qq.com.cn/public/wxdc414bb7de587729/WxaDramaCoverImage/abef7ced7da5204019778edef5978471.jpg","categoryInfo":"60集"}' data-mediano="1" data-disablechangevideo="1" data-playcpstype="2"></mp-common-cpsad></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/rlLLI1B0xY5ORGMBDMJsPA",target="_blank" rel="noopener noreferrer">原文链接</a>
