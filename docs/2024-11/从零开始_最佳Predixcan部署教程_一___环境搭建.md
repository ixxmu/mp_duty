---
title: "从零开始，最佳Predixcan部署教程（一）——环境搭建"
date: 2024-11-20T08:26:40Z
draft: ["false"]
tags: [
  "fetched",
  "生命数据科学"
]
categories: ["Acdemic"]
---
从零开始，最佳Predixcan部署教程（一）——环境搭建 by 生命数据科学
------
<div><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzk0MDI4MjM4NQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/Nf8QqUlJukMmaCXNABdtSPicSfZU9GMyI6PHia3Gqfy5DNMias3VicXY8Gh70vu1gibxsObqoGRRHYtJLKX6WbyeeNw/0?wx_fmt=png" data-nickname="生命数据科学" data-alias="Data_Research" data-signature="科研是天马行空的想象和脚踏实地的认真！" data-from="0" data-is_biz_ban="0" data-service_type="1"></mp-common-profile></section><section data-tool="markdown编辑器" data-website="https://markdown.com.cn/editor"><blockquote data-tool="markdown.com.cn编辑器"><p>目前网上对于Predixcan的环境搭建教程不够清晰和智能（包括github官网教程），因此本文主要记录Predixcan环境搭建，数据准备和软件验证</p></blockquote><h2 data-tool="markdown.com.cn编辑器"><span></span>1. 软件准备</h2><h2 data-tool="markdown.com.cn编辑器"><span></span>1.1 conda安装及配置</h2><pre data-tool="markdown.com.cn编辑器"><span></span><code>wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh<br><br>bash Miniconda3-latest-Linux-x86_64.sh<br><br># 回车直到选择界面，输入yes<br><br>---<br># 修改镜像<br>nano ~/.condarc<br>---<br># what in .condarc<br>channels:<br>  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/<br>  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r/<br>  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2/<br>  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/<br>  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/<br>  - https://mirrors.ustc.edu.cn/anaconda/cloud/bioconda/<br>  - defaults<br>show_channel_urls: true<br>channel_priority: strict<br>---<br><br># 更新<br>conda update conda<br>conda update --all<br><br># 创建环境<br>mkdir /your_path_to/workdir<br>wget https://github.com/hakyimlab/MetaXcan/raw/refs/heads/master/software/conda_env.yaml<br><br># 最好nano conda_env.yaml，修改环境名称<br>conda env create --file conda_env.yaml<br><br># 安装MetaXcan<br>git clone https://github.com/hakyimlab/MetaXcan.git<br>cd ./MetaXcan/software/<br>python setup.py develop<br><br>!强烈建议bgen-reader用pip装，用conda装可能会运行不了<br>pip3 install bgen-reader<br></code></pre><h2 data-tool="markdown.com.cn编辑器"><span></span>2. 数据准备</h2><h2 data-tool="markdown.com.cn编辑器"><span></span>数据下载</h2><pre data-tool="markdown.com.cn编辑器"><span></span><code>cd workdir<br>mkdir data<br>cd data<br>wget https://zenodo.org/records/3691952/files/predixcan_sample_data.tar?download=1<br>mv predixcan_sample_data.tar?download=1 predixcan_sample_data.tar<br>tar -xvf predixcan_sample_data.tar<br></code></pre><h2 data-tool="markdown.com.cn编辑器"><span></span>3.现有的工作树</h2><pre data-tool="markdown.com.cn编辑器"><span></span><code>(base) [user workdir]$ tree<br>.<br>├── conda_env.yaml<br>├── data<br>│   ├── data<br>│   │   ├── =0.12<br>│   │   ├── 1000G_hg37<br>│   │   │   ├── ALL.chr22.phase3_shapeit2_mvncall_integrated_v5a.20130502.genotypes.vcf.gz<br>│   │   │   └── random_pheno_1000G_hg37.txt<br>│   │   ├── 1000G_hg37_bgen<br>│   │   │   ├── chr22.bgen<br>│   │   │   ├── chr22.bgen.metadata<br>│   │   │   └── chr22.bgen.metafile<br>│   │   ├── 1000G_hg37_dosage<br>│   │   │   ├── chr22.txt.gz<br>│   │   │   └── samples.txt<br>│   │   ├── 1000G_hg38<br>│   │   │   ├── ALL.chr22.shapeit2_integrated_snvindels_v2a_27022019.GRCh38.phased.vcf.gz<br>│   │   │   └── random_pheno_1000G_hg38.txt<br>│   │   ├── =1.8.2<br>│   │   ├── examples<br>│   │   │   ├── bgen_1000G_hg37_en.sh<br>│   │   │   ├── bgen_1000G_hg37_en_test.sh<br>│   │   │   ├── vcf_1000G_hg37_en_a.sh<br>│   │   │   ├── vcf_1000G_hg37_en_b.sh<br>│   │   │   ├── vcf_1000G_hg37_en_old_predixcan.sh<br>│   │   │   ├── vcf_1000G_hg37_mashr.sh<br>│   │   │   ├── vcf_1000G_hg38_en.sh<br>│   │   │   └── vcf_1000G_hg38_mashr.sh<br>│   │   ├── gtex_v8_eur_filtered_maf0.01_monoallelic_variants.txt.gz<br>│   │   ├── hg19ToHg38.over.chain.gz<br>│   │   └── models<br>│   │       ├── download<br>│   │       │   ├── elastic_net_eqtl.tar<br>│   │       │   ├── eqtl<br>│   │       │   │   └── mashr<br>│   │       │   │       ├── mashr_Adipose_Subcutaneous.db<br>│   │       │   │       ├── mashr_Adipose_Subcutaneous.txt.gz<br>│   │       │   │       ├── mashr_Adipose_Visceral_Omentum.db<br>│   │       │   │       ├── mashr_Adipose_Visceral_Omentum.txt.gz<br>│   │       │   │       ├── mashr_Adrenal_Gland.db<br>│   │       │   │       ├── mashr_Adrenal_Gland.txt.gz<br>│   │       │   │       ├── mashr_Artery_Aorta.db<br>│   │       │   │       ├── mashr_Artery_Aorta.txt.gz<br>│   │       │   │       ├── mashr_Artery_Coronary.db<br>│   │       │   │       ├── mashr_Artery_Coronary.txt.gz<br>│   │       │   │       ├── mashr_Artery_Tibial.db<br>│   │       │   │       ├── mashr_Artery_Tibial.txt.gz<br>│   │       │   │       ├── mashr_Brain_Amygdala.db<br>│   │       │   │       ├── mashr_Brain_Amygdala.txt.gz<br>│   │       │   │       ├── mashr_Brain_Anterior_cingulate_cortex_BA24.db<br>│   │       │   │       ├── mashr_Brain_Anterior_cingulate_cortex_BA24.txt.gz<br>│   │       │   │       ├── mashr_Brain_Caudate_basal_ganglia.db<br>│   │       │   │       ├── mashr_Brain_Caudate_basal_ganglia.txt.gz<br>│   │       │   │       ├── mashr_Brain_Cerebellar_Hemisphere.db<br>│   │       │   │       ├── mashr_Brain_Cerebellar_Hemisphere.txt.gz<br>│   │       │   │       ├── mashr_Brain_Cerebellum.db<br>│   │       │   │       ├── mashr_Brain_Cerebellum.txt.gz<br>│   │       │   │       ├── mashr_Brain_Cortex.db<br>│   │       │   │       ├── mashr_Brain_Cortex.txt.gz<br>│   │       │   │       ├── mashr_Brain_Frontal_Cortex_BA9.db<br>│   │       │   │       ├── mashr_Brain_Frontal_Cortex_BA9.txt.gz<br>│   │       │   │       ├── mashr_Brain_Hippocampus.db<br>│   │       │   │       ├── mashr_Brain_Hippocampus.txt.gz<br>│   │       │   │       ├── mashr_Brain_Hypothalamus.db<br>│   │       │   │       ├── mashr_Brain_Hypothalamus.txt.gz<br>│   │       │   │       ├── mashr_Brain_Nucleus_accumbens_basal_ganglia.db<br>│   │       │   │       ├── mashr_Brain_Nucleus_accumbens_basal_ganglia.txt.gz<br>│   │       │   │       ├── mashr_Brain_Putamen_basal_ganglia.db<br>│   │       │   │       ├── mashr_Brain_Putamen_basal_ganglia.txt.gz<br>│   │       │   │       ├── mashr_Brain_Spinal_cord_cervical_c-1.db<br>│   │       │   │       ├── mashr_Brain_Spinal_cord_cervical_c-1.txt.gz<br>│   │       │   │       ├── mashr_Brain_Substantia_nigra.db<br>│   │       │   │       ├── mashr_Brain_Substantia_nigra.txt.gz<br>│   │       │   │       ├── mashr_Breast_Mammary_Tissue.db<br>│   │       │   │       ├── mashr_Breast_Mammary_Tissue.txt.gz<br>│   │       │   │       ├── mashr_Cells_Cultured_fibroblasts.db<br>│   │       │   │       ├── mashr_Cells_Cultured_fibroblasts.txt.gz<br>│   │       │   │       ├── mashr_Cells_EBV-transformed_lymphocytes.db<br>│   │       │   │       ├── mashr_Cells_EBV-transformed_lymphocytes.txt.gz<br>│   │       │   │       ├── mashr_Colon_Sigmoid.db<br>│   │       │   │       ├── mashr_Colon_Sigmoid.txt.gz<br>│   │       │   │       ├── mashr_Colon_Transverse.db<br>│   │       │   │       ├── mashr_Colon_Transverse.txt.gz<br>│   │       │   │       ├── mashr_Esophagus_Gastroesophageal_Junction.db<br>│   │       │   │       ├── mashr_Esophagus_Gastroesophageal_Junction.txt.gz<br>│   │       │   │       ├── mashr_Esophagus_Mucosa.db<br>│   │       │   │       ├── mashr_Esophagus_Mucosa.txt.gz<br>│   │       │   │       ├── mashr_Esophagus_Muscularis.db<br>│   │       │   │       ├── mashr_Esophagus_Muscularis.txt.gz<br>│   │       │   │       ├── mashr_Heart_Atrial_Appendage.db<br>│   │       │   │       ├── mashr_Heart_Atrial_Appendage.txt.gz<br>│   │       │   │       ├── mashr_Heart_Left_Ventricle.db<br>│   │       │   │       ├── mashr_Heart_Left_Ventricle.txt.gz<br>│   │       │   │       ├── mashr_Kidney_Cortex.db<br>│   │       │   │       ├── mashr_Kidney_Cortex.txt.gz<br>│   │       │   │       ├── mashr_Liver.db<br>│   │       │   │       ├── mashr_Liver.txt.gz<br>│   │       │   │       ├── mashr_Lung.db<br>│   │       │   │       ├── mashr_Lung.txt.gz<br>│   │       │   │       ├── mashr_Minor_Salivary_Gland.db<br>│   │       │   │       ├── mashr_Minor_Salivary_Gland.txt.gz<br>│   │       │   │       ├── mashr_Muscle_Skeletal.db<br>│   │       │   │       ├── mashr_Muscle_Skeletal.txt.gz<br>│   │       │   │       ├── mashr_Nerve_Tibial.db<br>│   │       │   │       ├── mashr_Nerve_Tibial.txt.gz<br>│   │       │   │       ├── mashr_Ovary.db<br>│   │       │   │       ├── mashr_Ovary.txt.gz<br>│   │       │   │       ├── mashr_Pancreas.db<br>│   │       │   │       ├── mashr_Pancreas.txt.gz<br>│   │       │   │       ├── mashr_Pituitary.db<br>│   │       │   │       ├── mashr_Pituitary.txt.gz<br>│   │       │   │       ├── mashr_Prostate.db<br>│   │       │   │       ├── mashr_Prostate.txt.gz<br>│   │       │   │       ├── mashr_Skin_Not_Sun_Exposed_Suprapubic.db<br>│   │       │   │       ├── mashr_Skin_Not_Sun_Exposed_Suprapubic.txt.gz<br>│   │       │   │       ├── mashr_Skin_Sun_Exposed_Lower_leg.db<br>│   │       │   │       ├── mashr_Skin_Sun_Exposed_Lower_leg.txt.gz<br>│   │       │   │       ├── mashr_Small_Intestine_Terminal_Ileum.db<br>│   │       │   │       ├── mashr_Small_Intestine_Terminal_Ileum.txt.gz<br>│   │       │   │       ├── mashr_Spleen.db<br>│   │       │   │       ├── mashr_Spleen.txt.gz<br>│   │       │   │       ├── mashr_Stomach.db<br>│   │       │   │       ├── mashr_Stomach.txt.gz<br>│   │       │   │       ├── mashr_Testis.db<br>│   │       │   │       ├── mashr_Testis.txt.gz<br>│   │       │   │       ├── mashr_Thyroid.db<br>│   │       │   │       ├── mashr_Thyroid.txt.gz<br>│   │       │   │       ├── mashr_Uterus.db<br>│   │       │   │       ├── mashr_Uterus.txt.gz<br>│   │       │   │       ├── mashr_Vagina.db<br>│   │       │   │       ├── mashr_Vagina.txt.gz<br>│   │       │   │       ├── mashr_Whole_Blood.db<br>│   │       │   │       └── mashr_Whole_Blood.txt.gz<br>│   │       │   ├── mashr_eqtl.tar<br>│   │       │   └── nohup.out<br>│   │       ├── gtex_v8_en<br>│   │       │   └── en_Whole_Blood.db<br>│   │       └── gtex_v8_mashr<br>│   │           └── mashr_Whole_Blood.db<br>│   └── predixcan_sample_data.tar<br>└── results<br>    └── vcf_1000G_hg37_mashr<br>        ├── Whole_Blood__association.txt<br>        ├── Whole_Blood__predict.txt<br>        └── Whole_Blood__summary.txt<br><br>15 directories, 129 files<br><br></code></pre><h2 data-tool="markdown.com.cn编辑器"><span></span>4. 准备工作</h2><pre data-tool="markdown.com.cn编辑器"><span></span><code># 路径准备<br>export DATA=/your_path/workdir/data/data  # 数据所在路径<br>export METAXCAN=/your_path/software/MetaXcan/software # 软件所在路径<br>RESULTS=/your_path/workdir/results # 结果输出路径<br></code></pre><pre data-tool="markdown.com.cn编辑器"><span></span><code># 激活环境<br>conda activate twas<br></code></pre><pre data-tool="markdown.com.cn编辑器"><span></span><code># 检查软件<br>nano verify_software.sh<br></code></pre><pre data-tool="markdown.com.cn编辑器"><span></span><code>#!/bin/bash<br># 验证软件是否安装成功<br><br># 定义依赖包和安装方式<br>conda_dependencies=(<br>    "pandas"<br>    "scipy"<br>    "numpy"<br>    "cyvcf2"<br>    "pyliftover"<br>    "statsmodels"<br>    "h5py"<br>    "pyarrow"<br>)<br><br>pip_dependency="bgen_reader"<br><br># 检查Conda安装的包<br>echo "Checking Conda dependencies..."<br>for package in "${conda_dependencies[@]}"; do<br>    if conda list | grep -q "^$package"; then<br>        echo "[OK] $package is installed via Conda."<br>    else<br>        echo "[MISSING] $package is not installed via Conda."<br>    fi<br>done<br><br># 检查Pip安装的包<br>echo "Checking Pip dependency..."<br>if pip show "$pip_dependency" &gt; /dev/null 2&gt;&amp;1; then<br>    echo "[OK] $pip_dependency is installed via Pip."<br>else<br>    echo "[MISSING] $pip_dependency is not installed via Pip."<br>fi<br><br>echo "Dependency check completed."<br><br></code></pre></section><section>参考：https://github.com/hakyimlab/PrediXcan</section><section><mp-common-profile data-pluginname="mpprofile" data-id="Mzk0MDI4MjM4NQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/Nf8QqUlJukMmaCXNABdtSPicSfZU9GMyI6PHia3Gqfy5DNMias3VicXY8Gh70vu1gibxsObqoGRRHYtJLKX6WbyeeNw/0?wx_fmt=png" data-nickname="生命数据科学" data-alias="Data_Research" data-signature="科研是天马行空的想象和脚踏实地的认真！" data-from="0" data-is_biz_ban="0" data-service_type="1"></mp-common-profile></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/qCjlgpv2PdkCfjTAu_1CGQ",target="_blank" rel="noopener noreferrer">原文链接</a>
