---
title: "对于咱们生信人来讲，通关了黑神话，显卡还能做点啥？GPU加速单细胞分析"
date: 2024-11-17T00:14:14Z
draft: ["false"]
tags: [
  "fetched",
  "生信钱同学"
]
categories: ["Acdemic"]
---
对于咱们生信人来讲，通关了黑神话，显卡还能做点啥？GPU加速单细胞分析 by 生信钱同学
------
<div><p>最近可算拿到了黑神话悟空的全成就，连续两周目的游戏实在是有点肝疼了。相信不少热衷3A游戏的朋友为了玩黑神话也入手了几款中高端显卡，游戏通关了，显卡可不能闲着，必须拿它盘点单细胞数据。</p><p><img data-backh="165" data-backw="329" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsbiaWVvfuAEH9EnwibGPP9Xl3Wumf27hXKn3zQnrb06DAE18Q7NbLxo4A/0?wx_fmt=png&amp;from=appmsg" data-cropx1="699.3788927335639" data-cropx2="2511.1557093425604" data-cropy1="231.29065743944636" data-cropy2="1139.932525951557" data-galleryid="" data-imgfileid="100005670" data-ratio="0.5009259259259259" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFs93XGY1qa3aZ66yxbo1Mcs2uQDKQpx7icQNxSDEgComQupGal5txibTsXmyaAW5vYI7VaNoBwRyALQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_jpg/7At0Eia3NQFs93XGY1qa3aZ66yxbo1Mcs2uQDKQpx7icQNxSDEgComQupGal5txibTsXmyaAW5vYI7VaNoBwRyALQ/640?wx_fmt=jpeg"></p><p>简单介绍下<span>rapids-singlecell：</span></p><p>Rapids-singlecell 作为 scanpy 的替代品，<span>提供增强的单细胞数据分析，并且</span>同时整合了 squidpy 和 decoupler 的部分功能。它通过 cupy 和 Nvidia 的 RAPIDS 实现 GPU 计算，强调高效计算，并且最终作为 scverse 生态系统的一部分，通过社区协作不断保持兼容性和发展。此外<span>rapids-singlecell还有几个独有的高变基因筛选方法：person_residual和poisson_gene_selection。</span></p><p><span>简而言之rapids-singlecell具有以下特性：</span></p><ol><li><p><span>GPU 优化：</span><span>利用 GPU 加速大数据集的处理。</span></p></li><li><p>集成 scverse 库：整合 scanpy 的主要功能，并增加 squidpy 和 decoupler 的特性。</p></li><li><p>简单的安装过程：可通过 Conda 和 PyPI 获取。</p><p><span></span></p><p><span></span></p></li></ol><p><span>整体而言<span>rapid</span><span>s-singlecell使用方法和scanpy几乎一致，可视化部分完全是调用scanpy函数完成，个别大计算量的部分转存到GPU的 RAM完成。差不多20w细胞数量的话，16G 显存的显卡刚好能够完成，时间差不多在10min左右的，还是很推荐高细胞数量的同学尝试使用下rsc的。</span></span></p><p><span>部署rapids-singlecell</span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="nginx"><code><span><span>git</span> clone https://github.com/scverse/rapids_singlecell.git</span></code><code><span><span>#mamba 创建虚拟环境</span></span></code><code><span><span>#推荐24.06版本，方便部署pytorch使用poisson_gene_selection筛选高边基因。</span></span></code><code><span>mamba env create -f conda/rsc_rapids_24.<span>06</span>.yml <span>#default CUDA-11.8</span></span></code><code><span><span># or</span></span></code><code><span>mamba env create -f conda/rsc_rapids_24.<span>08</span>.yml <span>#default CUDA-12.5</span></span></code></pre></section><p>激活环境</p><section><ul><li></ul><pre data-lang="nginx"><code><span><span>conda</span> activate rapids_singlecel</span></code></pre></section><p>加载包</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span><span># 导入 scanpy 库，用于单细胞基因组数据的处理</span></span></code><code><span><span>import</span> scanpy <span>as</span> sc</span></code><code><span><span># 导入 cupy 库，用于在 GPU 上进行加速计算</span></span></code><code><span><span>import</span> cupy <span>as</span> cp</span></code><code><span><br></span></code><code><span><span># 导入 time 库，用于计算运行时间</span></span></code><code><span><span>import</span> time</span></code><code><span><span># 导入 rapids_singlecell 库，用于增强的单细胞数据分析</span></span></code><code><span><span>import</span> rapids_singlecell <span>as</span> rsc</span></code><code><span><br></span></code><code><span><span># 导入 warnings 库并忽略警告信息，清理输出</span></span></code><code><span><span>import</span> warnings</span></code><code><span>warnings.filterwarnings(<span>"ignore"</span>)</span></code><code><span><br></span></code><code><span><span># 导入 rmm 库（RAPIDS 内存管理），设置自定义内存分配器</span></span></code><code><span><span>import</span> rmm</span></code><code><span><span>from</span> rmm.allocators.cupy <span>import</span> rmm_cupy_allocator</span></code><code><span><br></span></code><code><span><span># 初始化 RMM（RAPIDS Memory Manager）进行 GPU 内存管理</span></span></code><code><span>rmm.reinitialize(</span></code><code><span>    managed_memory=<span>False</span>,  <span># 禁用托管内存，避免超限</span></span></code><code><span>    pool_allocator=<span>False</span>,  <span># 禁用内存池分配器（默认值为 False）</span></span></code><code><span>    devices=<span>0</span>,  <span># 注册 GPU 设备 ID，这里仅注册 GPU 0</span></span></code><code><span>)</span></code><code><span><br></span></code><code><span><span># 将 cupy 的内存分配器设置为 RMM 的分配器，以便更高效的 GPU 内存管理</span></span></code><code><span>cp.cuda.set_allocator(rmm_cupy_allocator)</span></code><code><span><br></span></code></pre></section><p>加载预处理数据<br></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span><span># 计时代码执行时间</span></span></code><code><span>%%time</span></code><code><span><span># 读取单细胞数据文件（.h5ad 格式），并存储为 AnnData 对象</span></span></code><code><span>adata = sc.read(<span>"h5/adata.raw.h5ad"</span>)</span></code><code><span><br></span></code><code><span><span># 将 AnnData 对象转移到 GPU 上以加速计算</span></span></code><code><span>%%time</span></code><code><span>rsc.get.anndata_to_GPU(adata)</span></code><code><span><br></span></code><code><span><span># 标记基因家族，找到以 "MT-" 为前缀的基因并归类到 "MT" 家族</span></span></code><code><span>%%time</span></code><code><span>rsc.pp.flag_gene_family(adata, gene_family_name=<span>"MT"</span>, gene_family_prefix=<span>"MT-"</span>)</span></code><code><span><br></span></code><code><span><span># 标记基因家族，找到以 "RPS" 为前缀的基因并归类到 "RIBO" 家族</span></span></code><code><span>%%time</span></code><code><span>rsc.pp.flag_gene_family(adata, gene_family_name=<span>"RIBO"</span>, gene_family_prefix=<span>"RPS"</span>)</span></code><code><span><br></span></code><code><span><span># 计算质量控制指标，基于已标记的 "MT" 和 "RIBO" 基因家族</span></span></code><code><span>%%time</span></code><code><span>rsc.pp.calculate_qc_metrics(adata, qc_vars=[<span>"MT"</span>, <span>"RIBO"</span>])</span></code><code><span><br></span></code><code><span><span># 绘制散点图，展示 total_counts 和 pct_counts_MT 的关系</span></span></code><code><span>sc.pl.scatter(adata, x=<span>"total_counts"</span>, y=<span>"pct_counts_MT"</span>)</span></code><code><span><span># 绘制散点图，展示 total_counts 和 n_genes_by_counts 的关系</span></span></code><code><span>sc.pl.scatter(adata, x=<span>"total_counts"</span>, y=<span>"n_genes_by_counts"</span>)</span></code><code><span><br></span></code><code><span><span># 绘制小提琴图，显示各患者（PatientNumber）中的 n_genes_by_counts 分布，添加抖动效果</span></span></code><code><span>sc.pl.violin(adata, <span>"n_genes_by_counts"</span>, jitter=0.4, groupby=<span>"PatientNumber"</span>)</span></code><code><span><span># 绘制小提琴图，显示各患者中的 total_counts 分布，添加抖动效果</span></span></code><code><span>sc.pl.violin(adata, <span>"total_counts"</span>, jitter=0.4, groupby=<span>"PatientNumber"</span>)</span></code><code><span><span># 绘制小提琴图，显示各患者中的 pct_counts_MT 分布，添加抖动效果</span></span></code><code><span>sc.pl.violin(adata, <span>"pct_counts_MT"</span>, jitter=0.4, groupby=<span>"PatientNumber"</span>)</span></code><code><span><br></span></code><code><span><span># 根据基因数进行数据筛选，保留基因数在 200 到 5000 之间的细胞</span></span></code><code><span>%%time</span></code><code><span>adata = adata[adata.obs[<span>"n_genes_by_counts"</span>] &gt; 200]</span></code><code><span>adata = adata[adata.obs[<span>"n_genes_by_counts"</span>] &lt; 5000]</span></code><code><span>adata.shape</span></code><code><span><br></span></code><code><span><span># 根据线粒体基因比例筛选，保留线粒体基因比例小于 20% 的细胞</span></span></code><code><span>%%time</span></code><code><span>adata = adata[adata.obs[<span>"pct_counts_MT"</span>] &lt; 20]</span></code><code><span>adata.shape</span></code><code><span><br></span></code><code><span><span># 对基因进行过滤，保留至少出现 3 次的基因</span></span></code><code><span>%%time</span></code><code><span>rsc.pp.filter_genes(adata, min_count=3)</span></code><code><span><br></span></code><code><span><span># 将原始计数数据复制到 AnnData 对象的 "counts" 层中，便于进一步分析</span></span></code><code><span>adata.layers[<span>"counts"</span>] = adata.X.copy()</span></code><code><span><br></span></code></pre></section><p><img data-imgfileid="100005674" data-ratio="0.6781609195402298" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsSgzibgCzwmJ95ZOUjWJ73G8S0ZUg7laP4cWwEVZdAsq1Mb76IIKSQnA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="609" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsSgzibgCzwmJ95ZOUjWJ73G8S0ZUg7laP4cWwEVZdAsq1Mb76IIKSQnA/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100005680" data-ratio="0.6597444089456869" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsLSEfRQVjrH5cr3ibFNmlLn5ql1Y64VyBjtjX7o1EQHSYSaWk7x7wo9Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="626" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsLSEfRQVjrH5cr3ibFNmlLn5ql1Y64VyBjtjX7o1EQHSYSaWk7x7wo9Q/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-imgfileid="100005678" data-ratio="0.6597444089456869" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsLzdmCaVSG6fbYD4ibsyFJKKhtqMXiapicbW0EIECCoxF4mwZMhnHEd6oA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="626" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsLzdmCaVSG6fbYD4ibsyFJKKhtqMXiapicbW0EIECCoxF4mwZMhnHEd6oA/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100005682" data-ratio="0.6413043478260869" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsliaTMbJagJUrtQib80CPUNTHGdGRia2MLTdiaQR6MZcyAibNPSX285cF0Uw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="644" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsliaTMbJagJUrtQib80CPUNTHGdGRia2MLTdiaQR6MZcyAibNPSX285cF0Uw/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100005683" data-ratio="0.6781609195402298" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McscY7ehibZuj6rn85Wy6MwQyWvPxicHQsvlAPQEu8MsMllAAG3GCoQLpiaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="609" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McscY7ehibZuj6rn85Wy6MwQyWvPxicHQsvlAPQEu8MsMllAAG3GCoQLpiaA/640?wx_fmt=png&amp;from=appmsg"></p><p>标准化数据</p><section><ul><li><li><li><li><li><li><li></ul><pre data-lang="shell"><code><span><span>#</span> 归一化总计数，使每个细胞的总基因表达量达到指定的目标值（1e4），以便进行比较</span></code><code><span><span>%</span>%time</span></code><code><span>rsc.pp.normalize_total(adata, target_sum=1e4)</span></code><code><span><br></span></code><code><span><span>#</span> 对数据进行对数转换（log1p），即 <span>log</span>(1 + x)，使数据更适合下游分析</span></code><code><span><span>%</span>%time</span></code><code><span>rsc.pp.log1p(adata)</span></code></pre></section><p>挑选高变基因</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span><span># 标记高度变异的基因，使用 Seurat v3 方法，每批次提取前 5000 个变异较大的基因（按患者编号分批次）</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.pp.highly_variable_genes(</span></code><code><span>    adata,</span></code><code><span>    n_top_genes=<span>5000</span>,</span></code><code><span>    flavor=<span>"seurat_v3"</span>,</span></code><code><span>    batch_key=<span>"PatientNumber"</span>,</span></code><code><span>    layer=<span>"counts"</span>,</span></code><code><span>)</span></code><code><span><br></span></code><code><span><span># 将原始数据存储到 adata.raw 中，便于后续回溯到未处理的基因表达数据</span></span></code><code><span>%%<span>time</span></span></code><code><span>adata.raw = adata</span></code><code><span><br></span></code><code><span><span># 根据高度变异的基因筛选数据，仅保留这些基因用于下游分析</span></span></code><code><span>%%<span>time</span></span></code><code><span>adata = adata[:, adata.var[<span>"highly_variable"</span>]]</span></code><code><span><br></span></code><code><span><span># 回归处理，去除 total_counts 和 pct_counts_MT 的影响，以减少潜在的批次效应</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.pp.regress_out(adata, <span>keys</span>=[<span>"total_counts"</span>, <span>"pct_counts_MT"</span>])</span></code><code><span><br></span></code></pre></section><p>数据缩放</p><section><ul><li><li><li><li></ul><pre data-lang="shell"><code><span><span>#</span> 标准化数据，使每个基因的平均值为 0，标准差为 1，并限制最大值为 10，以减少异常值的影响</span></code><code><span><span>%</span>%time</span></code><code><span>rsc.pp.scale(adata, max_value=10)</span></code><code><span><br></span></code></pre></section><p>主成分分析</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span><span># 进行主成分分析（PCA），提取前 100 个主成分，用于降维和特征提取</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.pp.pca(adata, n_comps=<span>100</span>)</span></code><code><span><br></span></code><code><span><span># 绘制主成分方差比图（PCA 解释方差），展示前 100 个主成分的对数方差贡献</span></span></code><code><span>sc.pl.pca_variance_ratio(adata, <span>log</span>=True, n_pcs=<span>100</span>)</span></code><code><span><br></span></code><code><span><span># 将 AnnData 对象从 GPU 转移到 CPU，指定 convert_all=True 以确保所有数据转移</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.get.anndata_to_CPU(adata, convert_all=True)</span></code><code><span><br></span></code><code><span><br></span></code></pre></section><p><img data-imgfileid="100005684" data-ratio="0.8031914893617021" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsTF2p65ybADT8GRRFicvEMxXeTNuugG6LvS1tkAIIvnHu21Ag6GPxJhA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="564" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsTF2p65ybADT8GRRFicvEMxXeTNuugG6LvS1tkAIIvnHu21Ag6GPxJhA/640?wx_fmt=png&amp;from=appmsg"></p><p>批次效应矫正</p><section><ul><li><li><li><li></ul><pre data-lang="shell"><code><span><span>#</span> 使用 Harmony 算法进行数据整合，以 <span>"PatientNumber"</span> 为批次键，调整不同患者间的批次效应</span></code><code><span><span>%</span>%time</span></code><code><span>rsc.pp.harmony_integrate(adata, key="PatientNumber")</span></code><code><span><br></span></code></pre></section><p>聚类可视化</p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span><span># 计算邻居关系，基于 40 个主成分，并使用 15 个邻居，用于后续的降维和聚类分析</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.pp.neighbors(adata, n_neighbors=<span>15</span>, n_pcs=<span>40</span>)</span></code><code><span><br></span></code><code><span><span># 进行 UMAP 降维，得到二维表示，用于可视化</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.tl.umap(adata)</span></code><code><span><br></span></code><code><span><span># 使用 Louvain 算法进行聚类，设置分辨率为 0.6</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.tl.louvain(adata, resolution=<span>0</span>.<span>6</span>)</span></code><code><span><br></span></code><code><span><span># 使用 Leiden 算法进行聚类，设置分辨率为 0.6</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.tl.leiden(adata, resolution=<span>0</span>.<span>6</span>)</span></code><code><span><br></span></code><code><span><span># 绘制 UMAP 图，显示 Louvain 和 Leiden 聚类结果</span></span></code><code><span>%%<span>time</span></span></code><code><span>sc.pl.umap(adata, color=[<span>"louvain"</span>, <span>"leiden"</span>], legend_loc=<span>"on data"</span>)</span></code><code><span><br></span></code><code><span><span># 绘制 UMAP 图，显示细胞类型（CellType）和患者编号（PatientNumber）信息</span></span></code><code><span>sc.pl.umap(adata, color=[<span>"CellType"</span>, <span>"PatientNumber"</span>])</span></code><code><span><br></span></code><code><span><span># 计算基于患者编号（PatientNumber）的嵌入密度，并进行可视化</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.tl.embedding_density(adata, groupby=<span>"PatientNumber"</span>)</span></code><code><span>sc.pl.embedding_density(adata, groupby=<span>"PatientNumber"</span>)</span></code><code><span><br></span></code><code><span><span># 进行 t-SNE 降维，使用前 40 个主成分进行可视化</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.tl.tsne(adata, n_pcs=<span>40</span>)</span></code><code><span><br></span></code><code><span><span># 使用 K-means 算法进行聚类，设置聚类数为 8</span></span></code><code><span>rsc.tl.kmeans(adata, n_clusters=<span>8</span>)</span></code><code><span><br></span></code><code><span><span># 绘制 t-SNE 图，显示 K-means 聚类结果</span></span></code><code><span>%%<span>time</span></span></code><code><span>sc.pl.tsne(adata, color=[<span>"kmeans"</span>], legend_loc=<span>"on data"</span>)</span></code><code><span><br></span></code><code><span><span># 绘制 t-SNE 图，显示细胞类型（CellType）和患者编号（PatientNumber）信息</span></span></code><code><span>sc.pl.tsne(adata, color=[<span>"CellType"</span>, <span>"PatientNumber"</span>])</span></code><code><span><br></span></code></pre></section><p><img data-imgfileid="100005685" data-ratio="0.37407407407407406" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1Mcs5PqVZQGIkJibfSrjltd4SicFfr8So8OgosVzbeQ9l3GkDQk3Ktx0pf9A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1Mcs5PqVZQGIkJibfSrjltd4SicFfr8So8OgosVzbeQ9l3GkDQk3Ktx0pf9A/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-imgfileid="100005686" data-ratio="0.3537037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsrEuzC3L45oicz6jkGIkzS4gHSibNrNbicUHDhibOBUyngIukraiaK7CfiaQQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsrEuzC3L45oicz6jkGIkzS4gHSibNrNbicUHDhibOBUyngIukraiaK7CfiaQQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-imgfileid="100005687" data-ratio="0.35833333333333334" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsUxS3zwdt3oIPl939QrGIVBCByv1Smrw9ic3ia2UCzVcHq9JWAKNrCibLQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsUxS3zwdt3oIPl939QrGIVBCByv1Smrw9ic3ia2UCzVcHq9JWAKNrCibLQ/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-imgfileid="100005688" data-ratio="0.8018691588785046" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McscvRlH5225BSRZF23vTCrQys68pQefuic6HBk1raaAyb5hbGticG8cHiaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="535" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McscvRlH5225BSRZF23vTCrQys68pQefuic6HBk1raaAyb5hbGticG8cHiaA/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-imgfileid="100005689" data-ratio="0.3537037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1Mcs8O8wEl2piczsMo6mSeSdRxv3FjgEl7eJ5gQUbiagE7qytDsjaf9Mibkng/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1Mcs8O8wEl2piczsMo6mSeSdRxv3FjgEl7eJ5gQUbiagE7qytDsjaf9Mibkng/640?wx_fmt=png&amp;from=appmsg"></p><p>差异基因</p><section><ul><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span><span># 使用逻辑回归（logreg）方法对不同细胞类型（CellType）进行差异基因分析，使用非原始数据（use_raw=False）</span></span></code><code><span>%%<span>time</span></span></code><code><span>rsc.tl.rank_genes_groups_logreg(adata, groupby=<span>"CellType"</span>, use_raw=False)</span></code><code><span><br></span></code><code><span><span># 绘制前 20 个差异基因的图表</span></span></code><code><span>%%<span>time</span></span></code><code><span>sc.pl.rank_genes_groups(adata, n_genes=<span>20</span>)</span></code><code><span><br></span></code></pre></section><p><img data-imgfileid="100005690" data-ratio="0.5796296296296296" data-src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsuecRibFOAdGZwX2t5JH3uNibSCicBcuStA2F0sQrnQHEcia7VDDPnFClxw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/7At0Eia3NQFs93XGY1qa3aZ66yxbo1McsuecRibFOAdGZwX2t5JH3uNibSCicBcuStA2F0sQrnQHEcia7VDDPnFClxw/640?wx_fmt=png&amp;from=appmsg"></p><p>双细胞过滤<span></span></p><section><ul><li></ul><pre data-lang="javascript"><code><span>rsc.pp.scrublet(adata,batch_key=<span>"PatientNumber"</span>)</span></code></pre></section><p>rsc的单细胞的部分就介绍到这边了，主要的功能和模块就这些部分了。当然后续有时间会和大家分享rsc包的空转部分和富集分析模块，其中的富集分析还是很值得学习一下的。<span>最后祝</span><span>愿大家在这条探索单</span><span>细胞世界的道路上，始终保持初心，勇往直前，最终实现知识的圆满，完成学术的理想，全始全终！</span></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/35wVjUqygq5mXtL0x-OquQ",target="_blank" rel="noopener noreferrer">原文链接</a>
