---
title: "临床预测模型—C指数(C-index)和时间ROC(timeROC)曲线绘制学习"
date: 2024-11-23T14:22:29Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
临床预测模型—C指数(C-index)和时间ROC(timeROC)曲线绘制学习 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">关于概念，可以阅读笔者的或者其他老师的推文：</p><ol data-tool="mdnice编辑器"><li><section>基础概念：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247484082&amp;idx=1&amp;sn=6c73cc25fddacf9a2ee06dd5e37a63be&amp;chksm=c0a3f447f7d47d512ae480453edac6ba176d4e7e6e4e83afc26477e81ac8657accdbe34a0110&amp;scene=21#wechat_redirect" textvalue="临床预测模型概述5-临床预测模型评价指标(区分度，校准度和临床决策曲线）" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">临床预测模型概述5-临床预测模型评价指标(区分度，校准度和临床决策曲线）</a><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247483869&amp;idx=1&amp;sn=805a31f69ca94f16c68a4f19b2486bb2&amp;chksm=c0a3f728f7d47e3e6e09885f29e00f0f13b223e16fe5c3a82f115a2077a999a10595b39a0fe1&amp;scene=21#wechat_redirect" textvalue="临床预测模型概述4-统计模型(Logistic，Cox，Lasso)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">临床预测模型概述4-统计模型(Logistic，Cox，Lasso)</a></section></li><li><section>logistic和cox回归：<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247484625&amp;idx=1&amp;sn=a6ba2d4935982195ee4fc7ed41ca81a4&amp;chksm=c0a3f224f7d47b32365bb4404d9b17c6b029b54416dc1000344006202f9c12e0c0100015f128&amp;scene=21#wechat_redirect" textvalue="临床预测模型概述6-统计模型实操-单/多因素Logistic回归" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">临床预测模型概述6-统计模型实操-单/多因素Logistic回归</a> <a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkwMjYyMDA1OA==&amp;mid=2247484638&amp;idx=1&amp;sn=fd473ecf5fa7110ecd6c759b14c6a8cc&amp;chksm=c0a3f22bf7d47b3dd4da1a1770cce3302ff57a52345dffa0cc0397027e5e7bc6214f9f3bc6e1&amp;scene=21#wechat_redirect" textvalue="临床预测模型概述6-统计模型实操-单/多因素Cox回归" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">临床预测模型概述6-统计模型实操-单/多因素Cox回归</a></section></li></ol><h4 data-tool="mdnice编辑器"><span></span>分析流程<span></span></h4><h5 data-tool="mdnice编辑器"><span></span>1.导入<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(stringr)<br><span>library</span>(survival)<br><span>library</span>(survminer)<br>proj &lt;- <span>"ttt"</span><br>load(<span>'data.Rdata'</span>) <span># TCGA-HNSC数据</span><br></code></pre><h5 data-tool="mdnice编辑器"><span></span>2.数据预处理<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>colnames(meta)<br>variables &lt;- c(<span>"cluster"</span>, <span>"gender"</span>, <span>"neoadjuvant"</span>)<br>meta &lt;- cbind(meta[,c(<span>1</span>:<span>3</span>)],<br>              meta[,c(<span>"cluster"</span>, <span>"gender"</span>, <span>"neoadjuvant"</span>)])<br><br>data &lt;- meta<br>data &lt;- na.omit(data)<br>dim(data)<br><br><span># 如果是连续的代码，需要设置data</span><br>data$OS.time &lt;- data$OS.time<br><br><span># 对变量进行因子化</span><br>data$cluster &lt;- factor(data$cluster,levels = c(<span>"1"</span>,<span>"2"</span>))<br>data$gender &lt;- factor(data$gender,levels = c(<span>"FEMALE"</span>,<span>"MALE"</span>))<br>data$neoadjuvant &lt;- factor(data$neoadjuvant,levels = c(<span>"No"</span>,<span>"Yes"</span>))<br><br><span># 数据分割 7:3,8:2 均可</span><br><span># 划分是随机的，设置种子数可以让结果复现</span><br>set.seed(<span>123</span>)<br>ind &lt;- sample(<span>1</span>:nrow(data), size = <span>0.7</span>*nrow(data))<br>train &lt;- data[ind,]<br>test &lt;- data[-ind, ]<br></code></pre><h5 data-tool="mdnice编辑器"><span></span>3.coxph计算C-index<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span># 训练集c-index和95%CI</span><br>Ctrain &lt;- coxph(Surv(OS.time,OS)~cluster+gender+neoadjuvant,data=train)<br>summary(Ctrain)<br><span># Call:</span><br><span># coxph(formula = Surv(OS.time, OS) ~ cluster + gender + neoadjuvant, </span><br><span>#     data = train)</span><br><span># </span><br><span>#   n= 345, number of events= 142 </span><br><span># </span><br><span>#                   coef exp(coef) se(coef)      z Pr(&gt;|z|)  </span><br><span># cluster2        0.3916    1.4793   0.1713  2.285   0.0223 *</span><br><span># genderMALE     -0.3254    0.7223   0.1793 -1.815   0.0695 .</span><br><span># neoadjuvantYes  0.2128    1.2371   0.4674  0.455   0.6490  </span><br><span># ---</span><br><span># Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><br><span># </span><br><span>#                exp(coef) exp(-coef) lower .95 upper .95</span><br><span># cluster2          1.4793     0.6760    1.0573     2.070</span><br><span># genderMALE        0.7223     1.3845    0.5083     1.026</span><br><span># neoadjuvantYes    1.2371     0.8084    0.4949     3.092</span><br><span># </span><br><span># Concordance= 0.565  (se = 0.025 )</span><br><span># Likelihood ratio test= 8.81  on 3 df,   p=0.03</span><br><span># Wald test            = 9.07  on 3 df,   p=0.03</span><br><span># Score (logrank) test = 9.18  on 3 df,   p=0.03</span><br><br><span># 这里的Concordance就是C指数,为0.565</span><br><br><span># 验证集c-index和95%CI</span><br><span># 这里中间的环节是使用predict函数去预测test数据集中每个样本的风险值</span><br><span># 然后将得到的每个样本的风险值再进行coxph拟合成一个新的函数</span><br><span># 最后使用predict(Ctrain, newdata = test)计算的风险评分作为一个新的自变量来拟合Cox模型</span><br>Ctest &lt;- coxph(Surv(OS.time,OS)~predict(Ctrain,newdata = test,type=<span>"lp"</span>),data =test)<br>summary(Ctest)<br><span># Call:</span><br><span># coxph(formula = Surv(OS.time, OS) ~ predict(Ctrain, newdata = test, </span><br><span>#     type = "lp"), data = test)</span><br><span># </span><br><span>#   n= 148, number of events= 70 </span><br><span># </span><br><span>#                                                coef exp(coef) se(coef)     z Pr(&gt;|z|)   </span><br><span># predict(Ctrain, newdata = test, type = "lp") 1.2090    3.3501   0.4553 2.656  0.00792 **</span><br><span># ---</span><br><span># Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><br><span># </span><br><span>#                                              exp(coef) exp(-coef) lower .95 upper .95</span><br><span># predict(Ctrain, newdata = test, type = "lp")      3.35     0.2985     1.373     8.176</span><br><span># </span><br><span># Concordance= 0.607  (se = 0.036 )</span><br><span># Likelihood ratio test= 6.74  on 1 df,   p=0.009</span><br><span># Wald test            = 7.05  on 1 df,   p=0.008</span><br><span># Score (logrank) test = 7.18  on 1 df,   p=0.007</span><br><br><span># 这里的Concordance就是C指数,为0.607</span><br></code></pre><h5 data-tool="mdnice编辑器"><span></span>4.时间依赖的ROC曲线<span></span></h5><h6 data-tool="mdnice编辑器"><span></span>方法一(survivalROC)<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code><span>################## 训练集</span><br><span># 拟合 Cox 回归模型</span><br>fit &lt;- coxph(Surv(OS.time,OS)~cluster+gender+neoadjuvant,data=train)<br><br><span># 训练集12,24和36个月的死亡概率</span><br><span># 为什么需要计算死亡概率,这是因为我们这里的发生事件是死亡！！</span><br><span># 其他的就用其他的含义哈~ 比如疾病发生率啥的</span><br>train$deadPro12 &lt;- c(<span>1</span> - (summary(survfit(fit, newdata = train), times = <span>12</span>)$surv))<br>train$deadPro24 &lt;- c(<span>1</span> - (summary(survfit(fit, newdata = train), times = <span>24</span>)$surv))<br>train$deadPro36 &lt;- c(<span>1</span> - (summary(survfit(fit, newdata = train), times = <span>24</span>)$surv))<br><br><span># 验证集 3 个月和 6 个月死亡概率</span><br>test$deadPro12 &lt;- c(<span>1</span> - (summary(survfit(fit, newdata = test), times = <span>12</span>)$surv))<br>test$deadPro24 &lt;- c(<span>1</span> - (summary(survfit(fit, newdata = test), times = <span>24</span>)$surv))<br>test$deadPro36 &lt;- c(<span>1</span> - (summary(survfit(fit, newdata = test), times = <span>24</span>)$surv))<br><br><span># 开始计算</span><br><span>library</span>(survivalROC)<br><br><span># 训练集用"KM"法拟合12个月生存的ROC曲线</span><br>SROC &lt;- survivalROC(Stime = train$OS.time, <br>                    status = train$OS,<br>                    marker = train$deadPro12,<br>                    predict.time = <span>12</span>, <br>                    method = <span>"KM"</span>)<br><br><span># 计算最佳截断值</span><br>cut.op &lt;- SROC$cut.values[which.max(SROC$TP - SROC$FP)]<br>cut.op  <span># 输出最佳断值，注意这里是12月死亡率</span><br><span># 把SROC转化为dataFrame</span><br>SROC_df &lt;- as.data.frame(SROC)<br><br><span># 训练集用"KM"法拟合24个月生存的ROC曲线</span><br>SROC1 &lt;- survivalROC(Stime = train$OS.time, <br>                    status = train$OS,<br>                    marker = train$deadPro24,<br>                    predict.time = <span>24</span>, <br>                    method = <span>"KM"</span>)<br><br><span># 计算最佳截断值</span><br>cut.op &lt;- SROC1$cut.values[which.max(SROC1$TP - SROC1$FP)]<br>cut.op  <br><span># 把SROC1转化为dataFrame</span><br>SROC1_df &lt;- as.data.frame(SROC1)<br><br><span># 训练集用"KM"法拟合24个月生存的ROC曲线</span><br>SROC2 &lt;- survivalROC(Stime = train$OS.time, <br>                    status = train$OS,<br>                    marker = train$deadPro36,<br>                    predict.time = <span>36</span>, <br>                    method = <span>"KM"</span>)<br><br><span># 计算最佳截断值</span><br>cut.op &lt;- SROC2$cut.values[which.max(SROC2$TP - SROC2$FP)]<br>cut.op  <br><span># 把SROC1转化为dataFrame</span><br>SROC2_df &lt;- as.data.frame(SROC2)<br><br><span>################## 验证集</span><br><span># 训练集用"KM"法拟合12个月生存的ROC曲线</span><br>AROC &lt;- survivalROC(Stime = test$OS.time, <br>                    status = test$OS,<br>                    marker = test$deadPro12,<br>                    predict.time = <span>12</span>, <br>                    method = <span>"KM"</span>)<br><br><span># 计算最佳截断值</span><br>cut.op &lt;- AROC$cut.values[which.max(AROC$TP - AROC$FP)]<br>cut.op  <span># 输出最佳断值，注意这里是12月死亡率</span><br><span># 把SROC转化为dataFrame</span><br>AROC_df &lt;- as.data.frame(AROC)<br><br><span># 训练集用"KM"法拟合24个月生存的ROC曲线</span><br>AROC1 &lt;- survivalROC(Stime = test$OS.time, <br>                    status = test$OS,<br>                    marker = test$deadPro24,<br>                    predict.time = <span>24</span>, <br>                    method = <span>"KM"</span>)<br><br><span># 计算最佳截断值</span><br>cut.op &lt;- AROC1$cut.values[which.max(AROC1$TP - AROC1$FP)]<br>cut.op  <br><span># 把SROC1转化为dataFrame</span><br>AROC1_df &lt;- as.data.frame(AROC1)<br><br><span># 训练集用"KM"法拟合24个月生存的ROC曲线</span><br>AROC2 &lt;- survivalROC(Stime = test$OS.time, <br>                    status = test$OS,<br>                    marker = test$deadPro36,<br>                    predict.time = <span>36</span>, <br>                    method = <span>"KM"</span>)<br><br><span># 计算最佳截断值</span><br>cut.op &lt;- AROC2$cut.values[which.max(AROC2$TP - AROC2$FP)]<br>cut.op  <br><span># 把SROC1转化为dataFrame</span><br>AROC2_df &lt;- as.data.frame(AROC2)<br></code></pre><h6 data-tool="mdnice编辑器"><span></span>可视化(survivalROC)<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code><span>################## 训练集</span><br><span># SROC_df, SROC1_df, SROC2_df分别是 12, 24, 36个月的数据</span><br>SROC_df$time_point &lt;- <span>"12 months"</span><br>SROC1_df$time_point &lt;- <span>"24 months"</span><br>SROC2_df$time_point &lt;- <span>"36 months"</span><br>SROC_total &lt;- rbind(SROC_df,SROC1_df,SROC2_df)<br><span># 提取 AUC 值</span><br>auc_12 &lt;- unique(SROC_df$AUC)[<span>1</span>]<br>auc_24 &lt;- unique(SROC1_df$AUC)[<span>1</span>]<br>auc_36 &lt;- unique(SROC2_df$AUC)[<span>1</span>]<br><span># 设置颜色和线条标签</span><br>colors &lt;- c(<span>"12 months"</span> = <span>"red"</span>, <span>"24 months"</span> = <span>"blue"</span>, <span>"36 months"</span> = <span>"orange"</span>)<br>labels &lt;- c(<br>  paste(<span>"AUC at 1 year:"</span>, round(auc_12, <span>3</span>)),<br>  paste(<span>"AUC at 2 years:"</span>, round(auc_24, <span>3</span>)),<br>  paste(<span>"AUC at 3 years:"</span>, round(auc_36, <span>3</span>))<br>)<br><br><span># TP就是敏感度，FP就是1-特异度</span><br><span># 使用 ggplot2 绘制带 AUC 信息的 ROC 曲线</span><br>ggplot(SROC_total, aes(x = FP, y = TP, color = time_point)) +<br>  geom_line(size = <span>1</span>) +<br>  geom_abline(intercept = <span>0</span>, slope = <span>1</span>, linetype = <span>"dashed"</span>) +<br>  labs(<br>    title = <span>"ROC Curve (Train)"</span>,<br>    x = <span>"False Positive Rate (FP)"</span>,<br>    y = <span>"True Positive Rate (TP)"</span><br>  ) +<br>  theme_minimal() +<br>  theme(<br>    plot.title = element_text(hjust = <span>0.5</span>),<br>    legend.position = c(<span>0.8</span>, <span>0.15</span>),  <span># 控制图例的位置，(x, y) 取值范围 0 到 1</span><br>    legend.background = element_rect(fill = <span>"white"</span>, color = <span>"black"</span>),  <span># 添加白色背景和边框</span><br>    legend.title = element_blank()  <span># 移除图例标题</span><br>  ) +<br>  scale_color_manual(<br>    values = colors,<br>    labels = labels<br>  )<br>ggsave(<span>"ROCurve(train).pdf"</span>,width = <span>9</span>,height = <span>7</span>)<br><span>################## 验证集</span><br><span># AROC_df, AROC1_df, AROC2_df分别是 12, 24, 36个月的数据</span><br>AROC_df$time_point &lt;- <span>"12 months"</span><br>AROC1_df$time_point &lt;- <span>"24 months"</span><br>AROC2_df$time_point &lt;- <span>"36 months"</span><br>AROC_total &lt;- rbind(AROC_df,AROC1_df,AROC2_df)<br><span># 提取 AUC 值</span><br>auc_12 &lt;- unique(AROC_df$AUC)[<span>1</span>]<br>auc_24 &lt;- unique(AROC1_df$AUC)[<span>1</span>]<br>auc_36 &lt;- unique(AROC2_df$AUC)[<span>1</span>]<br><span># 设置颜色和线条标签</span><br>colors &lt;- c(<span>"12 months"</span> = <span>"red"</span>, <span>"24 months"</span> = <span>"blue"</span>, <span>"36 months"</span> = <span>"orange"</span>)<br>labels &lt;- c(<br>  paste(<span>"AUC at 1 year:"</span>, round(auc_12, <span>3</span>)),<br>  paste(<span>"AUC at 2 years:"</span>, round(auc_24, <span>3</span>)),<br>  paste(<span>"AUC at 3 years:"</span>, round(auc_36, <span>3</span>))<br>)<br><br><span># TP就是敏感度，FP就是1-特异度</span><br><span># 使用 ggplot2 绘制带 AUC 信息的 ROC 曲线</span><br>ggplot(AROC_total, aes(x = FP, y = TP, color = time_point)) +<br>  geom_line(size = <span>1</span>) +<br>  geom_abline(intercept = <span>0</span>, slope = <span>1</span>, linetype = <span>"dashed"</span>) +<br>  labs(<br>    title = <span>"ROC Curve (Test)"</span>,<br>    x = <span>"False Positive Rate (FP)"</span>,<br>    y = <span>"True Positive Rate (TP)"</span><br>  ) +<br>  theme_minimal() +<br>  theme(<br>    plot.title = element_text(hjust = <span>0.5</span>),<br>    legend.position = c(<span>0.8</span>, <span>0.15</span>),  <span># 控制图例的位置，(x, y) 取值范围 0 到 1</span><br>    legend.background = element_rect(fill = <span>"white"</span>, color = <span>"black"</span>),  <span># 添加白色背景和边框</span><br>    legend.title = element_blank()  <span># 移除图例标题</span><br>  ) +<br>  scale_color_manual(<br>    values = colors,<br>    labels = labels<br>  )<br>ggsave(<span>"ROCurve(test).pdf"</span>,width = <span>9</span>,height = <span>7</span>)<br></code></pre><p data-tool="mdnice编辑器"><img data-imgfileid="100003280" data-ratio="0.7826666666666666" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGpRAAulrzmsZQTlsXCKf2mUe4lTib49gUibLKdp8sZBl4cupjcYD1ictXaEShiaCQgMw43xqfGjHp1ibw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="750" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGpRAAulrzmsZQTlsXCKf2mUe4lTib49gUibLKdp8sZBl4cupjcYD1ictXaEShiaCQgMw43xqfGjHp1ibw/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100003279" data-ratio="0.7786666666666666" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGpRAAulrzmsZQTlsXCKf2mUPHTTvJnZ7EIQWwpDqUNHfWsGPY9ugQYaK0mR2f48MSdQcqqic2ibuPA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="750" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGpRAAulrzmsZQTlsXCKf2mUPHTTvJnZ7EIQWwpDqUNHfWsGPY9ugQYaK0mR2f48MSdQcqqic2ibuPA/640?wx_fmt=png&amp;from=appmsg"></p><h5 data-tool="mdnice编辑器"><span></span>方法二(timeROC)<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code><span># 训练集建模</span><br>fit &lt;- coxph(Surv(OS.time,OS)~cluster+gender+neoadjuvant,data=train)<br>variables &lt;- c(<span>"cluster"</span>,<span>"gender"</span>,<span>"neoadjuvant"</span>)<br><br><span># 数据整合,分别提取想要分析的数据</span><br>val_dd_list2 &lt;- list(<br>  Train = train[, c(<span>"OS.time"</span>, <span>"OS"</span>, variables)],<br>  Test = test[, c(<span>"OS.time"</span>, <span>"OS"</span>, variables)]<br>)<br><br><span># 预测并计算 C-index</span><br>rs &lt;- lapply(val_dd_list2, <span>function</span>(x) {<br>  cbind(x[, <span>1</span>:<span>2</span>],RS = predict(fit, newdata = x,type = <span>"lp"</span>))<br>})<br></code></pre><h6 data-tool="mdnice编辑器"><span></span>可视化(timeROC)<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code><span># C-index--绘制</span><br><span>library</span>(timeROC)<br><span># 计算时间依赖性ROC曲线和AUC（使用第一个验证数据集作为示例）</span><br><br><span># 命名</span><br>g &lt;- <span>"Test"</span><br><br><span># 定义一个函数来根据名称查找数据集在列表中的位置</span><br>find_dataset_position &lt;- <span>function</span>(list, dataset_name) {<br>  <span># 在列表的名称中查找匹配的数据集名称</span><br>  position &lt;- which(names(list) == dataset_name)<br>  <span># 返回位置</span><br>  <span>return</span>(position)<br>}<br><span># 使用例子</span><br>position &lt;- find_dataset_position(rs, g)<br>print(position)<br>i &lt;- position <br><br><span># 开始计算</span><br>ROC &lt;- timeROC(<span>T</span> = rs[[i]]$OS.time,<br>               delta = rs[[i]]$OS,<br>               marker = rs[[i]]$RS,<br>               cause = <span>1</span>,<br>               weighting = <span>"marginal"</span>,   <span>#计算方法默认marginal</span><br>               times = c(<span>12</span>,<span>24</span>,<span>36</span>),<br>               iid = <span>TRUE</span>)<br><br>ROC<br><br><span>#开始绘图</span><br>pdf(paste0(g,<span>".pdf"</span>),width = <span>6</span>, height = <span>6</span>)<br>plot(ROC,<br>     time = <span>12</span>,<br>     title = <span>F</span>, <span>#timeROC不能直接添加标题，要额外添加</span><br>     col= <span>"#f5695e"</span>,<br>     <span>#print.thres.col="black",</span><br>     <span>#identity.col="grey", timeROC函数中这个没用</span><br>     lwd = <span>3</span>,<br>     cex.main = <span>1.5</span>,  <span># 主标题字体大小</span><br>     cex.lab = <span>1.2</span>,   <span># 轴标签字体大小</span><br>     cex.axis = <span>1</span>,  <span># 刻度字体大小</span><br>     font.main = <span>1</span>,   <span># 主标题字体样式（1为普通，2为粗体）</span><br>     font.lab = <span>1</span>,    <span># 轴标签字体样式</span><br>     font.axis = <span>1</span>)   <span># 刻度字体样式</span><br><span># 添加一条灰色的对角线</span><br>abline(a = <span>0</span>, b = <span>1</span>, col = <span>"grey"</span>, lty = <span>2</span>, lwd = <span>2</span>)<br><br><span># 使用 title() 函数添加额外的图形标题</span><br>title(main = paste0(<span>"ROC Curve("</span>,g,<span>")"</span>))<br><br><span>#添加线</span><br>plot(ROC,<br>     time=<span>24</span>, col=<span>"#2667bb"</span>, add=<span>TRUE</span>, lwd=<span>2</span>)    <span>#add指是否添加在上一张图中</span><br><br>plot(ROC,<br>     time=<span>36</span>, col=<span>"#e6b707"</span>, add=<span>TRUE</span>, lwd=<span>2</span>)<br><br><span>#添加标签信息</span><br>legend(<span>"bottomright"</span>,<br>       c(paste0(<span>"AUC at 1 year: "</span>,round(ROC[[<span>"AUC"</span>]][<span>1</span>],<span>3</span>)), <br>         paste0(<span>"AUC at 2 year: "</span>,round(ROC[[<span>"AUC"</span>]][<span>2</span>],<span>3</span>)), <br>         paste0(<span>"AUC at 3 year: "</span>,round(ROC[[<span>"AUC"</span>]][<span>3</span>],<span>3</span>))),<br>       col=c(<span>"#f5695e"</span>, <span>"#2667bb"</span>, <span>"#e6b707"</span>),<br>       lty=<span>1</span>, lwd=<span>2</span>,bty = <span>"o"</span>) <br><br>dev.off()  <span># 关闭设备，完成保存</span><br></code></pre><p data-tool="mdnice编辑器"><img data-imgfileid="100003281" data-ratio="0.9942307692307693" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGpRAAulrzmsZQTlsXCKf2mFpOiafeW3n7UwlSUmISMIwkl3BaqPJOSicoBX2gtlIrbaroEwnWJic4ZQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1040" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGpRAAulrzmsZQTlsXCKf2mFpOiafeW3n7UwlSUmISMIwkl3BaqPJOSicoBX2gtlIrbaroEwnWJic4ZQ/640?wx_fmt=png&amp;from=appmsg"><img data-imgfileid="100003278" data-ratio="0.9826666666666667" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGpRAAulrzmsZQTlsXCKf2maVj8gicKVeRXCG7cjhZWUvbFYxZp6kGC9g3CVKKf6psDFG7wXoIYhNw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="750" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGpRAAulrzmsZQTlsXCKf2maVj8gicKVeRXCG7cjhZWUvbFYxZp6kGC9g3CVKKf6psDFG7wXoIYhNw/640?wx_fmt=png&amp;from=appmsg">两个R包最终的结果总体还是差不多的~</p><h4 data-tool="mdnice编辑器"><span></span>参考资料：<span></span></h4><ol data-tool="mdnice编辑器"><li><section>survivalROC：https://github.com/cran/survivalROC</section></li><li><section>timeROC：https://github.com/cran/timeROC</section></li><li><section>生信星球：https://mp.weixin.qq.com/s/xkvGFobVt78---_J8-MYBA  https://mp.weixin.qq.com/s/E_gG4YZEVz232opsjc8xMA</section></li><li><section>医学和生信笔记：https://mp.weixin.qq.com/s/Ya-XHd8khMXCSHnY2l7Xtg https://mp.weixin.qq.com/s/hjXFgLxtegyfx_SD437m2Q https://mp.weixin.qq.com/s/np7r7njHUZJplu0bxCelRw</section></li></ol><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。更多内容可关注公众号：<strong>生信方舟</strong></p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Zz5-dmKWqUSlHyipajqupA",target="_blank" rel="noopener noreferrer">原文链接</a>
