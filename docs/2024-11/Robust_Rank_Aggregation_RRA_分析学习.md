---
title: "Robust Rank Aggregation(RRA)分析学习"
date: 2024-11-28T15:14:45Z
draft: ["false"]
tags: [
  "fetched",
  "生信方舟"
]
categories: ["Acdemic"]
---
Robust Rank Aggregation(RRA)分析学习 by 生信方舟
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><p data-tool="mdnice编辑器">Robust Rank Aggregation (RRA) 是一种排名整合算法，用于从多个排序列表中识别在所有或大多数列表中排名靠前的元素/基因/变量，目标是找到跨所有数据来源具有一致性的显著元素/基因/变量。</p><p data-tool="mdnice编辑器">RRA分析方法的优势在于：</p><ol data-tool="mdnice编辑器"><li><section>鲁棒性：RRA 对排名列表的不完整性和噪声有较强的鲁棒性，允许某些列表中缺失部分元素。</section></li><li><section>无分布假设：与其他排名整合方法不同，RRA 不要求输入数据符合特定的统计分布。</section></li><li><section>高效性：RRA 算法计算效率较高，适合处理多个来源的大规模数据。</section></li></ol><h4 data-tool="mdnice编辑器"><span></span>分析流程<span></span></h4><h5 data-tool="mdnice编辑器"><span></span>1.导入<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(RobustRankAggreg)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span>2. 数据预处理<span></span></h5><p data-tool="mdnice编辑器">这里的GSE118719是高通量测序数据，GSE12452/GSE34573是芯片测序数据，都是对肿瘤和正常组织进行了差异分析，差异分析可以看一看既往的推文：https://mp.weixin.qq.com/s/dCgLjzOGKeSpZlpFMzIR9g。</p><p data-tool="mdnice编辑器">其中展示了GSE118719这个数据集的差异分析结果，常做分析的同学应该都很熟悉的吧hhh~</p><pre data-tool="mdnice编辑器"><span></span><code><span># GSE118719</span><br>load(<span>"../1-GSE118719/GSE118719_DEG.Rdata"</span>)<br><span>library</span>(tinyarray)<br>a &lt;- intersect_all(rownames(DEG1[DEG1$change==<span>"UP"</span>,]))<br>up_GSE118719 &lt;- a<br>b &lt;- intersect_all(rownames(DEG1[DEG1$change==<span>"DOWN"</span>,]))<br>down_GSE118719 &lt;- b<br>GSE118719 &lt;- DEG1[rownames(DEG1) %<span>in</span>% c(a,b),]<br>head(GSE118719)<br><span>#            baseMean log2FoldChange     lfcSE       stat       pvalue         padj change</span><br><span># SOX4      2193.3624       3.465037 0.2702584  12.821201 1.247533e-37 4.105629e-33     UP</span><br><span># MPP3       277.3020       3.212097 0.2673546  12.014368 2.986444e-33 4.914193e-29     UP</span><br><span># CHMP7     1100.4561      -1.301527 0.1265650 -10.283467 8.366291e-25 9.177821e-21   DOWN</span><br><span># C12orf42   105.6587      -3.218636 0.3222610  -9.987669 1.725931e-23 1.420010e-19   DOWN</span><br><span># CBX2       410.3895       4.414904 0.4489029   9.834876 7.966597e-23 5.243614e-19     UP</span><br><span># C14orf182  200.4966      -2.471731 0.2648547  -9.332407 1.034939e-20 5.676640e-17   DOWN</span><br><br><span># GSE12452  </span><br>load(<span>"../2-GSE12452/step2output.Rdata"</span>)<br>up_GSE12452 &lt;- rownames(deg[deg$change==<span>"up"</span>,])<br>down_GSE12452 &lt;- rownames(deg[deg$change==<span>"down"</span>,])<br>GSE12452 &lt;- deg[rownames(deg) %<span>in</span>% c(up_GSE12452,down_GSE12452),]<br><br><span># GSE34573</span><br>load(<span>"../3-GSE34573/step2output.Rdata"</span>)<br>up_GSE34573 &lt;- deg[deg$change==<span>"up"</span>,]$symbol<br>down_GSE34573 &lt;- deg[deg$change==<span>"down"</span>,]$symbol<br>GSE34573 &lt;- deg[rownames(deg) %<span>in</span>% c(up_GSE34573,down_GSE34573),]<br><br><span># GSE53819</span><br>load(<span>"../4-GSE53819/step2output.Rdata"</span>)<br>up_GSE53819 &lt;- deg[deg$change==<span>"up"</span>,]$symbol<br>down_GSE53819 &lt;- deg[deg$change==<span>"down"</span>,]$symbol<br>GSE53819 &lt;- deg[rownames(deg) %<span>in</span>% c(up_GSE53819,down_GSE53819),]<br><br>uplist &lt;- list(up_GSE118719,<br>               up_GSE12452,<br>               up_GSE34573<br>               )<br><br>downlist &lt;- list(down_GSE118719,<br>                 down_GSE12452,<br>                 down_GSE34573<br>               )<br></code></pre><h5 data-tool="mdnice编辑器"><span></span>3.RRA分析<span></span></h5><p data-tool="mdnice编辑器">核心的代码其实就是aggregateRanks(glist = uplist, N = length(unique(unlist(uplist))))~</p><pre data-tool="mdnice编辑器"><span></span><code>ups = aggregateRanks(glist = uplist, N = length(unique(unlist(uplist))))<br>head(ups)<br><span>#              Name        Score</span><br><span># COL4A1     COL4A1 6.813894e-06</span><br><span># LAMB1       LAMB1 7.337819e-06</span><br><span># GAD1         GAD1 3.651821e-05</span><br><span># C6orf141 C6orf141 3.810574e-05</span><br><span># KREMEN2   KREMEN2 4.100591e-05</span><br><span># DSG2         DSG2 4.766501e-05</span><br>downs = aggregateRanks(glist = downlist, N = length(unique(unlist(downlist))))<br>head(downs)<br><span>#              Name        Score</span><br><span># C19orf33 C19orf33 0.0001299836</span><br><span># KRT4         KRT4 0.0001870812</span><br><span># UPK1B       UPK1B 0.0002195047</span><br><span># ALDH3A1   ALDH3A1 0.0003322503</span><br><span># TMC5         TMC5 0.0004681669</span><br><span># MGLL         MGLL 0.0005716242</span><br><br><span># 这里可以按照分数进行筛选,分数越小越有意义</span><br>toptotal &lt;- rbind(ups[ups$Score&lt;<span>0.005</span>,],downs[downs$Score&lt;<span>0.005</span>,])<br><br><span># 跟数据集一起取个交集看一看</span><br>w &lt;- intersect_all(toptotal$Name,rownames(GSE118719),<br>                  rownames(GSE12452),rownames(GSE34573))<br>w<br><span>#  [1] "COL4A1"   "LAMB1"    "GAD1"     "C6orf141" "DSG2"     "SSX2IP"   "CEP135"   "ZNRF3"   </span><br><span>#  [9] "RCN1"     "HELLS"    "GRB10"    "LAMC1"    "ANLN"     "ITGAV"    "COL4A2"   "GINS1"   </span><br><span># [17] "CNTNAP2"  "LGALS1"   "ROBO1"    "FMNL2"    "IDH1"     "SCD5"     "CXCL3"    "ABCA3"   </span><br><span># [25] "ZIC2"     "FN1"      "INSM1"    "KCTD3"    "FRAS1"    "BRIP1"    "NREP"     "CACNA2D1"</span><br><span># [33] "OLFM1"    "SLC39A14" "KIF23"    "TYMS"     "DTL"      "KIF18A"   "VRK2"     "IGF2BP3" </span><br><span># [41] "ZNF112"   "HOXC6"    "KIF14"    "SYNPO2"   "CDK1"     "RAD51AP1" "PRC1"     "MCM7"    </span><br><span># [49] "FJX1"     "GJA1"     "STAR"     "FBN1"     "KRT4"     "ZBTB7C"   "TTC9"     "S100P"   </span><br><span># [57] "CHST6"    "C9orf24"  "PSCA"     "PIFO"     "MAL"      "CAPS"  </span><br></code></pre><h6 data-tool="mdnice编辑器"><span></span>分析后提取数据(可视化前准备)<span></span></h6><pre data-tool="mdnice编辑器"><span></span><code>datnames &lt;- c(<span>"GSE118719"</span>,<span>"GSE12452"</span>,<span>"GSE34573"</span>)<br><br><span># 创建一个空列表用于存储每个数据集提取的结果</span><br>result_list &lt;- list()<br><br><span># 遍历每个数据集，提取基因表达量</span><br><span>for</span> (i <span>in</span> datnames) {<br>  <span># 加载每个数据集</span><br>  dataset &lt;- get(i)  <span># 使用 get() 函数获取数据集对象</span><br>  <span># 提取符合toptotal中基因名的行</span><br>  selected_genes &lt;- dataset[rownames(dataset) %<span>in</span>% toptotal$Name, ]<br>  <span># 按照toptotal的顺序进行排序</span><br>  selected_genes &lt;- selected_genes[match(toptotal$Name, <br>                                         rownames(selected_genes)), ]<br>  <span># 动态选择列名</span><br>  logFC_col &lt;- grep(<span>"logFC|log2FoldChange"</span>, colnames(selected_genes), value = <span>TRUE</span>)<br>  <span>if</span> (length(logFC_col) &gt; <span>0</span>) {<br>    <span># 提取 logFC 或 log2FoldChange 列</span><br>    logFC_values &lt;- selected_genes[, logFC_col, drop = <span>FALSE</span>]<br>  } <span>else</span> {<br>    <span>stop</span>(paste(<span>"No 'logFC' or 'log2FoldChange' column found in dataset:"</span>, i))<br>  }<br>  <span># 为提取的数据添加列名，列名为数据集的名称</span><br>  colnames(logFC_values) &lt;- i<br>  <span># 将提取的数据添加到列表中</span><br>  result_list[[i]] &lt;- logFC_values<br>}<br><br><span># 将所有提取的结果合并成一个数据框</span><br>final_result &lt;- do.call(cbind, result_list)<br><span># 查看合并后的数据框</span><br>head(final_result)<br>final_res &lt;- na.omit(final_result)<br></code></pre><h5 data-tool="mdnice编辑器"><span></span>4.可视化<span></span></h5><pre data-tool="mdnice编辑器"><span></span><code>data_total &lt;- final_res<br><br><span>library</span>(ComplexHeatmap)<br><span># 检查数据类型是否正确转换为数值型</span><br>str(final_res)<br><br><span># 也可以用circlize创建颜色映射</span><br><span># 定义颜色渐变</span><br><span>library</span>(circlize)<br>color_fun &lt;- colorRamp2(c(-<span>4</span>, <span>0</span>, <span>4</span>), c(<span>"#336699"</span>, <span>"white"</span>, <span>"tomato"</span>))<br>GSE_colors &lt;- c(<span>"GSE118719"</span> = <span>"blue"</span>, <span>"GSE12452"</span> = <span>"orange"</span>, <span>"GSE34573"</span> = <span>"purple"</span>,<br>                    <span>"GSE53819"</span> = <span>"brown"</span>, <span>"GSE61218"</span> = <span>"yellow"</span>,<span>"GSE64634"</span> = <span>"pink"</span>)<br><span># 顶部注释HeatmapAnnotation</span><br>colAnno &lt;- HeatmapAnnotation(GSE_num =datnames,<br>                             col = list(GSE_num = GSE_colors))<br><br>pdf(<span>"heatmap.pdf"</span>,width = <span>5</span>,height = <span>8</span>)<br>ComplexHeatmap::Heatmap(data_total, <br>                        na_col = <span>"white"</span>,<br>                        col = color_fun,  <span># 添加颜色映射函数</span><br>                        show_column_names = <span>T</span>, <span>#是否显示列名</span><br>                        show_row_names = <span>T</span>, <span>#是否显示行名</span><br>                        row_names_side = <span>"left"</span>,<br>                        name = <span>"fraction"</span>,<br>                        row_order = rownames(data_total),<br>                        <span>#row_split = datnames, </span><br>                        row_title = <span>NULL</span>,<br>                        cluster_columns = <span>F</span>,<br>                        <span>#left_annotation = rowAnno,</span><br>                        top_annotation = colAnno,<br>                        <span>#heatmap_width = unit(20, "cm"),  # 调整热图宽度</span><br>                        <span>#row_dend_width = unit(1, "cm"),  # 调整聚类树宽度</span><br>                        cluster_rows = <span>F</span>, <span># 行聚类</span><br>                        row_names_gp = gpar(fontsize = <span>10</span>),  <span># 调整行名字体大小</span><br>                        column_names_gp = gpar(fontsize = <span>12</span>),<br>                        cell_fun = <span>function</span>(j, i, x, y, width, height, fill) {<br>                          <span># 在单元格中心显示数值</span><br>                          grid.text(sprintf(<span>"%.2f"</span>, data_total[i, j]), x, y, gp = gpar(fontsize = <span>8</span>))<br>                        }<br>                        <span>#cluster_columns = FALSE # 列聚类。                     </span><br>                        )<br>dev.off()<br></code></pre><figure data-tool="mdnice编辑器"><img data-imgfileid="100003349" data-ratio="1.616" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGQ0pLGxJ4Z1TCdQiaFMSreauUI58XQxrHLP157PrWbP67flpKn0ic0ONGxLeHdciaqFuuV5RgnX5AxA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="750" src="https://mmbiz.qpic.cn/sz_mmbiz_png/0SOG4MpDAyGQ0pLGxJ4Z1TCdQiaFMSreauUI58XQxrHLP157PrWbP67flpKn0ic0ONGxLeHdciaqFuuV5RgnX5AxA/640?wx_fmt=png&amp;from=appmsg"></figure><h4 data-tool="mdnice编辑器"><span></span>参考资料：<span></span></h4><ol data-tool="mdnice编辑器"><li><section>Robust rank aggregation for gene list integration and meta-analysis. Bioinformatics. 2012 Feb 15;28(4):573-80.</section></li><li><section>RRA：https://www.rdocumentation.org/packages/RobustRankAggreg/versions/1.2.1</section></li><li><section>生信技能树：https://mp.weixin.qq.com/s/JOadz9fXIDEoUXrh6BkbWA</section></li><li><section>被炸熟的虾：https://mp.weixin.qq.com/s/ua8QWm9RNPe3M-IidiluIw</section></li><li><section>生信交流平台：https://mp.weixin.qq.com/s/YDVeJecvxzoH5WY2bmOP0A</section></li><li><section>生信协作组：https://mp.weixin.qq.com/s/6333Qvf0m7D-QxPYlOIu3Q</section></li></ol><p data-tool="mdnice编辑器"><strong>致谢</strong>：感谢曾老师以及生信技能树团队全体成员。</p><p data-tool="mdnice编辑器"><strong>注</strong>：若对内容有疑惑或者有发现明确错误的朋友，请联系后台(欢迎交流)。更多内容可关注公众号：<strong>生信方舟</strong></p><span>- END -</span></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ilO7YO8NnI3QexhqOeu6Cg",target="_blank" rel="noopener noreferrer">原文链接</a>
