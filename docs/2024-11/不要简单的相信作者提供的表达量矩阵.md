---
title: "不要简单的相信作者提供的表达量矩阵"
date: 2024-11-15T14:45:17Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
不要简单的相信作者提供的表达量矩阵 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><span></span><p>GEO（Gene Expression Omnibus）数据库是一个公共的基因表达量数据库，它收录了来自不同平台的高通量基因表达数据，包括Affymetrix、Illumina和Agilent等。每个平台都有自己的文件格式和数据处理流程，以下是对这三个主要平台的简要介绍：</p></blockquote><ol data-tool="mdnice编辑器"><li><section><p><strong>Affymetrix</strong>：</p></section></li></ol><ul><li><section><strong>平台特点</strong>：Affymetrix平台使用微阵列技术，每个探针对应一个特定的基因或转录本。</section></li><li><section><strong>文件格式</strong>：Affymetrix数据通常以<code>.CEL</code>文件格式存储，这是一种二进制格式，包含了原始的荧光强度值。</section></li><li><section><strong>数据处理</strong>：需要使用专门的软件（如Affymetrix Power Tools, dChip, or R/Bioconductor的<code>affy</code>包）来读取<code>.CEL</code>文件，并进行标准化和背景校正。</section></li></ul><li><section><p><strong>Illumina</strong>：</p></section></li><ul><li><section><strong>平台特点</strong>：Illumina平台使用测序技术，可以提供单核苷酸多态性（SNP）和基因表达数据。</section></li><li><section><strong>文件格式</strong>：Illumina数据以<code>.idat</code>文件格式存储，这是原始的图像强度数据。</section></li><li><section><strong>数据处理</strong>：需要使用Illumina自己的软件（如GenomeStudio）或其他第三方工具（如R/Bioconductor的<code>illuminaio</code>包）来处理<code>.idat</code>文件，提取表达量数据，并进行标准化。</section></li></ul><li><section><p><strong>Agilent</strong>：</p></section></li><ul><li><section><strong>平台特点</strong>：Agilent平台也使用微阵列技术，特点是可以灵活设计探针，适用于研究者自定义的基因集。</section></li><li><section><strong>文件格式</strong>：Agilent数据通常以<code>.txt</code>或<code>.csv</code>格式存储，包含了原始的荧光强度值。</section></li><li><section><strong>数据处理</strong>：可以使用Agilent自己的软件（如Feature Extraction Software）或R/Bioconductor的<code>limma</code>包等工具来处理这些文件。</section></li></ul><p data-tool="mdnice编辑器">处理这些平台的数据时，研究者需要了解各自平台的特点和数据处理流程，选择合适的工具和方法来进行分析。此外，由于不同平台之间的技术差异，直接比较不同平台的数据时需要格外小心，可能需要进行平台间的标准化或使用兼容的分析方法。</p><p data-tool="mdnice编辑器">但是大部分情况下，我们偷懒会直接下载GEO数据库里面的作者上传的表达量矩阵，我们拿GSE13904举例说明，简单的代码如下所示：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(AnnoProbe)<br><span>library</span>(GEOquery)  <br>getOption(<span>'timeout'</span>)<br>options(timeout=<span>10000</span>)<br><span>#获取并且检查表达量矩阵</span><br><span>##～～～gse编号需修改～～～</span><br>gse_number &lt;- <span>'GSE13904'</span><br>dir.create(gse_number)<br>setwd( gse_number )<br>getwd() <br>list.files() <br><span>if</span>(<span>T</span>){gset &lt;- geoChina(gse_number)}<br><span>#gset = getGEO("GSE13904", destdir = '.', getGPL = F)</span><br>gset[[<span>1</span>]]<br></code></pre><p data-tool="mdnice编辑器">其实上面的代码就是远程读取：https://ftp.ncbi.nlm.nih.gov/geo/series/GSE13nnn/GSE13904/matrix/ 里面的文件：</p><ul data-tool="mdnice编辑器"><li><section>https://ftp.ncbi.nlm.nih.gov/geo/series/GSE13nnn/GSE13904/matrix/GSE13904_series_matrix.txt.gz  （2024-10-08 05:42   51M）</section></li></ul><p data-tool="mdnice编辑器">这个文件是作者上传的表达量矩阵，所以数据<strong>预处理</strong>取决于作者的想法！</p><p data-tool="mdnice编辑器">有一些时候会出现一些奇怪的矩阵，比如这个GSE13904数据集 ，可以看到 ：</p><pre data-tool="mdnice编辑器"><span></span><code>&gt; a=gset[[1]] <br>&gt; dat=exprs(a) <span>#a现在是一个对象，取a这个对象通过看说明书知道要用exprs这个函数</span><br>&gt; dim(dat)<span>#看一下dat这个矩阵的维度</span><br>[1] 54675   227<br>&gt; dat[1:4,1:4] <span>#查看dat这个矩阵的1至4行和1至4列，逗号前为行，逗号后为列</span><br>          GSM350139 GSM350140 GSM350141 GSM350142<br>1007_s_at 1.3790160 1.0096979 1.0634007 1.0500925<br>1053_at   0.9159325 0.6084510 1.2112615 0.8101592<br>117_at    0.7658561 0.7135977 1.0033835 1.1766533<br>121_at    1.0137547 1.5091416 0.9252635 1.2368684<br>&gt; range(dat)<br>[1]   0.0100 990.7652<br><span># 每个样品的四分位数如下所示：</span><br>&gt; apply(dat[,1:4], 2,fivenum)<br>       GSM350139   GSM350140  GSM350141  GSM350142<br>[1,]  0.02240257  0.02496001  0.1536448 0.04565957<br>[2,]  0.87158622  0.76531896  0.8887694 0.87434662<br>[3,]  0.97803104  0.98077905  1.0041255 0.99884206<br>[4,]  1.08294430  1.16814570  1.1577705 1.12798295<br>[5,] 16.43987000 10.30501500 25.7737870 9.34895900<br></code></pre><p data-tool="mdnice编辑器">有点意思啊， 绝大部分样品都是中位值居然都是1附近，这个就不符合我们的认知。正常情况下，我们的表达量芯片得出来的矩阵里面的数字范围应该是0到15直接，大部分在5到8附近。</p><p data-tool="mdnice编辑器">如果我们直接从这个GSE13904数据集里面的找到脓毒症和正常对照，这两个分组的样品，然后试试看做差异分析 ：</p><pre data-tool="mdnice编辑器"><span></span><code>pd=pData(a) <br>kp1=grepl(<span>'Sepsis'</span>,pd$title);table(kp1)<br>kp2=grepl(<span>'Control'</span>,pd$title);table(kp2)<br><br>pd=pd[kp1 | kp2,]<br>dat=dat[,kp1 | kp2]<br><br><span>library</span>(stringr)<br><span>##～～～分组信息编号需修改～～～</span><br>group_list=ifelse(grepl(<span>'Control'</span>,pd$title ,ignore.case = <span>T</span> ),<br>                  <span>"control"</span>,<span>"case"</span>)<br>table(group_list)<br><br>group_list &lt;- factor(group_list, levels = c(<span>"control"</span>,<span>"case"</span>))<br>table(group_list)<br></code></pre><p data-tool="mdnice编辑器">会出现很诡异的 差异分析结果 ：</p><p><img data-galleryid="" data-imgfileid="100051440" data-ratio="0.38195615514333897" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyvDUbcsJpGbd45F9hIybm7EZGHz5o2Mk4B6j9eJgrlC2BECLy9kPRJZ2RuSa5u5kJdbCoGibFKr8A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="2372" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyvDUbcsJpGbd45F9hIybm7EZGHz5o2Mk4B6j9eJgrlC2BECLy9kPRJZ2RuSa5u5kJdbCoGibFKr8A/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption>诡异的 差异分析结果</figcaption></figure><p data-tool="mdnice编辑器">如果我们打开具体的一个样品，是可以看到它的处理方法：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM350139</p><ul data-tool="mdnice编辑器"><li><section>Commercial Affymetrix Human Genome U133 Plus 2.0 GeneChip (Affymetrix, Santa Clara, CA).</section></li><li><section>GeneChip CEL files were subjected to RMA normalization using the GeneSpring GX 7.1.</section></li></ul><p data-tool="mdnice编辑器">本来呢，使用affymetrix公司的官方软件GeneSpring是很标准的操作，但是值得注意的是作者画蛇添足多了一个处理：</p><ul data-tool="mdnice编辑器"><li><section>The Raw CEL files were processed using the RMA (Robust Multichip Average) built in GeneSpring software.</section></li><li><section>All the samples were then normalized to the median of the controls.</section></li></ul><p data-tool="mdnice编辑器">使得每个样品的每个基因的表达量不再具有跨数据集的可比性：</p><p><img data-galleryid="" data-imgfileid="100051441" data-ratio="1.2239884393063585" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyvDUbcsJpGbd45F9hIybm7qOPEGCHNtJ0LqK5Xt6r508uTugGH3tBnSSHcr3J5aDAVB04ia7YMFHw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1384" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wyvDUbcsJpGbd45F9hIybm7qOPEGCHNtJ0LqK5Xt6r508uTugGH3tBnSSHcr3J5aDAVB04ia7YMFHw/640?wx_fmt=png&amp;from=appmsg"></p><figure data-tool="mdnice编辑器"><figcaption> </figcaption></figure><h3 data-tool="mdnice编辑器"><span></span><span>如果要做差异分析或者后续高级分析</span><span></span></h3><p data-tool="mdnice编辑器">都需要读取这个数据集提供的cel文件，做出来自己的表达量矩阵，示例代码是：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(oligo)<br><span>library</span>(ggplot2) <br><span># 把cel文件存放在 ../cel_files/ 文件夹里面 </span><br>celFiles &lt;- list.celfiles(<span>'../cel_files/'</span>,listGzipped = <span>T</span>,<br>                          full.name=<span>TRUE</span>)<br>celFiles<br><br>options(BioC_mirror=<span>"https://mirrors.westlake.edu.cn/bioconductor"</span>)<br>exon_data &lt;- oligo::read.celfiles( celFiles ) <br>dim(exprs(exon_data)) <br>exprs(exon_data)[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><span>### 标准化(一步完成背景校正、分位数校正标准化和RMA (robust multichip average) 表达整合)</span><br>exon_data_rma &lt;- oligo::rma(exon_data  ) <br>exp_probe &lt;- Biobase::exprs(exon_data_rma)<br>exp_probe[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>]<br><br>dat=exp_probe<br>dim(dat)<span>#看一下dat这个矩阵的维度</span><br>dat[<span>1</span>:<span>4</span>,<span>1</span>:<span>4</span>] <span>#查看dat这个矩阵的1至4行和1至4列，逗号前为行，逗号后为列</span><br>pd = pData(a)<br>head(pd)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span>学徒作业</span><span></span></h3><p data-tool="mdnice编辑器"><strong>完成这个GSE13904数据集的脓毒症和正常对照，这两个分组的样品，的差异分析，基于作者矩阵，以及基于cel文件的矩阵，做两次差异分析后对比一下结果。</strong></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/a1gMtdSdlMDs05nBL7Z7Yg",target="_blank" rel="noopener noreferrer">原文链接</a>
