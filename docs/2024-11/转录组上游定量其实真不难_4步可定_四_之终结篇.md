---
title: "转录组上游定量其实真不难，4步可定（四）之终结篇"
date: 2024-11-10T02:27:27Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
转录组上游定量其实真不难，4步可定（四）之终结篇 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span>缘起</span></h2><p data-tool="mdnice编辑器"><span>前三周，我们分享了人的单端转录组数据、人的双端转录组数据以及小鼠的单端转录组数据的上游处理方式。上周我们针对小鼠单端数据进行了处理，双端作为当今测序数据的主流，我们当然也不能错过。今天，就让我们来分享小鼠双端转录组数据上游处理流程吧。</span></p><p data-tool="mdnice编辑器"><span>若您觉得有些<strong>「忙」</strong>或者没有<strong>「服务器」</strong>，还是有这个需求的话，老规矩哈，找生信技能树。忙的话具体可以看看推文</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247517299&amp;idx=2&amp;sn=f808fb599dea6aaedf1ba75369f727ff&amp;scene=21#wechat_redirect" data-linktype="2"><span>普通转录组上游定量分析服务（仅需800每个项目）</span></a><span>；需要服务器的话，那就点击这个</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247518150&amp;idx=1&amp;sn=9e7764a48a43b4fe810bb7458c409fa4&amp;scene=21#wechat_redirect" data-linktype="2"><span>96线程512G内存500G硬盘服务器一年仅需800</span></a><span>。</span></p><h2 data-tool="mdnice编辑器"><span><span>流程归纳</span></span></h2><p data-tool="mdnice编辑器"><span>细心的小伙伴们可以发现，仍旧是经典的4步曲哈</span></p><p data-tool="mdnice编辑器"><span>1.数据下载（自身数据的话，此步可忽略）</span></p><p data-tool="mdnice编辑器"><span>2.质控过滤（质控前用fastqc与multiqc初看数据效果、trimmgalore进行质控过滤与fastqc、multiqc查看质控后的效果）</span></p><p data-tool="mdnice编辑器"><span>3.Hisat2比对</span></p><p data-tool="mdnice编辑器"><span>4.featureCounts定量</span></p><h2 data-tool="mdnice编辑器"><span><span>探究</span></span></h2><p data-tool="mdnice编辑器"><span>今天，我们使用标题为 CDK5 inhibition abrogates TNBC stem-cell property and enhances anti-PD-1 therapy的GSE132902数据集进行探究，数据集的链接如下：</span><span>https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE132902</span><span>，对TNBC感兴趣的小伙伴可以点击进去看看。进入页面，我们可以看到该数据集种属为<strong>鼠</strong>，有六个样本，使用的是两端各150bp共300bp的<strong>双端测序</strong>。接下来，我们就正式分析一下这个鼠的双端转录组测序吧。</span></p><p data-tool="mdnice编辑器"><img data-ratio="0.7110675808031341" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiciawYzeDTLfwDao4kxug0Kaic28upDeibIicPmWxnX2DXfSliaIskIYCfyulqkQhCK9jcdhVD6ib3JCibUw/640?wx_fmt=png" data-type="png" data-w="1021" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiciawYzeDTLfwDao4kxug0Kaic28upDeibIicPmWxnX2DXfSliaIskIYCfyulqkQhCK9jcdhVD6ib3JCibUw/640?wx_fmt=png"></p><h3 data-tool="mdnice编辑器"><span><span>1.数据下载</span></span></h3><h4 data-tool="mdnice编辑器"><span><span>01 下载数据下载的网页链接文件</span></span></h4><p data-tool="mdnice编辑器"><span>数据下载也是老规矩，利用prefetch下载SRA数据，准备进行转录组数据分析。在GSE数据集对应网页，点击SRA_Run_Selector，最终下载跳转页面的Accession List；获得下载需要使用的SRA_Acc_list后，用其进行数据下载。</span><img data-ratio="0.2989247311827957" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiciawYzeDTLfwDao4kxug0KacvQcuBttKhTzod3k99lkM2icxU2g21XBr5RoEuJGM0bxTyxcibV7cN8w/640?wx_fmt=png" data-type="png" data-w="930" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiciawYzeDTLfwDao4kxug0KacvQcuBttKhTzod3k99lkM2icxU2g21XBr5RoEuJGM0bxTyxcibV7cN8w/640?wx_fmt=png"><span>下载好的SRA_Acc_list的样子：</span><img data-ratio="0.06900328587075576" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiciawYzeDTLfwDao4kxug0Ka6jeJKJjT8n3VHtT48YJblVwHnA4hWwGM1mGG5LalMahyg6xyCOicbeQ/640?wx_fmt=png" data-type="png" data-w="913" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2LosiciawYzeDTLfwDao4kxug0Ka6jeJKJjT8n3VHtT48YJblVwHnA4hWwGM1mGG5LalMahyg6xyCOicbeQ/640?wx_fmt=png"></p><pre data-tool="mdnice编辑器"><code><span><span>$</span><span> cat SRR_Acc_List.txt </span><br>SRR9320008<br>SRR9320009<br>SRR9320010<br>SRR9320011<br>SRR9320012<br>SRR9320013<br></span></code></pre><h4 data-tool="mdnice编辑器"><span><span>02 服务器上，通过网页链接文件SRA_Acc_list下载数据</span></span></h4><pre data-tool="mdnice编辑器"><code><span><span>#</span><span> 1.上传下载的SRR_Ac_List.txt到服务器上</span><br><span>#</span><span> 2.激活包含prefech命令的SRAtoolkits软件的小环境</span><br>conda activate download<br><span>#</span><span> 3.开始数据下载（此命令为批量全部下载，样本量大时，需谨慎服务器资源）</span><br>cat SRR_Acc_List.txt |while read id;do (prefetch -X 100G $id );done<br></span></code></pre><p data-tool="mdnice编辑器"><span>下载好了SRA文件，同样，我们需要转换为fasta文件，并且压缩成fastq.gz文件</span></p><pre data-tool="mdnice编辑器"><code><span><span>#</span><span> 1.批量将SRA文件转换fastq文件</span><br>ls SRR* | while read id;do ( nohup fasterq-dump -O ./ --split-files -e 2 ./$id --include-technical &amp; );done<br><span>#</span><span> 2.批量将fastq文件压缩成fastq.gz文件</span><br>ls *fastq |while read id;do (nohup gzip $id &amp;);done<br></span></code></pre><p data-tool="mdnice编辑器"><span>下载好的sra文件：</span></p><pre data-tool="mdnice编辑器"><code><span><span>$</span><span> ls -lh  SRR*|cut -d<span>" "</span> -f 5-</span><br>SRR9320008:<br>2.8G 10月 25 11:54 SRR9320008.sra<br>SRR9320009:<br>2.2G 10月 25 11:53 SRR9320009.sra<br>SRR9320010:<br>2.6G 10月 25 11:53 SRR9320010.sra<br>SRR9320011:<br>2.4G 10月 25 11:52 SRR9320011.sra<br>SRR9320012:<br>2.5G 10月 25 11:52 SRR9320012.sra<br>SRR9320013:<br>2.3G 10月 25 11:52 SRR9320013.sra<br></span></code></pre><p data-tool="mdnice编辑器"><span>压缩完成的fastq.gz文件</span></p><pre data-tool="mdnice编辑器"><code><span><span>$</span><span> ls -lh  SRR*.gz|cut -d<span>" "</span> -f 5-</span><br>2.2G 10月 25 12:33 SRR9320008_1.fastq.gz<br>2.2G 10月 25 12:33 SRR9320008_2.fastq.gz<br>1.7G 10月 25 12:33 SRR9320009_1.fastq.gz<br>1.8G 10月 25 12:33 SRR9320009_2.fastq.gz<br>2.0G 10月 25 12:33 SRR9320010_1.fastq.gz<br>2.0G 10月 25 12:33 SRR9320010_2.fastq.gz<br>1.9G 10月 25 12:33 SRR9320011_1.fastq.gz<br>1.9G 10月 25 12:33 SRR9320011_2.fastq.gz<br>1.9G 10月 25 12:33 SRR9320012_1.fastq.gz<br>2.0G 10月 25 12:33 SRR9320012_2.fastq.gz<br>1.8G 10月 25 12:33 SRR9320013_1.fastq.gz<br>1.8G 10月 25 12:33 SRR9320013_2.fastq.gz<br></span></code></pre><h3 data-tool="mdnice编辑器"><span><span>2.质控过滤</span></span></h3><pre data-tool="mdnice编辑器"><code><span><span>#</span><span> 一：质控前的初看测序数据质量：fastqc与multiqc</span><br><span>#</span><span> 1.激活专门用于RNAseq数据处理的小环境rna,进行fastqc与multiqc</span><br>conda activate rna #激活转录组测序数据处理的小环境<br><span>#</span><span> 2.先进行fastqc</span><br>nohup fastqc -t 6 -o ./ SRR*.fastq.gz &gt;qc.log &amp;  <br><span>#</span><span> 3.对fastqc后的zip数据进行multiqc</span><br>nohup multiqc ./*.zip -o ./ &gt; ./multiqc.log &amp;<br><span><br>#</span><span> 二:trimmgalore质控</span><br>ls *gz |while read id;do (nohup trim_galore  -q 25 --phred33 --length 36 --stringency 3 --paired  -o ./  $id &amp; );done<br><span><br>#</span><span># 三:质控后数据也需要用fastqc与multiqc看看质控效果</span><br><span>#</span><span> 01批量fastqc</span><br>nohup fastqc -t 12 -o ./ SRR*_trimmed.fq.gz &gt;qc_trimmed.log &amp; <br><span>#</span><span> 02开始multiqc</span><br>nohup multiqc *.zip -o ./ &gt; ./multiqc_t.log &amp;<br></span></code></pre><p data-tool="mdnice编辑器"><span>得到的质控过滤后的文件：</span></p><pre data-tool="mdnice编辑器"><code><span><span>$</span><span> ls -lh  *fq.gz|cut -d<span>" "</span> -f 5-</span><br>2.2G 10月 30 13:02 SRR9320008_1_val_1.fq.gz<br>2.2G 10月 30 13:02 SRR9320008_2_val_2.fq.gz<br>1.7G 10月 30 12:50 SRR9320009_1_val_1.fq.gz<br>1.7G 10月 30 12:50 SRR9320009_2_val_2.fq.gz<br>2.0G 10月 30 12:57 SRR9320010_1_val_1.fq.gz<br>2.0G 10月 30 12:57 SRR9320010_2_val_2.fq.gz<br>1.9G 10月 30 12:54 SRR9320011_1_val_1.fq.gz<br>1.9G 10月 30 12:54 SRR9320011_2_val_2.fq.gz<br>1.9G 10月 30 12:55 SRR9320012_1_val_1.fq.gz<br>1.9G 10月 30 12:55 SRR9320012_2_val_2.fq.gz<br>1.8G 10月 30 12:52 SRR9320013_1_val_1.fq.gz<br>1.8G 10月 30 12:52 SRR9320013_2_val_2.fq.gz<br></span></code></pre><h3 data-tool="mdnice编辑器"><span><span>3.比对</span></span></h3><p data-tool="mdnice编辑器"><span>比对的话需要自身构建索引，我们已经搭建好了索引，直接进行比对就好。若小伙伴们需要自身搭建索引，请参考州更老师的</span><a href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247484720&amp;idx=1&amp;sn=4bb3e3d2182ffe937d58dc135b4bbd24&amp;scene=21#wechat_redirect" data-linktype="2"><span>从零开始学转录组（5）序列比对</span></a><span>。注意，小鼠的索引要指定小鼠的索引（index）与小鼠的参考基因组文件（gtf）。</span></p><pre data-tool="mdnice编辑器"><code><span>ls *fq.gz|while read id;do <br> gtf='$HOME/database/GRCm39.106/Mus_musculus.GRCm39.106.chr.gtf '<br> hisat_index="$HOME/database/GRCm39.106/Hisat2Index"<br> nohup sh -c " hisat2 -p 2 -x ${hisat_index}  -1 ${id}_1_val.fq.gz -2 ${id}_2_val.fq.gz  2&gt;${id%%_*}.log  | samtools sort -@ 2 -o ${id%%_*}.bam  " &amp; <br>done<br></span></code></pre><p data-tool="mdnice编辑器"><span>得到比对后的文件：</span></p><pre data-tool="mdnice编辑器"><code><span><span>$</span><span> ls -lh *bam |cut -d<span>" "</span> -f 5-</span><br>2.7G 10月 30 13:57 SRR9320008.sort.bam<br>2.1G 10月 30 13:35 SRR9320009.sort.bam<br>2.4G 10月 30 13:48 SRR9320010.sort.bam<br>2.3G 10月 30 13:39 SRR9320011.sort.bam<br>2.4G 10月 30 13:40 SRR9320012.sort.bam<br>2.2G 10月 30 13:35 SRR9320013.sort.bam<br></span></code></pre><h3 data-tool="mdnice编辑器"><span><span>4.定量</span></span></h3><p data-tool="mdnice编辑器"><span>一定要注意配套的基因组fa文件与gtf文件，小鼠的得换成小鼠的哈，一步定量即可。</span></p><pre data-tool="mdnice编辑器"><code><span>gtf=$HOME/database/GRCm39.106/Mus_musculus.GRCm39.106.chr.gtf<br>nohup featureCounts -T 5 -p -t exon -g gene_id  -a $gtf \<br>-o  all.id.txt  *bam  1&gt;counts.id.log 2&gt;&amp;1 &amp;<br><span>#</span><span> 这样就获得了咱们心心念念的Ensenmble count矩阵了</span><br></span></code></pre><p data-tool="mdnice编辑器"><span>同样4步，我们就可以获得Ensenmble count矩阵。细心的小伙伴们可以发现，小鼠双端与人双端转录组上游数据处理最大的区别就是种属gtf与参考基因组。到此为止的话，人与小鼠转录组上游数据的处理将告以段落了，咱们的四步曲处理转录组上游数据就终止了。</span></p><p data-tool="mdnice编辑器"><strong><span>转录组上游数据处理特别值得注意的是，要平衡好自身样本数量与计算机资源的消耗。样本数量多时，不要为了速度一股脑并行运行，否则你的服务器管理员可能会联系你哈。</span></strong></p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/YHWLcZYeKLEMufUS-TLHVQ",target="_blank" rel="noopener noreferrer">原文链接</a>
