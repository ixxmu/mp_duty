---
title: "单细胞全流程之转录因子活性预测：decoupleR"
date: 2024-11-10T12:31:05Z
draft: ["false"]
tags: [
  "fetched",
  "爱喝可乐的天天"
]
categories: ["Acdemic"]
---
单细胞全流程之转录因子活性预测：decoupleR by 爱喝可乐的天天
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h1 data-tool="mdnice编辑器"><span></span><span><span>最近nature在10月23日上线了两篇关于心衰中免疫细胞和成纤维细胞间通讯的文章：</span></span></h1><p><img data-galleryid="" data-imgfileid="100000885" data-ratio="0.4045584045584046" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdnd0fcABTqamtea9XZ337CsribK8xYc02CWfNcjpuDfRicjDu2rL7dhiaw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="702" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdnd0fcABTqamtea9XZ337CsribK8xYc02CWfNcjpuDfRicjDu2rL7dhiaw/640?wx_fmt=png&amp;from=appmsg"></p><p><img data-galleryid="" data-imgfileid="100000886" data-ratio="0.39660056657223797" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdecc6iaazxlghzria2nwdibcicwsyZsicny10zIh3zJP36Onk58mpkzRer1A/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="706" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdecc6iaazxlghzria2nwdibcicwsyZsicny10zIh3zJP36Onk58mpkzRer1A/640?wx_fmt=png&amp;from=appmsg"></p><p><br></p><figure data-tool="mdnice编辑器"><figcaption><br></figcaption></figure><p data-tool="mdnice编辑器">两篇都与经典的炎症因子<strong>IL1β</strong>相关</p><p data-tool="mdnice编辑器">第一篇主要是发现了表达成纤维细胞激活蛋白（FAP）和periostin（POSTN）的成纤维细胞亚群，这些细胞与心肌纤维化有关，通过配体-受体分析和空间转录组学预测，CCR2+巨噬细胞和成纤维细胞之间的IL-1β信号传导在空间上定义的生态位中驱动FAP/POSTN成纤维细胞的出现，从而在心脏纤维化中发挥作用。</p><p data-tool="mdnice编辑器">第二篇文章主要发现了在浸润性Cx3cr1+巨噬细胞中条件性敲除转录共激活因子Brd4可以改善小鼠的心力衰竭并显著减少成纤维细胞的激活，通过单细胞染色质可及性分析和BRD4占据位点的分析，研究人员发现了一个靠近IL-1β的大增强子，以及一系列精确的压力依赖性调控元件，这些元件控制IL-1β的表达，分泌的IL-1β激活了成纤维细胞中依赖于RELA（也称为p65）的增强子，导致人类心脏成纤维细胞中促纤维化反应。</p><p data-tool="mdnice编辑器">有时间我们再来仔细看看这两篇文章的具体内容。</p><p data-tool="mdnice编辑器">今天主要想分享的是第一篇文章中用到的DoRothEA转录因子活性预测分析，我也是第一次看到。翻看git之后发现DoRothEA已经被decoupleR取代，我们直接来看下decoupleR的使用方法，这是原文的图：</p><figure data-tool="mdnice编辑器"><p><img data-galleryid="" data-imgfileid="100000887" data-ratio="0.45738636363636365" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdZYpVpaB8EZllNVwQyGHKhkRIyicA9z15qcl4mibr39CvA9dvmXNQ5ANw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="352" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdZYpVpaB8EZllNVwQyGHKhkRIyicA9z15qcl4mibr39CvA9dvmXNQ5ANw/640?wx_fmt=png&amp;from=appmsg"></p><figcaption><br></figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>安装</span><span></span><span> </span></h2><pre data-tool="mdnice编辑器"><span></span><code>BiocManager::install(<span>"decoupleR"</span>)<br>BiocManager::install(<span>"OmnipathR"</span>)<span>#获取转录因子数据必须安装</span><br></code></pre><p data-tool="mdnice编辑器">decoupleR还可以做通路活性推断PROGENy，这个分析我们之前已经分享过了，感兴趣的朋友可查看<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzkzNDQ3Njc4NQ==&amp;mid=2247484409&amp;idx=1&amp;sn=3071e2e1f98571c1817c3c5c2bd776ae&amp;chksm=c2bded67f5ca6471fda341dddf6ccec582892c4ac4430daf01af259072e8d88bec5fa7701660&amp;scene=21#wechat_redirect" textvalue="单细胞全流程之Progeny通路活性推断" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">单细胞全流程之Progeny通路活性推断</a></p><h2 data-tool="mdnice编辑器"><span></span><span>分析流程</span><span></span><span> </span></h2><p data-tool="mdnice编辑器">非常简单，获取TF的背景数据，一步运行即可</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(dplyr)<br><span>library</span>(Seurat)<br><span>library</span>(tibble)<br><span>library</span>(pheatmap)<br><span>library</span>(tidyr)<br><span>library</span>(viper)<br><span>library</span>(decoupleR)<br><span>library</span>(ggplot2)<br><span>library</span>(patchwork)<br><span>library</span>(<span>"OmnipathR"</span>)<br>sce &lt;- readRDS(<span>"sc_AC_anno.rds"</span>)<br>Idents(sce) &lt;- <span>"celltype"</span><br>net &lt;- get_collectri(organism=<span>'human'</span>, split_complexes=<span>FALSE</span>)<br>mat &lt;- as.matrix(sce@assays$RNA@data)<br>plan(<span>"multisession"</span>,workers = <span>4</span>)<span>#为了提高分析速度，这里设置多个核，大家可以自行修改</span><br>acts &lt;- run_ulm(mat, net,minsize = <span>5</span>,<br>                .source=<span>'source'</span>, .target=<span>'target'</span>,.mor=<span>'mor'</span>)<br></code></pre><p data-tool="mdnice编辑器">接着就是把预测结果添加到seurat对象中</p><pre data-tool="mdnice编辑器"><span></span><code>sce[[<span>'tfsulm'</span>]] &lt;- acts %&gt;%<br>  pivot_wider(id_cols = <span>'source'</span>, <br>              names_from = <span>'condition'</span>,<br>              values_from = <span>'score'</span>) %&gt;%<br>  column_to_rownames(<span>'source'</span>) %&gt;%<br>  Seurat::CreateAssayObject(.)<br>DefaultAssay(object = sce) &lt;- <span>"tfsulm"</span><br>sce &lt;- ScaleData(sce)<br>sce@assays$tfsulm@data &lt;- sce@assays$tfsulm@scale.data<br></code></pre><p data-tool="mdnice编辑器">可以用featureplot函数可视化某一个转录因子的预测结果</p><pre data-tool="mdnice编辑器"><span></span><code>p1 &lt;- DimPlot(sce, reduction = <span>"umap"</span>, <br>              label = <span>TRUE</span>, pt.size = <span>0.5</span>) + <br>  NoLegend() + ggtitle(<span>'Cell types'</span>)<br>p1<br><br>p2 &lt;- (FeaturePlot(sce, features = c(<span>"ATF3"</span>)) &amp; <br>         scale_colour_gradient2(low = <span>'blue'</span>, mid = <span>'white'</span>, high = <span>'red'</span>)) +<br>  ggtitle(<span>'ATF3 activity'</span>)<br>p2<br><br>DefaultAssay(object = sce) &lt;- <span>"RNA"</span><br>p3 &lt;- FeaturePlot(sce, features = c(<span>"ATF3"</span>)) + <br>  ggtitle(<span>'ATF3 expression'</span>)<br>p3<br><br>p1 + p2 + p3<br>ggsave(filename = <span>"ATF3.pdf"</span>,height = <span>4</span>,width = <span>12</span>)<br></code></pre><p><img data-galleryid="" data-imgfileid="100000888" data-ratio="0.3227792436235708" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdib1Z1PC1tUYickGNtVmzBngkw80JEbeEYuxZibkPnbznsWJ1PBcKt27Lw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1137" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdib1Z1PC1tUYickGNtVmzBngkw80JEbeEYuxZibkPnbznsWJ1PBcKt27Lw/640?wx_fmt=png&amp;from=appmsg"><span>从结果我们可以发现</span><span>在</span><span>各类</span><span>巨噬细胞中尽管表达量相差不大但是活性却</span><span>差异明显</span><span>。</span><span></span></p><p data-tool="mdnice编辑器">查看整体的分析结果，以排名前25的转录因子为例</p><pre data-tool="mdnice编辑器"><span></span><code>n_tfs &lt;- <span>25</span><br><span>#提取活性数据并修改数据格式</span><br>df &lt;- t(as.matrix(sce@assays$tfsulm@data)) %&gt;%<br>  as.data.frame() %&gt;%<br>  mutate(cluster = Idents(sce)) %&gt;%<br>  pivot_longer(cols = -cluster, <span>#指定除cluster列以外的都需要转换</span><br>               names_to = <span>"source"</span>, <span>#列名放到source列中</span><br>               values_to = <span>"score"</span>) %&gt;% <span>#值放到score列中</span><br>  group_by(cluster, <span>source</span>) %&gt;% <span>#将数据按cluster和source两列进行分组</span><br>  summarise(mean = mean(score))<br><br><span>#获得不同簇中活性差异较大的TFs</span><br>tfs &lt;- df %&gt;%<br>  group_by(<span>source</span>) %&gt;%<br>  summarise(std = sd(mean)) %&gt;%<br>  arrange(-abs(std)) %&gt;%<br>  head(n_tfs) %&gt;%<br>  pull(<span>source</span>)<br><br><span>#修改数据格式</span><br>top_acts_mat &lt;- df %&gt;%<br>  filter(<span>source</span> %<span>in</span>% tfs) %&gt;%<br>  pivot_wider(id_cols = <span>'cluster'</span>, <br>              names_from = <span>'source'</span>,<br>              values_from = <span>'mean'</span>) %&gt;%<br>  column_to_rownames(<span>'cluster'</span>) %&gt;%<br>  as.matrix()<br><br><span>#绘图</span><br>palette_length = <span>100</span><br>my_color = colorRampPalette(c(<span>"Darkblue"</span>,<span>"white"</span>,<span>"red"</span>))(palette_length)<br><br>my_breaks &lt;- c(seq(-<span>3</span>, <span>0</span>, length.out=ceiling(palette_length/<span>2</span>) + <span>1</span>),<br>               seq(<span>0.05</span>, <span>3</span>, length.out=floor(palette_length/<span>2</span>)))<br><br><span>#显示</span><br>pheatmap(top_acts_mat, <br>         border_color = <span>NA</span>,<br>         color=my_color, <br>         breaks = my_breaks)<br>ggsave(filename = <span>"top25.pdf"</span>,height = <span>4</span>,width = <span>8</span>)<br><br></code></pre><p><img data-galleryid="" data-imgfileid="100000891" data-ratio="0.46786922209695603" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdlkibeQ8dqtYc7icxMST0RYAau4tuJiaCBmJrVYbUzVORTeRZHvP9Qx54w/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="887" src="https://mmbiz.qpic.cn/mmbiz_png/PibBGN3Gt5GV9CSI2Z6EaiaCeJr2J7ibThdlkibeQ8dqtYc7icxMST0RYAau4tuJiaCBmJrVYbUzVORTeRZHvP9Qx54w/640?wx_fmt=png&amp;from=appmsg"></p><p data-tool="mdnice编辑器">到此就结束了，可以尝试一下哈~</p></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/402Ov0GwaJh6gm2KrrRDpw",target="_blank" rel="noopener noreferrer">原文链接</a>
