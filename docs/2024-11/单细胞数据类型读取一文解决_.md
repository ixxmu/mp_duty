---
title: "单细胞数据类型读取一文解决！"
date: 2024-11-29T22:16:33Z
draft: ["false"]
tags: [
  "fetched",
  "老俊俊的生信笔记"
]
categories: ["Acdemic"]
---
单细胞数据类型读取一文解决！ by 老俊俊的生信笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><section><mp-common-profile data-pluginname="mpprofile" data-id="MzkyMTI1MTYxNA==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usezgsqIGqjITSMggCTSoViaYeoKe2xoZr1IIvNJoztibQxibYHLDDoiabwAc6Ggws3Tvdo8EPss2nLgaVQ/0?wx_fmt=png" data-nickname="老俊俊的生信笔记" data-alias="JunJunLab" data-signature="老俊俊的生信技能和知识分享,我不是巨人,但你可以站在我的肩膀上更进一步!" data-from="0" data-is_biz_ban="0" data-service_type="1"></mp-common-profile></section></section><section><mp-common-clmusic data-pluginname="insertaudio" type="1" music_name="%E6%97%8B%E6%9C%A8" albumurl="http://wx.y.gtimg.cn/music/photo_new/T002R500x500M000001Aq2CM3jbJGW_4.jpg" singer="王菲" duration="253000" username="" music_source="1" is_vip="1" listenid="78225849675534112"></mp-common-clmusic><span></span></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span></span><span>引言</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p>去 <strong>GEO</strong> 数据库里找了 <strong>上百篇文章上传的 scRNA-seq 的数据类型</strong>，总结一下如何读取并构建对象。</p></blockquote><h2 data-tool="mdnice编辑器"><span></span><span>10x 常见格式</span><span></span></h2><p data-tool="mdnice编辑器">这个是最常见的格式，由 <strong>barcodes.tsv.gz</strong>，<strong>features.tsv.gz/genes.tsv.gz</strong>，<strong>matrix.mtx.gz</strong> 三个文件组成。分别<strong>是细胞的 barcode</strong>，<strong>基因名称信息</strong>，<strong>表达矩阵</strong> 组成。</p><p data-tool="mdnice编辑器"><strong>GSE240382：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032056" data-ratio="0.3614303959131545" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNTKeQH6whENpX8aJLQS2Z71xibhQvH2z7vTSEHSiaZL7iaELOTjN7KibQuOg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="783" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNTKeQH6whENpX8aJLQS2Z71xibhQvH2z7vTSEHSiaZL7iaELOTjN7KibQuOg/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器"><strong>GSE278612：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032054" data-ratio="0.3628205128205128" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNTgXEaDqKlPnLnuWTwaR3COKgD5T1zUbEE1QpfiboVel0mvJyaiac8dprA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="780" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNTgXEaDqKlPnLnuWTwaR3COKgD5T1zUbEE1QpfiboVel0mvJyaiac8dprA/640?wx_fmt=png&amp;from=appmsg"></figure><p data-tool="mdnice编辑器">读取构建 seurat 对象：</p><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(Seurat)<br><br>list.files(<span>"GSE278612_RAW/"</span>)<br><span># [1] "barcodes.tsv.gz" "features.tsv.gz" "matrix.mtx.gz"</span><br><br>sct &lt;- Read10X(data.dir = <span>"GSE278612_RAW/"</span>)<br><br>class(sct)<br><span># [1] "dgCMatrix"</span><br><span># attr(,"package")</span><br><span># [1] "Matrix"</span><br><br>obj &lt;- CreateSeuratObject(counts = sct,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>200</span>,<br>                          project = <span>"GSE278612"</span>)<br>obj<br><span># An object of class Seurat</span><br><span># 16542 features across 3684 samples within 1 assay</span><br><span># Active assay: RNA (16542 features, 0 variable features)</span><br><span># 1 layer present: counts</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>h5 格式</span><span></span></h2><p data-tool="mdnice编辑器">h5 格式具有更快的读取性能和存储效率，特别适合处理大规模的数据。一个 h5 格式文件就已经包含了 <strong>基因信息，细胞信息和表达矩阵。</strong></p><p data-tool="mdnice编辑器"><strong>GSE247368：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032055" data-ratio="0.29343629343629346" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNT1ZIhnhvwB7deSZJ2G2RVNHP75eKVCESStNYfgv1vDc6Xwd0D3iadpRw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="777" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNT1ZIhnhvwB7deSZJ2G2RVNHP75eKVCESStNYfgv1vDc6Xwd0D3iadpRw/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span># install.packages("hdf5r")</span><br><br>h5 &lt;- Read10X_h5(filename = <span>"GSE247368_RAW/GSM7887924_SingleCell_CTRL_C1-A_filtered_feature_bc_matrix.h5"</span>)<br>class(h5)<br><span># [1] "dgCMatrix"</span><br><span># attr(,"package")</span><br><span># [1] "Matrix"</span><br><br>obj &lt;- CreateSeuratObject(counts = h5,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>200</span>,<br>                          project = <span>"GSM7887924"</span>)<br>obj<br><span># An object of class Seurat</span><br><span># 25206 features across 4664 samples within 1 assay</span><br><span># Active assay: RNA (25206 features, 0 variable features)</span><br><span># 1 layer present: counts</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>RDS 格式</span><span></span></h2><p data-tool="mdnice编辑器">有些文章会直接上传保存好的 R 的对象 <strong>rds</strong> 文件，这样我们可以更方便读取。</p><p data-tool="mdnice编辑器"><strong>GSE277968：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032053" data-ratio="0.38974358974358975" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNTgcefFUksQ3KiclhrQicoTGYW42tYB3XRBLyCZjx1qzzofHMRQGT9kWPQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="780" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNTgcefFUksQ3KiclhrQicoTGYW42tYB3XRBLyCZjx1qzzofHMRQGT9kWPQ/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>rds &lt;- readRDS(<span>"GSE277968_RAW/GSM8536272_111-H1-D-ORG1_countmatrix.RDS"</span>)<br><br>class(rds)<br><span># [1] "dgCMatrix"</span><br><span># attr(,"package")</span><br><span># [1] "Matrix"</span><br><br>obj &lt;- CreateSeuratObject(counts = rds,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>200</span>,<br>                          project = <span>"GSM8536272"</span>)<br>obj<br><span># An object of class Seurat</span><br><span># 14137 features across 1114 samples within 1 assay</span><br><span># Active assay: RNA (14137 features, 0 variable features)</span><br><span># 1 layer present: counts</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>csv 格式</span><span></span></h2><p data-tool="mdnice编辑器">有些作者会直接上传 csv 格式的表达矩阵，也可以直接读取。<strong>不过我们需要仔细检查一下内容，比如下面这个需要进行转置一下，并把第一列处理位列名。</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032057" data-ratio="0.4491064491064491" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNT3stxAuWU9Pfu7uMQdqndxhmWjfl35m8Ec07371ck25QuXZLv3bQ4XA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1287" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNT3stxAuWU9Pfu7uMQdqndxhmWjfl35m8Ec07371ck25QuXZLv3bQ4XA/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code><span>library</span>(tidyverse)<br><br>csv &lt;- data.table::fread(<span>"GSE281843_RAW/GSM8630896_Combined_D7_CONTROLMYE_RSEC_MolsPerCell.csv.gz"</span>)<br><br><span># check</span><br>head(csv[<span>1</span>:<span>3</span>,<span>1</span>:<span>3</span>])<br><span>#    Cell_Index 0610005C13Rik 0610006L08Rik</span><br><span>#         &lt;int&gt;         &lt;int&gt;         &lt;int&gt;</span><br><span># 1:     581416             0             0</span><br><span># 2:     531922             0             0</span><br><span># 3:     845590             0             0</span><br><br>csv &lt;- csv %&gt;%<br>  column_to_rownames(var = <span>"Cell_Index"</span>) %&gt;%<br>  t()<br><br><span># check</span><br>head(csv[<span>1</span>:<span>3</span>,<span>1</span>:<span>3</span>])<br><span>#               581416 531922 845590</span><br><span># 0610005C13Rik      0      0      0</span><br><span># 0610006L08Rik      0      0      0</span><br><span># 0610009B22Rik      3      4      3</span><br><br>obj &lt;- CreateSeuratObject(counts = csv,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>200</span>,<br>                          project = <span>"GSE281843_RAW"</span>)<br>obj<br><span># An object of class Seurat</span><br><span># 16420 features across 7510 samples within 1 assay</span><br><span># Active assay: RNA (16420 features, 0 variable features)</span><br><span># 1 layer present: counts</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>txt 格式</span><span></span></h2><p data-tool="mdnice编辑器">这个也是文本格式的表达矩阵，和 csv 一样。</p><p data-tool="mdnice编辑器"><strong>GSE158035：</strong></p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032061" data-ratio="0.24646983311938384" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNTN93ib6bibnblAO9DRRJCJYQc4yDwUzK39t9ibc3I6lBMMgr15XbA8enYQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="779" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNTN93ib6bibnblAO9DRRJCJYQc4yDwUzK39t9ibc3I6lBMMgr15XbA8enYQ/640?wx_fmt=png&amp;from=appmsg"></figure><pre data-tool="mdnice编辑器"><span></span><code>txt_ct &lt;- data.table::fread(<span>"GSE158035_RAW/GSM4785638_hPO1805_counts.txt.gz"</span>)<br><br><span># check</span><br>head(txt_ct[<span>1</span>:<span>3</span>,<span>1</span>:<span>3</span>])<br><span>#      gene AAAAGGGTTAAT AAAATTCGCATG</span><br><span>#    &lt;char&gt;        &lt;int&gt;        &lt;int&gt;</span><br><span># 1:   A1BG            0            0</span><br><span># 2:   A1CF            0            0</span><br><span># 3:    A2M            0            0</span><br><br>txt_ct &lt;- txt_ct %&gt;%<br>  column_to_rownames(var = <span>"gene"</span>)<br><br>obj &lt;- CreateSeuratObject(counts = txt_ct,<br>                          min.cells = <span>5</span>,<br>                          min.features = <span>200</span>,<br>                          project = <span>"GSE158035"</span>)<br>obj<br><span># An object of class Seurat</span><br><span># 14588 features across 925 samples within 1 assay</span><br><span># Active assay: RNA (14588 features, 0 variable features)</span><br><span># 1 layer present: counts</span><br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>多样本处理</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>如果是多个样本，我们直接 lapply 循环批量循环读取，然后保存到 list 里面，最后使用 merge 函数进行合并即可。关于要不要使用 JoinLayers 函数来合并不同的 layers，取决于你要不要使用 seurat 自带的去批次函数。如果使用就不要合并 layers，比如使用外置的 harmony 函数就合并一下。</strong></p></blockquote><p data-tool="mdnice编辑器"><strong>示例：</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span># ====================================================================================================</span><br><span># loop read files</span><br><span># ====================================================================================================</span><br><span># x = 1</span><br>sct_list &lt;- lapply(seq_along(sample_name), <span>function</span>(x){<br>  tmp &lt;- Read10X(data.dir = paste(<span>"1.raw-data/"</span>,sample_name[x],sep = <span>""</span>))<br><br>  sct &lt;- CreateSeuratObject(counts = tmp,<br>                            project = sample_name[x],<br>                            min.cells = <span>5</span>,<br>                            min.features = <span>200</span>)<br><br>  <span>return</span>(sct)<br>})<br><br><span># combine list into object</span><br>sct.all &lt;- merge(x = sct_list[[<span>1</span>]],<br>                 y = sct_list[-<span>1</span>],<br>                 add.cell.ids = sample_name)<br><br>dim(sct.all[[<span>"RNA"</span>]]$counts)<br><br><span># combine multiple layers</span><br>sct.all &lt;- JoinLayers(sct.all)<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>结尾</span><span></span></h2><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong>路漫漫其修远兮,吾将上下而求索。</strong></p></blockquote><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器">欢迎加入生信交流群。加我微信我也拉你进 <strong>微信群聊</strong> <strong>老俊俊生信交流群</strong> <strong>(微信交流群需收取 20 元入群费用,一旦交费,拒不退还!(防止骗子和便于管理))</strong> 。</p><figure data-tool="mdnice编辑器"><img data-imgfileid="100032062" data-ratio="0.6083707025411061" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNT4nbzgELHMZGDmOAqkyQhaf2cicOTOuXtvX9CSr5Inxe23vPYwj5EYZQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="669" src="https://mmbiz.qpic.cn/sz_mmbiz_png/G5jjcE4usexicAiayROrz5VPq10O0M7BNT4nbzgELHMZGDmOAqkyQhaf2cicOTOuXtvX9CSr5Inxe23vPYwj5EYZQ/640?wx_fmt=png&amp;from=appmsg"></figure><hr data-tool="mdnice编辑器"><p data-tool="mdnice编辑器"><strong></strong></p><center data-tool="mdnice编辑器"><strong> 往期回顾目录 </strong></center><p data-tool="mdnice编辑器"><br></p><blockquote data-tool="mdnice编辑器"><span>❝</span><p><strong></strong></p><center><strong><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515672&amp;idx=1&amp;sn=3878299038763a15e2503340942d9660&amp;token=902807353&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">从 gtf 文件构建 orgdb 和 txdb 数据库</a></strong></center><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515655&amp;idx=1&amp;sn=03c1bf4a081fb561468a4f3c40331615&amp;token=1970442110&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">easybio 基于 CellMarker2.0 数据库进行亚群注释</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515609&amp;idx=1&amp;sn=2f81a1d58af368bc0a261a59f4026652&amp;token=1970442110&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">写一个 R 版本的 ORFfinder</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515569&amp;idx=1&amp;sn=8838873a67cd108744a6206f1c9e3972&amp;chksm=c18487c0f6f30ed66faed2ec61160fb8fe8466fc650e32560a16051f032264864f577b04fb29&amp;token=837342039&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">TCGA+GTEX 数据联合分析</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515543&amp;idx=1&amp;sn=49d6991c5d610fbe3fda761b7421934d&amp;chksm=c18487e6f6f30ef002f9e7d88bb19c2fed2de330786d1ad69d36c713b444f19b64aca79e27c2&amp;token=837342039&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">SNAF 新型计算工具鉴定广谱癌症新抗原</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515529&amp;idx=1&amp;sn=b047eb05ccbce0a9ad6ee734b4188416&amp;chksm=c18487f8f6f30eee3c027ac7c5f9b0babcc2fe737dfc2a6c5236e906ec6853b1f508e184af5f&amp;token=2137498509&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">听说你想给 visCluster 添加行注释？</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515507&amp;idx=1&amp;sn=bfd0f92a6dbad64dd41d8242e4868132&amp;chksm=c1848702f6f30e140bbe092108d9eeadf4e9e7b9ca13fa33a5575bfc778a7d2af01c982a622f&amp;token=2137498509&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">Julia 中也可以使用 ggplot？</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515491&amp;idx=1&amp;sn=d2cfe70986882a8cbc4aecb23fbc1dad&amp;chksm=c1848712f6f30e0413b5808b4cb284b7a98b4e374812d71b8e7e1f3278a3308d6ea1e8a7600d&amp;token=697561698&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">trackc：HiC 数据可视化神器！</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515447&amp;idx=1&amp;sn=d8e01ea8fe0b37ee430142ea058a0f9d&amp;chksm=c1848746f6f30e50d75249f9a198946d211e08317960ce7388f2dde95db27d3f9351195aa211&amp;token=697561698&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">scplotter：单细胞可视化神包！</a></center></strong><strong><center><a href="https://mp.weixin.qq.com/s?__biz=MzkyMTI1MTYxNA==&amp;mid=2247515426&amp;idx=1&amp;sn=a4911c55b9f53ea046cf7aebc5fc0855&amp;chksm=c1848753f6f30e4561303f7f5da0edcb9008ca7925b111e25cb365f9df7962bd57c937c341cb&amp;token=96515316&amp;lang=zh_CN&amp;scene=21#wechat_redirect" data-linktype="2">GseaVis 绘制山脊图</a></center></strong><p><br></p></blockquote></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/4nlGSoFyV3j1hzw3OSbJvA",target="_blank" rel="noopener noreferrer">原文链接</a>
