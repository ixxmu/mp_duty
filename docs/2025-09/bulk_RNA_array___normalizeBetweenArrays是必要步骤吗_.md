---
title: "bulk RNA-array | normalizeBetweenArrays是必要步骤吗？"
date: 2025-09-03T15:38:25Z
draft: ["false"]
tags: [
  "fetched",
  "被炸熟的虾"
]
categories: ["Acdemic"]
---
bulk RNA-array | normalizeBetweenArrays是必要步骤吗？ by 被炸熟的虾
------
<div><section><section><span leaf=""><span textstyle="">normalizeBetweenArrays</span></span><span leaf="">函数作为</span><code><span leaf=""><span textstyle="">limma</span></span></code><span leaf="">包中的一个常用函数，用于对基因表达数据进行归一化处理，其使用场合经常与</span><code><span leaf=""><span textstyle="">removeBatchEffect</span></span></code><span leaf="">混淆：</span></section><ul><li><section><strong><code><span leaf=""><span textstyle="">normalizeBetweenArrays</span></span></code><strong><span leaf="">：主要用于</span></strong><span leaf=""><span textstyle="">单个数据集内部的标准化处理</span></span></strong><span leaf="">，目的是消除不同样本之间的技术差异，使数据具有可比性，它通常是一种</span><strong><span leaf=""><span textstyle="">无监督</span></span></strong><span leaf="">的调整。</span></section></li><li><section><strong><code><span leaf=""><span textstyle="">removeBatchEffect</span></span></code><strong><span leaf="">：目标是</span></strong><span leaf=""><span textstyle="">移除已知的、特定的批次效应</span></span></strong><span leaf="">，从而在数据中更好地</span><strong><span leaf="">揭示感兴趣的生物学效应</span></strong><span leaf="">。它需要你明确知道每个样本属于哪个“批次”，是一种</span><strong><span leaf=""><span textstyle="">有监督</span></span></strong><span leaf=""><span textstyle="">的校正</span>。</span></section></li></ul><p><span leaf="">查询了一下</span><span leaf="">DeepSeek</span><span leaf="">，给出了一个非常好的例子：</span></p><ol><li><section><code><span leaf=""><span textstyle="">normalizeBetweenArrays</span></span></code><span leaf="">(标准化)</span></section></li></ol><p><span leaf="">想象一下，你用两个不同的相机，在不同的光线下给同一组苹果拍照。一张照片偏黄且暗，另一张偏蓝且亮。标准化的过程就像是调整这两张照片的</span><strong><span leaf="">亮度、对比度和白平衡</span></strong><span leaf="">，使得苹果的颜色在两个图片中看起来是在</span><strong><span leaf="">相同的基准条件</span></strong><span leaf="">下拍摄的。</span></p><ol start="2"><li><section><code><span leaf=""><span textstyle="">removeBatchEffect</span></span></code><span leaf="">(去批次)</span></section></li></ol><p><span leaf="">现在，假设你不仅拍了苹果，还拍了橙子。但不幸的是，所有的苹果都是用第一个相机拍的，所有的橙子都是用第二个相机拍的。此时，苹果和橙子颜色（基因表达）的差异，既来源于它们本身（生物学），</span><strong><span leaf="">也来源于相机和光线（批次效应）</span></strong><span leaf="">。去批次的过程就是：你已知“哪个水果是用哪个相机拍的”这个信息，然后通过统计模型</span><strong><span leaf="">估计出相机带来的颜色偏差有多大</span></strong><span leaf="">，并从数据中</span><strong><span leaf="">减去这个估计值</span></strong><span leaf="">。这样，剩下的差异就更纯粹地反映了“苹果 </span><span leaf="">vs</span><span leaf=""> 橙子”的真实生物学差异。</span></p><p><span leaf="">一个典型的工作流程如下：</span><strong><span leaf="">原始数据</span><span leaf=""> -&gt; 2.</span><span leaf="">标准化</span><span leaf=""> -&gt; 3.</span><span leaf="">差异表达分析 或 </span><span leaf="">3.</span><span leaf=""> </span><span leaf="">去批次</span><span leaf=""> -&gt; 4.</span><span leaf="">可视化</span></strong></p><h2 data-pm-slice="0 0 []"><span><span leaf="">一、函数使用方法</span></span></h2><pre><code><span leaf="">normalizeBetweenArrays(object, method = </span><span><span leaf="">NULL</span></span><span leaf="">, targets = </span><span><span leaf="">NULL</span></span><span leaf="">, cyclic.method = </span><span><span leaf="">"fast"</span></span><span leaf="">, </span><span><span leaf="">...</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><ul><li><section><code><span leaf=""><span textstyle="">object</span></span></code><span leaf="">：需要进行归一化的数据对象，通常是一个</span><strong><span leaf="">表达矩阵</span></strong><span leaf="">（行代表基因/探针，列代表样品）或特定的数据结构，如</span><code><span leaf=""><span textstyle="">MAList</span></span></code><span leaf="">、</span><code><span leaf=""><span textstyle="">EList</span></span></code><span leaf="">等。</span></section></li></ul><blockquote><section><p><span leaf="">If </span><code><span leaf="">object</span></code><span leaf=""> is a matrix then </span><code><span leaf="">normalizeBetweenArrays</span></code><span leaf=""> produces a matrix of the same size. If </span><code><span leaf="">object</span></code><span leaf=""> is an </span><code><span leaf="">EListRaw</span></code><span leaf=""> object, then an </span><code><span leaf="">EList</span></code><span leaf=""> object with expression values on the log2 scale is produced. </span></p></section><section data-json="%7B%22type%22%3A%22out%22%2C%22article%22%3A%7B%7D%2C%22from%22%3A%22https%3A%2F%2Frdrr.io%2Fbioc%2Flimma%2Fman%2Fnormalizebetweenarrays.html%22%7D"><span>https://rdrr.io/bioc/limma/man/normalizebetweenarrays.html</span></section></blockquote><section><blockquote><section><p data-pm-slice='2 2 ["para",{"tagName":"section","attributes":{},"namespaceURI":""},"blockquote",{"type":"out","editId":null,"title":"","url":"","nickname":"","authorName":"","from":"https://rdrr.io/bioc/limma/man/normalizebetweenarrays.html","style":null}]'><span leaf="">For two-color data, </span><code><span leaf="">normalizeBetweenArrays</span></code><span leaf=""> produces an </span><code><span leaf="">MAList</span></code><span leaf=""> object with M and A-values on the log2 scale.</span></p></section><section data-json="%7B%22type%22%3A%22out%22%2C%22article%22%3A%7B%7D%2C%22from%22%3A%22https%3A%2F%2Frdrr.io%2Fbioc%2Flimma%2Fman%2Fnormalizebetweenarrays.html%22%7D"><span>https://rdrr.io/bioc/limma/man/normalizebetweenarrays.html</span></section></blockquote></section><ul><li><section><code><span leaf=""><span textstyle="">method</span></span></code><span leaf="">：指定归一化方法，单通道数据的选项包括</span><span leaf=""><span textstyle="">none</span></span><span leaf="">、</span><span leaf=""><span textstyle="">scale</span></span><span leaf="">、</span><span leaf=""><span textstyle="">quantile</span></span><span leaf="">或</span><span leaf=""><span textstyle="">cyclicloess</span></span><span leaf="">。双色数据的选项包括前面提到的选项以及</span><code><span leaf=""><span textstyle="">Aquantile</span></span></code><span leaf="">、</span><code><span leaf=""><span textstyle="">Gquantile</span></span></code><span leaf="">、</span><code><span leaf=""><span textstyle="">Rquantile</span></span></code><span leaf="">或</span><code><span leaf=""><span textstyle="">Tquantile</span></span></code><span leaf="">。双色数据对象的默认值为</span><span leaf=""><span textstyle="">Aquantile，</span></span><span leaf="">单通道数据的默认值为</span><span leaf=""><span textstyle="">quantile</span></span><span leaf="">。</span></section></li></ul><pre><code><span><span leaf="">library</span></span><span leaf="">(limma)</span><span leaf=""><br></span><span><span leaf=""># 假设有一个原始表达矩阵 raw_data</span></span><span leaf=""><br></span><span><span leaf=""># 行是基因，列是样品：Sample1， Sample2, Sample3</span></span><span leaf=""><br></span><span leaf="">head(raw_data)</span><span leaf=""><br></span><span><span leaf=""># 使用默认的分位数标准化方法</span></span><span leaf=""><br></span><span leaf="">normalized_data &lt;- normalizeBetweenArrays(raw_data)</span><span leaf=""><br></span></code></pre><h2><span><span leaf="">二、使用</span></span></h2><h4><span leaf="">Quantile Normalization（分位数归一化）</span></h4><p><span leaf="">分位数归一化是最常用的方法，其核心思想是调整数据的分布，使不同样本的分布趋于一致。具体步骤如下：</span></p><ol><li><section><strong><span leaf="">计算分位数</span></strong><span leaf="">：对于每个样本，计算其基因表达值的分位数并排序。</span></section></li><li><section><strong><span leaf="">平均分位数</span></strong><span leaf="">：计算所有样本在每个分位数上的平均值。</span></section></li><li><section><strong><span leaf="">替换分位数</span></strong><span leaf="">：将每个样本的分位数替换为平均分位数，从而调整每个样本的分布。</span></section></li></ol><p><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JBslRmKF1C8S6yxeWA6D1GC8jFvDHmxibfrFwX6GRp8IZLibnFBWGvvWZj5fBOVHyOvTiaEEBundFBw/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="0.462037037037037" data-type="jpeg" data-w="1080" data-imgfileid="100007746" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JBslRmKF1C8S6yxeWA6D1GC8jFvDHmxibfrFwX6GRp8IZLibnFBWGvvWZj5fBOVHyOvTiaEEBundFBw/640?wx_fmt=jpeg&amp;from=appmsg"></span></p><p><span leaf="">图片来源：</span><span leaf="">https://cloud.tencent.com.cn/developer/article/2222292</span></p><p><span leaf="">但是呢，<span textstyle="">也有研究表明，</span></span><span leaf=""><span textstyle="">quantile normalization</span></span><span leaf=""><span textstyle="">之后的数据会改变原始数据的分布，造成有些差异基因不显著</span>，比如大家可以看看</span><strong><span leaf="">生信技能树：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247513933&amp;idx=1&amp;sn=20754b3d766d401686cc6979d9ced490&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2"><span textstyle="">哪有什么对错呢</span></a></span></strong></p><p><span leaf="">而且吧，</span><span leaf=""><span textstyle="">GEO2R</span></span><span leaf=""><span textstyle="">的官方代码里没有加上这一步骤</span>，这是因为官方处理后的矩阵通常均一性比较好？<span textstyle="">那个人从原始数据从头提取的表达矩阵是不是需要添加这一步着呢？多大程度的“离散”需要添加这一步呢？</span></span></p><h4><span leaf="">Scale Normalization</span></h4><p><span leaf="">核心目标是</span><strong><span leaf="">调整每个样本的表达量，使得每个样本的表达量拥有相同的中位数</span></strong><span leaf="">。它</span><strong><span leaf="">不会改变每个样本内部数据的分布形状</span></strong><span leaf="">，只是进行了一次“平移”和“缩放”。处理后的数据，箱线图的中位线会齐平，但盒子的宽度（四分位距）和异常值分布可能仍各不相同。</span></p><p><span leaf=""><span textstyle="">有的教程提到</span></span><span data-pm-slice="0 0 []"><span leaf=""><span textstyle="">它比</span></span><span leaf=""><span textstyle="">q</span></span><span leaf=""><span textstyle="">uantile</span></span><span leaf=""><span textstyle="">方法更</span></span></span><strong><span leaf=""><span textstyle="">保守</span></span></strong><span leaf=""><span textstyle="">，保留了更多样本自身的分布特性，</span>但是吧，个人只在</span><span leaf="">agilent</span><span leaf="">双色芯片处理中见过几次，难以评价。</span></p><pre><code><span leaf="">options(timeout = </span><span><span leaf="">100000</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(GEOquery) </span><span leaf=""><br></span><span leaf="">gset &lt;- getGEO(</span><span><span leaf="">"GSE97508"</span></span><span leaf="">,destdir = </span><span><span leaf="">"."</span></span><span leaf="">,getGPL = </span><span><span leaf="">FALSE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">eSet &lt;- gset[[</span><span><span leaf="">1</span></span><span leaf="">]]</span><span leaf=""><br></span><span leaf="">raw_data &lt;- exprs(eSet);</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(limma) </span><span leaf=""><br></span><span leaf="">quantileData &lt;- normalizeBetweenArrays(raw_data, method = </span><span><span leaf="">"quantile"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">scaleData &lt;- normalizeBetweenArrays(raw_data, method = </span><span><span leaf="">"scale"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><section nodeleaf=""><img data-imgfileid="100007740" data-ratio="0.4666666666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JBslRmKF1C8S6yxeWA6D1GqppSiaPRfrvsdEiajnEQEP0lgRkYKruGfrgIZicfLk1YD3CK6TLJdGrIA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JBslRmKF1C8S6yxeWA6D1GqppSiaPRfrvsdEiajnEQEP0lgRkYKruGfrgIZicfLk1YD3CK6TLJdGrIA/640?wx_fmt=png&amp;from=appmsg"></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JBslRmKF1C8S6yxeWA6D1GhhDsNDc2kToXdlrByWDbB0eVMKerd2JvPjM2hGBFoSNIlyOhTHflTw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.38796296296296295" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100007741" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3JBslRmKF1C8S6yxeWA6D1GhhDsNDc2kToXdlrByWDbB0eVMKerd2JvPjM2hGBFoSNIlyOhTHflTw/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf="">quantile</span><span leaf="">处理后平滑了很多，分布趋势更加一致</span></p></section><section nodeleaf=""><img data-ratio="0.05278592375366569" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-type="png" data-w="341" src="https://mmbiz.qpic.cn/sz_mmbiz_png/1LTeQhNfr8sUH75oYsoDaqjPCTiaukEmS8tWricW7LnLKKfIE9jKBexibqamsrlibaaXmuc2nicaYibfDFBNCmqX5mBw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section><section data-tools="135编辑器" data-id="116886"><section><section><section><section><strong data-brushtype="text"><span leaf="">被炸熟的虾</span></strong></section></section></section><section><section><section data-width="35%"><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-ratio="1" data-type="jpeg" data-w="258" data-width="100%" data-cropselx1="0" data-cropselx2="115" data-cropsely1="0" data-cropsely2="115" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/dRYYdqiaan3JjDfj2H8p6gg3CB25AGthbwzrotao4ev5tIe0utthbZRK8yOoDOuTzOSoTSnPWn61IdDCnXsnaiag/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></section></section><section data-width="63%"><section><section><strong><span leaf="">自己的摸索，发现问题麻烦告诉作者，光速回来改正</span></strong><strong><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" data-ratio="1" data-type="png" data-w="64" src="https://mmbiz.qpic.cn/sz_mmbiz_png/dRYYdqiaan3KLQGNxibvI4SdtUfxjINkz2DO8cGEPTgbcMJ357RvXJ7IvWU2p7anljpePpakI9oKu3icJxobBDp5w/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></span></strong></section></section></section></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/SklN1aFCJ_Gec4RSv2scng",target="_blank" rel="noopener noreferrer">原文链接</a>
