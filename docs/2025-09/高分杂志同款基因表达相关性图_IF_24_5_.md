---
title: "高分杂志同款基因表达相关性图（IF=24.5）"
date: 2025-09-02T11:06:15Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
高分杂志同款基因表达相关性图（IF=24.5） by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><blockquote><p><span leaf="">今天给大家分享一个高分杂志中的相关性图，图来自<span textstyle="">2024年发表在杂志 Gut （IF=24.5）</span>上的文献，标题为<span textstyle="">《CAF-macrophage crosstalk in tumour microenvironments governs the response to immune checkpoint blockade in gastric cancer peritoneal  metastases》</span>，文献中用来展示细胞亚群之间的相关性，我们这里可以应用到基因表达相关性中。</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">这种图比一般的热图要好看一些，<span textstyle="">图中的椭圆越细，表明相关性越高（正相关为红色，负相关为蓝色）。</span></span></p><p data-tool="mdnice编辑器"><span leaf="">我们在前面也给大家介绍过：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247536601&amp;idx=1&amp;sn=a9027e4226364f984ccea332c8b6fa28&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">你没见过的两种高颜值单细胞亚群相关性热图</a></span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgbeQzPdVY6KPCrEEZoRCezE9x51zG15Mjvu5K2QXZItU0thzy75jZVjLBnfk39RBaMhYSDVC8ibA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.9777777777777777" data-type="png" data-w="1080" data-imgfileid="100061824" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgbeQzPdVY6KPCrEEZoRCezE9x51zG15Mjvu5K2QXZItU0thzy75jZVjLBnfk39RBaMhYSDVC8ibA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">图注：</span></p><blockquote><p><strong><span leaf="">「Figure 6」</span></strong><span leaf=""> Crosstalk between fibroblasts and macrophages in peritoneal metastases of gastric cancer. (A) Heatmap displaying the correlations across all cell types in the single-cell data. </span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">如果是<span textstyle="">样本数或者基因数或者细胞亚群数比较多</span>的时候，是这个效果：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wwgbeQzPdVY6KPCrEEZoRCev0icR9er6Bw7sZSydzcLtA6406Szsn572Q3L23Ub5nL7hQw6nyVQOSg/640?wx_fmt=jpeg&amp;from=appmsg" data-ratio="0.9185185185185185" data-type="jpeg" data-w="1080" data-imgfileid="100061825" src="https://mmbiz.qpic.cn/mmbiz_jpg/cZNhZQ6j4wwgbeQzPdVY6KPCrEEZoRCev0icR9er6Bw7sZSydzcLtA6406Szsn572Q3L23Ub5nL7hQw6nyVQOSg/640?wx_fmt=jpeg&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">下面就看试试！</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">示例数据</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">这里就用以前的帖子：<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247542498&amp;idx=1&amp;sn=0dee2bd4d1ddf0a85c514cea81c178ea&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">多分组差异表达分析实战：GSE126848（DESeq2版本）</a></span></p><p data-tool="mdnice编辑器"><span leaf="">这个数据有四个分组，每组样本数如下：</span></p><ul><li><section><strong><span leaf="">「健康正常体重个体」</span></strong><span leaf="">：healthy normal weight (n  14)，共14例，作为对照组，其体重处于正常范围，没有肝脏疾病。</span></section></li><li><section><strong><span leaf="">「肥胖个体」</span></strong><span leaf="">：obese (n  12)，共12例，体重超出正常范围，但文中未明确说明这些肥胖个体是否伴有肝脏疾病，可能仅用于对比正常体重个体的肝脏状态。</span></section></li><li><section><strong><span leaf="">「NAFL患者」</span></strong><span leaf="">：NAFL (n  15)，非酒精性脂肪肝患者NAFLD，共15例。这类患者肝脏存在脂肪堆积，但未达到非酒精性脂肪性肝炎的严重程度。</span></section></li><li><section><strong><span leaf="">「NASH患者」</span></strong><span leaf="">：NASH (n  16)，非酒精性脂肪性肝炎患者NASH，共16例。这类患者不仅存在肝脏脂肪堆积，还伴有炎症和肝细胞损伤，是NAFL的更严重形式。</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">样本表达矩阵与分组信息处理就用上面这个帖子中的代码，这里直接加载处理好的数据：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span leaf="">options(scipen = 1000)</span><span leaf=""><br></span><span><span leaf=""># 加载seurat数据集 </span></span><span leaf=""><br></span><span leaf="">library(tidyverse)</span><span leaf=""><br></span><span leaf="">library(ggpubr)</span><span leaf=""><br></span><span leaf="">library(magrittr)</span><span leaf=""><br></span><span leaf="">library(ggsignif)</span><span leaf=""><br></span><span leaf="">library(ggrastr)</span><span leaf=""><br></span><span><span leaf=""># devtools::install_github("LKremer/ggpointdensity")</span></span><span leaf=""><br></span><span leaf="">library(ggpointdensity)</span><span leaf=""><br></span><span><span leaf=""># InstallData("pbmc3k")</span></span><span leaf=""><br></span><span><span leaf=""># BiocManager::install('caijun/ggcorrplot2')</span></span><span leaf=""><br></span><span leaf="">library(ggcorrplot2) </span><span><span leaf=""># 绘制下三角相关性椭圆图ggcorrplot</span></span><span leaf=""><br></span><span leaf="">library(ggplot2)</span><span leaf=""><br></span><span leaf="">library(sur)</span><span leaf=""><br></span><span leaf="">library(reshape2)</span><span leaf=""><br></span><span leaf="">library(psych) </span><span><span leaf=""># 相关性计算</span></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## 加载数据</span></span><span leaf=""><br></span><span leaf="">load(</span><span><span leaf="">"/nas2/zhangj/project/02-bulk-rnaseq/2019-GSE126848-nash病人的4分组转录组/GSE126848/step1-output.Rdata"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">ls()</span><span leaf=""><br></span><span leaf="">head(dat) </span><span><span leaf=""># cpm标准化值</span></span><span leaf=""><br></span><span leaf="">symbol_matrix[1:5,1:5] </span><span><span leaf=""># counts值</span></span><span leaf=""><br></span><span leaf="">table(group_list) </span><span><span leaf=""># 57个样本，分组信息</span></span><span leaf=""><br></span><span leaf="">length(group_list)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgbeQzPdVY6KPCrEEZoRCeVTC1uR72EE1ibvMLnyaZZiaPTe0ibOwPokTGA9tULOOfREwZnbmzk3YGw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.30927835051546393" data-type="png" data-w="970" data-imgfileid="100061822" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgbeQzPdVY6KPCrEEZoRCeVTC1uR72EE1ibvMLnyaZZiaPTe0ibOwPokTGA9tULOOfREwZnbmzk3YGw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">相关性图绘制</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">上面这种图有负的相关性和正的相关性做起来会比较好看，不太适用于样本与样本之间的相关性（基本上都是正相关），因为 ggcorrplot 函数里面颜色的映射范围为[-1,1]。</span></p><p data-tool="mdnice编辑器"><span leaf="">这里我们就先做基因表达相关性吧，下次想办法搞个样本间的相关性。</span></p><p data-tool="mdnice编辑器"><span leaf="">这里的基因我们随便选择20个，如果是自己做项目，可以根据差异基因或者预后或者其他什么条件筛选一些基因出来进行展示：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf=""># 选择差异变化大的基因算相关性</span></span><span leaf=""><br></span><span><span leaf=""># mad: 绝对中位差</span></span><span leaf=""><br></span><span><span leaf=""># sd:标准差</span></span><span leaf=""><br></span><span leaf="">exprSet &lt;- dat</span><span leaf=""><br></span><span leaf="">exprSet &lt;- exprSet[names(sort(apply(exprSet, 1, mad),decreasing = T)[1:20]),]</span><span leaf=""><br></span><span leaf="">exprSet &lt;- t(exprSet)</span><span leaf=""><br></span><span leaf="">dim(exprSet)</span><span leaf=""><br></span><span leaf="">pheatmap::pheatmap(cor(exprSet))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">cor_value &lt;- cor(exprSet)</span><span leaf=""><br></span><span leaf="">cor_test_mat &lt;- corr.test(exprSet)</span><span><span leaf="">$p</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">cor_pp1 &lt;- ggcorrplot(cor_value, method = </span><span><span leaf="">"ellipse"</span></span><span leaf="">,</span><span><span leaf="">type</span></span><span leaf=""> = </span><span><span leaf="">"lower"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                    p.mat = cor_test_mat,</span><span leaf=""><br></span><span leaf="">                    col = c(</span><span><span leaf="">"<a topic-id="mf17etsm-43s6v1" data-topic="1">#8aa3db</a>"</span></span><span leaf="">, </span><span><span leaf="">"white"</span></span><span leaf="">, </span><span><span leaf="">"<a topic-id="mf17etsm-wzfliu" data-topic="1">#fd9a9a</a>"</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">                    pch.cex = 4.5, </span><span><span leaf=""># 显著性*号的大小</span></span><span leaf=""><br></span><span leaf="">                    insig = </span><span><span leaf="">"label_sig"</span></span><span leaf="">, sig.lvl = c(0.05, 0.01, 0.001) </span><span><span leaf=""># (e.g. "*", "**", "***") </span></span><span leaf=""><br></span><span leaf="">                    )  +</span><span leaf=""><br></span><span leaf="">  guides(color = guide_legend(override.aes = list(size = 1))) + </span><span leaf=""><br></span><span leaf="">  theme(axis.text = element_text(size=10),</span><span leaf=""><br></span><span leaf="">        legend.key.width = unit(0.5, </span><span><span leaf="">"lines"</span></span><span leaf="">),  </span><span><span leaf=""># 调整图例键的宽度</span></span><span leaf=""><br></span><span leaf="">        legend.key.height = unit(0.5, </span><span><span leaf="">"lines"</span></span><span leaf="">)  </span><span><span leaf=""># 调整图例键的高度</span></span><span leaf=""><br></span><span leaf="">  )</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">cor_pp1 </span><span leaf=""><br></span><span leaf="">ggsave(filename = </span><span><span leaf="">'gene_cor.pdf'</span></span><span leaf="">,width = 8,height = 8,plot = cor_pp1 )</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">结果如下：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgbeQzPdVY6KPCrEEZoRCeqsicJJicfpSTcbV5oyPWtbEKBcNiavsIDXOUR1qZF37SeXqYNnUuFp0Qw/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.000925925925926" data-type="png" data-w="1080" data-imgfileid="100061823" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwgbeQzPdVY6KPCrEEZoRCeqsicJJicfpSTcbV5oyPWtbEKBcNiavsIDXOUR1qZF37SeXqYNnUuFp0Qw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">是不是很漂亮！</span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf="">如果上面的代码学习对你来说有困难，可以看看下面的链接！</span></p></section><ul><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247545329&amp;idx=1&amp;sn=71930835b79306606c59d7aa8c632490&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课9月班" data-itemshowtype="0" linktype="text" data-linktype="2">生信入门&amp;数据挖掘线上直播课9月班</a><span textstyle="">，你的生物信息学入门课</span></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525079&amp;idx=1&amp;sn=0b997af16a58195b4192691373048fd5&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" textvalue="满足你生信分析计算需求的低价解决方案" data-itemshowtype="0" linktype="text" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=1679199708449144836&amp;scene=173&amp;subscene=207&amp;sessionid=1745492310&amp;enterid=1745492314&amp;from_msgid=2247541298&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信故事会" data-itemshowtype="0" linktype="text" data-linktype="2">生信故事会</a>，来看看他们的生信入门故事</span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=3690970204957147140&amp;scene=173&amp;subscene=207&amp;sessionid=1745066271&amp;enterid=1745066274&amp;from_msgid=2247540702&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信马拉松答疑专辑" data-itemshowtype="0" linktype="text" data-linktype="2">生信马拉松答疑专辑</a>，获取你的生信专属答疑</span></section></li></ul><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/OK1UCgE9wuTGaMPiuf7UTA",target="_blank" rel="noopener noreferrer">原文链接</a>
