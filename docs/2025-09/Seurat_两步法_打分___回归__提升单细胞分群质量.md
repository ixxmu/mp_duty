---
title: "Seurat 两步法：打分 + 回归， 提升单细胞分群质量"
date: 2025-09-20T15:04:15Z
draft: ["false"]
tags: [
  "fetched",
  "生信小博士"
]
categories: ["Acdemic"]
---
Seurat 两步法：打分 + 回归， 提升单细胞分群质量 by 生信小博士
------
<div><p data-tool="mdnice编辑器" data-pm-slice="0 0 []"><span leaf="">单细胞数据中，</span><strong data-start="8434" data-end="8472"><span leaf="">线粒体基因、</span><span leaf="">核糖体蛋白基因</span></strong><span leaf="">以及</span><strong data-start="8474" data-end="8484"><span leaf="">细胞周期状态</span></strong><span leaf="">都是可能影响细胞聚类及后续细胞注释的因素.</span></p><section data-pm-slice="3 2 []"><strong data-start="179" data-end="190" data-pm-slice="0 0 []"><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{"data-pm-slice":"3 2 []"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"node",{"tagName":"strong","attributes":{"data-start":"179","data-end":"190","data-pm-slice":"0 0 []"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'><span textstyle="">细胞周期基因</span></span></strong></section><section data-pm-slice="3 2 []"><strong data-start="179" data-end="190" data-pm-slice="0 0 []"><span leaf="">细胞周期异质性 </span></strong><strong data-start="179" data-end="190" data-pm-slice="0 0 []"><span leaf="">往往会干扰</span><span leaf="">我们对细胞类型和状态的判断。Seurat 提供了一个经典的解决方案：先计算细胞的周期得分（</span><span leaf="">Cell Cycle Scoring），再通过回归将其影响去除，从而让下游聚类和降维更专注于生物学信号。</span></strong></section><p data-start="9479" data-end="10048" data-pm-slice="3 2 []"><strong data-start="9479" data-end="9490"><span leaf=""><span textstyle="">细胞周期效应：</span></span></strong><span leaf=""> 细胞</span><span leaf="">周期基因（如S期基因 </span><em data-start="9504" data-end="9509"><span leaf="">MCM</span></em><span leaf="">, </span><em data-start="9511" data-end="9517"><span leaf="">PCNA</span></em><span leaf="">, G2/M期基因 </span><em data-start="9527" data-end="9534"><span leaf="">TOP2A</span></em><span leaf="">, </span><em data-start="9536" data-end="9543"><span leaf="">MKİ67</span></em><span leaf=""> 等）的表达差异会使细胞按增殖状态而非细胞类型聚类</span><span leaf="">。</span></p><ul><li><p data-start="365" data-end="404"><span leaf="">不同细胞处于 </span><strong data-start="372" data-end="385"><span leaf="">G1、S、G2/M</span></strong><span leaf=""> 周期阶段，会导致转录组数据差异。</span></p></li><li><p data-start="407" data-end="443"><span leaf="">如果不处理，PCA/聚类常常会“错误”地把细胞周期当成主要分群信号。</span></p></li><li><p data-start="446" data-end="520"><span leaf="">Seurat 提供了 </span><strong data-start="457" data-end="479"><span leaf="">CellCycleScoring()</span></strong><span leaf=""> 和 </span><strong data-start="482" data-end="513"><span leaf="">ScaleData(vars.to.regress=)</span></strong><span leaf=""> 来应对。</span></p></li></ul><p data-start="9479" data-end="10048" data-pm-slice="3 2 []"><span leaf="">1. 准备环境与数据</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf=""><span>library</span>(Seurat)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># Read in the expression matrix The first row is a header row, the first column is rownames</span></span></code><code><span leaf="">exp.mat &lt;- read.<span>table</span>(file = <span>"/brahms/shared/vignette-data/cell_cycle_vignette_files/nestorawa_forcellcycle_expressionMatrix.txt"</span>,</span></code><code><span leaf="">    header = <span>TRUE</span>, <span>as</span>.is = <span>TRUE</span>, row.names = <span>1</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># A list of cell cycle markers, from Tirosh et al, 2015, is loaded with Seurat.  We can</span></span></code><code><span leaf=""><span># segregate this list into markers of G2/M phase and markers of S phase</span></span></code><code><span leaf="">s.genes &lt;- cc.genes<span>$s</span>.genes</span></code><code><span leaf="">g2m.genes &lt;- cc.genes<span>$g2m</span>.genes</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># Create our Seurat object and complete the initalization steps</span></span></code><code><span leaf="">marrow &lt;- <span>CreateSeuratObject</span>(counts = <span>Matrix</span>::<span>Matrix</span>(<span>as</span>.<span>matrix</span>(exp.mat), sparse = T))</span></code><code><span leaf="">marrow &lt;- <span>NormalizeData</span>(marrow)</span></code><code><span leaf="">marrow &lt;- <span>FindVariableFeatures</span>(marrow, selection.method = <span>"vst"</span>)</span></code><code><span leaf="">marrow &lt;- <span>ScaleData</span>(marrow, features = <span>rownames</span>(marrow))</span></code><code><span leaf="">marrow &lt;- <span>RunPCA</span>(marrow, features = <span>VariableFeatures</span>(marrow), ndims.<span>print</span> =<span> 6</span>:<span>10</span>, nfeatures.<span>print</span> = <span>10</span>)</span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li></ul><pre data-lang="shell"><code><span leaf=""><span>#</span><span># PC_ 8</span> </span></code><code><span leaf=""><span>#</span><span># Positive:  NUSAP1, UBE2C, KIF23, PLK1, CENPF, FAM64A, CCNB1, H2AFX, ID2, CDC20</span> </span></code><code><span leaf=""><span>#</span><span># Negative:  WFDC17, SLC35D3, ADGRL4, VLDLR, CD33, H2AFY, P2RY14, IFI206, CCL9, CD34</span> </span></code><code><span leaf=""><span>#</span><span># PC_ 9</span> </span></code><code><span leaf=""><span>#</span><span># Positive:  IGKC, JCHAIN, LY6D, MZB1, CD74, IGLC2, FCRLA, IGKV4-50, IGHM, IGHV9-1</span> </span></code><code><span leaf=""><span>#</span><span># Negative:  SLC2A6, HBA-A1, HBA-A2, IGHV8-7, FCER1G, F13A1, HBB-BS, PLD4, HBB-BT, IGFBP4</span> </span></code><code><span leaf=""><span>#</span><span># PC_ 10</span> </span></code><code><span leaf=""><span>#</span><span># Positive:  H2AFX, FAM64A, ZFP383, NUSAP1, CDC25B, CENPF, GBP10, TOP2A, GBP6, GFRA1</span> </span></code><code><span leaf=""><span>#</span><span># Negative:  CTSW, XKRX, PRR5L, RORA, MBOAT4, A630014C17RIK, ZFP105, COL9A3, CLEC2I, TRAT1</span></span></code></pre></section><pre data-pm-slice="0 0 []"><code><span leaf=""><br></span></code></pre><section><ul><li></ul><pre data-lang="apache"><code><span leaf=""><span>DimHeatmap</span>(marrow, dims = c(<span>8</span>, <span>10</span>))</span></code></pre></section><section nodeleaf=""><img data-imgfileid="100006263" data-ratio="0.5601851851851852" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktkLe2ONAic3fS3NVc51jHibfIJ3LHKHZWwQ0cqEwQUdO5y14DBRNCU4Z71ede4gmuzJ5SEmHaMQekQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktkLe2ONAic3fS3NVc51jHibfIJ3LHKHZWwQ0cqEwQUdO5y14DBRNCU4Z71ede4gmuzJ5SEmHaMQekQ/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf="">初步 PCA 分析，使用 FindVariableFeatures() 选出的高变基因进行 PCA 时，我们发现：</span></section><ul><li><section><span leaf="">大多数PC可以用细胞谱系（lineage）来解释[比如PC_ 9的很多基因说明其是Bcell的主要成分]；</span></section></li><li><section><span leaf="">但 PC8 与 PC10 却受到细胞周期基因（如 TOP2A、MKI67）的显著影响。</span></section></li></ul><section><span leaf="">这意味着细胞周期在 PCA 中成为了主导信号之一。接下来，我们将尝试将这种信号回归出去，从而避免其干扰下游分析。</span></section><h3 data-start="1060" data-end="1075" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">2. 细胞周期打分</span></span></h3><h3 data-start="1060" data-end="1075" data-pm-slice="0 0 []"><span leaf=""><br></span></h3><p data-start="1213" data-end="1273" data-pm-slice="0 0 []"><span leaf="">通过 </span><code data-start="1216" data-end="1236"><span leaf="">CellCycleScoring()</span></code><span leaf=""> 函数，可以根据 S 期和 G2/M 期基因的表达情况为每个细胞打分：</span></p><ul><li><p data-start="1276" data-end="1313"><span leaf="">得分结果包括 </span><strong data-start="1283" data-end="1294"><span leaf="">S.Score</span></strong><span leaf=""> 与 </span><strong data-start="1297" data-end="1310"><span leaf="">G2M.Score</span></strong><span leaf="">；</span></p></li><li><p data-start="1316" data-end="1343"><span leaf="">并给出推断的细胞周期分期（G1、S 或 G2M）。</span></p></li></ul><h3 data-start="1060" data-end="1075" data-pm-slice="0 0 []"><span leaf=""><br></span></h3><p data-start="1076" data-end="1149"><span leaf="">使用 </span><strong data-start="1079" data-end="1101"><span leaf="">CellCycleScoring()</span></strong><span leaf=""> 给每个细胞计算 S.Score、G2M.Score，并分类到 G1 / S / G2M 阶段：</span></p><section><ul><li><li><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>marrow</span> &lt;- CellCycleScoring(marrow, s.features = s.genes, g2m.features = g2m.genes, set.ident = TRUE)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># view cell cycle scores and phase assignments</span></span></code><code><span leaf=""><span>head</span>(marrow[[]])</span></code><code><span leaf=""><span># Visualize the distribution of cell cycle markers across</span></span></code><code><span leaf=""><span>RidgePlot</span>(marrow, features = c(<span>"PCNA"</span>, <span>"TOP2A"</span>, <span>"MCM6"</span>, <span>"MKI67"</span>), ncol = <span>2</span>)</span></code></pre></section><section nodeleaf=""><img data-imgfileid="100006264" data-ratio="0.5231481481481481" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktkLe2ONAic3fS3NVc51jHibf2Hhtp269qRbsDhHgyaGibLCpDfTlenLmCPxONfvkhgM12rHYicicrRoaA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktkLe2ONAic3fS3NVc51jHibf2Hhtp269qRbsDhHgyaGibLCpDfTlenLmCPxONfvkhgM12rHYicicrRoaA/640?wx_fmt=png&amp;from=appmsg"></section><section><ul><li><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span># Running a PCA on cell cycle genes reveals, unsurprisingly, that cells separate entirely by</span></span></code><code><span leaf=""><span># phase</span></span></code><code><span leaf=""><span>marrow</span> &lt;- RunPCA(marrow, features = c(s.genes, g2m.genes))</span></code><code><span leaf=""><span>DimPlot</span>(marrow)</span></code></pre></section><section nodeleaf=""><img data-imgfileid="100006265" data-ratio="0.5259259259259259" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktkLe2ONAic3fS3NVc51jHibfdMicyE9ibj1csnX57stre4nhBBVokSicVAMHdE2GF1LLwIMmroQFmWthw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SktkLe2ONAic3fS3NVc51jHibfdMicyE9ibj1csnX57stre4nhBBVokSicVAMHdE2GF1LLwIMmroQFmWthw/640?wx_fmt=png&amp;from=appmsg"></section><p data-start="9479" data-end="10048"><span leaf="">在细胞周期基因上运行 PCA，结果很直观：细胞完全按照周期阶段分开。</span><span leaf=""><br></span><span leaf="">这进一步证明了需要将周期效应回归掉，否则它会主导聚类与降维。</span><strong data-start="9670" data-end="9681"><span leaf="">不回归细胞周期</span></strong><span leaf="">时，PCA的某个成分往往对应细胞周期，UMAP/tSNE上细胞会沿着周期相位分离</span><span leaf="">（上图示例）。</span></p><p data-start="9479" data-end="10048"><span leaf=""><br></span></p><p data-start="1692" data-end="1741" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">回归掉细胞周期基因</span></span></p><p data-start="9479" data-end="10048"><span leaf="">通过对细胞周期分数进行回归处理，可以减弱这一效应，使同类型不同周期的细胞重新聚为一簇</span><span leaf="">。需要注意的是，如果研究</span><strong data-start="9940" data-end="9952"><span leaf="">关注细胞周期本身</span></strong><span leaf="">（如干细胞增殖特性），则不应回归掉这一信号；但若细胞周期被视为不感兴趣的“噪音”，则回归有助于突出其他生物学差异.</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="python"><code><span leaf="">marrow &lt;- ScaleData(marrow,</span></code><code><span leaf="">                    <span>vars</span>.to.regress = c(<span>"S.Score"</span>,<span>"G2M.Score"</span>),</span></code><code><span leaf="">                    features = rownames(marrow))</span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># Now, a PCA on the variable genes no longer returns components associated with cell cycle</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">marrow &lt;- RunPCA(marrow,</span></code><code><span leaf="">                 features = VariableFeatures(marrow),</span></code><code><span leaf="">                 nfeatures.<span>print</span>=<span>10</span>)</span></code><code><span leaf=""><br></span></code></pre></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span leaf="">PC_ 1 </span></code><code><span leaf=""><span>Positive:  BLVRB, CAR2, KLF1, AQP1, CES2G, ERMAP, CAR1, FAM132A, RHD, SPHK1 </span></span></code><code><span leaf=""><span>Negative:  TMSB4X, H2AFY, CORO1A, PLAC8, EMB, MPO, PRTN3, CD34, LCP1, BC035044 </span></span></code><code><span leaf="">PC_ 2 </span></code><code><span leaf=""><span>Positive:  ANGPT1, ADGRG1, MEIS1, ITGA2B, MPL, DAPP1, APOE, RAB37, GATA2, F2R </span></span></code><code><span leaf=""><span>Negative:  LY6C2, ELANE, HP, IGSF6, ANXA3, CTSG, CLEC12A, TIFAB, SLPI, ALAS1 </span></span></code><code><span leaf="">PC_ 3 </span></code><code><span leaf=""><span>Positive:  APOE, GATA2, NKG7, MUC13, MS4A3, RAB44, HDC, CPA3, FCGR3, TUBA8 </span></span></code><code><span leaf=""><span>Negative:  FLT3, DNTT, LSP1, WFDC17, MYL10, GIMAP6, LAX1, GPR171, TBXA2R, SATB1 </span></span></code><code><span leaf="">PC_ 4 </span></code><code><span leaf=""><span>Positive:  CSRP3, ST8SIA6, DNTT, MPEG1, SCIN, LGALS1, CMAH, RGL1, APOE, MFSD2B </span></span></code><code><span leaf=""><span>Negative:  PROCR, MPL, HLF, MMRN1, SERPINA3G, ESAM, GSTM1, D630039A03RIK, MYL10, LY6A </span></span></code><code><span leaf="">PC_ 5 </span></code><code><span leaf=""><span>Positive:  CPA3, LMO4, IKZF2, IFITM1, FUT8, MS4A2, SIGLECF, CSRP3, HDC, RAB44 </span></span></code><code><span leaf=""><span>Negative:  PF4, GP1BB, SDPR, F2RL2, RAB27B, SLC14A1, TREML1, PBX1, F2R, TUBA8 </span></span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code></pre></section><p data-start="9479" data-end="10048"><span leaf="">    </span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="makefile"><code><span leaf=""><span># When running a PCA on only cell cycle genes, cells no longer separate by cell-cycle phase</span></span></code><code><span leaf="">marrow &lt;- RunPCA(marrow, features = c(s.genes, g2m.genes),</span></code><code><span leaf="">                 nfeatures.print=10)</span></code><code><span leaf=""><br></span></code><code><span leaf="">Warning in PrepDR5(object = object, features = features, layer = layer,  :</span></code><code><span leaf="">  The following features were not available: MLF1IP, GMNN.</span></code><code><span leaf="">Warning in svd.function(A = t(x = object), nv = npcs, ...) :</span></code><code><span leaf="">  You're computing too large a percentage of total singular values, use a standard svd instead.</span></code><code><span leaf="">PC_ 1 </span></code><code><span leaf=""><span>Positive:  CENPA, CCNB2, CDCA3, BIRC5, CDC20, CDC6, CCNE2, RRM2, RRM1, TUBB4B </span></span></code><code><span leaf="">	   HMGB2, CDCA8, FEN1, CKS2, NASP, HMMR, RANGAP1, TIPIN, SLBP, RPA2 </span></code><code><span leaf="">	   TPX2, NEK2, BUB1, MCM2, MCM4, CKS1B, LBR, KIF2C, GINS2, AURKA </span></code><code><span leaf=""><span>Negative:  TOP2A, AURKB, FAM64A, NUSAP1, RFC2, POLA1, CDCA2, GAS2L3, KIF23, CDK1 </span></span></code><code><span leaf="">	   SMC4, HN1, KIF11, BRIP1, NDC80, TYMS, TTK, ATAD2, E2F8, CKAP5 </span></code><code><span leaf="">	   PRIM1, G2E3, WDR76, CENPF, CKAP2L, ANLN, TMPO, CTCF, KIF20B, CBX5 </span></code><code><span leaf="">PC_ 2 </span></code><code><span leaf=""><span>Positive:  CDCA7, UNG, CDC20, FAM64A, GAS2L3, MCM4, MCM5, MCM2, KIF2C, CKAP2 </span></span></code><code><span leaf="">	   PSRC1, KIF23, RFC2, NEK2, CENPE, USP1, CKAP5, DTL, MCM6, DLGAP5 </span></code><code><span leaf="">	   HN1, MSH2, CCNB2, CENPF, RPA2, UBE2C, G2E3, UBR7, HELLS, CASP8AP2 </span></code><code><span leaf=""><span>Negative:  BIRC5, RRM2, MKI67, TYMS, AURKB, TOP2A, RAD51AP1, RAD51, PCNA, CDCA3 </span></span></code><code><span leaf="">	   NUF2, CLSPN, ATAD2, NDC80, CDK1, POLA1, E2F8, HMGB2, CDC45, RRM1 </span></code><code><span leaf="">	   KIF11, UHRF1, CCNE2, CDC6, BRIP1, TACC3, TTK, TUBB4B, ANLN, SLBP </span></code><code><span leaf="">PC_ 3 </span></code><code><span leaf=""><span>Positive:  HMGB2, NCAPD2, HELLS, CCNB2, FAM64A, MKI67, ANP32E, CASP8AP2, ATAD2, CKS1B </span></span></code><code><span leaf="">	   TMPO, CKS2, E2F8, DTL, CTCF, SMC4, WDR76, KIF20B, POLA1, UNG </span></code><code><span leaf="">	   SLBP, CDCA3, TIPIN, PSRC1, CENPA, USP1, CENPE, CDCA8, CCNE2, TPX2 </span></code><code><span leaf=""><span>Negative:  UBE2C, AURKA, HMMR, CDK1, FEN1, AURKB, TUBB4B, HN1, MCM6, RRM1 </span></span></code><code><span leaf="">	   CHAF1B, MCM2, NUSAP1, GINS2, GTSE1, CKAP2L, CDC45, NEK2, TTK, RRM2 </span></code><code><span leaf="">	   CDC20, ANLN, RAD51, TACC3, CDCA2, CENPF, MCM5, RAD51AP1, BIRC5, KIF2C </span></code><code><span leaf="">PC_ 4 </span></code><code><span leaf=""><span>Positive:  MCM2, MCM6, TMPO, MCM5, CKS2, ANP32E, CBX5, TIPIN, CKS1B, UBE2C </span></span></code><code><span leaf="">	   POLA1, HMGB2, SLBP, WDR76, PRIM1, PCNA, NASP, AURKA, UBR7, MCM4 </span></code><code><span leaf="">	   AURKB, RFC2, BLM, TOP2A, CDCA7, SMC4, TUBB4B, CTCF, KIF11, GINS2 </span></code><code><span leaf=""><span>Negative:  CCNE2, KIF23, RRM2, FAM64A, EXO1, GAS2L3, CDC45, HJURP, CLSPN, FEN1 </span></span></code><code><span leaf="">	   DTL, CDC6, RAD51, CDC20, PSRC1, CDCA2, UHRF1, LBR, NUSAP1, DLGAP5 </span></code><code><span leaf="">	   DSCC1, NUF2, RAD51AP1, TACC3, CHAF1B, NEK2, CCNB2, CKAP5, CKAP2, G2E3 </span></code><code><span leaf="">PC_ 5 </span></code><code><span leaf=""><span>Positive:  E2F8, BLM, CKS2, ANP32E, TUBB4B, PSRC1, ANLN, CKAP5, NEK2, CENPA </span></span></code><code><span leaf="">	   KIF20B, CDC6, UBR7, HMMR, DSCC1, USP1, HJURP, DLGAP5, POLA1, G2E3 </span></code><code><span leaf="">	   UBE2C, CENPF, WDR76, HN1, CCNE2, ATAD2, TMPO, DTL, CKAP2, RRM2 </span></code><code><span leaf=""><span>Negative:  CDCA7, HELLS, CKS1B, NCAPD2, CDCA8, BIRC5, AURKB, FAM64A, CCNB2, NUF2 </span></span></code><code><span leaf="">	   KIF23, CKAP2L, RFC2, TIPIN, NASP, UHRF1, CDC45, RAD51, BRIP1, TACC3 </span></code><code><span leaf="">	   POLD3, MCM5, CDCA3, GINS2, CDK1, MSH2, LBR, MKI67, RRM1, PCNA </span></code><code><span leaf="">DimPlot(marrow)</span></code></pre></section><section nodeleaf=""><img data-imgfileid="100006300" data-ratio="1.0083234244946493" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkviaKnMIu1icuDSWj6UIhhEZoxjQjUJCLxjoB8jrfXSziaeiaqmgFxArNSiatvb10BkaayRanA9WVjaHPg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="841" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkviaKnMIu1icuDSWj6UIhhEZoxjQjUJCLxjoB8jrfXSziaeiaqmgFxArNSiatvb10BkaayRanA9WVjaHPg/640?wx_fmt=png&amp;from=appmsg"></section><p><span leaf="">结果：PCA 不再被细胞周期主导，而是更能反映细胞类型/状态差异。</span></p><section><p data-start="1692" data-end="1741" data-pm-slice="0 0 []"><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"p","attributes":{"data-start":"1692","data-end":"1741","data-pm-slice":"0 0 []"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>回归后再次运行 PCA，可以看到：主成分不再被细胞周期驱动，而更好地反映了真实的细胞类型差异。</span></p></section><h3 data-start="1713" data-end="1742" data-pm-slice="0 0 []"><span leaf=""><span textstyle="">替代方案：只回归 S vs G2M 差值</span></span></h3><p data-start="1743" data-end="1805"><span leaf="">在某些场景下（如小鼠造血分化），完全去除细胞周期信号可能会抹平干细胞与祖细胞的区别。这种情况下，推荐的替代做法是</span><strong data-start="1827" data-end="1848" data-pm-slice="0 0 []"><span leaf="">只回归 S 与 G2M 得分的差值</span></strong><span leaf="">：</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf="">marrow<span>$CC</span>.Difference &lt;- marrow<span>$S</span>.Score - marrow<span>$G2M</span>.Score</span></code><code><span leaf="">marrow &lt;- <span>ScaleData</span>(marrow, vars.to.regress = <span>"CC.Difference"</span>, features = <span>rownames</span>(marrow))</span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># cell cycle effects strongly mitigated in PCA</span></span></code><code><span leaf="">marrow &lt;- <span>RunPCA</span>(marrow, features = <span>VariableFeatures</span>(marrow), nfeatures.<span>print</span> = <span>10</span>)</span></code><code><span leaf=""><span>DimPlot</span>(marrow)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># when running a PCA on cell cycle genes, actively proliferating cells remain distinct from G1</span></span></code><code><span leaf=""><span># cells however, within actively proliferating cells, G2M and S phase cells group together</span></span></code><code><span leaf="">marrow &lt;- <span>RunPCA</span>(marrow, features = <span>c</span>(s.genes, g2m.genes), nfeatures.<span>print</span> = <span>10</span>)</span></code><code><span leaf=""><span>DimPlot</span>(marrow)</span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code></pre></section><p data-pm-slice="0 0 []"><span leaf=""><br></span></p><section nodeleaf=""><img data-imgfileid="100006301" data-ratio="0.7796296296296297" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkviaKnMIu1icuDSWj6UIhhEZoyibJGyvzslm4cAqcOTwWibuwIn2iacZZx75InrzibVKBYUpKn6FyicgGWBg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkviaKnMIu1icuDSWj6UIhhEZoyibJGyvzslm4cAqcOTwWibuwIn2iacZZx75InrzibVKBYUpKn6FyicgGWBg/640?wx_fmt=png&amp;from=appmsg"></section><p data-start="1974" data-end="2008" data-pm-slice="0 0 []"><span leaf="">这样能保留“是否增殖”的信息，同时去掉 S/G2M 阶段的细节差异。</span></p><p data-tool="mdnice编辑器" data-pm-slice="0 0 []"><span leaf=""><br></span></p><p data-start="8505" data-end="8893"><strong data-start="8505" data-end="8518"><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"p","attributes":{"data-start":"8505","data-end":"8893","style":"-webkit-tap-highlight-color: transparent;margin: 0px;padding: 8px 0px;outline: 0px;max-width: 100%;clear: both;min-height: 1em;color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \"PingFang SC\", Cambria, Cochin, Georgia, Times, \"Times New Roman\", serif;font-size: 16px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 26px;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"node",{"tagName":"strong","attributes":{"data-start":"8505","data-end":"8518"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'><span textstyle="">线粒体基因</span></span></strong></p><p><span leaf=""><br></span></p><p data-start="8505" data-end="8893"><strong data-start="8505" data-end="8518"><span leaf="">高线粒体比例：</span></strong><span leaf=""> 线粒体基因（如人类的 </span><em data-start="8530" data-end="8537"><span leaf="">MT-ND</span></em><span leaf="">, </span><em data-start="8539" data-end="8546"><span leaf="">MT-CO</span></em><span leaf=""> 基因）比例过高往往表明细胞质量较差（如已发生部分凋亡，导致线粒体RNA富集）。这些细胞常伴低总RNA量和少基因数，可能在聚类中形成一个“低质量”簇。通常我们在质控时会滤除线粒体比例过高的细胞（阈值依样本而定，一般在人类样本10%–20%，有时更严格用5%–8%）。在多数PBMC数据中percent.mt超过~5–10%的细胞就可移除，以避免死亡细胞聚类在一起干扰分析</span><span leaf="">。</span></p><p data-start="8505" data-end="8893"><span leaf="">下面的代码对 Seurat 对象进行质量控制（QC），通过 MAD 离群值检测和线粒体比例阈值筛掉低质量细胞，同时计算线粒体/核糖体/血红蛋白比例并生成 QC 可视化图，最后返回过滤后的对象。</span></p><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="perl"><code><span leaf=""> </span></code><code><span leaf="">  <span># 需要：Seurat, ggplot2, patchwork</span></span></code><code><span leaf="">  suppressPackageStartupMessages({</span></code><code><span leaf="">    library(Seurat); library(ggplot2); library(patchwork)</span></code><code><span leaf="">  })</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span>#-----------------------------#</span></span></code><code><span leaf="">  qc_filter_seurat &lt;- function(</span></code><code><span leaf="">    seurat_obj,</span></code><code><span leaf="">    species = c(<span>"human"</span>,<span>"mouse"</span>),</span></code><code><span leaf="">    <span># MAD 参数与阈值（与你原脚本一致/相近）</span></span></code><code><span leaf="">    nmads_count   = <span>5</span>,</span></code><code><span leaf="">    nmads_feature = <span>5</span>,</span></code><code><span leaf="">    nmads_mt      = <span>3</span>,</span></code><code><span leaf="">    mt_abs_thresh = <span>8</span>,                <span># % 线粒体绝对阈值</span></span></code><code><span leaf="">    assay = <span>"RNA"</span>,</span></code><code><span leaf="">    save_plot = TRUE,</span></code><code><span leaf="">    plot_file = <span>"qc1.png"</span>,</span></code><code><span leaf="">    width = <span>12</span>, height = <span>20</span></span></code><code><span leaf="">  ){</span></code><code><span leaf="">    stopifnot(inherits(seurat_obj, <span>"Seurat"</span>))</span></code><code><span leaf="">    species &lt;- match.arg(species)</span></code><code><span leaf=""><br></span></code><code><span leaf="">    DefaultAssay(seurat_obj) &lt;- assay</span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span># ---- 物种特异：前缀/模式 ----</span></span></code><code><span leaf="">    <span>if</span> (species == <span>"human"</span>) {</span></code><code><span leaf="">      mt_pattern   &lt;- <span>"^MT-"</span></span></code><code><span leaf="">      rpl_pattern  &lt;- <span>"^RPL"</span>; rps_pattern &lt;- <span>"^RPS"</span></span></code><code><span leaf="">      <span># 人血红蛋白（常见基因符号）</span></span></code><code><span leaf="">      hb_regex     &lt;- <span>"^(HBA|HBB|HBD|HBE|HBG|HBZ|HBM|HBQ)"</span></span></code><code><span leaf="">    } <span>else</span> {</span></code><code><span leaf="">      mt_pattern   &lt;- <span>"^mt-"</span></span></code><code><span leaf="">      rpl_pattern  &lt;- <span>"^Rpl"</span>; rps_pattern &lt;- <span>"^Rps"</span></span></code><code><span leaf="">      <span># 小鼠血红蛋白</span></span></code><code><span leaf="">      hb_regex     &lt;- <span>"^(Hba|Hbb|Hbd|Hbe|Hbg|Hbz|Hbm|Hbq)"</span></span></code><code><span leaf="">    }</span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span># ---- 线粒体/核糖体/血红蛋白集合 ----</span></span></code><code><span leaf="">    feats_all &lt;- rownames(seurat_obj)</span></code><code><span leaf="">    ribo.genes &lt;- <span>grep</span>(paste<span>0</span>(rps_pattern, <span>"|"</span>, rpl_pattern), feats_all, value = TRUE)</span></code><code><span leaf="">    hb.genes   &lt;- <span>grep</span>(hb_regex, feats_all, value = TRUE)</span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span># ---- 计算 QC 指标（与你原逻辑一致） ----</span></span></code><code><span leaf="">    seurat_obj[[<span>"percent.mt"</span>]]   &lt;- PercentageFeatureSet(seurat_obj, pattern  = mt_pattern)</span></code><code><span leaf="">    seurat_obj[[<span>"percent.ribo"</span>]] &lt;- PercentageFeatureSet(seurat_obj, features = ribo.genes)</span></code><code><span leaf="">    seurat_obj[[<span>"percent.hb"</span>]]   &lt;- PercentageFeatureSet(seurat_obj, features = hb.genes)</span></code><code><span leaf="">    seurat_obj[[<span>"log10_nCount_RNA"</span>]]   &lt;- log1<span>0</span>(seurat_obj$nCount_RNA + <span>1</span>)</span></code><code><span leaf="">    seurat_obj[[<span>"log10_nFeature_RNA"</span>]] &lt;- log1<span>0</span>(seurat_obj$nFeature_RNA + <span>1</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span># ---- MAD 离群判定（与你原思路一致） ----</span></span></code><code><span leaf="">    is_outlier &lt;- function(<span>x</span>, nmads){</span></code><code><span leaf="">      med &lt;- median(<span>x</span>, na.rm = TRUE); madv &lt;- mad(<span>x</span>, constant = <span>1</span>, na.rm = TRUE)</span></code><code><span leaf="">      (<span>x</span> &lt; (med - nmads*madv)) | (<span>x</span> &gt; (med + nmads*madv))</span></code><code><span leaf="">    }</span></code><code><span leaf="">    md &lt;- seurat_obj@meta.data</span></code><code><span leaf="">    seurat_obj$outlier &lt;- with(md,</span></code><code><span leaf="">                               is_outlier(log10_nCount_RNA,   nmads_count)   |</span></code><code><span leaf="">                                 is_outlier(log10_nFeature_RNA, nmads_feature) |</span></code><code><span leaf="">                                 is_outlier(percent.mt,         nmads_mt)</span></code><code><span leaf="">    )</span></code><code><span leaf="">    <span># 线粒体绝对阈值</span></span></code><code><span leaf="">    seurat_obj$mt_outlier &lt;- seurat_obj$percent.mt &gt; mt_abs_thresh</span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span># ---- 可视化（与你原布局相近） ----</span></span></code><code><span leaf="">    p1 &lt;- ggplot(seurat_obj@meta.data, aes(nCount_RNA)) +</span></code><code><span leaf="">      geom_histogram(bins = <span>100</span>) + labs(title = <span>"Total Counts Distribution"</span>)</span></code><code><span leaf="">    p2 &lt;- VlnPlot(seurat_obj, features = c(<span>"percent.mt"</span>,<span>"percent.ribo"</span>,<span>"percent.hb"</span>),</span></code><code><span leaf="">                  pt.size = <span>0</span>) + theme(legend.position = <span>"none"</span>)</span></code><code><span leaf="">    p3 &lt;- FeatureScatter(seurat_obj, feature1 = <span>"nCount_RNA"</span>, feature2 = <span>"nFeature_RNA"</span>)</span></code><code><span leaf=""><br></span></code><code><span leaf="">    p_all &lt;- (p1 | p2) / p3 + plot_layout(heights = c(<span>1</span>, <span>2</span>))</span></code><code><span leaf="">    <span>if</span> (save_plot) {</span></code><code><span leaf="">      ggsave(plot_file, plot = p_all, width = width, height = height, limitsize = FALSE)</span></code><code><span leaf="">    }</span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span># ---- 过滤与统计 ----</span></span></code><code><span leaf="">    n_before &lt;- ncol(seurat_obj)</span></code><code><span leaf="">    keep &lt;- !(seurat_obj$outlier | seurat_obj$mt_outlier)</span></code><code><span leaf="">    seurat_obj_filt &lt;- subset(seurat_obj, cells = colnames(seurat_obj)[keep])</span></code><code><span leaf="">    n_after &lt;- ncol(seurat_obj_filt)</span></code><code><span leaf=""><br></span></code><code><span leaf="">    message(<span>sprintf</span>(<span>"过滤前细胞数: %d; 过滤后细胞数: %d (去除 %d, %.2f%%)"</span>,</span></code><code><span leaf="">                    n_before, n_after, n_before - n_after, <span>100</span>*(n_before-n_after)/n_before))</span></code><code><span leaf=""><br></span></code><code><span leaf="">    <span># 返回对象与汇总</span></span></code><code><span leaf="">    <span>return</span>(invisible(list(</span></code><code><span leaf="">      obj = seurat_obj_filt,</span></code><code><span leaf="">      <span>#   plot = p_all,</span></span></code><code><span leaf="">      <span># stats = list(</span></span></code><code><span leaf="">      <span>#   n_before = n_before, n_after = n_after,</span></span></code><code><span leaf="">      <span>#   removed = n_before - n_after,</span></span></code><code><span leaf="">      <span>#   removed_pct = 100*(n_before-n_after)/n_before,</span></span></code><code><span leaf="">      <span>#   table_outlier = table(outlier = seurat_obj$outlier),</span></span></code><code><span leaf="">      <span>#   table_mt_out  = table(mt_outlier = seurat_obj$mt_outlier)</span></span></code><code><span leaf="">      <span># ),</span></span></code><code><span leaf="">      gene_sets = list(</span></code><code><span leaf="">        mt_pattern = mt_pattern,</span></code><code><span leaf="">        ribo_genes = ribo.genes,</span></code><code><span leaf="">        hb_genes   = hb.genes</span></code><code><span leaf="">      )</span></code><code><span leaf="">    )))</span></code><code><span leaf="">  }</span></code><code><span leaf=""><br></span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span>#-----------------------------#</span></span></code><code><span leaf="">  <span># 使用示例</span></span></code><code><span leaf="">  <span>#-----------------------------#</span></span></code><code><span leaf="">  <span># sce.all.int 假设是你的 Seurat 对象</span></span></code><code><span leaf="">  res &lt;- qc_filter_seurat(sce.all.int, species = <span>'human'</span>, mt_abs_thresh = <span>8</span>)</span></code><code><span leaf="">  filt_obj &lt;- res$obj</span></code><code><span leaf="">  DimPlot(filt_obj, label = TRUE,group.by = <span>"celltype"</span>)</span></code><code><span leaf=""><br></span></code></pre></section><p data-start="8505" data-end="8893"><span data-pm-slice="0 0 []"><span leaf=""><br></span></span></p><p data-start="8505" data-end="8893"><span data-pm-slice="0 0 []"></span></p><p data-start="8896" data-end="9476"><strong data-start="8896" data-end="8918"><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"p","attributes":{"data-start":"8896","data-end":"9476","style":"-webkit-tap-highlight-color: transparent;margin: 0px;padding: 8px 0px;outline: 0px;max-width: 100%;clear: both;min-height: 1em;color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, \"PingFang SC\", Cambria, Cochin, Georgia, Times, \"Times New Roman\", serif;font-size: 16px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 26px;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"node",{"tagName":"strong","attributes":{"data-start":"8896","data-end":"8918"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'><span textstyle="">核糖体基因</span></span></strong></p><p data-start="8896" data-end="9476"><strong data-start="8896" data-end="8918"><span leaf="">核糖体基因（RPL/RPS）高表达：</span></strong><span leaf=""> 核糖体蛋白基因（如</span><strong data-start="8928" data-end="8935"><span leaf="">RPL</span></strong><span leaf="">、</span><strong data-start="8936" data-end="8943"><span leaf="">RPS</span></strong><span leaf="">家族）属于基本组成型基因，在细胞增殖活跃或蛋白合成旺盛时表达量升高。某些簇可能因为技术原因显示异常高的核糖体基因信号。如果某簇的主要差异仅是核糖体基因高，可能暗示这些细胞处于特定状态（如周期S期，也可能是双胞或背景）。核糖体基因本身对区分细胞类型通常</span><strong data-start="9068" data-end="9079"><span leaf="">没有生物学意义</span></strong><span leaf="">，因此我们常</span><strong data-start="9163" data-end="9177"><span leaf="">不将它们用作高变基因</span></strong><span leaf="">，甚至在ScaleData时将其回归掉。<span textstyle="">如果核糖体基因导致出现独立簇，可以考虑对这些基因进行处理而不是直接删除簇</span></span><span leaf=""><span textstyle="">。</span></span><strong data-start="9279" data-end="9296"><span leaf=""><br></span></strong></p><p data-start="8896" data-end="9476"><strong data-start="9279" data-end="9296"><span leaf="">不要简单丢弃核糖体高的细胞</span></strong><span leaf="">，因为它们可能是真实细胞（例如增殖中的癌细胞）；可以先应用背景消除算法（如SoupX）检查是否由于ambient RNA导致</span><span leaf="">。若非背景因素，则在下游分析中考虑</span><strong data-start="9412" data-end="9423"><span leaf="">回归核糖体基因</span></strong><span leaf="">，可减弱其对聚类的影响</span><span leaf="">。</span></p><p data-start="8896" data-end="9476"><span leaf=""><br></span></p><section><span leaf=""><span textstyle="">总结</span></span></section><section><strong data-start="5" data-end="53" data-pm-slice="0 0 []"><span leaf="">是否要回归细胞周期、线粒体比例、核糖体基因，不是“一刀切”，而是具有强烈的“案例特异性”。应基于具体的数据特征、研究问题与客观诊断指标来定。</span></strong></section><ul><li><p data-start="3076" data-end="3134"><strong data-start="3076" data-end="3092"><span leaf="">把线粒体问题“回归解决”</span></strong><span leaf="">：线粒体高往往是</span><strong data-start="3100" data-end="3107"><span leaf="">低质量</span></strong><span leaf="">，应该</span><strong data-start="3110" data-end="3120"><span leaf="">首选QC过滤</span></strong><span leaf="">；回归只是“掩盖”问题。</span></p></li><li><p data-start="3137" data-end="3194"><strong data-start="3137" data-end="3156"><span leaf="">一刀切回归周期会导致“分化模糊”</span></strong><span leaf="">：在发育/造血/肿瘤中常见；优先试 </span><strong data-start="3174" data-end="3191"><span leaf="">CC.Difference</span></strong><span leaf="">。</span></p></li><li><p data-start="3197" data-end="3249"><strong data-start="3197" data-end="3216"><span leaf="">把核糖体当作细胞型marker</span></strong><span leaf="">：通常不具判别性，易引入技术噪声；先从HVG排除，再考虑是否回归。</span></p></li></ul><section><span leaf=""><br></span></section><section><span leaf="">如果最后细胞分群较差，可以先做常规QC与批次处理，再考虑上述三类协变量（细胞周期/线粒体/核糖体）的回归试验是否可以改善分群。</span></section><section><span leaf="">此外，我们还可以计算PC 与协变量相关性 </span><code data-start="735" data-end="806" data-pm-slice="0 0 []"><span leaf="">cor(Embeddings[,PC], percent.mt / percent.ribo / S.Score / G2M.Score)</span></code><span leaf="">；我们可以假设|r|≥0.3–0.4 则提示</span><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>协变量</span><span leaf="">显著驱动某个主成分。</span></section><section><ul><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li><li></ul><pre data-lang="php"><code><span leaf="">check_pc_covariates &lt;- <span><span>function</span></span><span>(</span><span><span>seurat_obj, pcs = </span></span><span><span><span>1</span></span></span><span><span>:</span></span><span><span><span>10</span></span></span><span><span>, </span></span></span></code><code><span leaf="">                                covariates = c(<span><span>"percent.mt"</span></span><span>, </span><span><span>"percent.ribo"</span></span><span>, </span><span><span>"S.Score"</span></span><span>, </span><span><span>"G2M.Score"</span></span>),</span></code><code><span leaf="">                                cutoff = <span>0.3</span>, reduction = <span>"pca"</span>) {</span></code><code><span leaf="">  <span># 确保 meta.data 里有协变量</span></span></code><code><span leaf="">  md &lt;- seurat_obj@meta.data</span></code><code><span leaf="">  missing_cov &lt;- <span>setdiff</span>(covariates, <span>colnames</span>(md))</span></code><code><span leaf="">  <span>if</span><span> </span>(<span>length</span>(missing_cov) &gt; <span>0</span>) {</span></code><code><span leaf="">    <span>stop</span>(<span>"缺少以下协变量: "</span>, <span>paste</span>(missing_cov, collapse = <span>", "</span>))</span></code><code><span leaf="">  }</span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span># Embeddings: 每个细胞 × PC</span></span></code><code><span leaf="">  emb &lt;- <span>Embeddings</span>(seurat_obj, reduction = reduction)</span></code><code><span leaf=""><br></span></code><code><span leaf="">  res &lt;- expand.<span>grid</span>(PC = <span>paste0</span>(<span>"PC_"</span>, pcs), Covariate = covariates, stringsAsFactors = <span>FALSE</span>)</span></code><code><span leaf="">  res<span>$Correlation </span>&lt;- NA_real_</span></code><code><span leaf="">  res<span>$Flag </span>&lt;- <span>FALSE</span></span></code><code><span leaf=""><br></span></code><code><span leaf="">  <span>for</span><span> </span>(i <span>in seq_len</span>(<span>nrow</span>(res))) {</span></code><code><span leaf="">    pc &lt;- res<span>$PC</span>[i]</span></code><code><span leaf="">    cov &lt;- res<span>$Covariate</span>[i]</span></code><code><span leaf="">    x &lt;- emb[, pc]</span></code><code><span leaf="">    y &lt;- md[[cov]]</span></code><code><span leaf="">    r &lt;- <span>suppressWarnings</span>(<span>cor</span>(x, y, method = <span>"pearson"</span>, <span>use</span> = <span>"complete.obs"</span>))</span></code><code><span leaf="">    res<span>$Correlation</span>[i] &lt;- r</span></code><code><span leaf="">    res<span>$Flag</span>[i] &lt;- !is.<span>na</span>(r) &amp;&amp; <span>abs</span>(r) &gt;= cutoff</span></code><code><span leaf="">  }</span></code><code><span leaf="">  <span>return</span>(res)</span></code><code><span leaf="">}</span></code><code><span leaf=""><br></span></code><code><span leaf=""><span># 使用示例，这里我们使用的是未回归的数据</span></span></code><code><span leaf="">res &lt;- <span>check_pc_covariates</span>(filt_obj, pcs =<span> 1</span>:<span>10</span>, cutoff = <span>0.3</span>)</span></code><code><span leaf=""><span>print</span>(res)</span></code><code><span leaf=""><br></span></code></pre></section><section nodeleaf=""><img data-imgfileid="100006302" data-ratio="0.5992779783393501" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkviaKnMIu1icuDSWj6UIhhEZoAK7ia1t5c5CR4x0A05LicUhBJYiarKSgK8x6kW2St4sYDQKQkCdoXZicuQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="554" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/xVhD7345SkviaKnMIu1icuDSWj6UIhhEZoAK7ia1t5c5CR4x0A05LicUhBJYiarKSgK8x6kW2St4sYDQKQkCdoXZicuQ/640?wx_fmt=png&amp;from=appmsg"></section><section><span leaf="">这提示我们应该把细胞周期回归掉，否则其正向驱动主成分1、8</span></section><section><ul><li><li><li></ul><pre data-lang="apache"><code><span leaf=""><span>https</span>://www.sc-best-practices.org/preprocessing_visualization/quality_control.html</span></code><code><span leaf=""><span>https</span>://www.biostars.org/p/<span>9539082</span>/#:~:text=V%<span>20</span>%E2%<span>96</span>%B4%<span>20420</span></span></code><code><span leaf=""><span>https</span>://satijalab.org/seurat/articles/cell_cycle_vignette.html#:~:text=,genes%<span>29</span>%<span>29</span>%<span>20</span>DimPlot%<span>28</span>marrow</span></code></pre></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/8wL41egSEmPLAxd-zaoVDw",target="_blank" rel="noopener noreferrer">原文链接</a>
