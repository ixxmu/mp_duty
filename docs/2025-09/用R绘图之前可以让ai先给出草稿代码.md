---
title: "用R绘图之前可以让ai先给出草稿代码"
date: 2025-09-01T00:21:46Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
用R绘图之前可以让ai先给出草稿代码 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><blockquote><p><span leaf="">看到了朋友圈都在转发北京大学生物医学前沿创新中心（BIOPIC）</span><strong><span leaf="">张泽民</span></strong><span leaf="">课题组联合国家癌症中心/中国医学科学院肿瘤医院、同济大学附属上海市肺科医院、广东省人民医院、郑州大学第一附属医院、昌平实验室、重庆医科大学、深圳市人民医院、中国科学技术大学等合作团队，在国际期刊《cell》上以Resource形式在线发表了题为“A single-cell atlas reveals immune heterogeneity in anti-PD-1-treated non-small cell lung cancer” 的研究论文。</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">张泽民老师课题组的当然是给出来全部的数据和代码啦：</span></p><ul><li><section><span leaf="">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE243013</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">可以看到，单细胞表达量矩阵相关文件非常齐全：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">GSE243013_NMF_all_group_5.csv.gz 1.1 Kb (ftp)(http) CSV</span><br><span leaf="">GSE243013_NSCLC_immune_scRNA_counts.mtx.gz 6.6 Gb (ftp)(http) MTX</span><br><span leaf="">GSE243013_NSCLC_immune_scRNA_metadata.csv.gz 38.8 Mb (ftp)(http) CSV</span><br><span leaf="">GSE243013_RAW.tar 516.4 Mb (http)(custom) TAR (of TAR)</span><br><span leaf="">GSE243013_T_with_TCR_annotation.csv.gz 15.2 Mb (ftp)(http) CSV</span><br><span leaf="">GSE243013_UMAP_info.tar.gz 20.6 Mb (ftp)(http) TAR</span><br><span leaf="">GSE243013_barcodes.csv.gz 6.4 Mb (ftp)(http) CSV</span><br><span leaf="">GSE243013_genes.csv.gz 111.5 Kb (ftp)(http) CSV</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">其实只需要看 GSE243013_UMAP_info.tar.gz，这个20.6 Mb文件里面的各个单细胞亚群的降维聚类分群后的UMAP坐标即可，文章里面的可视化如下所示：</span></p><section nodeleaf=""><img data-imgfileid="100052975" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KhDndGcQ4emNUO55T2iawRQtic2YOeXqCa65uq9oUcDLuJW9wbWGCX0BdTXtWv5hM8rrQ7AvluibBA/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KhDndGcQ4emNUO55T2iawRQtic2YOeXqCa65uq9oUcDLuJW9wbWGCX0BdTXtWv5hM8rrQ7AvluibBA/640?wx_fmt=png&amp;from=appmsg"></section><figure data-tool="mdnice编辑器"><span leaf=""><br></span><figcaption><span leaf="">各个单细胞亚群的降维聚类分群后的UMAP</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">很简单的读取任意一个 ：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">&gt; up_pos &lt;- rio::import(</span><span><span leaf="">'GSE243013_UMAP_info/B_UMAP.csv'</span></span><span leaf=""> ,data.table = F)</span><br><span leaf="">&gt; tail(up_pos)</span><br><span leaf="">                        cellID      UMAP1      UMAP2</span><br><span leaf="">297071 P412-TTGACTTGTTGTTTGG-1 -3.6648989 -1.4738921</span><br><span leaf="">297072 P412-TTGGAACAGTTCCACA-1 -1.4309019 -0.2027784</span><br><span leaf="">297073 P412-TTGGCAAAGTCTCGGC-1  2.1146060 -3.5012430</span><br><span leaf="">297074 P412-TTGGCAACAAATTGCC-1 -1.5862262 -2.3215356</span><br><span leaf="">297075 P412-TTGGCAAGTACCTACA-1  2.0117850 -0.7888926</span><br><span leaf="">297076 P412-TTTGCGCCAGCATGAG-1 -0.2946563 -1.4350615</span><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">接下来就是针对上面的文本文件进行可视化啦：</span></p><p data-tool="mdnice编辑器"><span leaf="">然后就可以问人工智能大模型啦，我对是kimi的提问 ：</span></p><blockquote><p><span leaf="">能模仿一下Seurat的umapplot 风格，根据二维坐标组成的数据框，来绘制umap图吗</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">kimi给我的答案是：在R中，</span><code><span leaf="">Seurat</span></code><span leaf="">包的</span><code><span leaf="">DimPlot</span></code><span leaf="">函数用于绘制UMAP图，其风格可以通过</span><code><span leaf="">ggplot2</span></code><span leaf="">的语法进行自定义。如果你有一个包含二维坐标的普通数据框，也可以使用</span><code><span leaf="">ggplot2</span></code><span leaf="">来绘制类似的UMAP图。</span></p><p data-tool="mdnice编辑器"><span leaf="">以下是一个示例代码，展示如何根据二维坐标数据框绘制类似</span><code><span leaf="">Seurat</span></code><span leaf="">风格的UMAP图：</span></p><h3 data-tool="mdnice编辑器"><span><span leaf="">示例数据</span></span></h3><p data-tool="mdnice编辑器"><span leaf="">假设你有一个数据框</span><code><span leaf="">df</span></code><span leaf="">，包含两列</span><code><span leaf="">UMAP_1</span></code><span leaf="">和</span><code><span leaf="">UMAP_2</span></code><span leaf="">，以及一个分类变量</span><code><span leaf="">Cluster</span></code><span leaf="">用于着色。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 加载必要的包</span></span><br><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><br><br><span><span leaf=""># 示例数据框</span></span><br><span leaf="">df &lt;- data.frame(</span><br><span leaf="">  UMAP_1 = rnorm(</span><span><span leaf="">100</span></span><span leaf="">),  </span><span><span leaf=""># 第一维坐标</span></span><br><span leaf="">  UMAP_2 = rnorm(</span><span><span leaf="">100</span></span><span leaf="">),  </span><span><span leaf=""># 第二维坐标</span></span><br><span leaf="">  Cluster = sample(</span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">3</span></span><span leaf="">, </span><span><span leaf="">100</span></span><span leaf="">, replace = </span><span><span leaf="">TRUE</span></span><span leaf="">)  </span><span><span leaf=""># 随机生成的分类变量</span></span><br><span leaf="">)</span><br><br><span><span leaf=""># 查看数据</span></span><br><span leaf="">head(df)</span><br></code></pre><h3 data-tool="mdnice编辑器"><span><span leaf="">绘制UMAP图</span></span></h3><p data-tool="mdnice编辑器"><span leaf="">使用</span><code><span leaf="">ggplot2</span></code><span leaf="">绘制UMAP图，模仿</span><code><span leaf="">Seurat</span></code><span leaf="">的风格：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 绘制UMAP图</span></span><br><span leaf="">ggplot(df, aes(x = UMAP_1, y = UMAP_2, color = as.factor(Cluster))) +</span><br><span leaf="">  geom_point(size = </span><span><span leaf="">3</span></span><span leaf="">, alpha = </span><span><span leaf="">0.8</span></span><span leaf="">) +  </span><span><span leaf=""># 绘制散点图</span></span><br><span leaf="">  theme_minimal() +  </span><span><span leaf=""># 使用简洁的主题</span></span><br><span leaf="">  labs(title = </span><span><span leaf="">"UMAP Plot"</span></span><span leaf="">,  </span><span><span leaf=""># 添加标题</span></span><br><span leaf="">       x = </span><span><span leaf="">"UMAP 1"</span></span><span leaf="">,  </span><span><span leaf=""># X轴标签</span></span><br><span leaf="">       y = </span><span><span leaf="">"UMAP 2"</span></span><span leaf="">,  </span><span><span leaf=""># Y轴标签</span></span><br><span leaf="">       color = </span><span><span leaf="">"Cluster"</span></span><span leaf="">) +  </span><span><span leaf=""># 图例标题</span></span><br><span leaf="">  theme(plot.title = element_text(size = </span><span><span leaf="">16</span></span><span leaf="">, face = </span><span><span leaf="">"bold"</span></span><span leaf="">),  </span><span><span leaf=""># 自定义标题样式</span></span><br><span leaf="">        axis.title = element_text(size = </span><span><span leaf="">14</span></span><span leaf="">),  </span><span><span leaf=""># 自定义轴标签样式</span></span><br><span leaf="">        legend.title = element_text(size = </span><span><span leaf="">14</span></span><span leaf="">))  </span><span><span leaf=""># 自定义图例标题样式</span></span><br></code></pre><h3 data-tool="mdnice编辑器"><span><span leaf="">输出效果</span></span></h3><p data-tool="mdnice编辑器"><span leaf="">这段代码会生成一个UMAP图，类似于</span><code><span leaf="">Seurat</span></code><span leaf="">包中的</span><code><span leaf="">DimPlot</span></code><span leaf="">风格：</span></p><ul><li><section><span leaf="">每个点表示一个观测值，根据</span><code><span leaf="">Cluster</span></code><span leaf="">分类变量着色。</span></section></li><li><section><span leaf="">使用了简洁的</span><code><span leaf="">theme_minimal()</span></code><span leaf="">主题，标题和轴标签的字体大小进行了调整，以增强可读性。</span></section></li></ul><h3 data-tool="mdnice编辑器"><span><span leaf="">进一步自定义</span></span></h3><p data-tool="mdnice编辑器"><span leaf="">你可以根据需要进一步自定义图表的样式，例如：</span></p><ul><li><section><span leaf="">改变点的大小和透明度（</span><code><span leaf="">size</span></code><span leaf="">和</span><code><span leaf="">alpha</span></code><span leaf="">参数）。</span></section></li><li><section><span leaf="">添加网格线（</span><code><span leaf="">theme(panel.grid.major = element_line(color = "gray"))</span></code><span leaf="">）。</span></section></li><li><section><span leaf="">调整颜色方案（使用</span><code><span leaf="">scale_color_manual()</span></code><span leaf="">或</span><code><span leaf="">scale_color_brewer()</span></code><span leaf="">）。</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">如果你有更具体的需求，比如特定的颜色方案或其他样式调整，可以告诉我，我可以进一步优化代码！</span></p><h3 data-tool="mdnice编辑器"><span><span leaf="">一起来看看效果吧</span></span></h3><p data-tool="mdnice编辑器"><span leaf="">我是直接就复制粘贴了人工智能大模型给我的代码，应用于张泽民课题组提供的坐标文件，如下所示：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">meta  &lt;- rio::import(</span><span><span leaf="">'input/GSE243013_NSCLC_immune_scRNA_metadata.csv.gz'</span></span><span leaf=""> )</span><br><br><span leaf="">df=merge(up_pos,meta,by=</span><span><span leaf="">'cellID'</span></span><span leaf="">)</span><br><span leaf="">colnames(df)</span><br><span leaf="">df=df[,c(</span><span><span leaf="">2</span></span><span leaf="">,</span><span><span leaf="">3</span></span><span leaf="">,</span><span><span leaf="">11</span></span><span leaf="">)]</span><br><span leaf="">colnames(df)=c(</span><span><span leaf="">'UMAP_1'</span></span><span leaf="">,</span><span><span leaf="">'UMAP_2'</span></span><span leaf="">,</span><span><span leaf="">'Cluster'</span></span><span leaf="">)</span><br><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><br><span><span leaf=""># 绘制UMAP图</span></span><br><span leaf="">ggplot(df, aes(x = UMAP_1, y = UMAP_2, color = as.factor(Cluster))) +</span><br><span leaf="">  geom_point(size = </span><span><span leaf="">0.2</span></span><span leaf="">, alpha = </span><span><span leaf="">0.8</span></span><span leaf="">) +  </span><span><span leaf=""># 绘制散点图</span></span><br><span leaf="">  theme_minimal() +  </span><span><span leaf=""># 使用简洁的主题</span></span><br><span leaf="">  labs(title = </span><span><span leaf="">"UMAP Plot"</span></span><span leaf="">,  </span><span><span leaf=""># 添加标题</span></span><br><span leaf="">       x = </span><span><span leaf="">"UMAP 1"</span></span><span leaf="">,  </span><span><span leaf=""># X轴标签</span></span><br><span leaf="">       y = </span><span><span leaf="">"UMAP 2"</span></span><span leaf="">,  </span><span><span leaf=""># Y轴标签</span></span><br><span leaf="">       color = </span><span><span leaf="">"Cluster"</span></span><span leaf="">) +  </span><span><span leaf=""># 图例标题</span></span><br><span leaf="">  theme(plot.title = element_text(size = </span><span><span leaf="">16</span></span><span leaf="">, face = </span><span><span leaf="">"bold"</span></span><span leaf="">),  </span><span><span leaf=""># 自定义标题样式</span></span><br><span leaf="">        axis.title = element_text(size = </span><span><span leaf="">14</span></span><span leaf="">),  </span><span><span leaf=""># 自定义轴标签样式</span></span><br><span leaf="">        legend.title = element_text(size = </span><span><span leaf="">14</span></span><span leaf="">))  </span><span><span leaf=""># 自定义图例标题样式</span></span><br><br></code></pre><p data-tool="mdnice编辑器"><span leaf="">这个时候不需要自己 从零开始读取表达量矩阵文件然后降维聚类分群，因为这样的课题往往是百万级别的单细胞数量，一般人的计算机资源压根就没办法hold住这个项目。但是简单的可视化是没有问题的，出图如下所示：</span></p><section nodeleaf=""><img data-imgfileid="100052976" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KhDndGcQ4emNUO55T2iawRMOyHic8B6heibEd8s1Rzv9JpQJdJpIsCpiba5ZwcIuubYqEFAzHxZ2vgw/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KhDndGcQ4emNUO55T2iawRMOyHic8B6heibEd8s1Rzv9JpQJdJpIsCpiba5ZwcIuubYqEFAzHxZ2vgw/640?wx_fmt=png&amp;from=appmsg"></section><figure data-tool="mdnice编辑器"><span leaf=""><br></span><figcaption><span leaf="">umap图</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">基本上跟作者文章里面的b细胞亚群的细分后的降维聚类分群umap没什么区别，当然了，配色等细节，还是需要通过慢慢的跟人工智能大模型去对话来调整的。大家可以赶快去试试看哈。</span></p><h3 data-tool="mdnice编辑器"><span><span leaf="">如果你觉得一步步的调整很麻烦</span></span></h3><p data-tool="mdnice编辑器"><span leaf="">也可以直接使用造好的轮子，比如scp包里面的绘图函数，可以看到它针对的是Seurat对象出图，如下所示：</span></p><section nodeleaf=""><img data-imgfileid="100052977" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KhDndGcQ4emNUO55T2iawRN1JlnsVGjqzo81JzRibLZJdzg32M9mtnClvyOuBQ6voW3X42p7iaEqZg/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KhDndGcQ4emNUO55T2iawRN1JlnsVGjqzo81JzRibLZJdzg32M9mtnClvyOuBQ6voW3X42p7iaEqZg/640?wx_fmt=png&amp;from=appmsg"></section><figure data-tool="mdnice编辑器"><span leaf=""><br></span><figcaption><span leaf="">scp包里面的绘图函数</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">但是我们可以去scp包的github网页看源代码：https://github.com/zhanghao-njmu/SCP</span></p><p data-tool="mdnice编辑器"><span leaf="">在 https://github.com/zhanghao-njmu/SCP/blob/main/R/SCP-plot.R 可以找到 CellDimPlot 函数的细节，当然了，大部分人肯定是会望而生畏，确实是代码有点多：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><br></span></figure></section><section nodeleaf=""><img data-imgfileid="100052978" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KhDndGcQ4emNUO55T2iawR7WDKkXk3qJl4ZItNqd5QN5qEu1AOoX9yN9woyLWOiaiciaLNticv8M9czw/640?wx_fmt=png&amp;from=appmsg" data-type="png" type="block" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9KhDndGcQ4emNUO55T2iawR7WDKkXk3qJl4ZItNqd5QN5qEu1AOoX9yN9woyLWOiaiciaLNticv8M9czw/640?wx_fmt=png&amp;from=appmsg"></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><figure data-tool="mdnice编辑器"><span leaf=""><br></span><figcaption><span leaf="">CellDimPlot 函数的细节</span></figcaption></figure><p data-tool="mdnice编辑器"><span leaf="">当然了，可视化这个活啊真的是精益求精，<span textstyle="">也有人仅仅是绘制一个图就1000多行代码</span>，比如之前推荐过的教科书级别的百万单细胞图谱文章，在《Nature Genetics》杂志在线发表了题为《Multi-omic analysis of gallbladder cancer identifies distinct tumor microenvironments associated with disease progression》的研究论文。文章涉及到到多组学，单细胞数据，分门别类整理的非常棒：https://zenodo.org/records/15400138。有全部的代码 ， Analysis code for: multi-omic analysis of gallbladder cancer identifies distinct tumor microenvironments associated with disease progression (v 1.0.0). Zenodo https://doi.org/10.5281/zenodo.15406874 (2025).</span></p></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/UHkUTA49cJ6vXPII8luMeQ",target="_blank" rel="noopener noreferrer">原文链接</a>
