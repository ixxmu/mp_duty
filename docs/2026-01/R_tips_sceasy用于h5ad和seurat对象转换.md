---
title: "R tips：sceasy用于h5ad和seurat对象转换"
date: 2026-01-17T07:29:33Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
R tips：sceasy用于h5ad和seurat对象转换 by 生信菜鸟团
------
<div><p data-pm-slice="0 0 []"><span><span leaf="">以前曾经聊过使用sceasy用于h5ad和seurat的格式转换：</span></span><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247527254&amp;idx=1&amp;sn=4a6416d6d15dc496ef6949a5ac608ab5&amp;scene=21#wechat_redirect" textvalue="" linktype="text" data-linktype="2">R tips：R如何读取scanpy单细胞文件</a></span><span><span leaf="">，本文详细描述一下格式转换时的细节。</span></span></p><p><span leaf="">sceasy的安装和配置细节见上文。</span></p><p><strong><span leaf="">以h5ad转为seurat对象为例</span></strong></p><ol><li><section><span leaf="">先配置好python路径，这样就不会再出现是否创建reticulate的python环境的提示：'Would you like to create a default Python environment for the reticulate package?'</span></section></li></ol><pre><ol><li><code><span><span leaf=""><span textstyle=""># shell to open R</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">conda activate tools</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">R</span></span></span></code></li></ol></pre><pre><ol><li><code><span><span leaf=""><span textstyle=""># </span></span><span leaf=""><span textstyle="">in R console</span></span></span></code><code><span><span leaf=""><br></span><span leaf=""><span textstyle="">library(reticulate)</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">use_python("/home/xxx/miniforge3/envs/tools/bin/python") # python所在路径</span></span></span></code></li></ol></pre><ol><li><p><span leaf=""><span textstyle="">格式转换</span></span></p><p><span leaf=""><span textstyle="">h5ad格式的数据存储比较麻烦，counts、data、scale.data三种数据无法共存，因此在进行格式转换时请注意所使用的h5ad的X是什么数据，进而调整sceasy的相应参数。</span></span></p><p><span leaf=""><span textstyle="">如果是raw counts的h5ad：</span></span></p></li></ol><pre><ol><li><code><span><span leaf=""><span textstyle="">adata </span></span></span><span><span leaf=""><span textstyle="">&lt;-</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">sceasy</span></span></span><span><span leaf=""><span textstyle="">::</span></span></span><span><span leaf=""><span textstyle="">convertFormat</span></span></span><span><span leaf=""><span textstyle="">(</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">   'adata_raw.h5ad'</span></span></span><span><span leaf=""><span textstyle="">,</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">   from</span></span></span><span></span><span><span leaf=""><span textstyle="">=</span></span></span><span></span><span><span leaf=""><span textstyle="">"anndata"</span></span></span><span><span leaf=""><span textstyle="">,</span></span></span><span></span></code></li><li><code><span><span leaf=""><span textstyle="">   to </span></span></span><span><span leaf=""><span textstyle="">=</span></span></span><span></span><span><span leaf=""><span textstyle="">"seurat"</span></span></span><span><span leaf=""><span textstyle="">,</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">   main_layer </span></span></span><span><span leaf=""><span textstyle="">=</span></span></span><span></span><span><span leaf=""><span textstyle="">'counts'</span></span></span><span></span><span><span leaf=""><span textstyle=""># &lt;----- </span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">)</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">saveRDS</span></span></span><span><span leaf=""><span textstyle="">(</span></span></span><span><span leaf=""><span textstyle="">adata</span></span></span><span><span leaf=""><span textstyle="">,</span></span></span><span></span><span><span leaf=""><span textstyle="">'adata_raw.rds'</span></span></span><span><span leaf=""><span textstyle="">)</span></span></span></code></li></ol></pre><p><span leaf="">如果是norm data的h5ad:</span></p><pre><ol><li><code><span><span leaf=""><span textstyle="">adata </span></span></span><span><span leaf=""><span textstyle="">&lt;-</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">sceasy</span></span></span><span><span leaf=""><span textstyle="">::</span></span></span><span><span leaf=""><span textstyle="">convertFormat</span></span></span><span><span leaf=""><span textstyle="">(</span></span></span></code></li><li><code><span></span><span><span leaf=""><span textstyle="">   'adata_norm.h5ad'</span></span></span><span><span leaf=""><span textstyle="">,</span></span></span><span></span></code></li><li><code><span></span><span><span leaf=""><span textstyle="">   from</span></span></span><span></span><span><span leaf=""><span textstyle="">=</span></span></span><span></span><span><span leaf=""><span textstyle="">"anndata"</span></span></span><span><span leaf=""><span textstyle="">,</span></span></span><span></span></code></li><li><code><span><span leaf=""><span textstyle="">   to </span></span></span><span><span leaf=""><span textstyle="">=</span></span></span><span></span><span><span leaf=""><span textstyle="">"seurat"</span></span></span><span><span leaf=""><span textstyle="">,</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">   main_layer </span></span></span><span><span leaf=""><span textstyle="">=</span></span></span><span></span><span><span leaf=""><span textstyle="">'data'</span></span></span><span></span><span><span leaf=""><span textstyle=""># &lt;----- </span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">)</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">saveRDS</span></span></span><span><span leaf=""><span textstyle="">(</span></span></span><span><span leaf=""><span textstyle="">adata</span></span></span><span><span leaf=""><span textstyle="">,</span></span></span><span></span><span><span leaf=""><span textstyle="">'adata_norm.rds'</span></span></span><span><span leaf=""><span textstyle="">)</span></span></span></code></li></ol></pre><p><span leaf=""><span textstyle="">不建议对scale.data进行h5ad格式转换，意义不大。</span></span></p><ol><li><p><span leaf=""><span textstyle="">在R中读取并调整相应信息</span></span></p><p><span leaf=""><span textstyle="">由于sceasy是安装的Seurat V4，而在正式使用时，一般都是使用的SeruatV5，因此转换后的rds读入后请做如下调整：</span></span></p></li></ol><pre><ol><li><code><span><span leaf=""><span textstyle=""># when read into R, all_data_sc should transfom as below:</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">all_data_sc </span></span></span><span><span leaf=""><span textstyle="">&lt;-</span></span></span><span><span leaf=""><span textstyle=""> readRDS</span></span></span><span><span leaf=""><span textstyle="">(</span></span></span><span><span leaf=""><span textstyle="">'adata_raw.rds'</span></span></span><span><span leaf=""><span textstyle="">)</span></span></span></code></li><li><code><span><span leaf=""><br></span></span></code></li><li><code></code></li><li><code><span><span leaf=""><span textstyle=""># add 2 common QC metrics in Seurat</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">all_data_sc$nCount_RNA </span></span></span><span><span leaf=""><span textstyle="">&lt;-</span></span></span><span><span leaf=""><span textstyle=""> all_data_sc$total_counts</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">all_data_sc$nFeature_RNA </span></span></span><span><span leaf=""><span textstyle="">&lt;-</span></span></span><span><span leaf=""><span textstyle=""> all_data_sc$nFeaturess_RNA_by_counts</span></span></span></code></li><li><code><span><span leaf=""><br></span></span></code></li><li><code></code></li><li><code><span><span leaf=""><span textstyle=""># transform assay to V5 and remove data slot</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">all_data_sc</span></span></span><span><span leaf=""><span textstyle="">[[</span></span></span><span><span leaf=""><span textstyle="">'RNA'</span></span></span><span><span leaf=""><span textstyle="">]]</span></span></span><span></span><span><span leaf=""><span textstyle="">&lt;-</span></span></span><span></span><span><span leaf=""><span textstyle="">as</span></span></span><span><span leaf=""><span textstyle="">(</span></span></span><span><span leaf=""><span textstyle="">all_data_sc</span></span></span><span><span leaf=""><span textstyle="">[[</span></span></span><span><span leaf=""><span textstyle="">'RNA'</span></span></span><span><span leaf=""><span textstyle="">]],</span></span></span><span></span><span><span leaf=""><span textstyle="">"Assay5"</span></span></span><span><span leaf=""><span textstyle="">)</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">all_data_sc@assays$RNA$data </span></span></span><span><span leaf=""><span textstyle="">&lt;-</span></span></span><span><span leaf=""><span textstyle=""> NULL</span></span></span></code></li><li><code><span><span leaf=""><br></span></span></code></li><li><code></code></li><li><code><span><span leaf=""><span textstyle=""># split counts layer, just as seurat object created by Seurat V5 from raw counts</span></span></span></code></li><li><code><span><span leaf=""><span textstyle="">all_data_sc</span></span></span><span><span leaf=""><span textstyle="">[[</span></span></span><span><span leaf=""><span textstyle="">'RNA'</span></span></span><span><span leaf=""><span textstyle="">]]</span></span></span><span></span><span><span leaf=""><span textstyle="">&lt;-</span></span></span><span><span leaf=""><span textstyle=""> split</span></span></span><span><span leaf=""><span textstyle="">(</span></span></span><span><span leaf=""><span textstyle="">all_data_sc</span></span></span><span><span leaf=""><span textstyle="">[[</span></span></span><span><span leaf=""><span textstyle="">'RNA'</span></span></span><span><span leaf=""><span textstyle="">]],</span></span></span><span><span leaf=""><span textstyle=""> all_data_sc$sample</span></span></span><span><span leaf=""><span textstyle="">,</span></span></span><span><span leaf=""><span textstyle=""> layers </span></span></span><span><span leaf=""><span textstyle="">=</span></span></span><span></span><span><span leaf=""><span textstyle="">"counts"</span></span></span><span><span leaf=""><span textstyle="">)</span></span></span></code></li></ol></pre><section><span leaf=""><br></span></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/0Em3CdVU3w5_V0FdWlZ6kA",target="_blank" rel="noopener noreferrer">原文链接</a>
