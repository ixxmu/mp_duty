---
title: "跟着Nature学习scATAC-seq数据分析"
date: 2026-01-21T00:25:21Z
draft: ["false"]
tags: [
  "fetched",
  "生信技能树"
]
categories: ["Acdemic"]
---
跟着Nature学习scATAC-seq数据分析 by 生信技能树
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><blockquote><p><span leaf="">scATAC-seq在2025年的时候，断断续续学了点皮毛，好在平时整理了比较多的数据和资源，<span textstyle="">今年打算将这个组学专辑扩大扩深</span>，欢迎大家一起进群交流（微信Biotree123）。2025年的资源累积专辑见：《<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=3921285649579606026&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMDkxODM1Ng%3D%3D%26mid%3D2247541082%26idx%3D1%26sn%3D16feca6c3ad0087a3597cff54ea3531c%26key%3Ddaf9bdc5abc4e8d0ff44844d2b5a132773ff06349f914a5a01e77a8038cfcd107184046e3fc6c994b7fdf5538e6b87187116f44d2933244c20d3df533b1bfb366389649ab4eca46db5e9d5397f1cc60c9e8e0c2892f4a7b0da37c7bfbd0d0b9c3dbb9f75fb67b76bf1a1bcab14039851e05401490b456606baf4bdbc7259a983%26ascene%3D0%26uin%3DMTc5NzA0NTcyMA%253D%253D%26devicetype%3DWindows%2B11%2Bx64%26version%3D63090c33%26lang%3Dzh_CN%26countrycode%3DCN%26exportkey%3Dn_ChQIAhIQzQBng53wjYFlDxUb70jLohLfAQIE97dBBAEAAAAAAJDyGNthcFkAAAAOpnltbLcz9gKNyK89dVj043bFhlOZ6VgShdgBgE0p4ghGJxjaC5NCi8%252BABJECm6ZUCBLpvOmsAdpnX8%252FgfhIsTZoURnk8BO64FtUlbqPTVhGUN7RXz6%252B%252FcoFw0eaeJZaCwegRyE6pT%252BYlNuAVIYuR2sS1zXE5AAqgFYlPbspdw%252BwyUUqDbusYEzSk53CH9Y486orqYX1qZLdobZkk32QfRPCnstE3lNKacD9GpBBc%252FaE8FVIqTMphYHIDQI0l1oM40Rw0foQWGgo%253D%26acctmode%3D0%26pass_ticket%3DUA1nQxfHWfnSny7%252BaoVI00OanVKhezZmygUvjw2gbpc3LicVy1nn2PtlFXCJFwRA%26wx_header%3D1%26fasttmpl_type%3D0%26fasttmpl_fullversion%3D7710472-zh_CN-zip%26fasttmpl_flag%3D1&amp;nolastread=1&amp;sessionid=-2059491303#wechat_redirect" textvalue="" linktype="text" data-linktype="2">scATAC-seq分析</a>》。<span textstyle="">2026年，冲！</span></span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">今天学习2022年8月10号发表在Nature杂志上的一篇文献，标题为《Spatial multi-omic map of human myocardial infarction》，是一篇非常经典的文章，文章不仅分享了数据和代码，还有详细的分析思路！</span></p><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">文献主要内容</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">本研究利用 snRNA-seq，snATAC-seq 和空间转录组分析技术，对心肌梗死患者和对照组不同时间点多个生理区域的心肌组织进行整合性高分辨率图谱绘制，构建了</span><strong><span leaf="">心肌梗死后人类心脏重塑过程的综合高分辨率图谱</span></strong><span leaf="">。</span></p><p data-tool="mdnice编辑器"><span leaf="">是一篇基础类的图谱构建研究工作。</span></p><h4 data-tool="mdnice编辑器"><span></span><span leaf="">心肌梗死的多组学图谱</span><span></span></h4><p data-tool="mdnice编辑器"><span leaf="">本研究构建了心肌梗死的综合多组学图谱，通过整合 snRNA-seq，snATAC-seq 和空间转录组学技术，系统分析了31个样本（涵盖急性期不同区域及慢性期纤维化组织）。研究鉴定出10种主要心脏细胞类型，发现缺血区存在细胞周期活跃的增殖细胞群，并揭示了该区域细胞核丰度降低、坏死相关通路激活的特征。</span></p><p data-tool="mdnice编辑器"><span leaf="">经低质量核过滤后，从所有样本共获得191,795个核用于snRNA-seq（平均每个核检测2,020个基因），<span textstyle="">同时获得来自</span></span><strong><span leaf=""><span textstyle="">46,086个核的染色质可及性数据（平均每个核28,066个片段）</span></span></strong><span leaf=""><span textstyle="">。</span>经数据质量控制，空间转录组数据集共包含91,517个检测点（平均每个样本3,389个点，每点检测2,001个基因）。</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">snRNA-seq数据</span></strong><span leaf="">：共鉴定出十种主要心脏细胞类型（图1d,e）</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwJ1thviatmK0L2gCRpn2FXkhf9E6YR0lcuG3Uzib5R7oJ3vq7YUCUmmtDnErwdZCyV3ULMzociaoialw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.49722222222222223" data-type="png" data-w="1080" data-imgfileid="100064958" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwJ1thviatmK0L2gCRpn2FXkhf9E6YR0lcuG3Uzib5R7oJ3vq7YUCUmmtDnErwdZCyV3ULMzociaoialw/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><strong><span leaf=""><span textstyle="">snATAC-seq数据</span></span></strong><span leaf="">：鉴定出八种主要细胞类型，除两种稀有细胞类型（即肥大细胞 mast cells 和脂肪细胞 adipocytes）外，其余均与snRNA-seq数据中的细胞类型相匹配（图1f,g）。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwJ1thviatmK0L2gCRpn2FXkUIPkibldVviaL7dlUEkw9urQr89vjgEGgQ81pUefD3pBANcQmXicq9cFw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5407407407407407" data-type="png" data-w="1080" data-imgfileid="100064957" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwJ1thviatmK0L2gCRpn2FXkUIPkibldVviaL7dlUEkw9urQr89vjgEGgQ81pUefD3pBANcQmXicq9cFw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">snATAC-seq数据分析</span></span></h2><p data-tool="mdnice编辑器"><strong><span leaf="">定量</span></strong><span leaf="">：the CellRanger ATAC pipeline (v2.2.0) was used with the default settings</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">下游分析</span></strong><span leaf="">：ArchR (v1.0.1），输入文件问 the fragment files</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">QC指标</span></strong><span leaf="">：transcription start site (TSS) enrichment (&gt; 4)，the number of unique fragments (&gt; 3,000 and &lt; 100,000)</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">Doublets鉴定</span></strong><span leaf="">： using the functions addDoubletScores and filterDoublets from ArchR with default settings</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">peaks鉴定</span></strong><span leaf="">：peaks were identified by using the function addReproduciblePeakSet for each sample</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">去批次</span></strong><span leaf="">：Harmony</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">降维聚类分群</span></strong><span leaf="">：a resolution of 1</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">注释</span></strong><span leaf="">：a gene activity score matrix was created using the function  addGeneScoreMatrix and marker genes were detected for each cluster using the function getMarkerFeatures. The same markers from  snRNA-seq data were used to annotate the clusters.</span></p><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">数据下载</span></span></h2><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">这篇文献的数据放的超级复杂，梳理如下：</span></span></p><h4 data-tool="mdnice编辑器"><span></span><span leaf="">地址1：cellxgene</span><span></span></h4><blockquote><p><span leaf="">https://cellxgene.cziscience.com/collections/8191c283-0816-424b-9b61-c3e1d6258a77</span></p><p><span leaf="">这里有所有的数据，为处理后的h5ad数据</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf="">其中snATAC-seq数据连接如下（这个h5ad数据我目前还没想好怎么用R分析，python是有个工具可以做的 Signac 和 Signac2 ）：</span></p><p data-tool="mdnice编辑器"><span leaf="">All-snATAC-Spatial multi-omic map of human myocardial infarction</span></p><p data-tool="mdnice编辑器"><span leaf="">https://datasets.cellxgene.cziscience.com/73aa858a-f7ae-4f3e-91b3-987dacfb42a9-fragment.tsv.bgz </span></p><p data-tool="mdnice编辑器"><span leaf="">https://datasets.cellxgene.cziscience.com/73aa858a-f7ae-4f3e-91b3-987dacfb42a9-fragment.tsv.bgz.tbi </span></p><p data-tool="mdnice编辑器"><span leaf="">https://datasets.cellxgene.cziscience.com/f95f9724-9ed5-43dc-b86f-1aa7dc47ea33.h5ad</span></p><h4 data-tool="mdnice编辑器"><span></span><span leaf="">地址2：zenodo</span><span></span></h4><p data-tool="mdnice编辑器"><strong><span leaf="">Processed Data 1</span></strong><span leaf=""> : Spatial multi-omic map of human myocardial infarction https://zenodo.org/records/6578047</span></p><blockquote><p><span leaf="">snATAC-seq-submission.h5ad 全是h5ad 有snATAC-seq snRNA-seq和空转</span></p></blockquote><p data-tool="mdnice编辑器"><strong><span leaf="">Processed Data 2</span></strong><span leaf=""> : Spatial multi-omic map of human myocardial infarction https://zenodo.org/records/7098004</span></p><blockquote><p><span leaf="">Cardiomyocyte_snRNA_snATAC.Rds 亚群各种rds</span></p></blockquote><p data-tool="mdnice编辑器"><strong><span leaf="">Raw Data - Part 1</span></strong><span leaf=""> : Spatial multi-omic map of human myocardial infarction https://zenodo.org/records/6578553</span></p><ul><li><section><span leaf="">10X_ATAC_CK166.tsv.gz  1.5 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK167.tsv.gz  1.7 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK168.tsv.gz  1.4 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK169.tsv.gz  1.8 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK170.tsv.gz 1.6 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK171.tsv.gz  2.1 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK173.tsv.gz  1.8 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK174.tsv.gz  1.9 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK336.tsv.gz  1.2 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK337.tsv.gz  1.8 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK338.tsv.gz  1.4 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK339.tsv.gz  2.2 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK340.tsv.gz  2.0 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK341.tsv.gz  1.1 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK342.tsv.gz  556.6 MB</span></section></li><li><section><span leaf="">10X_ATAC_CK343.tsv.gz  1.2 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK344.tsv.gz  1.2 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK345.tsv.gz  716.8 MB</span></section></li><li><section><span leaf="">10X_ATAC_CK346.tsv.gz  1.3 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK347.tsv.gz  496.3 MB</span></section></li><li><section><span leaf="">10X_ATAC_CK348.tsv.gz  819.3 MB</span></section></li><li><section><span leaf="">10X_ATAC_CK349.tsv.gz  1.3 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK350.tsv.gz  2.3 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK351.tsv.gz  2.5 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK352.tsv.gz  1.2 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK353.tsv.gz  1.5 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK354.tsv.gz  2.1 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK355.tsv.gz  2.0 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK380.tsv.gz  2.1 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK381.tsv.gz  839.4 MB</span></section></li><li><section><span leaf="">10X_ATAC_CK382.tsv.gz  3.5 GB</span></section></li></ul><p data-tool="mdnice编辑器"><strong><span leaf="">Raw Data - Part 2</span></strong><span leaf=""> : Spatial multi-omic map of human myocardial infarction https://zenodo.org/records/6578617</span></p><ul><li><section><span leaf="">10X_ATAC_CK383.tsv.gz  3.5 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK385.tsv.gz  823.1 MB</span></section></li><li><section><span leaf="">10X_ATAC_CK386.tsv.gz  2.0 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK387.tsv.gz  2.2 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK388.tsv.gz  1.1 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK389.tsv.gz  2.4 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK390.tsv.gz 1.4 GB</span></section></li><li><section><span leaf="">10X_ATAC_CK391.tsv.gz  878.8 MB</span></section></li><li><section><span leaf="">metadata-ATAC-seq.xlsx  6.9 kB</span></section></li></ul><p data-tool="mdnice编辑器"><strong><span leaf="">Raw Data - Part 3</span></strong><span leaf=""> : Spatial multi-omic map of human myocardial infarction https://zenodo.org/records/6580069</span></p><blockquote><p><span leaf="">全是空转的数据文件夹</span></p></blockquote><p data-tool="mdnice编辑器"><strong><span leaf="">Raw Data - Part 4</span></strong><span leaf=""> : Spatial multi-omic map of human myocardial infarction ---- Raw image https://zenodo.org/records/6778620</span></p><blockquote><p><span leaf="">全是空转 157771_2019AKK006.tif 数据</span></p></blockquote><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">理论上应该下载上面 Raw Data - Part 1 和 Raw Data - Part 2 里面的snATAC的 fragment 文件</span>，后面就可以方便的使用 ArchR 进行分析了。</span></p><blockquote><p><span leaf="">ArchR：https://www.archrproject.com/index.html</span></p></blockquote><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">代码在这里</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">代码：https://github.com/saezlab/visium_heart</span></p><p data-tool="mdnice编辑器"><span leaf="">基础分析高级分析都有：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwJ1thviatmK0L2gCRpn2FXkaBCXtJnfgcfdAVVR7zbcxvujdeicxq0FlDZzWGLOrmj3AfibEuZy5KTQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7648148148148148" data-type="png" data-w="1080" data-imgfileid="100064959" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwJ1thviatmK0L2gCRpn2FXkaBCXtJnfgcfdAVVR7zbcxvujdeicxq0FlDZzWGLOrmj3AfibEuZy5KTQ/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">我这里目前数据下载中，比如使用三个样本的 fragment文件：</span></p><p data-tool="mdnice编辑器"><span leaf="">创建 Arrow文件：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ArchR)</span><span leaf=""><br></span><span leaf="">packageVersion(</span><span><span leaf="">"ArchR"</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(SingleR)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(viridis)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(patchwork)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(dplyr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(cowplot)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggrepel)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">set.seed(</span><span><span leaf="">123</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">packageVersion(</span><span><span leaf="">"ArchR"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">addArchRThreads(threads = </span><span><span leaf="">70</span></span><span leaf="">) </span><span leaf=""><br></span><span leaf="">addArchRGenome(</span><span><span leaf="">"hg38"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">inputFiles &lt;- list.files(</span><span><span leaf="">"./"</span></span><span leaf="">,full.names = </span><span><span leaf="">T</span></span><span leaf="">,pattern = </span><span><span leaf="">"10X_ATAC_"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">inputFiles</span><span leaf=""><br></span><span leaf="">names(inputFiles) &lt;- str_split(gsub(</span><span><span leaf="">".tsv.gz$"</span></span><span leaf="">,</span><span><span leaf="">""</span></span><span leaf="">, basename(inputFiles)),pattern = </span><span><span leaf="">"_"</span></span><span leaf="">,n=</span><span><span leaf="">2</span></span><span leaf="">,simplify = </span><span><span leaf="">T</span></span><span leaf="">)[,</span><span><span leaf="">2</span></span><span leaf="">]</span><span leaf=""><br></span><span leaf="">inputFiles</span><span leaf=""><br></span><span leaf="">sampleNames &lt;- names(inputFiles)</span><span leaf=""><br></span><span leaf="">sampleNames</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## 1.create Arrow files----</span></span><span leaf=""><br></span><span leaf="">minTSS &lt;- </span><span><span leaf="">4</span></span><span leaf=""><br></span><span leaf="">minFrags &lt;- </span><span><span leaf="">3000</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">ArrowFiles &lt;- createArrowFiles(</span><span leaf=""><br></span><span leaf="">  inputFiles = inputFiles,</span><span leaf=""><br></span><span leaf="">  sampleNames = names(inputFiles),</span><span leaf=""><br></span><span leaf="">  outputNames = names(inputFiles),</span><span leaf=""><br></span><span leaf="">  minTSS = minTSS, </span><span leaf=""><br></span><span leaf="">  minFrags = minFrags, </span><span leaf=""><br></span><span leaf="">  QCDir = </span><span><span leaf="">"./01.QualityControl"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  addTileMat = </span><span><span leaf="">TRUE</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  addGeneScoreMat = </span><span><span leaf="">TRUE</span></span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">绘制QC图</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf="">## 2.plot quality control----</span></span><span leaf=""><br></span><span leaf="">plotlist &lt;- lapply(names(inputFiles), </span><span><span leaf="">function</span></span><span leaf="">(sample){</span><span leaf=""><br></span><span leaf="">  input_filename &lt;- sprintf(</span><span><span leaf="">"./01.QualityControl/%s/%s-Pre-Filter-Metadata.rds"</span></span><span leaf="">, sample, sample)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">if</span></span><span leaf="">(file.exists(input_filename)){</span><span leaf=""><br></span><span leaf="">    Metadata &lt;- readRDS(input_filename)</span><span leaf=""><br></span><span leaf="">    </span><span leaf=""><br></span><span leaf="">    ggtitle &lt;- sprintf(</span><span><span leaf="">"%s"</span></span><span leaf="">, paste0(sample, </span><span><span leaf="">"\nnCells Pass Filter = "</span></span><span leaf="">, sum(Metadata$Keep)) )</span><span leaf=""><br></span><span leaf="">    </span><span leaf=""><br></span><span leaf="">    gg &lt;- ggPoint(</span><span leaf=""><br></span><span leaf="">      x = pmin(log10(Metadata$nFrags), </span><span><span leaf="">5</span></span><span leaf="">) + rnorm(length(Metadata$nFrags), sd = </span><span><span leaf="">0.00001</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">      y = Metadata$TSSEnrichment + rnorm(length(Metadata$nFrags), sd = </span><span><span leaf="">0.00001</span></span><span leaf="">), </span><span leaf=""><br></span><span leaf="">      colorDensity = </span><span><span leaf="">TRUE</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">      xlim = c(</span><span><span leaf="">2.5</span></span><span leaf="">, </span><span><span leaf="">5</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">      ylim = c(</span><span><span leaf="">0</span></span><span leaf="">, max(Metadata$TSSEnrichment) * </span><span><span leaf="">1.05</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">      baseSize = </span><span><span leaf="">6</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">      continuousSet = </span><span><span leaf="">"sambaNight"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">      xlabel = </span><span><span leaf="">"Log 10 (Unique Fragments)"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">      ylabel = </span><span><span leaf="">"TSS Enrichment"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">      title = ggtitle,</span><span leaf=""><br></span><span leaf="">      rastr = </span><span><span leaf="">TRUE</span></span><span leaf="">) + </span><span leaf=""><br></span><span leaf="">      geom_hline(yintercept=minTSS, lty = </span><span><span leaf="">"dashed"</span></span><span leaf="">, size = </span><span><span leaf="">0.25</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">      geom_vline(xintercept=log10(minFrags), lty = </span><span><span leaf="">"dashed"</span></span><span leaf="">, size = </span><span><span leaf="">0.25</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">      theme(plot.margin = margin(</span><span><span leaf="">0.1</span></span><span leaf="">, </span><span><span leaf="">0.1</span></span><span leaf="">, </span><span><span leaf="">0.1</span></span><span leaf="">, </span><span><span leaf="">0.1</span></span><span leaf="">, unit = </span><span><span leaf="">"in"</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf="">    </span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">return</span></span><span leaf="">(gg)  </span><span leaf=""><br></span><span leaf="">  }</span><span leaf=""><br></span><span leaf="">})</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">p &lt;- patchwork::wrap_plots(plotlist, ncol = </span><span><span leaf="">3</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">options(repr.plot.width = </span><span><span leaf="">28</span></span><span leaf="">, repr.height = </span><span><span leaf="">16</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">print(p)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwJ1thviatmK0L2gCRpn2FXkUibuLC1uvYaHsmxLrIdODlE9rnCj2J6j2zLMUjIcgxIy1icONWwhGKUA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5194444444444445" data-type="png" data-w="1080" data-imgfileid="100064956" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/cZNhZQ6j4wwJ1thviatmK0L2gCRpn2FXkUibuLC1uvYaHsmxLrIdODlE9rnCj2J6j2zLMUjIcgxIy1icONWwhGKUA/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">创建 ArchRProject：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf="">## 3.创建 ArchRProject----</span></span><span leaf=""><br></span><span leaf="">proj &lt;- ArchRProject(</span><span leaf=""><br></span><span leaf="">  ArrowFiles = ArrowFiles, </span><span leaf=""><br></span><span leaf="">  outputDirectory = </span><span><span leaf="">"./data/VisiumHeart"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  showLogo = </span><span><span leaf="">FALSE</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  copyArrows = </span><span><span leaf="">TRUE</span></span><span><span leaf=""><a topic-id="mkfl1ea9-wdh4qz" data-topic="1">#This</a> is recommened so that you maintain an unaltered copy for later usage.</span></span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">getAvailableMatrices(proj)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## 4.Doublets鉴定----</span></span><span leaf=""><br></span><span leaf="">proj &lt;- addDoubletScores(</span><span leaf=""><br></span><span leaf="">  input = proj,</span><span leaf=""><br></span><span leaf="">  k = </span><span><span leaf="">10</span></span><span leaf="">, </span><span><span leaf=""># Refers to how many cells near a "pseudo-doublet" to count.</span></span><span leaf=""><br></span><span leaf="">  knnMethod = </span><span><span leaf="">"UMAP"</span></span><span leaf="">, </span><span><span leaf=""><a topic-id="mkfl1ea9-ngzosb" data-topic="1">#Refers</a> to the embedding to use for nearest neighbor search with doublet projection.</span></span><span leaf=""><br></span><span leaf="">  LSIMethod = </span><span><span leaf="">1</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  outDir = </span><span><span leaf="">"./data/DoubletScores"</span></span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf="">## remove doublets</span></span><span leaf=""><br></span><span leaf="">proj &lt;- filterDoublets(proj)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## Save data</span></span><span leaf=""><br></span><span><span leaf=""># 默认保存在这里 outputDirectory = "./data/VisiumHeart", </span></span><span leaf=""><br></span><span><span leaf=""># 生成文件 Save-ArchR-Project.rds</span></span><span leaf=""><br></span><span leaf="">saveArchRProject(ArchRProj = proj, load = </span><span><span leaf="">FALSE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 下载再重新加载</span></span><span leaf=""><br></span><span><span leaf=""># proj &lt;- loadArchRProject("./data/VisiumHeart", showLogo = FALSE)</span></span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">作者给的代码还是很丝滑的。下一篇来对 ArchRProject 结构进行解剖~</span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">今天分享到这里，如果对你有帮助，求一键三连！</span></span></p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">转发：</span></span></p></section><ul><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247547917&amp;idx=1&amp;sn=76afb50b6e9e433e3f2b3d039f72dac4&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课2026年1月班" data-itemshowtype="0" linktype="text" data-linktype="2">生信入门&amp;数据挖掘线上直播课2026年1月班</a><span textstyle="">，你的生物信息学入门课</span></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525079&amp;idx=1&amp;sn=0b997af16a58195b4192691373048fd5&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" textvalue="满足你生信分析计算需求的低价解决方案" data-itemshowtype="0" linktype="text" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=1679199708449144836&amp;scene=173&amp;subscene=207&amp;sessionid=1745492310&amp;enterid=1745492314&amp;from_msgid=2247541298&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信故事会" data-itemshowtype="0" linktype="text" data-linktype="2">生信故事会</a>，来看看他们的生信入门故事</span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=3690970204957147140&amp;scene=173&amp;subscene=207&amp;sessionid=1745066271&amp;enterid=1745066274&amp;from_msgid=2247540702&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信马拉松答疑专辑" data-itemshowtype="0" linktype="text" data-linktype="2">生信马拉松答疑专辑</a>，获取你的生信专属答疑</span></section></li></ul><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/Od4TpnoG40_NthmGJfYs3A",target="_blank" rel="noopener noreferrer">原文链接</a>
