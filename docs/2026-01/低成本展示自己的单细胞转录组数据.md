---
title: "低成本展示自己的单细胞转录组数据"
date: 2026-01-18T05:13:41Z
draft: ["false"]
tags: [
  "fetched",
  "生信媛"
]
categories: ["Acdemic"]
---
低成本展示自己的单细胞转录组数据 by 生信媛
------
<div><p data-pm-slice="0 0 []"><span leaf=""> </span></p><section><p><span leaf="">单细胞文章发表之后，</span><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{"style":"font-family: -apple-system-font,BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB , Microsoft YaHei UI , Microsoft YaHei ,Arial,sans-serif;font-size: 16px;line-height: 1.75;text-align: left;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"p","attributes":{"style":"margin: 1.5em 8px;letter-spacing: 0.1em;color: #3f3f3f;margin-top: 0 !important;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>我觉得</span><span leaf="">最好是搭配一个对应的网页方便用户查看数据。毕竟我看到你的文章后，第一个想法可能就是我关注的基因是不是在你的数据集中也有某种特征，而不是我要去数据库上下载你的数据，然后在本地进行处理，最后只为了看个表达量。</span></p><p><span leaf="">因此，我在2019参与发表拟南芥的根的单细胞中就提供了对应网站，当现在已经过去了快6年了，依旧每天都会几个人来看。</span></p><p><span leaf="">目前发表的很多单细胞文章之所以不提供对应的工作，其中一个很大原因，个人推测，就是按照目前现成工具部署到一个能够被访问的公网服务器上，一年下来是要不少钱的。我找了一圈，也就是USCS Cell Browser是低资源的，他处理完之后就是一个静态页面，直接用NGINX托管就行。但是有一个小小的问题，就是他是通过用户的浏览器渲染，当细胞数比较多的时候，可能会有点卡顿。</span></p><p><span leaf="">当然也可能是我调研不够全，还没有找到合适的软件，我借助目前比较强大的人工智能辅助编程，开发了一个新的工具，可以在非常低资源的情况下进行部署，0.1个CPU，128M内存，可能一天不需要1块钱，就能给自己工作增加一个曝光点。</span></p><p><span leaf="">目前项目开源代码在https://github.com/xuzhougeng/atlasmap-sc。</span></p><p><span leaf="">以课题组之前发表的，被我托管在shiny-server的数据为例，目标是统一托管在https://explorer.plantcellatlas.com 。</span></p><p><span leaf="">我有一台比较高性能的服务器，但是域名是固定的，可以被外部请求，也就是http://wanglab.sippe.ac.cn，我们可以将其作为计算中心，负责返回前端静态页面的API请求。</span></p><p><span leaf="">在高性能的服务器上，我们做如下的操作</span></p><p><span leaf="">第一步，克隆项目并安装环境</span></p><pre><span><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" width="45px" height="13px" viewbox="0 0 450 130"><ellipse cx="50" cy="65" rx="50" ry="52" stroke="rgb(220,60,54)" stroke-width="2" fill="rgb(237,108,96)"></ellipse><ellipse cx="225" cy="65" rx="50" ry="52" stroke="rgb(218,151,33)" stroke-width="2" fill="rgb(247,193,81)"></ellipse><ellipse cx="400" cy="65" rx="50" ry="52" stroke="rgb(27,161,37)" stroke-width="2" fill="rgb(100,200,86)"></ellipse></svg></span><code><span leaf="">git</span><span><span leaf=""> clone</span></span><span leaf=""> https://github.com/xuzhougeng/atlasmap-sc.git</span><span><span leaf=""><br></span><span leaf="">cd</span></span><span leaf=""> atlasmap-sc</span><span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""># 配置Python环境</span></span><span><span leaf=""><br></span><span leaf="">cd</span></span><span leaf=""> preprocessing</span><span leaf=""><br></span><span leaf="">uv pip install  .</span><span><span leaf=""><br></span><span leaf="">cd</span></span><span leaf=""> ..</span><span><span leaf=""><br></span><span leaf=""># 配置go环境 </span></span><span><span leaf=""><br></span><span leaf="">cd</span></span><span leaf=""> server</span><span leaf=""><br></span><span leaf="">go build -o bin/server ./cmd/server</span><span leaf=""><br></span><span leaf=""><br></span></code></pre><p><span leaf="">第二步，运行atlasmap-preproces做数据预处理</span></p><pre><span><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" width="45px" height="13px" viewbox="0 0 450 130"><ellipse cx="50" cy="65" rx="50" ry="52" stroke="rgb(220,60,54)" stroke-width="2" fill="rgb(237,108,96)"></ellipse><ellipse cx="225" cy="65" rx="50" ry="52" stroke="rgb(218,151,33)" stroke-width="2" fill="rgb(247,193,81)"></ellipse><ellipse cx="400" cy="65" rx="50" ry="52" stroke="rgb(27,161,37)" stroke-width="2" fill="rgb(100,200,86)"></ellipse></svg></span><code><span leaf="">uv run atlasmap-preprocess run -i rootatlas.h5ad -o data/ath_root -a -z 11 </span><span leaf=""><br></span><span leaf="">uv run atlasmap-preprocess run -i shootatlas.h5ad -o data/ath_shoot -a -z 11 </span><span leaf=""><br></span><span leaf="">uv run atlasmap-preprocess run -i marchantia_census.h5ad -o data/mp_census -a -z 11 </span><span leaf=""><br></span></code></pre><p><span leaf="">第三步，配置data/sever.yaml</span></p><pre><span><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" width="45px" height="13px" viewbox="0 0 450 130"><ellipse cx="50" cy="65" rx="50" ry="52" stroke="rgb(220,60,54)" stroke-width="2" fill="rgb(237,108,96)"></ellipse><ellipse cx="225" cy="65" rx="50" ry="52" stroke="rgb(218,151,33)" stroke-width="2" fill="rgb(247,193,81)"></ellipse><ellipse cx="400" cy="65" rx="50" ry="52" stroke="rgb(27,161,37)" stroke-width="2" fill="rgb(100,200,86)"></ellipse></svg></span><code><span><span leaf="">server:</span></span><span><span leaf=""><br></span><span leaf="">  port:</span></span><span><span leaf=""> 8080</span></span><span><span leaf=""> </span><span leaf=""><br></span><span leaf="">  cors_origins:</span></span><span><span leaf=""><br></span><span leaf="">    -</span></span><span><span leaf=""> "http://localhost:3000"</span></span><span><span leaf=""><br></span><span leaf="">    -</span></span><span><span leaf=""> "http://localhost:5173"</span></span><span><span leaf=""><br></span><span leaf="">  # Custom title displayed in the header (optional, defaults to "SOMA-Tiles")</span></span><span><span leaf=""><br></span><span leaf="">  title:</span></span><span><span leaf=""> "Cell 1K"</span></span><span><span leaf=""><br></span><span leaf=""># Multi-dataset format:</span></span><span><span leaf=""><br></span><span leaf="">data:</span></span><span><span leaf=""><br></span><span leaf="">  ath_root:</span></span><span><span leaf=""><br></span><span leaf="">    zarr_path:</span></span><span><span leaf=""> "data/ath_root/zarr/bins.zarr"</span></span><span><span leaf=""><br></span><span leaf="">  ath_shoot:</span></span><span><span leaf=""><br></span><span leaf="">    zarr_path:</span></span><span><span leaf=""> "data/ath_shoot/zarr/bins.zarr"</span></span><span><span leaf=""><br></span><span leaf="">  mp_census:</span></span><span><span leaf=""><br></span><span leaf="">    zarr_path:</span></span><span><span leaf=""> "data/mp_census/zarr/bins.zarr"</span></span><span><span leaf=""><br></span><span leaf="">cache:</span></span><span><span leaf=""><br></span><span leaf="">  tile_size_mb:</span></span><span><span leaf=""> 512</span></span><span><span leaf=""><br></span><span leaf="">  tile_ttl_minutes:</span></span><span><span leaf=""> 10</span></span><span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">render:</span></span><span><span leaf=""><br></span><span leaf="">  tile_size:</span></span><span><span leaf=""> 256</span></span><span><span leaf=""><br></span><span leaf="">  default_colormap:</span></span><span><span leaf=""> viridis</span></span><span leaf=""><br></span></code></pre><p><span leaf="">启动后台</span></p><pre><span><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" width="45px" height="13px" viewbox="0 0 450 130"><ellipse cx="50" cy="65" rx="50" ry="52" stroke="rgb(220,60,54)" stroke-width="2" fill="rgb(237,108,96)"></ellipse><ellipse cx="225" cy="65" rx="50" ry="52" stroke="rgb(218,151,33)" stroke-width="2" fill="rgb(247,193,81)"></ellipse><ellipse cx="400" cy="65" rx="50" ry="52" stroke="rgb(27,161,37)" stroke-width="2" fill="rgb(100,200,86)"></ellipse></svg></span><code><span leaf="">server/bin/server -config</span><span><span leaf=""> "data/server.yaml"</span></span></code></pre><p><span leaf="">第四步，配置后台的nginx，将前端请求反向代理到前端的到go服务器上，并用</span><code><span leaf="">ngins -s reload</span></code><span leaf="">重新加载</span></p><pre><span><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" width="45px" height="13px" viewbox="0 0 450 130"><ellipse cx="50" cy="65" rx="50" ry="52" stroke="rgb(220,60,54)" stroke-width="2" fill="rgb(237,108,96)"></ellipse><ellipse cx="225" cy="65" rx="50" ry="52" stroke="rgb(218,151,33)" stroke-width="2" fill="rgb(247,193,81)"></ellipse><ellipse cx="400" cy="65" rx="50" ry="52" stroke="rgb(27,161,37)" stroke-width="2" fill="rgb(100,200,86)"></ellipse></svg></span><code><span><span leaf="">server</span></span><span leaf=""> {</span><span><span leaf=""><br></span><span leaf="">    # .... other</span></span><span><span leaf=""><br></span><span leaf="">    # /api (no trailing slash) -&gt; /api/</span></span><span><span leaf=""><br></span><span leaf="">    location</span></span><span leaf=""> = /api {</span><span><span leaf=""> return</span></span><span><span leaf=""> 301</span></span><span leaf=""> /api/; }</span><span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">    location</span></span><span leaf=""> /api/ {</span><span><span leaf=""><br></span><span leaf="">        proxy_pass</span></span><span leaf=""> http://127.0.0.1:8080/api/;</span><span><span leaf=""><br></span><span leaf="">        proxy_set_header</span></span><span leaf=""> Host</span><span><span leaf=""> $host</span></span><span leaf="">;</span><span><span leaf=""><br></span><span leaf="">        proxy_set_header</span></span><span leaf=""> X-Real-IP</span><span><span leaf=""> $remote_addr</span></span><span leaf="">;</span><span><span leaf=""><br></span><span leaf="">        proxy_set_header</span></span><span leaf=""> X-Forwarded-For</span><span><span leaf=""> $proxy_add_x_forwarded_for</span></span><span leaf="">;</span><span><span leaf=""><br></span><span leaf="">        proxy_set_header</span></span><span leaf=""> X-Forwarded-Proto</span><span><span leaf=""> $scheme</span></span><span leaf="">;</span><span><span leaf=""><br></span><span leaf="">        proxy_read_timeout</span></span><span><span leaf=""> 300s</span></span><span leaf="">;</span><span leaf=""><br></span><span leaf="">    }</span><span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">    # /d (no trailing slash) -&gt; /d/</span></span><span><span leaf=""><br></span><span leaf="">    location</span></span><span leaf=""> = /d {</span><span><span leaf=""> return</span></span><span><span leaf=""> 301</span></span><span leaf=""> /d/; }</span><span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">    location</span></span><span leaf=""> /d/ {</span><span><span leaf=""><br></span><span leaf="">        proxy_pass</span></span><span leaf=""> http://127.0.0.1:8080/d/;</span><span><span leaf=""><br></span><span leaf="">        proxy_set_header</span></span><span leaf=""> Host</span><span><span leaf=""> $host</span></span><span leaf="">;</span><span><span leaf=""><br></span><span leaf="">        proxy_set_header</span></span><span leaf=""> X-Real-IP</span><span><span leaf=""> $remote_addr</span></span><span leaf="">;</span><span><span leaf=""><br></span><span leaf="">        proxy_set_header</span></span><span leaf=""> X-Forwarded-For</span><span><span leaf=""> $proxy_add_x_forwarded_for</span></span><span leaf="">;</span><span><span leaf=""><br></span><span leaf="">        proxy_set_header</span></span><span leaf=""> X-Forwarded-Proto</span><span><span leaf=""> $scheme</span></span><span leaf="">;</span><span><span leaf=""><br></span><span leaf="">        proxy_read_timeout</span></span><span><span leaf=""> 300s</span></span><span leaf="">;</span><span leaf=""><br></span><span leaf="">    }</span><span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">    # 可选：健康检查直通</span></span><span><span leaf=""><br></span><span leaf="">    location</span></span><span leaf=""> /health {</span><span><span leaf=""><br></span><span leaf="">        proxy_pass</span></span><span leaf=""> http://127.0.0.1:8080/health;</span><span leaf=""><br></span><span leaf="">    }</span><span><span leaf=""><br></span><span leaf="">    # ... other</span></span><span leaf=""><br></span><span leaf="">}</span></code></pre><p><span leaf="">配置前端：</span></p><p><span leaf="">我用的是环界云https://cloud.sealos.io/提供谷歌云，直接用配置好的镜像：</span><code><span leaf="">hoptoper/atlasmap-frontend:latest</span></code><span leaf="">， 最低配置，一天不到5毛钱。</span></p></section><section nodeleaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/I101ibe9h7rNrPclXLqtvKnY4VEKpNcWvLKYSOTcX4vbW9CcUVbg8QZCz4KTBib1vlYkibnXFY5CnCDIibxjgAzoibA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7407407407407407" data-s="300,640" data-type="png" data-w="1080" type="block" data-imgfileid="100007984" data-aistatus="1" src="https://mmbiz.qpic.cn/sz_mmbiz_png/I101ibe9h7rNrPclXLqtvKnY4VEKpNcWvLKYSOTcX4vbW9CcUVbg8QZCz4KTBib1vlYkibnXFY5CnCDIibxjgAzoibA/640?wx_fmt=png&amp;from=appmsg"></section><section><p><span leaf="">通过CNAME的方式实现自定义域名（这个域名是要付费购买的）</span></p></section><section nodeleaf=""><img data-aistatus="1" data-imgfileid="100007985" data-ratio="0.3086705202312139" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/I101ibe9h7rNrPclXLqtvKnY4VEKpNcWvUFlv0z4WpFY0qW5aYqd0eaREUG9MGwCEqkdnjiamkRKQTZCvMclNtlw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="865" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/I101ibe9h7rNrPclXLqtvKnY4VEKpNcWvUFlv0z4WpFY0qW5aYqd0eaREUG9MGwCEqkdnjiamkRKQTZCvMclNtlw/640?wx_fmt=png&amp;from=appmsg"></section><section><p><span leaf="">保存的时候，提示你应该如何到域名服务上设置CNAME解析，这里面的值就是你需要复制过去的。</span></p><figure><span leaf=""><br></span><section nodeleaf=""><img data-aistatus="1" data-imgfileid="100007986" data-ratio="0.8086854460093896" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/I101ibe9h7rNrPclXLqtvKnY4VEKpNcWvyj4de4dXGQYTjbo1iaHlOydJQtI5OtTZ3V1PY8jobDyvbYAdKYK7BrQ/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="852" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/I101ibe9h7rNrPclXLqtvKnY4VEKpNcWvyj4de4dXGQYTjbo1iaHlOydJQtI5OtTZ3V1PY8jobDyvbYAdKYK7BrQ/640?wx_fmt=png&amp;from=appmsg"></section><figcaption><span leaf=""><br></span></figcaption></figure><p><span leaf="">高级配置中，设置环境变量 BACKEND_HOST， BACKEND_PORT, 对应后台服务器NGINX配置的server_name 和listen。比如说我的</span><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{"style":"font-family: -apple-system-font,BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB , Microsoft YaHei UI , Microsoft YaHei ,Arial,sans-serif;font-size: 16px;line-height: 1.75;text-align: left;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"p","attributes":{"style":"margin: 1.5em 8px;letter-spacing: 0.1em;color: #3f3f3f;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>BACKEND_HOST应该是设置成wanglab.sippe.ac.cn, </span><span leaf="" data-pm-slice='1 1 ["para",{"tagName":"section","attributes":{"style":"font-family: -apple-system-font,BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB , Microsoft YaHei UI , Microsoft YaHei ,Arial,sans-serif;font-size: 16px;line-height: 1.75;text-align: left;"},"namespaceURI":"http://www.w3.org/1999/xhtml"},"para",{"tagName":"p","attributes":{"style":"margin: 1.5em 8px;letter-spacing: 0.1em;color: #3f3f3f;"},"namespaceURI":"http://www.w3.org/1999/xhtml"}]'>BACKEND_PORT设置成80.</span></p><section nodeleaf=""><img data-aistatus="1" data-imgfileid="100007988" data-ratio="0.625" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/I101ibe9h7rNrPclXLqtvKnY4VEKpNcWvxa3QmDu7eMFGHOtqu1B9p0KChXCrgTcWag2wxEeNZw9QRia4VSZvn3Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_png/I101ibe9h7rNrPclXLqtvKnY4VEKpNcWvxa3QmDu7eMFGHOtqu1B9p0KChXCrgTcWag2wxEeNZw9QRia4VSZvn3Q/640?wx_fmt=png&amp;from=appmsg"></section><figcaption><span leaf=""><br></span></figcaption><p><span leaf=""><br></span></p><p><span leaf="">启动等待一会就可以了，就可以通过域名https://explorer.plantcellatlas.com/访问了，终于实现了我的单细胞数据统一化展示了。</span></p></section><p><span leaf=""> </span></p><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/a9R-omQk74gv58UoBNsESA",target="_blank" rel="noopener noreferrer">原文链接</a>
