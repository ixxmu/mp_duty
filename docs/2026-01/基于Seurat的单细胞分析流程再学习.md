---
title: "基于Seurat的单细胞分析流程再学习"
date: 2026-01-07T23:28:39Z
draft: ["false"]
tags: [
  "fetched",
  "单细胞天地"
]
categories: ["Acdemic"]
---
基于Seurat的单细胞分析流程再学习 by 单细胞天地
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf="">在Seurat官方的PBMC-3k示例数据分析流程中，系统地展示了单细胞转录组分析的标准流程。其中主要内容包括：1.创建Seurat对象；2.数据预处理：质控(选择细胞/基因进行后续分析)；3.数据归一化；4.高变基因鉴定；5.数据标准化；6.执行线性降维；7.确定数据集的“维度”；8.细胞聚类；9.运行非线性降维；10.寻找差异表达基因(“簇生物标志物”)；11.细胞注释。</span></p><h4 data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><span></span><span><span leaf="">官方示例数据的经典核心代码如下：</span></span><span></span></h4><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 数据读取</span></span><span leaf=""><br></span><span leaf="">pbmc.data &lt;- Read10X(data.dir = </span><span><span leaf="">"/brahms/mollag/practice/filtered_gene_bc_matrices/hg19/"</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 创建Seurat对象</span></span><span leaf=""><br></span><span leaf="">pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = </span><span><span leaf="">"pbmc3k"</span></span><span leaf="">, min.cells = </span><span><span leaf="">3</span></span><span leaf="">, min.features = </span><span><span leaf="">200</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 质控</span></span><span leaf=""><br></span><span leaf="">pbmc &lt;- subset(pbmc, subset = nFeature_RNA &gt; </span><span><span leaf="">200</span></span><span leaf=""> &amp; nFeature_RNA &lt; </span><span><span leaf="">2500</span></span><span leaf=""> &amp; percent.mt &lt; </span><span><span leaf="">5</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 归一化</span></span><span leaf=""><br></span><span leaf="">pbmc &lt;- NormalizeData(pbmc, normalization.method = </span><span><span leaf="">"LogNormalize"</span></span><span leaf="">, scale.factor = </span><span><span leaf="">10000</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 找高变</span></span><span leaf=""><br></span><span leaf="">pbmc &lt;- FindVariableFeatures(object = pbmc)</span><span leaf=""><br></span><span><span leaf=""># 标准化</span></span><span leaf=""><br></span><span leaf="">pbmc &lt;- ScaleData(object = pbmc)</span><span leaf=""><br></span><span><span leaf=""># 线性降维</span></span><span leaf=""><br></span><span leaf="">pbmc &lt;- RunPCA(object = pbmc)</span><span leaf=""><br></span><span><span leaf=""># 确定维度</span></span><span leaf=""><br></span><span leaf="">ElbowPlot(pbmc)</span><span leaf=""><br></span><span><span leaf=""># 细胞聚类</span></span><span leaf=""><br></span><span leaf="">pbmc &lt;- FindNeighbors(object = pbmc, dims = </span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">30</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">pbmc &lt;- FindClusters(object = pbmc)</span><span leaf=""><br></span><span><span leaf=""># 非线性降维</span></span><span leaf=""><br></span><span leaf="">pbmc &lt;- RunUMAP(object = pbmc, dims =</span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">30</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 差异分析</span></span><span leaf=""><br></span><span leaf="">pbmc.markers &lt;- FindAllMarkers(pbmc, only.pos = </span><span><span leaf="">TRUE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">pbmc.markers %&gt;%</span><span leaf=""><br></span><span leaf="">    group_by(cluster) %&gt;%</span><span leaf=""><br></span><span leaf="">    dplyr::filter(avg_log2FC &gt; </span><span><span leaf="">1</span></span><span leaf="">)</span><span leaf=""><br></span><span><span leaf=""># 细胞注释</span></span><span leaf=""><br></span><span leaf="">new.cluster.ids &lt;- c(</span><span><span leaf="">"Naive CD4 T"</span></span><span leaf="">, </span><span><span leaf="">"CD14+ Mono"</span></span><span leaf="">, </span><span><span leaf="">"Memory CD4 T"</span></span><span leaf="">, </span><span><span leaf="">"B"</span></span><span leaf="">, </span><span><span leaf="">"CD8 T"</span></span><span leaf="">, </span><span><span leaf="">"FCGR3A+ Mono"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">"NK"</span></span><span leaf="">, </span><span><span leaf="">"DC"</span></span><span leaf="">, </span><span><span leaf="">"Platelet"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">names(new.cluster.ids) &lt;- levels(pbmc)</span><span leaf=""><br></span><span leaf="">pbmc &lt;- RenameIdents(pbmc, new.cluster.ids)</span><span leaf=""><br></span><span leaf="">DimPlot(pbmc, reduction = </span><span><span leaf="">"umap"</span></span><span leaf="">, label = </span><span><span leaf="">TRUE</span></span><span leaf="">, pt.size = </span><span><span leaf="">0.5</span></span><span leaf="">) + NoLegend()</span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">1.创建Seurat对象</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">目前最常见的数据仍为10Xgenomics数据，通过Cellranger上游分析之后会输出标准10X格式的三文件数据，这个时候就需要使用Read10X函数对数据进行读取，此外，还有h5格式的单文件数据，如果选择这个格式的数据就使用Read10X_h5函数进行读取。</span></p><p data-tool="mdnice编辑器"><span leaf="">读取完数据之后就需要创建Seurat对象，创建对象使用的函数是CreatSeuratObject，其中关键的参数为min.cells和min.features。min.cells规定基因的表达范围，即单个基因至少在多少细胞中表达才能保留；</span><strong><span leaf=""><span textstyle="">min.features规定细胞表达的基因数范围，即单个细胞中至少表达多少个基因方可保留。换句话说，min.cells是用于过滤基因，min.features是用于过滤细胞。</span></span></strong></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = </span><span><span leaf="">"pbmc3k"</span></span><span leaf="">, min.cells = </span><span><span leaf="">3</span></span><span leaf="">, min.features = </span><span><span leaf="">200</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><strong><span leaf=""><span textstyle="">注：在这个环节中，关于min.cells和min.features的值没有明确的标准。但目前最常用的组合似乎是 min.cells = 3, min.features = 200或者 min.cells = 5, min.features = 500。</span></span></strong></p><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">2.数据预处理：质控(选择细胞/基因进行后续分析)</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">质量控制的作用是帮助研究者过滤低质量的数据，目前常用的一些质控指标是：</span></p><ol><li><section><span leaf="">每个细胞中检测到的基因数量：1）低质量细胞或空液滴通常只有很少的基因；2）双或者多细胞则可能表现出异常高的基因。</span></section></li><li><section><span leaf="">细胞内检测到的分子总数 (与独特基因密切相关)；</span></section></li><li><section><span leaf="">线粒体基因的百分比：1）低质量/濒死的细胞常出现广泛的线粒体污染；2）MT-开头的所有基因作为线粒体基因集.</span></section></li></ol><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pbmc &lt;- subset(pbmc, subset = nFeature_RNA &gt; </span><span><span leaf="">200</span></span><span leaf=""> &amp; nFeature_RNA &lt; </span><span><span leaf="">2500</span></span><span leaf=""> &amp; percent.mt &lt; </span><span><span leaf="">5</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">以下是官方PBMC数据构成的小提琴图，在示例数据中，开发人员保留了nFeature_RNA大于200和小于2500的细胞，以及保留了线粒体小于5%的细胞。<img data-aistatus="1" data-imgfileid="100051223" data-ratio="0.5287037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwticrWgAuvM0cE9xKdxjo3IbwLC30SlD5PASC2ibKcFibiclx9vGTicuicCZw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwticrWgAuvM0cE9xKdxjo3IbwLC30SlD5PASC2ibKcFibiclx9vGTicuicCZw/640?wx_fmt=png&amp;from=appmsg"></span><strong><span leaf=""><span textstyle="">注：这个环节中nFeature和nCount还有线粒体比例的过滤参数是没有明确的标准，那么就需要遵循“相对准则”。具体来说，比如关于线粒体基因的百分比，大多数组织中过高的线粒体百分比就是代表了污染，那么就需要进行过滤。此外nFeature和nCount的值也是类似的准则。如果实在没主见，那就可以搜研究领域内的几篇文献综合考虑阈值即可。总之，过滤这个步骤不应纠结。</span></span></strong></p><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.数据归一化</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">过滤数据集中的不需要细胞后，下一步是进行数据归一化。默认情况下，采用全局缩放标准化方法“LogNormalize”，该方法通过总表达量对每个细胞的特征表达测量值进行标准化，将结果乘以一个缩放因子（默认为 10,000），并对结果进行对数转换。在 Seurat v5中，标准化后的值存储在 pbmc[["RNA"]]$data 中。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pbmc &lt;- NormalizeData(pbmc, normalization.method = </span><span><span leaf="">"LogNormalize"</span></span><span leaf="">, scale.factor = </span><span><span leaf="">10000</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">关于NormalizeData和ScaleData的中文定义常会被混淆，到底哪个是“标准化”，哪个是“归一化”？在这个问题上可以借助一下大模型的帮助。<img data-aistatus="1" data-imgfileid="100051220" data-ratio="0.5916666666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwicJNYPzv4sxB50ibsDS42H0oGZHiccdGuHor4Nue2aaJ3IZQcicVDq7ZxA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwicJNYPzv4sxB50ibsDS42H0oGZHiccdGuHor4Nue2aaJ3IZQcicVDq7ZxA/640?wx_fmt=png&amp;from=appmsg"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwZFguSSsicwonrbrLNfyehDF6QeQQia3gPkiafGERvgzLpbianWsB7fNlzQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.7962962962962963" data-type="png" data-w="1080" data-imgfileid="100051222" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwZFguSSsicwonrbrLNfyehDF6QeQQia3gPkiafGERvgzLpbianWsB7fNlzQ/640?wx_fmt=png&amp;from=appmsg"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwceaMCibiclgD0Jks690GnCX7u5sfuEN8UbIUauUxwpocEnq3LDAt9IZg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8574074074074074" data-type="png" data-w="1080" data-imgfileid="100051221" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwceaMCibiclgD0Jks690GnCX7u5sfuEN8UbIUauUxwpocEnq3LDAt9IZg/640?wx_fmt=png&amp;from=appmsg"><img data-aistatus="1" data-imgfileid="100051219" data-ratio="0.45740740740740743" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwUl5xrjKia32khuguYEFt3soJVol8BsAwicSYibXhW7Bv8kOwBvEmibRQcw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwUl5xrjKia32khuguYEFt3soJVol8BsAwicSYibXhW7Bv8kOwBvEmibRQcw/640?wx_fmt=png&amp;from=appmsg">总结：归一化是指调整数据的尺度或总量，不要求均值为0方差为1，在单细胞分析中是让测序深度和文库大小不同的细胞的基因表达量具有可比性。标准化是将每个基因在所有细胞中的均值变为0，方差为1，赋予每个基因在下游分析中同样的权重，不至于使高表达基因占据主导地位。</span></p><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">4.高变基因鉴定</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">接着在数据集中筛选一部分在细胞之间变异度较高的特征（即这些基因在部分细胞中高表达，而在另一些细胞中低表达）。许多研究发现，在后续分析中聚焦这些基因，有助于突出单细胞数据中的生物学信号。</span></p><p data-tool="mdnice编辑器"><span leaf="">在Seurat中，这一过程有详细的实现说明。与早期版本相比，该方法通过直接建模单细胞数据中固有的均值–方差关系进行了改进，并由FindVariableFeatures函数实现。默认情况下，每个数据集会返回2,000个特征，这些特征将用于后续分析，例如PCA。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pbmc &lt;- FindVariableFeatures(object = pbmc)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">PBMC示例数据中展示的内容：<img data-aistatus="1" data-imgfileid="100051228" data-ratio="0.5222222222222223" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwiaAibGDfYxzuphskIUibN7dPv6A8a0908VhLRpVdaVpNicLKaZL0shibccg/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwiaAibGDfYxzuphskIUibN7dPv6A8a0908VhLRpVdaVpNicLKaZL0shibccg/640?wx_fmt=png&amp;from=appmsg">在近期的单细胞空转课程中，我们在所选的示例数据中发现，SPP1是位列前十的高变基因之一，而它本身也是当前研究中备受关注的明星分子。虽然大多时候我们并不关注这2000个高变分子，但有时候多扫几眼可能会有意外发现。<img data-aistatus="1" data-imgfileid="100051227" data-ratio="0.4222222222222222" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwsWYoHTlQV2FqdULKykQ0EdISGic8WXElW5tjz7B7mSyKicdZCmjo4sSA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwsWYoHTlQV2FqdULKykQ0EdISGic8WXElW5tjz7B7mSyKicdZCmjo4sSA/640?wx_fmt=png&amp;from=appmsg"></span></p><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">5.数据标准化</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">接下来，再对数据进行线性变换（即缩放，scaling），这是在进行PCA等降维分析之前的标准预处理步骤。ScaleData函数会对每个基因的表达值进行中心化，使其在所有细胞中的平均值为 0，并进一步进行标准化，使其在细胞间的方差为 1，从而保证各基因在后续分析中具有相同的权重，避免高表达基因对分析结果产生主导影响。处理后的数据存储在pbmc[["RNA"]]$scale.data 中。默认情况下，仅对高变基因进行缩放，但也可以通过指定features参数对其他基因进行缩放处理。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pbmc &lt;- ScaleData(object = pbmc)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 自定义基因</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mjzu8qng-8lcrrn" data-topic="1">#all</a>.genes &lt;- rownames(pbmc)</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mjzu8qng-f42ai4" data-topic="1">#pbmc</a> &lt;- ScaleData(pbmc, features = all.genes)</span></span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><strong><span leaf=""><span textstyle="">注：通常就选择高变基因进行标准化即可，标准化后数据会生成新的数据，需要强调的是这个步骤不会覆盖counts数据，并且标准化数据是在归一化数据的基础之上。</span></span></strong></p><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">6.执行线性降维</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">接下来在经过缩放处理的数据上进行主成分分析（PCA）。默认情况下，PCA仅使用前一步筛选得到的高变基因作为输入；如果希望使用其他基因子集，可以通过features参数进行指定（需要注意的是，若使用自定义基因集合，需先在ScaleData步骤中对这些基因进行缩放处理）。</span></p><p data-tool="mdnice编辑器"><span leaf="">PCA线性降维：简单来说是把复杂的特征投影到几个“主要成分”上去；</span><strong><span leaf=""><span textstyle="">这点也很好理解，因为单细胞数据量太大了，如果全部纳入进去分析可能会很消耗计算资源，其次技术噪音可能会掩盖生物学差异。后续分析的时候也只需要纳入足够代表差异的主成分即可</span></span></strong><span leaf=""><span textstyle="">。</span></span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pbmc &lt;- RunPCA(object = pbmc)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(object = pbmc))</span></span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">7.确定数据集的“维度”</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">接下来需要找到合适的数据集的“维度”，挑选合适的能够代表数据集差异的PCA数量纳入后续分析，官方推荐是肘部图，肘部法在单细胞分析文献中最常用于确定主成分的数量。它从一个散点图开始，其中y轴显示主成分的标准差，x轴显示主成分的数量。由于主成分按标准差递减排序，散点图通常呈现单调递减的曲线，在最初几个主成分时急剧下降，在后续主成分时逐渐趋于平缓。接着通过视觉识别曲线从陡峭下降转变为平缓下降的拐点来确定最佳主成分数量。在这张图上的话其实并没有那么清晰，可能就在15-20左右。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">ElbowPlot(pbmc)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf=""><img data-aistatus="1" data-imgfileid="100051224" data-ratio="0.5972222222222222" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwHibt8cvyqY3ibXwmGHX3tS76Mh0y3ia5fmcuFR5z2Xr92Hf98ApwwHBzw/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwHibt8cvyqY3ibXwmGHX3tS76Mh0y3ia5fmcuFR5z2Xr92Hf98ApwwHBzw/640?wx_fmt=png&amp;from=appmsg">注：官网中提到PBMC数据中PC12和PC13中富集的基因（如MZB1）实际上对应浆细胞样树突状细胞等稀有亚群，但由于这些群体占比极低，在缺乏先验知识的情况下，很难将其与背景噪声区分开。因此，鼓励用户尝试不同数量的主成分（如10、15，甚至50）重复下游分析，</span><strong><span leaf=""><span textstyle="">但通常结果不会发生显著变化。同时建议在选择该参数时宁可偏高勿低，因为若仅使用前5个主成分，将显著且不利地影响分析结果</span></span></strong><span leaf=""><span textstyle="">。</span></span></p><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">8.细胞聚类</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">Seurat采用了一种基于图的聚类方法，该方法在Macosko等人最初策略的基础上进行了显著改进。值得注意的是，驱动聚类分析的距离度量（基于先前确定的主成分）保持不变，但将细胞距离矩阵划分为簇的方式已大幅优化。这些方法的核心思想是将细胞嵌入图结构中——例如构建一个K近邻（KNN）图，其中表达模式相似的细胞之间通过边连接，随后将该图划分为高度互连的“准团”（quasi-cliques）或“社区”（communities）。与PhenoGraph 类似，Seurat首先在PCA空间中基于欧氏距离构建KNN图，并进一步根据两个细胞局部邻域的共享重叠程度（即Jaccard 相似度）调整它们之间的边权重；这一步通过 FindNeighbors函数实现，需输入此前确定的数据维度（如前10个主成分）。接着，为对细胞进行聚类，Seurat默认采用Louvain算法（也可选择 SLM 算法），通过迭代优化标准模块度函数，将细胞逐步归并为社区。该过程由 FindClusters函数执行，其中包含一个“分辨率”参数，用于控制聚类结果的精细程度：值越大，产生的簇数量越多。研究团队发现，</span><strong><span leaf=""><span textstyle="">对于约3000个细胞的单细胞数据集，将该参数设在0.4–1.2之间通常效果良好；而对于更大规模的数据集，最优分辨率往往需要相应提高。最终的聚类结果可通过Idents函数获取</span></span></strong><span leaf=""><span textstyle="">。</span></span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pbmc &lt;- FindNeighbors(object = pbmc, dims = </span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">30</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">pbmc &lt;- FindClusters(object = pbmc)</span><span leaf=""><br></span></code></pre><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">9.运行非线性降维</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">非线性降维可以直接将高维空间的结构特征投影到低维空间（二维或三维）中，也就是用平面或立体空间内的点的疏密远近表现其在原本多维度状态下的疏密远近。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">pbmc &lt;- RunUMAP(object = pbmc, dims =</span><span><span leaf="">1</span></span><span leaf="">:</span><span><span leaf="">30</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">注：这个步骤通俗来说是把高维度数据降维之后更好的展示出来。</span></p><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">10.寻找差异表达基因(“簇生物标志物”)</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">官方教程中推荐使用FindAllmarkers函数进行差异分析，这种差异分析方法是使用Wilcoxon秩和检验进行差异分析。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 差异分析</span></span><span leaf=""><br></span><span leaf="">pbmc.markers &lt;- FindAllMarkers(pbmc, only.pos = </span><span><span leaf="">TRUE</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">pbmc.markers %&gt;%</span><span leaf=""><br></span><span leaf="">    group_by(cluster) %&gt;%</span><span leaf=""><br></span><span leaf="">    dplyr::filter(avg_log2FC &gt; </span><span><span leaf="">1</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">在最近的单细胞空转课程中，生信小博士老师对差异分析内容进行了细致的小结：<img data-aistatus="1" data-imgfileid="100051225" data-ratio="0.4601851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbw65dBZfpDIvWK656jM3SiclWMBpzM7ibMmbhwVHoZdjZ5uXAg8V9cG4ww/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbw65dBZfpDIvWK656jM3SiclWMBpzM7ibMmbhwVHoZdjZ5uXAg8V9cG4ww/640?wx_fmt=png&amp;from=appmsg"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbw9gMvoNCJ36I6qG9vUVOzjuQrH0zZFr3NCkQs8sGiceXRgRGulb4Q47Q/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.41203703703703703" data-type="png" data-w="1080" data-imgfileid="100051226" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbw9gMvoNCJ36I6qG9vUVOzjuQrH0zZFr3NCkQs8sGiceXRgRGulb4Q47Q/640?wx_fmt=png&amp;from=appmsg"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbw6JQlQG6Cvias4fXr4UqeYxfPhLznV0rKx35X8LmphFRXOZOMz665wbA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.31574074074074077" data-type="png" data-w="1080" data-imgfileid="100051232" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbw6JQlQG6Cvias4fXr4UqeYxfPhLznV0rKx35X8LmphFRXOZOMz665wbA/640?wx_fmt=png&amp;from=appmsg"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwv6QyHHnviauVjcCLRduMEngEnNELiaMjaHFECKwxYlRCZ4lOV2NRqibPQ/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5342592592592592" data-type="png" data-w="1080" data-imgfileid="100051231" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwv6QyHHnviauVjcCLRduMEngEnNELiaMjaHFECKwxYlRCZ4lOV2NRqibPQ/640?wx_fmt=png&amp;from=appmsg"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwgsXlHaLwhCkEHHCEL3DBGRZ68efflsvLqribnHEVWhic50fPMx86XI8g/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.45740740740740743" data-type="png" data-w="1080" data-imgfileid="100051233" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwgsXlHaLwhCkEHHCEL3DBGRZ68efflsvLqribnHEVWhic50fPMx86XI8g/640?wx_fmt=png&amp;from=appmsg"></span></p><h5 data-tool="mdnice编辑器"><span></span><span><span leaf="">11.细胞注释</span></span><span></span></h5><p data-tool="mdnice编辑器"><span leaf="">细胞注释应该是单细胞流程分析中最耗费精力的步骤，下面的命名是最终的一个环节。</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 细胞注释</span></span><span leaf=""><br></span><span leaf="">new.cluster.ids &lt;- c(</span><span><span leaf="">"Naive CD4 T"</span></span><span leaf="">, </span><span><span leaf="">"CD14+ Mono"</span></span><span leaf="">, </span><span><span leaf="">"Memory CD4 T"</span></span><span leaf="">, </span><span><span leaf="">"B"</span></span><span leaf="">, </span><span><span leaf="">"CD8 T"</span></span><span leaf="">, </span><span><span leaf="">"FCGR3A+ Mono"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">"NK"</span></span><span leaf="">, </span><span><span leaf="">"DC"</span></span><span leaf="">, </span><span><span leaf="">"Platelet"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">names(new.cluster.ids) &lt;- levels(pbmc)</span><span leaf=""><br></span><span leaf="">pbmc &lt;- RenameIdents(pbmc, new.cluster.ids)</span><span leaf=""><br></span><span leaf="">DimPlot(pbmc, reduction = </span><span><span leaf="">"umap"</span></span><span leaf="">, label = </span><span><span leaf="">TRUE</span></span><span leaf="">, pt.size = </span><span><span leaf="">0.5</span></span><span leaf="">) + NoLegend()</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">在具体命名之前，细胞注释还需要更多的工作，我们的生信小博士老师也对细胞注释内容进行了细致的小结，其中还整理了多种细胞注释的方法。<img data-aistatus="1" data-imgfileid="100051230" data-ratio="0.4898148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwnPAkTfWoULE6DvX0B0gqXYJorM2IzsLDvyJ2ibezickbwMUFvicngQBRA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwnPAkTfWoULE6DvX0B0gqXYJorM2IzsLDvyJ2ibezickbwMUFvicngQBRA/640?wx_fmt=png&amp;from=appmsg"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwoIYdvczShrnMCWXnLr07icd0FMhlmm6sMbIgpt2FRgDvmzmb6cPAhbA/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.42777777777777776" data-type="png" data-w="1080" data-imgfileid="100051229" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwoIYdvczShrnMCWXnLr07icd0FMhlmm6sMbIgpt2FRgDvmzmb6cPAhbA/640?wx_fmt=png&amp;from=appmsg">细胞亚群注释流程：<img data-src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwFYKgicKquYmkMNGAxMGT78NQKFQmNxbN3G5r9vAA1wUs5icxOPv7ibtAg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.5962962962962963" data-type="png" data-w="1080" data-imgfileid="100051238" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/siaia0BDGJdjQibY3d0reERlxPkPfiaL8qbwFYKgicKquYmkMNGAxMGT78NQKFQmNxbN3G5r9vAA1wUs5icxOPv7ibtAg/640?wx_fmt=png&amp;from=appmsg"></span></p><h4 data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><span></span><span><span leaf="">参考资料：</span></span><span></span></h4><ol><li><section><span leaf="">Seurat：https://satijalab.org/seurat/articles/sctransform_vignette</span></section></li><li><section><span leaf="">单细胞空转课程 （生信技能树团队）</span></section></li></ol></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/_HvPWZOusb3tq151Eqfs0g",target="_blank" rel="noopener noreferrer">原文链接</a>
