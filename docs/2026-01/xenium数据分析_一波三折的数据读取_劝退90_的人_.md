---
title: "xenium数据分析：一波三折的数据读取，劝退90%的人！"
date: 2026-01-18T15:51:05Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Acdemic"]
---
xenium数据分析：一波三折的数据读取，劝退90%的人！ by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><blockquote><p><span leaf="">最近在学习 空间高精度的数据分析，然后搜了一下网上的各种资料，发现10x官网 搞了一个github来存放他们给的所有教程，让大家去学习！今天先来学习一下下游的基础分析~</span></p><p><span leaf=""><br></span></p><p><span leaf="">10x给的教程地址：https://github.com/10XGenomics/analysis_guides</span></p></blockquote><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">Xenium的数据分析流程</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">总的来说，Xenium的数据分析流程如下：</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9ahq6SOuy82DClHXs6hdRHfGas2dJmONFxLabiaOoFYNlp8IReJczqb3wBEIIRJ4b7uibcycOicHic2A/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.16944444444444445" data-type="png" data-w="1080" data-imgfileid="100055466" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9ahq6SOuy82DClHXs6hdRHfGas2dJmONFxLabiaOoFYNlp8IReJczqb3wBEIIRJ4b7uibcycOicHic2A/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">今天学习教程中的这个笔记：Xenium_5k_data_analysis_journey.ipynb</span></p><blockquote><p><span leaf="">Xenium data visualization and analysis (for one sample)</span></p></blockquote><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">输入数据</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">Seurat现在已经支持分析 Xenium 数据了，输入数据准备如下，来自  Xenium outputs ：</span></p><p data-tool="mdnice编辑器"><span leaf="">*  </span><code><span leaf="">cell_feature_matrix/</span></code><span leaf=""> (cell-level gene expression)</span></p><p data-tool="mdnice编辑器"><span leaf="">*  </span><code><span leaf="">cell_boundaries.parquet</span></code><span leaf=""> (visualization of cell segmnetation)</span></p><p data-tool="mdnice编辑器"><span leaf="">*  </span><code><span leaf="">cells.parquet</span></code><span leaf=""> (cell level information)</span></p><p data-tool="mdnice编辑器"><span leaf="">*  </span><code><span leaf="">transcripts.parquet</span></code><span leaf=""> (transcript level information)</span></p><p data-tool="mdnice编辑器"><span leaf="">这里以10x官网的乳腺癌数据为例：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">wget https://cf.10xgenomics.com/supp/xenium/analysis-workshop/one-sample-analysis.tar.gz</span><span leaf=""><br></span><span leaf="">tar -xzvf ./one-sample-analysis.tar.gz</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">目录中的内容如下：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">.</span><span leaf=""><br></span><span leaf="">├── Selection_1_cells_stats.csv</span><span leaf=""><br></span><span leaf="">└── Xenium_Prime_Breast_Cancer_FFPE_outs</span><span leaf=""><br></span><span leaf="">    ├── cell_boundaries.parquet</span><span leaf=""><br></span><span leaf="">    ├── cell_feature_matrix </span><span><span leaf=""># 细胞水平的基因表达矩阵</span></span><span leaf=""><br></span><span leaf="">    │   ├── barcodes.tsv.gz</span><span leaf=""><br></span><span leaf="">    │   ├── features.tsv.gz</span><span leaf=""><br></span><span leaf="">    │   └── matrix.mtx.gz</span><span leaf=""><br></span><span leaf="">    ├── cell_feature_matrix.h5</span><span leaf=""><br></span><span leaf="">    ├── cells.parquet </span><span leaf=""><br></span><span leaf="">    └── transcripts.parquet </span><span><span leaf=""># 转录本信息</span></span><span leaf=""><br></span></code></pre><h2 data-cacheurl="" data-remoteid="" data-tool="mdnice编辑器"><span></span><span><span leaf="">Xenium数据加载</span></span></h2><p data-tool="mdnice编辑器"><span leaf="">自 Xenium Analyzer v3.0 版本起，系统将不再提供 </span><code><span leaf="">transcripts.csv.gz</span></code><span leaf=""> 文件（仅提供 </span><code><span leaf="">transcripts.parquet</span></code><span leaf=""> 文件，其内容与 </span><code><span leaf="">transcripts.csv.gz</span></code><span leaf=""> 完全一致）。自 v5.2.0 版本开始，Seurat 已能够直接加载 </span><code><span leaf="">transcripts.parquet</span></code><span leaf=""> 文件，而不再需要依赖 </span><code><span leaf="">transcripts.csv.gz</span></code><span leaf="">。</span></p><p data-tool="mdnice编辑器"><span leaf="">使用 </span><code><span leaf="">LoadXenium</span></code><span leaf=""> 函数加载完整的 Xenium 数据，具体参数设置如下：</span></p><ul><li><section><code><span leaf="">segmentations</span></code><span leaf="">：设为 "cell" —— 加载细胞分割数据（其他选项：设为 "nucleus" —— 加载细胞核分割数据；设为 "NULL" —— 不加载任何分割数据）</span></section></li><li><section><code><span leaf="">flip.xy</span></code><span leaf="">：翻转 x、y 坐标，使其与 Xenium Explorer 中显示的坐标方向保持一致</span></section></li></ul><pre data-tool="mdnice编辑器"><code><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span leaf="">library(Seurat)</span><span leaf=""><br></span><span leaf="">library(sf)</span><span leaf=""><br></span><span leaf="">library(ggplot2)</span><span leaf=""><br></span><span><span leaf=""># library(arrow)</span></span><span leaf=""><br></span><span leaf="">packageVersion(</span><span><span leaf="">"Seurat"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## 1.数据加载</span></span><span leaf=""><br></span><span><span leaf=""># for this big dataset, loading time is ~16mins</span></span><span leaf=""><br></span><span leaf="">xenium.obj &lt;- LoadXenium(</span><span><span leaf="">"./one-sample-analysis/Xenium_Prime_Breast_Cancer_FFPE_outs"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                         fov = </span><span><span leaf="">"fov"</span></span><span leaf="">, segmentations=</span><span><span leaf="">"cell"</span></span><span leaf="">, flip.xy=TRUE)</span><span leaf=""><br></span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><span></span><span><span leaf="">报错1：</span></span><span></span></h3><blockquote><pre><code><span leaf="">Error </span><span><span leaf="">in</span></span><span leaf=""> data.table::fread(x, data.table = FALSE, select = names(col.use),  : </span><span leaf=""> </span><span><span leaf="">'./transcripts.csv.gz'</span></span><span leaf=""> 不存在, 或不可读.</span><span leaf=""><br></span><span leaf="">错误于FUN(X[[i]], ...): </span><span leaf="">Xenium outputs were incomplete: missing transcripts. Xenium outputs no longer include `transcripts.csv.gz`. Instead, please install `arrow` to </span><span><span leaf="">read</span></span><span leaf=""> transcripts.parquet</span><span leaf=""><br></span></code></pre></blockquote><p data-tool="mdnice编辑器"><span leaf="">需要安装一个R包：</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">install.packages(</span><span><span leaf="">"arrow"</span></span><span leaf="">)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">然后重新读取，还是会报上面的错误，安装了最新的 suerat 版本也不行。</span></p><p data-tool="mdnice编辑器"><span leaf="">找到一个issue：https://github.com/satijalab/seurat/issues/9060</span></p><h4 data-tool="mdnice编辑器"><span></span><span leaf="">解决办法：</span><span></span></h4><pre data-tool="mdnice编辑器"><code><span><span leaf="">## 1.数据加载</span></span><span leaf=""><br></span><span leaf="">library(arrow)</span><span leaf=""><br></span><span leaf="">data.dir &lt;- </span><span><span leaf="">"one-sample-analysis/Xenium_Prime_Breast_Cancer_FFPE_outs/"</span></span><span leaf=""><br></span><span leaf="">transcripts &lt;- read_parquet(file.path(data.dir, </span><span><span leaf="">"transcripts.parquet"</span></span><span leaf="">))</span><span leaf=""><br></span><span><span leaf=""># write.csv(transcripts, gzfile(file.path(data.dir, "transcripts.csv.gz")), row.names = FALSE)</span></span><span leaf=""><br></span><span leaf="">fwrite(transcripts, file.path(data.dir, </span><span><span leaf="">"transcripts.csv.gz"</span></span><span leaf="">))</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><span></span><span><span leaf="">报错2：</span></span><span></span></h3><blockquote><pre><code><span leaf="">transcripts &lt;- read_parquet(</span><span><span leaf="">"one-sample-analysis/Xenium_Prime_Breast_Cancer_FFPE_outs/transcripts.parquet"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">错误: Invalid: Invalid number of indices: 0</span><span leaf=""><br></span></code></pre></blockquote><p data-tool="mdnice编辑器"><span leaf="">又找到一个issue：https://github.com/satijalab/seurat/issues/10181</span></p><h4 data-tool="mdnice编辑器"><span></span><span leaf="">解决办法：</span><span></span></h4><pre data-tool="mdnice编辑器"><code><span leaf="">devtools::install_version(</span><span><span leaf="">"arrow"</span></span><span leaf="">, </span><span><span leaf="">"21.0.0.0"</span></span><span leaf="">, force = TRUE)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">这个安装卡住了，<span textstyle="">问了一下AI，说是cmake编译需要比较久的时间</span>，然后让我使用conda安装：</span></p><pre data-tool="mdnice编辑器"><code><span><span leaf=""># 或者使用这个</span></span><span leaf=""><br></span><span leaf="">conda install -y r-arrow=21.0.0</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">给的建议还挺靠谱的，非常丝滑，不到一分钟就搞定了。</span></span></p><h3 data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><span></span><span><span leaf="">重新 走一遍流程，完整代码如下：</span></span><span></span></h3><pre data-tool="mdnice编辑器"><code><span leaf="">rm(list=ls())</span><span leaf=""><br></span><span leaf="">library(Seurat)</span><span leaf=""><br></span><span leaf="">library(sf)</span><span leaf=""><br></span><span leaf="">library(ggplot2)</span><span leaf=""><br></span><span leaf="">library(data.table)</span><span leaf=""><br></span><span leaf="">library(arrow)</span><span leaf=""><br></span><span leaf="">packageVersion(</span><span><span leaf="">"Seurat"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">packageVersion(</span><span><span leaf="">"arrow"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">## 1.数据加载</span></span><span leaf=""><br></span><span leaf="">library(arrow)</span><span leaf=""><br></span><span leaf="">data.dir &lt;- </span><span><span leaf="">"one-sample-analysis/Xenium_Prime_Breast_Cancer_FFPE_outs/"</span></span><span leaf=""><br></span><span leaf="">transcripts &lt;- read_parquet(file.path(data.dir, </span><span><span leaf="">"transcripts.parquet"</span></span><span leaf="">))</span><span leaf=""><br></span><span><span leaf=""># write.csv(transcripts, gzfile(file.path(data.dir, "transcripts.csv.gz")), row.names = FALSE)</span></span><span leaf=""><br></span><span leaf="">fwrite(transcripts, file.path(data.dir, </span><span><span leaf="">"transcripts.csv.gz"</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># for this big dataset, loading time is ~16mins</span></span><span leaf=""><br></span><span leaf="">xenium.obj &lt;- LoadXenium(</span><span><span leaf="">"./one-sample-analysis/Xenium_Prime_Breast_Cancer_FFPE_outs/"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">                         fov = </span><span><span leaf="">"fov"</span></span><span leaf="">, segmentations=</span><span><span leaf="">"cell"</span></span><span leaf="">, flip.xy=TRUE)</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">这个数据读取需要16分钟。</span></span></p><p data-tool="mdnice编辑器"><span leaf="">今天分享到这里，<span textstyle="">祝大家好运，做那个10%里面的人，不要轻易放弃入门生信~</span></span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><p data-tool="mdnice编辑器"><span leaf=""><span textstyle="">转发：</span></span></p></section><ul><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247547917&amp;idx=1&amp;sn=76afb50b6e9e433e3f2b3d039f72dac4&amp;scene=21#wechat_redirect" textvalue="生信入门&amp;数据挖掘线上直播课2026年1月班" data-itemshowtype="0" linktype="text" data-linktype="2">生信入门&amp;数据挖掘线上直播课2026年1月班</a><span textstyle="">，你的生物信息学入门课</span></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzAxMDkxODM1Ng==&amp;mid=2247525079&amp;idx=1&amp;sn=0b997af16a58195b4192691373048fd5&amp;scene=21#wechat_redirect" textvalue="时隔5年，我们的生信技能树VIP学徒继续招生啦" data-itemshowtype="0" linktype="text" data-linktype="2"><span textstyle="">时隔5年，我们的生信技能树VIP学徒继续招生啦</span></a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247530048&amp;idx=1&amp;sn=28aa7bbd5e00521f79e074496a5f5d66&amp;scene=21#wechat_redirect" textvalue="满足你生信分析计算需求的低价解决方案" data-itemshowtype="0" linktype="text" data-linktype="2">满足你生信分析计算需求的低价解决方案</a></span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=1679199708449144836&amp;scene=173&amp;subscene=207&amp;sessionid=1745492310&amp;enterid=1745492314&amp;from_msgid=2247541298&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信故事会" data-itemshowtype="0" linktype="text" data-linktype="2">生信故事会</a>，来看看他们的生信入门故事</span></section></li><li><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzAxMDkxODM1Ng==&amp;action=getalbum&amp;album_id=3690970204957147140&amp;scene=173&amp;subscene=207&amp;sessionid=1745066271&amp;enterid=1745066274&amp;from_msgid=2247540702&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect" textvalue="生信马拉松答疑专辑" data-itemshowtype="0" linktype="text" data-linktype="2">生信马拉松答疑专辑</a>，获取你的生信专属答疑</span></section></li></ul></section><p><mp-style-type data-value="10000"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/L7759yOiuM4WO27fzKxCMw",target="_blank" rel="noopener noreferrer">原文链接</a>
