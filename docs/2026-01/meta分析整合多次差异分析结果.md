---
title: "meta分析整合多次差异分析结果"
date: 2026-01-26T12:58:53Z
draft: ["false"]
tags: [
  "fetched",
  "生信星球"
]
categories: ["Acdemic"]
---
meta分析整合多次差异分析结果 by 生信星球
------
<div><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="0 0 []"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="3 5 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;data-tool&quot;:&quot;markdown2wechat编辑器&quot;,&quot;data-website&quot;:&quot;https://aizhuanqian.com&quot;,&quot;style&quot;:&quot;font-size: 16px;color: black;padding: 0 10px;line-height: 1.6;word-spacing: 0px;letter-spacing: 0px;word-break: break-word;word-wrap: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;data-tool&quot;:&quot;mdnice编辑器&quot;,&quot;data-website&quot;:&quot;https://www.mdnice.com&quot;,&quot;style&quot;:&quot;margin-top: 0px;margin-bottom: 0px;margin-left: 0px;margin-right: 0px;padding-top: 0px;padding-bottom: 0px;padding-left: 10px;padding-right: 10px;background-attachment: scroll;background-clip: border-box;background-color: rgba(0, 0, 0, 0);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;font-family: Optima, 'Microsoft YaHei', PingFangSC-regular, serif;font-size: 16px;color: rgb(0, 0, 0);line-height: 1.5em;word-spacing: 0em;letter-spacing: 0em;word-break: break-word;overflow-wrap: break-word;text-align: left;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="0 0 []"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-ratio="1" data-type="png" data-w="64" width="20px" data-imgfileid="100013059" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png"><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png" data-ratio="1" data-type="png" data-w="64" width="20px" data-imgfileid="100013061" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLPukRHCbicy4pNKeEv9qd7aWSfsx7roib2od3xPrRPicw3a0kbn0uQ6JmQ/640?wx_fmt=png"></span><span><span leaf=""> 今天是生信星球陪你的</span><span><strong><span leaf="">第1065天</span></strong></span></span><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png" data-ratio="1" data-type="png" data-w="64" width="20px" data-imgfileid="100013060" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHrDic8XGmJ0b7oibVJajb0emLBHSvuibGG49ooBgtaAibE3TNJ00iaHviaMtdIKQJfCwtUfuHicDImtSfIxg/640?wx_fmt=png">   </span></section><section><blockquote><section><span><span leaf="">公众号里的文章大多数需要编程基础，如果因为代码看不懂，而跟不上正文的节奏，可以来找我学习，相当于给自己一个新手保护期。</span></span><span><span leaf="">我的课程都是循环开课，</span></span><span><span leaf="">点进去咨询微信，随时可以报名↓</span></span><span leaf=""><br></span></section><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247497289&amp;idx=1&amp;sn=e87f24c3b353034b5719294cca0eb166&amp;scene=21#wechat_redirect" textvalue="生信分析直播课程" data-itemshowtype="11" linktype="text" data-linktype="2">生信分析直播课程</a>(每月初开一期)</span></section><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247497281&amp;idx=1&amp;sn=766f7f39e0061e2c251455faac2ba4ed&amp;scene=21#wechat_redirect" textvalue="生信新手保护学习小组长期报名中" data-itemshowtype="0" linktype="text" data-linktype="2">生信新手保护学习小组长期报名中</a>（每月一期）</span></section><section><span leaf=""><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzU4NjU4ODQ2MQ==&amp;mid=2247497281&amp;idx=1&amp;sn=766f7f39e0061e2c251455faac2ba4ed&amp;scene=21#wechat_redirect" textvalue="单细胞陪伴学习小组" data-itemshowtype="0" linktype="text" data-linktype="2">单细胞陪伴学习小组</a>（每月一期）</span></section></blockquote></section></section></section></section><section data-tool="markdown2wechat编辑器" data-website="https://aizhuanqian.com" data-pm-slice="0 0 []"><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">背景知识</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">在数据挖掘中，多个数据差异分析之后的联合，有多种方法：</span></p><ol><li><section><strong><span leaf="">简单取交集 (Venn Diagram)</span></strong></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">这是最直观的方法。分别对两个数据集做差异分析，然后画 Venn 图取重叠部分。</span></p><p data-tool="mdnice编辑器"><span leaf="">优点：逻辑简单，读者一看就懂。</span><span leaf=""><br></span><span leaf="">缺点：存在严重的**“漏斗效应”**。很多基因可能在一个数据集中显著（P&lt;0.05），在另一个数据集中处于边缘显著（比如 P=0.06），直接取交集会无情地丢弃这些其实很重要的基因。</span></p><ol start="2"><li><section><strong><span leaf="">效应量 Meta 分析 (Effect Size Meta-analysis) </span><span leaf=""><br></span><span leaf="">这是目前的</span></strong><span leaf="">“黄金标准”。它不是简单的数值平均，而是根据每个研究的标准误 (SE) 进行加权。数据越准、样本量越大的研究，话语权越重。</span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">优点：能综合考虑变化方向、幅度和数据质量，结果最稳健可信，且支持跨平台（芯片+测序）整合。</span><span leaf=""><br></span><span leaf="">缺点：需要完整的 logFC 和 SE 数据，门槛稍高。</span></p><ol start="3"><li><section><strong><span leaf="">秩聚合算法 (RRA)</span></strong><span leaf=""><br></span><span leaf="">这是一种基于“排名”的整合方法。它不看具体的表达量数值，而是看基因在各个列表中是否都排在前列。</span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">优点：容错率极高，能整合量纲完全不同的数据（如转录组+蛋白质组+甲基化）。</span><span leaf=""><br></span><span leaf="">缺点：丢失了具体的“倍数变化”信息，无法量化差异幅度。</span></p><ol start="4"><li><section><strong><span leaf="">直接合并去批次 (ComBat/SVA)</span></strong><span leaf=""><br></span><span leaf="">将两个表达矩阵强行拼合，并使用算法去除批次效应。</span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">适用场景：通常仅限于同平台的数据（如都是 Affymetrix 芯片）。</span><span leaf=""><br></span><span leaf="">风险：如果强行合并芯片和测序数据，极易引入非线性偏差；且容易“过度校正”，误把生物学差异当成批次效应抹除。</span></p><ol start="5"><li><section><strong><span leaf="">Fisher's Method (P值合并)</span></strong><span leaf=""><br></span><span leaf="">这是 Meta 分析的简易版，仅针对 P 值进行合并（将多个 P 值融合成一个统计量）。</span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">适用场景：当你只有 Gene Symbol 和 P-value，没有 logFC 时的救命稻草。</span><span leaf=""><br></span><span leaf="">硬伤：它分不清方向。如果某基因在一个数据集中上调，在另一个中下调，Fisher 法可能会误判为“显著”，导致假阳性。</span></p><ol start="6"><li><section><strong><span leaf="">共识加权基因共表达网络 (Consensus WGCNA)</span></strong><span leaf=""><br></span><span leaf="">这是一种进阶策略。它不局限于寻找单个差异基因，而是挖掘在两个数据集中“共存的基因模块”。</span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">价值：如果 TCGA 和 GEO 都能构建出同一个共表达模块，说明该通路在生物学上非常保守且核心，适合讲述更高维度的调控网络故事。</span></p><p data-tool="mdnice编辑器"><span leaf="">今天介绍这里面的方法2(效应量 Meta 分析)的代码。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">1.载入数据</span></span><span></span></h3><pre data-tool="mdnice编辑器"><code><span leaf="">rm(list = ls())</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(dplyr)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(metafor)</span><span leaf=""><br></span><span><span leaf="">library</span></span><span leaf="">(ggplot2)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">load(</span><span><span leaf="">"degs.Rdata"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">head(deg1)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><code><span leaf="">##             logFC  AveExpr         t      P.Value    adj.P.Val</span><span leaf=""><br></span><span leaf="">## Mug2    -3.836029 6.883903 -27.90973 2.676041e-12 2.764409e-08</span><span leaf=""><br></span><span leaf="">## Orm2     3.054059 6.040447  24.29455 1.380244e-11 6.244226e-08</span><span leaf=""><br></span><span leaf="">## H2-K1   -3.346620 8.882681 -23.16197 2.422945e-11 8.221052e-08</span><span leaf=""><br></span><span leaf="">## Gm10260  5.463509 4.118297  26.93697 4.073695e-12 2.764409e-08</span><span leaf=""><br></span><span leaf="">## Rps18   -2.921302 7.197548 -21.07808 7.337186e-11 1.492161e-07</span><span leaf=""><br></span><span leaf="">## Cd36     4.472500 6.481416  20.99240 7.696087e-11 1.492161e-07</span><span leaf=""><br></span><span leaf="">##                B change  Symbol</span><span leaf=""><br></span><span leaf="">## Mug2    18.54363   DOWN    Mug2</span><span leaf=""><br></span><span leaf="">## Orm2    17.01484     UP    Orm2</span><span leaf=""><br></span><span leaf="">## H2-K1   16.56112   DOWN   H2-K1</span><span leaf=""><br></span><span leaf="">## Gm10260 16.45028     UP Gm10260</span><span leaf=""><br></span><span leaf="">## Rps18   15.48881   DOWN   Rps18</span><span leaf=""><br></span><span leaf="">## Cd36    15.39094     UP    Cd36</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><code><span leaf="">head(deg2)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><code><span leaf="">##                   logFC   AveExpr         t      P.Value</span><span leaf=""><br></span><span leaf="">## 1600002H07Rik -2.520145  6.292221 -18.32099 5.872667e-10</span><span leaf=""><br></span><span leaf="">## Cyp3a11        2.321189 11.282366  14.21200 1.008935e-08</span><span leaf=""><br></span><span leaf="">## Slc37a4       -1.857103  6.303268 -12.39953 4.520266e-08</span><span leaf=""><br></span><span leaf="">## Cdip1         -1.658108  6.411937 -12.35854 4.686372e-08</span><span leaf=""><br></span><span leaf="">## Pfkfb1        -1.851370  5.545345 -12.36736 4.650084e-08</span><span leaf=""><br></span><span leaf="">## Mgll          -1.495570  6.969573 -12.01666 6.358669e-08</span><span leaf=""><br></span><span leaf="">##                  adj.P.Val         B change        Symbol</span><span leaf=""><br></span><span leaf="">## 1600002H07Rik 8.027349e-06 12.798728   DOWN 1600002H07Rik</span><span leaf=""><br></span><span leaf="">## Cyp3a11       6.895568e-05 10.406196     UP       Cyp3a11</span><span leaf=""><br></span><span leaf="">## Slc37a4       9.446013e-05  9.069660   DOWN       Slc37a4</span><span leaf=""><br></span><span leaf="">## Cdip1         9.446013e-05  9.042104   DOWN         Cdip1</span><span leaf=""><br></span><span leaf="">## Pfkfb1        9.446013e-05  8.997119   DOWN        Pfkfb1</span><span leaf=""><br></span><span leaf="">## Mgll          1.045003e-04  8.765187   DOWN          Mgll</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">我的两个数据实验设计相同，物种相同，都用了limma包做差异分析，deg1和deg2是两个数据各自差异分析的结果表格。如果是多次差异分析，也同样支持，准备多次差异分析的结果，然后后续代码rma的method参数从FE改为REML即可。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">2.数据清洗</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">1.两个差异分析结果都需要有Symbol、logFC和SE(标准误)列。</span></p><p data-tool="mdnice编辑器"><span leaf="">差异分析常用的三大R包中，deseq2直接提供了SE值，即lfcSE 列。</span></p><p data-tool="mdnice编辑器"><span leaf="">limma的差异分析结果中没有提供SE值，可以使用SE = |logFC| / t计算。edgeR或者t-test也没有提供SE值，但提供了p值和logFC，也可以计算SE。</span></p><p data-tool="mdnice编辑器"><span leaf="">edgeR的SE计算示例代码(不运行):</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">DEG2 &lt;- DEG2 %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(Symbol = rownames(.)) %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf=""># 1. 计算 Z 分数 </span></span><span leaf=""><br></span><span leaf="">    Z_score = qnorm(</span><span><span leaf="">1</span></span><span leaf=""> - (PValue / </span><span><span leaf="">2</span></span><span leaf="">)),</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf=""># 2. 反推 SE</span></span><span leaf=""><br></span><span leaf="">    SE = abs(logFC) / Z_score</span><span leaf=""><br></span><span leaf="">  )</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">2.列名修改，避免多个数据相同的信息列名混乱。</span></p><p data-tool="mdnice编辑器"><span leaf="">3.剔除基因名NA、重复以及无穷值，防止因异常数据而报错。</span></p><p data-tool="mdnice编辑器"><span leaf="">4.两个差异分析结果数据取交集。</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">deg1 &lt;- deg1 %&gt;%</span><span leaf=""><br></span><span leaf="">  transmute(</span><span leaf=""><br></span><span leaf="">    Symbol,</span><span leaf=""><br></span><span leaf="">    logFC_dat1 = logFC,</span><span leaf=""><br></span><span leaf="">    SE_dat1    = abs(logFC / t),</span><span leaf=""><br></span><span leaf="">    P_dat1     = P.Value</span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(!is.na(Symbol)) %&gt;%</span><span leaf=""><br></span><span leaf="">  distinct(Symbol, .keep_all = </span><span><span leaf="">TRUE</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(is.finite(logFC_dat1), is.finite(SE_dat1), SE_dat1 &gt; </span><span><span leaf="">0</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">deg2 &lt;- deg2 %&gt;%</span><span leaf=""><br></span><span leaf="">  transmute(</span><span leaf=""><br></span><span leaf="">    Symbol,</span><span leaf=""><br></span><span leaf="">    logFC_dat2 = logFC,</span><span leaf=""><br></span><span leaf="">    SE_dat2    = abs(logFC / t),</span><span leaf=""><br></span><span leaf="">    P_dat2     = P.Value</span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(!is.na(Symbol)) %&gt;%</span><span leaf=""><br></span><span leaf="">  distinct(Symbol, .keep_all = </span><span><span leaf="">TRUE</span></span><span leaf="">) %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(is.finite(logFC_dat2), is.finite(SE_dat2), SE_dat2 &gt; </span><span><span leaf="">0</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">dat &lt;- inner_join(deg1, deg2, by = </span><span><span leaf="">"Symbol"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">head(dat)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><code><span leaf="">##    Symbol logFC_dat1   SE_dat1       P_dat1  logFC_dat2   SE_dat2</span><span leaf=""><br></span><span leaf="">## 1    Mug2  -3.836029 0.1374442 2.676041e-12  0.49740075 0.2591405</span><span leaf=""><br></span><span leaf="">## 2    Orm2   3.054059 0.1257096 1.380244e-11  1.17220273 0.4348370</span><span leaf=""><br></span><span leaf="">## 3   H2-K1  -3.346620 0.1444877 2.422945e-11 -0.09312900 0.1379991</span><span leaf=""><br></span><span leaf="">## 4 Gm10260   5.463509 0.2028257 4.073695e-12 -0.02046381 0.4529364</span><span leaf=""><br></span><span leaf="">## 5   Rps18  -2.921302 0.1385943 7.337186e-11  0.31219117 0.1859874</span><span leaf=""><br></span><span leaf="">## 6    Cd36   4.472500 0.2130533 7.696087e-11  0.40889796 0.3730486</span><span leaf=""><br></span><span leaf="">##       P_dat2</span><span leaf=""><br></span><span leaf="">## 1 0.07971635</span><span leaf=""><br></span><span leaf="">## 2 0.01988533</span><span leaf=""><br></span><span leaf="">## 3 0.51292278</span><span leaf=""><br></span><span leaf="">## 4 0.96472774</span><span leaf=""><br></span><span leaf="">## 5 0.11979833</span><span leaf=""><br></span><span leaf="">## 6 0.29514775</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">3.执行meta分析</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">在 Meta 分析中，通常有固定效应（FE）和随机效应（REML）两种模型。两研究使用固定效应 FE，三个及以上研究选择随机效应（REML）。因为只有两个数据时，异质性估计极不稳定，固定效应（FE）模型反而是更稳健、更敏感的选择。</span></p><p data-tool="mdnice编辑器"><span leaf="">针对上述数据的每一行，定义计算函数。</span></p><pre data-tool="mdnice编辑器"><code><span leaf="">run_meta_per_gene &lt;- </span><span><span leaf="">function</span></span><span leaf="">(row_data) {</span><span leaf=""><br></span><span leaf="">  yi  &lt;- c(as.numeric(row_data[</span><span><span leaf="">"logFC_dat1"</span></span><span leaf="">]), as.numeric(row_data[</span><span><span leaf="">"logFC_dat2"</span></span><span leaf="">]))</span><span leaf=""><br></span><span leaf="">  sei &lt;- c(as.numeric(row_data[</span><span><span leaf="">"SE_dat1"</span></span><span leaf="">]),    as.numeric(row_data[</span><span><span leaf="">"SE_dat2"</span></span><span leaf="">]))</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 排除异常值</span></span><span leaf=""><br></span><span><span leaf="">if</span></span><span leaf=""> (any(!is.finite(yi)) || any(!is.finite(sei)) || any(sei &lt;= </span><span><span leaf="">0</span></span><span leaf="">)) {</span><span leaf=""><br></span><span leaf="">    </span><span><span leaf="">return</span></span><span leaf="">(c(</span><span><span leaf="">NA_real_</span></span><span leaf="">, </span><span><span leaf="">NA_real_</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf="">  }</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">  vi &lt;- sei^</span><span><span leaf="">2</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">  res &lt;- </span><span><span leaf="">tryCatch</span></span><span leaf="">(</span><span leaf=""><br></span><span leaf="">    rma(yi = yi, vi = vi, method = </span><span><span leaf="">"FE"</span></span><span leaf="">),   </span><span><span leaf=""># 固定效应</span></span><span leaf=""><br></span><span leaf="">    error = </span><span><span leaf="">function</span></span><span leaf="">(e) </span><span><span leaf="">NULL</span></span><span leaf=""><br></span><span leaf="">  )</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf="">if</span></span><span leaf=""> (is.null(res)) </span><span><span leaf="">return</span></span><span leaf="">(c(</span><span><span leaf="">NA_real_</span></span><span leaf="">, </span><span><span leaf="">NA_real_</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">  c(as.numeric(res$beta), as.numeric(res$pval))</span><span leaf=""><br></span><span leaf="">}</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 批量运行</span></span><span leaf=""><br></span><span leaf="">res &lt;- apply(dat, </span><span><span leaf="">1</span></span><span leaf="">, run_meta_per_gene)</span><span leaf=""><br></span><span leaf="">res &lt;- as.data.frame(t(res))</span><span leaf=""><br></span><span leaf="">colnames(res) &lt;- c(</span><span><span leaf="">"Pooled_ES"</span></span><span leaf="">, </span><span><span leaf="">"Meta_Pval"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">head(res)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><code><span leaf="">##   Pooled_ES     Meta_Pval</span><span leaf=""><br></span><span leaf="">## 1 -2.884635 9.304021e-125</span><span leaf=""><br></span><span leaf="">## 2  2.908911 3.380353e-128</span><span leaf=""><br></span><span leaf="">## 3 -1.645183  4.656462e-61</span><span leaf=""><br></span><span leaf="">## 4  4.547510 2.909540e-133</span><span leaf=""><br></span><span leaf="">## 5 -1.766831  6.490362e-57</span><span leaf=""><br></span><span leaf="">## 6  3.473059  1.266056e-78</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">Pooled_ES即Pooled Effect Size,合并效应值，是加权后的共识 logFC，它是两个数据集中 logFC 的综合结论。</span></p><p data-tool="mdnice编辑器"><span leaf="">Pooled Effect Size不是简单的 (dat1 + dat2) / 2。</span><span leaf=""><br></span><span leaf="">它是基于数据质量的“加权平均值”。</span></p><p data-tool="mdnice编辑器"><span leaf="">Meta 分析算法会根据每个研究的标准误 (SE) 自动分配话语权：</span><span leaf=""><br></span><span leaf="">SE 越小，说明该研究数据越稳、精度越高，它在合并时的权重（Weight）就越大。</span><span leaf=""><br></span><span leaf="">SE 越大，说明数据波动大、噪音多，它的权重就越小。</span></p><p data-tool="mdnice编辑器"><span leaf="">举个例子：</span><span leaf=""><br></span><span leaf="">dat1 (SE极小) 显示：某基因下调 4倍。</span><span leaf=""><br></span><span leaf="">dat2 (SE较大) 显示：该基因下调 2倍。</span><span leaf=""><br></span><span leaf="">最终结果：Pooled ES 可能是 3.5倍。 (结果会强烈向更靠谱的 dat1 倾斜，而不是简单的中间值 3)。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">4.meta分析结果整理</span></span><span></span></h3><pre data-tool="mdnice编辑器"><code><span leaf="">res &lt;- bind_cols(dat, res) %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(</span><span leaf=""><br></span><span leaf="">    FDR = p.adjust(Meta_Pval, method = </span><span><span leaf="">"BH"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">  ) %&gt;%</span><span leaf=""><br></span><span leaf="">  filter(is.finite(Pooled_ES), is.finite(Meta_Pval), is.finite(FDR)) %&gt;%</span><span leaf=""><br></span><span leaf="">  </span><span><span leaf=""># 防止FDR极小被数值舍入到0，导致 -log10(FDR) = Inf</span></span><span leaf=""><br></span><span leaf="">  mutate(FDR_plot = pmax(FDR, </span><span><span leaf="">1e-300</span></span><span leaf="">))</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">head(res)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><code><span leaf="">##    Symbol logFC_dat1   SE_dat1       P_dat1  logFC_dat2   SE_dat2</span><span leaf=""><br></span><span leaf="">## 1    Mug2  -3.836029 0.1374442 2.676041e-12  0.49740075 0.2591405</span><span leaf=""><br></span><span leaf="">## 2    Orm2   3.054059 0.1257096 1.380244e-11  1.17220273 0.4348370</span><span leaf=""><br></span><span leaf="">## 3   H2-K1  -3.346620 0.1444877 2.422945e-11 -0.09312900 0.1379991</span><span leaf=""><br></span><span leaf="">## 4 Gm10260   5.463509 0.2028257 4.073695e-12 -0.02046381 0.4529364</span><span leaf=""><br></span><span leaf="">## 5   Rps18  -2.921302 0.1385943 7.337186e-11  0.31219117 0.1859874</span><span leaf=""><br></span><span leaf="">## 6    Cd36   4.472500 0.2130533 7.696087e-11  0.40889796 0.3730486</span><span leaf=""><br></span><span leaf="">##       P_dat2 Pooled_ES     Meta_Pval           FDR      FDR_plot</span><span leaf=""><br></span><span leaf="">## 1 0.07971635 -2.884635 9.304021e-125 2.998918e-121 2.998918e-121</span><span leaf=""><br></span><span leaf="">## 2 0.01988533  2.908911 3.380353e-128 1.452763e-124 1.452763e-124</span><span leaf=""><br></span><span leaf="">## 3 0.51292278 -1.645183  4.656462e-61  6.670641e-58  6.670641e-58</span><span leaf=""><br></span><span leaf="">## 4 0.96472774  4.547510 2.909540e-133 1.875635e-129 1.875635e-129</span><span leaf=""><br></span><span leaf="">## 5 0.11979833 -1.766831  6.490362e-57  7.607294e-54  7.607294e-54</span><span leaf=""><br></span><span leaf="">## 6 0.29514775  3.473059  1.266056e-78  2.720544e-75  2.720544e-75</span><span leaf=""><br></span></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">5.绘制火山图</span></span><span></span></h3><pre data-tool="mdnice编辑器"><code><span leaf="">cutoff_fdr &lt;- </span><span><span leaf="">0.05</span></span><span leaf=""><br></span><span leaf="">cutoff_es  &lt;- </span><span><span leaf="">0.585</span></span><span leaf="">  </span><span><span leaf=""># 约等于1.5倍</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">res &lt;- res %&gt;%</span><span leaf=""><br></span><span leaf="">  mutate(</span><span leaf=""><br></span><span leaf="">    group = case_when(</span><span leaf=""><br></span><span leaf="">      FDR &lt; cutoff_fdr &amp; Pooled_ES &gt;  cutoff_es ~ </span><span><span leaf="">"Up"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">      FDR &lt; cutoff_fdr &amp; Pooled_ES &lt; -cutoff_es ~ </span><span><span leaf="">"Down"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">      </span><span><span leaf="">TRUE</span></span><span leaf=""> ~ </span><span><span leaf="">"Stable"</span></span><span leaf=""><br></span><span leaf="">    )</span><span leaf=""><br></span><span leaf="">  )</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">table(res$group)</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><code><span leaf="">## </span><span leaf=""><br></span><span leaf="">##   Down Stable     Up </span><span leaf=""><br></span><span leaf="">##   1043  10737   1113</span><span leaf=""><br></span></code></pre><pre data-tool="mdnice编辑器"><code><span leaf="">my_colors &lt;- c(</span><span><span leaf="">"Up"</span></span><span leaf=""> = </span><span><span leaf="">"<a topic-id="mkv5rjj2-77jd1u" data-topic="1">#D53E4F</a>"</span></span><span leaf="">, </span><span><span leaf="">"Down"</span></span><span leaf=""> = </span><span><span leaf="">"<a topic-id="mkv5rjj2-qcycx0" data-topic="1">#3288BD</a>"</span></span><span leaf="">, </span><span><span leaf="">"Stable"</span></span><span leaf=""> = </span><span><span leaf="">"grey80"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">p &lt;- ggplot(res, aes(x = Pooled_ES, y = -log10(FDR_plot))) +</span><span leaf=""><br></span><span leaf="">  geom_point(</span><span leaf=""><br></span><span leaf="">    data = subset(res, group == </span><span><span leaf="">"Stable"</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    color = </span><span><span leaf="">"grey80"</span></span><span leaf="">, size = </span><span><span leaf="">1</span></span><span leaf="">, alpha = </span><span><span leaf="">0.5</span></span><span leaf=""><br></span><span leaf="">  ) +</span><span leaf=""><br></span><span leaf="">  geom_point(</span><span leaf=""><br></span><span leaf="">    data = subset(res, group != </span><span><span leaf="">"Stable"</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    aes(color = group, size = -log10(FDR_plot)),</span><span leaf=""><br></span><span leaf="">    alpha = </span><span><span leaf="">0.8</span></span><span leaf=""><br></span><span leaf="">  ) +</span><span leaf=""><br></span><span leaf="">  scale_color_manual(values = my_colors) +</span><span leaf=""><br></span><span leaf="">  scale_size_continuous(range = c(</span><span><span leaf="">1</span></span><span leaf="">, </span><span><span leaf="">4</span></span><span leaf="">), guide = </span><span><span leaf="">"none"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  geom_vline(xintercept = c(-cutoff_es, cutoff_es), linetype = </span><span><span leaf="">"dashed"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  geom_hline(yintercept = -log10(cutoff_fdr), linetype = </span><span><span leaf="">"dashed"</span></span><span leaf="">) +</span><span leaf=""><br></span><span leaf="">  labs(</span><span leaf=""><br></span><span leaf="">    x = </span><span><span leaf="">"Pooled Effect Size"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">    y = </span><span><span leaf="">"-log10(FDR)"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">    title = </span><span><span leaf="">"Meta-analysis Volcano Plot"</span></span><span leaf=""><br></span><span leaf="">  ) +</span><span leaf=""><br></span><span leaf="">  theme_bw() +</span><span leaf=""><br></span><span leaf="">  theme(</span><span leaf=""><br></span><span leaf="">    panel.grid = element_blank(),</span><span leaf=""><br></span><span leaf="">    legend.position = </span><span><span leaf="">"none"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">    axis.title = element_text(size = </span><span><span leaf="">14</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    axis.text  = element_text(size = </span><span><span leaf="">12</span></span><span leaf="">),</span><span leaf=""><br></span><span leaf="">    plot.title = element_text(hjust = </span><span><span leaf="">0.5</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf="">  )</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">p</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpf4FftudV66aaZ23LcCibO5sHf0t9HLSj7N29ciafnib7cKyEuKYVMpRyB1ZPdhWDJsPyAywcibQXDAw/640?wx_fmt=png&amp;from=appmsg" data-ratio="1" data-type="png" data-w="504" data-imgfileid="100013748" data-aistatus="1" src="https://mmbiz.qpic.cn/mmbiz_png/8oKPbJgbBHpf4FftudV66aaZ23LcCibO5sHf0t9HLSj7N29ciafnib7cKyEuKYVMpRyB1ZPdhWDJsPyAywcibQXDAw/640?wx_fmt=png&amp;from=appmsg"></span></p><p data-tool="mdnice编辑器"><span leaf="">在 Meta 分析的火山图中，横坐标不是单一研究的 logFC，而是综合计算出的 Pooled ES：</span></p><p data-tool="mdnice编辑器"><span leaf="">Pooled ES &gt; 0 (右侧)： 综合所有证据后，判定该基因在处理组整体上调。例如 Pooled ES = 2，意味着综合来看表达量约升高了 2^2=4 倍。</span><span leaf=""><br></span><span leaf="">Pooled ES &lt; 0 (左侧)： 综合判定该基因整体下调。</span><span leaf=""><br></span><span leaf="">Pooled ES ≈ 0 (中间)： 基因无明显变化，或者两个数据集结论严重冲突（一个极高、一个极低，导致互相抵消）。</span></p></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/ZqKjbMlkE1doA28954fSDw",target="_blank" rel="noopener noreferrer">原文链接</a>
