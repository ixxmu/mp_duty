---
title: "除了细胞比例图，Ro/e分析也能清晰的告诉你细胞类型的富集情况"
date: 2026-01-22T14:51:51Z
draft: ["false"]
tags: [
  "fetched",
  "生信GoL"
]
categories: ["Acdemic"]
---
除了细胞比例图，Ro/e分析也能清晰的告诉你细胞类型的富集情况 by 生信GoL
------
<div><section><span leaf=""><br></span></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><h2 data-tool="mdnice编辑器"><span><span leaf="">Ro/e 来源及应用</span></span><span></span></h2><ul><li><section><span leaf="">Ro/e最早来源于2018年的一篇Nature文章</span></section></li></ul><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv33guV8glsBBhlSXRSU5y9XEJW4bpyg6rJVnY74aVibicN4xtmdd5nuaxAw/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.475" data-type="png" data-w="1080" data-imgfileid="100000211" data-aistatus="1" src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv33guV8glsBBhlSXRSU5y9XEJW4bpyg6rJVnY74aVibicN4xtmdd5nuaxAw/640?wx_fmt=png&amp;from=appmsg"></span></figure><ul><li><section><strong><span leaf="">该文章中提到Ro/e的部分</span></strong><span leaf="">：</span></section></li></ul><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv33e4yses9znyq2GsZactjsCOXUFwM8wPeN91rq1mvr9peTUDKXIzXDcg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.8251121076233184" data-type="png" data-w="892" data-imgfileid="100000212" data-aistatus="1" src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv33e4yses9znyq2GsZactjsCOXUFwM8wPeN91rq1mvr9peTUDKXIzXDcg/640?wx_fmt=png&amp;from=appmsg"></span></figure><p data-tool="mdnice编辑器"><span leaf="">经常看文献的亦非彦祖们都晓得，Ro/e在张泽民院士中的文章非常常见，</span><strong><span leaf="">主要是为了说明不同组别在不同细胞类型中的富集情况</span></strong><span leaf="">。比如从下图b中（来源Nature文章），我们能够明显得到，Neutrophil的亚群在不同的组别的富集情况差异很大。</span></p><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv33gqdmzjKrxc1KnTjfHVm5h1cwYMIo8CswAM3GAFmDWcibwmYOajsw1ibg/640?wx_fmt=png&amp;from=appmsg" data-ratio="0.6888888888888889" data-type="png" data-w="1080" data-imgfileid="100000213" data-aistatus="1" src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv33gqdmzjKrxc1KnTjfHVm5h1cwYMIo8CswAM3GAFmDWcibwmYOajsw1ibg/640?wx_fmt=png&amp;from=appmsg"></span></figure><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">Ro/e（Observed / Expected）原理</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">Ro/e 全称 【the ratio of observed to expected cell numbers】， 其计算基于一个基本假设：</span><strong><span leaf="">如果某类细胞在组间均匀分布，那么它在每一组中的预期数量应与该组细胞总数占整体比例成正比</span></strong><span leaf="">。</span></p><ul><li><section><span leaf="">计算公式</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">Ro/e = 观察到的细胞数 / 期望的细胞数</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">观察到的细胞数</span></strong><span leaf="">：实际统计到的某细胞类型在某组中的细胞数</span></p><p data-tool="mdnice编辑器"><strong><span leaf="">期望细胞数</span></strong><span leaf="">：在“细胞类型与分组无关（只按各组总细胞数比例随机分配）”的假设下，该组应当拥有的该细胞类型细胞数。</span></p><ul><li><section><span leaf="">举例说明</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">假设某数据集共有A组200个细胞、B组800个细胞，其中T细胞总数为100个。</span></p><p data-tool="mdnice编辑器"><span leaf="">则A组中T细胞的期望值 = 100 × (200 / 1000) = 20。</span></p><p data-tool="mdnice编辑器"><span leaf="">若A组实际检测到30个T细胞，则Ro/e = 30 / 20 = 1.5。</span></p><ul><li><section><span leaf="">结果解读</span></section></li></ul><p data-tool="mdnice编辑器"><span leaf="">Ro/e &gt; 1：该类细胞在该组中富集 Ro/e &lt; 1：该类细胞在该组中减少</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">R语言实战一下吧</span></span><span></span></h2><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 安装一下包</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mkpi64bq-u9dt54" data-topic="1">#BiocManager</a>::install("moduleColor")</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mkpi64bq-ejfy8v" data-topic="1">#remotes</a>::install_github("Japrin/sscVis", dependencies = TRUE, upgrade = "never")</span></span><span leaf=""><br></span><span><span leaf=""><a topic-id="mkpi64bq-qbdw55" data-topic="1">#前边两个包是下边这个包的依赖</a>，如果没装的话，最好先装一下。</span></span><span leaf=""><br></span><span leaf="">remotes::install_github(</span><span><span leaf="">"Japrin/STARTRAC"</span></span><span leaf="">, dependencies = TRUE, upgrade = </span><span><span leaf="">"never"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 加载一下包</span></span><span leaf=""><br></span><span leaf="">library(Startrac)</span><span leaf=""><br></span><span leaf="">library(pheatmap)</span><span leaf=""><br></span><span leaf="">library(Seurat)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 读取数据</span></span><span leaf=""><br></span><span leaf="">seu_obj&lt;-readRDS(</span><span><span leaf="">"./PDAC_anno.rds"</span></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 提取计算数据，也就是meta信息</span></span><span leaf=""><br></span><span leaf="">data_use &lt;- seu_obj@meta.data</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 计算Ro/e</span></span><span leaf=""><br></span><span leaf="">Roe &lt;-calTissueDist(data_use,</span><span leaf=""><br></span><span leaf="">                    byPatient = F,</span><span><span leaf=""># FALSE: 以组别（tissue/Group）为单位计算总体富集度,TRUE: 为每个患者单独计算富集度（适合患者异质性分析）</span></span><span leaf=""><br></span><span leaf="">                    colname.patient = </span><span><span leaf="">"orig.ident"</span></span><span leaf="">, </span><span><span leaf=""># 样本名称</span></span><span leaf=""><br></span><span leaf="">                    colname.cluster =</span><span><span leaf="">"CellType"</span></span><span leaf="">, </span><span><span leaf=""># 细胞类型</span></span><span leaf=""><br></span><span leaf="">                    colname.tissue =</span><span><span leaf="">"Group"</span></span><span leaf="">, </span><span><span leaf=""># 样本分组</span></span><span leaf=""><br></span><span leaf="">                    method =</span><span><span leaf="">"chisq"</span></span><span leaf="">, </span><span><span leaf=""># 计算方法，可选："chisq", "fisher", and "freq" </span></span><span leaf=""><br></span><span leaf="">                    min.rowSum =0 </span><span><span leaf=""># 行总和过滤阈值，行和（某个细胞类型在所有组中的总细胞数）小于等于此值的细胞类型会被过滤掉</span></span><span leaf=""><br></span><span leaf="">                 )</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 画一下图</span></span><span leaf=""><br></span><span leaf="">pheatmap(</span><span leaf=""><br></span><span leaf="">  Roe,</span><span leaf=""><br></span><span leaf="">  scale = </span><span><span leaf="">"none"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  display_numbers = TRUE,</span><span leaf=""><br></span><span leaf="">  number_color = </span><span><span leaf="">"black"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  number_format = </span><span><span leaf="">"%.2f"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 颜色</span></span><span leaf=""><br></span><span leaf="">  color = colorRampPalette(c(</span><span><span leaf="">"<a topic-id="mkpi64bq-rk648h" data-topic="1">#2166AC</a>"</span></span><span leaf="">, </span><span><span leaf="">"white"</span></span><span leaf="">, </span><span><span leaf="">"<a topic-id="mkpi64bq-murjrn" data-topic="1">#B2182B</a>"</span></span><span leaf="">))(100),</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 聚类</span></span><span leaf=""><br></span><span leaf="">  cluster_rows = TRUE,</span><span leaf=""><br></span><span leaf="">  cluster_cols = TRUE,</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 字体</span></span><span leaf=""><br></span><span leaf="">  fontsize = 10,</span><span leaf=""><br></span><span leaf="">  fontsize_row = 10,</span><span leaf=""><br></span><span leaf="">  fontsize_col = 10,</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 边框</span></span><span leaf=""><br></span><span leaf="">  border_color = </span><span><span leaf="">"grey80"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 单元格大小（矩阵不大时很好看）</span></span><span leaf=""><br></span><span leaf="">  cellwidth = 30,</span><span leaf=""><br></span><span leaf="">  cellheight = 25</span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv331Am7icdxRU0ekicUo4hSG7FtQ7NOvzspyxCXR1sukyZMBAy61OYLa0Iw/640?wx_fmt=png&amp;from=appmsg" data-ratio="1.6570743405275778" data-type="png" data-w="834" data-imgfileid="100000210" data-aistatus="1" src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv331Am7icdxRU0ekicUo4hSG7FtQ7NOvzspyxCXR1sukyZMBAy61OYLa0Iw/640?wx_fmt=png&amp;from=appmsg"></span></figure><h4 data-tool="mdnice编辑器"><span></span><span><span leaf="">数字换成"+++"号</span></span><span></span></h4><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># Roe 是你的原始数值矩阵</span></span><span leaf=""><br></span><span leaf="">symbol_mat &lt;- matrix(</span><span><span leaf="">""</span></span><span leaf="">, nrow = nrow(Roe), ncol = ncol(Roe))</span><span leaf=""><br></span><span leaf="">rownames(symbol_mat) &lt;- rownames(Roe)</span><span leaf=""><br></span><span leaf="">colnames(symbol_mat) &lt;- colnames(Roe)</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 符号标定范围，可以人为调整</span></span><span leaf=""><br></span><span leaf="">symbol_mat[Roe &gt; 2]                     &lt;- </span><span><span leaf="">"+++"</span></span><span leaf=""><br></span><span leaf="">symbol_mat[Roe &gt; 1 &amp; Roe &lt;= 2]        &lt;- </span><span><span leaf="">"++"</span></span><span leaf=""><br></span><span leaf="">symbol_mat[Roe &gt;= 0.5 &amp; Roe &lt;= 1]     &lt;- </span><span><span leaf="">"+"</span></span><span leaf=""><br></span><span leaf="">symbol_mat[Roe &gt; 0 &amp; Roe &lt; 0.5]         &lt;- </span><span><span leaf="">"+/-"</span></span><span leaf=""><br></span><span leaf="">symbol_mat[Roe == 0]                    &lt;- </span><span><span leaf="">"-"</span></span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">library(pheatmap)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">breaks &lt;- c(</span><span leaf=""><br></span><span leaf="">  0,</span><span leaf=""><br></span><span leaf="">  0.5,</span><span leaf=""><br></span><span leaf="">  1,</span><span leaf=""><br></span><span leaf="">  2,</span><span leaf=""><br></span><span leaf="">  max(Roe)</span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">colors &lt;- c(</span><span leaf=""><br></span><span><span leaf="">"<a topic-id="mkpi64br-w3xmoh" data-topic="1">#F1F1F1</a>"</span></span><span leaf="">,  </span><span><span leaf=""># 0</span></span><span leaf=""><br></span><span><span leaf="">"<a topic-id="mkpi64br-jls0ux" data-topic="1">#C6DBEF</a>"</span></span><span leaf="">,  </span><span><span leaf=""># 0–0.2</span></span><span leaf=""><br></span><span><span leaf="">"<a topic-id="mkpi64br-6bogmx" data-topic="1">#9ECAE1</a>"</span></span><span leaf="">,  </span><span><span leaf=""># 0.2–0.8</span></span><span leaf=""><br></span><span><span leaf="">"<a topic-id="mkpi64br-m9fec6" data-topic="1">#6BAED6</a>"</span></span><span leaf="">,  </span><span><span leaf=""># 0.8–1</span></span><span leaf=""><br></span><span><span leaf="">"<a topic-id="mkpi64br-j2zfbe" data-topic="1">#2171B5</a>"</span></span><span leaf="">   </span><span><span leaf=""># &gt;1</span></span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">pheatmap(</span><span leaf=""><br></span><span leaf="">  Roe,</span><span leaf=""><br></span><span leaf="">  scale = </span><span><span leaf="">"none"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf=""><br></span><span><span leaf=""># 用符号矩阵覆盖显示</span></span><span leaf=""><br></span><span leaf="">  display_numbers = symbol_mat,</span><span leaf=""><br></span><span leaf="">  number_color = </span><span><span leaf="">"black"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  fontsize_number = 10,</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">  color = colorRampPalette(colors)(100),</span><span leaf=""><br></span><span leaf="">  breaks = seq(min(breaks), max(breaks), length.out = 101),</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">  cluster_rows = T,</span><span leaf=""><br></span><span leaf="">  cluster_cols = T,</span><span leaf=""><br></span><span leaf=""><br></span><span leaf="">  border_color = </span><span><span leaf="">"grey85"</span></span><span leaf="">,</span><span leaf=""><br></span><span leaf="">  fontsize = 10,</span><span leaf=""><br></span><span><span leaf=""># 单元格大小（矩阵不大时很好看）</span></span><span leaf=""><br></span><span leaf="">  cellwidth = 30,</span><span leaf=""><br></span><span leaf="">  cellheight = 25</span><span leaf=""><br></span><span><span leaf=""># main = "Ro/e Enrichment"</span></span><span leaf=""><br></span><span leaf="">)</span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span><span leaf=""><br></span></code></pre><figure data-tool="mdnice编辑器"><span leaf=""><img data-aistatus="1" data-imgfileid="100000209" data-ratio="1.5918367346938775" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv33fSdTTnFINhp5j1yv56h4ibhulkACf0QwZalibCQtkECWyEZ6CcPlhK8Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="882" src="https://mmbiz.qpic.cn/sz_mmbiz_png/07lZfaTQ7oeCjbXXF8Y9zQEIcIK3Qv33fSdTTnFINhp5j1yv56h4ibhulkACf0QwZalibCQtkECWyEZ6CcPlhK8Q/640?wx_fmt=png&amp;from=appmsg"></span></figure></section><section><span leaf=""><br></span></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/LQS-ujGQfzxvzwOfPnnucA",target="_blank" rel="noopener noreferrer">原文链接</a>
